<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/xhtml;charset=UTF-8" http-equiv="Content-Type" /><meta content="IE=9" http-equiv="X-UA-Compatible" /><meta content="Doxygen 1.8.3.1" name="generator" /><title>id_solutions</title><link href="tabs.css" rel="stylesheet" type="text/css" /><script src="jquery.js" type="text/javascript"></script><script src="dynsections.js" type="text/javascript"></script><link href="navtree.css" rel="stylesheet" type="text/css" /><script src="resize.js" type="text/javascript"></script><script src="navtree.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(initResizable);

  $(window).load(resizeHeight);

</script><link href="search/search.css" rel="stylesheet" type="text/css" /><script src="search/search.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(function() { searchBox.OnSelectItem(0); });

</script><link href="doxygen.css" rel="stylesheet" type="text/css" /></head><body><div id="top"><div id="titlearea"><table cellpadding="0" cellspacing="0"><tbody><tr style="height: 56px;"><td id="projectlogo"><img alt="Logo" src="adobe_logo.png" /></td><td style="padding-left: 0.5em;"><div id="projectname">InDesign SDK &nbsp;<span id="projectnumber">14.0.0</span></div></td></tr></tbody></table></div><script type="text/javascript">

var searchBox = new SearchBox("searchBox", "search",false,'Search');

</script><div class="tabs" id="navrow1"><ul class="tablist"><li><a href="index.html"><span>InDesign&nbsp;SDK</span></a><li class="current"><a href="pages.html"><span>Documentation</span></a><li><a href="group__bosses__parent.html"><span>Bosses</span></a><li><a href="group__sdk.html"><span>Sample&nbsp;plug-ins</span></a><li><a href="classes.html"><span>Class&nbsp;Index</span></a><li><div class="MSearchBoxInactive" id="MSearchBox"><span class="left"> <img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="search/mag_sel.png" /> <input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search" /> </span><span class="right"> <a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="search/close.png" /></a> </span></div></ul></div></div><div class="ui-resizable side-nav-resizable" id="side-nav"><div id="nav-tree"><div id="nav-tree-contents"><div class="sync" id="nav-sync"></div></div></div><div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;"></div></div><script type="text/javascript">

$(document).ready(function(){initNavTree('id_solutions.html','');});

</script><div id="doc-content"><div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()"><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Pages</a></div><div id="MSearchResultsWindow"><iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)"></iframe></div><div class="header"><div class="headertitle"><div class="title">Solutions Guide </div></div></div><div class="contents"><div class="textblock"><h1><a class="anchor" id="id_introduction"></a> Introduction</h1><p>This document offers step-by-step instructions to developers embarking on Adobe &reg; InDesign&reg; development tasks. It includes references to other SDK documentation, tools, and samples, and it helps developers determine which InDesign API to use for different tasks.<p>The content in this guide assumes you are familiar with the basics of InDesign plug-in development. If not, read Getting Started With the Adobe InDesign Products SDK, which provides an overview of the SDK, as well as a tutorial that guides you through the steps needed to build your first plug-in.<h1><a class="anchor" id="id_layout"></a> Layout</h1><h2><a class="anchor" id="id_getting_started"></a> Getting started</h2><p>This chapter presents layout-related use cases. To solve a layout-related programming problem, like creating a spread or finding the frames in a spread, look for a use case that matches your needs.<p>To learn about how layout works and how it is organized, do the following:<ul><li>Run through the activities in <a class="el" href="id_solutions.html#id_exploring_layout_with_snippetrunner">Exploring layout with SnippetRunner</a>, to learn how to explore the layout-related objects in a document and familiarize yourself with layout-related sample code.<li>Read the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter in Adobe InDesign Programming Guide.</ul><h3><a class="anchor" id="id_exploring_layout_with_snippetrunner"></a> Exploring layout with SnippetRunner</h3><p>SnippetRunner is a plug-in that lets you run code snippets provided in the SDK. Several code snippets are provided that let you explore the layout-related objects in a document.<p><b>Solution</b><ol type="1"><li>Run Adobe &reg; InDesign&reg; with the SnippetRunner plug-in present. For instructions on using the plug-in, see the API documentation page for SnippetRunner.<li>Run the CreateDocument code snippet.<li>Run the InspectLayoutModel code snippet to create a textual report about the objects in the document&#39;s layout hierarchy.<li>Run the CreateFrame code snippet.<li>Deselect the new frame and run the InspectLayoutModel code snippet, to see how the document&#39;s layout hierarchy has changed. A new <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> is created. <dl class="section note"><dt>Note<dd>If an object is selected, InspectLayoutModel reports the hierarchy of only the selected object. If nothing is selected, it reports the hierarchy of the entire document.</dl><li>Run the PlaceFile code snippet, and place an image file.<li>Make sure the placed frame is selected, and run the InspectLayoutModel code snippet to report the objects in the hierarchy of the graphic frame.<li>Create other objects in a document or open documents containing layouts that you want to examine, and use InspectLayoutModel to examine the boss objects representing the layout hierarchy.<li>Browse the sample code in the snippets you have been running.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_create_document.html">SnpCreateDocument</a><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a><li><a class="el" href="class_snp_create_frame.html">SnpCreateFrame</a><li><a class="el" href="class_s_d_k_layout_helper.html">SDKLayoutHelper</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_document_layer.html">IDocumentLayer</a><li><a class="el" href="class_i_hierarchy.html">IHierarchy</a><li><a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="class_i_spread_layer.html">ISpreadLayer</a><li><a class="el" href="class_i_spread_list.html">ISpreadList</a></ul><h3><a class="anchor" id="id_finding_layout-related_resources_in_the_sdk"></a> Finding layout-related resources in the SDK</h3><p>You can locate assets in the SDK that will help you program with the layout subsystem.<p><b>Solution</b><ol type="1"><li>The <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter covers the layout subsystem.<li>See the API documentation. There are documentation pages for boss classes and interfaces. Sample code related to layout is on the Layout Samples page.</ol><h2><a class="anchor" id="id_documents"></a> Documents</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_a_document"></a> Acquiring a reference to a document</h3><p><b>Solution</b><p>A document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) is characterized by the <a class="el" href="class_i_document.html">IDocument</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_document.html">IDocument</a> interface is a document.<p>To iterate through documents, use <a class="el" href="class_i_document_list.html">IDocumentList</a> to list the documents that are open in the application. See <a class="el" href="id_solutions.html#id_iterating_through_documents">Iterating through documents</a>.<p>If you have an <a class="el" href="class_i_data_base.html">IDataBase</a> pointer, call <a class="el" href="class_i_data_base.html#a7fe2aa8e012510c2dfe26c8427ce5b5a">IDataBase::GetRootUID</a>. The document associated with a database (if any) can be discovered using code like the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> document(db, db-&gt;<a class="code" href="class_i_data_base.html#a7fe2aa8e012510c2dfe26c8427ce5b5a">GetRootUID</a>(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (document != nil) <span class="comment">// use the document interface</span></div></div><p>If you have a <a class="el" href="class_u_i_d_ref.html">UIDRef</a>:<ol type="1"><li>Call <a class="el" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">UIDRef::GetDataBase</a> to discover the <a class="el" href="class_i_data_base.html">IDataBase</a> pointer.<li>Use the pointer to acquire the document as described above.</ol><p>If you have an interface pointer for any interface on a UID-based object (for example, an <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface):<ol type="1"><li>Call the PersistUtils function ::GetDataBase to discover the <a class="el" href="class_i_data_base.html">IDataBase</a> pointer.<li>Use the pointer to acquire the document as described above.</ol><p>If you have an <a class="el" href="class_i_active_context.html">IActiveContext</a> interface, call <a class="el" href="class_i_active_context.html#ab426112dbeaf1cf757f6049b664569ca">IActiveContext::GetContextDocument</a>. The document associated with this context (if any) can be found using code like the following: <div class="fragment"><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* document = activeContext-&gt;GetContextDocument();</div><div class="line"><span class="keywordflow">if</span> (document != nil) <span class="comment">// use the document interface</span></div></div><p>If you have a layout view, call <a class="el" href="class_i_layout_control_data.html#a9e4d19074d3e715f020e1706008e8adf">ILayoutControlData::GetDocument</a>. For details, in the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of Adobe InDesign Programming Guide, see &quot;The Layout Window and View&quot; section. This call often is used by trackers (<a class="el" href="class_i_tracker.html">ITracker</a>).<p>To work with the document the user is editing, call <a class="el" href="class_i_layout_u_i_utils.html#a349e53c22983fc80067e2770056ce16d">ILayoutUIUtils::GetFrontDocument</a>.<p><b>Related API</b><ul><li><a class="el" href="class_i_document.html">IDocument</a></ul><h3><a class="anchor" id="id_creating_a_document"></a> Creating a document</h3><p><b>Creating a document with a setup of your own choice</b><p>You can create a document and specify the number of pages, page size, and so on that the new document should have.<p><b>Solution</b><ol type="1"><li>To create the command, call IDocumentCommands::CreateNewCommand.<li>Populate the command&#39;s <a class="el" href="class_i_new_doc_cmd_data.html">INewDocCmdData</a> data interface to describe the desired set-up.<li>Process the command.</ol><p><b>Sample Code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#affb49480d3a01ffd6b55c7b101cfb65f">SDKLayoutHelper::CreateDocument</a><li><a class="el" href="class_snp_create_document.html">SnpCreateDocument</a></ul><p><b>Creating a document using the default document setup</b><p><b>Solution</b> Call IDocumentCommands::New with the styleToUse parameter set to nil.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_document_commands.html">IDocumentCommands</a><li><a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a></ul><p><b>Creating a document from a document preset</b><p><b>Solution</b><ol type="1"><li>Using <a class="el" href="class_i_doc_style_list_mgr.html">IDocStyleListMgr</a>, find the name of the preset style (<a class="el" href="classk_doc_style_boss.html">kDocStyleBoss</a>) on which you want to base your document.<li>Call IDocumentCommands::New, passing the name of the preset in the styleToUse parameter.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_document_commands.html">IDocumentCommands</a></ul><h3><a class="anchor" id="id_opening_an_existing_document"></a> Opening an existing document</h3><p><b>Solution</b><p>Use IDocumentCommands::Open.<p><b>Sample Code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a4b153e275d008921f1630d9fd9bd8cf4">SDKLayoutHelper::OpenDocument</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_document_commands.html">IDocumentCommands</a><li><a class="el" href="class_i_document.html">IDocument</a></ul><h3><a class="anchor" id="id_saving_a_document"></a> Saving a document</h3><p><b>Saving a document to a file</b><p><b>Solution</b><p>If you already know where the file to save into is located or you want full control over how the user is prompted for the file location, call IDocumentCommands::SaveAs.<p>If you want the user to be asked to identify the file to save to using the application&#39;s save file dialog, call IDocFileHandler::SaveAs.<p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a05f93c05575294a1d66c05a832ac5c31">SDKLayoutHelper::SaveDocumentAs</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_document_commands.html">IDocumentCommands</a></ul><p><b>Saving a document</b><p>You can save a document that was saved to a file at least once before (<a class="el" href="class_i_document.html#ac9f44116c8b8b722afd2248445196639">IDocument::IsSaved</a> indicates this).<p><b>Solution</b><p>Call one of the following<ul><li>IDocumentCommands::Save<li>IDocFileHandler::Save</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_document_commands.html">IDocumentCommands</a><li><a class="el" href="class_i_doc_file_handler.html">IDocFileHandler</a></ul><h3><a class="anchor" id="id_closing_a_document"></a> Closing a document</h3><p><b>Solution</b><p>To close any layout windows that are open, then schedule a command to close the document, use IDocFileHandler::Close.<p>To process a command to close the document immediately, use IDocumentCommands::Close.<p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#ac13c1188e3e577f98bdbe87ccd9c5ae0">SDKLayoutHelper::CloseDocument</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_document.html">IDocument</a></ul><h3><a class="anchor" id="id_iterating_through_documents"></a> Iterating through documents</h3><p>You can examine all open documents.<p><b>Solution</b><ol type="1"><li>Use the session returned from GetExecutionContextSession() to call <a class="el" href="class_i_session.html#a7c979fb98dc19fe2608a9f99ba3ecd6b">ISession::QueryApplication</a>.<li>Call <a class="el" href="class_i_application.html#a13b4455f2107f6010b3d4a011846e0f2">IApplication::QueryDocumentList</a>.<li>Examine the documents using <a class="el" href="class_i_document_list.html">IDocumentList</a></ol><p><b>Sample code</b><div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IApplication&gt;</a> application(GetExecutionContextSession()-&gt;QueryApplication());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocumentList&gt;</a> documentList(application-&gt;QueryDocumentList());</div><div class="line"><span class="keywordflow">for</span> (int32 i = 0; i &lt; documentList-&gt;GetDocCount(); i++) {</div><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* document = documentList-&gt;GetNthDoc(i);</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> name;</div><div class="line"> document-&gt;<a class="code" href="class_i_document.html#a97d9d37dae4850a7eb0d8814728d2946">GetName</a>(name);</div><div class="line">}</div></div><p><b>Related API</b><ul><li><a class="el" href="class_i_document.html">IDocument</a></ul><h3><a class="anchor" id="id_finding_the_default_indesign_document_setup"></a> Finding the default InDesign document setup</h3><p>You can find the properties displayed in the File &gt; Document Setup and File &gt; New Document dialogs.<p><b>Solution</b><p>To get the defaults inherited by new documents, use <a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<p>To get the settings for a document, use <a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a> on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_modify_layout_grid.html">SnpModifyLayoutGrid</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a></ul><h3><a class="anchor" id="id_changing_the_default_indesign_document_setup"></a> Changing the default InDesign document setup</h3><p><b>Solution</b><p>Use <a class="el" href="classk_set_page_setup_prefs_cmd_boss.html">kSetPageSetupPrefsCmdBoss</a>.<p><b>Related documentation</b><ul><li>See <a class="el" href="id_solutions.html#id_finding_the_default_indesign_document_setup">Finding the default InDesign document setup</a>.</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a></ul><h3><a class="anchor" id="id_getting_notified_when_documents_are_created_opened_saved_or_closed"></a> Getting notified when documents are created, opened, saved, or closed</h3><p><b>Solution</b><ul><li>Implement a document signal responder service (<a class="el" href="class_i_responder.html">IResponder</a>).</ul><p><b>Sample code</b><ul><li>DocWatch</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_doc_wch_responder.html#adf850774317d91a4b51640df84f625a6">DocWchResponder::Respond</a> catalogs the ServiceIDs.<li><a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a><li><a class="el" href="class_i_responder.html">IResponder</a></ul><h2><a class="anchor" id="id_spreads_and_pages"></a> Spreads and pages</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_a_spread"></a> Acquiring a reference to a spread</h3><p><b>Solution</b><p>A spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) is characterized by the <a class="el" href="class_i_spread.html">ISpread</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_spread.html">ISpread</a> interface is a spread.<p>To iterate through the spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) in a document (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_layer">Acquiring a reference to a document</a>), use <a class="el" href="class_i_spread_list.html">ISpreadList</a>.<p>If you have an <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface on a page item, use the following:<ul><li><a class="el" href="class_i_hierarchy.html#a4db9e54a2e67587806995520f46233a2">IHierarchy::GetSpreadUID</a>.<li><a class="el" href="class_i_pasteboard_utils.html#a5ea2068d96a460a1be2ece991069fe26">IPasteboardUtils::QuerySpread</a>. This utility gives you the <a class="el" href="class_i_spread.html">ISpread</a> interface of the spread that owns the object whose <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface you already have.</ul><dl class="section note"><dt>Note<dd>If you have another page item interface like <a class="el" href="class_i_geometry.html">IGeometry</a> or <a class="el" href="class_i_transform.html">ITransform</a>, query that interface for <a class="el" href="class_i_hierarchy.html">IHierarchy</a>, then call the method above to get a reference to the spread.</dl><p>If you have a layout view and want to find the spread being edited, use ILayoutControlData::GetSpread.<p>If you have a document and want to find the spread being edited, use IID_ICURRENTSPREAD on <a class="el" href="classk_doc_boss.html">kDocBoss</a>. This is an <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> interface that stores the current spread for a document.<p>To hit test for a spread, use <a class="el" href="class_i_pasteboard_utils.html">IPasteboardUtils</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_bsc_d_n_d_custom_flavor_helper.html#a3bc0598109e63b177c44b93da967e416">BscDNDCustomFlavorHelper::ProcessDragDropCommand</a><li>CHMLFiltHelper::collectGraphicFrames<li><a class="el" href="class_snap_tracker.html#af0eeff098f2702f26383ed047276c452">SnapTracker::BeginTracking</a><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="classk_spread_boss.html">kSpreadBoss</a></ul><h3><a class="anchor" id="id_creating_a_spread"></a> Creating a spread</h3><p><b>Solution</b><p>Use <a class="el" href="classk_new_spread_cmd_boss.html">kNewSpreadCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="classk_spread_boss.html">kSpreadBoss</a></ul><h3><a class="anchor" id="id_deleting_a_spread"></a> Deleting a spread</h3><p><b>Solution</b><p>Use <a class="el" href="classk_delete_spread_cmd_boss.html">kDeleteSpreadCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="classk_spread_boss.html">kSpreadBoss</a></ul><h3><a class="anchor" id="id_iterating_through_spreads"></a> Iterating through spreads</h3><p>You can examine all spreads in a document.<p><b>Solution</b><p>Use <a class="el" href="class_i_spread_list.html">ISpreadList</a>.<p><b>Sample code</b><ul><li>CHMLFiltHelper::collectGraphicFrames<li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="classk_spread_boss.html">kSpreadBoss</a></ul><h3><a class="anchor" id="id_rearranging_the_order_of_spreads"></a> Rearranging the order of spreads</h3><p>You can rearrange the order of spreads in a document; for example, move the spread containing pages 2 and 3 so these pages precede the spread containing pages 6 and 7.<p><b>Solution</b><p>Use <a class="el" href="classk_move_spread_cmd_boss.html">kMoveSpreadCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="class_i_spread_list.html">ISpreadList</a></ul><h3><a class="anchor" id="id_copying_a_spread"></a> Copying a spread</h3><p>You can duplicate a spread and the page items it contains.<p><b>Solution</b><p>To append the duplicated spread to the spread list (<a class="el" href="class_i_spread_list.html">ISpreadList</a>) in the target document, process <a class="el" href="classk_create_spread_from_spread_cmd_boss.html">kCreateSpreadFromSpreadCmdBoss</a>.<p>To control where in the spread list (<a class="el" href="class_i_spread_list.html">ISpreadList</a>) the spread is positioned:<ol type="1"><li>Process <a class="el" href="classk_new_spread_cmd_boss.html">kNewSpreadCmdBoss</a> to create a new spread at a position of your choice in the target document&#39;s spread list.<li>Process <a class="el" href="classk_duplicate_spread_cmd_boss.html">kDuplicateSpreadCmdBoss</a> to copy the source spread.</ol><h3><a class="anchor" id="id_iterating_through_the_content_of_a_spread"></a> Iterating through the content of a spread</h3><p><b>Solution</b><p>Use <a class="el" href="class_i_hierarchy.html">IHierarchy</a> on <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_iterating_through_page_content">Iterating through page content</a>.<li><a class="el" href="id_solutions.html#id_iterating_through_layer_content">Iterating through layer content</a>.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a><li>In the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of Adobe InDesign Programming Guide, see two examples: &quot;Code that Iterates through Spreads and Visits their Children via IHierarchy&quot; and &quot;Code that Iterates through Spreads and Filters Items by Page via ISpread.&quot;</ul><h3><a class="anchor" id="id_acquiring_a_reference_to_a_page"></a> Acquiring a reference to a page</h3><p><b>Solution</b><p>A page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) is characterized by the <a class="el" href="class_i_master_page.html">IMasterPage</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_master_page.html">IMasterPage</a> interface is a page.<p>If you have a document (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_layer">Acquiring a reference to a document</a>) and want to iterate through its pages, use <a class="el" href="class_i_page_list.html">IPageList</a>. See &quot;Acquiring a reference to a page&quot;.<p>If you have a spread (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_layer">Acquiring a reference to a spread</a>) and want to iterate through its pages, use the following:<ul><li><a class="el" href="class_i_spread.html#aba1381e79ceec19ce133854241bcb949">ISpread::GetNumPages</a> and <a class="el" href="class_i_spread.html#a9b62e506756b79643190031d0cf221ed">ISpread::GetNthPageUID</a> provide easy access to the pages.<li><a class="el" href="class_i_spread.html#a6b0fcfedb46eb057a6d85aaedd7d9f49">ISpread::QueryPagesLayer</a> provides access to the spread layer that stores the pages on its <a class="el" href="class_i_hierarchy.html">IHierarchy</a>. The child boss objects of this spread layer are the pages owned by the spread.</ul><p>If you have a page item and want to know the page, if any, on which it lies or is drawn, use the following:<ul><li><a class="el" href="class_i_layout_utils.html#affb533c81b0ac75760cda970e419ef7c">ILayoutUtils::GetOwnerPageUID</a><li><a class="el" href="class_i_layout_utils.html#ae3cda476044616307808c45af4f4a6b5">ILayoutUtils::GetDrawingPageUID</a></ul><p>If you have a layout view(kLayoutWidgetBoss), use <a class="el" href="class_i_layout_control_data.html#a2ecb5508c566a401c98aa3aee651bc2b">ILayoutControlData::GetPage</a>, to get the page being viewed by the user in layout view.<p><b>Sample code</b><ul><li>CHMLFiltImportProvider::LoadImage<li><a class="el" href="class_snp_create_indd_preview.html#af1baaf325de12c28093834d3a11a5ca3">SnpCreateInddPreview::CreateFirstPagePreview</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_creating_a_page"></a> Creating a page</h3><p><b>Solution</b><p>Use <a class="el" href="classk_new_page_cmd_boss.html">kNewPageCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_deleting_a_page"></a> Deleting a page</h3><p>You can delete a page and the page items on it.<p><b>Solution</b><p>Use <a class="el" href="classk_delete_page_cmd_boss.html">kDeletePageCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_iterating_through_pages"></a> Iterating through pages</h3><p>You can examine the pages in a document or the pages in a spread.<p><b>Solution</b><p>To iterate through all pages in a document, use <a class="el" href="class_i_page_list.html">IPageList</a>.<dl class="section note"><dt>Note<dd><a class="el" href="class_i_page_list.html">IPageList</a> does not list master pages (the pages owned by master spreads). It lists only pages owned by spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>).</dl><p>To iterate through all pages in a spread, use <a class="el" href="class_i_spread.html">ISpread</a>.<p><b>Sample code</b><ul><li>CHMLFiltImportProvider::LoadImage</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_page_list.html">IPageList</a><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_rearranging_pages"></a> Rearranging pages</h3><p>You can rearrange the order of pages in a document.<p><b>Solution</b><p>Use <a class="el" href="classk_move_page_cmd_boss.html">kMovePageCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_page_list.html">IPageList</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_copying_a_page"></a> Copying a page</h3><p>You can duplicate a page together with the page items on it.<p><b>Solution</b><p>To append the duplicated page to the target document, use <a class="el" href="classk_create_page_from_page_cmd_boss.html">kCreatePageFromPageCmdBoss</a>.<p>To control the spread in which the duplicate is made, do one of the following:<ul><li>Create a new spread for the page using <a class="el" href="classk_new_spread_cmd_boss.html">kNewSpreadCmdBoss</a>.<li>Process <a class="el" href="classk_duplicate_page_cmd_boss.html">kDuplicatePageCmdBoss</a>.</ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_iterating_through_page_content"></a> Iterating through page content</h3><p>You can iterate through page items on a page.<p><b>Solution</b><p>Use <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a>.<p><b>Sample code</b><ul><li>CHMLFiltImportProvider::LoadImage<li>In the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of Adobe InDesign Programming Guide, see the example entitled &quot;Code that Iterates through Spreads and Filters Items by Page via ISpread.&quot;</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_spread.html">ISpread</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_finding_page_size"></a> Finding page size</h3><p><b>Solution</b><p>If you have a reference to a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>), use <a class="el" href="class_i_geometry.html#ab06802236ea88e3f8fe478e49e846605">IGeometry::GetStrokeBoundingBox</a> to get the size of each page.<p>If you have a reference to the document&#39;s workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), use &Acirc;&nbsp;IPageSetupPrefs to get the default page size inherited by new pages.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_modify_layout_grid.html">SnpModifyLayoutGrid</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_changing_page_size_preference"></a> Changing page size preference</h3><p>You can change the default page size in a document.<p><b>Solution</b><p>Use <a class="el" href="classk_set_page_setup_prefs_cmd_boss.html">kSetPageSetupPrefsCmdBoss</a> to change the document page size. When the document page size and orientation settings are changed, the changes are also applied to any pages whose size and orientation matched the document settings prior to the change.<p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_finding_page_margins"></a> Finding page margins</h3><p><b>Solution</b><p>Use <a class="el" href="class_i_margins.html">IMargins</a>. Each page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) has its own margins.<p><b>Sample Code</b><ul><li>CHMLFiltHelper::addGraphicFrameDescription<li><a class="el" href="class_s_d_k_layout_helper.html#aedf353975efe3a03a2ca4cac9b4c90d4">SDKLayoutHelper::PageToSpread</a><li><a class="el" href="class_snp_modify_layout_grid.html">SnpModifyLayoutGrid</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_changing_page_margins"></a> Changing page margins</h3><p><b>Solution</b><p>Use <a class="el" href="classk_set_page_margins_cmd_boss.html">kSetPageMarginsCmdBoss</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_modify_layout_grid.html">SnpModifyLayoutGrid</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_finding_page_column_guides"></a> Finding page column guides</h3><p><b>Solution</b><p>Use <a class="el" href="class_i_columns.html">IColumns</a>. Each page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) has its own column guides.<p><b>Sample Code</b><ul><li><a class="el" href="class_snp_modify_layout_grid.html">SnpModifyLayoutGrid</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_changing_page_column_guides"></a> Changing page column guides</h3><p><b>Solution</b><p>Use the following:<ul><li><a class="el" href="classk_set_page_columns_cmd_boss.html">kSetPageColumnsCmdBoss</a><li><a class="el" href="classk_set_column_gutter_cmd_boss.html">kSetColumnGutterCmdBoss</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_modify_layout_grid.html">SnpModifyLayoutGrid</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_getting_notified_of_spread_and_page_operations"></a> Getting notified of spread and page operations</h3><p><b>Solution</b><p>Implement a document observer interested in IID_ISPREADLIST.<dl class="section note"><dt>Note<dd>This approach works for commands that create, delete, arrange, and copy spreads and pages but not for all spread and page manipulations. For details of the subject you need to observe, see the API documentation for the command used to perform the operation in which you are interested.</dl><p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_observer.html">IObserver</a><li><a class="el" href="class_i_subject.html">ISubject</a></ul><h2><a class="anchor" id="id_layers"></a> Layers</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_a_layer"></a> Acquiring a reference to a layer</h3><p>A layer comprises a document layer with two corresponding spread layers in each spread in the document. Spread layers own page items. If you want a boss object to act as a parent for a new page item, you will need a reference to a spread layer.<p><b>Acquiring a reference to a document layer</b><p><b>Solution</b><p>A document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) is characterized by the <a class="el" href="class_i_document_layer.html">IDocumentLayer</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_document_layer.html">IDocumentLayer</a> interface is a document layer.<p>If you have a document (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_document">Acquiring a reference to a document</a>) and want to examine all the document layers, use <a class="el" href="class_i_layer_list.html">ILayerList</a>.<p>If you have a document and want to find the document layer targeted for edit operations, use <a class="el" href="class_i_layer_utils.html#a48897e0bd1fc51caea557ec51d3588e1">ILayerUtils::QueryDocumentActiveLayer</a>.<p>If you have a spread layer and want to find its associated document layer, use <a class="el" href="class_i_spread_layer.html#a47b11b7fa0be2ee1f6b31b30a0ab341c">ISpreadLayer::QueryDocLayer</a>.<p>If you have a reference to a page item and want to find its associated document layer, Call <a class="el" href="class_i_layer_utils.html#abd5b9a7f7bec50862e7c936821e8b178">ILayerUtils::GetLayerUID</a> to get the spread layer that owns the page item, then call <a class="el" href="class_i_spread_layer.html#a47b11b7fa0be2ee1f6b31b30a0ab341c">ISpreadLayer::QueryDocLayer</a>.<p>If you have a layout view and want to find the document layer targeted for edit, use <a class="el" href="class_i_layout_control_data.html#a6882a4958b887b208747197198c5fc7b">ILayoutControlData::QueryActiveDocLayer</a> or <a class="el" href="class_i_layout_control_data.html#ae5b974377382dfb6e422a0a70489b181">ILayoutControlData::GetActiveDocLayerUID</a> give the active document layer.<p>If you have an <a class="el" href="class_i_active_context.html">IActiveContext</a> interface, use <a class="el" href="class_i_layer_u_i_utils.html#a7068b443a4324baf1342d36ebe4fbfc1">ILayerUIUtils::QueryContextActiveLayer</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html">SDKLayoutHelper</a><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a></ul><p><b>Related API</b><ul><li>kDocumentLayer</ul><p><b>Acquiring a reference to a spread layer</b><p><b>Solution</b><p>A spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) is characterized by the <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a> interface is a spread layer.<p>If you have a spread (see &quot;Acquiring a reference to a spread&quot;) and a document layer (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_layer">Acquiring a reference to a document layer</a>), use <a class="el" href="class_i_spread.html#a48e0c4d322acbd18f94ad694709630c0">ISpread::QueryLayer</a> to get the content or guide spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) associated with the document layer.<p>If you have a page item and want to know the spread layer that owns it, use <a class="el" href="class_i_hierarchy.html#a22bf4617803b3e675d6e823bfec81a5c">IHierarchy::GetLayerUID</a>.<dl class="section note"><dt>Note<dd>Some hierarchies, like those for an inline frame (<a class="el" href="classk_inline_boss.html">kInlineBoss</a>), return kInvalidUID. If you are working with inline frames, use <a class="el" href="class_i_page_item_utils.html#a3e44d7eefa36b5caf43cb017218d9efb">IPageItemUtils::QueryInlineParentPageItem</a> to find the page item in the layout hierarchy first, then find the spread layer.</dl><p>If you have a layout view and want to find the spread layer targeted for edit operations, use <a class="el" href="class_i_layout_control_data.html#a129562acf095e681ea7006c565f4ed89">ILayoutControlData::QueryActiveLayer</a> or <a class="el" href="class_i_layout_control_data.html#a87e3a8123d6a29e7d91f81cc50df9008">ILayoutControlData::GetActiveLayerUID</a> to get the active spread layer. This is useful if you want to parent page items created by your plug-in on the same layer the user is editing.<p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a02753c1f8a3957711efd273e0105fde9">SDKLayoutHelper::GetActiveSpreadLayerRef</a><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a></ul><p><b>Related API</b><ul><li>kSpreadLayer</ul><h3><a class="anchor" id="id_creating_a_layer"></a> Creating a layer</h3><p><b>Solution</b><p>Use <a class="el" href="classk_new_layer_cmd_boss.html">kNewLayerCmdBoss</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_process_document_layer_cmds.html#a45caa7a192600eb3b4dfb03c4007873c">SnpProcessDocumentLayerCmds::CreateNewLayer</a></ul><p><b>Related APIs</b><ul><li>kDocumentLayer<li>kSpreadLayer</ul><h3><a class="anchor" id="id_deleting_a_layer"></a> Deleting a layer</h3><p>You can delete a layer and its associated content.<p><b>Solution</b><p>Use <a class="el" href="classk_delete_layer_cmd_boss.html">kDeleteLayerCmdBoss</a>.<p><b>Related APIs</b><ul><li>kDocumentLayer<li>kSpreadLayer</ul><h3><a class="anchor" id="id_iterating_through_layers"></a> Iterating through layers</h3><p>You can examine the layers in a document.<p><b>Solution</b><ul><li>Use <a class="el" href="class_i_layer_list.html">ILayerList</a> to get the document layers(kDocumentLayerBoss).<li>Use <a class="el" href="class_i_spread.html#a48e0c4d322acbd18f94ad694709630c0">ISpread::QueryLayer</a> to get the spread layers associated with a document layer.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a><li>In the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of the programming guide vol 1, see the example entitled &quot;Code that Iterates through Spreads in a Document, then Iterates through Document Layers, to visit Items on the Spread Layer associated with each Document Layer.&quot;</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_layer_list.html">ILayerList</a><li><a class="el" href="class_i_spread.html">ISpread</a><li>kDocumentLayer<li>kSpreadLayer</ul><h3><a class="anchor" id="id_rearranging_the_order_of_layers"></a> Rearranging the order of layers</h3><p><b>Solution</b><p>Use <a class="el" href="classk_move_layer_cmd_boss.html">kMoveLayerCmdBoss</a>.<p><b>Related APIs</b><ul><li>kDocumentLayer<li>kSpreadLayer</ul><h3><a class="anchor" id="id_copying_a_layer"></a> Copying a layer</h3><p><b>Solution</b><p>To append the duplicated layer to the end of the layer list (<a class="el" href="class_i_layer_list.html">ILayerList</a>) in the target document, use <a class="el" href="classk_create_layer_from_layer_cmd_boss.html">kCreateLayerFromLayerCmdBoss</a>.<p>To position the duplicate at a position of choice in the layer list (<a class="el" href="class_i_layer_list.html">ILayerList</a>), use the following:<ol type="1"><li><a class="el" href="classk_new_layer_cmd_boss.html">kNewLayerCmdBoss</a> creates a new layer.<li><a class="el" href="classk_move_layer_cmd_boss.html">kMoveLayerCmdBoss</a> positions the new layer.<li><a class="el" href="classk_duplicate_layer_cmd_boss.html">kDuplicateLayerCmdBoss</a> copies the content.</ol><p><b>Related APIs</b><ul><li>kDocumentLayer<li>kSpreadLayer</ul><h3><a class="anchor" id="id_iterating_through_layer_content"></a> Iterating through layer content</h3><p>You can examine all page items assigned to a given layer on a spread.<p><b>Solution</b><ol type="1"><li>Iterate through document layers using <a class="el" href="class_i_layer_list.html">ILayerList</a>.<li>Iterate through spreads using <a class="el" href="class_i_spread_list.html">ISpreadList</a>.<li>Iterate through the spread layers using <a class="el" href="class_i_spread.html#a48e0c4d322acbd18f94ad694709630c0">ISpread::QueryLayer</a>.<li>Examine the page items on the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> of each spread layer.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a><li>In the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of Adobe InDesign Programming Guide, see the example &quot;Code that Iterates through Spreads in a Document, then Iterates through Document Layers, to visit Items on the Spread Layer associated with each Document Layer.&quot;</ul><h3><a class="anchor" id="id_locking_and_unlocking_a_layer"></a> Locking and unlocking a layer</h3><p><b>Solution</b><p>Use <a class="el" href="classk_lock_layer_cmd_boss.html">kLockLayerCmdBoss</a>.<p><b>Related API</b><ul><li>kDocumentLayer</ul><h3><a class="anchor" id="id_showing_and_hiding_a_layer"></a> Showing and hiding a layer</h3><p><b>Solution</b><p>Use <a class="el" href="classk_show_layer_cmd_boss.html">kShowLayerCmdBoss</a>.<p><b>Related API</b><ul><li>kDocumentLayer</ul><h3><a class="anchor" id="id_renaming_a_layer"></a> Renaming a layer</h3><p><b>Solution</b><p>Use <a class="el" href="classk_change_layer_name_cmd_boss.html">kChangeLayerNameCmdBoss</a>.<p><b>Related API</b><ul><li>kDocumentLayer</ul><h3><a class="anchor" id="id_changing_layer_color"></a> Changing layer color</h3><p><b>Solution</b><p>Use <a class="el" href="classk_set_layer_color_cmd_boss.html">kSetLayerColorCmdBoss</a>.<p><b>Related API</b><ul><li>kDocumentLayer</ul><h3><a class="anchor" id="id_merging_layers"></a> Merging layers</h3><p>You can merge two or more layers and the page items assigned to them into one layer.<p><b>Solution</b><p>Use <a class="el" href="classk_merge_layers_cmd_boss.html">kMergeLayersCmdBoss</a>.<p><b>Related APIs</b><ul><li>kDocumentLayer<li>kSpreadLayer</ul><h3><a class="anchor" id="id_getting_notified_of_layer_operations"></a> Getting notified of layer operations</h3><p><b>Solution</b><p>Implement a document observer that&#39;s interested in IID_ILAYERLIST<p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li>kDocumentLayer<li><a class="el" href="class_i_observer.html">IObserver</a><li><a class="el" href="class_i_subject.html">ISubject</a></ul><h2><a class="anchor" id="id_master_spreads_and_master_pages"></a> Master spreads and master pages</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_a_master_spread"></a> Acquiring a reference to a master spread</h3><p><b>Solution</b><p>A master spread (kMasterpagesBoss) is characterized by the <a class="el" href="class_i_master_spread.html">IMasterSpread</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_master_spread.html">IMasterSpread</a> interface is a master spread.<p>If you have a document (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_layer">Acquiring a reference to a document</a>) and want to examine all the master spreads, use <a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>.<p>If you have a page (see <a class="el" href="id_solutions.html#id_acquiring_a_pages_master_page">Acquiring a reference to a page</a>) and want to find its master spread, use IMasterPage::GetMasterPageUID.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_creating_a_master_spread"></a> Creating a master spread</h3><p><b>Solution</b><p>Use <a class="el" href="classk_new_master_spread_cmd_boss.html">kNewMasterSpreadCmdBoss</a>.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_copying_a_master_spread">Copying a master spread</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_deleting_a_master_spread"></a> Deleting a master spread</h3><p><b>Solution</b><p>Use <a class="el" href="classk_delete_master_spread_cmd_boss.html">kDeleteMasterSpreadCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_rearranging_the_order_of_master_spreads"></a> Rearranging the order of master spreads</h3><p><b>Solution</b><p>The order of master spreads in the document is given by their index order in <a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>. To rearrange the order process, use kMoveMasterSpread.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_copying_a_master_spread"></a> Copying a master spread</h3><p>You can duplicate a master spread and the page items it contains.<p><b>Solution</b><p>To append the duplicated master spread to the master spread list (<a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>) in the target document, use <a class="el" href="classk_create_master_from_master_cmd_boss.html">kCreateMasterFromMasterCmdBoss</a>.<p>To control where in the master spread list (<a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>) the master spread is positioned:<ol type="1"><li>Use <a class="el" href="classk_new_master_spread_cmd_boss.html">kNewMasterSpreadCmdBoss</a> to create a new master spread at a position of your choice in the target document&#39;s master spread list.<li>Use <a class="el" href="classk_duplicate_spread_cmd_boss.html">kDuplicateSpreadCmdBoss</a> to copy the source spread.</ol><h3><a class="anchor" id="id_saving_a_spread_as_a_master_spread"></a> Saving a spread as a master spread</h3><p>You can create a master spread from a spread and the page items it contains.<p><b>Solution</b><p>To append the duplicated spread to the master spread list (<a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>) in the target document, use <a class="el" href="classk_create_master_from_spread_cmd_boss.html">kCreateMasterFromSpreadCmdBoss</a>.<p>To control where in the master spread list (<a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>) the master spread is positioned:<ol type="1"><li>Use <a class="el" href="classk_new_master_spread_cmd_boss.html">kNewMasterSpreadCmdBoss</a> to create a new master spread at a position of your choice in the target document&#39;s master spread list.<li>Use <a class="el" href="classk_duplicate_spread_cmd_boss.html">kDuplicateSpreadCmdBoss</a> to copy the source spread.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_renaming_a_master_spread"></a> Renaming a master spread</h3><p>You can change the name or prefix of a master spread.<p><b>Solution</b><p>Use <a class="el" href="classk_rename_master_spread_cmd_boss.html">kRenameMasterSpreadCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_acquiring_a_pages_master_page"></a> Acquiring a page&#39;s master page</h3><p><b>Solution</b><p>To get a page if you do not have one, see <a class="el" href="id_solutions.html#id_acquiring_a_pages_master_page">Acquiring a reference to a page</a>.<p>Follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_master_page.html#a1503b74237215f51c6c679e1aa5cce4c">IMasterPage::IsValid</a> to determine whether the page has a master (if so, kTrue is returned).<li>Use IMasterPage::GetMasterPageUID to return the UID of the associated master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>).<li>Use IMasterPage::GetMasterIndex to get the index of the master page in the master spread.<li>With the index, use <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a> to get the master spread&#39;s <a class="el" href="class_i_spread.html">ISpread</a> interface, and call it to collect a list of all page items on the master page.</ol><p><b>Sample code</b><ul><li>SnpInspectLayoutModel::TracePageNode</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_distinguishing_a_master_page_from_a_page"></a> Distinguishing a master page from a page</h3><p><b>Solution</b><p>Both pages and master pages are represented by the same boss class, <a class="el" href="classk_page_boss.html">kPageBoss</a> (see <a class="el" href="id_solutions.html#id_acquiring_a_pages_master_page">Acquiring a reference to a page</a>). To tell them apart, call <a class="el" href="class_i_layout_utils.html#a2f8fd6f31e9e3c9e9533fde2dc391aab">ILayoutUtils::IsAMaster</a>. A master page is a page owned by a master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>). This utility encapsulates the tests that need to be made to determine this.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_applying_a_master_page_to_a_page"></a> Applying a master page to a page</h3><p><b>Solution</b><p>Use <a class="el" href="classk_apply_master_spread_cmd_boss.html">kApplyMasterSpreadCmdBoss</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_showing_and_hiding_master_page_items"></a> Showing and hiding master page items</h3><p><b>Solution</b><p>Use <a class="el" href="classk_show_master_items_cmd_boss.html">kShowMasterItemsCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_spread_boss.html">kSpreadBoss</a></ul><h3><a class="anchor" id="id_overriding_master_page_items"></a> Overriding master page items</h3><p><b>Solution</b><p>To override master page items of your choice, use <a class="el" href="classk_override_master_page_item_cmd_boss.html">kOverrideMasterPageItemCmdBoss</a>.<p>To override all the master page items associated with a range of spreads of pages, use <a class="el" href="class_i_master_spread_utils.html#afe4cf0049bb5fbc9b8a94e8b816867da">IMasterSpreadUtils::CreateOverrideMasterPageItemsCmd</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_override_list.html">IMasterOverrideList</a><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_removing_a_master_page_item_overrides"></a> Removing a master page item overrides</h3><p><b>Solution</b><p>To remove the master page item overrides of your choice, use <a class="el" href="classk_remove_master_page_override_cmd_boss.html">kRemoveMasterPageOverrideCmdBoss</a>.<p>To remove master page item overrides of objects that are selected, use <a class="el" href="class_i_master_page_suite.html">IMasterPageSuite</a>.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_master_override_list.html">IMasterOverrideList</a><li><a class="el" href="class_i_master_page.html">IMasterPage</a><li><a class="el" href="class_i_master_spread.html">IMasterSpread</a><li><a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a><li><a class="el" href="classk_page_boss.html">kPageBoss</a></ul><h3><a class="anchor" id="id_getting_notified_of_master_spread_and_master_page_operations"></a> Getting notified of master spread and master page operations</h3><p><b>Solution</b><p>Implement a document observer interested in IID_ISPREADLIST.<dl class="section note"><dt>Note<dd>This approach works for commands that create, delete, arrange, and copy spreads and pages but not for all spread and page manipulations. For details of the subject you need to observe, see the API documentation for the command used to perform the operation in which you are interested.</dl><p><b>Related APIs</b><ul><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_observer.html">IObserver</a><li><a class="el" href="class_i_subject.html">ISubject</a></ul><h2><a class="anchor" id="id_page_items"></a> Page Items</h2><h3><a class="anchor" id="id_creating_a_page_item"></a> Creating a page item</h3><p><b>Creating an empty graphic frame</b><p><b>Solution</b><ol type="1"><li>Determine the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the parent. The parent is the object that will own the frame. Normally, it is a spread layer (see &quot;Acquiring a reference to a spread layer&quot;).<li>Determine the bounding box for the frame to position and size it as desired. Normally, frames are positioned relative to a page (see <a class="el" href="id_solutions.html#id_acquiring_a_pages_master_page">Acquiring a reference to a page</a>).<li>Create the frame by calling the <a class="el" href="class_i_path_utils.html">IPathUtils</a> method that creates the path you want:<ul><li>Use <a class="el" href="class_i_path_utils.html#a65c47d0f4fbffa935a8b11b951802e73">IPathUtils::CreateRectangleSpline</a> to create a rectangular path.<li>Use <a class="el" href="class_i_path_utils.html#aa9367ab10b65d625a5b1fd31ab9e71b0">IPathUtils::CreateOvalSpline</a> to create an elliptical path.<li>Use <a class="el" href="class_i_path_utils.html#ac1524efcbc668e2d1d073b639a0048b2">IPathUtils::CreateRegPolySpline</a> to create a regular polygon path.<li>Use <a class="el" href="class_i_path_utils.html#a32c78782801157b0e77f94affbf50e48">IPathUtils::CreateSpline</a> to get complete control of the path.<li>Use attrType= <a class="el" href="class_i_new_page_item_cmd_data.html#a3c11a4df87ce358afa1eedcebc17364aa081f08c641bf077ba9303e7ee83e3f1c">INewPageItemCmdData::kGraphicFrameAttributes</a> to create a placeholder graphic frame (a frame with an X in it).</ul></ol><p>The following example shows code that, given a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> to a document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>), creates a frame at the origin of the first page in the document. The parent for the frame is the spread layer associated with the first content layer in the first spread in the document.<p>This example creates a 100*100 point square graphic frame at the origin of the first page: <div class="fragment"><div class="line"><span class="comment">// 1. Determine the UIDRef of the parent.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadList&gt;</a> spreadList(docUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpread&gt;</a> spread(docUIDRef.GetDataBase(), spreadList-&gt;GetNthSpreadUID(0), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILayerList&gt;</a> layerList(docUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_document_layer.html">IDocumentLayer</a>* documentLayer = layerList-&gt;GetLayer(1);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadLayer&gt;</a> spreadLayer(spread-&gt;QueryLayer(documentLayer));</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> parentUIDRef = ::GetUIDRef(spreadLayer);</div><div class="line"><span class="keywordflow">if</span> (spreadLayer-&gt;IsLocked() == kFalse) {</div><div class="line"><span class="comment">// 2. Determine the bounding box of the frame.</span></div><div class="line"><a class="code" href="class_p_m_rect.html">PMRect</a> boundingBox(0, 0, 100, 100);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGeometry&gt;</a> pageGeometry(spread-&gt;QueryNthPage(0));</div><div class="line"> ::InnerToPasteboard(pageGeometry, &amp;boundingBox);</div><div class="line"><span class="comment">// 3. Create the frame.</span></div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> frameUIDRef = <a class="code" href="class_utils.html">Utils&lt;IPathUtils&gt;</a>()-&gt;CreateRectangleSpline(parentUIDRef,boundingBox, <a class="code" href="class_i_new_page_item_cmd_data.html#a3c11a4df87ce358afa1eedcebc17364aa081f08c641bf077ba9303e7ee83e3f1c">INewPageItemCmdData::kGraphicFrameAttributes</a>,kTrue, Transform::PasteboardCoordinates() );</div><div class="line">}</div></div><p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a71bbdb53e542c3320032b11bf146c0f3">SDKLayoutHelper::CreateRectangleFrame</a><li><a class="el" href="class_snp_create_frame.html">SnpCreateFrame</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></ul><p><b>Creating a path</b><p><b>Solution</b><ol type="1"><li>See <a class="el" href="id_solutions.html#id_creating_a_page_item">Creating an empty graphic frame</a> for the basic approach. Frames and paths both create spline item boss objects, <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>. The significant difference is that a graphic frame is designated as being a container for a graphics page item.<li>On calling the <a class="el" href="class_i_path_utils.html">IPathUtils</a> create spline method that creates the path you want, use attrType= INewPageItemCmdData::kGraphicAttribute to create a path.</ol><p><b>Related documentation</b><ul><li>See <a class="el" href="id_solutions.html#id_creating_a_page_item">Creating an empty graphic frame</a>.</ul><p><b>Sample Code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#aa86a0c234cb467c214d2de955e3fcabe">SDKLayoutHelper::CreateRectangleGraphic</a><li><a class="el" href="class_s_d_k_layout_helper.html#a3956a719066e628345c326d2bc82b2b4">SDKLayoutHelper::CreateSplineGraphic</a><li><a class="el" href="class_snp_create_frame.html">SnpCreateFrame</a></ul><p><b>Related API</b><ul><li>See the example in <a class="el" href="id_solutions.html#id_creating_a_page_item">Creating an empty graphic frame</a>.</ul><p><b>Creating a text frame</b><p><b>Solution</b><p>Use <a class="el" href="classk_create_multi_column_item_cmd_boss.html">kCreateMultiColumnItemCmdBoss</a>.<p><b>Sample code</b><ul><li>SDKLayoutHelper::CreatetextFrame<li><a class="el" href="class_snp_create_frame.html">SnpCreateFrame</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a><li><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></ul><h3><a class="anchor" id="id_deleting_page_items_and_their_contents"></a> Deleting page items and their contents</h3><p><b>Solution</b><p>Use <a class="el" href="classk_delete_cmd_boss.html">kDeleteCmdBoss</a>.<h3><a class="anchor" id="id_moving_page_items_from_one_spread_to_another"></a> Moving page items from one spread to another</h3><p><b>Solution</b><p>Use <a class="el" href="classk_move_to_spread_cmd_boss.html">kMoveToSpreadCmdBoss</a>.<h3><a class="anchor" id="id_moving_page_items_from_one_layer_to_another"></a> Moving page items from one layer to another</h3><p><b>Solution</b><p>To move page items of your choice between layers, use <a class="el" href="classk_move_to_layer_cmd_boss.html">kMoveToLayerCmdBoss</a>.<p>To move page items that are currently selected between layers, use <a class="el" href="class_i_layer_suite.html">ILayerSuite</a><h3><a class="anchor" id="id_copying_page_items_within_or_across_documents"></a> Copying page items within or across documents</h3><p>You can copy a page item and any nested page items it contains, either within the same document or into another document.<p><b>Solution</b><p>Use <a class="el" href="classk_copy_cmd_boss.html">kCopyCmdBoss</a>.<h3><a class="anchor" id="id_copying_page_items_to_the_clipboard"></a> Copying page items to the clipboard</h3><p><b>Solution</b><p>To copy page items of your own choice to the clipboard, use <a class="el" href="classk_copy_cmd_boss.html">kCopyCmdBoss</a>.<p>To copy page items that are currently selected to the clipboard, use <a class="el" href="class_i_scrap_suite.html#a5ab3fae821620b1695aa866a162552c8">IScrapSuite::CanCopy</a> and <a class="el" href="class_i_scrap_suite.html#aea49d21c21e7a07aa793dba25afe44da">IScrapSuite::Copy</a>.<h3><a class="anchor" id="id_pasting_page_items_from_the_clipboard"></a> Pasting page items from the clipboard</h3><p><b>Solution</b><p>To paste page items from the clipboard into a document of your choice (the spread layer that will be the parent of the pasted objects is specified by you), use <a class="el" href="classk_paste_cmd_boss.html">kPasteCmdBoss</a>.<p>To paste page items on the clipboard into a document being edited in layout view (the spread and layer that will contain the pasted objects is designated by the view&#39;s <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a>), use <a class="el" href="class_i_scrap_suite.html#a6aabc318aee3a236fb99f86ac9b5bc66">IScrapSuite::CanPaste</a> and <a class="el" href="class_i_scrap_suite.html#a745d04ea5bf287cd9560c5c8c3764b29">IScrapSuite::Paste</a>.<h3><a class="anchor" id="id_removing_page_items_from_a_hierarchy"></a> Removing page items from a hierarchy</h3><p><b>Solution</b><p>To remove one page item from its hierarchy, use <a class="el" href="class_i_hierarchy_utils.html#a0363253048845bbd79ffe426ad9f52f0">IHierarchyUtils::RemoveFromHierarchy</a>.<p>To more than one page item from its associated hierarchy, use <a class="el" href="classk_remove_from_hierarchy_cmd_boss.html">kRemoveFromHierarchyCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="class_i_hierarchy.html">IHierarchy</a></ul><h3><a class="anchor" id="id_adding_page_items_to_a_hierarchy"></a> Adding page items to a hierarchy</h3><p><b>Solution</b><p>To add one page item into a hierarchy, use <a class="el" href="class_i_hierarchy_utils.html#a12205133d8ae3f085ecd41e61b14b80c">IHierarchyUtils::AddToHierarchy</a>.<p>To add more than one page items to a hierarchy, use <a class="el" href="classk_add_to_hierarchy_cmd_boss.html">kAddToHierarchyCmdBoss</a>.<h3><a class="anchor" id="id_iterating_through_frame_content"></a> Iterating through frame content</h3><p>You can examine the content of a frame.<p><b>Solution</b><p>Query the frame for <a class="el" href="class_i_frame_type.html">IFrameType</a> to find the type of frame you have<h3><a class="anchor" id="id_finding_the_frames_in_a_spread"></a> Finding the frames in a spread</h3><p><b>Solution</b><ol type="1"><li>Call <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a> to get the page items<li>Call <a class="el" href="class_i_page_item_type_utils.html">IPageItemTypeUtils</a> to find the type of each page item, or query the page items for an <a class="el" href="class_i_frame_type.html">IFrameType</a> interface.</ol><p><b>Sample code</b><ul><li>CHMLFiltHelper::collectGraphicFrames</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_hierarchy.html">IHierarchy</a><li><a class="el" href="class_i_spread.html">ISpread</a></ul><h3><a class="anchor" id=""></a></h3><p>You may want to search/replace page items with certain graphic attributes. This section describes how to set search/replace options and find page items (objects) according to object style, frame type, and graphic attributes.<p><b>Solution</b><ol type="1"><li>Set search mode to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454aacb053f9f3b46ceec5ecd4415327dcc3">IFindChangeOptions::kObjectSearch</a>, using <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>.<li>In <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, set object type to find, using <a class="el" href="classk_object_search_type_cmd_boss.html">kObjectSearchTypeCmdBoss</a>. You can choose from all frame types, graphic frames, and unassigned frames.<li>Set search scope using <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>. The scope can be the current document, all open documents, or within the current selection. Do not forget to explicitly set the IID_IFINDCHANGEMODEDATA interface on the command bosses to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454aacb053f9f3b46ceec5ecd4415327dcc3">IFindChangeOptions::kObjectSearch</a> search mode.<li>Choose an object style to search, and prepare an attribute boss list to store graphic attributes that your found page item should have. Then, set the find object style and find attribute list using <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>.<li>Perform a search by creating <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> and calling <a class="el" href="class_i_find_change_service.html#a88b11db8c41fc6b38d62eee31f4f639b">IFindChangeService::SearchObject()</a>.</ol><p><b>Sample code</b><ul><li>SnpFindAndReplace::Do_FindObject</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> maintains all find/change options.<li><a class="el" href="class_i_find_change_service.html">IFindChangeService</a> on <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> provides find/change object services.<li>Commands: <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>, <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>, <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>, and kFindObjectBoss.</ul><h3><a class="anchor" id=""></a></h3><p>After finding an object, you may want to replace it with new attributes or replace and find the next object. You also may want to find objects with specific attributes and replace them with new attributes. This section describes how to set search/replace options and replace page items (objects) according to both search/replace object style and graphic attributes.<p><b>Solution</b><p>Replacing shares most steps with searching. The following are the steps to set up options and perform search and replace.<ol type="1"><li>Set search mode to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454aacb053f9f3b46ceec5ecd4415327dcc3">IFindChangeOptions::kObjectSearch</a>, using <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>.<li>In <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, set object type to find, using <a class="el" href="classk_object_search_type_cmd_boss.html">kObjectSearchTypeCmdBoss</a>. You can choose from all frame types, graphic frames, and unassigned frames.<li>Set search scope using <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>. The scope can be current document, all open documents, or within current selection. Remember to explicitly set the IID_IFINDCHANGEMODEDATA interface on the command bosses to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454aacb053f9f3b46ceec5ecd4415327dcc3">IFindChangeOptions::kObjectSearch</a> search mode.<li>Choose an object style to search and prepare an attribute boss list to store graphic attributes that your resulting page item should have. Then, set the find object style and find attribute list using <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>.<li>Choose an object style to replace, and prepare an attribute boss list to store graphic attributes that your resulting page item should have. Then, set the change object style and change attribute list using <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>. You may combine this step with the previous step to the command is processed only once.<li>Perform a search by creating <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a>. Depending on what you want to do with the found object(s), call <a class="el" href="class_i_find_change_service.html#a7a54bc0eeff1edf474af8e7dff01a206">IFindChangeService::ReplaceObject()</a>, ReplaceAndSearchObject(), or ReplaceAllObject().</ol><p><b>Sample code</b><ul><li>SnpFindAndReplace::Do_ReplaceObject</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> maintains all find/change options.<li><a class="el" href="class_i_find_change_service.html">IFindChangeService</a> on <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> provides find/change object services.<li>Commands: <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>, <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>, <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>, <a class="el" href="classk_replace_object_cmd_boss.html">kReplaceObjectCmdBoss</a>, <a class="el" href="classk_replace_find_object_cmd_boss.html">kReplaceFindObjectCmdBoss</a>, and <a class="el" href="classk_replace_all_object_cmd_boss.html">kReplaceAllObjectCmdBoss</a>.</ul><h2><a class="anchor" id="id_guides_and_grids"></a> Guides and grids</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_a_ruler_guide"></a> Acquiring a reference to a ruler guide</h3><p><b>Solution</b><p>A ruler (<a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>) is characterized by the <a class="el" href="class_i_guide_data.html">IGuideData</a> interface. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> that can instantiate an <a class="el" href="class_i_guide_data.html">IGuideData</a> interface is a ruler guide.<p>Follow these steps:<ol type="1"><li>Acquire a reference to the spread containing the ruler guides (see &quot;Acquiring a reference to a spread&quot;). If you are starting from a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>), find the spread that owns the page, then examine the spread layers that store guides as described below<li>To get the guide spread layers, call <a class="el" href="class_i_spread.html#a48e0c4d322acbd18f94ad694709630c0">ISpread::QueryLayer</a> with wantGuideLayer set to kTrue.<li>Examine the child objects on the spread layer&#39;s <a class="el" href="class_i_hierarchy.html">IHierarchy</a>. These are ruler guides.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></ul><h3><a class="anchor" id="id_creating_a_ruler_guide"></a> Creating a ruler guide</h3><p><b>Solution</b><p>Use <a class="el" href="classk_new_guide_cmd_boss.html">kNewGuideCmdBoss</a>.<p>Ruler guide properties are given by the <a class="el" href="class_i_guide_data.html">IGuideData</a> interface on <a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>. When you are creating a ruler guide, you specify the coordinates in their parent&#39;s space, normally spread coordinate space.<p><b>Sample code</b><p>The following example demonstrates how to create a vertical ruler guide item on the first page of the active spread. For code simplicity, error checking is omitted. <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILayoutControlData&gt;</a> layoutData(<a class="code" href="class_utils.html">Utils&lt;ILayoutUtils&gt;</a>()-&gt;QueryFrontLayoutData());</div><div class="line"><span class="comment">// Get the active document layer</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocumentLayer&gt;</a> docLayer(layoutData-&gt;QueryActiveDocLayer());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpread&gt;</a> spread(layoutData-&gt;GetSpread(), IID_ISPREAD);</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* db = ::GetDataBase(spread);</div><div class="line"><span class="comment">// Get the guide spread layer for the active spread.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadLayer&gt;</a> spreadLayer(spread-&gt;QueryLayer(docLayer, nil, kTrue));</div><div class="line"><span class="comment">// The parent for the new guide is the guide spread layer.</span></div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> parent = ::GetUID(spreadLayer);<a class="code" href="class_u_i_d_ref.html">UIDRef</a> parentUIDRef(db, parent);</div><div class="line"><span class="comment">// Get the first page UID. ownerUID is a page for short guides.</span></div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> ownerUID = spread-&gt;GetNthPageUID(0);</div><div class="line"><span class="comment">// Note: The parent for the guide we are to create is the spread. Each </span></div><div class="line"><span class="comment">// page owns its guides. We need to convert the guide coordinates</span></div><div class="line"><span class="comment">// to its parent space - spread space. </span></div><div class="line"><span class="comment">// Get the bounding box of the page in spread space.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGeometry&gt;</a> geometry(db, ownerUID, IID_IGEOMETRY);</div><div class="line"><a class="code" href="class_p_m_rect.html">PBPMRect</a> bBox = geometry-&gt;GetStrokeBoundingBox(::InnerToParentMatrix(geometry));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> newGuideCmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_new_guide_cmd_boss.html">kNewGuideCmdBoss</a>));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;INewGuideCmdData&gt;</a> newGuideCmdData(newGuideCmd, IID_INEWGUIDECMDDATA);</div><div class="line"><span class="comment">// The distance the guide is located at.</span></div><div class="line"><a class="code" href="class_p_m_real.html">PMReal</a> distance = bBox.<a class="code" href="class_p_m_rect.html#acbb534b95ac9fcda3c77a62b6265ba96">Left</a>() + bBox.<a class="code" href="class_p_m_rect.html#ad42f4b42e84a5341c1c70b3059e52e58">GetHCenter</a>();</div><div class="line"><span class="comment">// Get the default guide preference </span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGuidePrefs&gt;</a> iGuideDefault((<a class="code" href="class_i_guide_prefs.html">IGuidePrefs</a>*)::QueryPreferences(IID_IGUIDEPREFERENCES, kGetFrontmostPrefs));</div><div class="line"><span class="comment">// Get the guide threshold and the color index</span></div><div class="line"><a class="code" href="class_p_m_real.html">PMReal</a> guideThreshold = iGuideDefault-&gt;GetGuidesThreshold();</div><div class="line">int32 guideColorIndex = iGuideDefault-&gt;GetGuidesColorIndex();</div><div class="line">newGuideCmdData-&gt;Set(parentUIDRef, kFalse, distance, ownerUID, kTrue, guideThreshold, guideColorIndex);</div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(newGuideCmd) != kSuccess)</div><div class="line"><span class="comment">// Report process command failure.</span></div></div><p><b>Related APIs</b><ul><li><a class="el" href="class_i_guide_data.html">IGuideData</a><li><a class="el" href="class_i_guide_prefs.html">IGuidePrefs</a><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a><li><a class="el" href="classk_new_guide_cmd_boss.html">kNewGuideCmdBoss</a></ul><h3><a class="anchor" id="id_deleting_a_ruler_guide"></a> Deleting a ruler guide</h3><p><b>Solution</b><p>Use <a class="el" href="classk_delete_cmd_boss.html">kDeleteCmdBoss</a>.<h3><a class="anchor" id="id_moving_a_ruler_guide"></a> Moving a ruler guide</h3><p><b>Solution</b><p>To move the guide relative to its current position, use <a class="el" href="classk_move_guide_relative_cmd_boss.html">kMoveGuideRelativeCmdBoss</a>.<p>To move the guide to an absolute position, use <a class="el" href="classk_move_guide_absolute_cmd_boss.html">kMoveGuideAbsoluteCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></ul><h3><a class="anchor" id="id_changing_the_color_view_threshold_or_orientation_of_ruler_guides"></a> Changing the color, view threshold, or orientation of ruler guides</h3><p><b>Solution</b><p>To change the color of a ruler guide, process the command created by calling IGuideUtils::MakeChangeColorGuideCmd.<p>To change the view threshold of a ruler guide, use <a class="el" href="classk_set_guide_view_threshold_cmd_boss.html">kSetGuideViewThresholdCmdBoss</a>.<p>To change the horizontal or vertical orientation of a ruler guide, use <a class="el" href="classk_set_guide_orientation_cmd_boss.html">kSetGuideOrientationCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></ul><h3><a class="anchor" id="id_showing_and_hiding_guides"></a> Showing and hiding guides</h3><p><b>Solution</b><p>To show or hide all guides, use <a class="el" href="classk_set_guide_prefs_cmd_boss.html">kSetGuidePrefsCmdBoss</a>.<p>To show or hide ruler guides associated with a specific layer, use <a class="el" href="classk_show_guide_layer_cmd_boss.html">kShowGuideLayerCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></ul><h3><a class="anchor" id="id_locking_and_unlocking_guides"></a> Locking and unlocking guides</h3><p><b>Solution</b><p>To lock or unlock all guides, use <a class="el" href="classk_set_guide_prefs_cmd_boss.html">kSetGuidePrefsCmdBoss</a>.<p>To lock or unlock ruler guides associated with a specific layer, use <a class="el" href="classk_lock_guide_layer_cmd_boss.html">kLockGuideLayerCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></ul><h3><a class="anchor" id="id_turning_snap_to_guides_on_and_off"></a> Turning snap to guides on and off</h3><p><b>Solution</b><p>Use <a class="el" href="classk_set_snap_to_prefs_cmd_boss.html">kSetSnapToPrefsCmdBoss</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></ul><h3><a class="anchor" id="id_getting_notified_of_guide_and_grid_operations"></a> Getting notified of guide and grid operations</h3><p><b>Solution</b><ol type="1"><li>Determine the command that is making the change in which you are interested.<li>See the API documentation page for that command.<li>Attach an observer to the subject changed by that command.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_observer.html">IObserver</a><li><a class="el" href="class_i_subject.html">ISubject</a></ul><h2><a class="anchor" id="id_layout_windows_and_layout_views"></a> Layout windows and layout views</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_a_layout_window"></a> Acquiring a reference to a layout window</h3><p><b>Solution</b><p>If you have a reference to a document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>), use <a class="el" href="class_i_presentation_list.html">IPresentationList</a> on <a class="el" href="classk_doc_boss.html">kDocBoss</a> to get the windows (<a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a>) that are open on a document (see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_layer">Acquiring a reference to a document</a>).<p>If you have an <a class="el" href="class_i_active_context.html">IActiveContext</a> interface, use IActiveContext::GetContextView to get the layout view associated with the context. From there, code like that in the following example gives the layout window:<p>This example shows how to navigate from Layout View to Layout Window via <a class="el" href="class_i_widget_parent.html">IWidgetParent</a>: <div class="fragment"><div class="line"><span class="comment">// If you have a reference to a layout view (kLayoutWidgetBoss) the</span></div><div class="line"><span class="comment">// code below will find the associated layout window:</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWidgetParent&gt;</a> widgetParent(layoutView, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWindow&gt;</a> myWindow((<a class="code" href="class_i_window.html">IWindow</a>*)widgetParent-&gt;QueryParentFor(IWindow::kDefaultIID));</div></div><p>To work with the window displaying the document that the user is editing, use <a class="el" href="class_i_layout_u_i_utils.html#a46a9844fadf519764929cedd9f455480">ILayoutUIUtils::QueryFrontView</a> to get the layout view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) of the front document. See the example for the code that then gets the layout window.<p>To hit test for a layout window or iterate through windows on a document, use <a class="el" href="class_i_document_u_i_utils.html">IDocumentUIUtils</a>.<p><b>Related API</b><ul><li><a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a></ul><h3><a class="anchor" id="id_opening_a_layout_window_on_a_document"></a> Opening a layout window on a document</h3><p><b>Solution</b><p>Use <a class="el" href="classk_open_layout_cmd_boss.html">kOpenLayoutCmdBoss</a>.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_opening_an_existing_document">Opening an existing document</a></ul><p><b>Sample Code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a407281384d8c09056c86839987e5c15e">SDKLayoutHelper::OpenLayoutWindow</a></ul><h3><a class="anchor" id="id_closing_a_layout_window"></a> Closing a layout window</h3><p><b>Solution</b><p>Use kCloseLayoutCmdBoss.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_closing_a_document">Closing a document</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a></ul><h3><a class="anchor" id="id_iterating_through_open_layout_windows"></a> Iterating through open layout windows</h3><p><b>Solution</b><ol type="1"><li>Use <a class="el" href="class_i_document_list.html">IDocumentList</a> to list the documents that are open in the application. See <a class="el" href="id_solutions.html#id_iterating_through_documents">Iterating through documents</a>.<li>Use <a class="el" href="class_i_presentation_list.html">IPresentationList</a> on each document to list the windows open on it.</ol><p><b>Related API</b><ul><li><a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a></ul><h3><a class="anchor" id="id_acquiring_a_reference_to_a_layout_view"></a> Acquiring a reference to a layout view</h3><p><b>Solution</b><p>If you have an <a class="el" href="class_i_active_context.html">IActiveContext</a> interface, use IActiveContext::GetContextView.<p>If you have a layout window (<a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a>) reference, use <a class="el" href="class_i_panel_control_data.html#aa9dde6f0ce56f041ddcd08b4dbc86287">IPanelControlData::FindWidget</a>. Call with widgetId=<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) to get the window&#39;s layout view.<p>To work with the layout view that is editing the document:<ol type="1"><li>Use <a class="el" href="class_i_layout_u_i_utils.html#a46a9844fadf519764929cedd9f455480">ILayoutUIUtils::QueryFrontView</a> to get the layout view of the front document.<li>Use <a class="el" href="class_i_layout_u_i_utils.html#a3c10226d6bbf34506baf26d7792cac64">ILayoutUIUtils::QueryFrontLayoutData</a> to get the <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a> interface for the layout view of the front document.</ol><p><b>Related API</b><ul><li><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></ul><h3><a class="anchor" id="id_setting_the_spread_targeted_for_edit_operations"></a> Setting the spread targeted for edit operations</h3><p><b>Solution</b><p>Use <a class="el" href="classk_set_spread_cmd_boss.html">kSetSpreadCmdBoss</a>.<p><b>Sample Code</b><ul><li><a class="el" href="class_bsc_d_n_d_custom_flavor_helper.html#a3bc0598109e63b177c44b93da967e416">BscDNDCustomFlavorHelper::ProcessDragDropCommand</a><li>SnapTracker::CreateAndProcessSetSpreadCmd</ul><p><b>Related APIs</b><ul><li>ILayoutControlData::GetSpread<li>IID_ICURRENTSPREAD on <a class="el" href="classk_doc_boss.html">kDocBoss</a></ul><h3><a class="anchor" id="id_setting_the_page_viewed_in_a_layout_window"></a> Setting the page viewed in a layout window</h3><p><b>Solution</b><ol type="1"><li>Get the <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a> interface of the layout view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>).<li>Process <a class="el" href="classk_set_page_cmd_boss.html">kSetPageCmdBoss</a>.</ol><dl class="section note"><dt>Note<dd>The page being viewed is not stored anywhere. It is calculated each time <a class="el" href="class_i_layout_control_data.html#a2ecb5508c566a401c98aa3aee651bc2b">ILayoutControlData::GetPage</a> is called, by finding the page whose center point is closest to the center of the view.</dl><p><b>Related APIs</b><ul><li><a class="el" href="class_i_layout_control_data.html#a2ecb5508c566a401c98aa3aee651bc2b">ILayoutControlData::GetPage</a><li><a class="el" href="class_i_layout_u_i_utils.html#a1cccc207aa0b555ec0f6e37b3f089959">ILayoutUIUtils::GetVisiblePageUID</a><li><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></ul><h3><a class="anchor" id="id_fitting_a_spread_or_page_in_a_layout_window"></a> Fitting a spread or page in a layout window</h3><p><b>Solution</b><p>To fit a spread in a layout view:<ol type="1"><li>Follow the steps described in <a class="el" href="id_solutions.html#id_setting_the_spread_targeted_for_edit_operations">Setting the spread targeted for edit operations</a>.<li>Create a zoom command using <a class="el" href="class_i_layout_u_i_utils.html#a8a24bbabf440eea15a62120fa7229fb1">ILayoutUIUtils::MakeZoomCmd</a> with fit = ILayoutControlData::kFitSpread.<li>Run the zoom command.</ol><p>To fit a page in a layout view:<ol type="1"><li>Follow the steps described in <a class="el" href="id_solutions.html#id_setting_the_page_viewed_in_a_layout_window">Setting the page viewed in a layout window</a>.<li>Create a zoom command using <a class="el" href="class_i_layout_u_i_utils.html#a8a24bbabf440eea15a62120fa7229fb1">ILayoutUIUtils::MakeZoomCmd</a> with fit = ILayoutControlData::kFitPage.<li>Run the zoom command.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a><li><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></ul><h3><a class="anchor" id="id_setting_the_zoom_for_the_layout_window"></a> Setting the zoom for the layout window</h3><p>You can increase or decrease the magnification applied by the window.<p><b>Solution</b><p>Process one of the zoom-related commands created by <a class="el" href="class_i_layout_u_i_utils.html">ILayoutUIUtils</a>; for example, <a class="el" href="class_i_layout_u_i_utils.html#a8a24bbabf440eea15a62120fa7229fb1">ILayoutUIUtils::MakeZoomCmd</a>.<h1><a class="anchor" id="id_text"></a> Text</h1><h2><a class="anchor" id="id_getting_started"></a> Getting started</h2><p>This chapter presents text-related use cases. To learn about how text layout is organized, do the following:<ul><li>Run through the activities in&quot;Exploring text with SnippetRunner&quot;, to learn how to explore text and familiarize yourself with fundamental text-Sample Code.<li>Read the &quot;Text Fundamentals&quot; chapter in Adobe InDesign&reg; Programming Guide.</ul><p>To solve a text-related programming problem, do the following:<ul><li>Look in this document for a use case that matches your problem.<li>As references, see the API reference documentation and the &quot;Text Fundamentals&quot; chapter mentioned above.</ul><h3><a class="anchor" id="id_exploring_text_with_snippetrunner"></a> Exploring text with SnippetRunner</h3><p>SnippetRunner is a plug-in that lets you run code snippets provided on the SDK. Several code snippets are provided that let you explore the text-related objects in a document.<p><b>Solution</b><ol type="1"><li>Run InDesign with the SnippetRunner plug-in present. For instructions on using the plug-in, see the API documentation page for SnippetRunner.<li>Browse the sample code in the snippets you have been running.</ol><p><b>Sample code</b><ul><li>BscShpHandleShape::DrawLabelHandles in sample basic shape on the SDK<li><a class="el" href="class_c_h_m_l_filt_text_helper.html">CHMLFiltTextHelper</a> in sample chmlfilter<li>SingleLineComposer<li><a class="el" href="class_snp_apply_text_style_attributes.html">SnpApplyTextStyleAttributes</a><li><a class="el" href="class_snp_apply_text_style_attributes.html#a44db8a4f1e8b9530d5e771422d18e0b2">SnpApplyTextStyleAttributes::ApplyFontVariant</a><li><a class="el" href="class_snp_create_frame.html">SnpCreateFrame</a><li><a class="el" href="class_snp_estimate_text_depth.html">SnpEstimateTextDepth</a><li><a class="el" href="class_snp_insert_glyph.html">SnpInsertGlyph</a><li><a class="el" href="class_snp_inspect_font_mgr.html">SnpInspectFontMgr</a><li><a class="el" href="class_snp_inspect_text_model.html">SnpInspectTextModel</a><li><a class="el" href="class_snp_inspect_text_styles.html">SnpInspectTextStyles</a><li><a class="el" href="class_snp_manipulate_inline.html">SnpManipulateInline</a><li><a class="el" href="class_snp_manipulate_text_footnotes.html">SnpManipulateTextFootnotes</a><li><a class="el" href="class_snp_manipulate_text_model.html">SnpManipulateTextModel</a><li><a class="el" href="class_snp_manipulate_text_on_path.html">SnpManipulateTextOnPath</a><li><a class="el" href="class_snp_manipulate_text_style.html">SnpManipulateTextStyle</a><li><a class="el" href="class_snp_manipulate_text_frame.html">SnpManipulateTextFrame</a><li><a class="el" href="class_snp_perform_comp_font.html">SnpPerformCompFont</a><li><a class="el" href="class_snp_perform_font_group_iterator.html">SnpPerformFontGroupIterator</a><li>SnpPerformTextAttr*<li>SnpTextAttrHelper</ul><p><b>Related APIs</b><p>Related APIs and their descriptions<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_composite_font.html">ICompositeFont</a></td><td>Represents a composite font. </td></tr><tr><td><a class="el" href="class_i_doc_font_mgr.html">IDocFontMgr</a></td><td>Represents the persistent fonts in the session or document. </td></tr><tr><td><a class="el" href="class_i_document_font_usage.html">IDocumentFontUsage</a></td><td>Provides a shell around <a class="el" href="class_i_used_font_list.html">IUsedFontList</a> and <a class="el" href="class_i_font_names.html">IFontNames</a>. </td></tr><tr><td><a class="el" href="class_facade_1_1_i_text_wrap_facade.html">Facade::ITextWrapFacade</a></td><td>Provides high-level APIs for dealing with text wrap. </td></tr><tr><td><a class="el" href="class_i_font_family.html">IFontFamily</a></td><td>Represents a group of related styles of fonts. </td></tr><tr><td><a class="el" href="class_i_font_group.html">IFontGroup</a></td><td>(Not derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>) represents a font family within cooltype. </td></tr><tr><td><a class="el" href="class_i_font_instance.html">IFontInstance</a></td><td>(Not derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>) is an instance of a cooltype font, characterized by a particular font size. </td></tr><tr><td><a class="el" href="class_i_font_mgr.html">IFontMgr</a></td><td>Provides access to the CoolType font wrappers in the session. </td></tr><tr><td><a class="el" href="class_i_font_names.html">IFontNames</a></td><td>Allows access to the set of fonts on which a placed asset (PDF or EPS) depends. </td></tr><tr><td><a class="el" href="class_i_frame_content_suite.html">IFrameContentSuite</a> and facade::IFrameContentFacade </td><td>Convert a page item to a container for text and manipulate the size of the page item relative to the text content. </td></tr><tr><td><a class="el" href="class_i_frame_list.html">IFrameList</a></td><td>Provides a list of containers (frames) used to display the text from a single story. </td></tr><tr><td><a class="el" href="class_i_hierarchy.html">IHierarchy</a></td><td>Defines the relations of the containers within the document. </td></tr><tr><td><a class="el" href="class_i_missing_font_signal_data.html">IMissingFontSignalData</a></td><td>Provides the context for missing font responders. </td></tr><tr><td><a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a></td><td>Provides access to the associated story, frame list, and the range of text displayed. </td></tr><tr><td><a class="el" href="class_i_parcel.html">IParcel</a></td><td>Represents an area within a frame into which some subtext for a story can flow; for example, a table cell or story footnote. </td></tr><tr><td><a class="el" href="class_i_parcel_list.html">IParcelList</a></td><td>Represents a set of parcels into which some subtext for a story can flow; for example, footnotes that span multiple page items. </td></tr><tr><td><a class="el" href="class_i_p_m_font.html">IPMFont</a></td><td>(Not derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>) represents a single font within cooltype. </td></tr><tr><td><a class="el" href="class_i_text_attr_font.html">ITextAttrFont</a></td><td>Represents the text attribute defining the font applied to text. </td></tr><tr><td><a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a></td><td>Represents the capabilities and functionality that can be applied to the formatting of selected text. </td></tr><tr><td><a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a> x </td><td>Represents the capabilities and functionality that can be applied to the formatting of selected text. </td></tr><tr><td><a class="el" href="class_i_text_frame_options_suite.html">ITextFrameOptionsSuite</a></td><td>Provides the ability to access and manipulate text frame options (like number of columns or gutter width) on the session workspace, document workspace, or a set of text containers. </td></tr><tr><td><a class="el" href="class_i_text_model.html">ITextModel</a></td><td>Represents a story within the document. </td></tr><tr><td><a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a></td><td>Provides prepackaged commands that modify a text story. </td></tr><tr><td><a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a></td><td>Provides the relationship between the rendered text (known as the wax) in a parcel list and the parcel list. </td></tr><tr><td><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a></td><td>Represents capabilities and functions that can be applied to selected text. </td></tr><tr><td><a class="el" href="class_i_text_utils.html">ITextUtils</a></td><td>Provides higher level APIs to modify and access text content. </td></tr><tr><td><a class="el" href="class_i_used_font_list.html">IUsedFontList</a></td><td>Represents fonts used within text frames. </td></tr><tr><td><a class="el" href="class_i_wax_strand.html">IWaxStrand</a></td><td>Represents the final rendered text. It provides an iterator (<a class="el" href="class_i_wax_strand.html#aaf6fe3d7553e9a059764e4a295c8f4d3">IWaxStrand::NewWaxIterator</a>) that allows the individual lines of rendered text (wax) to be accessed. </td></tr></table><h2><a class="anchor" id="id_stories"></a> Stories</h2><p>A text story represents a single body of textual content within the application. It encompasses the raw text and formatting applied to this text; it can be viewed as a container for all this information. This section describes common use cases when working with text stories.<p>For more information see the &quot;Text Fundamentals&quot; chapter in Adobe InDesign Programming Guide.<h3><a class="anchor" id="id_accessing_the_stories_in_a_document"></a> Accessing the stories in a document</h3><p>A document can contain zero or more stories. You can access the set of stories contained in a single document.<p><b>Solution</b><p>A document is represented by the <a class="el" href="classk_doc_boss.html">kDocBoss</a> boss class.<p><a class="el" href="class_i_story_list.html">IStoryList</a> on <a class="el" href="classk_doc_boss.html">kDocBoss</a> maintains the stories contained within a document. A document can contain stories purely for internal use.<p>Use <a class="el" href="class_i_story_list.html#a636f3b4d96ce0ad13f94d649a98fae51">IStoryList::GetUserAccessibleStoryCount</a> and <a class="el" href="class_i_story_list.html#ac538f8c5008b1eb6a47aabc1cba32f54">IStoryList::GetNthUserAccessibleStoryUID</a> to identify and access the user-accessible stories in a document.<p>Use <a class="el" href="class_i_story_list.html#a6bf9e766ac8fa52808eadb98fe16b83f">IStoryList::GetAllTextModelCount</a> and <a class="el" href="class_i_story_list.html#a9795e0a43db861f4e6847257e2e7a41b">IStoryList::GetNthTextModelUID</a> to access all stories in a document.<p>Use <a class="el" href="class_i_story_list.html#a7653bbcded985653565585847fd6a01d">IStoryList::GetNthTextModelAccess</a> to test whether a particular story is user accessible.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_text_model.html#a6a9244abb3f89d1837bad894e61fbc15">SnpInspectTextModel::ReportStories</a></ul><h3><a class="anchor" id="id_accessing_the_stories_under_the_current_focus"></a> Accessing the stories under the current focus</h3><p>You can get the story that maintains the current text focus.<p><b>Solution</b><p>When dealing with a selection, you need to implement a selection extension pattern, which allows you to participate in the selection subsystem. As part of this extension pattern, you provide an add-in implementation of a concrete selection interface on the <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a> (and associated add-in implementation of an abstract selection interface on the <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>). For details on implementing this extension pattern, see the &quot;Selection&quot; chapter of Adobe InDesign Plug-in Programming Guide.<p>Use <a class="el" href="class_i_selection_utils.html#af710ece9449e7c801bdc89e684e970aa">ISelectionUtils::GetActiveSelection</a> to obtain your abstract selection, which can then provide access to the concrete selection.<p><a class="el" href="class_i_text_target.html">ITextTarget</a> (on <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>) resides on the same boss class as your selection.<p>Use <a class="el" href="class_i_text_target.html#abe90189bfb9e72d6452176ccd20b83de">ITextTarget::QueryTextModel</a> to get the text model for the selection. This interface provides other information about the text selection, like its range.<p>To manipulate the model through the selection, add a new suite interface onto the <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a> class. This provides the mechanism required to keep actual selection types separate from the selection architecture. For an example, see the use of the interface <a class="el" href="class_i_data_updater_suite.html">IDataUpdaterSuite</a> in the XmlDataUpdater plug-in.<h3><a class="anchor" id="id_accessing_a_story_given_a_page_item"></a> Accessing a story, given a page item</h3><p>You can get from a page item to (potentially) the text story representing the text it contains.<p><b>Solution</b><p>Use <a class="el" href="class_i_text_utils.html#a1398d52b2560173c879eafbd3f47d66f">ITextUtils::GetSelectedTextItemsFromUIDList</a> on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> to extract text item entities from a list of UID items. Specifying a nonnil <a class="el" href="class_u_i_d_list.html">UIDList</a> for either of the out parameters causes the associated <a class="el" href="class_u_i_d_list.html">UIDList</a> to be populated with the set of page items containing text.<p><a class="el" href="class_i_graphic_frame_data.html#a715f37ce0d0a70bdea98b8a53e297534">IGraphicFrameData::GetTextContentUID</a> (the interface is on the page item) provides kInvalidUID if the page item is not a text container. This more direct approach is more effective if you are interested only in whether the page item contains text, rather than getting access to the text.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html">SnpManipulateTextFrame</a></ul><h3><a class="anchor" id="id_creating_a_story"></a> Creating a story</h3><p>You can create a story programmatically.<p><b>Solution</b><p>Stories are rarely created directly. Normally, they are created as a side effect of creating a text frame.<p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a0a8d0fb2f115bdb9878c4f14b32b3c4e">SDKLayoutHelper::CreateTextFrame</a></ul><p><b>Related APIs</b><ul><li>The <a class="el" href="classk_new_story_cmd_boss.html">kNewStoryCmdBoss</a> command creates a new story. It is unlikely you will have to use this command directly.<li>The <a class="el" href="classk_create_multi_column_item_cmd_boss.html">kCreateMultiColumnItemCmdBoss</a> command creates a text frame (and the associated story).</ul><h3><a class="anchor" id="id_deleting_a_story"></a> Deleting a story</h3><p>You can delete a story programmatically.<p><b>Solution</b><p>Stories are rarely deleted directly. Normally, a story is deleted as a side effect of deleting the last text frame item that displays its text.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#a4e11c5ac9ea9ced775a1ced8fa62e9b2">SnpManipulateTextFrame::DeleteTextFrame</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_delete_story_cmd_boss.html">kDeleteStoryCmdBoss</a> deletes a text story. It is unlikely you will have to use this command directly.</ul><h3><a class="anchor" id="id_detecting_when_stories_are_created"></a> Detecting when stories are created</h3><p>You can invoke your code on story creation.<p><b>Solution</b><p>Implement a responder extension pattern. Specifically, a custom implementation of <a class="el" href="class_i_responder.html">IResponder</a> is required (indicating a service ID of kNewStorySignalResponderService). To implement the responder, use the <a class="el" href="class_c_responder.html">CResponder</a> helper implementation.<p>The extension pattern requires an implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The API provides an implementation; the implementation ID is kNewStorySignalRespServiceImpl.<p>When the responder is called, query the <a class="el" href="class_i_signal_mgr.html">ISignalMgr</a> parameter for the <a class="el" href="class_i_new_story_signal_data.html">INewStorySignalData</a> interface. This interface provides access to the command that created the story and the underlying text model. Set the global error state from within the respond, to suppress story creation.<h3><a class="anchor" id="id_detecting_when_stories_are_deleted"></a> Detecting when stories are deleted</h3><p>You can get called when a story is deleted.<p><b>Solution</b><p>Implement a responder extension pattern. Specifically, a custom implementation of <a class="el" href="class_i_responder.html">IResponder</a> is required (indicating a service ID of kDeleteStoryRespService). To implement the responder, use the <a class="el" href="class_c_responder.html">CResponder</a> helper implementation.<p>The extension pattern requires an implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The API provides an implementation; the implementation ID being kDeleteStoryRespServiceImpl.<p>When the responder is called, query the <a class="el" href="class_i_signal_mgr.html">ISignalMgr</a> interface for the command (<a class="el" href="class_i_command.html">ICommand</a>) invoked for the delete operation. Set the global error state, to suppress the story deletion.<h3><a class="anchor" id="id_navigating_from_the_story_text_model_to_a_strand"></a> Navigating from the story (text model) to a strand</h3><p>You can get from the text model (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>, the main boss class that represents a story) to a particular strand. Strands are a low-level abstraction; there are higher level APIs that allow you to accomplish most tasks.<p><b>Solution</b><p>You can get a particular strand from the text model (<a class="el" href="class_i_text_model.html">ITextModel</a>) interface on the text story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), using <a class="el" href="class_i_text_model.html#a3f42011559afffe4df8179e1e39d7d77">ITextModel::QueryStrand</a>.<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_inspect_text_model.html#a80f40153654078ad42639cff0e9b4df6">SnpInspectTextModel::CountStoryOwnedItems</a> for an example of moving from the story (kTextModelBoss) to the owned item strand (<a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>).<li>The SnpManipulateTextStyle::CreateParaStyle sample shows how to navigate from the story (kTextModelBoss) to the character (<a class="el" href="classk_para_attr_strand_boss.html">kParaAttrStrandBoss</a>) and paragraph (<a class="el" href="classk_char_attr_strand_boss.html">kCharAttrStrandBoss</a>) attribute strands.</ul><p><b>Related API</b><ul><li>See <a class="el" href="class_i_strand.html">IStrand</a>, the signature interface for a story strand.</ul><h2><a class="anchor" id="id_story_text"></a> Story text</h2><p>Many operations require working on the raw text in a story; for example, spell checking, find/replace, and word count. This section includes use cases that deal purely with the text of a story.<p>For details, see the &quot;Text Fundamentals&quot; chapter of Adobe InDesign Programming Guide.<p>For related APIs, see the following:<ul><li><a class="el" href="class_i_text_model.html">ITextModel</a> on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> is the signature interface for the story abstraction within the application.<li><a class="el" href="class_i_story_list.html">IStoryList</a> on <a class="el" href="classk_doc_boss.html">kDocBoss</a> maintains all stories in the document.</ul><h3><a class="anchor" id="id_accessing_a_storys_raw_text_content"></a> Accessing a story&#39;s raw text content</h3><p>You can access the raw content (the body of characters) of a text story.<p><b>Solution</b><p>Use text iterators to access the raw content of a story. For an example, see <a class="el" href="class_snp_text_model_helper.html#a877c4d60de9b2e07839991a923ea5290">SnpTextModelHelper::GetWideStringFromTextRange</a>.<p>The compose scanner (<a class="el" href="class_i_compose_scanner.html">IComposeScanner</a>) on the story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) supports the CopyText method. For an example of its use, see SnpManipulateTextFootnotes::GetStoryThreadContents.<h3><a class="anchor" id="id_counting_the_paragraphs_in_a_story"></a> Counting the paragraphs in a story</h3><p>You can calculate the number of paragraphs in a story.<p><b>Solution</b><p>The <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> interface, available on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>, has a method (FindSurroundingParagraph) that determines the extent of each paragraph in the story. It can be used to scan a story, counting the paragraphs.<p>You can use a similar technique with the low-level <a class="el" href="class_i_strand.html">IStrand</a> interface on the paragraph attribute stand (<a class="el" href="classk_para_attr_strand_boss.html">kParaAttrStrandBoss</a>) For each paragraph, a run exists on the <a class="el" href="class_i_strand.html">IStrand</a> interface on the paragraph attribute strand (<a class="el" href="classk_para_attr_strand_boss.html">kParaAttrStrandBoss</a>). The number of runs is equal to the number of paragraphs. Iterate using <a class="el" href="class_i_strand.html#a98cd8afb45cc99cd99f003200c331c2d">IStrand::GetRunLength</a> on all runs in the strand.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_text_model.html#a26667da6b7c05ad876ee67e0d0777d61">SnpInspectTextModel::ReportParagraphs</a></ul><h3><a class="anchor" id="id_counting_the_words_in_a_story"></a> Counting the words in a story</h3><p>You can calculate the number of words in a story.<p><b>Solution</b><p>The <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> interface, available on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>, has a method (FindSurroundingWord) that determine the extent of each word in the story. It can be used to scan across a story, counting the words.<h3><a class="anchor" id="id_inserting_text_into_a_story"></a> Inserting text into a story</h3><p>You can insert text into a story, using text commands or via a text selection.<p><b>Solution</b><p>If there is a valid text selection, use <a class="el" href="class_i_text_edit_suite.html#a994cf384634c5b97af0f3270bd19e3ac">ITextEditSuite::InsertText</a> (after testing <a class="el" href="class_i_text_edit_suite.html#a3d3c08f58f654f08857c8e31561e19b6">ITextEditSuite::CanEditText</a> to determine whether the operation is allowed).<p>To insert characters at an arbitrary position in a story, use the command generated by <a class="el" href="class_i_text_model_cmds.html#a2e037f97b81a2fa59150fed490b38a5e">ITextModelCmds::InsertCmd</a>. <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a> is available on the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>. Use the ITextModel::IsModelLocked method to test whether a lock exists on the text model.<p>Put the inserted data into a reference counted K2::shared_ptr with type <a class="el" href="class_wide_string.html">WideString</a>, and pass it into the InsertCmd, so the memory occupied by the data is purged when no one is referencing it. For more information, see <a class="el" href="_k2_smart_ptr_8h_source.html">K2SmartPtr.h</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_model.html#a18ae8fc85ae0cdab1532d6b302ca2940">SnpManipulateTextModel::InsertText</a></ul><h3><a class="anchor" id="id_deleting_text_from_a_story"></a> Deleting text from a story</h3><p>You can delete a range of text from a story, using text commands or via a text selection.<p><b>Solution</b><p>If there is a valid text selection, use <a class="el" href="class_i_text_edit_suite.html#a87db8d87cb5715d2336e6a1e21f80e00">ITextEditSuite::Delete</a> to delete selected text (after testing <a class="el" href="class_i_text_edit_suite.html#a3d3c08f58f654f08857c8e31561e19b6">ITextEditSuite::CanEditText</a> to determine whether the operation is allowed).<p>To delete an arbitrary range of text, use the command generated by <a class="el" href="class_i_text_model_cmds.html#af32fcf13c8732ff10f15370bfc7a1fed">ITextModelCmds::DeleteCmd</a>. <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a> is available on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>.<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_model.html#a580f17d6c1157601ad79abac052fc180">SnpManipulateTextModel::DeleteText</a></ul><h3><a class="anchor" id="id_replacing_text_in_a_story"></a> Replacing text in a story</h3><p>You can replace a range of text with alternative text.<p><b>Solution</b><p>Use the command generated by <a class="el" href="class_i_text_model_cmds.html#ab534be6861356c46adbd9a1e8c2d2674">ITextModelCmds::ReplaceCmd</a> to replace text within a story.<p>Put the replaced data into a reference counted K2::shared_ptr with type <a class="el" href="class_wide_string.html">WideString</a>, and pass it into the InsertCmd, so the memory occupied by the data is purged when no one is referencing it. For more information, see <a class="el" href="_k2_smart_ptr_8h_source.html">K2SmartPtr.h</a>.<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_model.html#a67876f879917beafa90789484e6455af">SnpManipulateTextModel::ReplaceText</a></ul><h3><a class="anchor" id="id_copying_text_within_and_between_stories"></a> Copying text within and between stories</h3><p>You can programmatically copy text within or across text stories.<p><b>Solution</b><p>To copy text within and between stories, use the command provided by the <a class="el" href="class_i_text_utils.html#a8b4a388f1ee39a829b2e06919bd4c4e2">ITextUtils::QueryCopyStoryCommand</a> utility facade. Variants of this API allow common use cases of text copy to be handled; for example, copying a range from source to a range in the destination and copying the complete source story to the end of the destination story.<p>To copy text within the same story, source and destination references should be the same. When specifying ranges for this operation, take care they do not overlap.<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<h3><a class="anchor" id="id_moving_text_within_and_between_stories"></a> Moving text within and between stories</h3><p>You can programmatically move text within or across text stories.<p><b>Solution</b><p>To move text within and between stories, use the command provided by the <a class="el" href="class_i_text_utils.html#a7a34d61ad6a73e24af3d31f47e2298fd">ITextUtils::QueryMoveStoryCommand</a> utility facade. Variants of this API allow common use cases of text move to be handled; for example, moving a range from source to a range in the destination and moving the complete source story to the end of the destination story.<p>To move text within the same story, source and destination references should be the same. When specifying ranges for this operation, take care they do not overlap.<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_footnotes.html#a35412930d4350dae99725686e63656cd">SnpManipulateTextFootnotes::ConvertSelectionToFootnote</a> shows how to move the contents of one story thread to another, which would be the case if you want to move text cell contents or footnotes.</ul><h3><a class="anchor" id="id_iterating_across_text_story_threads_in_a_story"></a> Iterating across text story threads in a story</h3><p>Given a story comprises one or more text story threads, each of which represents a discrete subcomponent (like table cell text or a footnote), you may need to iterate or otherwise discover text story threads within a story.<p><b>Solution</b><p>To be able to deal with distinct text units like table cell contents or footnotes, a hierarchy is built on top of the simple linear model maintained by the various strands. The nodes of this hierarchy are represented by text story thread dictionaries (<a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a>, maintained on boss classes representing the subcomponent, such as <a class="el" href="classk_footnote_reference_boss.html">kFootnoteReferenceBoss</a>). The root of the hierarchy is the primary story thread. (All stories have a primary story thread; see <a class="el" href="class_i_text_model.html#af1103745d4336643788243a63610d32e">ITextModel::GetPrimaryStoryThreadSpan</a>.). Story thread dictionaries maintain a mapping to a set of text story threads (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>). For example, the story thread dictionary for a table is on the table model (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>). It maintains the mapping to the actual text story threads for each cell (<a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>). The dictionary provides the mechanism required to iterate through all text story threads it manages.<p>The story (kTextModelBoss) models the inherent hierarchy using <a class="el" href="class_i_text_story_thread_dict_hier.html">ITextStoryThreadDictHier</a>. Using <a class="el" href="class_i_text_story_thread_dict_hier.html#acac5b6e4f2fb7034b56834b9d4078e1d">ITextStoryThreadDictHier::NextUID</a>, you can access all story threads in the order in which they appear within the story.<p>With this background, the solution becomes apparent. For each text story thread dictionary obtained from <a class="el" href="class_i_text_story_thread_dict_hier.html#acac5b6e4f2fb7034b56834b9d4078e1d">ITextStoryThreadDictHier::NextUID</a>, obtain the supported set of text story thread keys using <a class="el" href="class_i_text_story_thread_dict.html#a9bf2636b8a0ac6d703d57dde9f900999">ITextStoryThreadDict::GetFirstKey</a>/GetNextKey before calling <a class="el" href="class_i_text_story_thread_dict.html#a22798fb2c90de956d2463a359e8ce748">ITextStoryThreadDict::QueryThread</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_iter_table_use_dict_hier.html">SnpIterTableUseDictHier</a><li><a class="el" href="class_snp_inspect_text_model.html#a0dc5d48e83042ac64d3a1bf41df8bb0e">SnpInspectTextModel::InspectStoryThreadDicts</a></ul><h3><a class="anchor" id="id_obtaining_the_text_story_thread_for_the_current_selection"></a> Obtaining the text story thread for the current selection</h3><p>If you have a valid text selection, you can determine the text story thread that maintains the contents,<p><b>Solution</b><p>When dealing with a selection, you need to implement a selection extension pattern, which allows you to participate in the selection subsystem. As part of this extension pattern, you provide an add-in implementation of a concrete selection interface on the <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a> (and associated add-in implementation of an abstract selection interface on the <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>). For details on implementing this extension pattern, see the &quot;Selection&quot; chapter of Adobe InDesign Plug-in Programming Guide.<p>Use <a class="el" href="class_i_selection_utils.html#af710ece9449e7c801bdc89e684e970aa">ISelectionUtils::GetActiveSelection</a> to obtain your abstract selection, which can then provide access to the concrete selection.<p><a class="el" href="class_i_text_target.html">ITextTarget</a> (on <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>) resides on the same boss class as your concrete selection.<p><a class="el" href="class_i_text_target.html#abe90189bfb9e72d6452176ccd20b83de">ITextTarget::QueryTextModel</a> provides the text model for the current selection. This interface provides access to the text model as well as information on the range to which the selection applies.<p>Use <a class="el" href="class_i_text_model.html#a29b08bfc8e97ee9024bbc6e672d06c45">ITextModel::QueryStoryThread</a> along with the index provided by the <a class="el" href="class_i_text_target.html">ITextTarget</a>, to obtain the text story thread.<h3><a class="anchor" id="id_inserting_an_inline_graphic_into_a_story"></a> Inserting an inline graphic into a story</h3><p>You can insert an inline graphic into the story at a particular position.<p><b>Solution</b><p>An inline graphic is represented within the text of a story using the special character kTextChar_Inline; known as the anchor character. This character indicates to the text subsystem that there is an inline item embedded at this position. The inline itself is represented on the owned item strand (<a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>). The owned item strand maintains a (persistent/UID-based) reference to the actual inline item (<a class="el" href="classk_inline_boss.html">kInlineBoss</a>) through the <a class="el" href="class_i_item_strand.html">IItemStrand</a> interface.<p>Two actions are required to add an inline to a story:<ul><li>Add the anchor character to the story at the required text index.This is done using standard text content manipulation.<li>Create and add the inline reference to the owned item strand, using the kChangeILGCmndBoss command.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_inline.html#abeaf84df35c1cda20afcde90a2df00f5">SnpManipulateInline::ChangeToInline</a></ul><h3><a class="anchor" id="id_modifying_an_inline_objects_position"></a> Modifying an inline object&#39;s position</h3><p><b>Solution</b><p>Positioning information for an inline object is maintained on the <a class="el" href="class_i_anchored_object_data.html">IAnchoredObjectData</a> interface for the inline. There are many options that define the placement of the inline relative to the anchor point within the text. You can modify the position of an inline using the <a class="el" href="class_i_anchored_object_suite.html">IAnchoredObjectSuite</a> interface or the <a class="el" href="classk_change_anchored_object_data_cmd_boss.html">kChangeAnchoredObjectDataCmdBoss</a> low level command.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_inline.html#a95bb461d3719897b47cf4e00cc6c6713">SnpManipulateInline::ModifyAnchorPosition</a></ul><h3><a class="anchor" id="id_deleting_an_inline_object"></a> Deleting an inline object</h3><p><b>Solution</b><p>Delete the character that anchors the object into the story.<h3><a class="anchor" id="id_inserting_a_footnote_into_a_story"></a> Inserting a footnote into a story</h3><p>You can create a footnote and insert it into an existing story.<p><b>Solution</b><p>A footnote is maintained within the story as a special inline object. The character used in the story to indicate a footnote reference is kTextChar_FootnoteMarker. The footnote is represented on the owned item strand by a reference to a <a class="el" href="classk_footnote_reference_boss.html">kFootnoteReferenceBoss</a>. The textual contents for the footnote reside in a distinct text story thread within the story.<p>Three actions are required to add a footnote to a story:<ol type="1"><li>Add the anchor character to the story at the required text index. This is done using standard text content manipulation.<li>Create and add the footnote reference boss object to the owned item strand, using the <a class="el" href="classk_create_footnote_cmd_boss.html">kCreateFootnoteCmdBoss</a> command.<li>After processing, the <a class="el" href="classk_create_footnote_cmd_boss.html">kCreateFootnoteCmdBoss</a> command provides the text story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) for the newly created footnote in the <a class="el" href="class_i_u_i_d_data.html">IUIDData</a> interface on the command boss object. Add text to this text story thread using standard text content manipulation.</ol><p><b>Sample code</b><ul><li>SnpManipulateTextFootnote::InsertFootnote</ul><h3><a class="anchor" id="id_deleting_a_footnote_from_a_story"></a> Deleting a footnote from a story</h3><p><b>Solution</b><p>Delete the footnote&#39;s anchor character.<p><b>Sample code</b><ul><li>SnpManipulateTextFootnote::DeleteAllStoryFootnotes</ul><h3><a class="anchor" id="id_determining_whether_a_text_range_is_within_a_footnote"></a> Determining whether a text range is within a footnote</h3><p>Given a range or selection within a text story, there are some operations that are invalid if that range is within a footnote. You can determine whether the range or selection is within the text of a footnote.<p><b>Solution</b><p>Use <a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a> on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> to get the active text selection (<a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>).<p>ITextSelectionSuite::IsTextSelectionInFootnote indicates whether the selection is in a footnote.<p>To determine whether an arbitrary text range is within the text story thread of a footnote, use the <a class="el" href="class_i_text_utils.html#a963d5f97fd45950484f6f8a5bb7f8028">ITextUtils::IsFootnote</a> from the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> class. The API can be used to determine whether the range is within a footnote and to get the footnote reference (<a class="el" href="classk_footnote_reference_boss.html">kFootnoteReferenceBoss</a>) object through the parameter list.<h3><a class="anchor" id="id_determining_whether_a_page_item_can_have_text_along_its_path"></a> Determining whether a page item can have text along its path</h3><p>You can determine whether it is legal for a defined page item to have text along its path.<p><b>Solution</b><p>A page item can have text flowed along its path if it has one path with at least one segment with at least two points (that is, it cannot be a compound path or a single point). The page item cannot be an inline item.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_on_path.html#aa8174406149fd2159e3eed7e2b37dae2">SnpManipulateTextOnPath::CanAddTextOnPath</a></ul><h3><a class="anchor" id="id_determining_whether_a_page_item_has_text_on_its_path"></a> Determining whether a page item has text on its path</h3><p><b>Solution</b><p><a class="el" href="class_i_page_item_type_utils.html#af1ea6b05a2f77745612dae1592340950">IPageItemTypeUtils::IsTextOnAPath</a> on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> has an API that returns true if the page item has text along its path.<h3><a class="anchor" id="id_adding_text_along_the_path_of_a_page_item"></a> Adding text along the path of a page item</h3><p><b>Solution</b><p>Use the <a class="el" href="classk_add_text_on_path_cmd_boss.html">kAddTextOnPathCmdBoss</a> API command to create the text model that supports the text on the path. This newly created text model is a candidate for traditional text content manipulation operations.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_on_path.html#aa60f7063347227ff126c771f94bdd75e">SnpManipulateTextOnPath::AddTextOnPath</a></ul><h3><a class="anchor" id="id_adding_text_to_existing_text_on_a_path"></a> Adding text to existing text on a path</h3><p><b>Solution</b><p>To navigate from a page item with associated text on its path, get the IMainTOPData interface from the spline object. You can get the text frame associated with the text on the path using IMainTOPData::QueryTOPFrameData. From the <a class="el" href="class_i_t_o_p_frame_data.html">ITOPFrameData</a> interface (on the <a class="el" href="classk_t_o_p_frame_item_boss.html">kTOPFrameItemBoss</a> object), you can get the <a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a> and call the QueryTextModel interface to get the text model interface. You can manipulate the text model using the mechanisms described above.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_on_path.html#ad7f2cc14d12dabf874ebac7e4fed8be2">SnpManipulateTextOnPath::InsertTextIntoTextOnPath</a></ul><h3><a class="anchor" id="id_deleting_the_text_on_a_path"></a> Deleting the text on a path</h3><p><b>Solution</b><p>To delete the text on a path for a spline item, use the <a class="el" href="classk_t_o_p_delete_cmd_boss.html">kTOPDeleteCmdBoss</a> API command. Specify the spline to be processed on the item list.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_on_path.html#a4065bf8dbb24417805a98b82dbf2785e">SnpManipulateTextOnPath::DeleteTextOnPath</a></ul><h3><a class="anchor" id="id_inserting_page_numbering_and_title_heading_into_a_story"></a> Inserting page numbering and title heading into a Story</h3><p><b>Solution</b><p>The text composition engine provided with the application automatically replaces special characters in the text stream with page numbering and/or section header text (the exact format defined by the preferences). For page numbering, insert the kTextChar_PageNumber character into the text story. For headings, insert the kTextChar_SectionName special character into the text model.<h2><a class="anchor" id="id_text_formatting"></a> Text formatting</h2><p>This section contains use cases related to formatting text and managing text styles within the application.<p>Text is formatted to give it a particular look, like underlined or in a particular font face. The desired look of text can be described by a set of attributes; for example, a point size or text color. Attributes are defined to be either character or paragraph based. Character attributes can be applied to text at any granularity, from a single character to the entire story. Paragraph attributes are settings that work at the granularity of a paragraph (for example, hyphenation behavior or horizontal justification).<p>Generally, attributes are grouped together to describe a common theme (for example, a heading or body text); these themes are called styles. Attributes also can be applied to text independently of any applied style. These attributes are said to be overrides, as they override the definition of that attribute in the style.<p>A style is a mechanism for identifying groups of attributes. In the application, character and paragraph styles are supported (along with table styles, which are not considered here). Character styles contain only character-based attributes. Paragraph styles can contain either character- or paragraph-based attributes. The style can be queried to determine its type (<a class="el" href="class_i_style_info.html#af90b8cc54fbe0b3abacd8084d1f35a4e">IStyleInfo::GetStyleType</a>). All text has a character and paragraph style applied to it (represented on the character and paragraph attribute strands, respectively).<p>For more information, see the &quot;Text Fundamentals&quot; chapters of Adobe InDesign Programming Guide.<h3><a class="anchor" id="id_accessing_the_set_of_supported_styles"></a> Accessing the set of supported styles</h3><p>Styles can exist for all documents on a session or a particular document. They are accessed through the workspace and are modeled within the application using the persistent <a class="el" href="classk_style_boss.html">kStyleBoss</a>. Session workspace styles are inherited into the document workspace (thus preventing the style not being available at a later date or on another machine).<p>You can access the set of styles available to a particular document.<p><b>Solution</b><p>Styles can exist on either the session or document workspace. Session workspace styles are available for all documents; document workspace styles are available only for that document. The workspace boss classes support two implementations of the <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> interface, IID_IPARASTYLEGROUPMANAGER for paragraph styles and IID_ICHARSTYLEGROUPMANAGER for character styles. The interface provides the GetRootHierarchy() API, which returns a pointer to <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> at the root level. Use <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> to iterate across the supported styles.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_text_styles.html#aebad5fbb797ae9c192cca8b283c54f10">SnpInspectTextStyles::Inspect</a></ul><h3><a class="anchor" id="id_accessing_a_style_using_its_path"></a> Accessing a style using its path</h3><p>The IStyleGroupManager::FindByName(PMString fullPath) method returns the UID of a <a class="el" href="classk_style_boss.html">kStyleBoss</a> in the style group hierarchy specified in the fullPath. The fullPath to pass into the method is the &quot;internal&quot; path name. Normally, you cannot construct an internal path name using a string literal, because the internal path uses a path delimiter that is not accessible by keyboard. This is necessary because a style name can include most of the common path delimiters (like &quot;:&quot;and &quot;/&quot;). A main reason for this is to provide backward compatibility for styles created before the style group concept was introduced in InDesign CS4. Previously, many users named styles with &quot;:&quot; to better organize their styles. Therefore, if you construct a <a class="el" href="class_p_m_string.html">PMString</a> path with string literals and pass it into the IStyleGroupManager::FindByName(PMString fullPath) method, you are asking <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> to find a style with the passed-in name at the root level. For example, if you pass &quot;My Group:Style 1&quot; (as <a class="el" href="class_p_m_string.html">PMString</a>) into FindByName(), <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> still treats the whole string as the style name, not as the path (as you expect). This string literal is used to find the style with the name &quot;My Group:Style 1&quot; on the root level.<p>To use the IStyleGroupManager::FindByName(PMString fullPath) method, pass in a valid internal path for a style. To get the internal path, use the <a class="el" href="class_i_style_group_hierarchy.html#a92d842a26c3c237546325d0f8d75561f">IStyleGroupHierarchy::GetFullPath()</a> method. <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> is aggregated on three bosses: <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a>, <a class="el" href="classk_style_group_boss.html">kStyleGroupBoss</a>, and <a class="el" href="classk_style_boss.html">kStyleBoss</a>. This means to find a style by name using a internal full path, you need to have previously accessed the style or style group. For example, if you have a UID for a style, you can use the UID to query its <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> and ask for its internal full path using GetFullPath(); later, you can use the path to find the style again.<p><b>Solution</b><p>Use <a class="el" href="class_snp_apply_text_style_attributes.html#a958ba15e4aa033bf6de57031429cddb6">SnpApplyTextStyleAttributes::CreateParaStyle</a>.<h3><a class="anchor" id="id_accessing_a_style_using_its_name_and_parent_style_group_uid"></a> Accessing a style using its name and parent style group UID</h3><p>As explained in <a class="el" href="id_solutions.html#id_accessing_a_style_using_its_path">Accessing a style using its path</a>, there is no easy way to specify a path to find a style. <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> defines an overloaded FindByName(UID parent, const PMString&amp; name), so if you have access to a style group UID and you know the name of style you are looking for, you can use this method to find the corresponding style. It returns the UID of the style whose name matches the passed name within the specified parent style group node.<p><b>Solution</b><p>Use <a class="el" href="class_snp_apply_text_style_attributes.html#acdc850d48b886ca86304722a86c52f26">SnpApplyTextStyleAttributes::ApplyParaStyle</a>.<h3><a class="anchor" id="id_determining_a_styles_type"></a> Determining a style&#39;s type</h3><p>You can determine the style a particular <a class="el" href="classk_style_boss.html">kStyleBoss</a> represents.<p><b>Solution</b><p>From the <a class="el" href="classk_style_boss.html">kStyleBoss</a>, use the <a class="el" href="class_i_style_info.html#af90b8cc54fbe0b3abacd8084d1f35a4e">IStyleInfo::GetStyleType</a> API.<h3><a class="anchor" id="id_determining_a_styles_parent_style"></a> Determining a style&#39;s parent style</h3><p>InDesign has the concept of a root style. All other styles inherit from the root style, maintaining within their definition only how they differ from their parent. For a particular style, you can determine its parent; that is, the style on which it is based.<p><b>Solution</b><p><a class="el" href="class_i_style_info.html">IStyleInfo</a> on <a class="el" href="classk_style_boss.html">kStyleBoss</a> provides the API <a class="el" href="class_i_style_info.html#a95d080fea0ae34012b6ba34103c56d06">IStyleInfo::GetBasedOn</a>. This provides either the parent style UID or kInvalidUID if the style is the root.<h3><a class="anchor" id="id_determining_the_value_of_an_attribute_within_a_style"></a> Determining the value of an attribute within a style</h3><p>You can determine what a style means to a particular attribute; that is, what value for a particular attribute would be applied to text (as long as there are no local overrides).<p><b>Solution</b><p>Since styles do not maintain a full set of attributes (they record only the differences from the style on which they are based), you can determine the setting for a particular attribute by obtaining the list of attributes supported by the style (<a class="el" href="class_i_text_attributes.html">ITextAttributes</a>). Querying this interface for the particular attribute of interest (ITextAttributeList::QueryByClassID, say) returns either the attribute (if this style specifies it) or nil. In the latter case, the parent style needs to be interrogated to determine whether it specifies the attribute. Continue until the attribute is found.<p>For paragraph styles, the attribute is found at some point; the terminal case is the root style. For character styles, the root style is empty, deferring the attribute values to the paragraph style. In this case, if the attribute is not defined by any (parent) character style, the root paragraph style provides the value.<h3><a class="anchor" id="id_creating_a_new_style"></a> Creating a new style</h3><p>You can create a new character or paragraph style.<p><b>Solution</b><p>Use <a class="el" href="classk_create_para_style_cmd_boss.html">kCreateParaStyleCmdBoss</a> or <a class="el" href="classk_create_char_style_cmd_boss.html">kCreateCharStyleCmdBoss</a>. The item list for each of these commands identifies the workspace the style is to be added to (generally the session or document workspace). <a class="el" href="class_i_style_position_info.html">IStylePositionInfo</a> allows the style to be created inside a style group, as explained in the &quot;Text Fundamentals&quot; chapter of Adobe InDesign Programming Guide. To create a style group, use <a class="el" href="classk_create_style_group_cmd_boss.html">kCreateStyleGroupCmdBoss</a>.<p><b>Sample code</b><ul><li>See SnpManipulateTextStyle::CreateParaStyle for an example of how to create a new paragraph style inside a style group. This sample provides its own implementation for generating a unique style name; however, the style utility interface on the utils boss class provides an API that provides this functionality (<a class="el" href="class_i_style_utils.html#acdadfec4df82144c6cf0cb9a48ba5241">IStyleUtils::CreateUniqueName</a>).</ul><h3><a class="anchor" id="id_modifying_an_existing_style"></a> Modifying an existing style</h3><p>You can modify a style by either modifying the attributes the style represents or changing some aspect of the style, like its name.<p><b>Solution</b><p>Changes to styles are handled through the <a class="el" href="classk_edit_text_style_cmd_boss.html">kEditTextStyleCmdBoss</a> command. The UIDData interface on this boss class identifies the style being manipulated. The <a class="el" href="class_i_text_attributes.html">ITextAttributes</a> interface identifies the list of attributes that will exist in the style after the command is processed (this is an absolute list, so to modify an existing attribute on the style, representing the attribute within this list will update it in the style). The <a class="el" href="class_i_style_info.html">IStyleInfo</a> interface defines the metadata (like style name), the style it is based on, and what the next style should be (for paragraph styles).<p>There are utility methods in <a class="el" href="class_i_style_utils.html">IStyleUtils</a> (on the <a class="el" href="class_utils_boss.html">UtilsBoss</a>) that construct the <a class="el" href="classk_edit_text_style_cmd_boss.html">kEditTextStyleCmdBoss</a> commands. These methods allow the caller to determine sets of attributes that should be added or deleted from the style (rather than forcing them to define an absolute set that is left in the style once the command completes).<p><b>Related API</b><ul><li><a class="el" href="class_i_style_utils.html#ab5eecff551305d62cbe58b535d4390bf">IStyleUtils::CreateEditStyleCmd</a></ul><h3><a class="anchor" id="id_deleting_a_style"></a> Deleting a style</h3><p>You can delete a style from a style name table. There are implications for text already formatted with the deleted style.<p><b>Solution</b><p>Use the <a class="el" href="classk_delete_para_style_cmd_boss.html">kDeleteParaStyleCmdBoss</a> or <a class="el" href="classk_delete_char_style_cmd_boss.html">kDeleteCharStyleCmdBoss</a> command. The command boss supports <a class="el" href="class_i_bool_data.html">IBoolData</a>. Setting this interface indicates formatting should not be stripped from text using the style; the formatting is maintained by a set of local attribute overrides. The <a class="el" href="class_i_u_i_d_data.html">IUIDData</a> interface (identified with the ID IID_IREPLACEUIDDATA interface) allows an alternate style to be specified as a replacement style. The style to be deleted is identified through the <a class="el" href="class_i_u_i_d_data.html">IUIDData</a> (default IID) interface. The item list identifies the workspace from which the style is deleted.<p><b>Sample code</b><ul><li>SnpManipulateTextStyle::DeleteParaStyle</ul><h3><a class="anchor" id="id_applying_a_style_to_text"></a> Applying a style to text</h3><p>You can apply a style to a range of text or the current selection.<p><b>Solution</b><p>If you are dealing with a selection, use <a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a> on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> to get the active text selection (<a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>). The same boss class supports the <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> interface.<p>Use <a class="el" href="class_i_text_attribute_suite.html#a179f765811eb369a7713e8059980789a">ITextAttributeSuite::ApplyStyle</a> to set the new style or revert the style back to the root style (in this case, with the option to leave the formatting intact as a set of attribute overrides).<p>To apply a style to an arbitrary range of text, use the command provided by <a class="el" href="class_i_text_model_cmds.html#a7065c0bc154f0c461e510d9429e83234">ITextModelCmds::ApplyStyleCmd</a> (the <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a> interface is available on the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> class).<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_apply_text_style_attributes.html#acdc850d48b886ca86304722a86c52f26">SnpApplyTextStyleAttributes::ApplyParaStyle</a> for an example of using <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>.</ul><h3><a class="anchor" id="id_removing_a_style_from_text"></a> Removing a style from text</h3><p>You can remove a style from a text selection or an arbitrary text range.<p><b>Solution</b><p>If you are dealing with a selection, use <a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a> on the <a class="el" href="class_utils_boss.html">UtilsBoss</a> to get the active text selection (<a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>). The same boss class supports the <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> interface. This interface has the API ApplyStyle, which can be used to set the new style as the root style, in effect removing the style.<p>To remove a style from an arbitrary range of text, use the command provided by <a class="el" href="class_i_text_model_cmds.html#acacd7ba89254ddd5e5fc968c65e2d88f">ITextModelCmds::UnapplyStyleCmd</a> (the <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a> interface is available on the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> class).<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_apply_text_style_attributes.html#acdc850d48b886ca86304722a86c52f26">SnpApplyTextStyleAttributes::ApplyParaStyle</a> for an example of using <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>.</ul><h3><a class="anchor" id="id_obtaining_the_style_of_text"></a> Obtaining the style of text</h3><p>You can determine the character or paragraph style for a particular text position (identified through a selection or arbitrary text index).<p><b>Solution</b><p>If you have a selection, obtaining the text attribute suite interface (<a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>) from the text selection (<a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a>) allows you to determine how many styles are in the selection (using ITextAttributeSuite::CountParagraphStyles and ITextAttributeSuite::CountCharacterStyles), and iterate through them (using ITextAttributeSuite::GetNthParagraphStyle and ITextAttributeSuite::GetNthCharacterStyle).<p>To get the style from an arbitrary position in the story, navigate to the appropriate strand-either the paragraph (<a class="el" href="classk_para_attr_strand_boss.html">kParaAttrStrandBoss</a>) or character (<a class="el" href="classk_char_attr_strand_boss.html">kCharAttrStrandBoss</a>) attribute strands. Obtain the <a class="el" href="class_i_attribute_strand.html">IAttributeStrand</a> interface, which supports the <a class="el" href="class_i_attribute_strand.html#afc894e591b8f02eb761d77b911ef037c">IAttributeStrand::GetStyleUID</a> method, returning the style for a particular text position.<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_manipulate_text_style.html#abc6a55403a86026de924ba32fa9cf694">SnpManipulateTextStyle::UpdateParaStyle</a> for an example of accessing the style at a given text index.</ul><h3><a class="anchor" id="id_obtaining_the_value_of_an_attribute_applied_to_text"></a> Obtaining the value of an attribute applied to text</h3><p>You can access the single named attribute that applies to a text selection or a text index or range.<p><b>Solution</b><p>If you have a selection, obtaining the text attribute suite interface (<a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>) from the same boss class as the text selection (<a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a>) provides you with methods that expose the state of a particular attribute (see ITextAttributeSuite::FeatureState). For example, ITextAttributeSuite::GetCapsModeState indicates whether a certain mode applies to all the text, none of the text, or some of the text (if the attribute changes along the selection).<p>To determine whether there is an attribute override, use ITextAttributeSuite::CountAttributes, passing in the ClassID for the attribute of interest. An attribute is provided for each time the attribute value changes across the range of the selection. ITextAttributeSuite::QueryAttributeN provides the set of attributes that apply to the selection for a particular attribute class.<p>To get the attribute value from an arbitrary position in the story, use the <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> interface (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). The method <a class="el" href="class_i_compose_scanner.html#a83ab135a7a95e1d51bcf72663a6a2e3a">IComposeScanner::QueryAttributeAt</a> provides the attribute that applies to the identified text index.<p>There is an iterator class (<a class="el" href="class_text_attribute_run_iterator.html">TextAttributeRunIterator</a>) that allows the set of attributes that apply to a range of text to be accessed, dealing with the changes in attributes that can occur across ranges.<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_apply_text_style_attributes.html#ab4258752bf11b302c4ea4264e74b7df4">SnpApplyTextStyleAttributes::CycleSmallAllCaps</a> for an example.<li>See <a class="el" href="class_snp_inspect_text_model.html#a329b54842b132dca826eb3bde886348f">SnpInspectTextModel::InspectStoryPointSizes</a> for an example of using a <a class="el" href="class_text_attribute_run_iterator.html">TextAttributeRunIterator</a> to access the attributes in a range of text.</ul><h3><a class="anchor" id="id_modifying_the_value_of_an_attribute_for_text"></a> Modifying the value of an attribute for text</h3><p>You can modify an attribute applied to a text selection or text range.<p><b>Solution</b><p>If you have a selection, obtaining the text attribute suite interface (<a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>) from the same boss class as the text selection (<a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a>) provides you with methods that allow you to modify the format of the selection (for example, ITextAttributeSuite::ToggleItalic, or ITextAttributeSuite::IncrementPointSize). The suite also provides mechanisms for setting the value of attributes that have nonexotic data requirements. For example, use ITextAttributeSuite::SetInt16Attribute to specify that an override for an attribute of a particular type should be applied to the text, with a particular value. For attributes with more exotic data requirements, use ITextAttributeSuite::ApplyAttribute, though the onus for the creation of the attribute falls on the client.<p>Before manipulating the selection in this way, test that the operation is valid (ITextAttributeSuite::CanApplyAttributes).<p>To modify the attribute given an arbitrary range of text, use <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a> interface (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), which provides a command through the <a class="el" href="class_i_text_model_cmds.html#a8bf940873e8661944bf8886c607349d9">ITextModelCmds::ApplyCmd</a> API that modifies the attributes. This command expects a K2::shared_ptr. The <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> that defines the attributes to be applied should be allocated on the heap and wrapped in a K2::shared_ptr. This implements reference counting for the attribute list and automatically deletes it when it is no longer used.<p>It is important to apply attributes to the correct strand: paragraph attributes should be applied to the paragraph-attribute strand, and character attributes should be applied to the character-attribute strand. For example, it would make no sense to try to set the justification of text on the character-attribute strand, as justification is a paragraph attribute. Likewise, it would not make sense to set the point size of text on a paragraph strand.<p>Although you cannot apply character-attribute overrides directly to the paragraph-attribute strand, you can do so indirectly by defining a paragraph style with the character-attribute override defined, and applying this style to the paragraph-attribute strand.<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_apply_text_style_attributes.html#a44db8a4f1e8b9530d5e771422d18e0b2">SnpApplyTextStyleAttributes::ApplyFontVariant</a> for an example of using ITextAttributeSuite::ApplyAttribute.<li>See <a class="el" href="class_snp_text_model_helper.html#acfec6e847cad1900897dc0e19948c29d">SnpTextModelHelper::ApplyOverrides</a> for an example of using <a class="el" href="class_i_text_model_cmds.html#a8bf940873e8661944bf8886c607349d9">ITextModelCmds::ApplyCmd</a>.</ul><h3><a class="anchor" id="id_clearing_attribute_overrides_for_text"></a> Clearing attribute overrides for text</h3><p>You can remove local formatting overrides for a text selection or text range (leaving the text formatted to the specification of whatever style is applied).<p><b>Solution</b><p>If you have a selection, obtaining the text attribute suite interface (<a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>) from the same boss class as the text selection (<a class="el" href="class_i_selection_utils.html#afa9f8b379a05969850f0151984a84404">ISelectionUtils::QueryActiveTextSelectionSuite</a>) provides you with methods that allow you to remove character-attribute overrides (ITextAttributeSuite::ClearCharacterOverrides), paragraph-attribute overrides (ITextAttributeSuite::ClearParagraphOverrides), or both (ITextAttributeSuite::ClearAllOverrides).<p>Before removing the formatting information, test the capability using ITextAttributeSuite::CanRemoveFormatting.<p>To remove all the attributes that are overridden given an arbitrary range of text, use the <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a> interface (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) which provides a command through the <a class="el" href="class_i_text_model_cmds.html#a8259735562110f9b6a75c2ab2bef9005">ITextModelCmds::ClearOverridesCmd</a> API that removes all specified overrides for a particular strand. To specify all overrides, navigate to the stand of interest (<a class="el" href="class_i_text_model.html#a3f42011559afffe4df8179e1e39d7d77">ITextModel::QueryStrand</a> on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), obtain the <a class="el" href="class_i_attribute_strand.html">IAttributeStrand</a> interface, and use <a class="el" href="class_i_attribute_strand.html#a5b24b9b13a4e383591bc5ec8a81b18e1">IAttributeStrand::GetLocalOverrides</a> to obtain a list of all attribute overrides that exist at a particular text index.<p>Before performing the modification, check the model to ensure it is not locked (ITextModel::IsModelLocked).<p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_text_model_helper.html">SnpTextModelHelper</a>:ClearOverrides for an example of using <a class="el" href="class_i_text_model_cmds.html#a8259735562110f9b6a75c2ab2bef9005">ITextModelCmds::ClearOverridesCmd</a>.</ul><h3><a class="anchor" id="id_determining_the_type_of_an_attribute"></a> Determining the type of an attribute</h3><p>Paragraph attributes should be applied only to the paragraph-attribute strand; character attributes, to the character-attribute strand. You can determine the type of an attribute.<p><b>Solution</b><p>The signature interface for an attribute boss class is <a class="el" href="class_i_attr_report.html">IAttrReport</a>. It supports a method, IsParagraphAttribute, that indicates whether the attribute is a paragraph attribute.<h3><a class="anchor" id="id_defining_a_custom_text_attribute"></a> Defining a custom text attribute</h3><p>Most attributes control some aspect of the final appearance of rendered text, like point size or font. The composition engines delivered with the application understand and interpret these attributes when rendering the text. You can add custom text attributes to the application using the text attribute extension pattern.<p>A text-adornment extension pattern can be used to decorate the text; it provides a hook into the drawing of the text. Custom text attributes are used to control the drawing behavior of the adornment for ranges of text.<p>Text attributes also can be used to give a range of text special meaning; that is, overlay use-specific information on the text story for ranges of characters. For example, imagine you want some text in a story to be variable and replaced with text from database records when doing a print run.<p>Sometimes, you want to add another attribute, something that can be applied to text to give the rendered appearance a specific effect. You need to add a custom attribute for this (in fact, you also need to define a custom composition engine, as there is no mechanism to direct the supplied composers to interpret custom attributes).<p><b>Solution</b><p>Implement a custom text-attribute extension pattern. To do this, provide an implementation of the <a class="el" href="class_i_attr_report.html">IAttrReport</a> interface in a boss class. Further, if the attribute has some meaning for tagged text import/export, provide an implementation of <a class="el" href="class_i_attr_import_export.html">IAttrImportExport</a>.<p><b>Sample code</b><ul><li>See the BasicTextAdornment sample from the SDK for an example of using a custom text attribute to control the behavior of a text adornment.</ul><h2><a class="anchor" id="id_text_containers"></a> Text containers</h2><p>Raw text content is presented to the user through a process known as composition. Raw text content is defined as the Unicode text along with some idea how it is to be displayed. The process of composition needs some notion of where to place the text. It works with containers, which are parcels into which the text can be placed. Several types of containers are supported:<ul><li>Text frames, like those created using the &quot;Type Tool.&quot;<li>Text on the path of a spline (text on a path), such as you could create using the &quot;Type on a Path Tool.&quot;<li>Text in a footnote.<li>Text within a table cell (this is covered in the tables chapter).</ul><p>A story (that is, a discrete body of textual work) can be spread across multiple columns of a page element. The story can have embedded tables and footnote references, and it can be spread across several page elements (on different pages of the document).<p>This section presents use cases for interacting with text containers and controlling options that apply to them.<p>For more information, see Adobe InDesign Programming Guide.<h3><a class="anchor" id="id_creating_a_text_frame"></a> Creating a text frame</h3><p>You can create a page item to hold text.<p><b>Solution</b><p>Use the <a class="el" href="classk_create_multi_column_item_cmd_boss.html">kCreateMultiColumnItemCmdBoss</a> command. To specify the characteristics of the new text item, use the IMultiColumnData and ICreateFrameData interfaces.<p><b>Sample code</b><ul><li><a class="el" href="class_s_d_k_layout_helper.html#a0a8d0fb2f115bdb9878c4f14b32b3c4e">SDKLayoutHelper::CreateTextFrame</a><li><a class="el" href="class_snp_create_frame.html#aca0e8d0dca53f59461d84ec821a0b225">SnpCreateFrame::CreateTextFrame</a></ul><h3><a class="anchor" id="id_examining_the_characteristics_of_a_text_frame"></a> Examining the characteristics of a text frame</h3><p><b>Solution</b><p>Given a selection, follow these steps:<ol type="1"><li>Obtain the interface using <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> on the kUtils boss class.<li>Use <a class="el" href="class_i_text_frame_options_suite.html#a258ca33aef3d45759c0c89bd835b0cd1">ITextFrameOptionsSuite::GetTextFrameOptionsData</a> to provide a reference to the <a class="el" href="class_i_text_frame_options_data.html">ITextFrameOptionsData</a> interface, which can be interrogated for the text frame options.</ol><p>Given an arbitrary set of page items, do the following:<ol type="1"><li>Navigate to the <a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a> object (child of <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> via <a class="el" href="class_i_hierarchy.html">IHierarchy</a>).<li>Use <a class="el" href="class_i_text_column_sizer.html">ITextColumnSizer</a> to provide access to attributes of the frame (gutter width, inset, number of columns etc.).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#af8327fe0ea75d41d3bb761c242bda310">SnpManipulateTextFrame::InspectTextFrame</a></ul><h3><a class="anchor" id="id_modifying_the_characteristics_of_a_text_frame"></a> Modifying the characteristics of a text frame</h3><p><b>Solution</b><p>Given a selection, follow these steps:<ol type="1"><li>Obtain the interface using <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> on the kUtils boss class.<li>Use <a class="el" href="class_i_text_frame_options_suite.html#adf69d1dc4639283447173e4eb413b3a1">ITextFrameOptionsSuite::CanApplyTextFrameOptions</a> to test the capability to modify options on the selection.<li>Use ITextFrameOptionsSuite::SetTextFrameOptionData to manipulate the options on the frame. This API takes a reference to the <a class="el" href="class_i_text_frame_options_data.html">ITextFrameOptionsData</a> interface. The API provides a boss class (<a class="el" href="classk_obj_styles_t_f_options_collect_data_boss.html">kObjStylesTFOptionsCollectDataBoss</a>) that can be used to hold the text frame options for this API.</ol><p>Given an arbitrary set of page items, there is no one way to manipulate text frame options. You can do the following:<ul><li>Change the number of columns with <a class="el" href="classk_change_number_of_columns_cmd_boss.html">kChangeNumberOfColumnsCmdBoss</a>.<li>Manipulate the text inset with <a class="el" href="classk_set_text_inset_cmd_boss.html">kSetTextInsetCmdBoss</a>.<li>Modify the column gutter with <a class="el" href="classk_set_column_gutter_cmd_boss.html">kSetColumnGutterCmdBoss</a>.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#a4c96a2936bfdc41256b23bd38808e650">SnpManipulateTextFrame::IncrementTextInset</a></ul><h3><a class="anchor" id="id_deleting_a_text_frame"></a> Deleting a text frame</h3><p><b>Solution</b><p>You delete page items holding text like any other page item. If the text is linked through other page items, it continues to exist (reflowing through linked items), and no text is deleted. If the text is contained only within the single page item, deleting the page item causes the associated text objects to be deleted.<p>To delete an arbitrary page item, use <a class="el" href="classk_delete_cmd_boss.html">kDeleteCmdBoss</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#a4e11c5ac9ea9ced775a1ced8fa62e9b2">SnpManipulateTextFrame::DeleteTextFrame</a></ul><h3><a class="anchor" id="id_detecting_whether_a_page_element_is_a_text_frame"></a> Detecting whether a page element is a text frame</h3><p>Arbitrary page items can contain text, and the relationship between container and text is maintained as an association between two sets of objects. You can determine whether a page item has this association.<p><b>Solution</b><p>Call <a class="el" href="class_i_page_item_type_utils.html#afc066f0fe2859ee7c88543359210f94c">IPageItemTypeUtils::IsTextFrame</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#ac4735b39c037f0296e8b0125708aa2f6">SnpManipulateTextFrame::IsTextFrame</a></ul><h3><a class="anchor" id="id_navigating_to_the_text_frame_for_a_page_item"></a> Navigating to the text frame for a page item</h3><p>Suppose you have a reference to a page element (that could have been obtained through a selection, for instance). You can navigate to the associated text container object(s) for that page element, assuming they exist.<p><b>Solution</b><ol type="1"><li>Obtain the hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) interface from the page item object. The text container objects are maintained as part of the page item hierarchy.<li>Child 0 (zero) on the hierarchy is a column object (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>) that represents the set of text columns an individual page item can have.<li>With respect to the hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) on the multi-column object, each child is an individual frame (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>), representing one column of text in the page item.<li>To get the parcel related to a particular frame, use the <a class="el" href="class_i_parcel.html">IParcel</a> interface on the frame item boss object (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>).<li>If you are interested in other parcels associated with the frame (for example, for a footnote), note the frame (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) object does not maintain the association. A list of all parcels used to display text for a particular story is provided through the frame list boss object (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>). You can obtain this interface from the frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) using <a class="el" href="class_i_parcel.html#a8daaca3d48f1345f0733c5a3d70b9033">IParcel::QueryParcelList</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#af8327fe0ea75d41d3bb761c242bda310">SnpManipulateTextFrame::InspectTextFrame</a></ul><h3><a class="anchor" id="id_navigating_to_the_text_frame_for_text_on_a_path"></a> Navigating to the text frame for text on a path</h3><p>Suppose you have a reference to a page element (that could have been obtained through a selection, for instance). You can navigate to the associated text container object(s) for text that might appear on the item&#39;s path.<p><b>Solution</b><ol type="1"><li>Obtain the hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) interface from the page item object (<a class="el" href="classk_t_o_p_spline_item_boss.html">kTOPSplineItemBoss</a>). The text container objects are maintained as part of the page item hierarchy.<li>Child 0 (zero) on the hierarchy is a column object (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>) that represents the set of text columns an individual page item can have.<li>With respect to the hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) on the multi-column object, there should be one frame item (<a class="el" href="classk_t_o_p_frame_item_boss.html">kTOPFrameItemBoss</a>) object.<li>To get the parcel related to a particular frame, use the <a class="el" href="class_i_parcel.html">IParcel</a> interface on the frame item boss object (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#af8327fe0ea75d41d3bb761c242bda310">SnpManipulateTextFrame::InspectTextFrame</a></ul><h3><a class="anchor" id="id_finding_the_range_of_characters_displayed_by_a_text_frame"></a> Finding the range of characters displayed by a text frame</h3><p>You can determine the range of the primary story thread displayed in a text frame. For details on accessing the raw text for a range, see <a class="el" href="id_solutions.html#id_story_text">Story text</a>.<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_multi_column_text_frame.html#a3d0da37d89103ad7794d38224b7dbf19">IMultiColumnTextFrame::TextSpan</a> to get the number of characters from the primary story thread that exist in the frame.<li>Use <a class="el" href="class_i_multi_column_text_frame.html#ac2bc1de034bee8de44f72848b89d0f83">IMultiColumnTextFrame::TextStart</a> to get the index within the primary story thread of the first character in the text frame.</ol><p>The range is from the text start until the text start plus the text span. It may include the final terminating character of the primary story thread. The range of characters relates to all columns of text in the text frame.<p>To get ranges of characters in a column, use the <a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a> interface. It has similar methods to those of <a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a>, but the range of characters it reports relates to the single column with which it is associated. Follow these steps:<ol type="1"><li>Use ITextFrameColumn::TextSpan to get the number of characters from the primary story thread that exist in the text column.<li>Use ITextFrameColumn::TextStart to get the index within the primary story thread of the first character in the text column.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#a1c305e955b13e384a61fb302148f3f9b">SnpManipulateTextFrame::GetTextFrameTextRange</a></ul><h3><a class="anchor" id="id_finding_the_page_item_that_displays_a_given_textindex"></a> Finding the page item that displays a given textindex</h3><p>You can get the text frame (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) for a given text index within a story.<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_text_model.html#a118dc2205e730831d38c4ef7a482df7a">ITextModel::QueryFrameList</a> to get the frame list (<a class="el" href="class_i_frame_list.html">IFrameList</a>) on the frame list boss object (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>).<li>Use <a class="el" href="class_i_frame_list.html#a83a3f2922d519daf48c8cd0ebd1cd63f">IFrameList::QueryFrameContaining</a> to get the text frame (<a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a>) for the frame boss object (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>).<li>Use <a class="el" href="class_i_hierarchy.html#ae2521e931f5d4f3b7bba6260f2e883f0">IHierarchy::QueryParent</a> to get the multi-column frame item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). Use the equivalent call on the multi-column item to get the page item (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>).</ol><dl class="section note"><dt>Note<dd>The index need not belong to the primary story thread; it could reference text within another story thread, like a table cell or footnote.</dl><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#a1bd0e121c203a08fc4e4ca7020508dac">SnpManipulateTextFrame::QueryTextFrameContaining</a></ul><h3><a class="anchor" id="id_finding_the_story_associated_with_a_parcel"></a> Finding the story associated with a parcel</h3><p>Given a parcel (<a class="el" href="class_i_parcel.html">IParcel</a>), you can determine the story with which it is associated.<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Use IParcel::QueryFrame on the parcel object to get the text frame interface (<a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a>) on the text frame boss object (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) with which the parcel is associated.<li>Use <a class="el" href="class_i_text_frame_column.html#a656a433d19a2c889c24235b131fbb727">ITextFrameColumn::QueryTextModel</a> to get the text model for the text that flows in the text frame.</ol><p>Alternatively, navigate using the text parcel list (<a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>), as follows:<ol type="1"><li>Use <a class="el" href="class_i_parcel.html#a8daaca3d48f1345f0733c5a3d70b9033">IParcel::QueryParcelList</a> on the parcel object to get the parcel list (<a class="el" href="class_i_parcel_list.html">IParcelList</a>) that maintains the relationship for associated parcels.<li>Use ITextParcelList::GetTextModelRef to get the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for the text model (kTextModelRef) associated with the parcel. <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a> is on the same boss object as the <a class="el" href="class_i_parcel_list.html">IParcelList</a> interface.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_estimate_text_depth.html#a1d303a3b1c15eb3ba92e4c683a944ac8">SnpEstimateTextDepth::GetParcelTextRange</a></ul><h3><a class="anchor" id="id_finding_the_range_of_text_displayed_by_a_parcel"></a> Finding the range of text displayed by a parcel</h3><p>You can determine the range of a particular text story displayed in a particular parcel (<a class="el" href="class_i_parcel.html">IParcel</a>).<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Use IParcel::GetParcelKey to obtain the parcel key.<li>Use <a class="el" href="class_i_parcel.html#a8daaca3d48f1345f0733c5a3d70b9033">IParcel::QueryParcelList</a> on the parcel object to get the parcel list (<a class="el" href="class_i_parcel_list.html">IParcelList</a>) that maintains the relationship between text story threads and associated parcels.<li>Get the text parcel list interface (<a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>) from the same boss object.<li>ITextParcelList::GetTextRange returns the range of text in the specified parcel.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_text_model_helper.html#a37191eca6f9975b689158110761be61c">SnpTextModelHelper::GetParcelTextRange</a><li><a class="el" href="class_snp_text_model_helper.html#ab275ed63b21568b8ea08c61065c245e7">SnpTextModelHelper::GetWideStringFromParcel</a></ul><p>For details on accessing the raw text for a particular range, see <a class="el" href="id_solutions.html#id_story_text">Story text</a>.<h3><a class="anchor" id="id_finding_the_parcel_that_displays_a_textindex"></a> Finding the parcel that displays a TextIndex</h3><p>Given a particular text story (<a class="el" href="class_i_text_model.html">ITextModel</a>), you can find the parcel (<a class="el" href="class_i_parcel.html">IParcel</a>) into which the text from a particular index in the text model is composed.<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_text_model.html#a4a24897e56c10c9d06e72f370c32f37a">ITextModel::QueryTextParcelList</a> to get the text parcel list (<a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>).<li>ITextParcelList::GetParcelContaining returns the key for the parcel you need.<li>Get the parcel list interface (<a class="el" href="class_i_parcel_list.html">IParcelList</a>) from the same boss object as <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>.<li>IParcelList::GetParcelContaining returns the required parcel (<a class="el" href="class_i_parcel.html">IParcel</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_text_model_helper.html#abb4431979654dd75047f2c89a158f4ef">SnpTextModelHelper::QueryParcelContaining</a></ul><h3><a class="anchor" id="id_detecting_overset_stories"></a> Detecting overset stories</h3><p>The following figure shows a story that is overset: the combined area of all linked frames associated with the story is not large enough to contain the text in the story. The figure shows a story associated with two linked frames. Both frames are overset, as is the story. You can determine whether a story is overset.<div class="image"><img alt="solutions-1.gif" src="solutions-1.gif" /></div><p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Navigate to the frame list boss (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>), in one of two ways. If dealing with a page item, you can use <a class="el" href="class_i_hierarchy.html#af345ca29851669d1e0917f52e6660032">IHierarchy::QueryChild</a>, then <a class="el" href="class_i_multi_column_text_frame.html#aea695d1736de48e6bf6a7d4be58a59b7">IMultiColumnTextFrame::QueryFrameList</a> from the multi-column boss object (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). If dealing with a text story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), you can use <a class="el" href="class_i_text_model.html#a118dc2205e730831d38c4ef7a482df7a">ITextModel::QueryFrameList</a>.<li>Use <a class="el" href="class_i_text_utils.html#a7062f79aac31991e66ed9f7b3b1ba3d5">ITextUtils::IsOverset</a> (the interface is available on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>) to determine whether all the text is represented in a parcel. If only the final (required) carriage return is overset, the text is not defined to be overset.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_estimate_text_depth.html#a49033160f5199fb62239a253e0cbddd1">SnpEstimateTextDepth::IsStoryOverset</a></ul><h3><a class="anchor" id="id_detecting_overset_text_frames"></a> Detecting overset text frames</h3><p>The figure in <a class="el" href="id_solutions.html#id_detecting_overset_stories">Detecting overset stories</a> shows two linked text frames associated with a story. Both are said to be overset, as the text in the story overruns each frame. You can determine whether a text frame is overset.<p><b>Solution</b><p>If the frame has a span of 0 (zero), it is underset (that is, no characters flow into it from a preceding frame). If the final character of the primary story thread, not including the mandatory carriage return, does not exist in the frame, it is overset.<p>The text must be fully composed. Follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_multi_column_text_frame.html#a3d0da37d89103ad7794d38224b7dbf19">IMultiColumnTextFrame::TextSpan</a> to get number of characters in the frame. If this is 0 (zero), the frame is underset.<li>Use <a class="el" href="class_i_multi_column_text_frame.html#ac2bc1de034bee8de44f72848b89d0f83">IMultiColumnTextFrame::TextStart</a> to get the starting character for the primary story thread within the frame. Add the text span to get the primary story thread index for the last character displayed in the text frame.<li>Use <a class="el" href="class_i_multi_column_text_frame.html#ad0a4fc40529e686d645579ab20256915">IMultiColumnTextFrame::QueryTextModel</a> to get the text model (<a class="el" href="class_i_text_model.html">ITextModel</a>) interface on the text story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>).<li>Use <a class="el" href="class_i_text_model.html#af1103745d4336643788243a63610d32e">ITextModel::GetPrimaryStoryThreadSpan</a> to get the number of characters in the primary story thread. If this number is greater than the index of the last character in the frame (calculated above), the text frame is overset.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_estimate_text_depth.html#a1f1e8e9b2943a9b44b37e46ed8933220">SnpEstimateTextDepth::IsTextFrameOverset</a></ul><h3><a class="anchor" id="id_detecting_overset_parcels"></a> Detecting overset parcels</h3><p>You can determine whether the characters in a particular story thread extend beyond a particular parcel (<a class="el" href="class_i_parcel.html">IParcel</a>).<p><b>Solution</b><p>If the parcel has a span of 0 (zero), it is underset (that is, no characters flow into it from a preceding parcel). If the final character of the primary story thread, not including the mandatory carriage return, does not exist in the parcel, it is overset.<p>This solution depends on the text being fully composed.<p>To detect is a parcel is overset, follow these steps:<ol type="1"><li>Use IParcel::GetParcelKey to obtain the parcel key.<li>Use <a class="el" href="class_i_parcel.html#a8daaca3d48f1345f0733c5a3d70b9033">IParcel::QueryParcelList</a> on the parcel object to get the parcel list (<a class="el" href="class_i_parcel_list.html">IParcelList</a>) that maintains the relationship between text story threads and associated parcels.<li>Get the text parcel list interface (<a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>) from the same boss object.<li>Use <a class="el" href="class_i_text_parcel_list.html#a95ca2231621bc080cb2ed0e6939024b5">ITextParcelList::GetParcelIsEmpty</a> to determine whether the parcel is empty. If so, is underset.<li>Use ITextParcelList::QueryStoryThread to get the story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) that represents the text in the parcel list.<li>Use <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>:GetTextSpan to get the number of characters in the text story thread that is composed into this particular parcel list.<li>Use ITextParcelList::GetParcelContaining to access the parcel key that contains the final character for the text story thread. If this parcel key differs from the parcel key obtained above, the parcel is overset.</ol><p><b>Sample code</b><ul><li>SnpEstimateTextDepth::IsParcelOverset</ul><h3><a class="anchor" id="id_determining_whether_text_is_on_a_path_top"></a> Determining whether text is &quot;on a path&quot; (TOP)</h3><p>Given a particular index, you can determine whether the composed text referred to by the index falls on a spline (rather than within a standard text frame (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>).<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Obtain the frame item (in this case a <a class="el" href="classk_t_o_p_frame_item_boss.html">kTOPFrameItemBoss</a>) for the index as you would any other frame item. See <a class="el" href="id_solutions.html#id_finding_the_page_item_that_displays_a_given_textindex">Finding the page item that displays a given textindex</a>.<li>Test the frame item for the signature interface, <a class="el" href="class_i_t_o_p_frame_data.html">ITOPFrameData</a>.</ol><h3><a class="anchor" id="id_threading_text_frames"></a> Threading text frames</h3><p>Given two text containers (<a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a>), you can link them to allow one story to be associated with both.<p><b>Solution</b><p>Use <a class="el" href="class_i_text_utils.html#a758846fca28a85fa9e1d45d7b8f0e014">ITextUtils::LinkTextFrames</a> to link the two frames. If you need finer control over what happens with the text contained within the preexisting text frames, first manipulate the text content in the required fashion (see <a class="el" href="id_solutions.html#id_story_text">Story text</a>), then use the <a class="el" href="classk_text_link_cmd_boss.html">kTextLinkCmdBoss</a> to link the frames. This command requires the <a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a> for both frames to be linked to be placed on the command&#39;s item list.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#a7fe0cfe33906d80ff4b4cc18e2b54ddf">SnpManipulateTextFrame::CanThreadTextFrames</a><li><a class="el" href="class_snp_manipulate_text_frame.html#a56cc78c724ffa802b9165a1e50b8ad44">SnpManipulateTextFrame::ThreadTextFrames</a></ul><h3><a class="anchor" id="id_unthreading_text_frames"></a> Unthreading text frames</h3><p>Given two linked text frames (<a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a>), you can unlink them.<p><b>Solution</b><p>Use <a class="el" href="classk_text_unlink_cmd_boss.html">kTextUnlinkCmdBoss</a>, passing in the frame the break is to occur after, on the command item list.<p><b>Sample code</b><ul><li>SnpManipulateTextFrame::CanUnlinkTextFrame<li>SnpManpulateTextFrame::UnlinkTextFrames</ul><h3><a class="anchor" id="id_navigating_between_threaded_text_frames"></a> Navigating between threaded text frames</h3><p>Given a text frame (<a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a>), you can navigate to the next frame through which the primary story thread flows.<p><b>Solution</b><ol type="1"><li>Use <a class="el" href="class_i_multi_column_text_frame.html#aea695d1736de48e6bf6a7d4be58a59b7">IMultiColumnTextFrame::QueryFrameList</a> to get the list of frames.<li><a class="el" href="class_i_frame_list.html#a8c51127c6389b4316f8f0cedcd002161">IFrameList::GetFrameIndex</a> returns the index of the current frame in the list of frames.<li>Use <a class="el" href="class_i_frame_list.html#a24313f751ce97cdccaadfb2de8ddefde">IFrameList::GetFrameCount</a> to get the total number of frames in the list.<li>Use <a class="el" href="class_i_frame_list.html#a602faaf16e81a27d8f7e32d02f3b07f1">IFrameList::QueryNthFrame</a> to get a specified frame.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#ac217f2fa5293d49c26c38a0a95227d4f">SnpManipulateTextFrame::InspectFrameList</a></ul><h3><a class="anchor" id="id_modifying_text_frame_options"></a> Modifying text frame options</h3><p>A text frame has a set of associated options that describe how the text flows within the container, including the following:<ul><li>Number of columns.<li>Column width.<li>Gutter (space between columns) width.</ul><p>You can modify the options for a text frame.<p><b>Solution</b><p>To change the frame options for the current selection, use the <a class="el" href="class_i_text_frame_options_suite.html">ITextFrameOptionsSuite</a> suite. For example, to increment the number of columns, follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> (on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> class) to get the text frame options suite interface (<a class="el" href="class_i_text_frame_options_suite.html">ITextFrameOptionsSuite</a>).<li>Use <a class="el" href="class_i_text_frame_options_suite.html#a299d234694b15dcbd03680adf65e7abd">ITextFrameOptionsSuite::GetColumnsAndGutter</a> to get the number of existing columns.<li>Use <a class="el" href="class_i_text_frame_options_suite.html#adf69d1dc4639283447173e4eb413b3a1">ITextFrameOptionsSuite::CanApplyTextFrameOptions</a> to test the ability to modify the frame options.<li>This suite uses a data object to maintain the collection of options available for text frame. The API provides an implementation that can be used (see <a class="el" href="class_i_text_frame_options_data.html">ITextFrameOptionsData</a> interface available on <a class="el" href="classk_obj_styles_t_f_options_collect_data_boss.html">kObjStylesTFOptionsCollectDataBoss</a>). Create this boss object, and set the required state.<li>Use ITextFrameOptionsSuite::SetTFOColumns to apply the new columns value defined in the data object to the selection.</ol><p>To change the frame options for an arbitrary text frame (<a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a> on <a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>), use API-supplied commands. See the following figure, which shows commands that Mutate Text Frame Options:<div class="image"><img alt="solutions-2.gif" src="solutions-2.gif" /></div><p><b>Sample code</b><ul><li>See the <a class="el" href="class_snp_manipulate_text_frame.html#a8cb0ae717ba28636fc7288e6920ee976">SnpManipulateTextFrame::IncrementNumberOfColumns</a> for an example of using lower-level commands to modify text-frame options.</ul><h3><a class="anchor" id="id_modifying_the_default_text_frame_options"></a> Modifying the default text frame options</h3><p><b>Description</b><p>A text frame has a set of associated options that describe how the text flows within the container. These options exist on the workspace (the session workspace, which is inherited by new documents on the document workspace). They include the following:<ul><li>Number of columns.<li>Column width.<li>Gutter (space between columns) width.</ul><p>You can modify the default options for a text frame.<p><b>Solution</b><p>Use the <a class="el" href="class_i_text_frame_options_suite.html">ITextFrameOptionsSuite</a> suite. For example, to increment the number of columns, follow these steps:<ol type="1"><li>Use <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> (on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> class) to get the text frame options suite interface (<a class="el" href="class_i_text_frame_options_suite.html">ITextFrameOptionsSuite</a>). With no open document, the suite applies to the session workspace defaults. With a document open and no selection, the suite applies to the document workspace defaults.<li>Use <a class="el" href="class_i_text_frame_options_suite.html#a299d234694b15dcbd03680adf65e7abd">ITextFrameOptionsSuite::GetColumnsAndGutter</a> to get the number of existing columns.<li>Use <a class="el" href="class_i_text_frame_options_suite.html#adf69d1dc4639283447173e4eb413b3a1">ITextFrameOptionsSuite::CanApplyTextFrameOptions</a> to test the ability to modify the frame options.<li>This suite uses a data object to maintain the collection of options available for text frame. The API provides an implementation that can be used (see <a class="el" href="class_i_text_frame_options_data.html">ITextFrameOptionsData</a> interface available on <a class="el" href="classk_obj_styles_t_f_options_collect_data_boss.html">kObjStylesTFOptionsCollectDataBoss</a>). Create this boss object, and set the required state.<li>Use ITextFrameOptionsSuite::SetTFOColumns to apply the new columns value defined in the data object to the selection.</ol><p>Alternatively, to modify the default settings regardless of whether a document is open (for example, to target a particular document or the session default value rather than the front-most document default value), use <a class="el" href="classk_set_frame_prefs_cmd_boss.html">kSetFramePrefsCmdBoss</a>. See the following figure, which shows the relationships between workspaces and text-frame options.<p>This figure shows commands that mutate and use default text-frame options: <div class="image"><img alt="solutions-3.gif" src="solutions-3.gif" /></div><h3><a class="anchor" id="id_manipulating_text_wrap"></a> Manipulating text wrap</h3><p>A page item can define a relationship with text. This relationship specifies what happens when a text frame overlaps the page item, and it affects line-wrapping behavior. The behavior that can be specified includes the following:<ul><li>Wrapping text around the page item bounding box.<li>Wrapping text around the spline shape.<li>Flowing text only where the frame and bounding box (or spline shape) of the page item intersect.</ul><p>You can prescribe the wrapping behavior that a page item can enforce on text it overlaps.<p><b>Solution</b><p>Use <a class="el" href="class_facade_1_1_i_text_wrap_facade.html">Facade::ITextWrapFacade</a> to control text-wrapping behavior.<p>Sometimes, you may need to use lower-level API commands such as the following:<ul><li><a class="el" href="classk_stand_off_mode_cmd_boss.html">kStandOffModeCmdBoss</a><li><a class="el" href="classk_stand_off_form_cmd_boss.html">kStandOffFormCmdBoss</a><li><a class="el" href="classk_stand_off_margin_cmd_boss.html">kStandOffMarginCmdBoss</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_text_frame.html#aeb563847ec61425625f5b9077345ce7b">SnpManipulateTextFrame::ChangeTextWrapMode</a></ul><h2><a class="anchor" id="id_rendered_text"></a> Rendered text</h2><p>This section contains common use cases related to rendered text. The set of glyphs that make up rendered text is called the wax.<h3><a class="anchor" id="id_getting_notified_of_composition_completion"></a> Getting notified of composition completion</h3><p>You can determine when text is composed.<p><b>Solution</b><p>On completion of composition within a text frame, the message kRecomposeBoss is transmitted along the IID_IFRAMECOMPOSER protocol to the frame item(kFrameItemBoss), spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), and document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). To be notified of composition completion, attach an observer to one of these objects. Which object you attach to depends on whether you want to restrict the notifications to a single spread or page item.<h3><a class="anchor" id="id_iterating_the_wax_for_a_story"></a> Iterating the wax for a story</h3><p>The <a class="el" href="class_snp_inspect_text_model.html#a7f16d44ea928bb6d04aa24df5d35954e">SnpInspectTextModel::ReportWaxLineLeading</a> SDK snippet iterates over each wax line and reports the leading for all lines of text in a story.<p>You must keep your <a class="el" href="class_i_wax_iterator.html">IWaxIterator</a> in scope, to keep an <a class="el" href="class_i_wax_line.html">IWaxLine</a> interface pointer valid. The following sample code demonstrates a common error caused when <a class="el" href="class_i_wax_iterator.html">IWaxIterator</a> is not kept in scope: <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="class_i_wax_line.html">IWaxLine</a>* QueryWaxLineContaining( <a class="code" href="class_i_wax_strand.html">IWaxStrand</a>* waxStrand, <span class="keyword">const</span> TextIndex&amp; textIndex){</div><div class="line"><a class="code" href="class_i_wax_line.html">IWaxLine</a>* line = nil;</div><div class="line"><span class="keywordflow">do</span>{</div><div class="line"><a class="code" href="class_k2_1_1scoped__ptr.html">K2::scoped_ptr&lt;IWaxIterator&gt;</a> waxIterator = waxIterator(waxStrand-&gt;<a class="code" href="class_i_wax_strand.html#aaf6fe3d7553e9a059764e4a295c8f4d3">NewWaxIterator</a>());</div><div class="line"><span class="keywordflow">if</span> (waxIterator == nil)</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><a class="code" href="class_i_wax_line.html">IWaxLine</a>* waxLine = waxIterator-&gt;<a class="code" href="class_i_wax_iterator.html#ab37df301fc067a454b83e53c4b42e68d">GetFirstWaxLine</a>(textIndex);</div><div class="line"><span class="keywordflow">if</span> (waxLine == nil)</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> line = waxLine;</div><div class="line"> line-&gt;<a class="code" href="class_i_p_m_unknown.html#aa90872f1896d2f2623cbb6f0bff98443">AddRef</a>();</div><div class="line"><span class="comment">// associated IWaxLine no longer valid when IWaxIterator is destructed.</span></div><div class="line"> } <span class="keywordflow">while</span>(<span class="keyword">false</span>);</div><div class="line"><span class="keywordflow">return</span> line; <span class="comment">// Not a valid IWaxLine</span></div><div class="line">}</div></div><p>To maintain references to several wax lines simultaneously, keep a wax iterator in scope for each wax line. The sample code discussed in <a class="el" href="id_solutions.html#id_estimating_the_composed_depth_of_text_in_a_frame_or_parcel">Estimating the composed depth of text in a frame or parcel</a> demonstrates this.<h3><a class="anchor" id="id_creating_wax_lines_and_wax_runs"></a> Creating wax lines and wax runs</h3><p>Wax lines and wax runs are created by a paragraph composer. The SingleLineComposer SDK sample is a paragraph composer that works on one line at a time. This sample demonstrates the construction of wax lines and wax runs.<h3><a class="anchor" id="id_finding_the_wax_displayed_for_a_range_of_text"></a> Finding the wax displayed for a range of text</h3><p>You can access the wax for a particular range of text.<p><b>Solution</b><p>The text must be fully composed:<ol type="1"><li>Navigate to the frame list boss (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>), in one of two ways. If dealing with a page item, use <a class="el" href="class_i_hierarchy.html#af345ca29851669d1e0917f52e6660032">IHierarchy::QueryChild</a>, then <a class="el" href="class_i_multi_column_text_frame.html#aea695d1736de48e6bf6a7d4be58a59b7">IMultiColumnTextFrame::QueryFrameList</a> from the multi-column boss object (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). If dealing with a text story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), use <a class="el" href="class_i_text_model.html#a118dc2205e730831d38c4ef7a482df7a">ITextModel::QueryFrameList</a>.<li>Obtain the wax strand (<a class="el" href="class_i_wax_strand.html">IWaxStrand</a>) from the same boss object.<li>Use <a class="el" href="class_i_wax_strand.html#aaf6fe3d7553e9a059764e4a295c8f4d3">IWaxStrand::NewWaxIterator</a> to get and iterator for the composed wax.<li>IWaxStrand::GetFirstWaxLine (IWaxStrand::GetNextWaxLine) returns a wax line (<a class="el" href="class_i_wax_line.html">IWaxLine</a> on <a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_estimate_text_depth.html">SnpEstimateTextDepth</a></ul><h3><a class="anchor" id="id_estimating_the_composed_depth_of_text_in_a_frame_or_parcel"></a> Estimating the composed depth of text in a frame or parcel</h3><p>You can estimate the depth of text in a text frame (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>).<p><b>Solution</b><p>The text must be fully composed. Follow these steps:<ol type="1"><li>Navigate to the frame list boss (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>), in one of two ways. if dealing with a page item, use <a class="el" href="class_i_hierarchy.html#af345ca29851669d1e0917f52e6660032">IHierarchy::QueryChild</a>, then <a class="el" href="class_i_multi_column_text_frame.html#aea695d1736de48e6bf6a7d4be58a59b7">IMultiColumnTextFrame::QueryFrameList</a> from the multi-column boss object (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). if dealing with a text story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), use <a class="el" href="class_i_text_model.html#a118dc2205e730831d38c4ef7a482df7a">ITextModel::QueryFrameList</a>.<li>Obtain the wax strand (<a class="el" href="class_i_wax_strand.html">IWaxStrand</a>) from the same boss object.<li>User <a class="el" href="class_i_wax_strand.html#aaf6fe3d7553e9a059764e4a295c8f4d3">IWaxStrand::NewWaxIterator</a> to get an iterator for the composed wax. It takes an index into the wax; determine the start character index and end character index for the range of text you want to estimate. Create an iterator for each of these.<li>Use IWaxStrand::GetFirstWaxLine to get the wax line (<a class="el" href="class_i_wax_line.html">IWaxLine</a> on <a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a>) for each iterator. You now have the wax line (<a class="el" href="class_i_wax_line.html">IWaxLine</a>) relating to the first and last lines in the frame/parcel.<li>Use <a class="el" href="class_i_wax_line.html#a2c4997618ce2ef8f08a8a144858c5993">IWaxLine::GetYPosition</a> to get the y position for the wax line. For horizontal text, the depth of the text in a frame can be roughly estimated as the y position of the last line of wax in the frame, minus the y position of the first line, plus the leading for the first line.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_estimate_text_depth.html">SnpEstimateTextDepth</a></ul><h2><a class="anchor" id="id_text_composition"></a> Text composition</h2><h3><a class="anchor" id="id_the_need_to_recompose_text_in_a_story"></a> The need to recompose text in a story</h3><p>Normally, damaged text that requires recomposition is fixed by background composition. Your code, however, may find that the text in which it is interested is damaged; if so, it can force recomposition to fix the damage. For example, always check for damage before scanning the wax or relying on any spans that indicate the range of text stored in a frame or parcel.<h3><a class="anchor" id="id_recomposing_text"></a> Recomposing text</h3><p>You can recompose text within a story by either the index into the text model (TextIndex) or the visual container used to display the text (a frame or parcel). The most general approach is to use the parcel list composer (<a class="el" href="class_i_text_parcel_list_composer.html">ITextParcelListComposer</a>), which works for any text that can be composed. For example, it works whether the text is displayed in a frame or a table cell.<p>Do not assume that all text in the text model can be composed. Some features may store text in the text model that is never composed for display. See HidTxtParcelListComposer.cpp in the HiddenText example.<p>The following examples show the most common approaches used to force text to be recomposed.<p>This example shows recomposing story text by TextIndex using <a class="el" href="class_i_text_parcel_list_composer.html">ITextParcelListComposer</a>: <div class="fragment"><div class="line"><span class="comment">// Recompose text up to a given TextIndex. By using the parcel list </span></div><div class="line"><span class="comment">// composer, you can compose text that is displayed in frames, tables, or </span></div><div class="line"><span class="comment">// any other feature that supports text composition.</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MyRecomposeThruTextIndex(<a class="code" href="class_i_text_model.html">ITextModel</a>* textModel, TextIndex at){</div><div class="line"><span class="keywordflow">if</span> (at &gt;= 0 &amp;&amp; at &lt; textModel-&gt;TotalLength()) {</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextParcelList&gt;</a> tpl(textModel-&gt;<a class="code" href="class_i_text_model.html#a4a24897e56c10c9d06e72f370c32f37a">QueryTextParcelList</a>(at));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextParcelListComposer&gt;</a> tplc(tpl, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (tplc) {</div><div class="line"> tplc-&gt;RecomposeThruTextIndex(at);</div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><p>This example shows recomposing by parcel using <a class="el" href="class_i_text_parcel_list_composer.html">ITextParcelListComposer</a>: <div class="fragment"><div class="line"><span class="comment">// Recompose text in the given parcel and preceding damaged parcels.</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MyRecomposeThruParcel(<a class="code" href="class_i_parcel.html">IParcel</a>* parcel){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IParcelList&gt;</a> pl(parcel-&gt;<a class="code" href="class_i_parcel.html#a8daaca3d48f1345f0733c5a3d70b9033">QueryParcelList</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextParcelList&gt;</a> tpl(pl, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextParcelListComposer&gt;</a> tplc(tpl, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (tplc) </div><div class="line"> {</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_parcel_key.html">ParcelKey</a> key = parcel-&gt;GetParcelKey();</div><div class="line"> tplc-&gt;RecomposeThruNthParcel(pl-&gt;GetParcelIndex(key));</div><div class="line"> }</div><div class="line">}</div></div><p>This example shows recomposing story text by TextIndex using <a class="el" href="class_i_frame_list_composer.html">IFrameListComposer</a>: <div class="fragment"><div class="line"><span class="comment">// Recompose text in the primary story thread up to a given TextIndex.</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MyRecomposeThruTextIndexByFrameList(<a class="code" href="class_i_text_model.html">ITextModel</a>* textModel, TextIndex at){</div><div class="line"><span class="keywordflow">if</span> (at &gt;= 0 &amp;&amp; at &lt; textModel-&gt;GetPrimaryStoryThreadSpan()) {</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFrameList&gt;</a> frameList(textModel-&gt;<a class="code" href="class_i_text_model.html#a118dc2205e730831d38c4ef7a482df7a">QueryFrameList</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFrameListComposer&gt;</a> flc(frameList, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (flc) {</div><div class="line"> flc-&gt;RecomposeThruTextIndex(at);</div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_recomposing_all_stories_in_a_document"></a> Recomposing all stories in a document</h3><p><a class="el" href="class_i_global_recompose.html">IGlobalRecompose</a> provides methods that force all stories to recompose. The interface marks damage that forces recomposition, even though the stories have not changed. See the following example, which recomposes all stories in a document: <div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MyRecomposeAllStories(<a class="code" href="class_i_document.html">IDocument</a>* document){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGlobalRecompose&gt;</a> globalRecompose(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (globalRecompose != nil) {</div><div class="line"> globalRecompose-&gt;RecomposeAllStories();</div><div class="line"> globalRecompose-&gt;ForceRecompositionToComplete();</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_getting_notified_when_text_is_recomposed"></a> Getting notified when text is recomposed</h3><p>It is hard to observe recomposition, because to do so, you need to maintain an observer on each frame (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>). See <a class="el" href="id_solutions.html#id_observing_changes_that_affect_text">Observing changes that affect text</a> for an alternative approach that relies on observing the cause rather than the effect.<h3><a class="anchor" id="id_observing_changes_that_affect_text"></a> Observing changes that affect text</h3><p>Because many types of changes affect text, observing changes quickly becomes complex; for example:<ul><li>Changes to the geometry of the text layout (such as resize and text inset) are observed using a document observer.<li>Changes to character and text attributes are observed by attaching an observer to each text model of interest.<li>Changes to text styles are observed by attaching observers to the style name tables in the workspace.</ul><p>An optimal strategy is to be aware recomposition has occurred and not try to observe everything that might happen.<p>Any change to text, attributes, styles, or layout that affects lines breaks causes damage. The change counter on the frame list (<a class="el" href="class_i_frame_list.html#a32591fe34dc730d42c864ffaafb82ae2">IFrameList::GetChangeCounter</a>) is incremented any time something happens that requires recomposition. No notification is broadcast when the change counter is incremented, so you cannot catch the change immediately. In general, though, immediate feedback is not needed; the fact that something changed in a way that affects text needs to be determined only at fixed times.<p>For example, export a story from InDesign to a copy-editor application. When the story is imported back into InDesign, you may want to tell the user about changes to the layout or text styling that were made through InDesign. To arrange this, cache the value of <a class="el" href="class_i_frame_list.html#a32591fe34dc730d42c864ffaafb82ae2">IFrameList::GetChangeCounter</a> when you export the story. You can then compare this cached value to the actual value when the story is imported. To notify users when layout changes are made that affect text, check <a class="el" href="class_i_frame_list.html#a32591fe34dc730d42c864ffaafb82ae2">IFrameList::GetChangeCounter</a> using an idle task.<h3><a class="anchor" id="id_controlling_the_paragraph_composer_used_to_compose_text"></a> Controlling the paragraph composer used to compose text</h3><p>In the &quot;Text Fundamentals&quot; chapter of Adobe InDesign Programming Guide, see the section on &quot;Paragraph Composers&quot; for information on how to control the paragraph composer used to compose text. Programmatically, set the <a class="el" href="classk_text_attr_composer_boss.html">kTextAttrComposerBoss</a> paragraph attribute to reference the paragraph composer to be used.<h3><a class="anchor" id="id_scanning_text"></a> Scanning text</h3><p>If you require access to only the character code data of a story, the simplest API to use is the <a class="el" href="class_text_iterator.html">TextIterator</a> class. There are many code snippets that show how it is used, including <a class="el" href="class_snp_inspect_text_model.html#abfd3fe209c62401eaee669118f991451">SnpInspectTextModel::ReportCharacters</a>. If you do not want to process character by character, use <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> to access the characters in a story in larger chunks. For a fully functional example, see the TextExportFilter SDK plug-in.<p>To access styled runs of text, use <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a>. For an example, see <a class="el" href="id_solutions.html#id_estimating_text_width">Estimating text width</a>.<h3><a class="anchor" id="id_estimating_text_width"></a> Estimating text width</h3><p>You can estimate of the width of a character string for a given horizontal font using <a class="el" href="class_i_font_instance.html#abc4468c9ad22e65d05471ba435b06325">IFontInstance::MeasureWText</a>. Code in the FrameLabel SDK sample plug-in FrmLblAdornment::GetPaintedBBox() demonstrates how to do this.<p>To apply this estimate to a range of text in a story, use <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> to access runs of characters with the same drawing style. The following example, EstimateTextWidth, illustrates this. <div class="fragment"><div class="line"><span class="comment">// Returns estimated width of given text range by scanning text using IComposeScanner, then estimating width using IFontInstance.</span></div><div class="line"><span class="comment">//@param textModel text model to be scanned. </span></div><div class="line"><span class="comment">//@param startingIndex of the first character to be measured.</span></div><div class="line"><span class="comment">//@param span the number of characters to be measured. </span></div><div class="line"><span class="comment">//@return total estimated width of a given text range.</span></div><div class="line"><span class="keyword">static</span> <a class="code" href="class_p_m_real.html">PMReal</a> EstimateTextWidth( <a class="code" href="class_i_text_model.html">ITextModel</a>* textModel, <span class="keyword">const</span> TextIndex&amp; startingIndex, <span class="keyword">const</span> int32&amp; span) {</div><div class="line"><span class="comment">// Use the story&#39;s compose scanner to access the text.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IComposeScanner&gt;</a> composeScanner(textModel, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> ASSERT(composeScanner);</div><div class="line"><span class="keywordflow">if</span> (!composeScanner) </div><div class="line"><span class="keywordflow">return</span> <a class="code" href="class_p_m_real.html">PMReal</a>(0.0); </div><div class="line"><span class="comment">// Width of the given text range.</span></div><div class="line"><a class="code" href="class_p_m_real.html">PMReal</a> totalWidth = ::ToPMReal(0.0);</div><div class="line"><span class="comment">// Drawing style for the current run.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDrawingStyle&gt;</a> drawingStyle(nil); </div><div class="line"><span class="comment">// Font for the current run.</span></div><div class="line"><a class="code" href="class_interface_ptr_3_01_i_font_instance_01_4.html">InterfacePtr&lt;IFontInstance&gt;</a> fontInstance(nil);</div><div class="line"><span class="comment">// Current index into the text model.</span></div><div class="line"> TextIndex index = startingIndex; </div><div class="line"><span class="comment">// Number of characters still to be processed</span></div><div class="line"> int32 length = span; </div><div class="line"><span class="comment">// Number of characters returned by the compose scanner.</span></div><div class="line"> int32 chunkLength = 0; </div><div class="line"><span class="comment">// Character buffer.</span></div><div class="line"><a class="code" href="class_wide_string.html">WideString</a> run; </div><div class="line"><span class="comment">// The compose scanner may not return all the text </span></div><div class="line"><span class="comment">// in one call. So call it in a loop.</span></div><div class="line"><span class="keywordflow">while</span> (length &gt; 0) { </div><div class="line"><span class="comment">// Drawing style for the next run.</span></div><div class="line"><a class="code" href="class_i_drawing_style.html">IDrawingStyle</a>* nextDrawingStyle = nil;</div><div class="line"><span class="comment">// Get a chunk of text.</span></div><div class="line"><a class="code" href="class_text_iterator.html">TextIterator</a> iter = composeScanner-&gt;QueryDataAt(index, &amp;nextDrawingStyle, &amp;chunkLength);</div><div class="line"><span class="keywordflow">if</span> (iter.IsNull() &acirc;&#148;&#130;&acirc;&#148;&#130; chunkLength == 0) <span class="keywordflow">break</span>; <span class="comment">// no more text.</span></div><div class="line"> ASSERT(nextDrawingStyle);</div><div class="line"><span class="keywordflow">if</span> (!nextDrawingStyle) <span class="keywordflow">break</span>; </div><div class="line"><span class="comment">// If the drawing style changes measure the width of </span></div><div class="line"><span class="comment">// buffered text and switch to the new style and font.</span></div><div class="line"><span class="keywordflow">if</span> (nextDrawingStyle != drawingStyle) {</div><div class="line"><span class="keywordflow">if</span> (run.<a class="code" href="class_unicode_savvy_string.html#a943512b68899644891f01220d8d29c1f">CharCount</a>() &gt; 0) {</div><div class="line"> totalWidth += EstimateStringWidth(run, fontInstance);</div><div class="line"> run.Clear();</div><div class="line"> }</div><div class="line"> drawingStyle.reset(nextDrawingStyle);</div><div class="line"> fontInstance.reset(drawingStyle-&gt;QueryFontInstance(kFalse)); <span class="comment">// assume horizontal.</span></div><div class="line"> ASSERT(fontInstance);</div><div class="line"><span class="keywordflow">if</span> (!fontInstance) <span class="keywordflow">break</span>;</div><div class="line"> } <span class="comment">// end drawing style change</span></div><div class="line"><span class="keywordflow">else</span> { </div><div class="line"><span class="comment">// No change to drawing style but we still need to release.</span></div><div class="line"> nextDrawingStyle-&gt;<a class="code" href="class_i_p_m_unknown.html#a9365365afb903ae6a6450593930a0f9c">Release</a>();</div><div class="line"> nextDrawingStyle = nil;</div><div class="line"> } </div><div class="line"><span class="comment">// Buffer the characters returned by the compose scanner.</span></div><div class="line"><span class="keywordflow">if</span> (chunkLength &lt; length) {</div><div class="line"><span class="comment">// Add all the characters to the run</span></div><div class="line"> iter.AppendToStringAndIncrement(&amp;run, chunkLength);</div><div class="line"> }</div><div class="line"><span class="keywordflow">else</span> { </div><div class="line"><span class="comment">// Add only the characters we want to the run. </span></div><div class="line"><span class="comment">// The compose scanner may more data than we need.</span></div><div class="line"> iter.AppendToStringAndIncrement(&amp;run, length);</div><div class="line"> } </div><div class="line"><span class="comment">// Prepare for next iteration</span></div><div class="line"> index += chunkLength;</div><div class="line"> length -= chunkLength;</div><div class="line"> } <span class="comment">// end while </span></div><div class="line"><span class="comment">// Process any buffered text.</span></div><div class="line"><span class="keywordflow">if</span> (run.<a class="code" href="class_unicode_savvy_string.html#a943512b68899644891f01220d8d29c1f">CharCount</a>() &gt; 0 &amp;&amp; fontInstance != nil) {</div><div class="line"> totalWidth += EstimateStringWidth(run, fontInstance);</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> totalWidth;</div><div class="line">} <span class="comment">// end EstimateTextWidth</span></div></div><h3><a class="anchor" id="id_measuring_composed_width_or_depth_more_accurately"></a> Measuring composed width or depth more accurately</h3><p>Have the text flow into a story with a layout (text frames), and compose it with whatever paragraph composer you want. You can then scan the wax generated to find the width and depth measurement you want. This is the only way you can account for the many properties that affect the composed text, such as the paragraph composer&#39;s line-breaking algorithm, hyphenation, and text-style changes like font, point size, and leading, as well as the effect of layout properties like text wrap and first baseline offset. The <a class="el" href="class_snp_estimate_text_depth.html">SnpEstimateTextDepth</a> SDK code snippet provides an example of wax scanning.<p>It is much harder to estimate the width or depth of text without having the text of a story flow into a layout. In principle, you can use the scanner and drawing style (<a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> and <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>) to scan the text and apply your own line-breaking rules. This quickly becomes a sort of mini paragraph composer and requires some of the code in sample plug-ins like SingleLineComposer. Look at this sample&#39;s <a class="el" href="class_s_l_c_tile_composer.html">SLCTileComposer</a> class for the kind of code you might use.<h2><a class="anchor" id="id_text_hyphenation"></a> Text hyphenation</h2><p>Hyphenation is a service provided to composition. A composition engine uses the set of hyphenation providers installed and registered with the application. Hyphenation providers are responsible for providing the set of hyphenations points that exist for a particular word. This is used by the composition engine to help define line-breaking policies. The hyphenation service can be controlled by a set of paragraph attributes. This section contains use cases for controlling the default application hyphenation service.<h3><a class="anchor" id="id_turning_off_hyphenation"></a> Turning off hyphenation</h3><p>For a particular paragraph, you can turn off hyphenation.<p><b>Solution</b><p>Hyphenation function is controlled for each paragraph, using the <a class="el" href="classk_text_attr_hyphen_mode_boss.html">kTextAttrHyphenModeBoss</a> (signature interface <a class="el" href="class_i_text_attr_hyphen_mode.html">ITextAttrHyphenMode</a>) paragraph-level text attribute.<p>While four &quot;modes&quot; are defined by the interface (off, manual, dictionary, and algorithm), the default supplied hyphenation service uses only manual and algorithm. In manual mode, only hard hyphens and discretionary hyphens (added to the text using &quot;Insert Special Character&quot;) are used. For the algorithm mode, hyphenation behavior is determined by hard hyphens, discretionary hyphens, hyphenation points provided by the dictionary, and a sophisticated algorithm used to determine best hyphenation.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_hyphenation_of_capitalized_words"></a> Specifying hyphenation of capitalized words</h3><p>With the default hyphenation service, you can control hyphenation of capitalized words.<p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_hyphen_cap_boss.html">kTextAttrHyphenCapBoss</a> paragraph-level text attribute (interface <a class="el" href="class_i_text_attr_boolean.html">ITextAttrBoolean</a>). If this is turned off, capitalized words with discretionary hyphens are still hyphenated.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_hyphenation_of_last_word_in_a_paragraph"></a> Specifying hyphenation of last word in a paragraph</h3><p>With the default hyphenation service, you can control hyphenation of the last word in a paragraph.<p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_hyphen_last_boss.html">kTextAttrHyphenLastBoss</a> paragraph-level text attribute (interface <a class="el" href="class_i_text_attr_boolean.html">ITextAttrBoolean</a>). If this is turned off, last words with discretionary hyphens are still hyphenated.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_the_minimum_number_of_characters_before_a_hyphen"></a> Specifying the minimum number of characters before a hyphen</h3><p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_min_before_boss.html">kTextAttrMinBeforeBoss</a> paragraph-level attribute (interface <a class="el" href="class_i_text_attr_int16.html">ITextAttrInt16</a>).<p>If there are discretionary hyphens before the first hyphenation point, they are ignored; that is, the word does not hyphenate at discretionary hyphens that occur before the minimum number of characters, as specified by this attribute.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_the_minimum_number_of_characters_after_a_hyphen"></a> Specifying the minimum number of characters after a hyphen</h3><p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_min_after_boss.html">kTextAttrMinAfterBoss</a> paragraph-level attribute (interface <a class="el" href="class_i_text_attr_int16.html">ITextAttrInt16</a>).<p>If there are discretionary hyphens after a hyphenation point, they are ignored; that is, the word does not hyphenate at discretionary hyphens that occur after the minimum number of characters, as specified by this attribute.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_the_minimum_length_of_a_candidate_word_for_hyphenation"></a> Specifying the minimum length of a candidate word for hyphenation</h3><p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_shortest_word_boss.html">kTextAttrShortestWordBoss</a> (interface <a class="el" href="class_i_text_attr_int16.html">ITextAttrInt16</a>) paragraph-level attribute.<p>If there are discretionary hyphens in a word whose length is less than that specified by this attribute, they are ignored; that is the word is never be a candidate for hyphenation).<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_the_maximum_number_of_consecutive_hyphens"></a> Specifying the maximum number of consecutive hyphens</h3><p>You can define the maximum number of consecutive hyphens (the ladder) for text.<p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_hyphen_ladder_boss.html">kTextAttrHyphenLadderBoss</a> paragraph-level attribute (interface <a class="el" href="class_i_text_attr_int16.html">ITextAttrInt16</a>).<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_the_hyphenation_zone"></a> Specifying the hyphenation zone</h3><p>The hyphenation zone dictates the minimum space required by the word that is the hyphenation target. If that space is not available (that is, the previous word encroaches on this zone), no hyphenation is done, and the hyphenation candidate is moved to the next line. You can control this function.<p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_hyphen_zone_boss.html">kTextAttrHyphenZoneBoss</a> paragraph-level attribute (interface <a class="el" href="class_i_text_attr_real_number.html">ITextAttrRealNumber</a>). This specifies the minimum width assigned to a candidate word before a hyphenation point (modulo any preceding whitespace), before the word is pushed to the next line.<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_specifying_the_hyphenation_weight"></a> Specifying the hyphenation weight</h3><p>The algorithm used by the composer (in conjunction with the hyphenation service) to determine the hyphenation policy for text is complex. The hyphenation weight is a heuristic input used to guide the number of resulting hyphens. You can control this function.<p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_hyphen_weight_boss.html">kTextAttrHyphenWeightBoss</a> paragraph-level attribute (interface <a class="el" href="class_i_text_attr_int16.html">ITextAttrInt16</a>).<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h3><a class="anchor" id="id_marking_text_as_unbreakable"></a> Marking text as unbreakable</h3><p><b>Description</b><p>Text can be specified as no break; that is, the text is not to be considered as a candidate for hyphenation.<p><b>Solution</b><p>Use the <a class="el" href="classk_text_attr_no_break_boss.html">kTextAttrNoBreakBoss</a> character-level attribute (interface <a class="el" href="class_i_text_attr_boolean.html">ITextAttrBoolean</a>).<p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_modifying_the_value_of_an_attribute_for_text">Modifying the value of an attribute for text</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_hyphenation.html">SnpHyphenation</a></ul><h2><a class="anchor" id="id_fonts"></a> Fonts</h2><h3><a class="anchor" id="id_iterating_through_available_fonts"></a> Iterating through available fonts</h3><p>You can determine all fonts available to the application through the font subsystem.<p><b>Solution</b><p>The <a class="el" href="class_snp_inspect_font_mgr.html#a48c1ac975ec0ce0352ea798e9540af4a">SnpInspectFontMgr::ReportAllFonts</a> code snippet shows how to iterate through all fonts available to the application, by calling <a class="el" href="class_i_font_mgr.html">IFontMgr</a> directly.<p>The <a class="el" href="class_snp_perform_font_group_iterator.html">SnpPerformFontGroupIterator</a> code snippet shows how to implement a <a class="el" href="class_font_group_iterator_call_back.html">FontGroupIteratorCallBack</a> (see <a class="el" href="_i_font_mgr_8h_source.html">IFontMgr.h</a>) to iterate all fonts.<h3><a class="anchor" id="id_controlling_the_set_of_installed_fonts"></a> Controlling the set of installed fonts</h3><p>You can restrict the set of available fonts to a predefined set.<p><b>Solution</b><p>Controlling the set of installed fonts is an operating-system-wide issue that cannot be solved directly with InDesign APIs. InDesign APIs can be used to detect installed fonts (in both the system folder and application fonts folder). To manage fonts, use operating-system platform APIs.<h3><a class="anchor" id="id_finding_a_font"></a> Finding a font</h3><p>You can obtain a particular, named font.<p><b>Solution</b><p>The solution depends on what information you have that identifies the font. See the <a class="el" href="class_snp_inspect_font_mgr.html">SnpInspectFontMgr</a> code snippet for several approaches, such as <a class="el" href="class_snp_inspect_font_mgr.html#a02ac5c93e167e0392c0461ddc8664c80">SnpInspectFontMgr::QueryFont</a>.<p>Alternatively, implement a <a class="el" href="class_font_group_iterator_call_back.html">FontGroupIteratorCallBack</a> (see SnpPerformFontGroupIterator.cpp) that finds the name of a PostScript font, given the full name of the font as returned by <a class="el" href="class_i_p_m_font.html#afd049a86dcb413533bf6876d7f38bbba">IPMFont::AppendFullName</a>. For example, if you search for Courier Bold, you get the name of the PostScript font Courier-Bold.<h3><a class="anchor" id="id_finding_the_font_used_to_display_a_storys_text"></a> Finding the font used to display a story&#39;s text</h3><p><b>Solution</b><p>Use the values of the <a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a> and <a class="el" href="classk_text_attr_font_style_boss.html">kTextAttrFontStyleBoss</a> text attributes. The UID in <a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a>&#39;s <a class="el" href="class_i_text_attr_u_i_d.html">ITextAttrUID</a> interface can be used to instantiate an <a class="el" href="class_i_font_family.html">IFontFamily</a> object. The <a class="el" href="class_p_m_string.html">PMString</a> in <a class="el" href="classk_text_attr_font_style_boss.html">kTextAttrFontStyleBoss</a>&#39;s <a class="el" href="class_i_text_attr_font.html">ITextAttrFont</a> interface gives you the stylistic variant (for example, Regular or Bold). From these, you can find the name of the font, as shown in the following example, which fin ds a font name from text attributes: <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="class_p_m_string.html">PMString</a> FindFontName( <a class="code" href="class_i_data_base.html">IDataBase</a>* db, <a class="code" href="class_i_text_attr_u_i_d.html">ITextAttrUID</a>* fontUID, <a class="code" href="class_i_text_attr_font.html">ITextAttrFont</a>* fontStyle) { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFontFamily&gt;</a> family(db, fontUID-&gt;GetUIDData(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr_3_01_i_p_m_font_01_4.html">InterfacePtr&lt;IPMFont&gt;</a> font(family-&gt;QueryFace(fontStyle-&gt;<a class="code" href="class_i_text_attr_font.html#a557000c32b7a95a353975d893c3e51aa">GetFontName</a>()));</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> fontName;</div><div class="line"> font-&gt;AppendFontName(fontName); </div><div class="line"><span class="keywordflow">return</span> fontName;</div><div class="line">}</div></div><p>Alternately, use <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> to get the drawing style (<a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>) at a particular index in the text model, as shown in the following example, which finds a font name from the drawing style: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IComposeScanner&gt;</a> scanner(textModel, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_drawing_style.html">IDrawingStyle</a>* style = scanner-&gt;GetCompleteStyleAt(textIndex);</div><div class="line"><a class="code" href="class_interface_ptr_3_01_i_p_m_font_01_4.html">InterfacePtr&lt;IPMFont&gt;</a> font(style-&gt;<a class="code" href="class_i_drawing_style.html#ae52f8f618b5e9c328aef0703706a08f1">QueryFont</a>());</div></div><h3><a class="anchor" id="id_changing_the_font_used_to_display_a_storys_text"></a> Changing the font used to display a story&#39;s text</h3><p>You can change the font used for either text in a story or a style that can be applied to text in a story.<p><b>Solution</b><p>To set the font used to display text in a story, override the <a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a> and <a class="el" href="classk_text_attr_font_style_boss.html">kTextAttrFontStyleBoss</a> text attributes in the text model. For information on overriding text attributes, see the &quot;Text Fundamentals&quot; chapter in Adobe InDesign Programming Guide.<p>To set the font for a text style, add or change the value of the <a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a> and <a class="el" href="classk_text_attr_font_style_boss.html">kTextAttrFontStyleBoss</a> text attributes in the style.<h3><a class="anchor" id="id_getting_the_name_of_a_font_from_its_uid"></a> Getting the name of a font from its UID</h3><p><b>Solution</b><p>Use the UID to instantiate an <a class="el" href="class_i_font_family.html">IFontFamily</a> interface, and get the name from there. Typically, the UID of a font is obtained from the <a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a> text attribute, <a class="el" href="class_i_doc_font_mgr.html#a00463819139ce357ca037e28312109e3">IDocFontMgr::GetFontGroupUID</a>, or <a class="el" href="class_i_document_font_usage.html#a857ee9f18acb413ac47097b2a2f868f6">IDocumentFontUsage::GetNthUsedFontUID</a>.<h3><a class="anchor" id="id_obtaining_the_list_of_fonts_used_in_all_stories"></a> Obtaining the list of fonts used in all stories</h3><p>You can get information on the present or missing fonts used for the text in a story (not including nonrendered text, like that used in the notes feature).<p><b>Solution</b><p><a class="el" href="class_snp_inspect_font_mgr.html#a40d51251fcd83ad2a7f38a326dc9f403">SnpInspectFontMgr::ListFontsInDocument</a> shows how to use <a class="el" href="class_i_used_font_list.html">IUsedFontList</a> on <a class="el" href="classk_doc_boss.html">kDocBoss</a> to determine which fonts are in use in a document&#39;s stories. <a class="el" href="class_snp_inspect_font_mgr.html#a066305baffcffa3576a69d007105a58b">SnpInspectFontMgr::ReportDocumentFontUsage</a> shows how to use the simpler <a class="el" href="class_i_document_font_usage.html">IDocumentFontUsage</a> API (existing on <a class="el" href="classk_doc_boss.html">kDocBoss</a>), a higher-level facade over the fonts used in a document. This mechanism does not report the fonts used in text for features like notes (text that is not displayed as part of the story). To catch all fonts used in all text in a story, regardless of whether it is visible in an exported asset, use the solution in <a class="el" href="id_solutions.html#id_finding_the_font_used_to_display_a_storys_text">Finding the font used to display a story&#39;s text</a>.<h3><a class="anchor" id="id_obtaining_the_list_of_fonts_used_in_or_referenced_from_placed_assets"></a> Obtaining the list of fonts used in or referenced from placed assets</h3><p>You can get font information from (EPS or PDF) assets placed in a document.<p><b>Solution</b><p><a class="el" href="class_i_font_names.html">IFontNames</a> (on <a class="el" href="classk_e_p_s_item.html">kEPSItem</a> or <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>) holds the set of fonts required by or embedded in a particular placed asset. <a class="el" href="class_snp_inspect_font_mgr.html#a0f36a8d3c54e50cf7fe8d248edfe45a5">SnpInspectFontMgr::TestAssetsForFonts</a> shows how to obtain font information for placed assets. <a class="el" href="class_snp_inspect_font_mgr.html#a066305baffcffa3576a69d007105a58b">SnpInspectFontMgr::ReportDocumentFontUsage</a> shows how to use the simpler <a class="el" href="class_i_document_font_usage.html">IDocumentFontUsage</a> API (existing on <a class="el" href="classk_doc_boss.html">kDocBoss</a>, a higher-level facade over the fonts used in a document.<h3><a class="anchor" id="id_obtaining_the_list_of_fonts_persistent_in_a_document"></a> Obtaining the list of fonts persistent in a document</h3><p>The set of fonts that are persistent in a document do not need to match the fonts used. You can access all fonts that exist in the persistent document.<p><b>Solution</b><p>Use <a class="el" href="class_i_doc_font_mgr.html">IDocFontMgr</a> (on session or document workspace) to access the fonts in the workspace. For the session workspace, this represents the set of default fonts. For the document workspace, this includes all fonts used in the document (text frames, text notes, etc.); however, it does not include fonts contained in placed assets.<h3><a class="anchor" id="id_determining_restrictions_that_apply_to_installed_fonts"></a> Determining restrictions that apply to installed fonts</h3><p>Given a particular font, sometimes it is useful to detect any use restrictions that might apply.<p><b>Solution</b><p><a class="el" href="class_snp_inspect_font_mgr.html#a57474367dbe000ce1fc21dc44648cb54">SnpInspectFontMgr::ReportFontsWithRestrictions</a> shows how to determine any use restrictions a particular font (<a class="el" href="class_i_p_m_font.html">IPMFont</a>) might have.<h3><a class="anchor" id="id_detecting_font_subsystem_changes"></a> Detecting font subsystem changes</h3><p>If the user modifies the fonts installed during an instance of the application, the cooltype font subsystem is updated. You can be called when the application detects the font subsystem was updated (for example, a font was added or removed).<p><b>Solution</b><p>Attach an observer to the session (obtained from GetExecutionContextSession()) using the IID_IFONTMGR protocol, listening for the kFontSystemChangedMessage.<h3><a class="anchor" id="id_detecting_accesses_to_unavailable_fonts"></a> Detecting accesses to unavailable fonts</h3><p>Your plug-in can be called when an attempt is made to access a nonexistent font.<p><b>Solution</b><p>Missing font responder services (<a class="el" href="class_i_responder.html">IResponder</a> implementation with service ID kMissingFontSignalResponderService) are called whenever the application queries the font manager for an unavailable font. The responder has the opportunity to respond with an alternative font to use (by populating the <a class="el" href="class_i_missing_font_signal_data.html#a281c8c41450f284c392835814438ff8e">IMissingFontSignalData::SetResult</a> with a valid font).<p>Only one missing font responder can dictate the font-replacement policy.<h3><a class="anchor" id="id_dealing_with_font_face_variants"></a> Dealing with font face variants</h3><p>A font face can be described using different names (for example, &quot;Regular&quot; or &quot;Plain&quot; for a plain font face, &quot;Italic&quot; or &quot;Cursive&quot; for an italic font face, and &quot;Bold&quot; or &quot;Heavy&quot; for a bold font face).<p><b>Solution</b><p><a class="el" href="class_i_text_utils.html">ITextUtils</a> has four methods that can help you deal with font face variants:<ul><li><a class="el" href="class_i_text_utils.html#a099114b66b75224fb66a47443fbe1c80">ITextUtils::IsPlainStyleName</a><li><a class="el" href="class_i_text_utils.html#a1e2fa4d5c59563a4fab69c1558039a7c">ITextUtils::IsItalicStyleName</a><li><a class="el" href="class_i_text_utils.html#a59fea82a2d995a76e31d021f7e4b38bf">ITextUtils::IsBoldStyleName</a><li><a class="el" href="class_i_text_utils.html#ac9a8afe9bad3cd0327267f162d5cd89c">ITextUtils::IsBoldItalicStyleName</a></ul><p>These methods implement the naming heuristics that define alternative names for font faces.<p>Given a particular font family (<a class="el" href="class_i_font_family.html">IFontFamily</a>), you can get the index that identifies the correct font face, using the API <a class="el" href="class_i_font_family.html#a463ed62cf80e59f7941a1995ea50f7c9">IFontFamily::CorrectVariantIndex</a>.<h2><a class="anchor" id=""></a></h2><p>InDesign gives users more control over the parts of a document that can be searched and modified via the find/change dialog. Similarly, there are interfaces that allow you to work more effectively with find/change.<p>InDesign not only provides interfaces to find/change plain text, but also to find/change text using grep (Global Regular Expression Parser) strings, glyphs using glyph IDs, and objects using frame attributes. Find/change object are discussed in the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of Adobe InDesign Plug-in Programming Guide. This section contains use cases dealing with text, grep, and glyph search.<p>For more information, see the &quot;Text Fundamentals&quot; and <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapters of Adobe InDesign Plug-in Programming Guide.<h3><a class="anchor" id="id_related_apis"></a> Related APIs</h3><ul><li><a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> maintains all find/change options.<li><a class="el" href="class_i_find_change_service.html">IFindChangeService</a> on <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> provides find/change individual find/change service.<li>Commands - <a class="el" href="classk_case_sensitive_cmd_boss.html">kCaseSensitiveCmdBoss</a>, <a class="el" href="classk_entire_word_cmd_boss.html">kEntireWordCmdBoss</a>, <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>, <a class="el" href="classk_find_change_glyph_i_d_cmd_boss.html">kFindChangeGlyphIDCmdBoss</a>, <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>, <a class="el" href="classk_find_string_cmd_boss.html">kFindStringCmdBoss</a>, <a class="el" href="classk_include_footnotes_cmd_boss.html">kIncludeFootnotesCmdBoss</a>, <a class="el" href="classk_include_hidden_layers_cmd_boss.html">kIncludeHiddenLayersCmdBoss</a>, <a class="el" href="classk_include_locked_layers_for_find_cmd_boss.html">kIncludeLockedLayersForFindCmdBoss</a>, <a class="el" href="classk_include_locked_stories_for_find_cmd_boss.html">kIncludeLockedStoriesForFindCmdBoss</a>, <a class="el" href="classk_include_master_pages_cmd_boss.html">kIncludeMasterPagesCmdBoss</a>, <a class="el" href="classk_kana_sensitive_cmd_boss.html">kKanaSensitiveCmdBoss</a>, <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>, <a class="el" href="classk_replace_all_text_cmd_boss.html">kReplaceAllTextCmdBoss</a> <a class="el" href="classk_replace_find_text_cmd_boss.html">kReplaceFindTextCmdBoss</a>, <a class="el" href="classk_replace_string_cmd_boss.html">kReplaceStringCmdBoss</a>, <a class="el" href="classk_t_w_replace_text_cmd_boss.html">kTWReplaceTextCmdBoss</a>, <a class="el" href="classk_width_sensitive_cmd_boss.html">kWidthSensitiveCmdBoss</a></ul><dl class="section note"><dt>Note<dd>Although we use the same command boss to set find/change options for different search mode, you must explicitly set the IID_IFINDCHANGEMODEDATA interface on the command bosses to appropriate search mode. Otherwise, these commands will use default mode, which is kTextSearch, and result in unexpected behavior.</dl><h3><a class="anchor" id="id_searching_for_text_strings"></a> Searching for text strings</h3><p><b>Solution</b><p>To set up options and perform search:<ol type="1"><li>Set the search mode to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454afadbce3aeda3c74833ebfbf8f568f44e">IFindChangeOptions::kTextSearch</a> using <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>.<li>Set the string to find in <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, using <a class="el" href="classk_find_string_cmd_boss.html">kFindStringCmdBoss</a>.<li>Set the search scope using <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>. The scope can be current document, all open documents, a story, or within a selection.<li>Set other options, such as Entire Word, Case Sensitive, Include Locked Layers, Include Locked Stories, Include Hidden Layers, Include Master Pages, and Include FootNotes (corresponding to check boxes in the find/change dialog), using their respective commands.<li>Optionally, specify that you are looking for text with certain text attributes, by using <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>.<li>Perform search by doing either of the following:<ul><li>Create <a class="el" href="classk_find_text_cmd_boss.html">kFindTextCmdBoss</a>, set up appropriate text walker, then process the command.<li>Create <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> and call <a class="el" href="class_i_find_change_service.html#a531fbf0b73b1b32d16ff93a3ff5aafb8">IFindChangeService::SearchText()</a>.</ul></ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_find_and_replace.html#acb416ddea08c55eed2e895a957d0f675">SnpFindAndReplace::Do_FindText</a></ul><h3><a class="anchor" id="id_replacing_text_strings"></a> Replacing text strings</h3><p><b>Solution</b><p>To set up options and perform search, follow these steps. The first several steps are the same as for searching text strings.<ol type="1"><li>Set the search mode to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454afadbce3aeda3c74833ebfbf8f568f44e">IFindChangeOptions::kTextSearch</a> using <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>.<li>Set the string to find in <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, using <a class="el" href="classk_find_string_cmd_boss.html">kFindStringCmdBoss</a>.<li>Set the search scope using <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>. The scope can be current document, all open documents, a story, or within a selection.<li>Set other options, such as Entire Word, Case Sensitive, Include Hidden Layers, Include Master Pages, and Include FootNotes (corresponding to check boxes in the find/change dialog), using their respective commands.<li>Set the replace string in <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, using <a class="el" href="classk_replace_string_cmd_boss.html">kReplaceStringCmdBoss</a>.<li>Optionally, specify find/change text attributes, by using <a class="el" href="classk_find_change_format_cmd_boss.html">kFindChangeFormatCmdBoss</a>.<li>Perform the replace text action specified by the replace mode. If you already did a successful search, you can choose among replace all text, replace and search text, and replace found text. If you did not do a successful search yet, the only choice available is replace all text. You can do either of the following:<ul><li>Create <a class="el" href="classk_replace_all_text_cmd_boss.html">kReplaceAllTextCmdBoss</a>, <a class="el" href="classk_replace_find_text_cmd_boss.html">kReplaceFindTextCmdBoss</a>, or <a class="el" href="classk_t_w_replace_text_cmd_boss.html">kTWReplaceTextCmdBoss</a>, depending on the replace mode, set up an appropriate text walker, then process the appropriate command.<li>Create <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> and call <a class="el" href="class_i_find_change_service.html#af68c87e7355c82eeca4448d41d3673a0">IFindChangeService::ReplaceAllText()</a>, ReplaceAndSearchText(), or ReplaceText().</ul></ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_find_and_replace.html#a7b15f815639c6e943b6b5ad9f3345d8e">SnpFindAndReplace::Do_ReplaceText</a></ul><h3><a class="anchor" id="id_searching_text_using_grep"></a> Searching text using grep</h3><p>You can search text matching regular expressions specified by a grep string.<p><b>Solution</b><p>Searching using grep has the same interfaces as regular searching, and the processes are almost identical. The only differences are as follows:<ul><li>The search mode should be set to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454a5c183ddd0da4144d1cc027e24cd260ae">IFindChangeOptions::kGrepSearch</a>.<li>The find string stores the grep string, not the text.</ul><p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_find_and_replace.html#acb416ddea08c55eed2e895a957d0f675">SnpFindAndReplace::Do_FindText</a>. For grep search, <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454a5c183ddd0da4144d1cc027e24cd260ae">IFindChangeOptions::kGrepSearch</a> is passed in.</ul><h3><a class="anchor" id="id_replacing_text_using_grep"></a> Replacing text using grep</h3><p>You can text matching regular expressions specified in a grep string with new string also specified in grep.<p><b>Solution</b><p>Replacing text with grep has the same interfaces and commands as standard text replacement. The only differences are as follows:<ul><li>The search mode should be set to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454a5c183ddd0da4144d1cc027e24cd260ae">IFindChangeOptions::kGrepSearch</a>.<li>The find string stores the grep string, not the text.<li>The replace string stores the grep string, not the text.</ul><p><b>Sample code</b><ul><li>See <a class="el" href="class_snp_find_and_replace.html#a7b15f815639c6e943b6b5ad9f3345d8e">SnpFindAndReplace::Do_ReplaceText</a>. For grep find/change, <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454a5c183ddd0da4144d1cc027e24cd260ae">IFindChangeOptions::kGrepSearch</a> is passed in.</ul><h3><a class="anchor" id="id_searching_for_a_glyph"></a> Searching for a glyph</h3><p><b>Solution</b><p>Like searching for text, searching for a glyph involves setting find/change options and then performing a search. Follow these steps:<ol type="1"><li>Set the search mode to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454a32e890f65b85e9bbae60f95012d65ddb">IFindChangeOptions::kGlyphSearch</a>, using <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>.<li>Set the glyph to find in <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, using <a class="el" href="classk_find_change_glyph_i_d_cmd_boss.html">kFindChangeGlyphIDCmdBoss</a>. Remember to set the <a class="el" href="class_i_bool_data.html">IBoolData</a> on the command boss to kTrue. This tells the command to set the find glyph ID.<li>Set the search scope, using <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>. The scope can be current document, a story, or within a selection.<li>Set other options, such as Include Locked Layers, Include Locked Stories, Include Hidden Layers, Include Master Pages, and Include FootNotes, using their respective commands.<li>Perform a glyph search action. You can do either of the following:<ul><li>Create <a class="el" href="classk_find_text_cmd_boss.html">kFindTextCmdBoss</a>, set up an appropriate text walker, then process the appropriate command.<li>Create &Acirc;&shy;&Acirc;&shy;kFindChangeServiceBoss and call <a class="el" href="class_i_find_change_service.html#a531fbf0b73b1b32d16ff93a3ff5aafb8">IFindChangeService::SearchText()</a>.</ul></ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_find_and_replace.html#afff65dcd65a58cccb6b836d55118d2e1">SnpFindAndReplace::Do_FindGlyph</a></ul><h3><a class="anchor" id="id_replacing_a_glyph"></a> Replacing a glyph</h3><p><b>Solution</b><p>The relationship between finding and replacing a glyph is similar to that between finding and replacing text. In addition to setting find options, we also need to specify change options. Follow these steps:<ol type="1"><li>Set the search mode to <a class="el" href="class_i_find_change_options.html#a07a4d8fe59c2795c56fbefedf4857454a32e890f65b85e9bbae60f95012d65ddb">IFindChangeOptions::kGlyphSearch</a>, using <a class="el" href="classk_find_search_mode_cmd_boss.html">kFindSearchModeCmdBoss</a>.<li>Set the glyph to find in <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, using <a class="el" href="classk_find_change_glyph_i_d_cmd_boss.html">kFindChangeGlyphIDCmdBoss</a>. Remember forget to set the <a class="el" href="class_i_bool_data.html">IBoolData</a> on the command boss to kTrue. This instructs the command to set the find glyph ID.<li>Set the replace glyph in <a class="el" href="class_i_find_change_options.html">IFindChangeOptions</a>, using the same <a class="el" href="classk_find_change_glyph_i_d_cmd_boss.html">kFindChangeGlyphIDCmdBoss</a>. Remember to set the <a class="el" href="class_i_bool_data.html">IBoolData</a> on the command boss to kFalse. This instructs the command to set the change glyph ID.<li>Set the search scope, using <a class="el" href="classk_scope_cmd_boss.html">kScopeCmdBoss</a>. The scope can be current document, a story, or within current selection.<li>Set other options, such as Include Hidden Layers, Include Master Pages, and Include FootNotes, using their respective commands.<li>Perform the replace glyph action specified by the replace mode. If you already did a successful glyph search, you can choose among replace all find glyph, replace and search text, and replace found text. If you did not do a successful search yet, the only choice available is replace all text. You can do either of the following:<ul><li>Create <a class="el" href="classk_replace_all_text_cmd_boss.html">kReplaceAllTextCmdBoss</a>, <a class="el" href="classk_replace_find_text_cmd_boss.html">kReplaceFindTextCmdBoss</a>, or <a class="el" href="classk_t_w_replace_text_cmd_boss.html">kTWReplaceTextCmdBoss</a> (depending on the replace mode), set up an appropriate text walker, then process the appropriate command.<li>Create <a class="el" href="classk_find_change_service_boss.html">kFindChangeServiceBoss</a> and call <a class="el" href="class_i_find_change_service.html#af68c87e7355c82eeca4448d41d3673a0">IFindChangeService::ReplaceAllText()</a>, ReplaceAndSearchText(), or ReplaceText().</ul></ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_find_and_replace.html#a07d55545147bef25c836c04109c5a53a">SnpFindAndReplace::Do_ReplaceGlyph</a></ul><h1><a class="anchor" id="id_tables"></a> Tables</h1><h2><a class="anchor" id="id_getting_started"></a> Getting started</h2><p>This chapter presents table-related use cases. To learn to program with tables, do the following:<ul><li>Read&quot;Exploring tables with SnippetRunner&quot;, to familiarize yourself with available related sample code and documentation.<li>Read the &quot;Tables&quot; chapter in Adobe&reg; InDesign Products Programming Guide.<li>Study the TableAttributes and TableBasics SDK samples.</ul><p>For help with specific programming issues, see the sections below for a use case that matches your needs.<h3><a class="anchor" id="id_exploring_tables_with_snippetrunner"></a> Exploring tables with SnippetRunner</h3><p>SnippetRunner is a plug-in supplied by the SDK that lets you run code snippets, which can help you explore your use case.<p>Run InDesign with the SnippetRunner plug-in loaded. Use SnippetRunner to run the snippets listed below under &quot;Sample code.&quot; See the &quot;Snippets&quot; section of the API reference documentation for more information regarding snippets and instructions on using SnippetRunner itself. Browse the source code of the sample snippets.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_access_table_content.html">SnpAccessTableContent</a><li><a class="el" href="class_snp_create_table.html">SnpCreateTable</a><li><a class="el" href="class_snp_inspect_table_model.html">SnpInspectTableModel</a><li><a class="el" href="class_snp_iter_table_use_dict_hier.html">SnpIterTableUseDictHier</a><li>SnpManipulateTableStyle<li><a class="el" href="class_snp_modify_table.html">SnpModifyTable</a><li><a class="el" href="class_snp_set_table_fill.html">SnpSetTableFill</a></ul><p><b>Related APIs</b><ul><li>ICellContentManager<li><a class="el" href="class_i_cell_style_suite.html">ICellStyleSuite</a><li><a class="el" href="class_facade_1_1_i_cell_styles_facade.html">Facade::ICellStylesFacade</a><li><a class="el" href="class_i_table_attr_accessor.html">ITableAttrAccessor</a><li><a class="el" href="class_i_table_attributes.html">ITableAttributes</a><li><a class="el" href="class_i_table_attr_report.html">ITableAttrReport</a><li><a class="el" href="class_i_table_commands.html">ITableCommands</a><li><a class="el" href="class_i_table_frame.html">ITableFrame</a><li>ITableFrameList<li><a class="el" href="class_i_table_layout.html">ITableLayout</a><li><a class="el" href="class_i_table_model.html">ITableModel</a><li><a class="el" href="class_i_table_suite.html">ITableSuite</a><li><a class="el" href="class_i_table_style_suite.html">ITableStyleSuite</a><li><a class="el" href="class_facade_1_1_i_table_styles_facade.html">Facade::ITableStylesFacade</a></ul><h3><a class="anchor" id="id_editing_table_and_cell_options_with_itablesuite"></a> Editing table and cell options with ITableSuite</h3><p>A starting point for writing a plug-in that modifies a table through an active selection is to become familiar with the <a class="el" href="class_i_table_suite.html">ITableSuite</a> interface.<p>You can obtain the <a class="el" href="class_i_table_suite.html">ITableSuite</a> interface for the active selection from the <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a> interface aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> with code like the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableSuite&gt;</a> iTableSuite(static_cast&lt;ITableSuite*&gt;(<a class="code" href="class_utils.html">Utils&lt;ISelectionUtils&gt;</a>()-&gt;QuerySuite(ITableSuite::kDefaultIID)));</div></div><p>Obtaining this interface pointer does not necessarily mean you can exercise the capabilities. Always test the ITableSuite::Can&lt;DoSomething&gt; method to determine a particular capability is available in the target, before calling <a class="el" href="class_i_table_suite.html">ITableSuite</a>::&lt;DoSomething&gt;.<p>If there are capabilities that cannot be obtained through this interface-like adding text to a table cell-but you still want to work with an active selection, use the suite pattern to implement your own suite. To implement your own suite, you need to write add-ins for the integrator suite boss class and at least the table suite and text suite boss classes (if modifying an existing table) or the text suite boss class (if creating a new table in an existing story). Suite implementation code can obtain an <a class="el" href="class_i_table_model.html">ITableModel</a> interface pointer (effectively, a reference to a <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> object) in a straightforward way through <a class="el" href="class_i_table_target.html">ITableTarget</a>. You can then use the core AP Is (like <a class="el" href="class_i_table_commands.html">ITableCommands</a>) in addition to <a class="el" href="class_i_table_model.html">ITableModel</a>, to manipulate the table properties.<p>If client code needs to work with tables that are chosen programmatically (rather than with tables for which the end user varies the active selection), you need to program using the APIs exposed on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>. Your task then is to find a table model (see <a class="el" href="id_solutions.html#id_acquiring_a_table_model_reference">Acquiring a table model reference</a>).<h2><a class="anchor" id="id_tables"></a> Tables</h2><h3><a class="anchor" id="id_acquiring_a_table_model_reference"></a> Acquiring a table model reference</h3><p>How you acquire an interface on an instance of <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> depends on whether you are working with an active selection or searching through all tables in a given story or the story list.<p>If working with an active selection, first be sure you need to use the API on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>. If the capability exists on <a class="el" href="class_i_table_suite.html">ITableSuite</a>, use it first. If you definitely need to work with the <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> API (for example, <a class="el" href="class_i_table_model.html">ITableModel</a> or <a class="el" href="class_i_table_commands.html">ITableCommands</a>), implement a suite pattern. <a class="el" href="class_i_table_target.html">ITableTarget</a> identifies the table targeted for editing by a suite. For sample code, see TableBasics.<p>There are two ways to search through the story list (see the <a class="el" href="class_i_story_list.html">IStoryList</a> interface):<ul><li>The recommended way is to use <a class="el" href="class_i_text_story_thread_dict_hier.html">ITextStoryThreadDictHier</a>, aggregated on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>. This contains a collection of references to objects, some of which expose an <a class="el" href="class_i_table_model.html">ITableModel</a> interface. These are the tables embedded in the story represented by the given instance of <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>. See SnpIterTableUseDictHier.cpp for an example of how to acquire table model references through this mechanism.<li>There also is an <a class="el" href="class_i_table_model_list.html">ITableModelList</a> aggregated on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>, but this should be regarded as deprecated; do not depend on it. For an example of this mechanism, see the SnpIterTableStories.cpp code snippet.</ul><h3><a class="anchor" id="id_iterating_over_tables_in_a_document"></a> Iterating over tables in a document</h3><p>The recommended mechanism for iterating over tables in a document involves using the <a class="el" href="class_i_text_story_thread_dict_hier.html">ITextStoryThreadDictHier</a> interface to look for boss objects that have both the <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a> and <a class="el" href="class_i_table_model.html">ITableModel</a> interfaces.<p>Tables are embedded in stories, so first you need to iterate over the stories in a document through the <a class="el" href="class_i_story_list.html">IStoryList</a> interface. Once you have a story, use its <a class="el" href="class_i_text_story_thread_dict_hier.html">ITextStoryThreadDictHier</a> interface and NextUID (beginning with the UID of the story) to iterate over the collection of story thread dictionaries. If a boss object with an <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a> interface also has an <a class="el" href="class_i_table_model.html">ITableModel</a> interface, it is a table model.<p>For an example of using this mechanism to locate tables, see the <a class="el" href="class_snp_iter_table_use_dict_hier.html">SnpIterTableUseDictHier</a> code snippet.<p>There is another mechanism that can be used to iterate over tables in a document, but we do not recommend it: <a class="el" href="class_i_table_model_list.html">ITableModelList</a> should be used only with caution, as this interface may not be in a future version of the API. From <a class="el" href="class_i_table_model_list.html">ITableModelList</a>, you can iterate through the tables using the GetModelCount and QueryNthModel methods.<h3><a class="anchor" id="id_creating_a_new_table_in_a_story"></a> Creating a new table in a story</h3><p>To create a table in the story targeted by the active text selection, use <a class="el" href="class_i_table_suite.html#a3016dfdcf560c97be17c9ad20775ba87">ITableSuite::CanInsertTable</a> and <a class="el" href="class_i_table_suite.html#a20fe3f72bdedb10d0227d0e370bed269">ITableSuite::InsertTable</a>. To create a table at a TextIndex in a story chosen programmatically, call <a class="el" href="class_i_table_utils.html#ac82218003633cb4785a5c4803cbc40ad">ITableUtils::CanInsertTableAt</a> and <a class="el" href="class_i_table_utils.html#ae27f264177c1319d009780f85757aece">ITableUtils::InsertTable</a>. For sample code, see the <a class="el" href="class_snp_create_table.html">SnpCreateTable</a> SDK code snippet. The command that creates the table is <a class="el" href="classk_new_table_cmd_boss.html">kNewTableCmdBoss</a>; however, as noted above, you do not need to process this command directly.<p>To convert the text range identified by the active text selection to a table, use <a class="el" href="class_i_table_suite.html#a931b654063c043899b028180914e0dbf">ITableSuite::CanConvertTextToTable</a> and <a class="el" href="class_i_table_suite.html#aa61aa9196df706aa71c5e74fab30dba6">ITableSuite::ConvertTextToTable</a>. To convert a range of text in a story chosen programmatically to a table, call <a class="el" href="class_i_table_utils.html#a9bb89f146bce1745caebecb4454683fb">ITableUtils::ConvertTextToTable</a>. The command that creates the table is kTextToTableCmdBos; however, as noted above, you do not need to process this command directly.<h3><a class="anchor" id="id_deleting_a_table_from_a_story"></a> Deleting a table from a story</h3><p>To delete a table that is selected, use <a class="el" href="class_i_table_suite.html#a263cbe0575d51e71447c4d0010bce244">ITableSuite::CanDeleteTable</a> and <a class="el" href="class_i_table_suite.html#a7686e2263af4251422d95e21ab4cdcb5">ITableSuite::DeleteTable</a>. To delete a table chosen programmatically, process the command returned by <a class="el" href="class_i_table_commands.html#a6b935e0d2c2adade608fe84dd605f0d2">ITableCommands::QueryDeleteTableCmd</a>. The command used to delete a table is <a class="el" href="classk_delete_table_cmd_boss.html">kDeleteTableCmdBoss</a>;, however, as noted above, you do not need to process this command directly.<h3><a class="anchor" id="id_copying_and_pasting_a_table"></a> Copying and pasting a table</h3><p>To copy and paste a table, use the <a class="el" href="classk_table_copy_paste_cmd_boss.html">kTableCopyPasteCmdBoss</a> command. The data interface for this command, <a class="el" href="class_i_table_copy_paste_cmd_data.html">ITableCopyPasteCmdData</a>, specifies the source and destination tables&#39; <a class="el" href="class_u_i_d_ref.html">UIDRef</a> values, the grid address of the destination table at which you want to paste the source content, and the level to which you want to copy attributes from the source to the destination tables.<p>For sample code, see the <a class="el" href="class_snp_copy_paste_table.html">SnpCopyPasteTable</a> SDK code snippet.<h3><a class="anchor" id="id_sorting_the_data_in_a_table"></a> Sorting the data in a table</h3><p>The <a class="el" href="class_snp_sort_table.html">SnpSortTable</a> SDK code snippet indicates how to sort table data using table iterators, content access methods, and standard collections like <a class="el" href="class_k2_vector.html">K2Vector</a>.<p>If the table has split or merged cells, the sorting operation is not well defined.<p>For most cases, sorting is done by the <a class="el" href="class_wide_string.html">WideString</a> &lt; operator; however, if there is a special glyph in the text, you must define your own comparator function object. SnpSortTable.cpp indicates how to go about this, defining a comparator function object for a custom data class.<p>If your text contains end-user-defined characters (EUDC), you must get the character attribute at the special placeholder textchar (kTextChar_SpecialGlyph or kTextChar_NonRomanSpecialGlyph). The glyph ID is inserted as a character attribute strand so the composer can render it; this information is relevant to sorting.<h2><a class="anchor" id="id_tables_and_cells"></a> Tables and cells</h2><h3><a class="anchor" id="id_inserting_and_deleting_rows_and_columns"></a> Inserting and deleting rows and columns</h3><p>To edit a table selected by the end user using active selection, use methods on <a class="el" href="class_i_table_suite.html">ITableSuite</a> to insert or delete rows or columns. For example, call <a class="el" href="class_i_table_suite.html#a5ab324b77de49b34161439e5b8876c7a">ITableSuite::CanInsertRows</a> to determine whether you can insert rows into the selected table; if so, call <a class="el" href="class_i_table_suite.html#a295e2da5bb0c90333c7fd8458d7fd22b">ITableSuite::InsertRows</a>. To get <a class="el" href="class_i_table_suite.html">ITableSuite</a>, query the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for it or call <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> to get <a class="el" href="class_i_table_suite.html">ITableSuite</a> for the active selection.<p>To edit a table selected programmatically, use <a class="el" href="class_i_table_commands.html">ITableCommands</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_modify_table.html">SnpModifyTable</a></ul><h3><a class="anchor" id="id_changing_the_dimensions_of_a_table"></a> Changing the dimensions of a table</h3><p>To change the dimensions of a table selected by the end user using active selection, use <a class="el" href="class_i_table_suite.html">ITableSuite</a>. Call <a class="el" href="class_i_table_suite.html#a566d864ba515ed29682b3d8e257ce6aa">ITableSuite::CanChangeTableDimensions</a> to determine whether the selection target supports the capability you require; if it does, call ITableSuite::ChangeRowDimensions.<p>To change the dimensions of a table selected programmatically, use <a class="el" href="class_i_table_commands.html">ITableCommands</a> aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>.<h3><a class="anchor" id="id_changing_the_height_of_table_rows"></a> Changing the height of table rows</h3><p>Row height is one of many table attributes (see the <a class="el" href="class_i_table_attr_report.html">ITableAttrReport</a> interface). It is represented by <a class="el" href="classk_row_attr_height_boss.html">kRowAttrHeightBoss</a>. This attribute can be applied when the user selects a table through <a class="el" href="class_i_table_suite.html#a78029f9fad6d96ebfd21aa72cfc8c133">ITableSuite::ApplyRowOverrides</a>, but it is more convenient to use the <a class="el" href="class_i_table_suite.html#aa169fa556fcd91de4e5eda76c699fe86">ITableSuite::ResizeRows</a> wrapper method or <a class="el" href="class_i_table_commands.html#a43d34ac305fc3a3bcc0fe58003b97bd2">ITableCommands::ResizeRows</a> when the table is chosen programmatically.<h3><a class="anchor" id="id_merging_or_splitting_cells"></a> Merging or splitting cells</h3><p>Merging or splitting cells can be done through <a class="el" href="class_i_table_suite.html">ITableSuite</a> for an abstract selection or through <a class="el" href="class_i_table_commands.html">ITableCommands</a> for a specific location within the table. The command of class <a class="el" href="classk_split_cell_cmd_boss.html">kSplitCellCmdBoss</a> does the work, but you can use <a class="el" href="class_i_table_commands.html#a31b7cc1924a53f0835316c387a8a1be3">ITableCommands::SplitCells</a> and ITableCSuite::SplitCells rather than using the command directly.<h3><a class="anchor" id="id_editing_table_and_cell_options_using_table_attributes"></a> Editing table and cell options using table attributes</h3><p>You can set a table option that controls the appearance of the table or cell. For example, you may want to set the stroke or fill.<p>Apply an override for the table attribute. Table attributes define how the table appears. A table attribute (<a class="el" href="class_i_table_attr_report.html">ITableAttrReport</a> interface) describes a single table property.<p>To apply an override to the selected table or cells, use <a class="el" href="class_i_table_suite.html">ITableSuite</a>. To get <a class="el" href="class_i_table_suite.html">ITableSuite</a>, query the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for it or call <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> to get <a class="el" href="class_i_table_suite.html">ITableSuite</a> for the active selection.<p>To apply an override to a table or cells chosen programmatically, use <a class="el" href="class_i_table_commands.html">ITableCommands</a>.<p><b>Sample Code</b><ul><li><a class="el" href="class_snp_set_table_fill.html">SnpSetTableFill</a><li>TableAttributes SDK sample<li>API reference documentation page for <a class="el" href="class_i_table_attr_report.html">ITableAttrReport</a>, for a complete list of all table attributes. Table attribute overrides are applied using methods provided by <a class="el" href="class_i_table_suite.html">ITableSuite</a> or <a class="el" href="class_i_table_commands.html">ITableCommands</a>.</ul><h3><a class="anchor" id="id_setting_the_stroke_for_a_cell"></a> Setting the stroke for a cell</h3><p>To set the stroke for a cell, apply an attribute override. Use <a class="el" href="class_i_table_suite.html#a45f2bc6b39f01a7ed79588c6a35b99ba">ITableSuite::ApplyCellStrokes</a> to edit the stroke of cells that are selected. Use <a class="el" href="class_i_table_commands.html#aa97b8da3ba29fcfc2f860a1e8369c2a0">ITableCommands::ApplyCellStrokes</a> to edit the stroke of cells chosen programmatically. This requires populating a data object defined in <a class="el" href="class_i_cell_stroke_attr_data.html">ICellStrokeAttrData</a>, to target the cell sides to stroke and carry the parameters.<p>The following code fragment populates the data object for applying cell strokes to a cell: <div class="fragment"><div class="line"><a class="code" href="struct_i_cell_stroke_attr_data_1_1_data.html">ICellStrokeAttrData::Data</a> data;data.<a class="code" href="struct_i_cell_stroke_attr_data_1_1_data.html#a03c4f2b13cd06066ae423bae127865af">attrs</a>.</div><div class="line"><a class="code" href="class_i_cell_stroke_attr_data_1_1_attributes.html#a1e3645382729c5c06bb4d31085b9b434">Set</a>(ICellStrokeAttrData::eWeight);</div><div class="line">data.<a class="code" href="struct_i_cell_stroke_attr_data_1_1_data.html#a03c4f2b13cd06066ae423bae127865af">attrs</a>.<a class="code" href="class_i_cell_stroke_attr_data_1_1_attributes.html#abe8179bd522e843dd8adf8651e7f160f">Add</a>(ICellStrokeAttrData::eTint);</div><div class="line">data.<a class="code" href="struct_i_cell_stroke_attr_data_1_1_data.html#a168acd6219d5228f3c8e39a611bc7300">sides</a> = Tables::eTopSide;data.weight = newWeight; </div><div class="line"><span class="comment">// a PMReal specifying new weight in pointsdata.</span></div><div class="line">tintPercent = newTintPercent; </div><div class="line"><span class="comment">// a PMReal giving tint in percent</span></div></div><h3><a class="anchor" id="id_setting_the_fill_color_for_a_cell"></a> Setting the fill color for a cell</h3><p>To set the fill for a cell, apply an attribute override. Use <a class="el" href="class_i_table_suite.html">ITableSuite</a> to edit the fill of cells that are selected. Use <a class="el" href="class_i_table_commands.html">ITableCommands</a> to edit the fill of cells chosen programmatically. For sample code, see the <a class="el" href="class_snp_set_table_fill.html">SnpSetTableFill</a> code snippet.<h3><a class="anchor" id="id_changing_the_cell_content_text_direction"></a> Changing the cell content text direction</h3><p>You can get the &quot;rotation-follow-story&quot; (yes or no) and rotation (angle) attributes using <a class="el" href="classk_cell_attr_rotation_follow_story_boss.html">kCellAttrRotationFollowStoryBoss</a> or <a class="el" href="classk_cell_attr_rotation_boss.html">kCellAttrRotationBoss</a>. You may need to take account of the text direction when you determine whether a cell is overset.<h3><a class="anchor" id="id_adding_a_background_image_to_a_cell"></a> Adding a Background Image to a cell</h3><p>In some cases, the best approach is to put an inline graphic into the text model, into the text span associated with the cell, although this may not fill the cell exactly.<h3><a class="anchor" id="id_acquiring_a_reference_to_a_table_frame"></a> Acquiring a reference to a table frame</h3><p>The table layout (<a class="el" href="class_i_table_layout.html">ITableLayout</a>) is aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>. It provides very detailed information about the layout of the table. Use ITableFrame::GetParcelFrameUID to get at an individual table frame to which a parcel is mapped. This method yields a reference to a <a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a> object. Alternately, <a class="el" href="class_i_parcel_list.html">IParcelList</a>, which is aggregated on the kTableCellContentBoss (as described in the &quot;Getting a parcel, given a grid address&quot;) also has a method, GetParcelFrameUID, that you can use it to get to the corresponding frame.<p>It also is possible to discover the table frames in a story from the owned item strand. This mechanism is more delicate and requires additional information (from <a class="el" href="class_i_text_strand.html">ITextStrand</a>) to determine where one table ends and another begins.<h2><a class="anchor" id="id_text_in_tables"></a> Text in tables</h2><h3><a class="anchor" id="id_finding_the_text_model_in_which_a_table_is_embedded"></a> Finding the text model in which a table is embedded</h3><p>Table model boss objects (see <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) are dependants of a story (see <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). Many tables can be nested within a single story, and tables can be nested within one another to an arbitrary depth.<p>The interface <a class="el" href="class_i_table_text_container.html">ITableTextContainer</a> provides a connection between the table model (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) and the text model (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) that encapsulates its textual content.<p>If you have an <a class="el" href="class_i_table_model.html">ITableModel</a> interface, you can find the text model in which it is embedded, by querying for <a class="el" href="class_i_table_text_container.html">ITableTextContainer</a> through this interface and using <a class="el" href="class_i_table_text_container.html#a6e26fa9779e3d9d0770a56efaf197c84">ITableTextContainer::QueryTextModel</a>.<h3><a class="anchor" id="id_editing_the_text_displayed_in_a_table_cell"></a> Editing the text displayed in a table cell</h3><p>You can edit the text displayed in a table cell.<p>To set the text for a table cell, use <a class="el" href="class_i_table_commands.html#a2510547db4b24c5bb35f12767132e58e">ITableCommands::SetCellText</a>.<p>To get the text for a table cell, locate the story thread (see interface <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) that stores the text the cell displays, then use <a class="el" href="class_text_iterator.html">TextIterator</a> to access that range of text.<p>To format the text for a table cell, locate the story thread (see interface <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) that stores the text that the cell displays, then use ITextModelCmds::Apply::ApplyCmd to apply text attributes to that range of text.<p><b>Sample code</b><ul><li>TableBasics, <a class="el" href="class_tbl_bsc_suite_text_c_s_b.html#a1672cb7f7ad52e6dcff97e77a55f2e3b">TblBscSuiteTextCSB::GetCellText</a>, and <a class="el" href="class_tbl_bsc_suite_text_c_s_b.html#ac2662fc10f34087503b52ed73b463a31">TblBscSuiteTextCSB::SetCellText</a>, SDK code samples<li>SnpAccessTableContents</ul><h3><a class="anchor" id="id_relationship_between_parcels_and_cells"></a> Relationship between parcels and cells</h3><p>For every cell in the table, there is an associated parcel (<a class="el" href="class_i_parcel.html">IParcel</a>) in a parcel list represented by <a class="el" href="class_i_parcel_list.html">IParcelList</a>. Parcels are about geometry and represent the bounds of regions into which text composition can occur.<h3><a class="anchor" id="id_difference_between_iparcellist_and_itextparcellist"></a> Difference between IParcelList and ITextParcelList</h3><p>The interface <a class="el" href="class_i_parcel_list.html">IParcelList</a> should not be confused with <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>, which is a cache for the text spans associated with each parcel. <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a> is a key part of text composition but does not represent geometry. <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a> is not likely to be used in client code in most cases, unless you are trying to determine whether a particular cell is overset.<h3><a class="anchor" id="id_getting_a_parcel_given_a_grid_address"></a> Getting a parcel, given a grid address</h3><p>Text cells are represented by <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>. This class aggregates an <a class="el" href="class_i_parcel_list.html">IParcelList</a> interface, which contains a list of parcels; the length of the list is likely to be at most one.<p>The parcel list on a <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a> object might contain, for example, one instance of a <a class="el" href="classk_text_cell_parcel_boss.html">kTextCellParcelBoss</a> object, which exposes an <a class="el" href="class_i_parcel.html">IParcel</a> interface.<p>To work with a table, if you have a grid address and an <a class="el" href="class_i_table_model.html">ITableModel</a>, you can get a reference to a <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>. There are at least two ways to get to a <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>:<ul><li>The easiest way is to use <a class="el" href="class_i_table_model.html#aeee9b6b4ed996796550e1cf052a98d52">ITableModel::QueryCellContentBoss</a>, passing it the <a class="el" href="class_grid_address.html">GridAddress</a> of an anchor cell.<li>A more efficient way is to use <a class="el" href="class_i_table_model.html#aa705e5e66b26372d01d63798215e82d4">ITableModel::CreateContentBossAccessor</a>, which is faster but cannot be used across structure changes (rows/columns being added or deleted, merges and splits, etc.).</ul><p>The boss class <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a> aggregates <a class="el" href="class_i_cell_content.html">ICellContent</a>; when you have <a class="el" href="class_i_cell_content.html">ICellContent</a>, you can simply use QueryInterface to get <a class="el" href="class_i_parcel_list.html">IParcelList</a>. Then you can use the methods on <a class="el" href="class_i_parcel_list.html">IParcelList</a> (GetParcelCount and QueryNthParcel) to iterate over the parcel collection. There should be just one parcel that can be used to determine the bounds into which the cell text will be flowed. The <a class="el" href="class_snp_get_table_parcel.html">SnpGetTableParcel</a> sample code illustrates this concept.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_get_table_parcel.html">SnpGetTableParcel</a></ul><h3><a class="anchor" id="id_getting_to_the_text_given_a_grid_address"></a> Getting to the text, given a grid address</h3><p>Given a grid address, there are several ways to get to cell text. You can use the method described above (&quot;Getting a parcel, given a grid address&quot;) to acquire a reference to a cell content boss. For instance, when you have a content boss, check whether it aggregates <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>; if it does, you can be confident it is a text cell. When you have an <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>, you can ask it for the associated start, span, and text model (<a class="el" href="class_i_text_model.html">ITextModel</a>). Once you have these three pieces of information, you can get the characters. For an example, see the <a class="el" href="class_snp_access_table_content.html#a472db2e8821b1b1e1486dba35678796c">SnpAccessTableContent::GetTextFromCell</a> method SDK code snippet.<p>Alternatively, given an <a class="el" href="class_i_text_model.html">ITextModel</a> (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), query for <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> and use methods like <a class="el" href="class_i_compose_scanner.html#a987c0c2fbb7f0733d979416f05cfea67">IComposeScanner::QueryDataAt</a> to acquire the characters.<p>It also is possible to use the <a class="el" href="class_i_table_model.html">ITableModel</a> and <a class="el" href="class_i_text_model.html">ITextModel</a> methods without interacting with <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a> methods directly. This is relatively easy. Given a <a class="el" href="class_grid_address.html">GridAddress</a>, turn it into a <a class="el" href="class_grid_i_d.html">GridID</a> by using <a class="el" href="class_i_table_model.html#a315d90d77faa37c27b25be712a6ee420">ITableModel::GetGridID</a>. Once you have a <a class="el" href="class_grid_i_d.html">GridID</a>, you can determine the text story thread associated with the given <a class="el" href="class_grid_i_d.html">GridID</a>. If you already have a table model reference, the quickest route is to use the <a class="el" href="class_i_table_text_container.html">ITableTextContainer</a> interface (also on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) to get the <a class="el" href="class_i_text_model.html">ITextModel</a> (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) in which the table is embedded, then find the thread start and span from the <a class="el" href="class_i_text_model.html">ITextModel</a>.<h3><a class="anchor" id="id_knowing_when_a_cell_is_overset"></a> Knowing when a cell is overset</h3><p>There is an <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a> interface that is aggregated on <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>. The <a class="el" href="class_i_text_utils.html#a7062f79aac31991e66ed9f7b3b1ba3d5">ITextUtils::IsOverset</a> method takes an <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a> as a parameter.<p>To find out which cells in a given table were overset, do the following:<ul><li>Iterate through all cells in the table.<li>Use one of the content access methods shown in SnpAccessTableContent.cpp to get references to each <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a> object that represents the content.<li>Query for the <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>.<li>Use the <a class="el" href="class_i_text_utils.html#a7062f79aac31991e66ed9f7b3b1ba3d5">ITextUtils::IsOverset</a> method.</ul><h2><a class="anchor" id="id_table_and_cell_styles"></a> Table and cell styles</h2><h3><a class="anchor" id=""></a></h3><p>Like paragraph and character styles, table and cell styles exist on the session or a particular document. You can get a list of table or cell styles available to a session or a document.<p><b>Solution</b><p>Table style and cell style are represented by <a class="el" href="classk_table_style_boss.html">kTableStyleBoss</a> and <a class="el" href="classk_cell_style_boss.html">kCellStyleBoss</a>, respectively. To get the list of the styles, obtain the session or document workspace, then query the <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> interface identified by IID_ITABLESTYLEGROUPMANAGER (for table styles) or IID_ICELLSTYLEGROUPMANAGER (for cell styles). The interface provides the API, GetRootHierarchy(), which returns a pointer to <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> at the root level. Use <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> to iterate through the available styles.<p><b>Sample code</b><ul><li>SnpManipulateTableAndCellStyle::ChooseStyle()</ul><h3><a class="anchor" id="id_getting_all_attributes_of_a_tablecell_style"></a> Getting all attributes of a table/cell style</h3><p>Within the document or application workspace, there is the concept of a root style. Except for the root table or cell style, each table or cell style has a parent style. A style inherits all attributes from its parent, maintaining only those attributes that are different from its immediate parent in its own attributes boss list. You can get all attributes of a given style.<p><b>Solution</b><p><a class="el" href="class_i_style_info.html">IStyleInfo</a> on <a class="el" href="classk_table_style_boss.html">kTableStyleBoss</a> and <a class="el" href="classk_cell_style_boss.html">kCellStyleBoss</a> provide the API <a class="el" href="class_i_style_info.html#a95d080fea0ae34012b6ba34103c56d06">IStyleInfo::GetBasedOn</a> that stores its immediate parent style. You can traverse up to root to collect all applicable attributes. However, we recommend using either ITableStylesFacade::GetTableStyleAttrsResolved() or ICellStylesFacade::GetCellStyleAttrsResolved() to get the complete list of attributes.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a787c1d2a18b8c8ba90211ea2ba1cf913">SnpManipulateTableAndCellStyle::GetRegionalStyle</a></ul><h3><a class="anchor" id="id_determining_the_value_of_an_attribute_within_a_style"></a> Determining the value of an attribute within a style</h3><p>You can determine what a style means to a particular attribute; that is, what value for a particular attribute would be applied to a table or cell.<p><b>Solution</b><ol type="1"><li>Since styles do not maintain a full set of attributes, you need to obtain a complete list of a style. See <a class="el" href="id_solutions.html#id_getting_all_attributes_of_a_tablecell_style">Getting all attributes of a table/cell style</a>.<li>Query the list for the particular attribute of interest (use <a class="el" href="class_attribute_boss_list.html#a7006646651ef87b63b611c4eb8d2ea1d">AttributeBossList::QueryByClassID()</a> ). This returns the desired attribute.<li>Obtain the value of the attribute via the appropriate interface.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a787c1d2a18b8c8ba90211ea2ba1cf913">SnpManipulateTableAndCellStyle::GetRegionalStyle</a></ul><h3><a class="anchor" id=""></a></h3><p><b>Solution</b><p>You can create table and cell styles by processing the required command (<a class="el" href="classk_create_table_style_cmd_boss.html">kCreateTableStyleCmdBoss</a> or kCreateCellStyleCmdBoss); however, we recommended you use ITableStylesFacade::CreateTableStyle() or ICellStylesFacade::CreateCellStyle(). You may pass style name, parent style (based on style), and your own attributes that are different from the parent&#39;s.<p>The style name should be unique. To generate a unique name, call <a class="el" href="class_i_style_utils.html#acdadfec4df82144c6cf0cb9a48ba5241">IStyleUtils::CreateUniqueName()</a>.<p><b>Sample code</b><ul><li>SnpManipulateTableAndCellStyle::CreateCellStyle<li>SnpManipulateTableAndCellStyle::CreateTableStyle</ul><h3><a class="anchor" id=""></a></h3><p>Given a table or cell style, you might need to modify it, either by modifying the attributes the style represents or changing some other definitions of the style, like its style name.<p><b>Solution</b><p>You can handle changes to styles through the <a class="el" href="classk_edit_table_style_cmd_boss.html">kEditTableStyleCmdBoss</a> or <a class="el" href="classk_edit_cell_style_cmd_boss.html">kEditCellStyleCmdBoss</a> command; however, we recommend using their respective facades: ITableStylesFacades::EditTableStyle() and ICellStylesFacades::EditCellStyle(). Generally, you will do the following:<ol type="1"><li>Get and store current style definitions, like style name, parent style, and local attributes boss list. Since you are likely to change only some of the definitions, it is desirable to keep a copy of the original data.<li>Prepare the piece of data you want to change. For example, to change style name, you need to get a new unique name; to change a specific attribute, apply the new attribute to the attribute boss list obtained in previous step.<li>Modify the style by calling ITableStylesFacades::EditTableStyle() or ICellStylesFacades::EditCellStyle().</ol><dl class="section note"><dt>Note<dd>If a style&#39;s parent style is changed, all inherited attributes of the style are changed except those attributes with local overrides.</dl><p><b>Related APIs</b><ul><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a2c0c407944a8f42656af2853b4dcafbe">SnpManipulateTableAndCellStyle::ModifyCellStyle</a><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a2c4dbb1624b8d3e4888cf24f89e22b2b">SnpManipulateTableAndCellStyle::ModifyTableStyle</a></ul><h3><a class="anchor" id=""></a></h3><p>You can delete a style from a document or a session.<p><b>Solution</b><p>Since a table or cell could have been applied to table and cell in the document or used in to define other styles, you must provide an alternate style as a replacement style before deletion. To delete an existing style, call ITableStylesFacades::DeleteTableStyle() or ICellStylesFacades::DeleteCellStyle().<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a1c84ff832622acaca00aaed35f11141c">SnpManipulateTableAndCellStyle::DeleteCellStyle</a><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a109f3ab086a57311bef0b45985eb8398">SnpManipulateTableAndCellStyle::DeleteTableStyle</a></ul><h3><a class="anchor" id=""></a></h3><p>Given a table or cell style, you can apply it to a table, cell, or the current selection.<p><b>Solution</b><p>If you are dealing with a table/cell selection, query <a class="el" href="class_i_table_style_suite.html">ITableStyleSuite</a> or <a class="el" href="class_i_cell_style_suite.html">ICellStyleSuite</a> from the active selection manager and call the ApplyTableStyle or ApplyCellStyle method to apply table or cell style to the selected table or cells.<p>To apply a table style to a table specified as a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the table model, use ITableStylesFacade::ApplyTableStyle(). You have the options to override current table attribute overrides and cell styles applied.<p>To apply a cell style to one or more cells, use ICellStylesFacade::ApplyCellStyle(). You can specify the cell with a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the table and a <a class="el" href="class_grid_area.html">GridArea</a> of the table.<p><b>Sample code</b><ul><li>SnpManipulateTableAndCellStyle::ApplyCellStyle<li>SnpManipulateTableAndCellStyle::ApplyTableStyle</ul><h3><a class="anchor" id=""></a></h3><p>You can determine the table or cell style for a specific table or cell.<p><b>Solution</b><p>If you have a table/cell selection, obtain the selection suite interface <a class="el" href="class_i_table_style_suite.html">ITableStyleSuite</a> and <a class="el" href="class_i_cell_style_suite.html">ICellStyleSuite</a> from the active selection manager and call the GetSelectedTableStyle or GetSelectedCellStyles method to get the applied table or cell styles.<p>To get the table style from a table specified as a <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, use ITableStylesFacade::GetTableStyle().<p>To get the cell styles from cells specified by a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the table and a <a class="el" href="class_grid_area.html">GridArea</a>, use ICellStylesFacade::GetSelectedCellStyles().<h3><a class="anchor" id=""></a></h3><p>You can remove overrides of a table or cells, to leave the table and cells formatted to the applied table or cell style.<p><b>Solution</b><p>If you have a table/cell selection, obtain the suite interface <a class="el" href="class_i_table_style_suite.html">ITableStyleSuite</a> or <a class="el" href="class_i_cell_style_suite.html">ICellStyleSuite</a> via the active selection manager, then call <a class="el" href="class_i_table_style_suite.html#ab389014c9d86c1b717d03e051ee22f38">ITableStyleSuite::ClearLocalOverrides()</a> or <a class="el" href="class_i_cell_style_suite.html#aab2c51883934f829c66a85a879146316">ICellStyleSuite::ClearOverrides()</a>.<p>To to remove local overrides from a table specified by a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the table model, use ITableStylesFacade::ClearLocalOverrides(). You have an option to clear all cell styles applied to the table cells.<p>To remove local overrides from cells specified by a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the table and a <a class="el" href="class_grid_area.html">GridArea</a>, use ICellStylesFacade::ClearCellStyleOverrides().<h3><a class="anchor" id="id_obtaining_the_regional_cell_style_of_a_table_style"></a> Obtaining the regional cell style of a table style</h3><p>Each table style defines a set of regions such as headers and body rows. Each region can be assigned a cell style. You can get the cell style for a specific region in a table style.<p><b>Solution</b><p>Regional cell styles are considered table attributes of a table style. To get the attribute value of the related attributes, see <a class="el" href="id_solutions.html#id_determining_the_value_of_an_attribute_within_a_style">Determining the value of an attribute within a style</a>. The steps are described briefly below:<ol type="1"><li>Get a complete list of table attributes of the table style, using ITableStylesFacade::GetTableStyleAttrsResolved().<li>Prepare ClassIDs to represent table regions. Predefined regions include header rows, footer rows, left column, right column, and body rows. Except for body rows, each region has two related attributes, &quot;cell style&quot; and &quot;use body,&quot; that determine a regional style. For example, <a class="el" href="classk_table_attr_header_cell_style_boss.html">kTableAttrHeaderCellStyleBoss</a> and <a class="el" href="classk_table_attr_header_use_body_cell_style_boss.html">kTableAttrHeaderUseBodyCellStyleBoss</a> determine header rows regional style. Body rows regional style do not have a &quot;use body&quot; attribute.<li>Query the &quot;cell style&quot; and &quot;use body&quot; attributes from the complete list of attributes of the table style.<li>Get the result. If the region is not &quot;body rows&quot; and the value of the <a class="el" href="class_i_table_attr_bool16.html">ITableAttrBool16</a> interface of the &quot;use body&quot; attribute is kTrue, the regional cell style is the same as body rows; otherwise, the regional cell style is the value of the <a class="el" href="class_i_table_attr_u_i_d.html">ITableAttrUID</a> interface of the &quot;cell style&quot; attribute.</ol><p><b>See Also</b><ul><li>For a table of bosses that define regions, see the &quot;Tables&quot; chapter of Adobe InDesign Plug-in Programming Guide.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#a787c1d2a18b8c8ba90211ea2ba1cf913">SnpManipulateTableAndCellStyle::GetRegionalStyle</a></ul><h3><a class="anchor" id="id_setting_the_regional_cell_style_of_a_table_style"></a> Setting the regional cell style of a table style</h3><p>You can set the cell style for specific regions in a table style.<p><b>Solution</b><p>Setting regional cell styles is the same process as modifying a table style. The steps are described briefly below:<ol type="1"><li>Get the original settings of a table style, as described in&quot;Modifying an existing table/cell style&quot;.<li>According to the region of interest, create appropriate &quot;cell style&quot; and/or &quot;use body&quot; attributes. (If the region is body rows, you do not need the &quot;use body&quot; attribute.) For example, if the region is the header row, create attribute <a class="el" href="classk_table_attr_header_cell_style_boss.html">kTableAttrHeaderCellStyleBoss</a> and set <a class="el" href="class_i_table_attr_u_i_d.html">ITableAttrUID</a> to the cell style you want to set, then create <a class="el" href="classk_table_attr_header_use_body_cell_style_boss.html">kTableAttrHeaderUseBodyCellStyleBoss</a> and set <a class="el" href="class_i_table_attr_bool16.html">ITableAttrBool16</a> to kFalse.<li>Add the newly created attributes to the local attribute list of the table style, using <a class="el" href="class_attribute_boss_list.html#a30d8350b9d89d0d3bcc1703d2978da20">AttributeBossList.ApplyAttribute()</a>.<li>Update the table style by calling ITableStylesFacade::EditTableStyle().</ol><p><b>See Also</b><ul><li>For a table of bosses that define regions, see the &quot;Tables&quot; chapter of Adobe InDesign Products Programming Guide.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_table_and_cell_style.html#abdf51b34f730f2894ca4768165cbbf0e">SnpManipulateTableAndCellStyle::SetRegionalStyle</a></ul><h1><a class="anchor" id="id_graphics"></a> Graphics</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>This chapter provides implementation hints for common use cases and answers frequently asked questions involving the Adobe InDesign graphics API.<h2><a class="anchor" id="id_paths"></a> Paths</h2><h3><a class="anchor" id="id_obtaining_path_information"></a> Obtaining path information</h3><p>You can get path information from a page item, such as a spline item, text outline, and text wrap.<p><b>Solution</b><p>Use the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> interface to retrieve the path information, as follows:<ol type="1"><li>Determine what type of path you are looking for, and make sure you look in the right page item for the path. (Do not confuse the graphic page item with the graphics frame.) For example:<ul><li>For information about the clipping path, look in the graphic page item, not the graphics frame.<li>For information about the text wrap path of a graphic page item, look for the text wrap object (defined as <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a>).<li>For information about the path of a spline item (frames, lines, and curves), look for the <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> item.<li>For information about the outline paths of characters in a segment of text, you need to create the text outline and look for the newly created inline spline item.</ul><li>Query the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> interface on the page item boss to get the path information you want, using various methods to get such information as the number of paths, number of segments, number of path points, and path bounding box.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_path_info.html">SnpInspectPathInfo</a><li><a class="el" href="class_snp_select_shape.html">SnpSelectShape</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_path_geometry.html">IPathGeometry</a></ul><h3><a class="anchor" id="id_inserting_a_new_point_into_an_existing_path"></a> Inserting a new point into an existing path</h3><p><b>Solution</b><p>Use the <a class="el" href="classk_add_spline_points_cmd_boss.html">kAddSplinePointsCmdBoss</a> command, as follows:<ol type="1"><li>First construct the <a class="el" href="class_p_m_path_point.html">PMPathPoint</a> item for the new path point, with an anchor point and two direction points.<li>Transform the coordinates of the new point such that they are in the same coordinate system as the existing points&#39; coordinates. For example, if the coordinates of your new point are in pasteboard coordinates, apply a transformation to convert from pasteboard to inner coordinates.<li>Create the <a class="el" href="classk_add_spline_points_cmd_boss.html">kAddSplinePointsCmdBoss</a> command.<li>Query <a class="el" href="class_i_modify_path_points_cmd_data.html">IModifyPathPointsCmdData</a> on the command. Specify the path index of the path into which you want to insert the new point, the point index of the point before which you want to insert the new point, and the number of points you want to insert.<li>Query <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> on the command. Add a new path and append to it the path point you constructed in Step 1.<li>Process the command.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_modify_path_points_cmd_data.html">IModifyPathPointsCmdData</a><li><a class="el" href="class_i_path_geometry.html">IPathGeometry</a><li><a class="el" href="classk_add_spline_points_cmd_boss.html">kAddSplinePointsCmdBoss</a></ul><h3><a class="anchor" id="id_creating_a_compound_path_or_compound_shape_from_selection"></a> Creating a compound path or compound shape from selection</h3><p>You can create a compound path or shape from selected paths or graphics frames that overlap each other. (Compound shapes are created with Pathfinder commands in the InDesign user interface). See <a class="el" href="id_solutions.html#id_creating_a_compound_path_from_page_items">Creating a compound path from page items</a>.<p><b>Solution</b><ol type="1"><li>Query for <a class="el" href="class_i_path_operation_suite.html">IPathOperationSuite</a>, which provides methods for operations related to compound paths and compound shapes.<li>Call the appropriate precondition method to check whether the desired operation is possible on the selection target. (Normally, precondition method names are of the form CanDoXXX; for example, CanMakeCompoundPath.)<li>If the desired operation is possible on the selection target, call the performing method to execute the operation. (Normally, performing method names are of the form DoXXX; for example, MakeCompoundPath to make a compound path.) Check the returned error code to see whether the operation executed as expected.</ol><p><b>Sample code</b><ul><li>SnpManipulatePathandGraphicsstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_path_operation_suite.html">IPathOperationSuite</a></ul><h3><a class="anchor" id="id_creating_a_compound_path_from_page_items"></a> Creating a compound path from page items</h3><p>You can create a compound path from the paths of a several page items, which may or may not be selected. (If all the page items are selected, you can use the solution described in <a class="el" href="id_solutions.html#id_creating_a_compound_path_or_compound_shape_from_selection">Creating a compound path or compound shape from selection</a>.) Since you will combine the page items into one page item, you can manipulate the resulting page item as a whole; for example, assign graphic attributes.<p><b>Solution</b><ol type="1"><li>Create the <a class="el" href="classk_make_compound_path_cmd_boss.html">kMakeCompoundPathCmdBoss</a> command.<li>Prepare the list of page items. InDesign cannot make a compound path from a text-on-path object, a locked page item, or a page item without paths. To filter out these items, use <a class="el" href="class_i_spline_utils.html#a34f46addcdd940c5763bea8aacc2f306">ISplineUtils::FilterMakeCompoundPathList</a>.<li>Set the <a class="el" href="class_i_bool_data.html">IBoolData</a> field of the command boss to kTrue, to tell the command to reverse every other path (so releasing the compound path results in exactly the same original objects).<li>Process the command.</ol><p><b>Sample code</b><ul><li>SnpManipulatePathandGraphicsstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_spline_utils.html">ISplineUtils</a><li><a class="el" href="classk_make_compound_path_cmd_boss.html">kMakeCompoundPathCmdBoss</a></ul><h3><a class="anchor" id="id_converting_a_selected_spline_item_to_a_new_shape"></a> Converting a selected spline item to a new shape</h3><p>You can see the visual effects of using different shapes in the same bounding box. You can select an object and convert it to a new type of shape programmatically.<p><b>Solution</b><p>The following steps assume the graphics frame already is selected.<ol type="1"><li>Query for <a class="el" href="class_i_convert_shape_suite.html">IConvertShapeSuite</a> using <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a>.<li>Determine the shape you want to convert the selected item to, such as line, oval, rectangle, or polygon.<ul><li>To convert to a polygon, you also need to determine the number of edges and star inset of the polygon.<li>To convert to a rectangle, you also may choose the corner effects you want to apply.</ul><li>Call the ConvertPageItemShape method.</ol><dl class="section note"><dt>Note<dd><a class="el" href="class_i_convert_shape_suite.html">IConvertShapeSuite</a> has additional methods for connecting path points; however, these methods are not tested.</dl><p><b>Sample code</b><ul><li>SnpManipulatePathandGraphicsstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_convert_shape_suite.html">IConvertShapeSuite</a></ul><h2><a class="anchor" id="id_graphic_page_items"></a> Graphic page items</h2><h3><a class="anchor" id="id_placing_a_graphics_file_into_a_spread"></a> Placing a graphics file into a spread</h3><p>You can import a graphics file into an InDesign document and let the end user choose a position and size for placing the file in a spread.<p><b>Solution</b><p>Use the kImportAndLoadPlaceGunCmdBoss command to import the file and load the place gun, so the end user can place the item in the spread:<ol type="1"><li>Create kImportAndLoadPlaceGunCmdBoss.<li>Query <a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a> on the command and set the command data, including the <a class="el" href="class_i_data_base.html">IDataBase</a> of the document, the <a class="el" href="class_i_d_file.html">IDFile</a> of the graphics file, and the UI flag.<li>Process the command.</ol><dl class="section note"><dt>Note<dd>Generally, the process for importing a graphics file is the same as for importing other types of assets, like text.</dl><p><b>Sample code</b><ul><li><a class="el" href="class_x_doc_bk_x_m_l_post_import_iteration.html#ae942cd91aa2fc37d3564866ab18f5a89">XDocBkXMLPostImportIteration::ImportImage</a><li><a class="el" href="class_pnl_trv_utils.html#aee69673340af2bb9d79aebd0a59bcd91">PnlTrvUtils::ImportImageAndLoadPlaceGun</a><li><a class="el" href="class_s_d_k_layout_helper.html#a229aaedfc538dbc6bbf7ae3417bc8093">SDKLayoutHelper::PlaceFileInFrame</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a><li>kImportAndLoadPlaceGunCmdBoss</ul><h3><a class="anchor" id="id_placing_a_graphics_file_into_an_existing_graphics_frame"></a> Placing a graphics file into an existing graphics frame</h3><p><b>Solution</b><p>Use kImportAndPlaceCmdBoss to import the file and place the item into an existing graphics frame, as follows:<ol type="1"><li>Create kImportAndPlaceCmdBoss.<li>Query <a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a> on the command and set the command data, including the <a class="el" href="class_i_data_base.html">IDataBase</a> of the document, the <a class="el" href="class_i_d_file.html">IDFile</a> of the graphics file, and the UI flag.<li>Query <a class="el" href="class_i_place_p_i_data.html">IPlacePIData</a> on the command, set the graphics frame as the parent page item, provide initial position, and set usePlaceGunContents to kFalse.<li>Process the command.</ol><p><b>Sample code</b><ul><li>SDKLayoutHelperstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a><li>kImportAndPlaceCmdBoss<li><a class="el" href="class_i_place_p_i_data.html">IPlacePIData</a></ul><h3><a class="anchor" id="id_getting_a_graphic_object_from_a_layout_selection"></a> Getting a graphic object from a layout selection</h3><p>You can get the graphic page item from the layout selection, regardless of what is selected. You can get a list of page items from the layout selection target, but you do not know whether a selected item is the graphic page item itself or its graphics frame, and some settings are valid only on graphic page items, like clipping path and text wrap.<p><b>Solution</b><p>Traverse the page item hierarchy and use an interface specific to graphic page items (like <a class="el" href="class_i_image_data_access.html">IImageDataAccess</a>) to identify graphic page items:<ol type="1"><li>For each page item, try to query <a class="el" href="class_i_image_data_access.html">IImageDataAccess</a>.<li>If the interface exists and has a low-resolution proxy image associated with it (using <a class="el" href="class_i_image_data_access.html#a9a812ebbb0470e547449e5e0f82c72f5">IImageDataAccess::GetLowResImageUID</a>), the item is the graphic page item itself.<li>If the item is not the graphic page item itself, check the item&#39;s children.<ul><li>If the item has more than one hierarchical child, the item is not a graphic page item.<li>If the item has only one hierarchical child, check whether the child has the <a class="el" href="class_i_image_data_access.html">IImageDataAccess</a> interface by querying for it and a low-resolution proxy image associated with it. If the child has the interface, the child is the graphic page item; return it. Otherwise, the selected item does not contain graphics.</ul></ol><p><b>Sample code</b><ul><li>SnpGraphicHelperstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_image_data_access.html">IImageDataAccess</a><li><a class="el" href="class_i_hierarchy.html">IHierarchy</a></ul><h3><a class="anchor" id="id_moving_a_graphic_page_item_within_a_frame"></a> Moving a graphic page item within a frame</h3><p>You can shift a graphic within the graphics frame in which it was already placed.<p><b>Solution</b><p>Graphic-page-item transformations (like moves) are performed the same as for page items:<ol type="1"><li>Query ITransformFacade, and call the TransformItems method.<li>Create <a class="el" href="classk_transform_page_items_cmd_boss.html">kTransformPageItemsCmdBoss</a>, set the command&#39;s parameter, and process the command.</ol><p><b>Sample code</b><ul><li>BscDNDCustomFlavorHelperstyleToUse</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_transform_cmd_data.html">ITransformCmdData</a>, <a class="el" href="classk_transform_page_items_cmd_boss.html">kTransformPageItemsCmdBoss</a>.</ul><h3><a class="anchor" id="id_fitting_graphics_content_to_its_frame"></a> Fitting graphics content to its frame</h3><p>You can fit a graphic page item to its graphics frame or fill the frame with the graphic page item.<p><b>Solution</b><p>If the content and/or frame is selected, use appropriate methods on <a class="el" href="class_i_frame_content_suite.html">IFrameContentSuite</a>. This suite provides operations on selected items, like the <a class="el" href="class_i_frame_content_suite.html#ab5c65c6d170ef137a2fdf36c26ce05ba">IFrameContentSuite::FitFrameToContent</a> method.<p>If you have a list of items, use appropriate methods on IFrameContentFacade, like the IFrameContentFacade::FitFrameToContent(UIDList&amp; items) method.<p>Alternatively, create and directly process appropriate commands, like <a class="el" href="classk_fit_frame_to_content_cmd_boss.html">kFitFrameToContentCmdBoss</a>, <a class="el" href="classk_fit_content_to_frame_cmd_boss.html">kFitContentToFrameCmdBoss</a>, <a class="el" href="classk_fit_content_prop_cmd_boss.html">kFitContentPropCmdBoss</a>, and <a class="el" href="classk_center_content_in_frame_cmd_boss.html">kCenterContentInFrameCmdBoss</a>. Note the following:<ul><li><a class="el" href="classk_fit_frame_to_content_cmd_boss.html">kFitFrameToContentCmdBoss</a> needs the frame as its item list; other commands need the contents as their item list. You can use <a class="el" href="class_i_frame_content_utils.html">IFrameContentUtils</a> to get contents from frames and vice versa.<li><a class="el" href="classk_fit_content_prop_cmd_boss.html">kFitContentPropCmdBoss</a> has an <a class="el" href="class_i_bool_data.html">IBoolData</a> interface that controls whether the command fits content to just barely fill the frame (kFalse to fit content proportionally) or fills all white space by stretching content to be larger than the frame (kTrue to fill frame proportionally).</ul><p><b>Sample code</b><ul><li>SnpManipulatePathandGraphicsstyleToUse<li>SDKLayoutHelperstyleToUse</ul><p><b>Related APIs</b><ul><li>IFrameContentFacade<li><a class="el" href="class_i_frame_content_suite.html">IFrameContentSuite</a><li><a class="el" href="class_i_frame_content_utils.html">IFrameContentUtils</a><li><a class="el" href="classk_center_content_in_frame_cmd_boss.html">kCenterContentInFrameCmdBoss</a><li><a class="el" href="classk_fit_content_to_frame_cmd_boss.html">kFitContentToFrameCmdBoss</a><li><a class="el" href="classk_fit_content_prop_cmd_boss.html">kFitContentPropCmdBoss</a><li><a class="el" href="classk_fit_frame_to_content_cmd_boss.html">kFitFrameToContentCmdBoss</a></ul><h3><a class="anchor" id="id_creating_a_clipping_path_for_a_selected_page_item"></a> Creating a clipping path for a selected page item</h3><p>With graphics placed on a spread, you can create or set clipping paths for the graphic page item.<p><b>Solution</b><p>Use <a class="el" href="class_i_clipping_path_suite.html">IClippingPathSuite</a>. This selection suite has everything that you need to perform clipping path operations, including getting the embedded Photoshop path and alpha channel, setting a clipping path, and converting a clipping path to a frame. Follow these steps:<ol type="1"><li>Query <a class="el" href="class_i_clipping_path_suite.html">IClippingPathSuite</a> and get current clipping path settings by calling QueryActiveClipSettings.<li>Make necessary changes and call appropriate methods to set the settings.</ol><dl class="section note"><dt>Note<dd>If the item is not selected, we recommend you first select the item first. It is much easier to use the selection suite than to set a clipping path directly.</dl><p><b>Sample code</b><ul><li>SnpManipulatePathandGraphicsstyleToUse</ul><p><b>Related APIs</b><ul><li>ConvertPSResourcesToPMTags, <a class="el" href="class_i_clipping_path_suite.html">IClippingPathSuite</a></ul><h3><a class="anchor" id="id_setting_text_wrap_mode"></a> Setting text wrap mode</h3><p>You can set text wrap mode for a list of page items.<dl class="section note"><dt>Note<dd>When a page item is created, the text wrap mode is set to <a class="el" href="class_i_stand_off.html#a3ab0e1dfc6cb6bb64e290d6c1513c71aacc8420a11b98601e32733aed72652f8e">IStandOff::kNone</a> by default. This applies to graphic page items, as well.</dl><p><b>Solution</b><p>Do one of the following:<ul><li>We recommend you use the API <a class="el" href="class_facade_1_1_i_text_wrap_facade.html#a50e8711baf7d7674bf3b4807631ccc23">Facade::ITextWrapFacade::SetMode</a>.<li>Alternatively, create and process <a class="el" href="classk_stand_off_mode_cmd_boss.html">kStandOffModeCmdBoss</a> directly. Make sure the text wrap modes for the graphics frame and the graphic page item are the same; otherwise, the graphic page item&#39;s text wrap mode takes priority. You can set the graphics frame&#39;s mode to kNone and set the graphic page item&#39;s mode to the desired setting.</ul><p><b>Sample code</b><ul><li>SnpManipulateTextFramestyleToUse</ul><p><b>Related APIs</b><ul><li>ITextWrapFacade<li>ITextWrapSuite<li><a class="el" href="classk_stand_off_mode_cmd_boss.html">kStandOffModeCmdBoss</a></ul><h3><a class="anchor" id="id_setting_text_wrap_contour_options"></a> Setting text wrap contour options</h3><p>The effect of setting options is seen when the mode is set to Wrap Around Object Shape (<a class="el" href="class_i_stand_off.html#a3ab0e1dfc6cb6bb64e290d6c1513c71aa5319a236293e731b609487078ca150ac">IStandOff::kManualContour</a>).<p><b>Solution</b><p>The recommended solution is very similar to that for setting text wrap mode. We recommend you use ITextWrapFacade when possible. Normally, setting contour options involves the following steps:<ol type="1"><li>Query ITextWrapFacade.<li>If the page item you have is a graphics frame, get the graphic page item. (See <a class="el" href="id_solutions.html#id_getting_a_graphic_object_from_a_layout_selection">Getting a graphic object from a layout selection</a>.)<li>Get current contour settings by calling the GetContourWrapSettings method. This method returns settings like threshold, tolerance, alpha channel index, and Photoshop path index.<li>Change parameters as needed, and call the SetContourWrapSettings method.</ol><dl class="section note"><dt>Note<dd>You can process <a class="el" href="classk_set_contour_wrap_cmd_boss.html">kSetContourWrapCmdBoss</a> directly; however, you still need to get settings from the facade before you can set the command data.</dl><p><b>Sample code</b><ul><li>SnpManipulatePathandGraphicsstyleToUse</ul><p><b>Related APIs</b><ul><li>ITextWrapFacade<li>ITextWrapSuite<li><a class="el" href="classk_set_contour_wrap_cmd_boss.html">kSetContourWrapCmdBoss</a></ul><h3><a class="anchor" id="id_modifying_settings_of_a_display_performance_group"></a> Modifying settings of a display performance group</h3><p>You can change the settings of a display performance group. (For most cases, the default settings are suitable.) Display performance groups are defined as session preferences.<p><b>Solution</b><p>Use <a class="el" href="classk_set_draw_options_cmd_boss.html">kSetDrawOptionsCmdBoss</a>, as follows:<ol type="1"><li>Declare a local <a class="el" href="class_draw_options_set.html">DrawOptionsSet</a> object. You can initialize the object by getting a display performance group set by ID from the <a class="el" href="class_i_draw_options.html">IDrawOptions</a> session preferences.<li>Choose one or more categories you want to change. For example, to change raster image settings, assign the <a class="el" href="class_draw_options_set.html">DrawOptionsSet</a> raster field to IDrawOptions::kRasterProxy or another value defined in <a class="el" href="class_i_draw_options.html">IDrawOptions</a>.<li>Create <a class="el" href="classk_set_draw_options_cmd_boss.html">kSetDrawOptionsCmdBoss</a>, set the command data, and process the command.</ol><p>There are additional flags on the command that do not change the performance group but do change global preferences:<ul><li>Pass kTrue as the second parameter of <a class="el" href="class_i_set_draw_options_cmd_data.html#aeaef0f41d11695fb9e41ad7217b4f715">ISetDrawOptionsCmdData::SetSet</a> method, to set this performance group as the active group.<li>Pass kTrue to <a class="el" href="class_i_set_draw_options_cmd_data.html#aa3d5392ffa7946ca8d47007b5b730083">ISetDrawOptionsCmdData::SetIgnore</a>, to ignore page item overrides.<li>Pass kTrue to <a class="el" href="class_i_set_draw_options_cmd_data.html#afc843bd72019050e7f4d2bed07959bd8">ISetDrawOptionsCmdData::SetSaveLocalOverrides</a>, to let page item overrides be saved with the document.</ul><p><b>Sample code</b><ul><li>SnpManipulateDisplayPerformancestyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_draw_options_set.html">DrawOptionsSet</a><li><a class="el" href="class_i_draw_options.html">IDrawOptions</a><li><a class="el" href="classk_set_draw_options_cmd_boss.html">kSetDrawOptionsCmdBoss</a></ul><h3><a class="anchor" id="id_changing_layout_display_performance_settings"></a> Changing layout display performance settings</h3><p>You can use a display performance group other than the default performance group for a layout window. Each layout window has a default display performance group.<p>For instructions to modify group settings, see <a class="el" href="id_solutions.html#id_modifying_settings_of_a_display_performance_group">Modifying settings of a display performance group</a>.<p><b>Solution</b><ol type="1"><li>Obtain the layout window for which you want to change the display performance group.<li>Query <a class="el" href="class_i_draw_options_set_i_d.html">IDrawOptionsSetID</a> on <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>.<li>Call IDrawOptionsSetID::SetID(groupID). The groupID could be set to IDrawOptions::kFastGroup, IDrawOptions::kTypicalGroup, or IDrawOptions::kHighQualityGroup.</ol><p><b>Sample code</b><ul><li>SnpManipulateDisplayPerformancestyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_draw_options_set_i_d.html">IDrawOptionsSetID</a><li><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></ul><h3><a class="anchor" id="id_displaying_high-resolution_graphics"></a> Displaying high-resolution graphics</h3><p>Each graphic page item inherits the default display performance settings from the layout when the graphic page item is placed; however, you can force some graphic page items to be displayed at high resolution-using the high-quality performance group-under all circumstances.<p><b>Solution</b><p>If you are setting display performance for selected page items, use IDisplayPerformanceSuite::SetSelectionToHighQuality. Otherwise, if you want to set display performance settings for an arbitrary set of graphic page items, follow these steps:<ol type="1"><li>Create <a class="el" href="classk_set_draw_option_override_cmd_boss.html">kSetDrawOptionOverrideCmdBoss</a>.<li>Query <a class="el" href="class_i_set_draw_option_override_cmd_data.html">ISetDrawOptionOverrideCmdData</a> on the command, and pass IDrawOptions::kHighQualityGroup to the SetDisplayOption method.<li>Set the graphic page items as the command&#39;s ItemList.<li>Process the command.</ol><p>This procedure sets the page item to be displayed using the high-quality performance group (group ID kHighQualityGroup). In standard setting, the high-quality performance group sets the highest quality possible in each category. In certain situations-for example, if the raster category of the group kHighQualityGroup is set to IDrawOptions::kRasterGrayOut- the raster image is displayed as a gray box.<p>To ensure the item always is displayed at high quality, set the display settings of the performance group first (see <a class="el" href="id_solutions.html#id_modifying_settings_of_a_display_performance_group">Modifying settings of a display performance group</a>), and then set the page item&#39;s override to this group.<p>To let the page item override take effect, the Allow Object-Level Display Setting flag must be selected (View &gt; Display Performance menu). To set this flag programmatically, process <a class="el" href="classk_set_draw_options_cmd_boss.html">kSetDrawOptionsCmdBoss</a> and pass kFalse to <a class="el" href="class_i_set_draw_options_cmd_data.html#aa3d5392ffa7946ca8d47007b5b730083">ISetDrawOptionsCmdData::SetIgnore</a>.<p><b>Sample code</b><ul><li>SnpManipulateDisplayPerformancestyleToUse</ul><p><b>Related APIs</b><ul><li>IDisplayPerformanceSuite<li><a class="el" href="class_i_draw_options.html">IDrawOptions</a><li><a class="el" href="classk_set_draw_option_override_cmd_boss.html">kSetDrawOptionOverrideCmdBoss</a></ul><h2><a class="anchor" id="id_colors_and_swatches"></a> Colors and swatches</h2><h3><a class="anchor" id="id_adding_a_custom_color"></a> Adding a custom color</h3><p>You can add a custom color; for example, to simulate a color from the Pantone Solid Coated library, PANTONE 368 C.<p><b>Solution</b><ol type="1"><li>Determine the setting of the color. For example, PANTONE 368 C is defined as follows: CMYK 0.57 0 1 0 (PANTONE 368 C).<li>Create a temporary rendering object (as <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a>).<li>Set color data, including color space, color array, and ink type, as well as attributes of <a class="el" href="class_i_rendering_object.html">IRenderingObject</a>, like swatch name.<li>Use <a class="el" href="class_i_swatch_utils.html#a6355db58494734b2d1337d2338bc4bd7">ISwatchUtils::CreateNewSwatch</a> to create a new color swatch.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_swatch.html">SnpManipulateSwatch</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_color_data.html">IColorData</a><li><a class="el" href="class_i_ink_data.html">IInkData</a><li><a class="el" href="class_i_rendering_object.html">IRenderingObject</a><li><a class="el" href="class_i_swatch_list.html">ISwatchList</a><li><a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a><li><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></ul><h3><a class="anchor" id="id_creating_a_new_gradient_swatch"></a> Creating a new gradient swatch</h3><p>You can create a new gradient swatch based on an existing color.<p><b>Solution</b><ol type="1"><li>Create a temporary rendering object (as <a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a>).<li>Populate this temporary rendering object with the required information about stop colors, midpoints, and so on.<li>Use <a class="el" href="class_i_swatch_utils.html#a6355db58494734b2d1337d2338bc4bd7">ISwatchUtils::CreateNewSwatch</a> to create a new gradient swatch.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_swatch.html">SnpManipulateSwatch</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_rendering_object.html">IRenderingObject</a><li><a class="el" href="class_i_swatch_list.html">ISwatchList</a><li><a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a><li><a class="el" href="class_i_gradient_fill.html">IGradientFill</a><li><a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a></ul><h3><a class="anchor" id="id_iterating_through_a_swatch_list"></a> Iterating through a swatch list</h3><p>You can iterate through the swatch list of a document or workspace to get information about the color or gradient information of the swatches.<p><b>Solution</b><ol type="1"><li>Obtain <a class="el" href="class_i_swatch_list.html">ISwatchList</a> on the application workspace or on the document workspace. You can get the active swatch list using <a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a>. (See <a class="el" href="id_solutions.html#id_how_do_i_obtain_an_active_swatch_list">How do I obtain an active swatch list?</a>.)<li>To get information about reserved swatches, such as None, Paper, and Black, use the appropriate methods on <a class="el" href="class_i_swatch_list.html">ISwatchList</a>.<li>Iterate over the swatch list. Based on the type of swatch (color, gradient, none, or AGMBlack), instantiate respective interfaces on the boss and get the information you want.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_swatch.html#a0965ee95272d8ee7b6a1734c8b60ad64">SnpManipulateSwatch::IterateSwatchList</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_color_data.html">IColorData</a><li><a class="el" href="class_i_color_overrides.html">IColorOverrides</a><li><a class="el" href="class_i_gradient_fill.html">IGradientFill</a><li><a class="el" href="class_i_ink_data.html">IInkData</a><li><a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a><li><a class="el" href="class_i_rendering_object.html">IRenderingObject</a><li><a class="el" href="class_i_swatch_list.html">ISwatchList</a><li><a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a></ul><h3><a class="anchor" id="id_iterating_through_an_ink_list"></a> Iterating through an ink list</h3><p>You can iterate through the ink list of a document or workspace to get information about inks used.<p><b>Solution</b><ol type="1"><li>Obtain <a class="el" href="class_i_ink_list.html">IInkList</a> on the application workspace or document workspace. You also can get the ink list using methods provided by <a class="el" href="class_i_ink_mgr_utils.html">IInkMgrUtils</a>. (See <a class="el" href="id_solutions.html#id_using_the_ink_manager">Using the ink manager</a>.)<li>Iterate through the ink list. To get the information you want, instantiate appropriate interfaces, like <a class="el" href="class_i_p_m_ink_boss_data.html">IPMInkBossData</a> on <a class="el" href="classk_p_m_ink_data_boss.html">kPMInkDataBoss</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_swatch.html#a2588af53233cf2457eccae34dd784499">SnpManipulateSwatch::IterateInkList</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_ink_list.html">IInkList</a><li><a class="el" href="class_i_ink_mgr_utils.html">IInkMgrUtils</a><li><a class="el" href="class_i_p_m_ink_boss_data.html">IPMInkBossData</a><li><a class="el" href="classk_p_m_ink_data_boss.html">kPMInkDataBoss</a></ul><h3><a class="anchor" id="id_using_the_ink_manager"></a> Using the ink manager</h3><p>You can get information on inks, such as what inks are defined in a workspace and a document, what inks are used for document preflight, and ink alias information.<p><b>Solution</b><ol type="1"><li>Obtain the utility class <a class="el" href="class_i_ink_mgr_utils.html">IInkMgrUtils</a> on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>.<li>Use methods on the interface to perform various tasks, like assigning, changing, or viewing ink aliases; finding spot swatches corresponding to the spot ink; and obtaining ink lists from the document or workspace.<li>You also can get the utility class <a class="el" href="class_i_ink_mgr_u_i_utils.html">IInkMgrUIUtils</a> on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> to invoke the Ink Manager dialog box.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_ink_list.html">IInkList</a><li><a class="el" href="class_i_ink_mgr_u_i_utils.html">IInkMgrUIUtils</a><li><a class="el" href="class_i_ink_mgr_utils.html">IInkMgrUtils</a><li><a class="el" href="class_i_p_m_ink_boss_data.html">IPMInkBossData</a><li><a class="el" href="classk_p_m_ink_data_boss.html">kPMInkDataBoss</a></ul><h3><a class="anchor" id="id_getting_all_images_that_use_the_same_icc_profile"></a> Getting all images that use the same ICC profile</h3><p>You can get all images in a document that use a particular ICC profile; for example, the same profile as that used by the image you currently have.<p><b>Solution</b><p>There is no backward link from the profile to the images that use that profile, so you must iterate through the images using the link manager interfaces to find the images that use a specific profile. Follow these steps:<ol type="1"><li>Get the UID of the profile the current image uses, by querying the IID_ICMSPROFILEUID interface and using IPersistUIDData-&gt; GetUID.<li>Get the <a class="el" href="class_i_links_manager.html">ILinksManager</a> interface from the document boss.<li>For each <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of a link item gotten from <a class="el" href="class_i_links_manager.html#a31c6505612c05b3e85941b10c6bf32d3">ILinksManager::GetNthLinkUID</a>, instantiate IID_ICMSPROFILEUID and compare the UID of the ICC profile with the current image&#39;s profile UID. When the UIDs match, add the image to the list.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_c_m_s_profile.html">ICMSProfile</a><li><a class="el" href="class_i_c_m_s_profile_list.html">ICMSProfileList</a><li><a class="el" href="class_i_c_m_s_utils.html">ICMSUtils</a><li><a class="el" href="class_i_links_manager.html">ILinksManager</a><li><a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a></ul><h2><a class="anchor" id="id_graphic_attributes"></a> Graphic attributes</h2><h3><a class="anchor" id="id_applying_multiple_graphic_attributes_to_page_items"></a> Applying multiple graphic attributes to page items</h3><p>You can apply multiple graphic attributes to page items.<p><b>Solution</b><ol type="1"><li>Determine the attributes you want apply. Typically, you should know the boss ClassID for each attribute.<li>Create <a class="el" href="classk_gfx_apply_mult_attributes_cmd_boss.html">kGfxApplyMultAttributesCmdBoss</a> using <a class="el" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>, and set a <a class="el" href="class_u_i_d_list.html">UIDList</a> of the page items in the command&#39;s item list.<li>Create an instance of each appropriate attribute boss object, and set the appropriate attribute value. This can be done by using the CreateObject method (from <a class="el" href="_create_object_8h_source.html">CreateObject.h</a>), querying for the attribute data interface (such as <a class="el" href="class_i_graphic_attr_real_number.html">IGraphicAttrRealNumber</a>), and setting the value. You also can use existing utility methods on IGraphicsAttributeUtils directly.<li>Obtain the <a class="el" href="class_i_apply_mult_attributes_cmd_data.html">IApplyMultAttributesCmdData</a> command data interface, then call <a class="el" href="class_i_apply_mult_attributes_cmd_data.html#ad28f04edcae1b8ed3efb3f125c9d0d97">IApplyMultAttributesCmdData::AddAnAttribute</a> to add the attribute to the list in the command. Repeat for all desired attributes.<li>Process the command.</ol><dl class="section note"><dt>Note<dd>If you are applying attributes to the active selection, you may use a selection suite; for example, <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a> for page items, <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> for text, or <a class="el" href="class_i_table_suite.html">ITableSuite</a> for tables. (See <a class="el" href="id_solutions.html#id_applying_graphic_attributes_to_the_active_selection">Applying graphic attributes to the active selection</a>.)</dl><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_graphic_attributes.html">SnpManipulateGraphicAttributes</a><li><a class="el" href="class_snp_graphic_helper.html">SnpGraphicHelper</a></ul><p><b>Related APIs</b><ul><li>Graphic attributes - <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a> and IGraphicsAttributeUtils<li>General - <a class="el" href="class_cmd_utils.html">CmdUtils</a> and CreateObject</ul><h3><a class="anchor" id="id_applying_graphic_attributes_to_the_active_selection"></a> Applying graphic attributes to the active selection</h3><p>You can apply graphic attribute to selected page items.<p><b>Solution</b><p>Use a selection suite, like <a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a> or <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a> for page items, <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> for text, or <a class="el" href="class_i_table_suite.html">ITableSuite</a> for tables.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_graphic_attributes.html">SnpManipulateGraphicAttributes</a><li>StrokeWeightMutator sample</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a><li><a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a><li><a class="el" href="class_i_table_suite.html">ITableSuite</a><li><a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a></ul><h3><a class="anchor" id="id_applying_one_graphic_attribute_to_page_items"></a> Applying one graphic attribute to page items</h3><p>You can apply a single graphic attribute to any number of page items.<p><b>Solution</b><p>Use the solution for multiple attributes presented in <a class="el" href="id_solutions.html#id_applying_graphic_attributes_to_the_active_selection">Applying graphic attributes to the active selection</a>, or do one of the following:<ul><li>If there is an IGraphicAttributeUtils::Create&lt;XXX&gt;<a class="el" href="class_command.html">Command</a> method for the attribute you want to apply, call that method, passing the attribute value. These methods create <a class="el" href="classk_gfx_apply_attr_override_cmd_boss.html">kGfxApplyAttrOverrideCmdBoss</a> or <a class="el" href="classk_boss___gfx_state_apply_r_o_attribute_cmd.html">kBoss_GfxStateApplyROAttributeCmd</a> internally.<li>Create an appropriate command. For information on what such a command should do, see <a class="el" href="id_solutions.html#id_applying_graphic_attributes_to_the_active_selection">Applying graphic attributes to the active selection</a>. If the attribute you want to apply is a rendering attribute, use <a class="el" href="classk_boss___gfx_state_apply_r_o_attribute_cmd.html">kBoss_GfxStateApplyROAttributeCmd</a>; if the attribute is not a rendering attribute, use <a class="el" href="classk_gfx_apply_attr_override_cmd_boss.html">kGfxApplyAttrOverrideCmdBoss</a>. Process the command.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_bsc_d_n_d_drag_source.html">BscDNDDragSource</a><li><a class="el" href="class_bsc_shp_action_component.html">BscShpActionComponent</a></ul><p><b>Related APIs</b><ul><li>Graphic attributes - IGraphicsAttributeUtils<li><a class="el" href="class_cmd_utils.html">CmdUtils</a><li>CreateObject</ul><h3><a class="anchor" id="id_getting_one_graphic_attribute_of_a_page_item"></a> Getting one graphic attribute of a page item</h3><p>You can get a specific graphic attribute value, like stroke weight or fill color, from a page item.<p><b>Solution</b><ol type="1"><li>Acquire <a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a> by querying the interface on the page item.<li>Look for an appropriate Get method on <a class="el" href="class_i_graphic_attribute_utils.html">IGraphicAttributeUtils</a>; for example, GetStrokeWeight for stroke weight. If such a method exists, call it to get the attribute value.<li>If no Get method is available for the graphic attribute you want, call that QueryAttribute method on the <a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a> directly, passing in the attribute ClassID and interface ID of the attribute value.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_graphic_attributes.html">SnpManipulateGraphicAttributes</a></ul><p><b>Related APIs</b><ul><li>IGraphicsAttributeUtils</ul><h3><a class="anchor" id="id_getting_all_graphic_attributes_of_a_page_item"></a> Getting all graphic attributes of a page item</h3><p>You can get a list of all graphic attributes of a page item.<p><b>Solution</b><ol type="1"><li>Acquire <a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a> by querying the interface on the page item.<li>Call the <a class="el" href="class_i_graphic_style_descriptor.html#a892119a22a89fef9445810400c7d7e20">IGraphicStyleDescriptor::CreateDescriptorCopy</a> method to get a list of attributes associated with the graphic style and overrides. This list is of type <a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a>.<li>(Optional) Call <a class="el" href="class_i_graphic_style_attribute_boss_list.html#a473e7cfa644eb3ad2bedb432c2ce5134">IGraphicStyleAttributeBossList::GetAttributeCount</a> to get the number of attributes on the page item.<li>Call <a class="el" href="class_i_graphic_style_attribute_boss_list.html#a499aea7c8167d9b92f21d8179699b155">IGraphicStyleAttributeBossList::CreateAttributeNCopy</a> to iterate through each attribute. To get specific values of attributes, you must further query for the data interface (for example, <a class="el" href="class_i_graphic_attr_boolean.html">IGraphicAttrBoolean</a>, <a class="el" href="class_i_graphic_attr_real_number.html">IGraphicAttrRealNumber</a>, <a class="el" href="class_i_graphic_attr_int16.html">IGraphicAttrInt16</a>, <a class="el" href="class_i_graphic_attr_int32.html">IGraphicAttrInt32</a>, and <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a>).</ol><p><b>Related APIs</b><ul><li>IGraphicsAttributeUtils<li><a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a><li><a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a></ul><h3><a class="anchor" id="id_clearing_graphic_attributes_from_a_page_item"></a> Clearing graphic attributes from a page item</h3><p>You can clear specific graphic attributes from a page item&#39;s override list. For example, when a new rendering attribute is changed, you need to remove the graphic attribute first, so the unused attribute boss is released.<p><b>Solution</b><ol type="1"><li>Call <a class="el" href="class_i_graphic_state_utils.html#aed91a259c7c195bb9d98c89648601e84">IGraphicStateUtils::CreateGfxClearOverrideCommand</a> with the specific graphic attribute boss and a list of page items. This creates an underlying <a class="el" href="classk_gfx_clear_attr_override_cmd_boss.html">kGfxClearAttrOverrideCmdBoss</a> command.<li>Process the command.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a><li><a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a><li><a class="el" href="classk_gfx_clear_attr_override_cmd_boss.html">kGfxClearAttrOverrideCmdBoss</a></ul><h3><a class="anchor" id="id_changing_graphic_attributes_of_the_graphics_state"></a> Changing graphic attributes of the graphics state</h3><p>You can change or set the graphic attributes of the graphics state.<dl class="section note"><dt>Note<dd>Changing graphic state is complex and should be avoided if possible.</dl><p><b>Solution</b><p>Check whether there is a selection suite (for example, <a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a>) that you can use. If nothing is selected, calling a selection suite changes defaults (the graphics state).<p>Alternatively, look at utility methods in <a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a>, such as ProcessGfxStateApplyAttribute or ProcessGfxStateAddMultAttributes, with the specific graphic attribute boss or attribute list passed in.<p>Otherwise, create appropriate commands. For rendering attributes, use <a class="el" href="classk_update_def_render_data_cmd_boss.html">kUpdateDefRenderDataCmdBoss</a> and <a class="el" href="classk_private_set_g_s_render_data_cmd_boss.html">kPrivateSetGSRenderDataCmdBoss</a>; for other attributes, use <a class="el" href="classk_gfx_state_change_attribute_cmd_boss.html">kGfxStateChangeAttributeCmdBoss</a>. You also can use <a class="el" href="classk_add_mult_attributes_cmd_boss.html">kAddMultAttributesCmdBoss</a> to set any number of attributes. Fill in suitable command data and process the command.<p><b>Related APIs</b><ul><li><a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a><li><a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a><li><a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a></ul><h3><a class="anchor" id="id_applying_fill_color_or_a_gradient_to_a_page_item"></a> Applying fill color or a gradient to a page item</h3><p>You can fill a layout page item with color.<p><b>Solution</b><p>Follow the procedure in <a class="el" href="id_solutions.html#id_applying_graphic_attributes_to_the_active_selection">Applying graphic attributes to the active selection</a> or <a class="el" href="id_solutions.html#id_applying_one_graphic_attribute_to_page_items">Applying one graphic attribute to page items</a>.<p>To fill page items that are selected, use the <a class="el" href="class_i_graphic_attribute_suite.html#a418ff06696011b4c8c761dcfed645231">IGraphicAttributeSuite::ChangeFillRenderObject(ClassID renderClassID, UID renderUID)</a> method, where renderClass is <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> or <a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a>, and renderUID is the UID of the color or gradient swatch.<p>Alternatively, to fill arbitrary page items, use utilities and commands as follows:<ol type="1"><li>Create a <a class="el" href="classk_boss___gfx_state_apply_r_o_attribute_cmd.html">kBoss_GfxStateApplyROAttributeCmd</a> command.<li>The graphic attribute boss class <a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a> represents the fill associated with a graphic page item in the layout. This boss class aggregates the interface IPersistUIDRefData (with interface identifier of IID_IPERSISTUIDDATA), which holds the UID of the fill color.<li>The command boss aggregates an <a class="el" href="class_i_p_m_unknown_data.html">IPMUnknownData</a> interface. This needs to be populated with a reference to an attribute boss object created in the previous step. Fill in other information of the command data with <a class="el" href="class_i_apply_rend_obj_attr_cmd_data.html">IApplyRendObjAttrCmdData</a>. You also can get the command filled with command data by using the utility method <a class="el" href="class_i_graphic_attribute_utils.html#a5117428f48c2e824e521ce0f5405c39b">IGraphicAttributeUtils::CreateFillRenderingCommand</a> or <a class="el" href="class_i_graphic_state_utils.html#a76e9529fa1c6fec51f2266d2b8a8f9c0">IGraphicStateUtils::CreateGfxApplyOverrideCommand</a>, passing in rendering class ID, rendering UID, and attribute boss class ID (in this case, <a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a>).<li>Process the command.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_bsc_d_n_d_drag_source.html">BscDNDDragSource</a><li><a class="el" href="class_bsc_shp_action_component.html">BscShpActionComponent</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_apply_rend_obj_attr_cmd_data.html">IApplyRendObjAttrCmdData</a><li>IGraphicsAttributeUtils<li><a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a><li>IPersistUIDRefData<li><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></ul><h3><a class="anchor" id="id_applying_stroke_color_or_gradient_to_a_range_of_text"></a> Applying stroke color or gradient to a range of text</h3><p>You can set a stroke color for of a range of text.<p><b>Solution</b><p>To set the stroke color of text that is selected, use IGraphicsAttributeSuite. Pass in graphic attributes instead of text attributes (for example, <a class="el" href="classk_graphic_style_stroke_rendering_attr_boss.html">kGraphicStyleStrokeRenderingAttrBoss</a>).<p>Alternatively, set stroke color using commands, as follows:<ol type="1"><li>Create an instance of an attribute override of type <a class="el" href="classk_text_attr_stroke_color_boss.html">kTextAttrStrokeColorBoss</a>. The key interface on this boss class is <a class="el" href="class_i_text_attr_u_i_d.html">ITextAttrUID</a>. This interface should be populated with the UID of a swatch, which can be created with methods on <a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a>. Before creating the swatch, verify that it does not already exist.<li>Create a <a class="el" href="classk_user_apply_attr_cmd_boss.html">kUserApplyAttrCmdBoss</a> command and set it to apply to a text range, specified by a position and length or by a <a class="el" href="class_range_data.html">RangeData</a> object. There are several ways to create an instance of this command. There is a helper class, <a class="el" href="class_i_text_attr_utils.html">ITextAttrUtils</a>, that can be used to create the command.<li>Process the command.</ol><p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_applying_graphic_attributes_to_the_active_selection">Applying graphic attributes to the active selection</a>.<li><a class="el" href="id_solutions.html#id_applying_one_graphic_attribute_to_page_items">Applying one graphic attribute to page items</a>.<li><a class="el" href="id_solutions.html#id_applying_fill_color_or_a_gradient_to_a_page_item">Applying fill color or a gradient to a page item</a>.</ul><p><b>Sample code</b><ul><li>CHDMUtils<li><a class="el" href="class_snp_insert_glyph.html">SnpInsertGlyph</a><li>SnpTextAttrHelper</ul><p><b>Related APIs</b><ul><li>IGraphicsAttributeSuite<li><a class="el" href="class_i_text_attr_utils.html">ITextAttrUtils</a><li><a class="el" href="class_i_text_attr_u_i_d.html">ITextAttrUID</a><li><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></ul><h3><a class="anchor" id="id_setting_transparency_effect_attributes"></a> Setting transparency effect attributes</h3><p>You can set up the attribute values of a transparency effect.<p><b>Solution</b><p>We recommend using utility functions provided in <a class="el" href="class_i_x_p_attribute_suite.html">IXPAttributeSuite</a> and <a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a>. For example, to put a directional feather with a top width of 10 points on a given page item: <div class="fragment"><div class="line"><a class="code" href="class_k2_vector.html">IXPAttributeSuite::AttributeList</a> myList;</div><div class="line">myList.push_back (<a class="code" href="class_i_x_p_attribute_suite_1_1_attribute_type_and_value.html">IXPAttributeSuite::AttributeTypeAndValue</a>(IXPAttributeSuite::kDirectionalFeatherApply, <a class="code" href="class_i_x_p_attribute_suite_1_1_attribute_value.html">IXPAttributeSuite::AttributeValue</a>(kTrue));</div><div class="line">myList.push_back (<a class="code" href="class_i_x_p_attribute_suite_1_1_attribute_type_and_value.html">IXPAttributeSuite::AttributeTypeAndValue</a>(IXPAttributeSuite::kDirectionalFeatherWidthTop, <a class="code" href="class_i_x_p_attribute_suite_1_1_attribute_value.html">IXPAttributeSuite::AttributeValue</a>(<a class="code" href="class_p_m_real.html">PMReal</a>(10)));</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;IXPAttributeUtils&gt;</a>()-&gt;ApplyAttributes(myList, <a class="code" href="class_u_i_d_list.html">UIDList</a>(pageItemRef));</div></div><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_p_attribute_suite.html">IXPAttributeSuite</a><li><a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a></ul><h3><a class="anchor" id="id_getting_transparency_effect_attributes"></a> Getting transparency effect attributes</h3><p>You can determine whether a page item has a particular transparency effect applied and the value of a transparency attribute.<p><b>Solution</b><p>We recommend using utility functions provided in <a class="el" href="class_i_x_p_attribute_suite.html">IXPAttributeSuite</a> and <a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a>. Find the attribute in which you are interested, then use the utility functions to get the value of the attribute. For example, to determine whether a given page item has a directional feather applied: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGraphicStyleDescriptor&gt;</a> iGfxDesc(pageItemRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_x_p_attribute_suite_1_1_attribute_value.html">IXPAttributeSuite::AttributeValue</a> applied;</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;IXPAttributeUtils&gt;</a>()-&gt;GetAttributeValue(IXPAttributeSuite::kDirectionalFeatherApply, applied, iGfxDesc);</div><div class="line"><span class="keywordflow">if</span> (applied.GetBoolean()){</div><div class="line"><span class="comment">// yes, it&#39;s enabled on this page item</span></div><div class="line">}</div></div><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_p_attribute_suite.html">IXPAttributeSuite</a><li><a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a></ul><h3><a class="anchor" id="id_determining_whether_a_page_item_or_its_stroke_fill_or_content_has_transparency_effects_applied"></a> Determining whether a page item or its stroke, fill, or content has transparency effects applied</h3><p>You can determine whether a page item has any transparency effect applied.<p><b>Solution</b><p>You must iterate through all transparency attributes that determine whether a particular attribute is applied. To get these attributes, see <a class="el" href="id_solutions.html#id_getting_transparency_effect_attributes">Getting transparency effect attributes</a>. The following table lists the attributes that you should check to see whether a page item has transparency effects. If any attribute value is not equal to the value in column 3 of the table, that effect is applied.<table class="doxtable"><tr><th>Transparency Effect</th><th>Attribute Type</th><th>Value When No Effect is Applied </th></tr><tr><td colspan="1" rowspan="4">Basic transparency</td><td>kBSOpacity</td><td><a class="el" href="class_p_m_real.html">PMReal</a>(100.) </td></tr><tr><td>kPMBlendNormal</td><td>kPMBlendNormal </td></tr><tr><td>kBSKnockoutGroup</td><td>kFalse </td></tr><tr><td>kBSIsolationGroup</td><td>kFalse </td></tr><tr><td>Drop shadow</td><td>kDSMode</td><td>kDSMNone </td></tr><tr><td>Basic feather</td><td>kVTMode</td><td>kVTMNone </td></tr><tr><td>Inner shadow</td><td>kInnerShadowApply</td><td>kFalse </td></tr><tr><td>Outer glow</td><td>kOuterGlowApply</td><td>kFalse </td></tr><tr><td>Inner glow</td><td>kInnerGlowApply</td><td>kFalse </td></tr><tr><td>Bevel and emboss</td><td>kBevelEmbossApply</td><td>kFalse </td></tr><tr><td>Satin</td><td>kSatinApply</td><td>kFalse </td></tr><tr><td>Directional feather</td><td>kDirectionalFeatherApply</td><td>kFalse </td></tr><tr><td>Gradient feather</td><td>kGradientFeatherApply</td><td>kFalse </td></tr></table><dl class="section note"><dt>Note<dd>To check whether any transparency effect is applied to stroke, fill or content, you need to check their respective attribute types corresponding to the types listed in the preceding table. For more information about transparency effect attribute types, see the &quot;Graphic Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide.</dl><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_p_attribute_suite.html">IXPAttributeSuite</a><li><a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a></ul><h2><a class="anchor" id="id_drawing"></a> Drawing</h2><h3><a class="anchor" id="id_detecting_the_page_item_drawing_device"></a> Detecting the page item drawing device</h3><p>You can let a page item determine the device to which it is drawing. In theory, it should not matter to a page item whether it is drawing to print, PDF, or screen. The fact that the graphics port is specialized for different devices in these three cases is transparent to the drawing code. There may be situations, however, in which the context determines how an item draws. For example, guides can be set to draw to the screen but not to print.<p><b>Solution</b><p>Use the <a class="el" href="class_i_shape.html">IShape</a> flag passed into the IShape::Draw method by the draw manager. See <a class="el" href="id_solutions.html#id_how_do_i_detect_a_drawing_device_using_drawing_flags">How do I detect a drawing device using drawing flags?</a>.<p>Alternatively, use the viewport information from the <a class="el" href="class_graphics_data.html">GraphicsData</a> pointer passed into the DrawShape method. See <a class="el" href="id_solutions.html#id_how_do_i_detect_a_drawing_device_using_the_viewport_boss">How do I detect a drawing device using the viewport boss?</a>.<p><b>Sample code</b><ul><li>BscDEHDrwEvtHandlerstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_graphics_data.html">GraphicsData</a><li><a class="el" href="class_i_shape.html">IShape</a></ul><h3><a class="anchor" id="id_creating_a_custom_shape"></a> Creating a custom shape</h3><p>You can create a custom shape for a new type of page item.<dl class="section note"><dt>Note<dd>To do custom drawing of existing page items, use page item adornment or draw events.</dl><p><b>Solution</b><ol type="1"><li>In resource definitions, define a new type of page item by inheriting <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> or another existing page item.<li>Override the implementation of IID_ISHAPE, IID_IHANDLESHAPE, and IID_IPATHEHANDSHAPE by modifying CShape.cpp, CPathShape.cpp, CGraphicFrameShape.cpp, and CHandleShape.cpp, included in the SDK.</ol><p><b>Sample code</b><ul><li>BasicShape sample plug-in</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_handle_shape.html">IHandleShape</a><li><a class="el" href="class_i_shape.html">IShape</a></ul><h3><a class="anchor" id="id_creating_thumbnail_images_for_page_items"></a> Creating thumbnail images for page items</h3><p>You can create thumbnail images for page items. For example, you may want these images for previews.<p><b>Solution</b><p>Use <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a>, as follows:<ol type="1"><li>Create and execute <a class="el" href="classk_group_cmd_boss.html">kGroupCmdBoss</a>, to group the page items into a group.<li>Determine scale and resolution. You may want set them according to your desired minimal resolution, image size, and group bounding box.<li>Create an instance of <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> with additional parameters.<li>Draw a snapshot using the <a class="el" href="class_snapshot_utils_ex.html#aae2d859788908fe159aef2a29af46d37">SnapshotUtilsEx::Draw</a> method.<li>Export the snapshot to the thumbnail files in the desired format.<li>Ungroup the group item created in Step 1, by creating and executing <a class="el" href="classk_group_cmd_boss.html">kGroupCmdBoss</a>.</ol><p>Alternatively, use <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a>, as follows:<ol type="1"><li>Determine the boundaries of the page items. You will need the union of each individual bounding box, which can be obtained through <a class="el" href="class_i_shape.html#a27621616698293931ad2a9f97a18bf1b">IShape::GetPrintedBBox</a>(::ParentToPasteboardMatrix(spreadShape)). You also may want to outset the bounds a little bit, so entire items fits within the bounds.<li>Determine scale and resolution. You may want to set them according your desired minimal resolution, image size, and bounding box calculated from the previous step.<li>Create an instance of <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> with additional parameters. Use the version of the constructor with the IDataBase* parameter.<li>Draw each page item onto the snapshot, using the <a class="el" href="class_snapshot_utils_ex.html#aae2d859788908fe159aef2a29af46d37">SnapshotUtilsEx::Draw</a> method.<li>Export the snapshot to thumbnail files in the desired format.</ol><p><b>Sample code</b><ul><li>Snapshot sample plug-in<li>SnpCreateInddPreviewstyleToUse</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_command.html">ICommand</a><li><a class="el" href="class_i_draw_mgr.html">IDrawMgr</a><li><a class="el" href="class_i_shape.html">IShape</a><li><a class="el" href="classk_group_cmd_boss.html">kGroupCmdBoss</a><li>SnapshotUtils<li><a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a></ul><h2><a class="anchor" id="id_frequently_asked_questions"></a> Frequently asked questions</h2><h3><a class="anchor" id="id_how_do_i_open_or_close_a_path"></a> How do I open or close a path?</h3><p>Use the <a class="el" href="classk_open_path_cmd_boss.html">kOpenPathCmdBoss</a> or <a class="el" href="classk_close_path_cmd_boss.html">kClosePathCmdBoss</a> command.<p>Before processing the command, determine whether the path already is open or closed, using <a class="el" href="class_i_path_geometry.html#ac1924481c84e89b2e9f7fc60f7c65d5e">IPathGeometry::IsPathOpen</a>.<h3><a class="anchor" id="id_can_i_manually_change_clipping_path_points"></a> Can I manually change clipping path points?</h3><p>You can change the clipping path through the user interface, by dragging path points using the Direct Selection tool. Programmatically, you can query <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> on the graphic page item and change the path points directly. We strongly recommend you use a command to change the points or encapsulate your changes in a command. See <a class="el" href="id_solutions.html#id_inserting_a_new_point_into_an_existing_path">Inserting a new point into an existing path</a>.<h3><a class="anchor" id="id_how_do_i_obtain_an_active_swatch_list"></a> How do I obtain an active swatch list?</h3><p>The swatch list is accessible through the interface <a class="el" href="class_i_swatch_list.html">ISwatchList</a> on the application workspace or on the document workspace.<p>To obtain the active swatch list, use the following example code: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISwatchList&gt;</a> iSwatchList(<a class="code" href="class_utils.html">Utils&lt;ISwatchUtils&gt;</a> ()-&gt;QueryActiveSwatchList());</div></div><h3><a class="anchor" id="id_how_do_i_determine_whether_a_swatch_exists"></a> How do I determine whether a swatch exists?</h3><p>Before another swatch object (instance of <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a>) is created through a call to one of the ISwatchUtils::Create&lt;XXX&gt; methods, your code should verify whether it is necessary to do so-that is, whether the swatch already exists-using <a class="el" href="class_i_swatch_utils.html#af9d6d8c1c9e5ee850f5749a870d66b4e">ISwatchUtils::GetNamedSwatch</a>. If kInvalidUID is returned, the swatch does not exist in the current database and can be created.<h3><a class="anchor" id="id_how_do_i_delete_a_swatch"></a> How do I delete a swatch?</h3><p>We recommend that you first find a swatch that can be used as a substitute for the swatch to be deleted. Use <a class="el" href="class_i_swatch_utils.html#a06757e2c86e9650734ee23af8a953aed">ISwatchUtils::ReplaceAndDeleteSwatches</a> to delete the swatch and replace it with the substitute. By providing a substitute, you ensure the document will not have a dangling, broken reference to the deleted swatch.<h3><a class="anchor" id="id_how_do_i_add_a_new_type_of_rendering_object"></a> How do I add a new type of rendering object?</h3><p>Adding a new rendering type is difficult and risky. Theoretically, you could implement a kRenderingObjectService and define a new rendering object with IID_IRENDERINGOBJECT and other interfaces. The following is a brief list of interface a new rendering type needs to provide:<ul><li>IID_IINKRESOURCES<li>IID_IRENDERINGOBJECT<li>IID_IRENDERINGOBJECTAPPLYACTION<li>IID_IRENDEROBJECTSERVICE<li>IID_IREFERENCECONVERTER<li>IID_IRIDXNOTIFIERHANDLER<li>IID_ISCRIPT<li>IID_ISCRIPTPROVIDER<li>IID_ISWATCHREFERENCEDATA</ul><p>If this new rendering object type is to have user-interface components that the user can create, edit, delete, duplicate, and interact with the graphic state and object styles, more is required.<p>We recommend you avoid implementing a new type of rendering object.<h3><a class="anchor" id="id_how_do_i_get_the_current_working_rgb_and_cmyk_profile"></a> How do I get the current working RGB and CMYK profile?</h3><p>We recommend you get the current workspace first, then query for the <a class="el" href="class_i_color_presets_settings.html">IColorPresetsSettings</a> interface and get the working profile. See the sample code in the following examples:<p>Getting the working color profile: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> (<a class="code" href="class_utils.html">Utils&lt;ILayoutUIUtils&gt;</a>()-&gt;QueryActiveWorkspace());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IColorPresetsSettings&gt;</a> iColorPresetsSettings(workspace, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICMSProfile&gt;</a> iRGBProfile(iColorPresetsSettings-&gt;QueryWorkingRGB());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICMSProfile&gt;</a> iCMYKProfile(iColorPresetsSettings-&gt;QueryWorkingCMYK());</div></div><p>You may also use <a class="el" href="class_i_c_m_s_utils.html">ICMSUtils</a> to get <a class="el" href="class_i_color_presets_settings.html">IColorPresetsSettings</a> directly: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IColorPresetsSettings&gt;</a> iColorPresetsSettings(<a class="code" href="class_utils.html">Utils&lt;CMSUtils&gt;</a>()-&gt;QueryColorPresetsSettings());</div></div><h3><a class="anchor" id="id_how_do_i_turn_off_color_management"></a> How do I turn off color management?</h3><p>You cannot entirely disable color management; however, InDesign allows you to emulate the Color Management Off behavior of InDesign CS2 and earlier: use the <a class="el" href="class_i_c_m_s_utils.html#ac2dea033c326b92b0171ac035716a7f3">ICMSUtils::DoColorPresetsSettingsSetCmd</a> method. Remember to set the first parameter to kTrue. You also may pass other parameters from current color preset settings.<h3><a class="anchor" id="id_how_do_i_obtain_igraphicstaterenderobject"></a> How do I obtain IGraphicStateRenderObject?</h3><p>To acquire the interface through the active graphic state, use the sample code in the following examples.<p>Acquiring IGraphicStateRenderObject through Active Graphic State: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGraphicStateRenderObjects&gt;</a> iGfxStateRenderObjects (static_cast&lt;IGraphicStateRenderObjects*&gt; (<a class="code" href="class_utils.html">Utils&lt;IGraphicStateUtils&gt;</a> ()-&gt;QueryActiveGraphicState(IID_IGRAPHICSTATE_RENDEROBJECTS)));</div></div><p>To acquire the interface through <a class="el" href="class_i_data_base.html">IDataBase</a>: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGraphicStateRenderObject&gt;</a>iGfxRenderObjects (static_cast&lt;IGraphicStateRenderObjects*&gt; (<a class="code" href="class_utils.html">Utils&lt;IGraphicStateUtils&gt;</a> ()-&gt;QueryGraphicState (iDataBase, IID_IGRAPHICSTATE_RENDEROBJECTS)));</div></div><h3><a class="anchor" id="id_how_do_i_apply_rendering_attributes_to_page_items"></a> How do I apply rendering attributes to page items?</h3><p>If you are applying a rendering attribute to a selection, use methods on <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a>; otherwise, use methods on <a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a> or IGraphicsAttributeUtils to create appropriate commands and process them.<p>The code fragment in the following example uses a command to change the fill color of a spline: <div class="fragment"><div class="line"><span class="comment">// Assume that splineUIDRef is the UIDRef of the page item</span></div><div class="line"><span class="comment">// to change fill color for, and we&#39;re going to fill it</span></div><div class="line"><span class="comment">// with a swatch with UID of color</span></div><div class="line">UIDInterfacePtr&lt;IPersistUIDData&gt; fillRenderAttr(</div><div class="line"> (<a class="code" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a>*)::CreateObject(<a class="code" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a>, IID_IPERSISTUIDDATA));</div><div class="line"> fillRenderAttr-&gt;SetUID(colorUID);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> gfxApplyCmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_boss___gfx_state_apply_r_o_attribute_cmd.html">kBoss_GfxStateApplyROAttributeCmd</a>));</div><div class="line"> gfxApplyCmd-&gt;SetItemList(<a class="code" href="class_u_i_d_list.html">UIDList</a>(splineUIDRef)</div><div class="line">);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPMUnknownData&gt;</a> pifUnknown(gfxApplyCmd,<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">pifUnknown-&gt;SetPMUnknown(fillRenderAttr);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IApplyRendObjAttrCmdData&gt;</a> iCommandData(gfxApplyCmd, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a> ());</div><div class="line">iCommandData-&gt;SetAttributeClassID (<a class="code" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a>);</div><div class="line">iCommandData-&gt;SetRenderingClassID (<a class="code" href="classk_p_m_color_boss.html">kPMColorBoss</a>);</div><div class="line">iCommandData-&gt;SetDataBase (splineUIDRef.GetDataBase());</div><div class="line">ErrorCode err = <a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(gfxApplyCmd);</div></div><h3><a class="anchor" id="id_can_rendering_attributes_be_applied_using_the_commands_that_apply_to_other_kinds_of_graphic_attributes"></a> Can rendering attributes be applied using the commands that apply to other kinds of graphic attributes?</h3><p>The short answer is no. To apply rendering attributes, use <a class="el" href="classk_boss___gfx_state_apply_r_o_attribute_cmd.html">kBoss_GfxStateApplyROAttributeCmd</a>. For other attributes, use <a class="el" href="classk_gfx_apply_attr_override_cmd_boss.html">kGfxApplyAttrOverrideCmdBoss</a>.<p>By using utility methods from <a class="el" href="class_i_graphic_attribute_utils.html">IGraphicAttributeUtils</a>, however, you need to determine only the name of your attribute; the implementation of these methods selects the appropriate command for you.<h3><a class="anchor" id="id_how_do_i_write_a_new_transparency_effect"></a> How do I write a new transparency effect?</h3><p>InDesign provides API support for types like new and improved drop shadows and new feather-like features. See <a class="el" href="class_i_x_p_utils.html#a3e958b5ed4ea50ef8ded41a5de19e376">IXPUtils::CreateImagePaintServer</a>, which along with <a class="el" href="class_i_graphics_port.html#a62ae5baa1e119bdb11c90c44c57ab4bc">IGraphicsPort::SetAlphaServer</a> allows you to do various kinds of soft masks, including drop shadows. The <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> class can obtain a grayscale alpha representation of any page item. Using these two, you can create a drop shadow, outer glow, or feather effect.<p>Other effects, like inner glow on text, are very difficult to create because of the inability to dynamically clip the effect to text as it is edited.<p>It is important to let the transparency manager know about changes to an item&#39;s transparency state, so it can properly track which pages have transparency. This is done through IXPManager::ItemXPChanged, which finds the transparency in your adornment only if your adornment implements the <a class="el" href="class_i_flattener_usage.html">IFlattenerUsage</a> interface, and responds appropriately.<p>Also, it is important to understand how to use the <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> methods SetAlpha and SetAlphaServer, as well as starttransparencygroup and endtransparencygroup. These methods are critical for getting effects to draw correctly.<p>Two sample plug-ins are supplied in the SDK. The TransparencyEffect and TransparencyEffectUI SDK samples demonstrate how to create new transparency effects within InDesign documents.<h3><a class="anchor" id="id_how_do_i_change_the_stroke_weight_of_a_frame"></a> How do I change the stroke weight of a frame?</h3><p>If there is a selection, use the <a class="el" href="class_i_stroke_attribute_suite.html#a58bccbc72445cc851b37c2a6d5fefbc6">IStrokeAttributeSuite::ApplyStrokeWeight</a> method; otherwise, use <a class="el" href="class_i_graphic_attribute_utils.html#ae18fd0a0dfdcd5f27ef795fa1a85f156">IGraphicAttributeUtils::CreateStrokeWeightCommand</a> to create a command, then process the command.<h3><a class="anchor" id="id_how_do_i_change_the_stroke_color_of_a_frame"></a> How do I change the stroke color of a frame?</h3><p>If there is a selection, use the <a class="el" href="class_i_graphic_attribute_suite.html#a6e32e4cc0a8866dd06c16decef6eeb2c">IGraphicAttributeSuite::ChangeStrokeRenderObject</a> method; otherwise, use <a class="el" href="class_i_graphic_attribute_utils.html#aa9baf0aefa60fc57664de4f6eea5175d">IGraphicAttributeUtils::CreateStrokeRenderingCommand</a> to create a command, then process the command.<h3><a class="anchor" id="id_how_do_i_change_the_fill_color_of_a_frame"></a> How do I change the fill color of a frame?</h3><p>If there is a selection, use the <a class="el" href="class_i_graphic_attribute_suite.html#a418ff06696011b4c8c761dcfed645231">IGraphicAttributeSuite::ChangeFillRenderObject</a> method; otherwise, use <a class="el" href="class_i_graphic_attribute_utils.html#a5117428f48c2e824e521ce0f5405c39b">IGraphicAttributeUtils::CreateFillRenderingCommand</a> to create a command, then process the command.<p>See <a class="el" href="id_solutions.html#id_applying_fill_color_or_a_gradient_to_a_page_item">Applying fill color or a gradient to a page item</a>.<h3><a class="anchor" id="id_how_do_i_change_the_default_stroke_weight"></a> How do I change the default stroke weight?</h3><p>If nothing is selected, call the <a class="el" href="class_i_stroke_attribute_suite.html#a58bccbc72445cc851b37c2a6d5fefbc6">IStrokeAttributeSuite::ApplyStrokeWeight</a> method; otherwise, follow this example: <div class="fragment"><div class="line"><span class="comment">// Create stroke weight attribute</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGraphicAttrRealNumber&gt;</a> newStrokeWeight (<a class="code" href="class_utils.html">Utils&lt;IGraphicAttributeUtils&gt;</a>()-&gt;CreateStrokeWeightAttribute(newWeight));</div><div class="line"><span class="comment">// Create command</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a>command (<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_gfx_state_change_attribute_cmd_boss.html">kGfxStateChangeAttributeCmdBoss</a>));</div><div class="line"><span class="comment">// Set command data. Assuming iDataBase is the default data base</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGraphicStateCmdData&gt;</a> gsCmdData(command, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPMUnknown&gt;</a> iGfxStateData (<a class="code" href="class_utils.html">Utils &lt;IGraphicStateUtils&gt;</a> ()-&gt;QueryGraphicState (iDataBase));</div><div class="line">gsCmdData-&gt;SetGraphicStateUIDRef(iDataBase, iGfxStateData);</div><div class="line">gsCmdData-&gt;SetTarget(<a class="code" href="class_i_graphic_state_data.html">IGraphicStateData</a>:kDefaultTarget, kTrue);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPMUnknownData&gt;</a> attrInterface(command, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">attrInterface-&gt;SetPMUnknown(newStrokeWeight);</div><div class="line"><span class="comment">// Process commanderror = CmdUtils::ProcessCommand(command);</span></div></div><p>See <a class="el" href="id_solutions.html#id_changing_graphic_attributes_of_the_graphics_state">Changing graphic attributes of the graphics state</a>.<h3><a class="anchor" id="id_why_do_some_methods_of_igraphicsattributesuite_take_three_parameters_int32_whichattribute_classid_interfaceid"></a> Why do some methods of IGraphicsAttributeSuite take three parameters (int32 whichAttribute, ClassID, interfaceID)?</h3><p>IGraphicsAttributeSuite is a selection-based suite. There is an implementation for selection and another for defaults (when there is no selection). Attributes have unique values when referring to defaults. All attribute classes may have multiple values when there are multiple selections.<p>For example, suppose the current selection contains a red-filled rectangle, a blue-filled oval, and a yellow-filled rectangle, and all three items have black stroke. If you query the active graphic attribute suite for the fill rendering attribute, it returns an attribute count of 3, because there are three different fills. It returns an attribute count of 1 for the stroke rendering attribute. In the fill case, if you want to know what the three fills are, you can use QueryAttribute and iterate on whichAttribute from index = 0 to index &lt; 3. The attribute count tells you whether you have unique fill values.<h3><a class="anchor" id="id_what_is_targettype_of_graphicstate"></a> What is TargetType of GraphicState?</h3><p>IGraphicStateData::TargetType enumerates three values:<ul><li>kCurrentTarget - Current means the current target and could be the same target as Default or Eyedropper.<li>kDefaultTarget - Default refers to a state when nothing is selected or there is no document.<li>kEyedropperTarget - Eyedropper is a special target for when the eyedropper tool is activated; this is where we temporarily store graphic attributes when using the eyedropper tool.</ul><h3><a class="anchor" id="id_how_do_i_get_igraphicsport_from_graphicsdata"></a> How do I get IGraphicsPort from GraphicsData</h3><p>The <a class="el" href="class_graphics_data.html">GraphicsData</a> class provides the GetGraphicsPort method to directly access the graphics port in preparation for drawing. The following example shows a sample code snippet: <div class="fragment"><div class="line"><span class="keywordtype">void</span> MyShape::DrawShape(<a class="code" href="class_graphics_data.html">GraphicsData</a>* gd, int32 flags){</div><div class="line"><span class="comment">// default DrawShape draws a frame with an X through it.</span></div><div class="line"><a class="code" href="class_i_graphics_port.html">IGraphicsPort</a>* gPort = gd-&gt;<a class="code" href="class_graphics_data.html#ae4a7ceb753817705ac22822752979a39">GetGraphicsPort</a>();</div><div class="line"><span class="comment">// Draw to port...</span></div><div class="line">}</div></div><h3><a class="anchor" id="id_how_do_i_detect_a_drawing_device_using_drawing_flags"></a> How do I detect a drawing device using drawing flags?</h3><p>The <a class="el" href="class_i_shape.html">IShape</a> class defines an enumeration of bit masks for the drawing flag argument supplied to IShape::Draw from the InDesign Draw Manager. The <a class="el" href="class_i_shape.html#aa9e07a92fd22dc760e7f04a582c16683a9cbfa5483e347957a83af509d036e39a">IShape::kPrinting</a> mask indicates printing or PDF is taking place, as shown in the following example: <div class="fragment"><div class="line"><span class="keywordtype">void</span> MyShape::DrawShape(<a class="code" href="class_graphics_data.html">GraphicsData</a>* gd, int32 flags){</div><div class="line"><span class="keywordflow">if</span> (flags &amp; <a class="code" href="class_i_shape.html#aa9e07a92fd22dc760e7f04a582c16683a9cbfa5483e347957a83af509d036e39a">IShape::kPrinting</a>)</div><div class="line"> {</div><div class="line"><span class="comment">// Device is PDF or print device...</span></div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_how_do_i_detect_a_drawing_device_using_the_viewport_boss"></a> How do I detect a drawing device using the viewport boss?</h3><p>The <a class="el" href="class_graphics_data.html">GraphicsData</a> class provides finer detail about the drawing device. As shown in the following example, the <a class="el" href="class_graphics_data.html">GraphicsData</a> class provides an accessor to the viewport attribute interface, which resides on the viewport boss associated with the current drawing operation. From the viewport attribute interface, the code queries for the IPDFDocPort interface. Its presence means the viewport boss is a <a class="el" href="classk_p_d_f_view_port_boss.html">kPDFViewPortBoss</a>, indicating PDF output. If the port is not for PDF output, the next step is to test for a printing port. This is done using a method on the viewport attribute interface of the window port boss. The GetViewPortIsPrintingPort method reflects the value of the <a class="el" href="class_i_shape.html">IShape</a> drawing flag value for printing. If the port is a printing port, the IPrintObject interface verifies it is a PostScript printing port; otherwise, the window port corresponds to a screen draw. <div class="fragment"><div class="line"><span class="comment">// From a GraphicsData* gd, get an interface on the window port boss</span></div><div class="line"><a class="code" href="class_i_view_port_attributes.html">IViewPortAttributes</a>* iViewPortAtt = gd-&gt;<a class="code" href="class_graphics_data.html#a574224b8dd845467c34fbd8f98dcb3dc">GetViewPortAttributes</a>();</div><div class="line"><span class="comment">// Is this a PDF?InterfacePtr&lt;IPDFDocPort&gt; pdfDocPort(iViewPortAtt, IID_IPDFDOCPORT);</span></div><div class="line"><span class="keywordflow">if</span> (pdfDocPort != nil){ </div><div class="line"><span class="comment">// PDF export...</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span></div><div class="line">{</div><div class="line"><span class="comment">// Is it a printing port?</span></div><div class="line"><span class="keywordflow">if</span> (iViewPortAtt-&gt;<a class="code" href="class_i_view_port_attributes.html#a5b8308f4a8a9c0c78260ab4c985b39e6">GetViewPortIsPrintingPort</a>())</div><div class="line"> {</div><div class="line"><span class="comment">// OK, it&#39;s a printing port. But what kind? Ask the print object.</span></div><div class="line"><span class="comment">// See PrintID.h, GraphicsExternal.h</span></div><div class="line"><a class="code" href="class_i_graphics_port.html">IGraphicsPort</a>* gPort = gd-&gt;<a class="code" href="class_graphics_data.html#ae4a7ceb753817705ac22822752979a39">GetGraphicsPort</a>();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPrintPort&gt;</a> iPrintPort (gPort, IID_IPRINTPORT);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPrintObject&gt;</a> iPrtObj(iPrintPort-&gt;GetPrintObject(), IID_IPRINTOBJECT);</div><div class="line"> AGMDeviceType devType = kAGMPPostScript;</div><div class="line"> iPrtObj-&gt;GetObject(kAGMPrtObjectItmsDeviceType, nil, &amp;devType);</div><div class="line"><span class="keywordflow">if</span> (devType == kAGMPPostScript)</div><div class="line"> {</div><div class="line"><span class="comment">// PS output</span></div><div class="line"> }</div><div class="line"> }</div><div class="line"><span class="keywordflow">else</span></div><div class="line"> {</div><div class="line"><span class="comment">// Screen drawing...</span></div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_how_do_i_invalidate_a_layout_view"></a> How do I invalidate a layout view?</h3><p>Invalidation can be caused by changes to the model (persistent data in a document) or direct invalidation. Both use the same mechanism for invalidating a view.<p>Views can be invalidated directly by using the <a class="el" href="class_i_layout_utils.html#a2e7ad8a3c9ca295a12594e0da4ae084b">ILayoutUtils::InvalidateViews</a> method. The following code segment invalidates all views of the front document: <div class="fragment"><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* fntDoc = <a class="code" href="class_utils.html">Utils&lt;ILayoutUtils&gt;</a>()-&gt;GetFrontDocument(); </div><div class="line"><span class="keywordflow">if</span> (fntDoc != nil)</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;ILayoutUtils&gt;</a>()-&gt;InvalidateViews( fntDoc );</div></div><h3><a class="anchor" id="id_how_do_i_obtain_a_viewport"></a> How do I obtain a viewport?</h3><p>You can get a viewport directly from a window or a control view through the ViewPortAccess template and <a class="el" href="class_acquire_view_port.html">AcquireViewPort</a> class, as shown in the following example: <div class="fragment"><div class="line">ViewPortAccess&lt;IWindowPort&gt; windowPort(WindowOrView, IID_IWINDOWPORT); <a class="code" href="class_acquire_view_port.html">AcquireViewPort</a> aqViewPort(windowPort);</div></div><p>Constructing an <a class="el" href="class_acquire_view_port.html">AcquireViewPort</a> object lets you acquire the focus for the viewport, so you can do various drawing.<p>You also can access a viewport by doing either of the following:<ul><li>Given a graphics context, use <a class="el" href="class_i_graphics_context.html#ac03f3bb91efa645278c3e8b12b77447b">IGraphicsContext::GetViewPort</a>.<li>Given a GraphicsData*, use <a class="el" href="class_graphics_data.html#ae4a7ceb753817705ac22822752979a39">GraphicsData::GetGraphicsPort</a>.</ul><h3><a class="anchor" id="id_how_do_i_get_instantiate_graphics_context_in_a_control_view"></a> How do I get (instantiate) graphics context in a control view?</h3><p>An <a class="el" href="class_i_graphics_context.html">IGraphicsContext</a> can be formed using the following: <div class="fragment"><div class="line"><a class="code" href="class_a_g_m_graphics_context_with.html">AGMGraphicsContext</a> gc(viewPort, <span class="keyword">this</span>, invalidRgn);</div></div><p>viewPort and invalidRgn are the two parameters passed into the <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> method. The &quot;this&quot; parameter is the &quot;this&quot; pointer to the control view object.<h3><a class="anchor" id="id_how_do_i_sort_page_items_by_z-order"></a> How do I sort page items by z-order</h3><p>Use ArrangeUtils. The following code segment illustrates the usage: <div class="fragment"><div class="line"><a class="code" href="class_u_i_d_list.html">UIDList</a> unsortedItems;</div><div class="line"><a class="code" href="class_arranger.html">Arranger</a> arranger( &amp;unsortedItems, Arranger::kNotSorted ) ;</div><div class="line">arranger.SortItemsBackToFront( &amp;unsortedItems );</div></div><h3><a class="anchor" id="id_how_do_i_add_or_remove_adornments"></a> How do I add or remove adornments?</h3><p>Adornment is part of the drawing for decorated page items. Any page item that can have an attached adornment has the IPageitemAdornmentList interface, which provides the methods for adding and removing adornments. These methods are encapsulated in the commands listed in the following table:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a> Boss </th><th>Description </th></tr><tr><td>kAddPageitemAdornmentCmdBoss </td><td>Add page item adornment. </td></tr><tr><td>kRemovePageitemAdornmentCmdBoss </td><td>Remove adornments. </td></tr><tr><td>kAddPageitemHandleAdornmentCmdBoss </td><td>Add page item handle adornments. </td></tr><tr><td>kRemovePageitemHandleAdornmentCmdBoss </td><td>Remove page item handle adornments. </td></tr></table><h3><a class="anchor" id="id_how_do_i_import_indesign_documents"></a> How do I import InDesign documents?</h3><p>You import InDesign documents the same way as other graphics files. To place an InDesign file into a document, follow the steps in <a class="el" href="id_solutions.html#id_placing_a_graphics_file_into_a_spread">Placing a graphics file into a spread</a> and <a class="el" href="id_solutions.html#id_placing_a_graphics_file_into_an_existing_graphics_frame">Placing a graphics file into an existing graphics frame</a>.<h1><a class="anchor" id="id_selection"></a> Selection</h1><h2><a class="anchor" id="id_getting_started"></a> Getting started</h2><p>To learn how selection works, read the &quot;Selection Fundamentals&quot; chapter in Adobe InDesign Products Programming Guide. For help with your specific programming needs, look in this chapter for a use case that matches your needs.<h3><a class="anchor" id="id_exploring_selection_with_sdk_sample_code"></a> Exploring selection with SDK sample code</h3><p>The SDK provides several examples that help you learn how to work with selection. See the following tables.<p>Samples that use selection suites provided by the API<table class="doxtable"><tr><th>SDK Sample </th><th>Description </th></tr><tr><td>StrokeWeightMutator </td><td>Displays and changes stroke weight using a suite provided by the API (<a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a>). Observes the selection and widgets in a single-observer implementation. </td></tr><tr><td>TableAttributes </td><td>Displays and changes table attributes using a suite provided by the API (<a class="el" href="class_i_table_suite.html">ITableSuite</a>). Observes the selection and widgets with multiple distinct observer implementations. </td></tr></table><p>Samples that create new selection suites<table class="doxtable"><tr><th>SDK Sample </th><th>Description </th></tr><tr><td>TableBasics </td><td>Implements a basic suite. </td></tr><tr><td>BasicPersistInterface </td><td>Extends the layout model by adding a custom data interface to a page item that stores an attribute. This implements an advanced suite to access and change this attribute, and it uses a selection extension to notify an <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a> when this selection attribute changes. </td></tr><tr><td>BasicMenu </td><td>Enables an action or menu based on the state of the selection. Refer to this sample and to Adobe InDesign Porting Guide for information on porting Adobe InDesign &reg; 2.x code that used IID_NEED_LAYOUTSELECTION or similar. </td></tr><tr><td>TransparencyEffectUI </td><td>Uses a suite from a dialog that can be previewed. </td></tr><tr><td>TransparencyEffect </td><td>Implements a suite for use by a dialog that can be previewed. </td></tr></table><p><b>Related APIs</b><ul><li><a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a> - The API reference documentation page for this boss has a complete list of selection suites provided by the API.<li>To use the selection suites provided by the API - <a class="el" href="class_i_selection_manager.html">ISelectionManager</a>, <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a>, <a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a>, <a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>, <a class="el" href="class_i_table_selection_suite.html">ITableSelectionSuite</a>, and <a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a>.<li>To have your code be notified when the selection changes - <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a> and <a class="el" href="class_i_selection_message.html">ISelectionMessage</a>.<li>To create a new selection suite - <a class="el" href="class_i_layout_target.html">ILayoutTarget</a>, <a class="el" href="class_i_text_target.html">ITextTarget</a>, <a class="el" href="class_i_table_target.html">ITableTarget</a>, <a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a>, <a class="el" href="class_i_integrator_target.html">IIntegratorTarget</a>, <a class="el" href="class_i_selection_extension.html">ISelectionExtension</a>, and <a class="el" href="class_i_selection_message.html">ISelectionMessage</a>.</ul><h2><a class="anchor" id="id_working_with_selection_suites_provided_by_the_api"></a> Working with selection suites provided by the API</h2><h3><a class="anchor" id="id_finding_selection_suites_provided_by_the_api"></a> Finding selection suites provided by the API</h3><p><b>Description</b><p>You want to access or change a property of an object selected by the user, and you want to know whether the API provides a selection suite you can use.<p><b>Solution</b><p>See the API reference documentation page for <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>, which lists all suites available for use by client code; for example, <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a> and <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> Look first at the suite interface names; an interface name can help you decide whether the suite is likely to help you. Next, look at the methods on the interface, to see whether they do what you want to do. For information on how to acquire and then call a suite interface, see <a class="el" href="id_solutions.html#id_calling_a_selection_suite">Calling a selection suite</a>.<h3><a class="anchor" id="id_accessing_or_changing_the_properties_of_a_selected_object"></a> Accessing or changing the properties of a selected object</h3><p><b>Description</b><p>You want to access or change a property of an object selected by the user.<p><b>Solution</b><ul><li>Use a suite interface obtained from the selection manager. See <a class="el" href="id_solutions.html#id_calling_a_selection_suite">Calling a selection suite</a>.<li>Client code can use a suite interface provided by the API, if one is available that meets your needs. See <a class="el" href="id_solutions.html#id_finding_selection_suites_provided_by_the_api">Finding selection suites provided by the API</a>.<li>If the API does not provide a suite interface that meets your needs, your client code must use a custom suite implementation you write yourself. For an example, see the BasicPersistInterface sample. See <a class="el" href="id_solutions.html#id_creating_selection_suites">Creating selection suites</a>.</ul><h3><a class="anchor" id="id_calling_a_selection_suite"></a> Calling a selection suite</h3><p><b>Description</b><p>You want to call a selection suite interface (for example, <a class="el" href="class_i_table_suite.html">ITableSuite</a>). How do you get its interface pointer?<p><b>Solution</b><p>To get a selection suite interface pointer, you must query a selection manager (see the <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> interface) for the suite in which you are interested. If the suite is available, its interface pointer is returned; otherwise, nil is returned.<p>Choosing the selection manager interface to query for the suite depends on the kind of code you are writing (see <a class="el" href="id_solutions.html#id_obtaining_the_selection_manager">Obtaining the selection manager</a>). To work with the active selection, use <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a> to get its selection manager. The following code queries the active selection manager to get <a class="el" href="class_i_table_suite.html">ITableSuite</a>. If the suite is obtained, it is asked whether the capability GetCellWidth is available. If the capability is available, it is used. <div class="fragment"><div class="line"><a class="code" href="class_i_selection_manager.html">ISelectionManager</a>* iSelectionManager = <a class="code" href="class_utils.html">Utils&lt;ISelectionUtils&gt;</a>()-&gt;GetActiveSelection();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableSuite&gt;</a> iTableSuite(iSelectionManager, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (iTableSuite &amp;&amp; iTableSuite-&gt;CanGetCellWidth()) {</div><div class="line"><a class="code" href="class_p_m_real.html">PMReal</a> cellWidth = iTableSuite-&gt;GetCellWidth();</div><div class="line"><span class="comment">// ...</span></div><div class="line">}</div></div><p>The <a class="el" href="class_i_selection_utils.html#a0d2ffc4630cad0cd6963df45c3cc7c3e">ISelectionUtils::QuerySuite</a> utility provides a handy shortcut for obtaining a suite from the active selection. The following code queries the active selection manager for the suite, because nil is passed as the second parameter. <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableSuite&gt;</a> tableSuite( static_cast&lt;ITableSuite*&gt; <a class="code" href="class_utils.html">Utils&lt;ISelectionUtils&gt;</a>()-&gt;QuerySuite(ITableSuite::kDefaultIID,nil)));</div></div><p>Before using the active selection to obtain a suite as shown above, be sure this is the correct selection manager to use. Sometimes, the selection manager you should use is passed as a parameter (often as an <a class="el" href="class_i_active_context.html">IActiveContext</a> parameter) or made available as a member of a C++ API base class. See <a class="el" href="id_solutions.html#id_obtaining_the_selection_manager">Obtaining the selection manager</a> for details.<p><b>Sample code</b><ul><li><a class="el" href="class_tbl_att_query_mut_helper.html">TblAttQueryMutHelper</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_selection_utils.html">ISelectionUtils</a><li><a class="el" href="class_i_selection_manager.html">ISelectionManager</a></ul><h3><a class="anchor" id="id_obtaining_the_selection_manager"></a> Obtaining the selection manager</h3><p><b>Description</b><p>You want to acquire a selection manager interface (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>); this is likely so you can obtain a suite interface from it (see <a class="el" href="id_solutions.html#id_calling_a_selection_suite">Calling a selection suite</a>).<p><b>Solution</b><p>The selection manager (see the <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> interface) is the interface that identifies a boss class to be an abstract selection boss (ASB). Each document view has its own selection manager. The active selection is the selection manager for the document view with which the user is editing (that is, the front document view).<p>To work with the active selection, use the utility <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a> to get its selection manager. Most of the time, however, either client code is passed a parameter that identifies the selection manager to use or the selection manager is implied by the kind of code being written.<p>Follow these steps:<ul><li>To implement client code that works with whatever is actively selected, use <a class="el" href="class_i_selection_utils.html#af710ece9449e7c801bdc89e684e970aa">ISelectionUtils::GetActiveSelection</a> to get the selection manager: <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;ISelectionUtils&gt;</a> iSelectionUtils;</div><div class="line"><span class="keywordflow">if</span> (iSelectionUtils != nil) {</div><div class="line"><a class="code" href="class_i_selection_manager.html">ISelectionManager</a>* iSelectionManager = iSelectionUtils-&gt;<a class="code" href="class_i_selection_utils.html#af710ece9449e7c801bdc89e684e970aa">GetActiveSelection</a>();</div><div class="line">}</div></div><li>When you implement an action component (<a class="el" href="class_i_action_component.html">IActionComponent</a>) or a dialog controller (<a class="el" href="class_i_dialog_controller.html">IDialogController</a>), use the <a class="el" href="class_i_active_context.html">IActiveContext</a> parameter you are passed to get the selection manager (IActiveContext::GetContextSelection): <div class="fragment"><div class="line"><span class="keywordtype">void</span> FooActionComponent::DoAction(<a class="code" href="class_i_active_context.html">IActiveContext</a>* ac, <a class="code" href="class_i_d_type.html">ActionID</a> actionID, ...)</div><div class="line">{</div><div class="line"> ...</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFooSuite&gt;</a> fooSuite(ac-&gt;GetContextSelection(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (fooSuite) {</div><div class="line"><span class="comment">// Use the suite.</span></div><div class="line"> }</div><div class="line"> ...</div><div class="line">}</div></div><li>When you implement a selection observer (<a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a>), the fCurrentSelection data member gives the selection manager: <div class="fragment"><div class="line"><span class="keywordtype">void</span> FooSelectionObserver::HandleSelectionChanged(<span class="keyword">const</span> <a class="code" href="class_i_selection_message.html">ISelectionMessage</a>* msg)</div><div class="line">{</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFooSuite&gt;</a> fooSuite(fCurrentSelection, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (fooSuite) {</div><div class="line"><span class="comment">// Use the suite.</span></div><div class="line"> }</div><div class="line">}</div></div><li>When you implement a tracker (<a class="el" href="class_i_tracker.html">ITracker</a>), use <a class="el" href="class_i_selection_utils.html#a1ee7b9b1f384fd8853d28423237f9be2">ISelectionUtils::QueryViewSelectionManager</a> to acquire the selection manager.<li>When you implement a widget that is part of a layout document window, such as a descendant in the layout widget hierarchy, you probably are interested only in the selection manager of its ancestor (the layout widget). In this case, call <a class="el" href="class_i_selection_utils.html#a1ee7b9b1f384fd8853d28423237f9be2">ISelectionUtils::QueryViewSelectionManager</a> to acquire the selection manager.</ul><p><b>Sample code</b><ul><li>For sample code that uses suites provided by the API - StrokeWeightMutator and TableAttributes<li>For samples that create and use their own selection suites - BasicMenu and BasicPersistInterface</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_selection_manager.html">ISelectionManager</a><li><a class="el" href="class_i_selection_utils.html">ISelectionUtils</a></ul><h3><a class="anchor" id="id_making_a_selection_programmatically"></a> Making a selection programmatically</h3><p>The interfaces in the following table can be used to vary the selection programmatically.<table class="doxtable"><tr><th>API </th><th>Purpose </th></tr><tr><td><a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a></td><td>Select page items. </td></tr><tr><td><a class="el" href="class_i_selection_manager.html">ISelectionManager</a></td><td>Select/deselect all. </td></tr><tr><td><a class="el" href="class_i_table_selection_suite.html">ITableSelectionSuite</a></td><td>Select table cells. </td></tr><tr><td><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a></td><td>Select text in layout view,gGalley view, story editor view, and note view. </td></tr><tr><td><a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a></td><td>Select XML structure. </td></tr></table><p><b>Sample code</b><ul><li>For use of <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> - <a class="el" href="class_snp_manipulate_x_m_l_selection.html">SnpManipulateXMLSelection</a><li>For usage of <a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a> - <a class="el" href="class_snp_manipulate_text_frame.html">SnpManipulateTextFrame</a><li>For usage of <a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a> - <a class="el" href="class_snp_manipulate_text_model.html">SnpManipulateTextModel</a></ul><h3><a class="anchor" id="id_updating_the_user_interface_when_the_selection_changes"></a> Updating the user interface when the selection changes</h3><p><b>Description</b><p>You want to update your user interface or another piece of selection client code when the selection changes.<p><b>Solution</b><p>Implement a selection observer (see <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a>) and update your user interface when you receive messages from a suite. For sample code, see StrokeWeightMutator and TableAttributes.<dl class="section note"><dt>Note<dd>Selection observers may get called for changes that are not of interest. It is important you examine the content of any ISelectionMessage* parameter passed and update your user interface only if necessary. For an example of how to do this, see the sample code in <a class="el" href="class_str_mut_selection_observer.html#aac5c216f5c4b3054dd903e32ba6bf2e7">StrMutSelectionObserver::HandleSelectionAttributeChanged</a>.</dl><p>If you cannot find an existing suite that sends the messages you need, implement a custom suite with a selection extension.<p>Most likely, you must make a design decision about how to observe changes to your widgets and to the selection. For example, suppose you have a widget that displays the stroke weight associated with the selection and allows that stroke weight to be changed. To synchronize the stroke weights displayed in the widget with the values associated with the selection, use a selection observer. To recognize a request by the user to change the stroke weight, use a widget observer. The main design decisions are as follows:<ul><li>Should you use one observer that observes both widgets and the selection or two distinct observers, a selection observer and a widget observer?<li>Which selection manager should you use to get the suite that lets you get and change the attribute of interest?</ul><p><b>Using one observer to update the user interface when the selection changes</b><p>The StrokeWeightMutator sample plug-in is based on a design that uses a single observer on the widget boss class to observe both the widget&#39;s subject and the selection. The observer sub-classes <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a> and, therefore, observes the active selection. To observe changes to your widget, follow these steps:<ol type="1"><li>To attach and detach the appropriate protocols on the widget&#39;s subject, override <a class="el" href="class_active_selection_observer.html#aff02ef41bdb537e891f178d364b4811f">ActiveSelectionObserver::AutoAttach</a> and <a class="el" href="class_active_selection_observer.html#aa1e990e11f843f5135d69b429c690b48">ActiveSelectionObserver::AutoDetach</a>.<li>To handle messages from your widget, override <a class="el" href="class_active_selection_observer.html#a98d22d80c50908ae4b303b447960c9b8">ActiveSelectionObserver::HandleSelectionUpdate</a>.<li>Call the superclass <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a> methods from your specializations. The observer uses the selection manager referred to by ActiveSelectionObserver::fCurrentSelection to obtain any suite it needs.</ol><p><b>Using two observers to update the user interface when the selection changes</b><p>The TableAttributes sample plug-in is based on a design that uses two observers on the widget boss class.<p>The first observer is a selection observer that subclasses <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a>. It updates the value displayed by the widget when it receives messages from a suite. It uses the selection manager referred to by ActiveSelectionObserver::fCurrentSelection to obtain any suite it needs.<p>The second observer observes the widget&#39;s subject and calls a suite to change the value of an attribute of the selection when the user changes the value of the widget. This is a good approach, and much of the application&#39;s user interface code uses it. A disadvantage to this approach is the lack of communication between the two observers. For example, how does the widget observer find the selection manager to use when it needs a suite? Most widgets use the application&#39;s active selection manager, because they are on panels and intended to reflect or change the active context. In this scenario, the widget&#39;s widget observer uses the selection manager found with <a class="el" href="class_i_selection_utils.html#af710ece9449e7c801bdc89e684e970aa">ISelectionUtils::GetActiveSelection</a> to obtain any suite it needs.<p><b>Sample code</b><ul><li>StrokeWeightMutator, TableAttributes, and BasicPersistInterface</ul><h3><a class="anchor" id="id_obtaining_itextselectionsuite"></a> Obtaining ITextSelectionSuite</h3><p>Select text using interface <a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>; however, if you query for this interface using its default PMIID, you will not obtain it for note, galley, and story editor view selections. This interface does not use the default PMIID on these CSBs; instead, it uses IID_ITEMPTEXTSELECTION_SUITE. To obtain the suite, use code similar to the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextSelectionSuite&gt;</a> textSelectionSuite(selectionManager, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span>(!textSelectionSuite) {</div><div class="line"><span class="comment">// Temporary until text selection suites are unified.</span></div><div class="line"> textSelectionSuite.reset(<a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextSelectionSuite&gt;</a>(selectionManager, IID_ITEMPTEXTSELECTION_SUITE).forget());</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (textSelectionSuite) {</div><div class="line"> textSelectionSuite-&gt;ChangeTextSelection(ITextSelectionSuite::kExtendSelection, ITextSelectionSuite::kWord, ITextSelectionSuite::kNext, Selection::kScrollIntoView);</div><div class="line">}</div></div><p><b>Related APIs</b><ul><li><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a><li><a class="el" href="class_i_selection_manager.html">ISelectionManager</a></ul><h2><a class="anchor" id="id_creating_selection_suites"></a> Creating selection suites</h2><h3><a class="anchor" id="id_determining_whether_you_need_a_custom_suite"></a> Determining whether you need a custom suite</h3><p>Before implementing a custom suite, look for a suite provided by the API to help you. In some cases, none of the suites provided by the API meets your exact needs. For example, suppose you want to detect whether one or more characters of text are selected, enable an action when text is chosen, and modify the selected text in some way when the action is chosen. Several interfaces (like <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>) are available and provide methods to modify the selected text, but not in the specific way in which you want your action to modify the selected text. As a result, you must implement a custom suite.<h3><a class="anchor" id="id_defining_the_interface_of_a_suite"></a> Defining the interface of a suite</h3><p>Two kinds of method are required for a suite interface. The first kind of method returns kTrue if an action can be done; the second kind of method does the action: <div class="fragment"><div class="line"><span class="keyword">class </span>IYourSuite : <span class="keyword">public</span> <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>{</div><div class="line"><span class="keyword">public</span>:</div><div class="line"><span class="keyword">enum</span> { kDefaultIID = IID_IYOURSUITE };</div><div class="line"><span class="keyword">virtual</span> bool16 CanDoSomething(<span class="keywordtype">void</span>) <span class="keyword">const</span> = 0;</div><div class="line"><span class="keyword">virtual</span> ErrorCode DoSomething(<span class="keywordtype">void</span>) = 0;</div><div class="line">};</div></div><p>In your plug-in&#39;s ID.h file, declare a PMIID for the suite interface: <div class="fragment"><div class="line">DECLARE_PMID(kInterfaceIDSpace, IID_IYOURSUITE, kYourPrefix + 10)</div></div><p><b>Sample code</b><ul><li><a class="el" href="class_tbl_att_query_mut_helper.html">TblAttQueryMutHelper</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_table_suite.html">ITableSuite</a><li><a class="el" href="class_i_selection_utils.html">ISelectionUtils</a></ul><h3><a class="anchor" id="id_implementing_an_integrator_suite"></a> Implementing an integrator suite</h3><p>Integrator suites have a very standard construction and usually are based on the templates provided in the API (see SelectionASBTemplates.tpp). The template is used to forward the call to the CSB suite and return its result to the caller, as follows: <div class="fragment"><div class="line">bool16 YourSuiteASB::CanDoSomething(<span class="keywordtype">void</span>)<span class="keyword"> const</span>{</div><div class="line"><span class="keywordflow">return</span>(AnyCSBSupports(make_functor(&amp;IYourSuite::CanDoSomething), <span class="keyword">this</span>));</div><div class="line">}</div><div class="line">ErrorCode YourSuiteASB::DoSomething(<span class="keywordtype">void</span>){</div><div class="line"><span class="keywordflow">return</span>(Process(make_functor(&amp;IYourSuite::DoSomething), <span class="keyword">this</span>));</div><div class="line">}</div></div><p>To prevent dead-stripping, declare an ID for the implementation and register it: <div class="fragment"><div class="line"><span class="comment">// put into the plug-in&#39;s ID.h file</span></div><div class="line">DECLARE_PMID(kImplementationIDSpace, kYourSuiteASBImpl, kYourPrefix + 10)</div><div class="line"><span class="comment">// put into the plug-ins FactoryList.h file</span></div><div class="line">REGISTER_PMINTERFACE(YourSuiteASB, kYourSuiteASBImpl)</div></div><p><b>Sample code</b><ul><li><a class="el" href="class_bsc_mnu_suite_a_s_b.html">BscMnuSuiteASB</a></ul><p><b>Related API</b><ul><li>SelectionASBTemplates.tpp</ul><h3><a class="anchor" id="id_implementing_a_csb_suite"></a> Implementing a CSB suite</h3><p>The CSB suite implementation is made available to text selections using an AddIn on the text suite boss (<a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>): <div class="fragment"><div class="line">AddIn{</div><div class="line"><a class="code" href="classk_text_suite_boss.html">kTextSuiteBoss</a>, kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IYOURSUITE, kYourSuiteTextCSBImpl,</div><div class="line"> }</div><div class="line">},</div></div><dl class="section note"><dt>Note<dd>If you use only one AddIn, the suite is available to text selections in layout view, but not in story editor, galley, or note view. For your suite to be available for text selections in these other views, add your suite implementation into more suite boss classes. Often you can reuse the same implementation to do so.</dl><p>Examine the text target (<a class="el" href="class_i_text_target.html">ITextTarget</a>) to see if one or more characters are selected. If so, do something with the text selection: <div class="fragment"><div class="line">bool16 YourSuiteTextCSB::CanDoSomething(<span class="keywordtype">void</span>)<span class="keyword"> const</span>{</div><div class="line"> bool16 result = kFalse;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextTarget&gt;</a> textTarget(<span class="keyword">this</span>, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span>(textTarget) {</div><div class="line"><a class="code" href="class_range_data.html">RangeData</a> range = textTarget-&gt;GetRange();</div><div class="line"><span class="keywordflow">if</span> (range.Length() &gt; 0)</div><div class="line"> result = kTrue;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> (result);</div><div class="line">} </div><div class="line">ErrorCode YourSuiteTextCSB::DoSomething(<span class="keywordtype">void</span>){</div><div class="line"> bool16 result = kFailure;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextTarget&gt;</a> textTarget(<span class="keyword">this</span>, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span>(textTarget) {</div><div class="line"><span class="comment">// Perform your unique action on this selection</span></div><div class="line"> ...</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> (result);</div><div class="line">}</div></div><p>To prevent dead-stripping, declare IDs for the implementations and register them: <div class="fragment"><div class="line"><span class="comment">// into the plug-in&#39;s ID.h file</span></div><div class="line">DECLARE_PMID(kImplementationIDSpace, kYourSuiteTextCSBImpl, kYourPrefix + 11)</div><div class="line"><span class="comment">// into the plug-ins FactoryList.h file</span></div><div class="line">REGISTER_PMINTERFACE(YourSuiteTextCSB, kYourSuiteTextCSBImpl)</div></div><p>The implementation of a CSB suite deals with the selection format of that CSB. The only selection information the suite should need is from other interfaces on the CSB, primarily the target interface that identifies the selection target.<p>CSB suite implementation class names should align with the CSB they support; for example, XxxxSuiteLayoutCSB.cpp or XxxxSuiteTextCSB.cpp.<p>Your implementation can depend on the availability of interfaces on the suite boss class. For example, a text CSB suite can rely on any interface on <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>. To access an interface on the CSB itself (for example, <a class="el" href="classk_text_selection_boss.html">kTextSelectionBoss</a>), check whether the returned interface pointer is nil, and gracefully handle the case when it is not available. Also do this to access one of the caches, such as <a class="el" href="class_i_cell_focus.html">ICellFocus</a> on <a class="el" href="classk_text_selection_boss.html">kTextSelectionBoss</a>. This is required because scripting may reuse the suite boss classes, so some CSB interfaces may not be available all the time. For example, <a class="el" href="classk_text_scripting_suite_boss.html">kTextScriptingSuiteBoss</a> derives from <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a> and could use your suite.<p><b>Sample code</b><ul><li><a class="el" href="class_bsc_mnu_suite_layout_c_s_b.html">BscMnuSuiteLayoutCSB</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_layout_target.html">ILayoutTarget</a></ul><h3><a class="anchor" id="id_writing_the_client_code"></a> Writing the client code</h3><p>This example implements an action component (<a class="el" href="class_i_action_component.html">IActionComponent</a>) that uses the suite to enable an action.<p>Add the following ActionDef to your plug-in&#39;s .fr file: <div class="fragment"><div class="line">kYourActionComponentBoss,kYourDoSomethingActionID,kYourDoSomethingMenuItemKey,kOtherActionArea,kNormalAction,kDisableIfSelectionDoesNotSupportIID &acirc;&#148;&#130; kCustomEnabling,IID_IYOURSUITE,kSDKDefInvisibleInKBSCEditorFlag,</div></div><p>The kDisableIfSelectionDoesNotSupportIID flag indicates the action is disabled if the suite is not available. Your action component is not called unless the selection supports your suite. If the suite is available, the kCustomEnabling flag indicates your action component is to be called. A call to the suite finds out whether the action should be enabled: <div class="fragment"><div class="line"><span class="keywordtype">void</span> YourActionComponent::UpdateActionStates(</div><div class="line"><a class="code" href="class_i_active_context.html">IActiveContext</a>* ac, <a class="code" href="class_i_action_state_list.html">IActionStateList</a>* listToUpdate, <a class="code" href="struct_sys_point.html">GSysPoint</a> mousePoint, <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>* widget){</div><div class="line"> ...</div><div class="line"><span class="keywordflow">case</span> kYourActionID:</div><div class="line"> {</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IYourSuite&gt;</a> iYourSuite(ac-&gt;GetContextSelection(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (iYourSuite != nil &amp;&amp; iYourSuite-&gt;CanDoSomething()==kTrue)</div><div class="line"> {</div><div class="line"> listToUpdate-&gt;<a class="code" href="class_i_action_state_list.html#a84822495d335b71cb7d95bc875e4917f">SetNthActionState</a>(count,kEnabledAction);</div><div class="line"> }</div><div class="line"> }</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> ...</div><div class="line">}</div></div><p>Your suite can now enable an action and change the selected text when that action is clicked. Here is how to call your suite from your action component: <div class="fragment"><div class="line"><span class="keywordtype">void</span> YourActionComponent::DoAction( <a class="code" href="class_i_active_context.html">IActiveContext</a>* ac, <a class="code" href="class_i_d_type.html">ActionID</a> action, <a class="code" href="struct_sys_point.html">GSysPoint</a> mousePoint, <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>* widget){</div><div class="line"> ...</div><div class="line"><span class="keywordflow">case</span> kYourActionID:</div><div class="line"> {</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IYourSuite&gt;</a> iYourSuite(ac-&gt;GetContextSelection(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (iYourSuite) {</div><div class="line"> iYourSuite-&gt;DoSomething();</div><div class="line"> }</div><div class="line"> }</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> ...</div><div class="line">}</div></div><p><b>Sample code</b><ul><li><a class="el" href="class_pst_lst_u_i_action_component.html">PstLstUIActionComponent</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_active_context.html">IActiveContext</a></ul><h3><a class="anchor" id="id_determining_which_csbs_to_support"></a> Determining which CSBs to support</h3><p>Look for information about the CSBs on which your suite should be available. See the following table, which shows concrete selection boss classes and their parent suite boss classes<table class="doxtable"><tr><th>CSB </th><th>Suite Boss Class </th><th>Target Interface </th></tr><tr><td><a class="el" href="classk_new_layout_selection_boss.html">kNewLayoutSelectionBoss</a></td><td><a class="el" href="classk_layout_suite_boss.html">kLayoutSuiteBoss</a></td><td><a class="el" href="class_i_layout_target.html">ILayoutTarget</a></td></tr><tr><td><a class="el" href="classk_text_selection_boss.html">kTextSelectionBoss</a></td><td><a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a></td><td><a class="el" href="class_i_text_target.html">ITextTarget</a></td></tr><tr><td><a class="el" href="classk_table_selection_boss.html">kTableSelectionBoss</a></td><td><a class="el" href="classk_table_suite_boss.html">kTableSuiteBoss</a></td><td><a class="el" href="class_i_table_target.html">ITableTarget</a></td></tr><tr><td><a class="el" href="classk_x_m_l_structure_selection_boss.html">kXMLStructureSelectionBoss</a></td><td><a class="el" href="classk_x_m_l_structure_suite_boss.html">kXMLStructureSuiteBoss</a></td><td><a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a></td></tr><tr><td><a class="el" href="classk_note_text_selection_boss.html">kNoteTextSelectionBoss</a></td><td><a class="el" href="classk_note_text_suite_boss.html">kNoteTextSuiteBoss</a></td><td><a class="el" href="class_i_text_target.html">ITextTarget</a></td></tr><tr><td><a class="el" href="classk_galley_text_selection_boss.html">kGalleyTextSelectionBoss</a></td><td><a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a></td><td><a class="el" href="class_i_text_target.html">ITextTarget</a></td></tr><tr><td><a class="el" href="classk_story_editor_selection_boss.html">kStoryEditorSelectionBoss</a></td><td><a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a>(<a class="el" href="classk_story_editor_selection_boss.html">kStoryEditorSelectionBoss</a> sub-classes <a class="el" href="classk_galley_text_selection_boss.html">kGalleyTextSelectionBoss</a>) </td><td><a class="el" href="class_i_text_target.html">ITextTarget</a></td></tr><tr><td><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a></td><td><a class="el" href="classk_document_default_suite_boss.html">kDocumentDefaultSuiteBoss</a></td><td>Not applicable. The suite targets whichever workspace interface contains its defaults </td></tr><tr><td><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a></td><td><a class="el" href="classk_application_default_suite_boss.html">kApplicationDefaultSuiteBoss</a></td><td>Not applicable </td></tr></table><h3><a class="anchor" id="id_adding_a_selection_extension_implementationid"></a> Adding a selection extension ImplementationID</h3><p>In your ID.h file, declare an ImplementationID for the selection extension.<p>This declaration is in addition to the ImplementationID needed for the basic suite implementation. The ImplementationID is of an <a class="el" href="class_i_selection_extension.html">ISelectionExtension</a> interface, as shown here: <div class="fragment"><div class="line">DECLARE_PMID(kImplementationIDSpace, kBPISuiteLayoutSelectionExtImpl, kBPIPrefix + 10)</div></div><p><b>Related documentation</b><ul><li><a class="el" href="class_hid_txt_suite_text_c_s_b.html">HidTxtSuiteTextCSB</a></ul><p><b>Sample code</b><ul><li>BPIID</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_selection_extension.html">ISelectionExtension</a></ul><h3><a class="anchor" id="id_adding_a_selection_extension_resource"></a> Adding a selection extension resource</h3><p>This resource associates the selection extension implementation with its suite implementation: <div class="fragment"><div class="line">resource kSelectionSuiteExt(1){</div><div class="line"><a class="code" href="classk_new_layout_selection_boss.html">kNewLayoutSelectionBoss</a>,</div><div class="line"> {</div><div class="line"> kBPISuiteLayoutCSBImpl, kBPISuiteLayoutSelectionExtImpl,</div><div class="line"> }</div><div class="line">};</div></div><dl class="section note"><dt>Note<dd>You do not need to aggregate the selection extension implementation on any boss class; the selection subsystem creates it when needed.</dl><p><b>Sample code</b><ul><li>CdlChart.fr</ul><p><b>Related API</b><ul><li>kSelectionSuiteExt</ul><h3><a class="anchor" id="id_implementing_the_selection_extension_member_functions"></a> Implementing the selection extension member functions</h3><p>Modify the suite implementation file as follows:<ol type="1"><li>Include the selection extension templates: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;SelectionExtTemplates.tpp&quot;</span></div></div><li>Add the following member functions to the suite declaration: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Startup(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Shutdown(<span class="keywordtype">void</span>);</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> SelectionChanged(<a class="code" href="class_k2_vector.html">SuiteBroadcastData</a>*, <span class="keyword">const</span> <a class="code" href="class_i_d_type.html">PMIID</a>&amp;, <span class="keywordtype">void</span>*);</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> SelectionAttributeChanged(<a class="code" href="class_k2_vector.html">SuiteBroadcastData</a>*, <span class="keyword">const</span> <a class="code" href="class_i_d_type.html">PMIID</a>&amp;, <span class="keywordtype">void</span>*);</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> HandleIntegratorSuiteMessage( <span class="keywordtype">void</span>*, <span class="keyword">const</span> <a class="code" href="class_i_d_type.html">ClassID</a>&amp;, <a class="code" href="class_i_subject.html">ISubject</a>*, <span class="keyword">const</span> <a class="code" href="class_i_d_type.html">PMIID</a>&amp;, <span class="keywordtype">void</span>*, <a class="code" href="class_i_selection_manager.html">ISelectionManager</a>*);</div><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_k2_vector.html">ProtocolCollection</a>* CreateObserverProtocolCollection(<span class="keywordtype">void</span>);</div></div><li>Instantiate the template to make the selection extension implementation available to the application&#39;s object model. The parameter to the template is the suite implementation class: <div class="fragment"><div class="line"><span class="keyword">template</span> <span class="keyword">class </span>SelectionExt&lt;BPISuiteLayoutCSB&gt;;</div><div class="line">CREATE_PMINTERFACE (SelectionExt&lt;BPISuiteLayoutCSB&gt;, kBPISuiteLayoutSelectionExtImpl)</div></div><dl class="section note"><dt>Note<dd>This implementation is in addition to the CREATE_PMINTERFACE needed for your basic suite implementation.</dl><li>Define the selection extension member functions in your suite. You do not need to write any code for the <a class="el" href="class_i_selection_extension.html">ISelectionExtension</a> interface that provides the bridge between selection and these member functions in your suite.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_b_p_i_suite_c_s_b.html">BPISuiteCSB</a><li><a class="el" href="class_b_p_i_suite_layout_c_s_b.html">BPISuiteLayoutCSB</a></ul><h3><a class="anchor" id="id_calling_selection_extensions_when_selection_attributes_change"></a> Calling selection extensions when selection attributes change</h3><p>Each CSB is responsible for defining the mechanism used to call selection extensions when selection attributes change.<ul><li>The layout CSB uses a document observer all selection extensions can use. By returning additional protocols through their CreateObserverProtocolCollection suites, they use this shared observer to attach additional protocols to the document&#39;s subject.<li>The text CSB uses a text focus (<a class="el" href="class_i_text_focus.html">ITextFocus</a>) on the <a class="el" href="classk_text_selection_focus_boss.html">kTextSelectionFocusBoss</a> boss class to connect the selection to attribute changes.<li>The table CSB uses a cell focus (<a class="el" href="class_i_cell_focus.html">ICellFocus</a>).</ul><p>Also, the text and table CSBs share the layout CSB&#39;s mechanism of observing the document&#39;s subject. This is required for commands that do not notify through the text focus or cell focus, but instead broadcast on the document&#39;s subject; for example, <a class="el" href="classk_change_number_of_columns_cmd_boss.html">kChangeNumberOfColumnsCmdBoss</a> and <a class="el" href="classk_optical_margin_alignment_cmd_boss.html">kOpticalMarginAlignmentCmdBoss</a>. If you add custom attributes and find your selection extension is not being called when these attributes change, check that the command notifies the change on the appropriate subject.<h3><a class="anchor" id="id_registering_the_selection_extension_implementation"></a> Registering the selection extension implementation</h3><p>The selection extension template must be used.<p>To prevent dead-stripping of your selection extension implementation, call the REGISTER_PMINTERFACE macro: <div class="fragment"><div class="line">REGISTER_PMINTERFACE (SelectionExt&lt;BPILayoutCSB&gt;, kBPILayoutCSBSelectionExtImpl)</div></div><p><b>Related sample code</b><ul><li><a class="el" href="_b_p_i_factory_list_8h_source.html">BPIFactoryList.h</a></ul><h3><a class="anchor" id="id_determining_why_your_selection_extension_is_not_being_called"></a> Determining why your selection extension is not being called</h3><p>Try the following:<ul><li>Verify that you declared a kSelectionSuiteExt resource for it in your plug-in&#39;s .fr file.<li>Verify that you registered your selection extension.</ul><h3><a class="anchor" id="id_determining_why_your_selection_extensions_selectionattributechanged_is_not_being_called"></a> Determining why your selection extension&#39;s SelectionAttributeChanged is not being called</h3><p>Try the following:<ul><li>See whether the concrete selection you are targeting can extend the selection attributes for which changes can trigger notification.<li>Verify that you defined CreateObserverProtocolCollection to indicate the PMIIDs of any additional protocols to be observed (for example, the PMIID of an interface you added to a page item).<li>Verify that your custom commands that change any custom data interfaces trigger notification of change through the subject the CSB is observing.</ul><h1><a class="anchor" id="id_user_interfaces"></a> User Interfaces</h1><h2><a class="anchor" id="id_getting_started"></a> Getting started</h2><h3><a class="anchor" id="id_separating_model_and_user_interface_code"></a> Separating model and user interface code</h3><p>InDesign requires that you factor your code into at least two plug-ins:<ul><li>A user-interface plug-in that is responsible for presentation to and interaction with the end user.<li>One or more model plug-ins that manipulates the model; for instance, one that implements extension patterns that enable you to store persistent data in a document or participate in a process such as drawing or printing.</ul><p>If you write a model plug-in that implements commands and/or suites, write a user interface plug-in that drives these commands and/or suites as a client. For example, to add a new feature &lt;X&gt; and drive this through a panel, write two plug-ins: one named &lt;X&gt; and the other &lt;X&gt;UI. This particular factorization is employed widely throughout the application code base, such as the TransparencyEffects/UI or CustomDataLink/UI SDK sample plug-ins.<h3><a class="anchor" id="id_developing_a_user_interface_plug-in"></a> Developing a user interface plug-in</h3><p>Writing a user interface for an Adobe &reg; InDesign plug-in is a complex task. This is because there is a strong connection between the user interface programming model and the persistence model for InDesign . In addition, writing a cross-platform user interface API is difficult, and it is not easy to shield developers from the inherent complexity of the task. Not only is the API cross-platform, it operates across multiple locales, adding even more complexity. The following are the steps that a developer of a plug-in interface typically performs:<ol type="1"><li>Discover the widget boss classes and ODFRez custom resource types needed in the initial analysis phase.<li>Work out what must be subclassed (both the widget boss class, and the ODFRez custom resource type) to achieve desired functionality, or whether widgets can be used as is (for example, static text widgets that display invariant text).<li>Determine widget hierarchy and geometry; this consists of determining the containment relationships for widgets and their bounding boxes.<li>Define symbolic constants, like constants for boss class IDs if there are subclassed widget boss classes, widget IDs, implementation IDs, and string table keys and their translations in the localized string tables for target locales.<li>Define new boss classes and associated ODFRez types, if needed.<li>Create ODFRez data statements to specify the initial states of the user interface elements and localized string data.<li>Implement required interfaces. For example, for the tree view control, there are two interfaces client code must implement.<li>Write observer implementations to handle Update messages from the change manager.</ol><h3><a class="anchor" id="id_subclassing_widget_boss_classes_and_odfrez_custom_resource_types"></a> Subclassing widget boss classes and ODFRez custom resource types</h3><p>If all your controls are on a dialog and you want to collect the state of all the controls only when the dialog is being dismissed, you do not need to subclass. Typically, an existing boss class is subclasses to add an <a class="el" href="class_i_observer.html">IObserver</a> interface to a subclass of the widget boss class, to enable notification about changes to the data model of the widget boss object to be received. When an existing widget boss class is being subclassed, a new boss class should be defined in the boss type definition file (typically named &lt;project&gt;.fr). In more specialized cases, you must subclass to provide your own implementation of required interfaces, such as for a tree view control. To also change the drawing behavior, you may want to override the <a class="el" href="class_i_control_view.html">IControlView</a> interface.<p>If a widget boss class is subclassed, there also must be a new ODFRez custom resource type created that is bound to the new boss class by class ID. When existing ODFRez custom resource types are extended, define the new ODFRez custom resource types to be added to the top-level framework resource file.<h3><a class="anchor" id="id_showing_hiding_enabling_and_disabling_a_widget"></a> Showing, hiding, enabling, and disabling a widget</h3><p>Use the <a class="el" href="class_i_control_view.html">IControlView</a> interface of a widget boss object; it has methods like ShowView and Enable, which can toggle the state of a widget boss object. There are many other methods on this interface that can be used; for example, to vary its dimensions.<h3><a class="anchor" id="id_adding_tips_to_a_widget"></a> Adding tips to a widget</h3><p>There are two ways to add tips:<ul><li>Tips can be defined entirely in the resource data, in which case they are static tips.<li>If a custom tip is required, a widget boss class can be extended to override the base implementation of the interface <a class="el" href="class_i_tip.html">ITip</a> (on <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>).</ul><h3><a class="anchor" id="id_overriding_an_event_handler_or_not"></a> Overriding an event handler (or not)</h3><p>Typically, to be notified about widget events, you need to implement only <a class="el" href="class_i_observer.html">IObserver</a>; you subclass an existing widget boss class, adding your implementation of <a class="el" href="class_i_observer.html">IObserver</a> to the new boss class. Overriding the event handler for a widget is required only when adding highly specialized behavior.<h3><a class="anchor" id="id_writing_safe_code_and_debugging"></a> Writing safe code and debugging</h3><p>Methods prefixed by &quot;Get&quot; or &quot;Find,&quot; like <a class="el" href="class_i_panel_control_data.html#adfe5839fb0dd6a57433987cd38236576">IPanelControlData::GetWidget</a> or FindWidget, do not increment the reference count, and the pointer returned should not be used as a constructor argument for an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. Methods named &quot;Query&quot;&lt;name&gt;, like <a class="el" href="class_i_dialog_controller.html">IDialogController</a>:QueryListControlDataInterface, are used as constructor arguments for an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>, because the constructor tries to call AddRef and the destructor Release on the encapsulated pointer.<p>Encapsulate tests for interface pointers that can be nil in a construct, like the do ... while block in the following code, breaking when a nil pointer is encountered rather than causing the application to crash. We recommend the following pattern: <div class="fragment"><div class="line"><span class="keywordflow">do</span> { </div><div class="line"><span class="comment">// code here... </span></div><div class="line"> ASSERT(iMyInterfacePtr); </div><div class="line"><span class="keywordflow">if</span>(iMyInterfacePtr == nil) {</div><div class="line"><span class="keywordflow">break</span>; </div><div class="line"> } </div><div class="line"><span class="comment">// more code here... </span></div><div class="line">} <span class="keywordflow">while</span>(kFalse);</div></div><p>Use statements like ASSERT and TRACEFLOW to check your assumptions. For instance, if you have an <a class="el" href="class_i_control_view.html">IControlView</a> interface, see the API documentation to determine which boss classes aggregate this interface in the core set.<h2><a class="anchor" id="id_menus"></a> Menus</h2><h3><a class="anchor" id="id_creating_menu_entries"></a> Creating menu entries</h3><p>The easiest way to create menu entries is to use DollyXs. The main requirement is to create a boss class with an implementation of <a class="el" href="class_i_action_component.html">IActionComponent</a>; for an example, see <a class="el" href="classk_bsc_mnu_action_component_boss.html">kBscMnuActionComponentBoss</a>.<p>You also must create ODFRez data statements (ActionDef and MenuDef) specifying the menu properties. For every ActionID defined, there should be a corresponding MenuDef and ActionDef entry. The MenuDef specifies where a menu item appears in the set of menus, and the ActionDef specifies how it is handled and its enabling conditions; for instance, if it should be enabled only when there is a front document. The following example has extracts from the MenuDef and ActionDef resources for the BasicMenu SDK sample: <div class="fragment"><div class="line"><span class="comment">// In the ID.h file:</span></div><div class="line">DECLARE_PMID(kActionIDSpace, kBscMnuAboutActionID,kBscMnuPrefix + 0)</div><div class="line"><span class="comment">// In .fr file:</span></div><div class="line">resource MenuDef (kSDKDefMenuResourceID){</div><div class="line"> {</div><div class="line"><span class="comment">// The About Plug-ins sub-menu item for this plug-in.</span></div><div class="line"> kBscMnuAboutActionID, <span class="comment">// ActionID </span></div><div class="line"> kBscMnuAboutMenuPath, <span class="comment">// Menu Path.</span></div><div class="line"> kSDKDefAlphabeticPosition, <span class="comment">// Menu Position.</span></div><div class="line"> kSDKDefIsNotDynamicMenuFlag, <span class="comment">// Whether dynamic or not</span></div><div class="line"><span class="comment">// other entries omitted</span></div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource ActionDef (kSDKDefActionResourceID){</div><div class="line"> { </div><div class="line"><a class="code" href="classk_bsc_mnu_action_component_boss.html">kBscMnuActionComponentBoss</a>, <span class="comment">// ClassID supporting this ActionID.</span></div><div class="line"> kBscMnuAboutActionID, <span class="comment">// ActionID.</span></div><div class="line"> kBscMnuAboutMenuKey, <span class="comment">// Sub-menu string.</span></div><div class="line"> kHelpMenuActionArea, <span class="comment">// Area name (see ActionDefs.h).</span></div><div class="line"> kNormalAction, <span class="comment">// Type of action (see ActionDefs.h).</span></div><div class="line"> kDisableIfLowMem, <span class="comment">// Enabling type (see ActionDefs.h).</span></div><div class="line"> kInvalidInterfaceID, <span class="comment">// Selection InterfaceID</span></div><div class="line"> kSDKDefInvisibleInKBSCEditorFlag, <span class="comment">// Other entries omitted</span></div><div class="line"> }</div><div class="line">};</div></div><p>You also need to define string keys for the menu path components, and translations of these keys when adding strings that do not already have translations. If you need to put your menu item in an existing menu, then you need have the parent menu&#39;s full path in the MenuDef. You would also need to know the positions of the menu items surrounding your intended menu location. To gather such information, the easiest way is to use the debug facility available in InDesign Build as describe below.<ol type="1"><li>Choose Test:TRACE: menu - first turn on the trace output to either Debug Window, notepad.exe or Debug log.<li>Choose Test:TRACE menu and turn on the trace category for &#39;menu building&#39;<li>Click on the menu you care about, and look at the trace output. There&#39;s a bunch of output there, but the menu key strings are part of it.</ol><p>Or alternatively, you can choose a test menu to output all the menu information to the trace output of your choice by choosing the following test menu:<ul><li>Test &gt; UI &gt; Actions &gt; Dump MenuMgr Info(all)</ul><p>You should see a long log in your start up volume containing information such as: <div class="fragment"><div class="line">Menu path #CondTextUI_PanelMenu</div><div class="line"><span class="preprocessor"> #CondTextUI_NewConditionTagMenu</span></div><div class="line"><span class="preprocessor"></span> (kNewConditionTagActionID[ConditionalTextUI + 2 (0x20802)]), pos 100.0000, Flags normal</div><div class="line"><span class="preprocessor"> #CondTextUI_DeleteConditionTagMenu</span></div><div class="line"><span class="preprocessor"></span> (kDeleteConditionTagActionID[ConditionalTextUI + 11 (0x2080b)]), pos 110.0000, Flags normal</div><div class="line"> (kEditConditionSeperatorActionID[ConditionalTextUI + 12 (0x2080c)]), pos 120.0000, Flags separator</div><div class="line"><span class="preprocessor"> #CondTextUI_EditConditionTagMenu</span></div><div class="line"><span class="preprocessor"></span> (kEditConditionTagActionID[ConditionalTextUI + 13 (0x2080d)]), pos 130.0000, Flags normal</div><div class="line"> (kLoadSeperatorActionID[ConditionalTextUI + 8 (0x20808)]), pos 200.0000, Flags separator</div><div class="line"><span class="preprocessor"> #CondTextUI_LoadConditionTagsMenu</span></div><div class="line"><span class="preprocessor"></span> (kLoadConditionTagsActionID[ConditionalTextUI + 6 (0x20806)]), pos 300.0000, Flags normal</div><div class="line"><span class="preprocessor"> #CondTextUI_LoadConditionTagsAndSetsMenu</span></div><div class="line"><span class="preprocessor"> (kLoadConditionTagsAndSetsActionID[ConditionalTextUI + 7 (0x20807)]), pos 400.0000, Flags normal</span></div></div><p>The preceding entry tells you there is a menu path called &quot;#CondTextUI_PanelMenu&quot;, it has an action associated with it which is called #CondTextUI_NewConditionTagMenu. Followed by the ActionID for the action, it&#39;s position in the menu and the menu flag as defined in the MenuDef. Then same action information follows for another action associated with the same menu.<h3><a class="anchor" id="id_handling_menu_items"></a> Handling menu items</h3><p>When implementing a menu, you provide an implementation of the <a class="el" href="class_i_action_component.html">IActionComponent</a> interface. The application framework calls the methods on the <a class="el" href="class_i_action_component.html">IActionComponent</a> interface when the menu item is activated and at other points, such as if there is custom enabling specified in the ODFRez data statements.<p>Provide menu handling for each menu item you care about in the implementation of your <a class="el" href="class_i_action_component.html">IActionComponent</a> interface.<h3><a class="anchor" id="id_adding_a_contextual_menu_to_a_plug-in"></a> Adding a contextual menu to a plug-in</h3><p>There are several contextual menus, one for each context the application recognizes. The process of adding menu items to these context-sensitive menus is like that of adding normal menu items: in the MenuList resource, specify where the items should go and what the contents of the menu entries should be, by providing keys into the string tables.<h3><a class="anchor" id="id_finding_the_panel_to_which_a_pop-up_menu_belongs"></a> Finding the panel to which a pop-up menu belongs</h3><p><a class="el" href="class_i_palette_panel_utils.html">IPalettePanelUtils</a> contains a method for locating a panel given a WidgetID. Several SDK samples show how to navigate from the menu boss object to the panel boss object.<h2><a class="anchor" id="id_alerts"></a> Alerts</h2><h3><a class="anchor" id="id_creating_a_basic_alert"></a> Creating a basic alert</h3><p>Alerts provide notifications to an end user; for instance, a warning or message about an error. They also can solicit a response from the end user, such as Yes, No, or some other response, so they can provide a means of data entry.<p>The function to create and work with alerts comes from the <a class="el" href="class_c_alert.html">CAlert</a> helper class; for details, see its API documentation. The <a class="el" href="class_c_alert.html">CAlert</a> class is straightforward to use, involving static methods with many default arguments. The following example shows how to create a warning alert from client code: <div class="fragment"><div class="line"><span class="comment">// Here, translation(s) must exist for kWarningMessageKey.</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> string(kWarningMessageKey);</div><div class="line"><a class="code" href="class_c_alert.html#abb2e96abc9d37d1dc81b3caab99a167f">CAlert::WarningAlert</a>(<span class="keywordtype">string</span>);</div></div><p>Alerts are an exception in the InDesign API, because you do not need to be concerned with boss classes or ODFRez types; these alerts are created using methods on the <a class="el" href="class_c_alert.html">CAlert</a> API helper class.<dl class="section note"><dt>Note<dd>The user interface <a class="el" href="class_p_m_string.html">PMString</a> arguments always are translated, unless the client code explicitly marks them as non-translatable. Use non-translated strings only for internal strings or debugging purposes; otherwise, in accordance with the user interface architecture, provide string translations for any locale your user interface is likely to need.</dl><h3><a class="anchor" id="id_creating_an_error_alert"></a> Creating an error alert</h3><p>A common alert use is to display an error message of some kind. The following example shows a very common pattern for this: <div class="fragment"><div class="line"><span class="comment">// assume some other code invoking </span></div><div class="line">PMSetGlobalErrorCode()ErrorCode result = possibleFailure();</div><div class="line"><span class="comment">// determine the appropriate error message to display</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> <span class="keywordtype">string</span> = <a class="code" href="class_error_utils.html">ErrorUtils</a>::PMGetErrorString(result);</div><div class="line">if(!<span class="keywordtype">string</span>.IsNull()) {</div><div class="line"><span class="comment">// Display the translated error message</span></div><div class="line"><a class="code" href="class_c_alert.html#a8875959f2e7e58e830d4f7953f54b525">CAlert::ErrorAlert</a>(<span class="keywordtype">string</span>);</div><div class="line"><span class="comment">// reset the global error code to clear the error</span></div><div class="line"><a class="code" href="class_error_utils.html#ae603b63520be78e0d9875cc99e9bfeca">ErrorUtils::PMSetGlobalErrorCode</a>(kSuccess);</div><div class="line">}</div></div><h3><a class="anchor" id="id_creating_other_kinds_of_alerts"></a> Creating other kinds of alerts</h3><p>The ModalAlert methods provide the most flexibility in terms of labels on buttons, icons displayed, ordering of buttons, and return value to be queried. Instances of this are used across the SDK samples; for instance, the Snapshot sample uses a ModalAlert to solicit a yes/no response.<h3><a class="anchor" id="id_soliciting_a_binary_or_ternary_choice"></a> Soliciting a binary or ternary choice</h3><p>Create a <a class="el" href="class_c_alert.html">CAlert</a> with two or three buttons. <a class="el" href="class_c_alert.html#a411ff8eb8f4420f179a6f29abe68ecd5">CAlert::ModalAlert</a> returns the index of the button that was pressed, starting with &quot;1&quot; for the leftmost button.<h3><a class="anchor" id="id_line-breaking_in_alert_messages"></a> Line-breaking in alert messages</h3><p>Line-breaking algorithms for the text displayed in alerts depend on the routines provided by the platform API; there is no control over the composition of text for alerts.<p>If you do not want to depend on the platform algorithm to break strings for display in an alert, you can segment the text to be displayed by using the kLineSeparatorString constant (defined in <a class="el" href="_core_res_types_8h_source.html">CoreResTypes.h</a>) to specify where lines of text in the alert should break. The following example shows how to define a string that would break across two lines in a predictable way: <div class="fragment"><div class="line"><span class="stringliteral">&quot;Here is a string&quot;</span> kLineSeparatorString <span class="stringliteral">&quot; that takes up two lines.&quot;</span></div><div class="line"><span class="comment">//The resource compiler combines these into one string with a carriage return.</span></div></div><h2><a class="anchor" id="id_progress_bars"></a> Progress bars</h2><h3><a class="anchor" id="id_creating_progress_bars"></a> Creating progress bars</h3><p>A progress bar widget shows progress on a lengthy task, like import, export, or an elaborate conversion. The progress bar manager (<a class="el" href="class_i_progress_bar_manager.html">IProgressBarManager</a>) mediates creation and interaction with progress bars; for details, see its API documentation.<p>A progress bar appears in its own dialog (<a class="el" href="classk_progress_bar_dialog_boss.html">kProgressBarDialogBoss</a>), which consists of a progress bar widget (<a class="el" href="classk_progress_bar_widget_boss.html">kProgressBarWidgetBoss</a>) and a cancel button (<a class="el" href="classk_progress_bar_cancel_button_boss.html">kProgressBarCancelButtonBoss</a>) to end the current task.<p>A progress bar combines information about the number of tasks and the range of display associated with each task. The default display range is the interval [0,1], and each task added fills in another division on the progress bar when completed.<p>To create a progress bar, use a subclass of <a class="el" href="class_base_progress_bar.html">BaseProgressBar</a>, like <a class="el" href="class_range_progress_bar.html">RangeProgressBar</a> or <a class="el" href="class_task_progress_bar.html">TaskProgressBar</a> (see <a class="el" href="_progress_bar_8h_source.html">ProgressBar.h</a>).<h3><a class="anchor" id="id_modifying_a_progress_bar"></a> Modifying a progress bar</h3><p>Use progress bar helper class methods; for example, <a class="el" href="class_base_progress_bar.html#a6b58369c270146e45e400058beaac3fd">BaseProgressBar::SetPosition</a>.<h3><a class="anchor" id="id_suppressing_progress_bars"></a> Suppressing progress bars</h3><p>Use the <a class="el" href="class_suppress_progress_bar_display.html">SuppressProgressBarDisplay</a> API class.<h2><a class="anchor" id="id_dialogs"></a> Dialogs</h2><h3><a class="anchor" id="id_using_a_dialog"></a> Using a dialog</h3><p>Dialogs are used to solicit input from an end user. This is a modal process; the end user must supply input or dismiss the dialog with a cancel gesture before returning to the main application.<p>A dialog created with the API is a window (<a class="el" href="classk_movable_modal_window_boss.html">kMovableModalWindowBoss</a>) with a panel inside it. The <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> boss class and its descendants provide the panel&#39;s behavior. Classes k&lt;whatever&gt;DialogBoss, therefore, are panel boss classes; <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> extends <a class="el" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a>. Remember, when implementing the dialog, you are defining widgets within a panel that happens to be housed in a modal, movable window. The following table lists dialog boss classes:<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Example of Use </th></tr><tr><td><a class="el" href="classk_dialog_boss.html">kDialogBoss</a></td><td>DialogBoss </td><td>Ancestor for all dialog boss classes. </td></tr><tr><td><a class="el" href="classk_resize_dialog_boss.html">kResizeDialogBoss</a></td><td>ResizeDialogWidget </td><td>Create a resizable dialog. </td></tr><tr><td><a class="el" href="classk_selectable_dialog_boss.html">kSelectableDialogBoss</a></td><td>SelectableDialogBoss </td><td>Create a selectable dialog. </td></tr><tr><td><a class="el" href="classk_tab_selectable_dialog_boss.html">kTabSelectableDialogBoss</a></td><td>TabSelectableDialogBoss </td><td>Create a tab-selectable dialog. </td></tr></table><p>Most dialogs should have least two buttons:<ul><li>A button to accept the choices made (Done or OK, in English locales).<li>A button to indicate the choices are to be revoked (Cancel).</ul><p>Typically, the buttons derive their behavior from <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> and <a class="el" href="classk_cancel_button_widget_boss.html">kCancelButtonWidgetBoss</a>, respectively. The default value of the ButtonAttributes member is kTrue, meaning the OK control grabs the input focus when the dialog appears.<p>Although dialogs and panels appear to be quite different types of widgets, they share much behavior. The panel widget (<a class="el" href="classk_palette_panel_widget_boss.html">kPalettePanelWidgetBoss</a>) that provides the behavior for a panel housed within a floating palette uses much of the same code as the <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> class, which provides the behavior for a panel within a modal, moveable window.<p>The dialog architecture provides sophisticated features like preview capability, with the condition that dialogs that can be previewed also must be modal. A modal dialog is one in which the user must make a set of commitments (optionally previewing the result) and then dismiss the dialog with an affirmation to execute (OK or Done) or a Cancel. The end user cannot carry on with other activities while the modal dialog is open. The end user is blocked from other tasks, and the application waits for the end user to finish with a modal dialog before further processing can occur.<p>There are several examples in the SDK that involve working with dialogs, such as the BasicDialog SDK plug-in.<p>ResizeDialogWidget is a dialog resource that overrides the <a class="el" href="class_i_control_view.html">IControlView</a> interface and replaces it with an ErasablePanelView implementation, to create a resizable dialog. For an example, see the Map Tags to Styles dialog on the Tags panel.<p>Although dialogs written with the InDesign API can be declared to be movable and modeless, in practice all dialogs in the application are movable but modal (see <a class="el" href="classk_movable_modal_window_boss.html">kMovableModalWindowBoss</a>).<p>An abstraction called the dialog manager (<a class="el" href="class_i_dialog_mgr.html">IDialogMgr</a>) instantiates new dialogs and queries for information about dialogs. Plug-ins that create dialogs, like BasicDialog, use this interface to instantiate the dialog. There also are selectable dialogs, where a list control is used to page through the dialog panels, and a tab-selectable dialog.<h3><a class="anchor" id="id_creating_a_dialog"></a> Creating a dialog</h3><p>The standard method is to create a new boss class that subclasses <a class="el" href="classk_dialog_boss.html">kDialogBoss</a>, a panel boss class. By convention, you also create other user interface elements that enable the dialog to be shown, like a menu component, shortcut, or button that brings up the dialog. Use the DollyXs template dialog to get a basic dialog.<p>The ancestor for all dialog boss classes is <a class="el" href="classk_dialog_boss.html">kDialogBoss</a>. It is specialized by many subclasses, like <a class="el" href="classk_selectable_dialog_boss.html">kSelectableDialogBoss</a>, providing behavior for a selectable dialog. It supports a preview capability, so end users can preview the effect of changes they might make without having to commit to changing the document.<p>The usual process to create a dialog is to subclass the kDialogboss class and provide an implementation of two interfaces, <a class="el" href="class_i_dialog_controller.html">IDialogController</a> (using the <a class="el" href="class_c_dialog_controller.html">CDialogController</a> helper class) and <a class="el" href="class_i_observer.html">IObserver</a> (using <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>).<p>The <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> partial implementation class has several responsibilities: it attaches observers to the standard OK (which should have the widget identifier kOKButtonWidgetID), Cancel (kCancelButtonWidgetID), and Preview buttons (kPreviewButtonWidgetID).<p>When creating a new dialog boss class, subclass the ODFRez custom resource type DialogBoss, and bind it onto the new dialog boss class. Also, define the view resources for each locale in a <a class="el" href="class_locale_index.html">LocaleIndex</a> resource.<p>Several SDK samples create dialogs; BasicDialog is the most stripped-down example.<h3><a class="anchor" id="id_using_eve_for_dialog_layout"></a> Using EVE for dialog layout</h3><p>Updating the layout of a user interface can be time-consuming once all the user interface elements, such as dialog boxes, have been mapped out. For example, even a small change may require you to recalculate the position, size, and alignment of all the elements.<p>By automatically resizing widgets based on text or labels, the Adobe Express View Engine (EVE) can help you to address this challenge. Not only does this make it quick and easy to make small changes to a layout, in most cases it also eliminates the need for multiple .fr files for different locales when localizing applications.<p>With EVE, you lay out a user interface once and then, given a correctly formed textual description of a dialog or palette, EVE dynamically generates the geometry of the user interface elements. With EVE, you create one resource file with the relative positioning and ordering of the widgets in a row-column manner. Doing so saves the time typically needed to generate different resources and define the actual position of the widgets.<p>All sample plug-ins in the InDesign SDK with a dialog use EVE for layout. The best advice we can provide is that you look through samples, such as BasicDialog, to understand how to use EVE.<p>It is neither necessary nor required that you use EVE to lay out panels. Panels are typically of a fixed size and, because of this, do not usually need flexible layouts.<p>For existing dialogs not developed with EVE, use the EVEConverter tool included in the SDK to convert them for use with EVE. For more information about using EVE, Using EVE for Dialogs.<h3><a class="anchor" id="id_creating_a_selectable_dialog"></a> Creating a selectable dialog</h3><p>Selectable dialogs have multiple panels, only one of which is visible at any time. This mechanism has been widely used across many applications. To move between panels in a selectable set, the dialog typically provides Prev (previous) and Next buttons (in the English locale). <a class="el" href="classk_selectable_dialog_boss.html">kSelectableDialogBoss</a> and <a class="el" href="classk_tab_selectable_dialog_boss.html">kTabSelectableDialogBoss</a> provide the behavior for selectable dialogs. See the BasicSelectableDialog SDK sample.<p>The standard method is to create a new boss class that is a subclass of <a class="el" href="classk_selectable_dialog_boss.html">kSelectableDialogBoss</a> or <a class="el" href="classk_tab_selectable_dialog_boss.html">kTabSelectableDialogBoss</a>. You must provide an implementation of the <a class="el" href="class_i_dialog_creator.html">IDialogCreator</a> interface and to add an <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface that returns a number identifying the boss class as a dialog service provider. For more information, see the BasicSelectableDialog SDK sample plug-in.<p>There are two main use cases when working with selectable dialogs:<ul><li>Adding a panel to an existing selectable dialog.<li>Creating a selectable dialog of one&#39;s own. This is shown in the BasicSelectableDialog SDK sample, which shows how to create a standard selectable dialog (like the Preferences dialog of the application) and a tab-selectable dialog.</ul><h3><a class="anchor" id="id_creating_a_previewable_dialog"></a> Creating a previewable dialog</h3><p>Previewable dialogs allow an action to be previewed before it is committed. Previews of parameter effects are found in the context of modal dialogs within applications, like the Transform dialogs (move, rotate, scale, and shear). With modeless panels, it is harder to define the commit semantics than for modal dialogs; consequently, the preview feature is restricted to modal dialogs.<p>There must be a check box widget with identifier kPreviewButtonWidgetID. The expectation is that it has an <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a> interface, which is consistent with the radio and check box buttons.<p>A previewable dialog involves subclassing <a class="el" href="classk_dialog_boss.html">kDialogBoss</a>; it should have a check-box widget with the well known widget ID kPreviewButtonWidgetID. The preview subsystem commits the commands executed only when the dialog is dismissed with a positive confirmation, like OK or Done; otherwise, a previewable dialog is an ordinary dialog. It requires no new interfaces to be added to the dialog boss class than would be required for a non-previewable dialog implementation; however, some specialized implementation code is required. The TransparencyEffects SDK sample shows how to make use of this feature.<h3><a class="anchor" id="id_dealing_with_child_widgets"></a> Dealing with child widgets</h3><p>The <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> boss class and its descendants (typically named k&lt;whatever&gt;DialogBoss) aggregate the <a class="el" href="class_i_dialog_controller.html">IDialogController</a> and <a class="el" href="class_i_observer.html">IObserver</a> interfaces. To create and work with a dialog from client code, subclass <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> (or one of its descendants) and provide your own implementations of <a class="el" href="class_i_dialog_controller.html">IDialogController</a> and <a class="el" href="class_i_observer.html">IObserver</a> by specializing <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>, to handle notifications from the child controls.<p>The interfaces exposed by boss class <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> are in the SDK online documentation. The following table lists the responsibilities of some interfaces on this boss class:<table class="doxtable"><tr><th>Interface </th><th>Description </th></tr><tr><td><a class="el" href="class_i_panel_control_data.html">IPanelControlData</a></td><td>Used to access the child widget hierarchy on the dialog. </td></tr><tr><td><a class="el" href="class_i_text_control_data.html">ITextControlData</a></td><td>Used to set the dialog name. </td></tr><tr><td><a class="el" href="class_i_control_view.html">IControlView</a></td><td>Uses the same implementation as panels to draw the appearance of the dialog panel. </td></tr><tr><td><a class="el" href="class_i_dialog_controller.html">IDialogController</a></td><td>Supports the dialog protocol and is unique to dialog boss classes. Helper methods connected with edit boxes are used to query and retrieve both strings and typed values, like real-valued numbers. Using the helper methods avoids locating the widget using methods like <a class="el" href="class_i_panel_control_data.html#aa9dde6f0ce56f041ddcd08b4dbc86287">IPanelControlData::FindWidget</a>, or querying for an <a class="el" href="class_i_text_control_data.html">ITextControlData</a> or <a class="el" href="class_i_text_value.html">ITextValue</a> interface. Helper dmethods for boolean and tri-state controls provide shortcuts to query and set the state of these controls. </td></tr><tr><td><a class="el" href="class_i_observer.html">IObserver</a></td><td>Receives notifications about changes in the state of the dialog controls. By default, the partial implementation <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> handles the OK, Cancel, and Preview buttons. Subclass <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> for the <a class="el" href="class_i_observer.html">IObserver</a> implementation added to a dialog boss class. </td></tr></table><h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>There are two key aspects of messaging associated with dialogs:<ul><li>Receiving notification about the controls on the dialog themselves (through <a class="el" href="class_i_observer.html">IObserver</a>, based on <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>).<li>Messages sent through <a class="el" href="class_i_dialog_controller.html">IDialogController</a> that conform to the dialog protocol.</ul><p>The dialog protocol consists of the message sequence sent to the <a class="el" href="class_i_dialog_controller.html">IDialogController</a>:<ol type="1"><li>IDialogController::InitializeDialogFields<li>IDialogController::ValidateDialogFields<li>IDialogController::ApplyDialogFields</ol><dl class="section note"><dt>Note<dd>It is possible that instead of IDialogController::ApplyDialogFields, the last message is IDialogController::ResetDialogFields. This happens when a Cancel button changes to a Reset button with the correct keyboard modifiers. In the event of IDialogController::ResetDialogFields, the IDialogController::InitializeDialogFields message is sent again.</dl><p>Once the dialog is created, the first call made on the dialog is Open on the <a class="el" href="class_i_dialog.html">IDialog</a> interface. Behind the scenes, this calls InitializeDialogFields on a <a class="el" href="class_i_dialog_controller.html">IDialogController</a> interface pointer obtained from the dialog boss object. Typically, a dialog uses the <a class="el" href="class_c_dialog_controller.html">CDialogController</a> utility class to provide most of the implementation of the methods of this interface, with an override of at least ApplyDialogFields. The following are the other key methods that can be overridden:<ul><li>InitializeDialogFields - Delegates initially to the <a class="el" href="class_c_dialog_controller.html#acb92dad77585e64d4e7c45f9331c8b13">CDialogController::InitializeDialogFields</a> method, and sets up initial values.<li>ValidateDialogFields - Returns kDefaultWidgetId if all fields are valid; otherwise, the offending widget ID.<li>ApplyDialogFields - the user accepted the choices and pressed the Done or OK button.</ul><p>The implementation code behind dialogs provides careful bracketing of multiple commands invoked on ApplyDialogFields in the dialog controller. This ensures a command sequence is run when the OK button is pressed and the command sequence is aborted when the Cancel button is pressed. This mechanism works hand-in-hand with the preview capability to ensure that, when preview is operating, even if the effects of a command or command sequence are previewed, changes are not committed when the dialog is dismissed with a Cancel.<h3><a class="anchor" id="id_adding_a_panel_to_a_selectable_dialog"></a> Adding a panel to a selectable dialog</h3><p>Add a service that advertises itself as a panel creator. Provide an implementation of the <a class="el" href="class_i_panel_creator.html">IPanelCreator</a> interface, and make a binding in ODFRez code to the dialog to which the panel should be added.<h3><a class="anchor" id="id_adding_buttons_to_a_dialog"></a> Adding buttons to a dialog</h3><p>Typically, when adding buttons to a dialog, you should ensure at least OK (or Done) and Cancel buttons are present. These type of buttons should use the widget boss classes named kDefaultButtonWidgetBoss and kDefaultCancelButtonWidgetBoss, bound to the ODFRez types named DefaultButtonWidget and DefaultCancelButtonWidget. The buttons should use the standard widget identifiers.<h3><a class="anchor" id="id_adding_a_check_box_to_a_panel"></a> Adding a check box to a panel</h3><p>Create a new boss class that extends the <a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a> boss class, and add an <a class="el" href="class_i_observer.html">IObserver</a> interface to this new boss class. When the widget is shown, the AutoAttach message gets sent; when hidden, AutoDetach.<h3><a class="anchor" id="id_adding_a_check_box_to_a_dialog"></a> Adding a check box to a dialog</h3><p>Add ODFRez data statements that use the ODFRez type named CheckBoxWidget. The client code attaches to the widget boss object on an AutoAttach message (when the dialog is shown) to the <a class="el" href="class_i_observer.html">IObserver</a> implementation, and detaches on AutoDetach (when the dialog is hidden). Helper methods in <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>, like as AttachToWidget, are useful for this process. The client code registers for notifications along the IID_ITRISTATECONTROLDATA protocol. When the check box is clicked, update messages are sent to this observer.<h3><a class="anchor" id="id_finding_out_when_a_dialog_repaints"></a> Finding out when a dialog repaints</h3><p>One way to discover when a dialog is being repainted is to subclass the <a class="el" href="class_i_control_view.html">IControlView</a> interface on a panel that covers the area of interest. On repainting, the <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> message is sent.<h2><a class="anchor" id="id_palettes_and_panels"></a> Palettes and panels</h2><p>A palette is an Adobe common user interface object, represented by a <a class="el" href="class_palette_ref.html">PaletteRef</a>, which serves as a container for panels. A panel is a container for widgets (see <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a>).<h3><a class="anchor" id="id_using_a_panel_widget"></a> Using a panel widget</h3><p>This section introduces some of the panel widgets in the InDesign API. There are two main distinctions for panel widgets:<ul><li>Those that can function as<li>&quot;root panels&quot; in a tabbed-palette widget.<li>Those intended to be general-purpose widget containers, but not necessarily the root panel in a floating palette.</ul><p>A generic panel widget (<a class="el" href="classk_generic_panel_widget_boss.html">kGenericPanelWidgetBoss</a>) is a general-purpose container and is used in many places within the application. For example, the character panel consists of a set of generic panel widgets, with separator widgets to draw the lines on the panel. The generic panel widget is used on panels like the paragraph panel, transform panel, tab panel, and library panel. The following table lists a selection of panel boss classes:<table class="doxtable"><tr><th>Widget boss class </th><th>ODFRez custom type </th><th>Description </th></tr><tr><td><a class="el" href="classk_cluster_panel_widget_boss.html">kClusterPanelWidgetBoss</a></td><td>ClusterPanelWidget </td><td>Grouping widget required for mutually exclusive behavior of radio buttons (or check boxes). It draws without a border. </td></tr><tr><td><a class="el" href="classk_control_strip_widget_boss.html">kControlStripWidgetBoss</a></td><td>ControlStripWidget </td><td>Basis of a control-strip panel. </td></tr><tr><td>kDetailKitPanelWidgetBoss </td><td>DetailKitPanelWidget </td><td>Used to provide your own PanelDetailController. </td></tr><tr><td><a class="el" href="classk_erasable_kit_panel_widget_boss.html">kErasableKitPanelWidgetBoss</a></td><td>ErasableKitPanelWidget </td><td>Top level kit. Erases before drawing. </td></tr><tr><td><a class="el" href="classk_erasable_primary_resource_panel_widget_boss.html">kErasablePrimaryResourcePanelWidgetBoss</a></td><td>ErasablePrimaryResourcePanelWidget </td><td>Used for a root panel in a palette, like the Links panel, that uses this rather than a PalettePanelWidget. </td></tr><tr><td><a class="el" href="classk_generic_panel_widget_boss.html">kGenericPanelWidgetBoss</a></td><td>GenericPanelWidget </td><td>Workhorse panel widget that can be used as a container for other widgets without border decoration. </td></tr><tr><td><a class="el" href="classk_group_panel_widget_boss.html">kGroupPanelWidgetBoss</a></td><td>GroupPanelWidget </td><td>Widget for enclosing a group, which draws a border with an optional title. </td></tr><tr><td><a class="el" href="classk_kit_panel_widget_boss.html">kKitPanelWidgetBoss</a></td><td>KitPanelWidget </td><td>Top level kit. Does not erase before drawing. </td></tr><tr><td><a class="el" href="classk_kit_view_horz_boss.html">kKitViewHorzBoss</a></td><td>KitViewHorzWidget </td><td>Container for kit views in the horizontal dock. </td></tr><tr><td><a class="el" href="classk_kit_view_tab_panel_boss.html">kKitViewTabPanelBoss</a></td><td>KitViewTabPanelWidget </td><td>Container for kit views in a standard tabbed palette. Best used if the view has one control set. </td></tr><tr><td><a class="el" href="classk_kit_view_tab_panel_with_detail_boss.html">kKitViewTabPanelWithDetailBoss</a></td><td>KitViewTabPanelWithDetailWidget </td><td>Container for kit views in a standard tabbed palette. Allows cycling widget to operate on control sets specified in the resource. </td></tr><tr><td><a class="el" href="classk_kit_view_vert_boss.html">kKitViewVertBoss</a></td><td>KitViewVertWidget </td><td>Container for kit views in the vertical dock. </td></tr><tr><td><a class="el" href="classk_palette_panel_widget_boss.html">kPalettePanelWidgetBoss</a></td><td>PalettePanelWidget </td><td>Used for the root panel in a tabbed palette. </td></tr><tr><td><a class="el" href="classk_panel_with_hilite_border_widget_boss.html">kPanelWithHiliteBorderWidgetBoss</a></td><td>PanelWithHiliteBorderWidget </td><td>Border-decorated panel. </td></tr><tr><td><a class="el" href="classk_panel_with_inverse_hilite_border_widget_boss.html">kPanelWithInverseHiliteBorderWidgetBoss</a></td><td>PanelWithInverseHiliteBorderWidget </td><td>Border-decorated panel. </td></tr><tr><td><a class="el" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a></td><td>PrimaryResourcePanelWidget </td><td>Used as a root panel in a tabbed palette. </td></tr></table><h3><a class="anchor" id="id_creating_a_panel_widget"></a> Creating a panel widget</h3><p>Panels are containers for widgets and/or groups of widgets. Some are suitable as a root panel, while others can be only general-purpose containers. The table in <a class="el" href="id_solutions.html#id_using_a_panel_widget">Using a panel widget</a> describes some capabilities and intended uses of panel boss classes.<p>The type definition for one of the key panel widgets is shown in the following example: <div class="fragment"><div class="line"><span class="comment">// From Widgets.fh, NOT for use in your resource</span></div><div class="line">type PrimaryResourcePanelWidget (kViewRsrcType) : Widget(<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a>){</div><div class="line"> ResourceSrcFileInfo;</div><div class="line"> CControlView;</div><div class="line"> CTextControlData;</div><div class="line"> CPanelControlData;</div><div class="line">};</div></div><p>An instance of the ODFRez data defining a widget of the same type is shown in this example: <div class="fragment"><div class="line">PrimaryResourcePanelWidget( <span class="comment">// ResourceSrcFileInfo properties</span></div><div class="line"> PlatformPMString, <span class="comment">// fFilename</span></div><div class="line"> longint, <span class="comment">// fLineno</span></div><div class="line"><span class="comment">// CControlView properties</span></div><div class="line"> kInvalidWidgetID, <span class="comment">// widget ID</span></div><div class="line"> kSysStaticTextPMRsrcId, <span class="comment">// PMRsrc ID</span></div><div class="line"> kBindNone, <span class="comment">// frame binding</span></div><div class="line"> Frame(0,0,85.0,25.0) <span class="comment">// (left, top, right, bottom)</span></div><div class="line"> kTrue, <span class="comment">// visible</span></div><div class="line"> kTrue, <span class="comment">// enabled</span></div><div class="line"><span class="comment">// CTextControlData properties</span></div><div class="line"> PlatformPMString, <span class="comment">// control label</span></div><div class="line"><span class="comment">// CPanelControlData properties</span></div><div class="line"> {</div><div class="line"><span class="comment">// Put your child widgets here.</span></div><div class="line"><span class="comment">// Note: CPanelControlData is defined in Widgets.fh</span></div><div class="line"> }),</div></div><h3><a class="anchor" id="id_creating_dynamic_panels"></a> Creating dynamic panels</h3><p>Panels can be created dynamically. The DynamicPanel SDK sample shows one mechanism to instantiate panels dynamically, and it creates an arbitrary sequence of panels that can be destroyed in the reverse order.<p>The general process for creating a dynamic panel is as follows:<ol type="1"><li>Create a panel object (<a class="el" href="class_i_control_view.html">IControlView</a>), using the <a class="el" href="class_rsrc_spec.html">RsrcSpec</a> defined in your .fr file.<li>Set up the panel&#39;s attributes, like widget ID and panel text string.<li>Call <a class="el" href="class_i_panel_mgr.html#ad235a9baeeacbd247e5342623fc8dcda">IPanelMgr::RegisterPanel</a> to put the panel in the new palette.<li>Add the panel action to Action Manager.</ol><h3><a class="anchor" id="id_showing_and_hiding_palettes_and_panels"></a> Showing and hiding palettes and panels</h3><p><a class="el" href="class_palette_ref_utils.html">PaletteRefUtils</a> provides the methods necessary to show and hide a palette using a <a class="el" href="class_palette_ref.html">PaletteRef</a>. IPanel manager provides methods to show and hide panels based on widget and action identifiers. When the last panel in a palette is hidden, the palette also is hidden. The <a class="el" href="class_snp_show_palette.html">SnpShowPalette</a> sample demonstrates these APIs.<p>To show and hide a palette:<ol type="1"><li>Query <a class="el" href="class_i_panel_mgr.html">IPanelMgr</a> (aggregated on <a class="el" href="classk_panel_manager_boss.html">kPanelManagerBoss</a>) directly from the application (<a class="el" href="class_i_application.html#a195e6f781190e6d6a21bbe58aa1d6626">IApplication::QueryPanelManager</a>, where <a class="el" href="class_i_application.html">IApplication</a> is available through GetExecutionContextSession()).<li>Use <a class="el" href="class_i_panel_mgr.html#ab378ba997b84c67e3908bafe42554447">IPanelMgr::GetPanelFromWidgetID</a> or IPanelMgr::GetPanelFromActionID to get to <a class="el" href="class_i_control_view.html">IControlView</a> of the panel.<li>Call <a class="el" href="class_i_panel_mgr.html#a388b448dfc9a1b60a37ca6979f1e1e6c">IPanelMgr::GetPaletteRefContainingPanel</a>, passing in the panel&#39;s <a class="el" href="class_i_control_view.html">IControlView</a>, to obtain the <a class="el" href="class_palette_ref.html">PaletteRef</a>.<li>Call <a class="el" href="class_palette_ref_utils.html#abede37da3eec2e28e6199fe14673585f">PaletteRefUtils::ShowHidePalette</a> with the <a class="el" href="class_palette_ref.html">PaletteRef</a> obtained from step 3 to show/hide the palette.</ol><p>To show/hide a panel:<ol type="1"><li>Query the <a class="el" href="class_i_panel_mgr.html">IPanelMgr</a> as described above for showing/hiding a palette.<li>Call <a class="el" href="class_i_panel_mgr.html#a5db42f39a7c86ab1041a3f6228de83af">IPanelMgr::ShowPanelByWidgetID</a> or <a class="el" href="class_i_panel_mgr.html#a07ae270d0b1ff320bbe5ee241266b98a">IPanelMgr::HidePanelByWidgetID</a> with the panel&#39;s widget ID.</ol><h3><a class="anchor" id="id_creating_a_control_strip"></a> Creating a control strip</h3><p>The control strip is a panel based on ControlStripWidget, which uses the new selection architecture to gather different sets of widgets into itself, based on the current selection. Existing widgets from other panels are relatively easy to add to the control strip; observers are taken care of automatically. New controls also can be added, but with much more effort.<p>The appearance of the control strip changes depending on document and selection state. This is shown in the following figure in a text-frame-selected state. <div class="image"><img alt="uiwidg-uiwidgetbasics-12.gif" src="uiwidg-uiwidgetbasics-12.gif" /></div><h3><a class="anchor" id="id_creating_kits"></a> Creating kits</h3><p>Kits are a form of dockable panel that collapses against the side of the workspace, as seen in the swatches panel. They are tab-selectable and open or collapse based on toggle-clicking the tab.<p>ErasableKitPanelWidget is the top-level kit. It erases before drawing. Most kits should use this. KitPanelWidget also is a top-level kit, but it does not erase before drawing. KitViewHorzWidget is the container for kit views that will be in the horizontal dock, and it also can be used for a tab-less floater view. KitViewVertWidget is the container for kit views that will be in the vertical dock, and it also can be used for a floater view without tabs.<p>KitViewTabPanelWidget is the container for kit views that will be in a standard tabbed palette. These are best used where the view has only one control set (especially a resizable one, since you must override the DetailController anyway). KitViewTabPanelWithDetailWidget is the deluxe container for kit views that will be in a standard tabbed palette. It is specialized to allow the cycling widget to operate on the specific control sets specified in resource, and it should be used most of the time.<p>The following figure shows a kit-view widget participating in a tabbed palette. The same widget also can participate in a horizontal or vertical dock situation. <div class="image"><img alt="uiwidg-uiwidgetbasics-13.gif" src="uiwidg-uiwidgetbasics-13.gif" /></div><h3><a class="anchor" id="id_creating_resizable_panels"></a> Creating resizable panels</h3><p>Many panels within the user interface, like the Links panel, can be resized. The typical mechanism to create a resizable panel is to attach a window size-box widget to the panel to be resized. The developer must ensure the panel knows how to respond correctly to resize events. In practice, the key method to be implemented is <a class="el" href="class_i_control_view.html#ad85b268f82a3a4b6ea81d4a9aab647b2">IControlView::ConstrainDimensions</a>. Resize events are generated automatically when the window size-box widget is activated by the end user. For an example of a resizable panel, see the SnippetRunner sample.<p>The following figure shows a resizable panel, the Paragraph Styles panel from the application. The end user can change the size with the window size box widget. <div class="image"><img alt="uiwidg-uiwidgetbasics-6.gif" src="uiwidg-uiwidgetbasics-6.gif" /></div><h3><a class="anchor" id="id_manipulating_panel_widgets"></a> Manipulating panel widgets</h3><p>Typically, panel widgets are defined in terms of their relationship with their children. The key data interface is <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a>, which allows access to their child widget hierarchy. Some widgets have a text label, accessible through <a class="el" href="class_i_text_control_data.html">ITextControlData</a>.<p>Navigation through the child widgets on a panel is facilitated by <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a>, the signature interface for a panel. The <a class="el" href="class_i_control_view.html">IControlView</a> interface for panel widgets manipulates the visual representation. Typically, this involves delegating to the children to ensure they draw after the panel widget has drawn itself and any decorations. The <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface allows the panel name to be set and queried.<h3><a class="anchor" id="id_iterating_over_a_panels_child_widgets"></a> Iterating over a panel&#39;s child widgets</h3><p>A panel is a container widget that supports <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a>. Given such an interface, it is necessary to call only GetWidget for the widget list of the panel control data; this navigates over the immediate children of a container, as follows: <div class="fragment"><div class="line"><span class="comment">// Assume panelControlData is valid ptr</span></div><div class="line"><span class="comment">// on a container widget boss object</span></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; panelControlData-&gt;Length(); i++){ </div><div class="line"><a class="code" href="class_i_control_view.html">IControlView</a>* nextWidget = panelControlData-&gt;GetWidget(i);</div><div class="line"> ASSERT(nextWidget); <span class="comment">// Go ahead and use nextWidget...</span></div><div class="line">}</div></div><p>To add new child widgets, given a pointer to an <a class="el" href="class_i_control_view.html">IControlView</a> on the child widget boss object, use <a class="el" href="class_i_panel_control_data.html#aa19d41b03b3541cbbb84ba9d3b8b44f0">IPanelControlData::AddWidget</a>.<h3><a class="anchor" id="id_finding_a_widget_in_the_panel_widget_hierarchy"></a> Finding a widget in the panel widget hierarchy</h3><p>The interface on the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> container widget boss class provides a mechanism to traverse the widget hierarchy in the direction of the leaves, to search for a widget by ID. Then you can use the <a class="el" href="class_i_panel_control_data.html#aa9dde6f0ce56f041ddcd08b4dbc86287">IPanelControlData::FindWidget</a> method to get an <a class="el" href="class_i_control_view.html">IControlView</a> pointer referring to that widget boss object.<h3><a class="anchor" id="id_grouping_widgets"></a> Grouping widgets</h3><p>A widget is contained within another widget when it is in the CPanelControlData list of the other widget. If the grouping widget is simply a frame, the ODFRez type GroupPanelWidget is appropriate. In the case of clustering of buttons, like radio buttons, check boxes, or other buttons that should be mutually exclusive, a ClusterPanelWidget is the correct type to use. This does not draw a frame, so a group panel widget is still required if a visible frame for the collection of widgets is required.<h3><a class="anchor" id="id_controlling_level_of_detail_on_panels"></a> Controlling level of detail on panels</h3><p>Many panels within the application show a feature of detail control, where either the set of widgets displayed or the physical properties of the widgets (like the height of rows in a tree view) change in response to a user gesture. This feature allows you to provide both a simplified user interface and a more elaborate interface for expert users. Alternatively, users may not always want to see the full range of configuration options, and this allows the widget set displayed in a panel to be varied by an end user. The SDK sample DetailControlListSize shows an example of varying tree-view row height.<p>The following figure shows the swatches panel at two different levels of detail. The <a class="el" href="class_i_panel_detail_controller.html">IPanelDetailController</a> interface can switch the level of detail. There are two implementations, for widget size and widget set composition. For a detail-controlled set of widgets, override <a class="el" href="class_i_control_view.html#ad85b268f82a3a4b6ea81d4a9aab647b2">IControlView::ConstrainDimensions</a>. This provides the correct behavior on resize of the detail-controlled panel, because changing the detail control level typically forces a resize when updating the panel.<p>This figure shows a detail-controlled panel, showing large and small rows: <div class="image"><img alt="uiwidg-uiwidgetbasics-5.gif" src="uiwidg-uiwidgetbasics-5.gif" /></div><h3><a class="anchor" id="id_varying_the_set_of_widgets_displayed_on_a_panel"></a> Varying the set of widgets displayed on a panel</h3><p>You must add an <a class="el" href="class_i_panel_detail_controller.html">IPanelDetailController</a> interface to a panel boss class that hosts the variable numbers of elements.<h3><a class="anchor" id="id_setting_the_minimum_size_for_a_resizable_panel"></a> Setting the minimum size for a resizable panel</h3><p>Override <a class="el" href="class_i_control_view.html#ad85b268f82a3a4b6ea81d4a9aab647b2">IControlView::ConstrainDimensions</a>, a resizable panel control view. The client code defines the upper and lower dimensions of the panel. See the SnippetRunner SDK sample.<h3><a class="anchor" id="id_using_widgets_on_panels"></a> Using widgets on panels</h3><p>Working with controls on panels is not as straightforward as with controls on dialogs. Two patterns can be used:<ul><li>Observe the changes directly for each control by adding an <a class="el" href="class_i_observer.html">IObserver</a> interface to the widget boss class of interest, and attaching to the widget to listen for changes. This requires creating many new boss classes and new ODFRez custom resource types, and it leads to code bloat. We recommended this only if you have a small number of widgets to observe.<li>Use the procedure described in the &quot;User Interface Fundamentals&quot; chapter of Adobe InDesign Programming Guide, in the section on &quot;Widget Observer Pattern.&quot; <a class="el" href="class_i_control_view_observers.html">IControlViewObservers</a> is useful for plug-in client code if you want to observe changes in the active context as well as widget-related changes. This is because you can add an observer interface for the active selection (CActiveSelectionObserver makes this easier) and one observer interface for all your widgets. This pattern is used widely throughout the InDesign code base for user interface plug-ins.</ul><h3><a class="anchor" id="id_adding_a_multiline_static_text_widget_to_a_panel"></a> Adding a multiline static text widget to a panel</h3><p>You can add a multiline static text widget to a panel and associate it with a scroll bar almost entirely with ODFRez data statements. The ODFRez custom resource type StaticMultiLineTextWidget or the ODFRez type DefinedBreakMultiLineTextWidget is associated with the ODFRez type ScrollBarWidget through widget identifiers. Unless you require notification of changes associated with the widgets, this suffices to create a multiline static text widget.<h3><a class="anchor" id="id_adding_a_text_edit_box_to_a_panel"></a> Adding a text edit box to a panel</h3><p>There are edit boxes that provide highly specialized behavior; for instance, edit boxes can be created with an associated nudge control that is specialized for the display of text measures (like points) or units (like degrees). If the edit box is being added to a dialog, it typically is necessary to use only the correct ODFRez type and manipulate the edit-box widget through the utility methods on the <a class="el" href="class_c_dialog_controller.html">CDialogController</a> and <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> helper classes.<p>In the case where the edit box is added to a panel, if update events associated with Return or Enter being pressed are required, a subclass of an existing edit-box widget boss class is required. This subclass exposes an <a class="el" href="class_i_observer.html">IObserver</a> interface. In addition, the associated ODFRez custom resource type is subclassed and bound to the new boss class.<h3><a class="anchor" id="id_adding_a_specialized_combo_box_to_a_panel"></a> Adding a specialized combo box to a panel</h3><p>Suppose you need to add a combo box that displays measurements in points. The correct procedure is to subclass the <a class="el" href="classk_text_measure_combo_box_widget_boss.html">kTextMeasureComboBoxWidgetBoss</a> API widget boss class to add an <a class="el" href="class_i_observer.html">IObserver</a> interface, and attach to the widget boss object in the AutoAttach method of the observer implementation. Similarly, there is a data statement in ODFRez in the localized framework resource file involving a subclass of the ODFRez custom resource type named TextMeasureComboBoxWidget.<p>The widget boss observer listens for changes along the IID_ITEXTCONTROLDATA protocol. You must subclass the combo box when adding it to a panel, to get notified of change. Be sure the name you choose for the ODFRez subclass contains the name of the superclass. For example, MyTextMeasureComboBoxWidget is an acceptable name; MyWidget is not.<h3><a class="anchor" id="id_overriding_the_default_draw_behavior_for_panels"></a> Overriding the default draw behavior for panels</h3><p>To create owner draw controls, override the <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> method; however, the implementations of <a class="el" href="class_i_control_view.html">IControlView</a> for the widgets in the widget set are complex, and the helper class CControlView provides only a minimal implementation. Usually, it is necessary to have the implementation header for the existing implementation (and its ancestors), and then subclass this implementation class.<p>For owner draw panels in the SDK, see the PanelTreeView and CustomDataLink SDK samples.<h3><a class="anchor" id="id_organizing_panels_with_workspace_extensions"></a> Organizing panels with workspace extensions</h3><p>InDesign saves data related to panel-geometry properties in workspace XML files. A variety of preconfigured workspace XML files are installed to InDesign&#39;s presets folder (&lt;appfolder&gt;/Presets/InDesign Workspaces/en_US/). The workspace files placed in that folder will appear as options in the Window &gt; Workspace menu. The default workspace is named Essentials, and it is also found in that menu. When InDesign starts up with no saved preferences, the Essentials workspace is used to arrange the palettes and menus in the workspace.<p>When a user creates a new workspace from the Window &gt; Workspace &gt; New Workspace... menu, a workspace file with the specified name is saved to the Workspaces folder within the user&#39;s InDesign preferences folder. If the user modifies the position or view of any panel, the workspace is updated and saved to a new file in the Workspaces preference folder. The new file&#39;s name is the currently selected workspace name with &quot;_CurrentWorkspace.xml&quot; appended. To save the applicat ion&#39;s state, InDesign does not alter the original workspace XML files.<p>In the default workspace, all third-party panels are grouped in one panel container, and the container is not visible at start-up. As a result, when InDesign is installed and run for the first time, third-party panels are not visible. When the user chooses to show a third-party panel, it is shown in the same panel container as other third-party panels. To override this default workspace behavior, you can add a workspace extension.<p>Essentially, a workspace extension is a workspace XML file located in a predetermined location, so InDesign reads the XML file at startup. The extension file contains the definition of the panel properties that you want to override in the default workspace. Extension files are loaded after the &quot;default&quot; workspace, but before the &quot;current&quot; workspace. This allows your extension to override default settings for your panel, but it preserves any workspace changes made by the user.<p><b>Generating a workspace extension</b><p>We recommend the following steps for generating your own workspace extension XML file:<ol type="1"><li>Remove the InDesign preferences folder. This ensures that changes made to the workspace extensions appear when InDesign is launched.<li>Launch InDesign with your plug-ins loaded, so your panels are available in the user interface.<li>Organize the panels as you want your user to see them for the first time.<li>Exit InDesign normally.<li>Locate the &quot;Essentials_CurrentWorkspace.xml&quot; file in the InDesign preferences folder. Duplicate the file and rename the duplicate to the name that you want to use for this workspace extension.<li>Distribute/Copy the workspace-extension XML file in the InDesign Workspace Extension folder (&lt;app folder&gt;/Presets/InDesign Workspaces/en_US/Workspace Extensions). If the &quot;Workspace Extensions&quot; folder does not exist, create it. The easiest way to distribute the workspace-extension XML file might be in the same installer used to install your plug-ins.</ol><dl class="section note"><dt>Note<dd>There also is an InCopy Workspaces folder, inside the Presets folder. It can be used to organize panels for InCopy.</dl><p>The following table explains the relevant objects in the hierarchy for panel arrangement.<table class="doxtable"><tr><th>Name </th><th>Workspace XML Tag </th><th>Description </th></tr><tr><td>Tab Palette </td><td>&lt;palette&gt; </td><td>The palette is the object the user perceives as a unit whose position and size can be controlled. Each tab palette contains an InDesign panel. </td></tr><tr><td>Tab Group </td><td>&lt;tab-group&gt; </td><td>A collection of one or more palettes. A tab group has at most one active palette. The active palette is the tab whose content is shown and whose tab is front-most. </td></tr><tr><td>Tab Pane </td><td>&lt;tab-pane&gt; </td><td>An anchored container for tab groups. </td></tr><tr><td>Dock </td><td>&lt;dock&gt; </td><td>A list of connected tab panes. </td></tr></table><p>The following figure shows a typical InDesign workspace, where toolbars and control bars are docked, and tab palettes are floating or docked. <div class="image"><img alt="solutions-4.gif" src="solutions-4.gif" /></div><p><b>SDK workspace extensions</b><p>The SDK contains sample workspace extension files, in &lt;SDK&gt;/presets/InDesign Workspaces/workspace extensions. To use a sample extension file:<ol type="1"><li>Delete the InDesign Preferences folder.<li>Copy the SDK sample workspace extension file to the InDesign Workspace Extension folder ( &lt;InDesignFolder&gt;/Presets/InDesign Workspaces/en_US/Workspace Extensions). If the &quot;Workspace Extensions&quot; folder does not exist, create it.<li>Start InDesign.</ol><dl class="section note"><dt>Note<dd>The sample workspace extension files require the InDesign SDK Sample Plug-ins.</dl><h2><a class="anchor" id="id_static_text_widgets"></a> Static text widgets</h2><h3><a class="anchor" id="id_using_a_static_text_widget"></a> Using a static text widget</h3><p>Static text widgets are widely used throughout the application, typically as labels on panels and dialogs. They can display longer runs of text and provide for a scrolling display over multiple lines of text, with or without specified line breaks. In the following figure, static text widgets are used as labels on both the panel widget that frames the combo boxes and the combo boxes. <div class="image"><img alt="uiwidg-uiwidgets-1.gif" src="uiwidg-uiwidgets-1.gif" /></div><p>Although static text widgets cannot be edited, it is possible to vary the appearance and text in response to user events.<p>There are text widgets provided by the API that also display large amounts of text that can be scrolled through. There also are fitted text widgets, which make sure the frame of the widget always allows text to be displayed with a fixed padding around the text, regardless of the font. There is another variant that allows the font to be both specified in the ODFRez data statements and, potentially, dynamically varied through a particular interface on the boss class.<p>The following table shows the widget boss classes for static text widgets and the types they bind to, along with sample use in the application.<p>Static Text Widget Boss Classes<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Use </th></tr><tr><td><a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a></td><td>StaticTextWidget </td><td>Displays a single line of static text. An example is on the Stroke panel, in the widget that displays Weight. </td></tr><tr><td>kFittedStaticTextWidgetBoss </td><td>FittedStaticTextWidget </td><td>Displays text that always fits inside its frame. Helpful where the full text always must be displayed. </td></tr><tr><td>kGroupPanelTitleTextWidgetBoss </td><td>GroupPanelTitleTextWidget </td><td>Renders text in theme color if WinXP theme is on. </td></tr><tr><td><a class="el" href="classk_info_static_text_widget_boss.html">kInfoStaticTextWidgetBoss</a></td><td>InfoStaticTextWidget </td><td>Displays text in a font that can be specified in the ODFRez data statements. Can be used where a bold font might be required. </td></tr><tr><td><a class="el" href="classk_info_static_text_angle_widget_boss.html">kInfoStaticTextAngleWidgetBoss</a></td><td>InfoStaticTextAngleWidget </td><td>Same as InfoStaticTextWidget, but validates degree entries. </td></tr><tr><td><a class="el" href="classk_info_static_text_int_widget_boss.html">kInfoStaticTextIntWidgetBoss</a></td><td>InfoStaticTextIntWidget </td><td>Same as InfoStaticTextWidget, but validates integer entries. </td></tr><tr><td><a class="el" href="classk_info_static_text_percentage_widget_boss.html">kInfoStaticTextPercentageWidgetBoss</a></td><td>InfoStaticTextPercentageWidget </td><td>Same as InfoStaticTextWidget, but validates percentage entries. </td></tr><tr><td><a class="el" href="classk_info_static_text_x_measurement_widget_boss.html">kInfoStaticTextXMeasurementWidgetBoss</a></td><td>InfoStaticTextXMeasurementWidget </td><td>Same as InfoStaticTextWidget, but validates X measurement entries. </td></tr><tr><td><a class="el" href="classk_info_static_text_y_measurement_widget_boss.html">kInfoStaticTextYMeasurementWidgetBoss</a></td><td>InfoStaticTextYMeasurementWidget </td><td>Same as InfoStaticTextWidget, but validates Y measurement entries. </td></tr><tr><td><a class="el" href="classk_static_multi_line_text_widget_boss.html">kStaticMultiLineTextWidgetBoss</a></td><td>StaticMultiLineTextWidget </td><td>Displays multiple lines of text. Typically used in conjunction with a scroll bar widget for viewing. </td></tr><tr><td><a class="el" href="classk_defined_break_multi_line_text_widget_boss.html">kDefinedBreakMultiLineTextWidgetBoss</a></td><td>DefinedBreakMultiLineTextWidget </td><td>Allows developers to specify a character sequence that will create line breaks in a block of text. Any occurrences of the specified character sequence in the input text is replaced by a line break in the edit control. </td></tr></table><h3><a class="anchor" id="id_creating_a_static_text_widget"></a> Creating a static text widget</h3><p>The ancestor of all static text widget boss classes is <a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a>. Text widgets using <a class="el" href="classk_info_static_text_widget_boss.html">kInfoStaticTextWidgetBoss</a> can have a variable font displayed. Text widgets using kFittedStaticTextWidgetBoss have a frame that is fitted to the size of the string in the font to display, with a specified padding. There also are two multi-line static text widgets, <a class="el" href="classk_static_multi_line_text_widget_boss.html">kStaticMultiLineTextWidgetBoss</a> for the basic multiline widget, and <a class="el" href="classk_defined_break_multi_line_text_widget_boss.html">kDefinedBreakMultiLineTextWidgetBoss</a> for the type that accepts predefined line breaks.<p>Fitted static text widgets resize their frame to try to fit the text in the current drawing font with the specified padding. The kFittedStaticTextWidgetBoss boss class does not add any new interfaces compared with <a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a>. It overrides the implementation of the <a class="el" href="class_i_control_view.html">IControlView</a> interface only to ensure the text fits when drawn.<p>The principal collaboration of interest is between the multi-line text widget types and the scroll-bar widget type, <a class="el" href="classk_scroll_bar_widget_boss.html">kScrollBarWidgetBoss</a>. An association is established in the ODFRez between the multi-line text widgets and a scroll bar that is responsible for adjusting the views of the text drawn.<p>The ODFRez custom type associated with the <a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a> class is StaticTextWidget. The following example shows the type definition, which is found in Widgets.fh: <div class="fragment"><div class="line"><span class="comment">// From Widgets.fh, NOT for use in your resource</span></div><div class="line">type StaticTextWidget (kViewRsrcType) : Widget (<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a>) { </div><div class="line"> CControlView; </div><div class="line"> StaticTextAttributes; </div><div class="line"> CTextControlData; </div><div class="line"> AssociatedWidgetAttributes; </div><div class="line">}; </div></div><p>The following example shows a sample data definition for a static text widget: <div class="fragment"><div class="line"><span class="comment">// Sample data definition for widget</span></div><div class="line">StaticTextWidget ( <span class="comment">// CControlView properties </span></div><div class="line"> kInvalidWidgetID, <span class="comment">// widget ID</span></div><div class="line"> kSysStaticTextPMRsrcId, <span class="comment">// PMRsrc ID </span></div><div class="line"> kBindNone, <span class="comment">// frame binding </span></div><div class="line"> Frame(5.0,5.0,85.0,25.0) <span class="comment">// left, top, right, bottom</span></div><div class="line"> kTrue, <span class="comment">// visible </span></div><div class="line"> kTrue, <span class="comment">// enabled </span></div><div class="line"><span class="comment">// StaticTextAttributes properties </span></div><div class="line"> kAlignLeft, <span class="comment">// Alignment </span></div><div class="line"> kDontEllipsize, <span class="comment">// Ellipsize style </span></div><div class="line"><span class="comment">// CTextControlData properties </span></div><div class="line"><span class="stringliteral">&quot;&quot;</span>, <span class="comment">// control label </span></div><div class="line"><span class="comment">// AssociatedWidgetAttributes properties </span></div><div class="line"> kInvalidWidgetID, <span class="comment">// associated widget ID </span></div><div class="line">),</div></div><h3><a class="anchor" id="id_manipulating_a_static_text_widget"></a> Manipulating a static text widget</h3><p>This control encapsulates data of type <a class="el" href="class_p_m_string.html">PMString</a>. The text for a static text widget is initialized through the <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface, using the SetString method. The initial value is defined in a key-value pair in the StringTable for each locale of interest, where the key is placed in the CTextControlData field in the ODFRez data statement.<p>The <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface stores the state of the label on the static text widget. <a class="el" href="class_i_static_multi_line_text_attr.html">IStaticMultiLineTextAttr</a> finds the associated scroll bar widget to scroll a multi-line text widget. Once a reference to the scroll bar widget is obtained (use IControlView::FindWidget), query for its <a class="el" href="class_i_counter_control_data.html">ICounterControlData</a>, and use the methods on this interface to control the view.<h3><a class="anchor" id="id_changing_the_font_of_a_static_text_widget"></a> Changing the font of a static text widget</h3><p>Use the info-static text widget (kInfoStaticTextWidget), which is bound to the ODFRez type named InfoStaticTextWidget. The initial font the widget uses is defined in ODFRez data statements, and the font displayed can be changed through the <a class="el" href="class_i_u_i_font_spec.html">IUIFontSpec</a> interface on the widget boss object.<h2><a class="anchor" id="id_check_boxes_and_radio_buttons"></a> Check boxes and radio buttons</h2><h3><a class="anchor" id="id_using_check_boxes_and_radio_buttons"></a> Using check boxes and radio buttons</h3><p>The API provides check-box buttons (<a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a>) and radio buttons (<a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a>) that operate like the equivalent platform controls. There also are fitted versions of the check boxes and radio buttons provided by the API; these have the additional feature that the button and associated text always fit within the frame, subject to a padding around the boundary. Radio button and check boxes are tri-state controls, and they aggregate an <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a> interface to represent their state.<p>The following figure shows a pair of radio buttons and a pair of check boxes. The cluster panel widget that owns the radio button widgets is not shown, but it has a bounding box that contains the radio buttons it owns. <div class="image"><img alt="uiwidg-uiwidgets-2.gif" src="uiwidg-uiwidgets-2.gif" /></div><p>Radio buttons that operate as a logical unit should be contained within a cluster panel widget (<a class="el" href="classk_cluster_panel_widget_boss.html">kClusterPanelWidgetBoss</a>), which has a bounding box that contains the union of their individual frames. Use the ClusterPanelWidget ODFRez type as an immediate parent.<p>The ODFRez custom resource type CheckBoxWidget is bound to the <a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a> boss class. The ODFRez custom resource type RadioButtonWidget is bound to the <a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a> boss class.<p>Check box and radio button widgets provided by the API are shown in the following table.<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type Associated </th><th>Use </th></tr><tr><td><a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a></td><td>RadioButtonWidget </td><td>Displays a mutually exclusive set of choices, in conjunction with a cluster panel widget. </td></tr><tr><td>kFittedRadioButtonWidgetBoss </td><td>FittedRadioButtonWidget </td><td>A radio button that always fits within its frame. </td></tr><tr><td><a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a></td><td>CheckBoxWidget </td><td>A standard check box. </td></tr><tr><td>kFittedCheckBoxWidgetBoss </td><td>FittedCheckBoxWidget </td><td>Check box that fits within frame, as frame resizes, with padding. </td></tr></table><h3><a class="anchor" id="id_creating_check_boxes_and_radio_buttons"></a> Creating check boxes and radio buttons</h3><p>The check box (<a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a>) and radio button (<a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a>) aggregate similar sets of interfaces. The fitted variants have the same interface profile, typically just replacing the <a class="el" href="class_i_control_view.html">IControlView</a> implementation with one that draws the fitted text label. The interfaces aggregated are shown in the SDK online documentation. The ODFRez type expressions is in Widgets.fh.<p>The following example shows the type expression for the ODFRez type RadioButtonWidget. It comprises the ODFRez type CControlView (bound to <a class="el" href="class_i_control_view.html">IControlView</a>) and the ODFrez type CTextControlData, bound to <a class="el" href="class_i_text_control_data.html">ITextControlData</a>, which represents the label. <div class="fragment"><div class="line"><span class="comment">// From Widgets.fh, NOT for use in your resource</span></div><div class="line">type RadioButtonWidget (kViewRsrcType) : Widget (<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a>) {</div><div class="line"> CControlView; </div><div class="line"> CTextControlData; </div><div class="line">}; </div></div><p>The following example shows a radio button widget being defined in ODFRez data statements: <div class="fragment"><div class="line">RadioButtonWidget ( <span class="comment">// CControlView properties </span></div><div class="line"> kInvalidWidgetID, <span class="comment">// widget ID </span></div><div class="line"> kSysRadioButtonPMRsrcId, <span class="comment">// PMRsrc ID </span></div><div class="line"> kBindNone, <span class="comment">// frame binding </span></div><div class="line"> Frame(5.0,5.0,100.0,21.0) <span class="comment">// (left, top, right, bottom) </span></div><div class="line"> kTrue, <span class="comment">// visible </span></div><div class="line"> kTrue, <span class="comment">// enabled </span></div><div class="line"><span class="comment">// CTextControlData properties </span></div><div class="line"><span class="stringliteral">&#39;&#39;</span>, <span class="comment">// control label string key would go here </span></div><div class="line">),</div></div><h3><a class="anchor" id="id_manipulating_check_boxes_and_radio_buttons"></a> Manipulating check boxes and radio buttons</h3><p>Check boxes and radio buttons have a data interface, <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a>, to access their state. Check boxes and radio buttons are said to be tristate. The states are defined in an enumeration in the scope of the definition of <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a>. The states a tristate control can be in are unselected, selected and unknown (or mixed). The state of these tristate controls can be queried and set through the interface.<h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>The data model for <a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a> and <a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a> is tri-state and can be in one of following states: selected, unselected, or mixed. It is represented by the value stored on the <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a> of the given widget boss object.<p>When the state of controls, like <a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a> and <a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a>, changes, notification is sent along the IID_ITRISTATECONTROLDATA protocol. The following messages are sent when the data model changes: <div class="fragment"><div class="line">{ kTrueStateMessage, kFalseStateMessage, kUnknownStateMessage }</div></div><p>Messages are sent along the IID_ITRISTATECONTROLDATA protocol. To receive notification of these changes, attach an observer to the button. If your controls are on a dialog, an implementation derived from <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> makes it straightforward to attach and detach from the widget of interest. The API on <a class="el" href="class_i_dialog_controller.html">IDialogController</a> also makes it easy to initialize the state of the check boxes or radio buttons.<dl class="section note"><dt>Note<dd>It is worth setting the doNotify flag on the calls to change the state to be kFalse. This avoids triggering unwanted <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> messages to one&#39;s own observer that are brought about by your own code rather than end user events.</dl><h3><a class="anchor" id="id_ensuring_radio_buttons_in_a_group_have_mutually_exclusive_behavior"></a> Ensuring radio buttons in a group have mutually exclusive behavior</h3><p>Use a cluster panel widget. For example, for a radio button to interoperate with other radio buttons and ensure mutually exclusive selection, a collection of widgets of ODFRez type RadioButtonWidget are defined as children of an ODFRez ClusterPanelWidget.<p>This enforces mutually exclusive behavior among a group of widgets (not only radio buttons) that expose <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> or <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a> interfaces.<h2><a class="anchor" id="id_button_widgets"></a> Button widgets</h2><h3><a class="anchor" id="id_using_a_button_widget"></a> Using a button widget</h3><p>This section describes some button widgets available in the API. We focus on <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> and its descendants. Iconic buttons are discussed in <a class="el" href="id_solutions.html#id_image_widgets">Image widgets</a>.<p>There is a nudge control widget (<a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a>), which is a composite of two button-like widgets and is discussed briefly in this section. It is used in conjunction with edit boxes and combo boxes to provide the capability to nudge values up or down.<p>Buttons are used in many dialogs within the application. We do not recommend using the standard button (<a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a>) or its descendants on palette panels. Instead, use iconic buttons on palette panels, to conform with the application&#39;s look and feel. Buttons that derive behavior from <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> or a descendant of this boss class are bi-state controls.<p>The following figure shows a selection of button widgets. OK and Cancel buttons are on all dialogs. Whether other buttons are present depends on the requirements for the dialog. The enabling state of the buttons is set up initially by the dialog controller and can be modified by the dialog observer depending on the actions of the end user. <div class="image"><img alt="uiwidg-uiwidgets-3.gif" src="uiwidg-uiwidgets-3.gif" /></div><p>A default button is one that has keyboard focus by default. If the user pressed Return, the default button&#39;s event handler processes the event, and an observer on the default button receives an <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message. <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> and an ODFRez type DefaultButtonWidget can be used if the default button is OK or Done-the button that allows an end user to confirm they accept their choices. The default button need not be OK or Done; it also can be Cancel (<a class="el" href="classk_cancel_button_widget_boss.html">kCancelButtonWidgetBoss</a>).<p>The following table lists button widget boss classes.<table class="doxtable"><tr><th>Widget boss class </th><th>ODFRez type </th><th>Use </th></tr><tr><td><a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a></td><td>ButtonWidget </td><td>Used for any buttons on a panel or dialog. </td></tr><tr><td><a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a></td><td>DefaultButtonWidget </td><td>Represents the OK button on a dialog. Selected when the dialog appears. </td></tr><tr><td><a class="el" href="classk_cancel_button_widget_boss.html">kCancelButtonWidgetBoss</a></td><td>CancelButtonWidget </td><td>Used for a Cancel button on dialog. </td></tr><tr><td><a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a></td><td>NudgeControlWidget </td><td>Wraps a nudge-up and a nudge-down button. Used with edit boxes and combo boxes. </td></tr></table><h3><a class="anchor" id="id_creating_a_button_widget"></a> Creating a button widget</h3><p>See the SDK online documentation for <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> and its descendants, to see the interfaces aggregated by button widgets, as well as some descendants of <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> in the required plug-in set.<p>The <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> class, in addition to taking the focus when a dialog appears, provides behavior to dismiss a dialog with an affirmation that the action should be executed or the commitments are completed. This class provides the behavior behind the button with a label like OK or Done that is intended to dismiss the dialog when it is pressed. <a class="el" href="classk_cancel_button_widget_boss.html">kCancelButtonWidgetBoss</a> is its counterpart and provides behavior behind a standard Cancel button on a dialog.<p>Nudge buttons collaborate with edit boxes and combo boxes to allow incremental changes in the control data model. The association is created by referencing a nudge button by widget ID in the definition of the edit box and combo box. Both these types of widgets have an ancestor responsible for dealing with any associated nudge buttons.<p>The ODFRez custom resource type corresponding to <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> is ButtonWidget or DefaultButtonWidget. The CTextControlData field specifies the label on the button. The type expression for ButtonWidget is shown in the following example. <div class="fragment"><div class="line"><span class="comment">// From Widgets.fh, NOT for use in your resource</span></div><div class="line">type ButtonWidget (kViewRsrcType) : Widget (<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_button_widget_boss.html">kButtonWidgetBoss</a>) {</div><div class="line"> CControlView; </div><div class="line"> ButtonAttributes; </div><div class="line"> CTextControlData; </div><div class="line">};</div></div><p>The following example shows ODFRez data statements defining a button widget. Because the ODFRez type ButtonWidget is not subclassed, changes in the data model of this control are handled by the dialog observer rather than an observer for the individual button widget. <div class="fragment"><div class="line">Sample Button WidgetButtonWidget ( <span class="comment">// CControlView properties </span></div><div class="line"> kInvalidWidgetID, <span class="comment">// widget ID </span></div><div class="line"> kSysButtonPMRsrcId, <span class="comment">// PMRsrc ID </span></div><div class="line"> kBindNone, <span class="comment">// frame binding </span></div><div class="line"> Frame(5.0,5.0,100.0,25.0) <span class="comment">// (left, top, right, bottom) </span></div><div class="line"> kTrue, <span class="comment">// visible </span></div><div class="line"> kTrue, <span class="comment">// enabled </span></div><div class="line"><span class="comment">// ButtonAttributes</span></div><div class="line"> kTrue, <span class="comment">// default look true</span></div><div class="line"><span class="comment">// CTextControlData properties </span></div><div class="line"><span class="stringliteral">&#39;&#39;</span>, <span class="comment">// control label (string key) goes here </span></div><div class="line">),</div></div><h3><a class="anchor" id="id_manipulating_button_widgets"></a> Manipulating button widgets</h3><p><a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> and <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a> are the key interfaces in working with button widgets. The <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> interface provides access to the data model of bi-state buttons. A boolean control like a standard button can be in one of two states, selected or unselected. The state is set through the <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> interface. Update messages are sent along the IID_IBOOLEANCONTROLDATA protocol.<p>For the bi-state buttons, it is possible to change the state and suppress the notification by calling the mutators with the notifyOfChange parameter set to kFalse.<p>The <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface allows you to set button labels. The boss classes share the default implementation used by many of the controls.<h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>The data model for <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> and its descendants is a boolean, so these are bi-state controls. Their state is represented by the value stored on their <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> interface, and they notify of changes in this state along the default identifier for this interface, IID_IBOOLEANCONTROLDATA.<p>The button widget boss classes aggregate I&lt;whatever&gt;ControlData interfaces to allow the state to be queried and set. Usually, this results in a message being sent to attached observers that the control state has changed. It also is possible to set the state but suppress the notification about the change, to prevent observers from performing inappropriate updates when the state is set. In other words, the control change can be muted. This is done by setting the notifyOfChange to be kFalse in the mutator methods on these interfaces. This approach can be used when an observer listening for a notification on one or more controls wants to set up the state of a control it is observing, without receiving another notification about the state change. It is important not to be confused about how these controls work; typically the change parameter is expressed as a message identifier, rather than something more identifiable as a ClassID.<p>When the state of the controls that descend from <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> changes, notifications are sent along the IID_IBOOLEANCONTROLDATA protocol. Additional information is sent via the ClassID. To receive notification about the state change caused by a button press, attach to the button widget boss object&#39;s <a class="el" href="class_i_subject.html">ISubject</a> interface, and listen along the IID_IBOOLEANCONTROLDATA protocol.<h3><a class="anchor" id="id_user_interface_guidelines"></a> User interface guidelines</h3><p>The user interface guidelines recommend the widget should be 20 pixels high and a multiple of 5 pixels wide.<dl class="section note"><dt>Note<dd>InDesign does not use standard button widgets (other than iconic varieties) on panels, and we recommend you not put standard button widgets on panels; use the iconic varieties instead.</dl><h3><a class="anchor" id="id_using_buttons_on_dialogs"></a> Using buttons on dialogs</h3><p>Where controls are placed on a dialog, client code can use the helper partial implementation class <a class="el" href="class_c_dialog_controller.html">CDialogController</a> and specialize or implement the appropriate methods. <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> typically implements an <a class="el" href="class_i_observer.html">IObserver</a>. The <a class="el" href="class_i_dialog_controller.html">IDialogController</a> interface has utility methods relevant to working with button widgets that set the initial state.<p>We recommend the <a class="el" href="class_i_observer.html">IObserver</a> interface be added to the dialog boss object with the superclass <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>, which provides helper methods like AttachToWidget() and DetachFromWidget(). These methods simplify the process of attaching to or detaching from a widget.<p>When a button is pressed, an <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message is sent through the <a class="el" href="class_i_observer.html">IObserver</a> interface on the dialog boss object. Check the classID of the change to determine whether it is a kTrueStateMessage.<h2><a class="anchor" id="id_edit_boxes"></a> Edit boxes</h2><h3><a class="anchor" id="id_using_an_edit-box_widget"></a> Using an edit-box widget</h3><p>Edit boxes are displays of information that can be edited. In the application, they allow an end user to enter a value. The value can be constrained to be an integer or to be expressed in specific units, like picas, points, or degrees.<p>Edit boxes often are used with nudge button controls. The nudge button control provides precise, incremental control over the contents of edit boxes, particularly when control over parameters in layout-specific units is a requirement. This close coupling between the nudge and edit controls helps explain, in part, why the edit box boss classes descend from the <a class="el" href="classk_nudge_edit_box_widget_boss.html">kNudgeEditBoxWidgetBoss</a> boss class.<p>The treatment of edit boxes is slightly different when they are used in dialogs rather than panels. In panels, typically a new boss class is created that derives from one of the &lt;variant&gt;EditBoxWidgetBoss classes, and it exposes an <a class="el" href="class_i_observer.html">IObserver</a> interface implemented in client code. This interface receives notifications of changes in the text edit box data model. If the specific ODFRez field controlling this property is kTrue, an observer attached to a particular control is notified on every keystroke. The following table lists a selection of the edit-box-related boss classes.<table class="doxtable"><tr><th>Widget boss class </th><th>ODFRez custom type </th><th>Use </th></tr><tr><td><a class="el" href="classk_text_edit_box_widget_boss.html">kTextEditBoxWidgetBoss</a></td><td>TextEditBoxWidget </td><td>Displays values that are strictly textual, or where you want to parse a value in your own code. </td></tr><tr><td><a class="el" href="classk_angle_edit_box_widget_boss.html">kAngleEditBoxWidgetBoss</a></td><td>AngleEditBoxWidget </td><td>Displays values in angular units. See the Rotation dialog. </td></tr><tr><td><a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a></td><td>IntEditBoxWidget </td><td>Displays integer values. See the Page Setup dialog. </td></tr><tr><td><a class="el" href="classk_real_edit_box_widget_boss.html">kRealEditBoxWidgetBoss</a></td><td>RealEditBoxWidget </td><td>Displays floating point values. See the Scale dialog. </td></tr><tr><td><a class="el" href="classk_percentage_edit_box_widget_boss.html">kPercentageEditBoxWidgetBoss</a></td><td>PercentageEditBoxWidget </td><td>Displays values in percentage units. See the Scale dialog. </td></tr><tr><td><a class="el" href="classk_text_measure_edit_box_widget_boss.html">kTextMeasureEditBoxWidgetBoss</a></td><td>TextMeasureEditBoxWidget </td><td>Displays values in the current text measurement units. See the Character panel (line weight element). </td></tr><tr><td><a class="el" href="classk_line_wt_measure_edit_box_widget_boss.html">kLineWtMeasureEditBoxWidgetBoss</a></td><td>LineWtMeasureEditBoxWidget </td><td>Displays values in line weight units. See the Stroke panel, when the Dashed line type is selected. </td></tr><tr><td><a class="el" href="classk_x_measure_edit_box_widget_boss.html">kXMeasureEditBoxWidgetBoss</a></td><td>XMeasureEditBoxWidget </td><td>Displays values in current horizontal measurement units. </td></tr><tr><td><a class="el" href="classk_y_measure_edit_box_widget_boss.html">kYMeasureEditBoxWidgetBoss</a></td><td>YMeasureEditBoxWidget </td><td>Displays values in current vertical measurement units. </td></tr></table><h3><a class="anchor" id="id_creating_an_edit-box_widget"></a> Creating an edit-box widget</h3><p>The main responsibility of the edit-box widget boss classes is to provide for managed input and display of text strings and unit-specific values. Unit-specific variants remove the responsibility for parsing the input strings from the developer. Similarly, the client-code developer does not need to format the output strings when using unit-specific edit boxes. The edit-box widget boss classes also provide for validation of data entry, which is conditional on settings in the ODFRez data statements.<p>The principal collaboration is with the <a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a> class, which provides the behavior for nudge controls used to bump values up and down by small increments. The mapping between an edit box and a nudge control is established through the ODFRez data statement for an edit box; no code needs to be written to enforce this collaboration.<p>The main point about the class hierarchy of the edit-box widget bosses is that there is a common ancestor for all edit boxes, which is a nudge edit-box widget boss class (<a class="el" href="classk_nudge_edit_box_widget_boss.html">kNudgeEditBoxWidgetBoss</a>). There also are specialized edit boxes that work in units like degrees, percent, real, or integer values, or in measurements like line weight, text, and the measurement unit currently in force in the horizontal or vertical direction.<dl class="section note"><dt>Note<dd>Treat the kNudgeEditBoxWidgetboss boss class as if it were an abstract type and not used directly.</dl><p>There are ODFRez custom resource types that map directly onto each of these boss classes, with the usual naming convention that k&lt;variant&gt;EditBoxWidgetBoss has a related ODFRez custom resource type named &lt;variant&gt;EditBoxWidget. The following example shows ODFRez data statements defining an edit-box widget. <div class="fragment"><div class="line">IntEditBoxWidget ( <span class="comment">// CControlView properties </span></div><div class="line"> kInvalidWidgetID, <span class="comment">// widget ID </span></div><div class="line"> kSysEditBoxPMRsrcId, <span class="comment">// PMRsrc ID </span></div><div class="line"> kBindNone, <span class="comment">// frame binding </span></div><div class="line"> Frame(4.0,5.0,84.0,25.0) <span class="comment">// left, top, right, bottom </span></div><div class="line"> kTrue, <span class="comment">// visible </span></div><div class="line"> kTrue, <span class="comment">// enabled </span></div><div class="line"><span class="comment">// CEditBoxAttributes </span></div><div class="line"> 0, <span class="comment">// nudgeWidgetId (0 or kInvalidWidgetID if no nudge needed) </span></div><div class="line"> 1, <span class="comment">// small nudge amount </span></div><div class="line"> 5, <span class="comment">// large nudge amount </span></div><div class="line"> 0, <span class="comment">// max num chars </span></div><div class="line"> kFalse, <span class="comment">// read only flag </span></div><div class="line"> kFalse, <span class="comment">// should notify on each key stroke </span></div><div class="line"><span class="comment">// TextDataValidation properties </span></div><div class="line"> kTrue, <span class="comment">// range checking enabled </span></div><div class="line"> kFalse, <span class="comment">// blank entry allowed </span></div><div class="line"> 30, <span class="comment">// upper limit </span></div><div class="line"> 0, <span class="comment">// lower limit </span></div><div class="line"><span class="comment">// CTextControlData properties </span></div><div class="line"><span class="stringliteral">&quot;3&quot;</span>, <span class="comment">// control label </span></div><div class="line">),</div></div><p>All edit boxes share the same ODFRez custom resource types in their composition as the IntEditBoxWidget. The notable exception is the FontSpecTextEditBoxWidget type, which adds another ODFRez field of UIFontSpec type.<h3><a class="anchor" id="id_manipulating_edit_boxes"></a> Manipulating edit boxes</h3><p>The <a class="el" href="classk_nudge_edit_box_widget_boss.html">kNudgeEditBoxWidgetBoss</a> boss class aggregates interfaces like <a class="el" href="class_i_text_control_data.html">ITextControlData</a>, <a class="el" href="class_i_cursor_region.html">ICursorRegion</a>, INudgeObserver, and <a class="el" href="class_i_edit_box_attributes.html">IEditBoxAttributes</a>, along with other key interfaces like <a class="el" href="class_i_control_view.html">IControlView</a> and <a class="el" href="class_i_event_handler.html">IEventHandler</a>. <a class="el" href="class_i_text_value.html">ITextValue</a> queries and sets the value for any unit-specific edit-box widgets. <a class="el" href="class_i_text_value.html">ITextValue</a> accesses the data model of unit-specific edit boxes without having to parse the input string or format the output string. It allows a unit-specific value to be set or queried in an edit box.<p><a class="el" href="class_i_text_control_data.html">ITextControlData</a> is used for untyped edit-box widgets, like the widget with behavior provided by <a class="el" href="classk_text_edit_box_widget_boss.html">kTextEditBoxWidgetBoss</a>. The implementation of <a class="el" href="class_i_cursor_region.html">ICursorRegion</a> determines how or whether the cursor changes when it enters an edit box.<h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>Attaching an observer to a subclass of an edit-box widget boss class provides for notification about changes when the end user presses Return or Enter within the edit control. It also is possible to get notification about every keystroke, by setting a flag in the ODFRez data statement associated with the edit-box definition. For examples, see any sample that uses an edit box.<p>An edit-box widget boss class has a data model that typically consists of a string, which is accessed through the <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface aggregated by the particular edit-box widget boss class. The <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface provides controlled access to the control&#39;s data model for simple text strings. This is appropriate for boss classes like <a class="el" href="classk_text_edit_box_widget_boss.html">kTextEditBoxWidgetBoss</a>. For unit-specialized edit boxes, the key interface to get and set values is <a class="el" href="class_i_text_value.html">ITextValue</a>. This enables access to the measurement data in points, regardless of what measurement is being displayed. This eliminates the need to parse the string read back from the control or format the data for the control when setting a value.<p>When the data model changes, registered observers are sent an update message with class ID kTextChangeStateMessage along the IID_ITEXTCONTROLDATA protocol. For an observer on a unit-specific edit box, the client code in the update message should query for the <a class="el" href="class_i_text_value.html">ITextValue</a> interface and call the GetTextAsValue method to determine the state of the edit box data model.<p>The most basic use of an edit box is in conjunction with a dialog. In this case, the value of the edit box can be queried only when the dialog is dismissed or the preview check box is selected, in the case of dialogs that allow preview. When the edit box is used on a panel, it is more practical to attach an observer to the edit control. The observer receives an update message when the content of the edit control changes; all keystrokes within the control result in a notification being sent to registered observers.<p>The simplest case to consider is when the edit box is attached to a dialog. If the dialog is implemented as recommended, using the <a class="el" href="class_c_dialog_controller.html">CDialogController</a> and <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> helper classes, setting and getting values from the text control is particularly simple. The application framework sends a sequence of messages to the dialog controller in this order:<ul><li>InitializeDialogFields()<li>ValidateDialogFields()<li>ApplyDialogFields()</ul><p>This sequence of messages is referred to as the dialog protocol. In the case of the layer options dialog described previously, when the InitializeDialogFields message is sent to the dialog controller, the edit box is set up with an initial value through the <a class="el" href="class_c_dialog_controller.html#a34fd0d1d04f198de5ff3b9f04dd31010">CDialogController::SetTextControlData</a> method. When the user presses OK, the dialog controller is sent a ValidateDialogFields message by the application framework; if this returns kDefaultWidgetId, an ApplyDialogFields message is sent.<h3><a class="anchor" id="id_user_interface_guidelines"></a> User interface guidelines</h3><p>Adobe user interface guidelines specify that buttons should be 20 pixels high and a multiple of 5 pixels wide.<h2><a class="anchor" id="id_image_widgets"></a> Image widgets</h2><h3><a class="anchor" id="id_using_an_image_widget"></a> Using an image widget</h3><p>This section describes widgets used to display images, including icons. These widgets also can have button-like functionality. Image-based widgets are found throughout the application. There are many image-widget boss classes, but few are relevant when writing client code.<p>There are several icon and picture widgets in the API. Which widget to use depends on whether an icon resource has enough image information or a bitmap or PICT image is required. In either case, a platform-specific resource must be created to hold the image and a binding must be made in ODFRez data statements. If icon resources are sufficient and no button-like behavior is required, the ODFRez type IconSuiteWidget can be used. If a bitmap or PICT image is necessary, the ODFRez type PictureWidget is appropriate. See the PictureIcon SDK sample.<p>A good example is the Layers panel, which changes the image associated with the eyeball icon depending on whether the layer is visible. The key is to acquire an <a class="el" href="class_i_control_view.html">IControlView</a> interface pointer from an image-widget boss object and call SetRsrcID on this interface to change the picture.<p>Some of the widget boss classes shown in the following table do not respond to button clicks. Others are described here as pseudo buttons, to differentiate them from the boss classes that descend from <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a>; however, they still respond to clicks and aggregate an <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> interface. If you have a more complex requirement, like creating an image preview in a widget, the PanelTreeView SDK sample shows how to use a custom control view for a panel rather than an existing image-based widget.<p>To simplify the domain, client code should be able to perform most tasks using the following few widgets:<ul><li><a class="el" href="classk_icon_suite_widget_boss.html">kIconSuiteWidgetBoss</a>, with its counterpart ODFRez IconSuiteWidget (for icons on panels and dialogs). See the PictureIcon SDK sample plug-in.<li>kPictureWidgetBoss, and its counterpart ODFRez PictureWidget (for bitmap/PICT based widgets). See the PictureIcon SDK sample plug-in.<li>Subclassing the <a class="el" href="classk_roll_over_icon_button_boss.html">kRollOverIconButtonBoss</a> and one of the several ODFRez types to which it is bound (depending on your specific requirements). All SDK samples that have an About icon use this button.</ul><table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Description </th></tr><tr><td><a class="el" href="classk_chain_button_boss.html">kChainButtonBoss</a></td><td>ChainButtonWidget </td><td>Used for the constrain proportions button. </td></tr><tr><td><a class="el" href="classk_icon_field_widget_boss.html">kIconFieldWidgetBoss</a></td><td>IconFieldWidget </td><td>Used in warnings; RollOverIconButtonWidget. </td></tr><tr><td><a class="el" href="classk_icon_popup_boss.html">kIconPopupBoss</a></td><td>No corresponding ODFRez custom resource type. </td><td>Used on tabbed palettes as the triangle icon for the pop-up menu. For internal use only. </td></tr><tr><td><a class="el" href="classk_icon_suite_popup_widget_boss.html">kIconSuitePopupWidgetBoss</a></td><td>IconSuitePopupWidget </td><td>Used in places like the Info panel, where you see a small icon with a tiny triangle on the right-bottom corner. Clicking on the icon pops up a contextual menu. </td></tr><tr><td><a class="el" href="classk_icon_suite_widget_boss.html">kIconSuiteWidgetBoss</a></td><td>IconSuiteWidget </td><td>Used for icons on panels and dialogs. Examples include the warning icons on the Links panel and the top left icon on the Transform panel. </td></tr><tr><td><a class="el" href="classk_over_print_icon_push_button_boss.html">kOverPrintIconPushButtonBoss</a></td><td>OverPrintWidget </td><td>Not used. </td></tr><tr><td>kPictureWidgetBoss </td><td>PictureWidget </td><td>Used for some CJK widgets. The Toolbox has an instance of this boss class being subclassed. </td></tr><tr><td><a class="el" href="classk_roll_over_icon_button_boss.html">kRollOverIconButtonBoss</a></td><td>RollOverIconButtonWidget </td><td>Widely used for example SDK samples. </td></tr><tr><td><a class="el" href="classk_roll_over_icon_push_button_boss.html">kRollOverIconPushButtonBoss</a></td><td>RollOverIconPushButtonWidget </td><td>Used in a control strip for vertical justification mode buttons. </td></tr><tr><td><a class="el" href="classk_simple_icon_suite_button_widget_boss.html">kSimpleIconSuiteButtonWidgetBoss</a></td><td>SimpleIconSuiteButtonWidget </td><td>Little used. See the Stroke panel. </td></tr></table><h3><a class="anchor" id="id_creating_an_image_widget"></a> Creating an image widget</h3><p>Most ODFRez types comprise nothing more than a CControlView field with an additional flag specifying whether some appearance should be applied.<h3><a class="anchor" id="id_modifying_image_widgets"></a> Modifying image widgets</h3><p>The principal interfaces of interest to client-code developers are <a class="el" href="class_i_control_view.html">IControlView</a> (for switching the image displayed) and <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> (or at least the role it plays in notification). The <a class="el" href="class_i_control_view.html">IControlView</a> interface dynamically varies the visual representation of a widget. There may be occasions to switch to a different picture depending on state; the methods on the <a class="el" href="class_i_control_view.html">IControlView</a> interface, like SetPluginRsrcID and SetRsrcID, are relevant in this context.<h3><a class="anchor" id="id_manipulating_image_widgets"></a> Manipulating image widgets</h3><p>Clients of the buttons with behavior provided by boss classes like <a class="el" href="classk_roll_over_icon_button_boss.html">kRollOverIconButtonBoss</a> and derivatives can attach to the <a class="el" href="class_i_subject.html">ISubject</a> interface of an instance of a boss object and request notifications on the IID_IBOOLEANCONTROLDATA protocol. An update message is sent depending on the state of the pseudo-button widget. If selected, a kTrueStateMessage value is sent for the ClassID of the Update message with the IID_IBOOLEANCONTROLDATA protocol. If the button is unselected, the ClassID is kFalseStateMessage with the same protocol.<p>A common requirement is using a change in the displayed image to signal a state transition. For example, the Layers panel uses iconic buttons to indicate that a layer is locked or unlocked, visible or invisible. This can be done through the <a class="el" href="class_i_control_view.html">IControlView</a> interface on a particular widget. To switch the icon or picture displayed, acquire an <a class="el" href="class_i_control_view.html">IControlView</a> interface through <a class="el" href="class_i_panel_control_data.html#aa9dde6f0ce56f041ddcd08b4dbc86287">IPanelControlData::FindWidget</a>, and send a SetRsrcID message to the widget boss object to change the image being displayed.<h2><a class="anchor" id="id_drop-down_lists_and_combo_boxes"></a> Drop-down lists and combo boxes</h2><h3><a class="anchor" id="id_using_drop-down_and_combo-box_widgets"></a> Using drop-down and combo-box widgets</h3><p>This section describes two widely used and closely related widget groups, drop-down lists and combo boxes. Drop-down lists are non-editable displays of lists of information; combo boxes also are used to display non-editable drop-down lists of information, but the end user interacts with the list in a different way. The relation between the two is that a combo box is a composite of an edit-box control (with nudge buttons) and a drop-down list. A combo box allows a user to select from a drop-down list or use a text-edit box to enter a new choice. For example, the Character panel in the application uses several different kinds of combo boxes; see the following figure. <div class="image"><img alt="solutions-5.gif" src="solutions-5.gif" /></div><p>The widget that displays available fonts is a type-ahead combo box. There are several specialized combo boxes that display information in measurement units as shown in the following table.<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Example </th></tr><tr><td><a class="el" href="classk_angle_combo_box_widget_boss.html">kAngleComboBoxWidgetBoss</a></td><td>AngleComboBoxWidget </td><td>Displays a set of values in angular units. See the Transform panel. </td></tr><tr><td><a class="el" href="classk_drop_down_list_widget_boss.html">kDropDownListWidgetBoss</a></td><td>DropDownListWidget </td><td>Displays a set of text values rather than numeric values, where no type-ahead or nudge is required. See the Stroke panel (Stroke-type). </td></tr><tr><td><a class="el" href="classk_int_combo_box_widget_boss.html">kIntComboBoxWidgetBoss</a></td><td>IntComboBoxWidget </td><td>Displays a set of integer values. See the kerning combo box on the Character panel. </td></tr><tr><td><a class="el" href="classk_line_wt_measure_combo_box_widget_boss.html">kLineWtMeasureComboBoxWidgetBoss</a></td><td>LineWtMeasureComboBoxWidget </td><td>Displays values in line weight units. See the Stroke panel. </td></tr><tr><td><a class="el" href="classk_percentage_combo_box_widget_boss.html">kPercentageComboBoxWidgetBoss</a></td><td>PercentageComboBoxWidget </td><td>Displays values in percentage units. See the Transform panel. </td></tr><tr><td><a class="el" href="classk_real_combo_box_widget_boss.html">kRealComboBoxWidgetBoss</a></td><td>RealComboBoxWidget </td><td>Displays a set of floating-point values. </td></tr><tr><td><a class="el" href="classk_text_combo_box_widget_boss.html">kTextComboBoxWidgetBoss</a></td><td>TextComboBoxWidget </td><td>Displays textual values. See the Find/Change dialog. </td></tr><tr><td><a class="el" href="classk_text_measure_combo_box_widget_boss.html">kTextMeasureComboBoxWidgetBoss</a></td><td>TextMeasureComboBoxWidget </td><td>Displays units in the current text-measurement units. Use in the Character panel to specify leading. </td></tr><tr><td><a class="el" href="classk_typeahead_text_combo_box_widget_boss.html">kTypeaheadTextComboBoxWidgetBoss</a></td><td>TypeaheadTextComboBoxWidget </td><td>Allows a user to enter partial string and have the control predict the value to select. Used in the Character panel to display font families. </td></tr><tr><td><a class="el" href="classk_x_measure_combo_box_widget_boss.html">kXMeasureComboBoxWidgetBoss</a></td><td>XMeasureComboBoxWidget </td><td>Displays values in the current horizontal measurement units. </td></tr><tr><td><a class="el" href="classk_y_measure_combo_box_widget_boss.html">kYMeasureComboBoxWidgetBoss</a></td><td>YMeasureComboBoxWidget </td><td>Displays values in the current vertical measurement units. </td></tr></table><p>The API has many combo-box widget boss classes that provide rich behavior for combo boxes. The combo box can cooperate with a nudge control widget, to allow incremental changes in input parameters. Combo boxes are appropriate for displaying units like measurement units, angles, and percentages.<p>When input is selected from a list of values, the combo box is more convenient than the drop-down list. Type-ahead combo boxes allow quick access to a value in a sorted list; the user can enter keystrokes matching items in the list. For example, the font family combo box on the Character panel allows the first few characters of the font name to be entered, which scrolls the list to the desired location. The API has many types of combo boxes, some of which are shown in the preceding table.<p>The following are the measurement units specific to the layout of drop-down lists and combo boxes:<ul><li>x-measurement units<li>y-measurement units<li>Line-weight measure<li>Text measure</ul><p>A different measurement system may be in force for each of these, and a combo box of a specialized type displays the choices in the contextually appropriate units. The preceding table shows a selection of the combo boxes available in the API.<h3><a class="anchor" id="id_creating_a_combo_box"></a> Creating a combo box</h3><p>Combo boxes are panel widgets; combo-box widget boss classes descend from <a class="el" href="classk_generic_panel_widget_boss.html">kGenericPanelWidgetBoss</a>. When instantiated, a combo-box widget boss object creates two children, a drop-down-list widget boss object and an edit-box widget boss object. There appear to be many widget boss classes related to combo boxes in the API, but those related to the encapsulated drop-down list and edit box within the combo-panel are implementation boss classes and not required for writing client code.<h3><a class="anchor" id="id_modifying_a_combo_box"></a> Modifying a combo box</h3><p>The data model for combo boxes consists of a string-list control data model for the drop-down (accessed via the <a class="el" href="class_i_string_list_control_data.html">IStringListControlData</a> interface) and the data model for an edit box, represented by the <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface. Changes in selection by the end user are sent to client code along the IID_ITEXTCONTROLDATA protocol. The edit box does not have an independent data model to the string list; it reflects the current selection in the drop-down list.<h3><a class="anchor" id="id_capabilities"></a> Capabilities</h3><p><a class="el" href="class_i_string_list_control_data.html">IStringListControlData</a> populates both drop-down lists and combo boxes dynamically. <a class="el" href="class_i_drop_down_list_controller.html">IDropDownListController</a> changes the state of a drop-down list or combo box drop-down, and it controls the current selection of the drop-down list or combo box. For example, to specify the item selected, enable or disable the control. The <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface exposed by the kComboBoxWidget boss relates to the child edit-box widget. Similarly, the <a class="el" href="class_i_edit_box_attributes.html">IEditBoxAttributes</a> interface relates to the child edit-box widget. However, changes to selection are notified along the IID_ITEXTCONTROLDATA protocol for a combo box, which is not intuitive; a list-control data protocol might have been expected.<h2><a class="anchor" id="id_splitter_widgets"></a> Splitter widgets</h2><h3><a class="anchor" id="id_using_the_splitter_widget"></a> Using the splitter widget</h3><p>The splitter widget manages the dimensions of multiple panels within one container. For example, the Pages panel exploits a splitter widget to create two regions that can be sized co-dependently. The splitter widget divides both vertically and horizontally. The setting is determined by the bindings, normally specified on the CControlView-related portion of the ODFRez data statements that define the splitter. The following table shows some boss classes that implement splitters.<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Description </th></tr><tr><td><a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a></td><td>SplitterWidget </td><td>Used in InCopy&#39;s Thesaurus panel. </td></tr><tr><td><a class="el" href="classk_splitter_panel_widget_boss.html">kSplitterPanelWidgetBoss</a></td><td>SplitterPanelWidget </td><td>Used in XML panel. </td></tr><tr><td><a class="el" href="classk_layout_splitter_panel_widget_boss.html">kLayoutSplitterPanelWidgetBoss</a></td><td>LayoutSplitterPanelWidget </td><td>Used in Page panel. </td></tr><tr><td><a class="el" href="classk_linked_splitter_panel_widget_boss.html">kLinkedSplitterPanelWidgetBoss</a></td><td>LinkedSplitterPanelWidget </td><td>Used in XML Mapping and Word Preferences dialogs. </td></tr></table><h3><a class="anchor" id="id_creating_a_splitter_widget"></a> Creating a splitter widget</h3><p>The <a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a> boss class and the <a class="el" href="classk_splitter_tracker_boss_message.html">kSplitterTrackerBossMessage</a> tracker boss class cooperate to provide the behavior of the splitter widget. The splitter widget is initialized by ODFRez data statements. There is little need for additional customization of the splitter widget. The ODFRez custom resource type SplitterWidget is bound to the <a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a> boss class. The superclass of <a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a> is the base widget boss class, <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>.<h3><a class="anchor" id="id_manipulating_a_splitter_widget"></a> Manipulating a splitter widget</h3><p>The <a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a> boss class exposes interfaces like <a class="el" href="class_i_splitter_control_data.html">ISplitterControlData</a>, which provides access to the list of managed widgets. The <a class="el" href="class_i_cursor_region.html">ICursorRegion</a> interface effectively is a signature that the widget is bound to a cursor provider. The <a class="el" href="class_i_splitter_control_data.html">ISplitterControlData</a> interface provides access to the list of splitter-managed widgets and queries methods about the properties of the control.<p>The <a class="el" href="classk_splitter_tracker_boss_message.html">kSplitterTrackerBossMessage</a> boss class provides the behavior behind the tracker. Much of the widget&#39;s capability comes from the implementation of <a class="el" href="class_i_tracker.html">ITracker</a> on this widget boss class. The splitter-widget boss class event handler serves only to create the tracker and send it a BeginTracking message.<h2><a class="anchor" id="id_scroll_bars"></a> Scroll bars</h2><h3><a class="anchor" id="id_using_a_scroll_bar"></a> Using a scroll bar</h3><p>To provide scrolling views in the user interface, the API uses a pattern or assembly consisting of three elements, listed in the following table:<table class="doxtable"><tr><th>Elements </th><th>Description </th></tr><tr><td>Panoramas </td><td>An aspect of a scrollable object that can be accessed through an <a class="el" href="class_i_panorama.html">IPanorama</a> interface. Scrollable objects expose this interface. </td></tr><tr><td>Panorama syncs </td><td>Abstractions in the API that coordinate a scrollable view with scroll-bar controls, with behavior provided by one of two boss classes named xxxScrollBarPanoramaSyncBoss. For internal use. </td></tr><tr><td>Scroll bars </td><td>Controls whose behavior derives from the <a class="el" href="classk_scroll_bar_widget_boss.html">kScrollBarWidgetBoss</a> widget boss class. </td></tr></table><p>A fundamental application of these elements is the layout widget. Scroll bars and panoramas occur widely within the application&#39;s plug-in code base.<p>Scroll bars are widgets with behavior deriving from <a class="el" href="classk_scroll_bar_widget_boss.html">kScrollBarWidgetBoss</a>. The scroll bar data model is accessed through the <a class="el" href="class_i_counter_control_data.html">ICounterControlData</a> interface. Panoramas are aspects of objects that scroll; the <a class="el" href="class_i_panorama.html">IPanorama</a> interface scrolls a view. The boss classes mentioned below expose an <a class="el" href="class_i_panorama.html">IPanorama</a> interface.<h3><a class="anchor" id="id_creating_a_scroll_bar"></a> Creating a scroll bar</h3><p>The <a class="el" href="classk_scroll_bar_widget_boss.html">kScrollBarWidgetBoss</a> boss class extends <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a> and is bound to the ODFRez custom resource type ScrollBarWidget. When a scroll bar is added to a control like a StaticMultiLineTextWidget, it works hand-in-hand with a panorama (<a class="el" href="class_i_panorama.html">IPanorama</a>) to produce the correct scrolling behavior of the dependent widgets. The scroll bar receives input from the end user, and the implementation code manipulates the view through the <a class="el" href="class_i_panorama.html">IPanorama</a> interface.<h3><a class="anchor" id="id_manipulating_a_scroll_bar"></a> Manipulating a scroll bar</h3><p>The <a class="el" href="class_i_counter_control_data.html">ICounterControlData</a> interface is the key interface for scroll bars. It accesses the data model of a scroll-bar widget boss object and changes its state. The <a class="el" href="class_i_panorama.html">IPanorama</a> interface manipulates a scrollable object&#39;s view.<h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>The <a class="el" href="classk_scroll_bar_widget_boss.html">kScrollBarWidgetBoss</a> class exposes <a class="el" href="class_i_counter_control_data.html">ICounterControlData</a>, the data model for a scroll bar widget.<p>An observer requesting changes in the data model of a scroll bar widget boss object attaches to its <a class="el" href="class_i_counter_control_data.html">ICounterControlData</a> interface and requests notification on the IID_ICOUNTERCONTROLDATA protocol. When the counter control data changes, registered observers are notified with an update message with the classID parameter of kCounterChangeStateMessage. The client also gets passed a pointer to a <a class="el" href="class_counter_control_update_params.html">CounterControlUpdateParams</a> object as the changedBy parameter of an <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message.<h2><a class="anchor" id="id_sliders"></a> Sliders</h2><h3><a class="anchor" id="id_using_a_slider"></a> Using a slider</h3><p>A slider control is appropriate for situations in which an end user can enter a parameter that can vary continuously over a finite, determinate range. There are several standard sliders (descendants of <a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a>) in the application&#39;s user interface, such as on the Color panel, shown in here: <div class="image"><img alt="uiwidg-uiwidgetbasics-9.gif" src="uiwidg-uiwidgetbasics-9.gif" /></div><p>A pop-up slider (descendant of kPopupSliderBoss) can be used in the same situation, when the slider should appear only when the user wants to change a particular value rather than be continuously visible. The following figure shows an example of a pop-up slider in the Transparency panel. This slider controls the opacity of the selected page items. There also is a pop-up slider on the Swatches panel, which is used to vary the tint associated with a particular color in a swatch. This uses a class of pop-up slider specialized for the input of real-valued numbers. <div class="image"><img alt="uiwidg-uiwidgetbasics-10.gif" src="uiwidg-uiwidgetbasics-10.gif" /></div><p>Pop-up slider combo-box controls combine an edit box and a button. They are child widgets of a panel. The pop-up slider appears only when the end user clicks a button to show the slider in its own floating window. This pop-up slider is a relatively complex control, consisting of a cooperating assembly of an edit box, a button, a floating window, and a slider, which are owned and/or managed by a parent boss object that is a descendant of the generic panel widget boss class (<a class="el" href="classk_generic_panel_widget_boss.html">kGenericPanelWidgetBoss</a>). It allows you to pack more user interface into a given area of screen real estate than is possible with standard slider controls.<p>The following table shows boss classes that implement sliders:<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Example </th></tr><tr><td><a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a></td><td>(none: you create your own) </td><td>Slider that is continuously available, as on the Color panel. </td></tr><tr><td><a class="el" href="classk_real_popup_slider_combo_widget_boss.html">kRealPopupSliderComboWidgetBoss</a></td><td>RealPopupSliderComboBoxWidget </td><td>Pop-up slider, as on the Swatches panel. </td></tr><tr><td><a class="el" href="classk_int_popup_slider_combo_widget_boss.html">kIntPopupSliderComboWidgetBoss</a></td><td>IntPopupSliderComboBoxWidget </td><td>Pop-up slider with integer values, as on the Inks panel. </td></tr><tr><td><a class="el" href="classk_percent_popup_slider_combo_widget_boss.html">kPercentPopupSliderComboWidgetBoss</a></td><td>PercentPopupSliderComboBoxWidget </td><td>Pop-up slider with percentage values, as on the Transparency panel. </td></tr></table><h3><a class="anchor" id="id_creating_a_slider"></a> Creating a slider</h3><p>To use the standard slider widget (<a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a>), create a new ODFRez custom resource type that can extend the ODFRez custom resource type CControlView, and add an ODFRez SliderControlData field. This new type is then bound to the subclass of <a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a> (k&lt;whatever&gt;SliderWidgetBoss). This new ODFRez custom resource type is bound to the boss class delivered by your own plug-in that extended the <a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a> boss class. There are other, subtle dependencies and interfaces required for the standard slider implementation to work correctly.<p>The slider pop-up widget is a compound widget, consisting of a panel, edit box, button widget, and slider. It is called a combo-box slider because it functions as if it were a combo box, with a slider replacing the traditional combo-box drop-down list.<p>The <a class="el" href="classk_popup_slider_combo_box_widget_boss.html">kPopupSliderComboBoxWidgetBoss</a> boss class provides the core of the behavior for the combo-box slider. This boss class extends the <a class="el" href="classk_combo_box_widget_boss.html">kComboBoxWidgetBoss</a> boss class. Do not use this <a class="el" href="classk_popup_slider_combo_box_widget_boss.html">kPopupSliderComboBoxWidgetBoss</a> boss class directly; instead, use one of its subclasses, which have specified associated measurement units.<p>A pop-up slider has much functionality in common with combo-box widgets. A pop-up slider has part of its behavior provided by the kPopupSliderBoss boss class, which extends the standard slider widget boss (<a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a>).<p>The pop-up slider widget does not require an ODFRez CSliderControlData field to be initialized. Internally, the slider widget on the floating window does have an <a class="el" href="class_i_slider_control_data.html">ISliderControlData</a> interface, because the class kPopupSliderBoss derives from <a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a>; however, a pop-up slider is initialized by the settings obtained by querying through the <a class="el" href="class_i_text_data_validation.html">ITextDataValidation</a> interface. These setting specify the range through the interior <a class="el" href="class_i_slider_control_data.html">ISliderControlData</a> interface on the kPopupSliderBoss. The fields of the ODFRez type TextDataValidation in the ODFRez data statements defining the pop-up slider specify the maximum and minimum slider values.<h3><a class="anchor" id="id_manipulating_a_slider"></a> Manipulating a slider</h3><p><a class="el" href="class_i_slider_control_data.html">ISliderControlData</a> is an interface aggregated on the <a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a> boss class. It encapsulates information about the maximum and minimum values exposed in the control&#39;s range, and the current value of the slider setting. If the data value changes, notifications with ClassID equivalent to kRealChangeStateMessage are sent to registered observers of the slider boss object.<p>The boss class aggregates an <a class="el" href="class_i_event_handler.html">IEventHandler</a> interface. This should not need to be overridden. The event handler with implementation ID of kCSliderEHImpl is responsible for creating a tracker if required and calling the tracker methods in the appropriate sequence. There is an <a class="el" href="class_i_control_view.html">IControlView</a> interface on the slider control, whose default implementation uses the <a class="el" href="class_i_slider_state_data.html">ISliderStateData</a> and <a class="el" href="class_i_slider_control_data.html">ISliderControlData</a> interfaces on the widget boss object to determine how to draw the visual representation of the control.<p>When the data model of a pop-up slider changes, an <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message is sent to attached observers. Interested client code queries for the state of the pop-up slider by using the <a class="el" href="class_i_text_value.html">ITextValue</a> interface. This allows the value of the slider state (percent, real, or integer) to be queried. Similarly, to set the state of the pop-up slider, use the <a class="el" href="class_i_text_value.html">ITextValue</a> interface. Other properties of the pop-up slider are queried through the <a class="el" href="class_i_slider_control_data.html">ISliderControlData</a> interface. For example, this is used to determine the minimum or maximum of the pop-up slider range.<h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>The state of the standard slider is represented by <a class="el" href="class_i_slider_control_data.html">ISliderControlData</a>. Changes to this state are broadcast along IID_ISLIDERCONTROLDATA.<p>The state of a pop-up slider is represented by <a class="el" href="class_i_text_value.html">ITextValue</a>. Changes are broadcast with the IID_ISLIDERCONTROLDATA protocol.<p>Notifications about changes to the state of a standard slider control are sent along the IID_ISLIDERCONTROLDATA protocol to registered observers. The usual process in processing the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message is to query the data value through <a class="el" href="class_i_slider_control_data.html#a26b5981626be8d71407242ea74010506">ISliderControlData::GetValue</a>, to determine the control state. Add an <a class="el" href="class_i_observer.html">IObserver</a> interface to the <a class="el" href="classk_std_slider_widget_boss.html">kStdSliderWidgetBoss</a> by subclassing. On receiving an AutoAttach message from the application core, the client code queries for the <a class="el" href="class_i_subject.html">ISubject</a> interface on the widget boss object and requests notifications along the IID_ISLIDERCONTROLDATA protocol. The observer then detaches in AutoDetach.<p>When changes occur in the slider control&#39;s data, <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> messages are sent to this observer. A message with ClassID of kRealChangeStateMessage is sent to the observer. The <a class="el" href="class_i_slider_control_data.html">ISliderControlData</a> interface then retrieves the current data value associated with the slider.<p>Pop-up slider notifications also are sent along the IID_ISLIDERCONTROLDATA protocol; however, the ClassID of the message is unique to the pop-up slider and is one of the following:<ul><li>kPopupSliderOpenMessage, sent when the slider opens.<li>kPopupSliderApplyChangeMessage, sent when the value is being committed by the end user.<li>kPopupSliderCloseMessage, sent when the slider is about to close.</ul><h3><a class="anchor" id="id_implementation_details"></a> Implementation details</h3><p>The superclass for all pop-up sliders is <a class="el" href="classk_popup_slider_combo_box_widget_boss.html">kPopupSliderComboBoxWidgetBoss</a>. The core behavior of pop-up sliders comes from the <a class="el" href="class_i_control_view.html">IControlView</a> implementation aggregated on this boss class. Another boss class, kPopupSliderButtonBoss, provides the behavior behind the button on the pop-up slider combo-box widget. The <a class="el" href="class_i_event_handler.html">IEventHandler</a> implementation aggregated on this kPopupSliderButtonBoss class is responsible for creating a floating window and adding a child widget, which is the slider the user manipulates.<p>The appearance of the pop-up slider is determined by the implementation of the <a class="el" href="class_i_control_view.html">IControlView</a> interface with identifier kPopupSliderComboBoxViewImpl. This implementation is responsible for creating the child widgets that provide the behavior of the pop-up slider. When the pop-up slider is restored from persistent data (plug-in binary resource first time, or saved data database if its representation exists in it), it creates an object of class kPopupSliderButtonBoss to provide the behavior behind the button that shows the slider. An object of class <a class="el" href="classk_combo_box_edit_box_widget_boss.html">kComboBoxEditBoxWidgetBoss</a> also is created, to support the behavior of the edit box in the pop-up slider combo-box widget. The pop-up slider itself (kPopupSliderBoss) is created on demand by the class that implements the <a class="el" href="class_i_event_handler.html">IEventHandler</a> interface for the composite pop-up slider combo-box widget. Typically, the slider is shown on a left-button down event. The implementation creates an object of class <a class="el" href="classk_window_boss.html">kWindowBoss</a> and specifies it is a floating window. It then creates an object of class kPopupSliderBoss and adds it as a child of this new window boss object.<h2><a class="anchor" id="id_tree-view_widgets"></a> Tree-view widgets</h2><h3><a class="anchor" id="id_using_a_tree_view"></a> Using a tree view</h3><p>A tree-view widget allows you to display hierarchical data; users can expand or contract nodes in the tree to increase or decrease the amount of detail displayed. A tree-view widget can have vertical and/or horizontal scroll bars, to allow end users to scroll within the view of the tree structure.<p>The tree-view control is complex. The basic procedure is as follows:<ol type="1"><li>Create a new ODFRez custom resource type for a tree-view widget that extends the ODFRez type TreeViewWidget. Define a resource of this new type, and add it to the dialog or panel where the tree view control will appear.<li>Create a new ODFRez custom resource type for a tree-node widget that extends the ODFRez type PrimaryResourcePanelWidget, Define branch node and leaf node resources based on this tree node widget type.<li>Define a tree-view widget boss that extends <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a>. In this boss, aggregate at least ITreeViewHiearchyAdapter and <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a>.<li>Provide an implementation for the <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a> and <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a> interfaces.<li>Initialize the tree view with ChangeRoot() of <a class="el" href="class_i_tree_view_mgr.html">ITreeViewMgr</a>. Also, inform InDesign of any tree model change through <a class="el" href="class_i_tree_view_mgr.html">ITreeViewMgr</a>.</ol><p>The following figure shows a tree view and indicates the widget boss classes that provide the behavior for the components of the tree view. The <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a> class provides the behavior for the main control, the <a class="el" href="classk_tree_node_widget_boss.html">kTreeNodeWidgetBoss</a> class provides the bulk of the behavior for nodes in the tree, and <a class="el" href="classk_tree_expander_widget_boss.html">kTreeExpanderWidgetBoss</a> provides the behavior of the triangle-icon that can be used to show or hide the children shown for a specific node. <div class="image"><img alt="solutions-6.gif" src="solutions-6.gif" /></div><p>The following sections describe how to work with the tree-view control. The control is relatively complex and can be tricky to use. The PanelTreeView SDK sample shows how to use these controls.<p>The API to use a tree-view control is written differently than platform-specific APIs, such as the API for the TreeView control on Windows or the Java &amp;#8482;/Swing tree-control. Instead of adding nodes to an InDesign tree-view control directly, client code provides the means for navigating through its own tree model. The tree-view control widget boss object (<a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a>) handles navigation, sends queries about the tree model, and asks for wid gets for a particular node when it needs them. This is carried out by the framework sending messages to the client code, asking for, say, a root node in the tree or a widget that can be used to display a particular uniquely identified node.<p>The following table shows boss classes that implement tree views:<table class="doxtable"><tr><th>Widget Boss Class </th><th>ODFRez Custom Type </th><th>Responsibility </th></tr><tr><td><a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a></td><td>TreeViewWidget </td><td>Provides the main behavior for tree controls. </td></tr><tr><td><a class="el" href="classk_tree_node_widget_boss.html">kTreeNodeWidgetBoss</a></td><td>TreeNodeWidget </td><td>Represents a node in tree view. Subclass to hear expand/collapse events with an observer or to override the event handler. </td></tr><tr><td><a class="el" href="classk_tree_expander_widget_boss.html">kTreeExpanderWidgetBoss</a></td><td>TreeExpanderWidget </td><td>Provides behavior to expand/collapse nodes of tree with children. </td></tr></table><p>The essence of working with the tree-view control is to subclass <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a> and aggregate on it your implementation of the <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a> interface. This enables you to adapt your data model to the needs of the InDesign tree-view control. You also are required to provide an implementation of the <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a> interface, which allows your client code to specify which user interface widgets to create to display a given node, and also allows your client code to specify how the widgets should be placed.<p>Client code is required to notify the application framework when changes in the tree model take place, like nodes being added or deleted. This helps keep the tree model (based on your data) and the tree view synchronized. The key responsibilities of client code are as follows:<ol type="1"><li>Return the representation of nodes at given locations in the tree&#39;s data model, such as the root, or at a given index in the children of a given node.<li>Manufacture widgets to render tree nodes given a uniquely identified node.<li>Render views of data at uniquely identified nodes.<li>Optionally provide information about the intended geometry of rendered nodes within the tree.</ol><p>Client code provides methods for returning the root node and the parent or child node at a given index from any given node. Each node within the tree can have an associated data item. This might be a UID, in which case an API class (<a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a>) is used to represent each node. Alternatively, the data items may be entirely custom items that are unique to your client code, in which case it may be necessary to subclass an API type. Each node should be identified uniquely. This enables the application to render the correct view of the underlying data model provided by the client code.<p>When the tree view is updated, the application core may pass to the client code a reference to any node. It is up to the client code to provide an appropriate widget to render the node and populate the widget with a view of the associated data.<p><b>Adapter pattern</b><p>The tree-view control in the API uses the design pattern adapter, described in Design Patterns (Gamma, Helm, Johnson, and Vlissides, Addison-Wesley, 1995). At its most basic, the adapter pattern allows two existing but incompatible classes to work together without changing the public interface of either class. The classes required to work together are named in the pattern as client and adaptee.<dl class="section note"><dt>Note<dd>Do not confuse client in this pattern with client in plug-in client code.</dl><p>An instance of the client sends particular messages to the target, an abstract API implemented by the adapter. The messages sent by the client are translated by the adapter into method calls on an adaptee. The adapter then manufactures an appropriate return value, if required, based on the adaptee&#39;s response. In terms of the tree control, the roles are occupied as shown in the following table.<table class="doxtable"><tr><th>Role </th><th>Occupied by ... </th></tr><tr><td>Adaptee </td><td>The data model, such as a tree model representing the XML logical structure of a document. </td></tr><tr><td>Adapter </td><td>The plug-in client code&#39;s implementation of <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a>. </td></tr><tr><td>Client </td><td>Application core, specifically, the widget run-time subsystem (not client code). </td></tr><tr><td>Target </td><td>The abstract API on <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a>. </td></tr></table><p><b>Factory method pattern</b><p>The factory method pattern described in Design Patterns is used in implementing a working tree-view control. This pattern can be used when a framework needs to instantiate classes but has knowledge of only abstract classes, which cannot be instantiated directly. In implementing a tree control, a parameterized factory method is used, where an identifier is passed in by the framework specifying what type of object to manufacture. There is a factory method, <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode</a>, which is parameterized by passing a reference to the node being rendered. Client code is responsible for returning a new instance of an <a class="el" href="class_i_control_view.html">IControlView</a> interface on a newly created widget boss object that can be used to render the node&#39;s associated data.<h3><a class="anchor" id="id_creating_a_tree_view"></a> Creating a tree view</h3><p>The core behavior for the tree view widget is determined by the <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a> class. The first responsibility of client code is to subclass this boss class and create one&#39;s own boss class that provides implementations of <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a> and <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a>.<p>The behavior of individual nodes in the tree view control is provided by the <a class="el" href="classk_tree_node_widget_boss.html">kTreeNodeWidgetBoss</a> boss class. Subclass this where you want to add an <a class="el" href="class_i_observer.html">IObserver</a> interface to obtain notification about, for instance, expansion or contraction events associated with tree nodes. There is a tree expander widget, with behavior provided by the <a class="el" href="classk_tree_expander_widget_boss.html">kTreeExpanderWidgetBoss</a> boss class. Key boss classes and their responsibilities are listed below.<p>There is an ODFRez custom resource type TreeViewWidget. Because client code must subclass <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a>, it always is necessary to perform a corresponding subclass of TreeViewWidget and bind it to the new widget boss class, such as kMyTreeViewWidgetBoss. The ODFRez custom resource type TreeExpanderWidget is used on panels to render individual nodes in the tree. This widget allows the descendant nodes of a node to be displayed or collapsed. If no children are associated with a given node, a correct implementation is to hide this widget.<p>There also is a new ODFRez custom resource type created for displaying each node in the tree-view control. For tree-view controls on panels, a subclass of PrimaryResourcePanelWidget is appropriate. For tree-view controls on dialogs, an erasable panel is required, as the tree-view control does not know anything about erasing its own background. The PanelTreeView SDK sample shows how to use a tree-view control on a dialog and how to receive notification about different tree-related events.<h3><a class="anchor" id="id_manipulating_a_tree_view"></a> Manipulating a tree view</h3><p><b><a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a></b><p>This is one of the two interfaces you should implement to obtain a working tree-view control. The ITreeViewHiearchyAdapter interface provides the means for navigating through your tree model. It is like the adapter pattern, in that it provides a way for the TreeView widget to navigate your tree model without requiring your tree model to conform to any given interface.<p><b><a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a></b><p>Provide an implementation of this interface. <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a> is where you create the tree-view control widgets in your client code and apply node data to the widget. There is a partial implementation of <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a>, called <a class="el" href="class_c_tree_view_widget_mgr.html">CTreeViewWidgetMgr</a>, that takes care of the widget placement implementation and simplifies the implementation of this interface.<p><b><a class="el" href="class_i_tree_view_mgr.html">ITreeViewMgr</a></b><p>This interface is aggregated on the <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a> boss class; you are not expected to provide your own implementation of this interface. The principal responsibility of this interface is to keep the tree view synchronized with changes to the tree model. Client code should call methods in this interface to let the tree know when changes to the tree occur.<p>For example, client code should call <a class="el" href="class_i_tree_view_mgr.html#a155dbd0000560d662427acf4cf25b997">ITreeViewMgr::ChangeRoot()</a> to initialize the tree-view control. Call this whenever you want to regenerate the tree, like when the tree view control was in a state where it did not hear about changes to the data model and wants to start fresh. There also is a debug-only version of ChangeRoot() that validates an implementation of <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a>.<p>Client code calls <a class="el" href="class_i_tree_view_mgr.html#a29580140d9d26709e3476acc76896fa7">ITreeViewMgr::NodeAdded()</a> and <a class="el" href="class_i_tree_view_mgr.html#a1d6ce5b5acce738cfc2d21168bf7f659">ITreeViewMgr::BeforeNodeDeleted()</a> when nodes are added and about to be removed from the tree model. Failure to call these methods when changes occur in the tree model causes problems in the tree view, like nodes unintentionally disappearing.<p><a class="el" href="class_i_tree_view_mgr.html#abdee885322a2aebb03913837769fcd7e">ITreeViewMgr::NodeChanged()</a> should be called when a nodes data has changed that will not affect the nodes height. If the change will affect the node&#39;s height, call <a class="el" href="class_i_tree_view_mgr.html#a1d6ce5b5acce738cfc2d21168bf7f659">ITreeViewMgr::BeforeNodeDeleted()</a>, followed by <a class="el" href="class_i_tree_view_mgr.html#a29580140d9d26709e3476acc76896fa7">ITreeViewMgr::NodeAdded()</a>.<p><b>Uniquely identifying each node</b><p>On examining the <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a> interface, notice the extensively used class <a class="el" href="class_node_i_d.html">NodeID</a>. This is best explained by looking at the problem it is trying to solve. When the tree view asks for the root node, the client needs to uniquely identify that node. In a simple case, a UID may be all that is needed to identify the node.<p>Not all tree models, however, have UIDs associated with each node. For example, the PanelTreeView SDK sample represents views onto the local file system, and each node encapsulates a path in the file system, not a UID-based object. That leads us to return a class that can be specified by the client but derives from a class providing the methods required by the tree-view control.<p>The main problem is that we would need to return a pointer to this class, which leads to potential problems with clean-up. To make clean-up easier, the framework uses the <a class="el" href="class_node_i_d.html">NodeID</a> class as a smart pointer. <a class="el" href="class_node_i_d.html">NodeID</a> is a class that holds and deletes pointers to <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> classes.<p>If your tree is UID-based, there is an existing NodeIDClass-based class you can use, <a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a>. If you require different data to identify your tree nodes, create your own class based on <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>.<p><b><a class="el" href="class_node_i_d.html">NodeID</a> and related classes</b><p>There are several classes that can be found as arguments and return types in the interfaces that should be implemented to create a working tree-view control. These are defined in the <a class="el" href="_node_i_d_8h_source.html">NodeID.h</a> API header file. They have similar names, and confusion can arise between <a class="el" href="class_node_i_d.html">NodeID</a>, which is like a smart pointer for the type <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>, and other classes, like <a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a>, which is a subclass of <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>. There also is a smart pointer, <a class="el" href="class_tree_node_ptr.html">TreeNodePtr</a>, which is used for descendants of type <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>, like <a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a>.<p>As discussed earlier, every node need to be identified uniquely. In InDesign, the <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> class represents an individual node. A subclass of this class, <a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a>, is available in the API. In reading <a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a>, remember it should have the suffix &quot;-Class.&quot;<p>To muddy the water further, there is a <a class="el" href="class_node_i_d.html">NodeID</a> class that is like a smart pointer and is used to manage the lifetime of dynamically created <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> objects. This class is found as a parameter on methods in <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a> and <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a>.<p>In certain situations, it may be adequate to use a UID to identify a tree node. There is a class in the API called <a class="el" href="class_u_i_d_node_i_d.html">UIDNodeID</a> that can be used for these cases. Otherwise, you need to implement your own subclass of <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> that identifies each node uniquely. For an example of how this can be done, see PanelTreeView.<p>The following table lists the C++ classes related to the tree-view widget and their responsibilities.<table class="doxtable"><tr><th>C++ Class </th><th>Responsibility </th></tr><tr><td><a class="el" href="class_node_i_d_class.html">NodeIDClass</a></td><td>The data associated with each node. Allows each node to be uniquely identified. Subclass this type to create custom data nodes. </td></tr><tr><td><a class="el" href="class_tree_node_ptr.html">TreeNodePtr</a></td><td>A smart pointer that is the equivalent of <a class="el" href="class_interface_ptr.html">InterfacePtr</a> for <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> descendants. </td></tr><tr><td><a class="el" href="class_node_i_d__rv.html">NodeID_rv</a></td><td>A class for method return values similar to <a class="el" href="class_node_i_d.html">NodeID</a>, except it gives up control of the encapsulated <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> rather than copying it. </td></tr><tr><td><a class="el" href="class_node_i_d.html">NodeID</a></td><td>Manages the lifetime of objects of type <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>. </td></tr></table><p><b>Node recycling</b><p>The tree-view widget contains instantiated widgets for visible nodes. For example, when the end user scrolls down, the node that was on top is no longer visible, and there is a new visible node at the bottom. The application framework removes the top widget, and if it is of the same type (based on the WidgetID obtained from <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode()</a>) as the widget needed for the bottom node, the framework re-uses the widget for the bottom node. This is one reason the <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode()</a> and <a class="el" href="class_i_tree_view_widget_mgr.html#a8d7b424d190461d78af89688de7c3c0a">ITreeViewWidgetMgr::ApplyNodeIDToWidget()</a> methods are distinct. It is necessary for the application framework to create new widgets only when there are no widgets of the right type to recycle.<p><b>Tree-view attributes</b><p>The tree-view control also has attributes that determine scroll information and whether the root item is shown. The attributes are set in the resource for the TreeView. Vertical and horizontal scroll bars are provided by the tree view (if desired), so you do not need to add them yourself. Specify in the resource whether you want no scroll bar, vertical only scroll bars, or horizontal and vertical scroll bars.<p>The scroll amounts for both horizontal and vertical scroll bars also are set in the resource. You must set two values for each scroll bar:<ul><li>The scroll-button increment is the number of pixels that will scroll when you click on either scroll button.<li>The thumb-scroll increment is the smallest number of pixels that will scroll when an end user moves the scroll bar thumb.</ul><p>For example, the tree view control can be configured so the scroll button moves 20 pixels, but the thumb scroll moves just 1 pixel, allowing for greater accuracy. The thumb-scroll increment must be a factor of the scroll-button increment.<p>Another attribute on the TreeView specifies whether to display the root element. You should have only one root element, but you may not necessarily want to show it.<h3><a class="anchor" id="id_receiving_messages"></a> Receiving messages</h3><p>Some APIs have an explicit tree model behind the tree control (for instance, in Java Swing). The InDesign API control, however, leaves it up to the client code to determine how the tree data model is represented. It requires only that client code can provide certain kinds of information as requested about its data model, like the number of children it has.<p>Other controls have a simpler data model and a simple notification structure that relates directly to this data model. For example, an edit box has an <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface that, when changed, notifies along the IID_ITEXTCONTROLDATA protocol. The situation is more complex for tree view controls.<p>There are at least two kinds of changes in which client code might be interested:<ul><li>The end user changes the node selected in the tree-view control. To receive notifications of this, attach an observer (<a class="el" href="class_i_observer.html">IObserver</a> implementation of your own) to the <a class="el" href="class_i_subject.html">ISubject</a> interface of your <a class="el" href="classk_tree_view_widget_boss.html">kTreeViewWidgetBoss</a> subclass, and listen along the IID_ITREEVIEWCONTROLLER protocol.<li>A node in the tree expands or collapses. In this case, attach an observer (<a class="el" href="class_i_observer.html">IObserver</a>) to the <a class="el" href="class_i_subject.html">ISubject</a> interface of the <a class="el" href="classk_tree_node_widget_boss.html">kTreeNodeWidgetBoss</a> subclass, and listen along the IID_ITREEVIEWMGR protocol.</ul><p>If you use the shadow (proxy) event-handler pattern shown in the PanelTreeView SDK sample, it also is possible to receive notification of events like double-clicks within the nodes of the tree view.<h3><a class="anchor" id="id_implementing_the_required_interfaces"></a> Implementing the required interfaces</h3><p><b>Implementing <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a></b><p>The <a class="el" href="class_i_tree_view_hierarchy_adapter.html">ITreeViewHierarchyAdapter</a> interface provides the means for navigating your tree. Its GetRootNode() method returns an instance of a node that represent your root node, with data allowing it to be uniquely identified as such.<p>The <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a42d91f485734913c9d352b2323a79968">ITreeViewHierarchyAdapter::GetParentNode()</a> method requests the parent node of a given node. If the given node is a root node, there is no parent for a root node, so return nil; otherwise, depending on the location of the node in your tree model, return its parent.<p>In implementing <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a0522e942fa0e8369d22dd1a3b40de5b3">ITreeViewHierarchyAdapter::GetNumChildren()</a>, return the number of children, given a node that is in your tree model. The <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a73819d1a727badceb04ae1c600f4a465">ITreeViewHierarchyAdapter::GetNthChild()</a> method is the counterpart to <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a42d91f485734913c9d352b2323a79968">ITreeViewHierarchyAdapter::GetParentNode()</a>. Since a node can have multiple children but only one parent, this method passes in the index position of the child node it is querying.<p>In implementing <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a391de099147b4c9e4f8faed45c895be7">ITreeViewHierarchyAdapter::GetChildIndex()</a>, the index refers to the index position used in the <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a73819d1a727badceb04ae1c600f4a465">ITreeViewHierarchyAdapter::GetNthChild()</a>, and the range of the index is from 0 to (number of children-1).<p>In implementing the <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a21060d89efe2c33d2004bbd0a497b05f">ITreeViewHierarchyAdapter::GetGenericNodeID()</a> method, simply return a dummy node that makes a generic node. This method is used primarily for persistence. When something is purged and the application framework must write out a <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>, it uses the ReadWrite() method on the <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>. When the application framework needs to read it back in, it needs to be able to create instances of that <a class="el" href="class_node_i_d_class.html">NodeIDClass</a>. It uses <a class="el" href="class_i_tree_view_hierarchy_adapter.html#a21060d89efe2c33d2004bbd0a497b05f">ITreeViewHierarchyAdapter::GetGenericNodeID()</a> to create an instance, then calls ReadWrite() on the <a class="el" href="class_node_i_d_class.html">NodeIDClass</a> to initialize it.<p><b>Implementing <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a></b><p>The next implementation you need to provide is for <a class="el" href="class_i_tree_view_widget_mgr.html">ITreeViewWidgetMgr</a>. This interface is like a widget factory method, because this is where you create widgets for the nodes in the tree. The two main methods are CreateWidgetForNode() and ApplyNodeIDToWidget().<p>The purpose of <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode()</a>is to create the right widget for the <a class="el" href="class_node_i_d.html">NodeID</a> passed in. In this method, create the widget, but do not change the widget data to match the node.<p>Changing the widget data, such as setting the text of a static text widget on a panel to render the data associated with a node, happens in <a class="el" href="class_i_tree_view_widget_mgr.html#a8d7b424d190461d78af89688de7c3c0a">ITreeViewWidgetMgr::ApplyNodeIDToWidget()</a>.<p>These two methods are distinct, because the application framework re-uses widgets that are not needed. The framework creates the widget once in <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode()</a>, then uses it several times by calling <a class="el" href="class_i_tree_view_widget_mgr.html#a8d7b424d190461d78af89688de7c3c0a">ITreeViewWidgetMgr::ApplyNodeIDToWidget()</a> and passing in a different <a class="el" href="class_node_i_d.html">NodeID</a>. In this way, the framework is not continually creating and deleting widgets.<p>The implementation of the <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode()</a> method is where client code creates the widget from the resource, given a node. When the application framework wants to re-use a widget, it calls <a class="el" href="class_i_tree_view_widget_mgr.html#a0c86b0d5d41610dcd827c34a1c953708">ITreeViewWidgetMgr::GetWidgetTypeForNode()</a> to determine what widgets can be used with that node. GetWidgetTypeForNode() returns a WidgetID corresponding to the type of widget given.<p>When creating widgets for different types of nodes, the <a class="el" href="class_i_tree_view_widget_mgr.html#a0c86b0d5d41610dcd827c34a1c953708">ITreeViewWidgetMgr::GetWidgetTypeForNode()</a> method becomes significant. In the <a class="el" href="class_i_tree_view_widget_mgr.html#a6c2dafed8880e3a27d75b15232011d27">ITreeViewWidgetMgr::CreateWidgetForNode()</a> method, you can look at the <a class="el" href="class_node_i_d.html">NodeID</a> and determine what type of node to create.<p>The framework uses the widget&#39;s WidgetID to discriminate between different node types in the tree. The framework only calls <a class="el" href="class_i_tree_view_widget_mgr.html#a8d7b424d190461d78af89688de7c3c0a">ITreeViewWidgetMgr::ApplyNodeIDToWidget()</a> with a widget that has the WidgetID returned in <a class="el" href="class_i_tree_view_widget_mgr.html#a0c86b0d5d41610dcd827c34a1c953708">ITreeViewWidgetMgr::GetWidgetTypeForNode()</a>. For this reason, widgets of the same type must have the same WidgetID.<h2><a class="anchor" id="id_the_quick-apply_dialog"></a> The quick-apply dialog</h2><h3><a class="anchor" id="id_adding_elements_to_the_quick-apply_dialog"></a> Adding elements to the quick-apply dialog</h3><p>Elements are added to the quick-apply dialog using a quick-apply service-provider boss (signature interface <a class="el" href="class_i_quick_apply_service.html">IQuickApplyService</a>). The quick-apply service provides a set of QuickApplyFindListNodes to the application. These identify the name of the item to be added, a type, and an icon to accompany the item in the quick-apply dialog. Once the user selects an item in the quick-apply dialog, each quick-apply service is called in turn until one handles the item.<p>To implement a quick-apply service:<ol type="1"><li>Create the quick-apply service boss class, using the standard kQuickApplyRegisterProviderImpl implementation for the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>, along with a custom implementation of the <a class="el" href="class_i_quick_apply_service.html">IQuickApplyService</a>.<li>Define the action ID for the type of item to be used by the quick-apply service.<li>Provide the implementation of the <a class="el" href="class_i_quick_apply_service.html">IQuickApplyService</a> interface. In the <a class="el" href="class_i_quick_apply_service.html#ae638cda4a3235ad9fc9789bb8c0e995e">IQuickApplyService::GetItemTypesHandled</a>, ensure the prefix key provided in the set of QuickApplyItemRecords does not clash with any previously registered prefix keys (available through the existingItemTypes parameter).</ol><p>For an example of implementing a quick-apply service, see the SnippetRunner SDK sample.<h3><a class="anchor" id="id_filtering_elements_from_the_quick-apply_dialog"></a> Filtering elements from the quick-apply dialog</h3><p>The quick-apply subsystem supports the ability to filter out elements as the quick-apply dialog is being populated through the quick-apply filter service. This is called as entities are added to the quick-apply dialog.<p>To implement a quick-apply filter service:<ol type="1"><li>Create the quick-apply filter service boss class, providing a custom implementation for the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>, along with a custom implementation of the <a class="el" href="class_i_quick_apply_filter_service.html">IQuickApplyFilterService</a>.<li>In the custom service-provider implementation, the GetServiceID method should return kQuickApplyFilterService.<li>In the custom filter service implementation, remove the elements to be filtered from the workingList parameter of the FilterItems method.</ol><p>For an example of implementing a quick-apply filter service, see the SuppUI SDK sample.<h1><a class="anchor" id="id_xml"></a> XML</h1><h2><a class="anchor" id="id_the_xml_user_interface"></a> The XML user interface</h2><h3><a class="anchor" id="id_showing_or_hiding_tagged_frames_or_element_markers"></a> Showing or hiding tagged frames or element markers</h3><p>You can highlight information about tagged content items, by turning on the feature that shows either tagged frames or element markers in stories.<p><b>Solution</b><ol type="1"><li>The <a class="el" href="class_i_x_m_l_preferences.html">IXMLPreferences</a> interface stores this information on the (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) session workspace. Its contents can be changed by processing low-level commands.<li>To change the visibility of tag markers, use the low-level command <a class="el" href="classk_show_tag_markers_cmd_boss.html">kShowTagMarkersCmdBoss</a>. To change the visibility of tagged frames, use <a class="el" href="classk_show_tagged_frames_cmd_boss.html">kShowTaggedFramesCmdBoss</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#a6e72e2b3cc49c13f8548cd9b75a3005a">SnpXMLHelper::ShowHideTaggedFrames</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_preferences.html">IXMLPreferences</a><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a></ul><h3><a class="anchor" id="id_changing_the_visibility_of_the_structure_view"></a> Changing the visibility of the structure view</h3><p>You can show or hide the structure view.<p><b>Solution</b><ol type="1"><li>The visibility of the structure view is stored in an <a class="el" href="class_i_bool_data.html">IBoolData</a> interface with PMIID of IID_ISTRUCTUREISSHOWNBOOLDATA on a document window (<a class="el" href="classk_document_presentation_boss.html">kDocumentPresentationBoss</a>). See <a class="el" href="class_snp_manipulate_structure_view.html#ae5654d55545eafb2a89d4ffc2c8bdf35">SnpManipulateStructureView::IsStructureViewShowing()</a>.<li>If the structure view is not visible and you want to open it, you can toggle its state via an action. Ask the action manager (<a class="el" href="class_i_action_manager.html">IActionManager</a>) to perform an action on (kOpenStructureWinActionID), which toggles the visibility of the structure view. See <a class="el" href="class_snp_manipulate_structure_view.html#a0bede219cab45ff4dbd7803442a3171c">SnpManipulateStructureView::ChangeStructureViewState</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_structure_view.html">SnpManipulateStructureView</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_action_manager.html">IActionManager</a><li><a class="el" href="class_i_bool_data.html">IBoolData</a></ul><h3><a class="anchor" id="id_changing_the_appearance_of_the_structure_view"></a> Changing the appearance of the structure view</h3><p>The structure view can show or hide information about element attributes, XML comments, processing instructions, and, if required, it can show snippets of text from XML elements that have text content. You can vary the information presented to your end users through the structure view and control its appearance.<p><b>Solution</b><p>You can change the appearance of the structure view if you know how to change the data stored in the interface that controls its appearance. The appearance of the structure view is controlled by preferences stored in <a class="el" href="class_i_structure_view_prefs.html">IStructureViewPrefs</a> on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). You can change these in one of two ways:<ul><li>Ask the action manager (<a class="el" href="class_i_action_manager.html">IActionManager</a>) to perform the appropriate action. For example, to toggle the visibility of text snippets in the logical structure view, ask the action manager to perform kStructureShowTextSnippetsActionID.<li>Use the low-level command (<a class="el" href="classk_change_structure_view_prefs_cmd_boss.html">kChangeStructureViewPrefsCmdBoss</a>) that changes the data stored on this interface.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_structure_view.html">SnpManipulateStructureView</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_action_manager.html">IActionManager</a><li><a class="el" href="class_i_structure_view_prefs.html">IStructureViewPrefs</a><li><a class="el" href="classk_change_structure_view_prefs_cmd_boss.html">kChangeStructureViewPrefsCmdBoss</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a></ul><h3><a class="anchor" id="id_making_a_selection_in_the_structure_view"></a> Making a selection in the structure view</h3><p><b>Description</b><p>You can make a programmatic selection in the structure view; for example, to specify the target node in the logical structure where XML should be imported. You should do so only if you are not concerned about trampling on the end-user&#39;s selection, because there is no easy way for you to restore the end-user&#39;s selection after setting your own selection programmatically.<p>If there is a selection in the structure view, you can use the high-level suite interfaces to manipulate logical structure; for instance, to create, modify, and delete elements and attributes (<a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a>).<p><b>Solution</b><p>Use the selection suite named <a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a> to select nodes in the structure view. An instance can be acquired from the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>).<p>The structure view must be visible to use the <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> suite interface associated with an XML selection. The selection architecture is relatively complex but critical to programming InDesign; for details, see the &quot;Selection&quot; chapter of Adobe InDesign Products Programming Guide. The selection subsystem is a facade that tries to abstract away the model-specific details of different selection formats, to let client code deal with selections at a more abstract level.<p>Follow these steps:<ol type="1"><li>Make sure the structure-view window is visible; if required, open it. See <a class="el" href="id_solutions.html#id_changing_the_visibility_of_the_structure_view">Changing the visibility of the structure view</a>.<li>Acquire a reference to the panel in the structure view by widget ID (kXMLPanelWidgetID), defined in the header file <a class="el" href="_x_media_u_i_i_d_8h_source.html">XMediaUIID.h</a>.<li>Obtain an <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> interface and from it <a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a>, and use this to make the selection. You need to pass a vector of <a class="el" href="class_x_m_l_reference.html">XMLReference</a> objects, meaning you need to have a reference to each object you want to select.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_structure_view.html">SnpManipulateStructureView</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_selection_manager.html">ISelectionManager</a><li><a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a><li><a class="el" href="classk_selection_interface_always_active_boss.html">kSelectionInterfaceAlwaysActiveBoss</a><li><a class="el" href="class_x_m_l_reference.html">XMLReference</a></ul><h2><a class="anchor" id="id_xml_import"></a> XML import</h2><h3><a class="anchor" id="id_changing_xml_import_options_on_a_document_to_import"></a> Changing XML import options on a document to import</h3><p>Suppose you are importing XML and you want to import XML into the selected element. For instance, you set a selection using the method described in <a class="el" href="id_solutions.html#id_making_a_selection_in_the_structure_view">Making a selection in the structure view</a>. You have the choice of changing the option that persists with the document or setting the option to import into the selected element for one specific import.<p><b>Solution</b><p>The preference you want is stored in <a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a>. To set up the option for a one-time import, you parameterize an instance of <a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a> through its <a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a> interface. To change the option stored in the document workspace:<ol type="1"><li>Acquire the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) for the document of interest. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Use the low-level command <a class="el" href="classk_change_x_m_l_import_options_cmd_boss.html">kChangeXMLImportOptionsCmdBoss</a> to change the interface <a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a> on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#a25eebf14c884c05e2862a2cab3ec2eb3">SnpXMLHelper::SetImportIntoSelected</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a><li><a class="el" href="classk_change_x_m_l_import_options_cmd_boss.html">kChangeXMLImportOptionsCmdBoss</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a></ul><h3><a class="anchor" id="id_importing_an_xml_file_with_no_selection_in_the_structure_view"></a> Importing an XML file with no selection in the structure view</h3><p>Suppose that you know the path to an XML data file to import, the parent element for the imported elements, and that there is no selection in the structure view. You can import an XML file in this situation.<p><b>Solution</b><p>To import an XML file without a selection, use a low-level command. You can specify the XML element to parent the new elements or specify kInvalidXMLReference, in which case the root becomes the parent for the new elements. Follow these steps:<ol type="1"><li>Create an instance of a <a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a> boss class.<li>Set up its <a class="el" href="class_i_import_x_m_l_data.html">IImportXMLData</a> interface to specify the &quot;import destination,&quot; meaning the parent element.<li>Set up its <a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a> interface; for instance, you might copy <a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a> from the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).<li>You can ignore the other interfaces, unless you are interested in other use cases, like&quot;Transforming imported XML&quot;.<li>Create an instance of the low-level command <a class="el" href="classk_import_x_m_l_file_cmd_boss.html">kImportXMLFileCmdBoss</a> and parameterize its <a class="el" href="class_i_p_m_unknown_data.html">IPMUnknownData</a> to refer to the data-boss object created above. Process the command.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_x_m_l.html">SnpImportExportXML</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_import_x_m_l_data.html">IImportXMLData</a><li><a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a><li><a class="el" href="classk_import_x_m_l_file_cmd_boss.html">kImportXMLFileCmdBoss</a></ul><h3><a class="anchor" id="id_importing_an_xml_file_into_a_selected_element"></a> Importing an XML file into a selected element</h3><p>If you have a selected XML element in the structure view, you can set up the import option to import into the selected node and use a high-level suite interface.<p><b>Solution</b><ol type="1"><li>The preference to import into a selected node is controlled by <a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a>. See <a class="el" href="id_solutions.html#id_changing_xml_import_options_on_a_document_to_import">Changing XML import options on a document to import</a>.<li>Use <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> to perform the import, testing IsImportable.</ol><p><b>Sample code</b><p><a class="el" href="class_snp_import_export_x_m_l.html">SnpImportExportXML</a><h3><a class="anchor" id="id_importing_repeating_elements_into_an_xml_template"></a> Importing repeating elements into an XML template</h3><p><b>Description</b><p>Suppose you have XML content that contains repeat elements; for example, a set of classified advertisements. Suppose you want to flow all the ads into one tagged story, creating new elements within the story for each occurrence of the classified ad. You can do this by turning on the feature to import repeating elements. Since this feature is on by default, unless you do not want it on sometimes and need to turn it off and back on, or the user turns the feature off, you normally may not need to do anything.<p><b>Solution</b><p>This is almost the same as importing XML normally, but you must enable the service that controls import of repeating elements if it is not enabled. The service is an instance of an import matchmaker service (<a class="el" href="classk_x_m_l_repeat_text_elements_match_maker_service_boss.html">kXMLRepeatTextElementsMatchMakerServiceBoss</a>). For the service to run during import, the <a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a> preference needs to be set up correctly.<ol type="1"><li>Acquire the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) for the document of interest. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>. Obtain the <a class="el" href="class_i_x_m_l_import_options_pool.html">IXMLImportOptionsPool</a> interface from the document workspace.<li>Look up the import matchmaker service (<a class="el" href="classk_x_m_l_repeat_text_elements_match_maker_service_boss.html">kXMLRepeatTextElementsMatchMakerServiceBoss</a>) in the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>).<li>Set up its service-specific preference (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>) to turn on the preference to use the service. To see how XML import preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>) are changed, see the XDocBookWorkflow sample.<li>Import XML as described elsewhere; see <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_x_doc_bk_facade.html">XDocBkFacade</a><li>XDocBookWorkflow: <a class="el" href="class_x_doc_bk_change_service_x_m_l_import_prefs_cmd.html">XDocBkChangeServiceXMLImportPrefsCmd</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_import_options_pool.html">IXMLImportOptionsPool</a><li><a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a><li><a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_repeat_text_elements_match_maker_service_boss.html">kXMLRepeatTextElementsMatchMakerServiceBoss</a></ul><h3><a class="anchor" id="id_importing_into_an_xml_template_and_deleting_unmatched_template_elements"></a> Importing into an XML template and deleting unmatched (template) elements</h3><p>Suppose you have an XML template with optional elements (e.g., &lt;copyright&gt;). If these optional elements are not in the input, you can delete them from the XML template, which has placeholders for them, during the import process.<p><b>Solution</b><p>This is almost the same as importing an XML file normally (as described in <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>). The main difference is that you must set up service-specific preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>), as the feature is not enabled by default. Follow these steps:<ol type="1"><li>Acquire the document workspace (kDocWorkspace) from the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) of interest, corresponding to your XML template document.<li>Look up the required import matchmaker service (kXMLImportMatchMakerSignalService) by ClassID (<a class="el" href="classk_x_m_l_throw_away_unmatched_right_match_maker_service_boss.html">kXMLThrowAwayUnmatchedRightMatchMakerServiceBoss</a>) in the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>). This is the service that supports deleting unmatched existing elements. &quot;Right&quot; elements correspond to those in the XML template document; &quot;left&quot; elements, those in the incoming XML. The service object obtained should support the IXMLImportMatchmaker interface.<li>Change the service-specific preference (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>); the zero-th (boolean) preference controls turning the service on or off. To see how XML import preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>) are changed, see the XDocBookWorkflow sample.<li>Do the XML import as usual; see <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_x_doc_bk_change_service_x_m_l_import_prefs_cmd.html">XDocBkChangeServiceXMLImportPrefsCmd</a><li><a class="el" href="class_x_doc_bk_facade.html">XDocBkFacade</a><li>XDocBookWorkflow</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="class_i_x_m_l_import_match_maker.html">IXMLImportMatchMaker</a><li><a class="el" href="class_i_x_m_l_import_options_pool.html">IXMLImportOptionsPool</a><li><a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a><li><a class="el" href="classk_x_m_l_throw_away_unmatched_right_match_maker_service_boss.html">kXMLThrowAwayUnmatchedRightMatchMakerServiceBoss</a></ul><h3><a class="anchor" id="id_importing_into_an_xml_template_and_deleting_unmatched_incoming_elements"></a> Importing into an XML template and deleting unmatched incoming elements</h3><p>Suppose you created an XML template and have XML-based data to import, with tagged placeholders for elements in the incoming XML you want to include in your document. There are optional elements in the incoming XML, which you do not want to include in your InDesign document once imported; for instance, an element &lt;media-metadata&gt;. You can delete incoming elements that do not have a match in the XML template.<p><b>Solution</b><p>This is almost the same as importing an XML file normally (as described in <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>). The main difference is that you must set up service-specific preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>), as the feature is not enabled by default. Follow these steps:<ol type="1"><li>Acquire the document workspace (kDocWorkspace) from the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) of interest, corresponding to your XML template document.<li>Look up the required import matchmaker service (kXMLImportMatchMakerSignalService) by ClassID (<a class="el" href="classk_x_m_l_throw_away_unmatched_left_match_maker_service_boss.html">kXMLThrowAwayUnmatchedLeftMatchMakerServiceBoss</a>) in the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>). This is the service that supports deleting unmatched incoming XML elements. &quot;Right&quot; elements correspond to those in the XML template document; &quot;left&quot; elements, those in the incoming XML. The service object obtained should support the IXMLImportMatchmaker interface.<li>Set the service-specific preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>); the zero-th (boolean) preference controls turning the service on or off. To see how XML import preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>) are changed, see the XDocBookWorkflow sample.<li>Do the XML import as usual; see <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_x_doc_bk_facade.html">XDocBkFacade</a><li>XDocBookWorkflow: <a class="el" href="class_x_doc_bk_change_service_x_m_l_import_prefs_cmd.html">XDocBkChangeServiceXMLImportPrefsCmd</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a><li><a class="el" href="class_i_x_m_l_import_options_pool.html">IXMLImportOptionsPool</a><li><a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_throw_away_unmatched_left_match_maker_service_boss.html">kXMLThrowAwayUnmatchedLeftMatchMakerServiceBoss</a></ul><h3><a class="anchor" id="id_importing_a_cals_table_as_an_indesign_table"></a> Importing a CALS table as an indesign table</h3><p>Suppose you have XML data that includes tables specified in CALS table format. You can import these tables into InDesign and manipulate them like InDesign tables.<p><b>Solution</b><p>This is almost the same as importing an XML file normally (as described in <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>). The main difference is that you must set up service-specific preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>). Follow these steps:<ol type="1"><li>Acquire the document workspace (kDocWorkspace) from the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) of interest, corresponding to your XML template document.<li>Look up the required import matchmaker service (kXMLImportMatchMakerSignalService) by ClassID (<a class="el" href="classk_x_m_l_table_match_maker_service_boss.html">kXMLTableMatchMakerServiceBoss</a>) in the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>). The service object obtained should support the IXMLImportMatchmaker interface.<li>Query and set the service-specific preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>), using the IID_IXMLIMPORTCALSPREFERENCES identifier. The zero-th (boolean) preference controls turning the service on or off. To see how XML import preferences (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>) are changed, see the XDocBookWorkflow sample. This service also supports deleting unmatched incoming XML elements (&quot;left&quot;) and/or existing elements (&quot;Right&quot;) for table cells.<li>Do the XML import as usual; see <a class="el" href="id_solutions.html#id_importing_an_xml_file_with_no_selection_in_the_structure_view">Importing an XML file with no selection in the structure view</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_x_doc_bk_facade.html">XDocBkFacade</a><li>XDocBookWorkflow: <a class="el" href="class_x_doc_bk_change_service_x_m_l_import_prefs_cmd.html">XDocBkChangeServiceXMLImportPrefsCmd</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a><li><a class="el" href="class_i_x_m_l_import_options_pool.html">IXMLImportOptionsPool</a><li><a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_throw_away_unmatched_left_match_maker_service_boss.html">kXMLThrowAwayUnmatchedLeftMatchMakerServiceBoss</a></ul><h3><a class="anchor" id="id_taking_control_when_the_dom_is_serialized_into_the_document"></a> Taking control when the DOM is serialized into the document</h3><p>Suppose you have custom content defined in an XML vocabulary embedded in XML that is being imported. You can take control when the DOM is serialized into the document.<p><b>Solution</b><p>Implement a SAX DOM serializer handler (<a class="el" href="class_i_s_a_x_d_o_m_serializer_handler.html">ISAXDOMSerializerHandler</a>).<p>For instance, InDesign supports XML round-tripping of untagged tables and Ruby (annotations intended for Japanese and other ideographic writing systems) through this mechanism.<p><b>Sample code</b><ul><li>XDocBookWorkflow: <a class="el" href="class_x_doc_bk_c_a_l_s_content_handler.html">XDocBkCALSContentHandler</a><li>XMLDataUpdater: <a class="el" href="class_data_updater_d_o_m_serializer_handler.html">DataUpdaterDOMSerializerHandler</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_s_a_x_d_o_m_serializer_handler.html">ISAXDOMSerializerHandler</a></ul><h3><a class="anchor" id="id_reading_a_configuration_from_an_xml_file"></a> Reading a configuration from an XML file</h3><p>Suppose you have configuration data expressed in XML, and you want to read this data but are not interested in importing the XML directly into a document. You can read XML data but use the application&#39;s XML parser.<p><b>Solution</b><p>Implement a custom SAX content handler (<a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a>), which lets you take control when the XML parser encounters elements you registered to handle.<p><b>Sample code</b><ul><li>XMLCatalogHandler</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a></ul><h2><a class="anchor" id="id_xml_export"></a> XML export</h2><h3><a class="anchor" id="id_controlling_xml_export_options"></a> Controlling XML export options</h3><p>You can vary XML export options, like whether to export from the selected element or vary the encoding of the XML exported from the default UTF-8.<p><b>Solution</b><ol type="1"><li>Export options are stored in the <a class="el" href="class_i_x_m_l_export_options.html">IXMLExportOptions</a> interface of the workspace. Acquire the correct workspace, namely the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) for the document of interest. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Use the low-level command <a class="el" href="classk_change_x_m_l_export_options_cmd_boss.html">kChangeXMLExportOptionsCmdBoss</a> to change the data stored on the workspace interface.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#ab9066a610d4536ec96d3702b8a364723">SnpXMLHelper::SetExportFromSelected</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_export_options.html">IXMLExportOptions</a><li><a class="el" href="classk_change_x_m_l_export_options_cmd_boss.html">kChangeXMLExportOptionsCmdBoss</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a></ul><h3><a class="anchor" id="id_exporting_xml_data_from_a_selection_in_the_structure_view"></a> Exporting XML data from a selection in the structure view</h3><p>If you have one or more nodes selected in the structure view, you can export this as an XML data file.<p><b>Solution</b><ol type="1"><li>To perform the export, use <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a>, which depends on a selection of nodes in the structure view. Obtain this interface from the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>).<li>Verify the preconditions, and call the required method on <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html#a2c7e75044354a7326ea90304c96ec4b7">SnpManipulateXMLSelection::ExportFromSelection</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a></ul><h3><a class="anchor" id="id_exporting_xml_data_without_a_selection_in_the_structure_view"></a> Exporting XML data without a selection in the structure view</h3><p>Suppose you want to export XML from the logical structure of your InDesign document. If you have a selection in the structure view, use a high-level suite interface, as described in <a class="el" href="id_solutions.html#id_exporting_xml_data_from_a_selection_in_the_structure_view">Exporting XML data from a selection in the structure view</a>. Without a selection, you can use the lower-level export provider mechanism.<p><b>Solution</b><p>XML export uses the standard export provider architecture, so you can use the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>), as follows:<ol type="1"><li>Obtain a reference to the XML export service from the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>). You need the ServiceID that identifies an export service (kExportProviderService) and a ClassID for the XML export service (<a class="el" href="classk_x_m_l_export_provider_boss.html">kXMLExportProviderBoss</a>).<li>Pass a reference to a file to which you want to export (use SDKFileSaveHelper), and use the methods on <a class="el" href="class_i_export_provider.html">IExportProvider</a> to export the data.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_x_m_l.html">SnpImportExportXML</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_export_provider.html">IExportProvider</a><li><a class="el" href="class_i_x_m_l_export_options.html">IXMLExportOptions</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_export_provider_boss.html">kXMLExportProviderBoss</a></ul><h3><a class="anchor" id="id_exporting_xml_from_a_table"></a> Exporting XML from a table</h3><p><b>Description</b><p>You can export a tagged table as an XML data file.<p><b>Solution</b><ol type="1"><li>If the table is tagged, it can be exported as part of XML export. A table is represented by <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>, which may be associated with an element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) via IXMLreferenceData interface, if it is a tagged table.<li>Locate the associated element via <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> interface on the table (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>).<li>Export from the associated element using an appropriate method. See <a class="el" href="class_snp_import_export_x_m_l.html#a6424c2a3fbd7361ca14532cfb37b5c22">SnpImportExportXML::ExportElement</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_x_m_l.html#a6424c2a3fbd7361ca14532cfb37b5c22">SnpImportExportXML::ExportElement</a><li><a class="el" href="class_snp_import_export_x_m_l.html#af22a77cddb28771f9750be407335f129">SnpImportExportXML::ExportTable</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a><li><a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> (<a class="el" href="class_i_table_model.html">ITableModel</a>)</ul><h3><a class="anchor" id="id_altering_xml_structure_during_export"></a> Altering XML structure during export</h3><p>If you have custom XML content, you can control the format of the content element when it is exported to XML file.<p><b>Solution</b><p>Use the XML Export handler extension pattern. Implement an XML export handler (<a class="el" href="class_i_x_m_l_export_handler.html">IXMLExportHandler</a>) as the provider of kXMLExportHandlerSignalService. In the provider, you can specify your custom way to write out specific XML elements.<p>For example, in the XML data updater sample plug-in, each data field is an XML element; however, during export, you can group all fields of a record into one XML element, to provide a more readable format.<p><b>Sample code</b><ul><li>XMLDataUpdater: <a class="el" href="class_data_updater_export_handler.html">DataUpdaterExportHandler</a>.</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_export_handler.html">IXMLExportHandler</a></ul><h2><a class="anchor" id="id_tags"></a> Tags</h2><h3><a class="anchor" id="id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects"></a> Acquiring the correct workspace for storing or obtaining tags and related objects</h3><p>When you are creating tags and related objects (like tag-style mappings), you must decide where to store them. If you are acquiring references to objects that already exist, you also need to know where to look for them.<p><b>Solution</b><p>The choice is highly constrained for objects like tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) and related tag-style mappings (<a class="el" href="class_i_x_m_l_tag_to_style_map.html">IXMLTagToStyleMap</a>, <a class="el" href="class_i_x_m_l_style_to_tag_map.html">IXMLStyleToTagMap</a>); it will be a workspace (<a class="el" href="class_i_workspace.html">IWorkspace</a>) of some kind.<p>Tags are in the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) or document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). To establish default tags for new documents, create tags in the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). If you want the objects to be available only within a particular document, you create tags in the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) for the document of interest; see IDocument::GetDocWorkspace().<p>There are other kinds of information stored at the workspace level; see the API documentation for <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> or <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, and examine the interfaces that contain &quot;XML.&quot; Tag-to-style maps, style-to-tag maps, and import/export options are among the other kinds of information stored in workspaces.<p>To change this information, you must identify the target workspace in which the change is to take place.<p>How to obtain a reference to the workspace of interest depends on whether you are writing client code (user interface code) or model (model manipulation) code:<ol type="1"><li>If you are writing client code and have an <a class="el" href="class_i_active_context.html">IActiveContext</a> interface pointer, use IActiveContext::GetContextWorkspace().<li>If you are writing model code, use IDocument::GetDocWorkspace() to acquire a reference to the <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> for a given document (<a class="el" href="class_i_document.html">IDocument</a>).</ol><p>There are several methods on <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a> that let you acquire XML-related interfaces on the workspaces, given a document database (<a class="el" href="class_i_data_base.html">IDataBase</a>).<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html">SnpManipulateXMLTags</a><li><a class="el" href="class_snp_x_m_l_helper.html">SnpXMLHelper</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_active_context.html">IActiveContext</a><li><a class="el" href="class_i_document.html">IDocument</a><li><a class="el" href="class_i_workspace.html">IWorkspace</a><li><a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a></ul><h3><a class="anchor" id="id_loading_tags"></a> Loading tags</h3><p>Loading a set of tags from an XML file means that they can be used to mark up content items in the document. You also can load tags through importing a DTD, in which case InDesign creates tags when it finds element declarations in the DTD.<p><b>Solution</b><p>The tag list (see the API documentation for <a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) for a document is in the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). You can change the contents of the tag list through <a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a>, as follows:<ol type="1"><li>Use the <a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a> command facade to load the tag list from the file specified.<li>Choose the workspace to target. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Use <a class="el" href="class_s_d_k_file_helper.html">SDKFileHelper</a> to make presenting a file-open dialog more straightforward, if one is required.</ol><p>Loading tags means changing the tag list (<a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) stored in a workspace. Which workspace to target depends on whether you just want to set up a default tag set for subsequent new documents or create a tag set for a given document. Note the following:<ul><li>Tags loaded into the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) become the default set for new documents.<li>Tags loaded into the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) can be used to mark up content items and create elements in the document.</ul><p>Under the hood, the low-level command <a class="el" href="classk_load_tag_list_cmd_boss.html">kLoadTagListCmdBoss</a> is processed whenever a tag-list is imported.<p>The following is and example of a tag list. <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-16&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;article colorindex=<span class="stringliteral">&quot;4&quot;</span>&gt;</div><div class="line"> &lt;articleinfo colorindex=<span class="stringliteral">&quot;6&quot;</span>/&gt;</div><div class="line"> ... (other elements omitted) </div><div class="line"> &lt;ulink colorindex=<span class="stringliteral">&quot;19&quot;</span>/&gt;</div><div class="line">&lt;/article&gt;</div></div><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html#ae6254007ba194963f313e4d2f72b8c90">SnpManipulateXMLTags::LoadTags</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a><li><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a></ul><h3><a class="anchor" id="id_saving_tags"></a> Saving tags</h3><p>You can save the tag list from a document, to enable the tags to be used in other documents or as defaults for new documents.<p><b>Solution</b><p>First, decide which tag list you want to save; that is, what workspace does it come from, and where to save it in the file system. Then follow these steps:<ol type="1"><li>To save a tag list programmatically, use IXMLTagCommands::SaveTags().<li>Choose the workspace to target, which is most likely a document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) from a document of interest. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Specify the target file to save the tag list to, which normally has an extension of &quot;.xml.&quot; Use <a class="el" href="class_s_d_k_file_helper.html">SDKFileHelper</a> to make presenting a file-save dialog to the end user more straightforward, if one is required.</ol><p>The tag list is exported as an XML document, with elements specifying the name and color index for each tag. A fragment of a tag list is shown in Loading tags.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html#acbbb5559832d76701392dd8b556d6a0f">SnpManipulateXMLTags::SaveTags</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a><li><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a><li><a class="el" href="class_s_d_k_file_helper.html">SDKFileHelper</a></ul><h3><a class="anchor" id="id_creating_tags"></a> Creating tags</h3><p>To tag document content (for example, with tags like &quot;headline&quot;), you need to create tag objects (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) in the document&#39;s tag list.<p><b>Solution</b><p>Tag objects (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) are managed by the <a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a> interface on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> or <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. Follow these steps:<ol type="1"><li>Choose the workspace in which the tag is to be created. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Use <a class="el" href="class_i_x_m_l_tag_commands.html#a7f3da5bfc0e580baeb25be33ca1ce44c">IXMLTagCommands::CreateTag()</a> to create a tag object (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#a5b53960ed9523bc44244c78b8b41f419">SnpXMLHelper::AcquireTag</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_tag.html">IXMLTag</a><li><a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a><li><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a></ul><h3><a class="anchor" id="id_acquiring_a_reference_to_a_tag"></a> Acquiring a reference to a tag</h3><p>To create an XML element, you need a reference to a tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) that represents its name. Similarly, to apply a tag to content, like a story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), graphic frame, or text range, you need a reference to a tag object.<p>Tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) are stored in the tag list (<a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) in a workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). The tags specific to a document are held in its workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). The tag list is a collection of boss objects (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) that represent tags.<p><b>Solution</b><ol type="1"><li>Choose the workspace in which the tag is stored. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li><a class="el" href="class_i_x_m_l_tag_list.html#a9c226cf010202af7b5f269e7b40e4802">IXMLTagList::GetTag()</a> returns the UID of the tag object (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) with the specified name, which can be used to instantiate an <a class="el" href="class_i_x_m_l_tag.html">IXMLTag</a> interface.<li>If the named tag does not exist, use <a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a> (<a class="el" href="classk_utils_boss.html">kUtilsBoss</a>) to create a new one with the specified name.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#a5b53960ed9523bc44244c78b8b41f419">SnpXMLHelper::AcquireTag</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_tag.html">IXMLTag</a><li><a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a><li><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a></ul><h3><a class="anchor" id="id_finding_a_tags_color"></a> Finding a tag&#39;s color</h3><p>Tags are represented by <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>. The <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> interface on <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a> refers to an instance of <a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a>, which stores the tag color.<p><b>Solution</b><ol type="1"><li>Acquire a reference to the tag whose color you want to find of; see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_tag">Acquiring a reference to a tag</a><li>To determine the color of the tag as it appears in the user interface, navigate from the <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a> object to the associated <a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a> object that stores its color.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#a44d56e21fffdefbd99df0c7e7b242170">SnpXMLHelper::AsString(const UIDRef&amp; tagUIDRef)</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_color_data.html">IColorData</a><li><a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a><li><a class="el" href="class_i_x_m_l_tag.html">IXMLTag</a><li><a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a><li><a class="el" href="class_i_u_i_color_utils.html">IUIColorUtils</a><li><a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a><li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a></ul><h3><a class="anchor" id="id_changing_tag_properties"></a> Changing tag properties</h3><p>You can change a tag&#39;s name and/or color. If you change the name, any tagged content items that used the old tag are tagged with the new tag.<p><b>Solution</b><ol type="1"><li>Acquire a reference to the tag you want to change the properties; see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_tag">Acquiring a reference to a tag</a>.<li>To change its properties, use the <a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a> command facade (<a class="el" href="classk_utils_boss.html">kUtilsBoss</a>). To change its color, acquire the UID of a <a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a> object. One way to do this is through <a class="el" href="class_i_u_i_color_utils.html#a5e559eac04e13d255b553b7f160cb840">IUIColorUtils::GetUIColor()</a>. To create a completely new UI color (<a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a>), use <a class="el" href="classk_new_u_i_color_cmd_boss.html">kNewUIColorCmdBoss</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_x_m_l_helper.html#a2d08687534686998277ccdbf86159f7b">SnpXMLHelper::ChangeTagName</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_u_i_color_utils.html">IUIColorUtils</a><li><a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a><li>kNewUIColorCmd<li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a><li><a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a></ul><h3><a class="anchor" id="id_creating_a_mapping_from_tag_to_style"></a> Creating a mapping from tag to style</h3><p>You can specify the appearance of XML-based content once it is imported into InDesign.<p><b>Solution</b><p>This mapping is stored in the <a class="el" href="class_i_x_m_l_tag_to_style_map.html">IXMLTagToStyleMap</a> interface on a workspace (kDocWorkspaceBoss/ <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). Follow these steps:<ol type="1"><li>Choose the workspace containing the tag-to-style map to which you want to add. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Use <a class="el" href="class_i_x_m_l_mapping_commands.html#acf0fcc929f4c0aa8406a76d7127900ff">IXMLMappingCommands::MapTagToStyle()</a> to set up an association between a tag and a paragraph or character style.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html">SnpManipulateXMLTags</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_mapping_commands.html">IXMLMappingCommands</a></ul><h3><a class="anchor" id="id_creating_a_mapping_from_style_to_tag"></a> Creating a mapping from style to tag</h3><p>Suppose that have a document with systematically applied styles (character/paragraph styles); you can create a logical structure that takes advantage of the systematic way the styles are used.<p><b>Solution</b><p>The first part of this process is creating a set of associations between styles that exist in the document and tags that will be used to mark up content in each style. This mapping (<a class="el" href="class_i_x_m_l_style_to_tag_map.html">IXMLStyleToTagMap</a>) is held in a workspace (kDocWorkspaceBoss/ <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). Follow these steps:<ol type="1"><li>Choose the workspace containing the style-to-tag map to which you want to add. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Acquire a reference to the style (<a class="el" href="classk_style_boss.html">kStyleBoss</a>) you want to associate with a tag. These are held in the style-name tables (<a class="el" href="class_i_style_name_table.html">IStyleNameTable</a>) on a workspace, with different PMIIDs for paragraph styles and character styles.<li>Acquire a reference to the tag you want to associate with the given style, and use <a class="el" href="class_i_x_m_l_mapping_commands.html#a719a1d9c23302038d6892c9482c38838">IXMLMappingCommands::MapStyleToTag()</a>.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html">SnpManipulateXMLTags</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_mapping_commands.html">IXMLMappingCommands</a></ul><h3><a class="anchor" id="id_applying_tag-to-style_mapping_to_style_incoming_xml"></a> Applying tag-to-style mapping to style incoming XML</h3><p>You can use styles in a document to style incoming XML. Assume you already set up the associations between tags and styles in the XML template (as described in <a class="el" href="id_solutions.html#id_creating_a_mapping_from_tag_to_style">Creating a mapping from tag to style</a>). What you need to do is apply the mapping that is already set up within the document.<p><b>Solution</b><p>Even if you added to the mapping new associations between tags and styles, the document would not appear any different until you apply the mapping to the document. To do this, you must process a low-level command, as follows:<ol type="1"><li>Acquire the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) for the document of interest. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Use <a class="el" href="classk_x_m_l_apply_tag_to_style_mapping_cmd_boss.html">kXMLApplyTagToStyleMappingCmdBoss</a>, which applies the tag-to-style map stored in the <a class="el" href="class_i_x_m_l_tag_to_style_map.html">IXMLTagToStyleMap</a> interface of the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html">SnpManipulateXMLTags</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_tag_to_style_map.html">IXMLTagToStyleMap</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_apply_tag_to_style_mapping_cmd_boss.html">kXMLApplyTagToStyleMappingCmdBoss</a></ul><h3><a class="anchor" id="id_applying_style-to-tag_mapping_to_structure_a_document"></a> Applying style-to-tag mapping to structure a document</h3><p>Assume you created an associative mapping from styles to tags, because you want to apply structure to a document with systematically applied styles; see <a class="el" href="id_solutions.html#id_creating_a_mapping_from_style_to_tag">Creating a mapping from style to tag</a>. Having created the mapping within the document workspace, you need to apply the mapping, for the structure to be created in the document.<p><b>Solution</b><ol type="1"><li>Acquire the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) for the document of interest. See <a class="el" href="id_solutions.html#id_acquiring_the_correct_workspace_for_storing_or_obtaining_tags_and_related_objects">Acquiring the correct workspace for storing or obtaining tags and related objects</a>.<li>Identify the tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) you want to be applied.<li>Use <a class="el" href="classk_x_m_l_create_style_to_tag_elements_cmd_boss.html">kXMLCreateStyleToTagElementsCmdBoss</a>, which styles the text in the document with the rules specified in the style-to-tag map stored in the IStyleToTagMap interface of the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).<li>Untagged stories after processing the command are tagged with the tag specified on the command data interface (<a class="el" href="class_i_x_m_l_create_style_to_tag_elements_cmd_data.html">IXMLCreateStyleToTagElementsCmdData</a>). Text ranges in the styles identified in the mapping from styles-to-tags are tagged with the corresponding tags.</ol><p>Pay attention to naming in this area, as there is a low-level command to process, <a class="el" href="classk_x_m_l_create_style_to_tag_elements_cmd_boss.html">kXMLCreateStyleToTagElementsCmdBoss</a>, which has a slightly different name than the low-level command in <a class="el" href="id_solutions.html#id_applying_tag-to-style_mapping_to_style_incoming_xml">Applying tag-to-style mapping to style incoming XML</a>. The name &quot;kXMLCreateStyleToTagElementsCmdBoss&quot; is logically correct, since when applying a style-to-tag mapping, you are creating new XML elements in the logical structure. The operation of applying a tag-to-style map does not create new styles, it only applies existing ones with the specified names.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html">SnpManipulateXMLTags</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_create_style_to_tag_elements_cmd_data.html">IXMLCreateStyleToTagElementsCmdData</a><li><a class="el" href="class_i_x_m_l_style_to_tag_map.html">IXMLStyleToTagMap</a><li><a class="el" href="class_i_x_m_l_tag.html">IXMLTag</a><li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a><li><a class="el" href="classk_x_m_l_create_style_to_tag_elements_cmd_boss.html">kXMLCreateStyleToTagElementsCmdBoss</a><li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a></ul><h2><a class="anchor" id="id_elements_and_content"></a> Elements and content</h2><h3><a class="anchor" id="id_acquiring_a_reference_to_the_root_element"></a> Acquiring a reference to the root element</h3><p>You can iterate through the logical structure from its root or start validating the logical structure from the root. For these use cases, you need a reference to the root element in the logical structure.<p>The root element is represented by a <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a> class, manipulated through its <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface.<p><b>Solution</b><ol type="1"><li>Get a reference to the root object through a method on <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a>, given a reference to the document (<a class="el" href="class_i_document.html">IDocument</a>, on <a class="el" href="classk_doc_boss.html">kDocBoss</a>) or its database (<a class="el" href="class_i_data_base.html">IDataBase</a>). For example: <div class="fragment"><div class="line"><span class="comment">// If you have a reference to a document database (IDataBase), you can write:</span></div><div class="line"><span class="comment">// InterfacePtr&lt;IIDXMLElement&gt; rootXMLElement(Utils&lt;IXMLUtils&gt;()-&gt;QueryRootElement(dataBase));</span></div><div class="line"><span class="comment">// Alternatively, pass a reference to a document (IDocument). </span></div><div class="line"><span class="comment">// See API docs for details.</span></div></div><li>The interface pointer <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> returns references to an instance of <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a>, corresponding to the root element visible when the structure view is shown.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a><li><a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a></ul><h3><a class="anchor" id="id_acquiring_a_reference_to_the_document_element"></a> Acquiring a reference to the document element</h3><p>The document element is the parent of the root element and peers of the root element, such as the DTD element and comments and processing instructions at the document level. To iterate through these top-level elements, you need a reference to the document element. You also need a reference to the document element when dealing with XML validation.<p>The document element is represented by the <a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a> class.<p><b>Solution</b><p>Use a method on <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a> to acquire a reference to the instance of <a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a> that represents the XML element for a given InDesign document.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a><li><a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a></ul><h3><a class="anchor" id="id_iterating_through_the_logical_structure"></a> Iterating through the logical structure</h3><p>You can traverse the tree of XML elements in a document; for example, to find elements that match a particular specification and then take some action.<p><b>Solution</b><p>To iterate through the logical structure during import, implement an extension pattern; in the &quot;XML Fundamentals&quot; chapter of Adobe InDesign Programming Guide, see the section on &quot;Post-Import Responder.&quot; To iterate through the logical structure once the document is fully loaded, start from the root, iterate through its children, and descend the tree recursively. Follow these steps:<ol type="1"><li>Start by acquiring a reference to the root element, which gives you an <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface pointer as a starting point.<li>Traverse the tree using the methods on <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> like GetChildCount() and GetNthChild. For each <a class="el" href="class_x_m_l_reference.html">XMLReference</a>, use <a class="el" href="class_x_m_l_reference.html#a3375f2d7050442c2492b1acd23cad2ec">XMLReference::Instantiate</a> to acquire an interface <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> to continue the iteration.<li>Recursively descend the element tree using these methods. This lets you iterate over the elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>).<li>If the parent element is a story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) and you are interested in the text ranges associated with children, use <a class="el" href="class_x_m_l_content_iterator.html">XMLContentIterator</a> (constructed via a reference to an IIDMLElement) to quickly find out the range of text associated with each XML element.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a><li><a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a><li><a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a><li><a class="el" href="class_x_m_l_content_iterator.html">XMLContentIterator</a><li><a class="el" href="class_x_m_l_reference.html">XMLReference</a></ul><h3><a class="anchor" id="id_determining_what_can_be_tagged"></a> Determining what can be tagged</h3><p>If you have a reference to a page item or other object, you can determine whether it can be tagged.<p><b>Solution</b><p>The <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a> utility interface has a method, IsTaggablePageItem, that allows client code to determine whether a given boss object can be tagged. There also is a method on <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a>, GetActualContent, which lets client code acquire a reference (<a class="el" href="class_u_i_d_ref.html">UIDRef</a>) to the underlying object supporting the tagging operation (see <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a>).<p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_selection_x_m_l_properties.html#a2c06e1e2f5efb11538fa3ed641381b8a">SnpInspectSelectionXMLProperties::InspectLayoutObject</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a><li><a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a></ul><h3><a class="anchor" id="id_finding_text_associated_with_tagged_text_ranges"></a> Finding text associated with tagged text ranges</h3><p>If you have a tagged story, you can find out what text is tagged and by what element within each story.<p><b>Solution</b><p>Use <a class="el" href="class_x_m_l_content_iterator.html">XMLContentIterator</a> to traverse the child elements of a given element. This is particularly useful for elements with text content; e.g. tag text ranges.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_inspect_selection_x_m_l_properties.html#af75ac211d3fd14dbacbe86b782c6acb7">SnpInspectSelectionXMLProperties::InspectText</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_x_m_l_content_iterator.html">XMLContentIterator</a></ul><h3><a class="anchor" id="id_creating_new_elements_with_parent_selected"></a> Creating new elements with parent selected</h3><p>If you have a selection, or you know how to create a selection in the structure view programmatically, you can create new elements in the logical structure easily. If you have no selection or it is inconvenient or not possible to create one, use the method described in <a class="el" href="id_solutions.html#id_creating_new_elements_with_no_selection">Creating new elements with no selection</a>.<p>One way to add and remove elements from the logical structure is to use the <a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a> suite interface to program a selection in the structure view, then use <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a>, which acts on a selection in the structure view.<p>Under the hood, when an element is created, the low-level command <a class="el" href="classk_x_m_l_create_element_cmd_boss.html">kXMLCreateElementCmdBoss</a> is processed. When an element is deleted, the low-level command <a class="el" href="classk_x_m_l_delete_element_cmd_boss.html">kXMLDeleteElementCmdBoss</a> is processed.<p>You can create, modify, and delete attributes with methods on <a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a>.<p><b>Solution</b><ol type="1"><li>Make a selection in the structure view, if one does not exist already.<li>Obtain the tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) you need from the tag list (<a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) or add a tag for the element you want if it does not exist already.<li>Obtain the <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> suite interface and use it to add an element based on the required tag.</ol><p><b>Related documentation</b><ul><li><a class="el" href="id_solutions.html#id_making_a_selection_in_the_structure_view">Making a selection in the structure view</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html#a428ab03d0f60a798278bcdc10978c4df">SnpManipulateXMLSelection::CreateElementsInSelection</a></ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a></ul><h3><a class="anchor" id="id_creating_new_elements_with_no_selection"></a> Creating new elements with no selection</h3><p><b>Description</b><p>You can create new elements in the logical structure, with a known parent and no selection in any view. If you have a selection in the structure view that indicates the new parent, use the method described in <a class="el" href="id_solutions.html#id_creating_new_elements_with_parent_selected">Creating new elements with parent selected</a>.<p><b>Solution</b><p>The <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> command facade provides methods (CreateElement overloads) to create a new element in the logical structure not associated with a content item. Follow these steps:<ol type="1"><li>You need to know the <a class="el" href="class_x_m_l_reference.html">XMLReference</a> of the parent. For instance, use the <a class="el" href="class_x_m_l_reference.html">XMLReference</a> of the root element to create an element as a child of the root.<li>You need a reference to the tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) that will be associated with the element.<li>Use the <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> facade to create an instance of a new element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a><li><a class="el" href="class_snp_manipulate_x_m_l_tags.html">SnpManipulateXMLTags</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a><li><a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a><li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a></ul><h3><a class="anchor" id="id_modifying_attributes_in_a_selected_element"></a> Modifying attributes in a selected element</h3><p>If you have a selected element in the structure view, you can modify its attributes; for example, create a new attribute, change an existing attribute, or delete an attribute.<p><b>Solution</b><p>The <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> suite interface, which can be used in the case of a selection in the structure view, provides methods to make this straightforward. Follow these steps:<ol type="1"><li>Obtain an <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> interface from the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>).<li>Verify CanAddAttribute/ CanAddSpecificAttribute and call AddAttribute.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html">SnpManipulateXMLSelection</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a><li><a class="el" href="classk_utils_boss.html">kUtilsBoss</a></ul><h3><a class="anchor" id="id_modifying_attributes_without_a_selection"></a> Modifying attributes without a selection</h3><p>Assume that there is no selection of any kind. You can create, modify, or delete attributes of an element in the logical structure.<p><b>Solution</b><p>There is a command facade (<a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a>) on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> boss class, which provides methods to make this straightforward. Follow these steps:<ol type="1"><li>Acquire an <a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a> interface from <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>.<li>Use the appropriate facade method to create, delete, or update an attribute.</ol><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a></ul><h3><a class="anchor" id="id_tagging_graphics"></a> Tagging graphics</h3><p>You can tag a graphic frame as a placeholder for an image you will import later or already imported.<p><b>Solution</b><p>The procedure depends on whether you have a selection. If you have no selection of any kind, follow these steps:<ol type="1"><li>Acquire a reference to the tag that you want to use; see <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_tag">Acquiring a reference to a tag</a>.<li>Acquire a reference to the graphic frame you want to tag; for instance, an object that exposes the <a class="el" href="class_i_graphic_frame_data.html">IGraphicFrameData</a> interface. The object you are trying to tag needs to support <a class="el" href="class_i_x_m_l_utils.html#a5b1607f7ead6a7883a96c367fac53f43">IXMLUtils::IsTaggablePageItem()</a>.<li>Use <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> to tag the graphic frame; look for the overloaded CreateElement methods with the &quot;UID contentItem&quot; parameter in their method signature. Tagging an object in the layout creates an XML element; this is why you need the CreateElement methods.</ol><p>If you have a selection, use the <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a> interface. This suite is available in many views; for instance, if the graphic frame to be tagged is selected in the layout view, use <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a>.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html">SnpManipulateXMLSelection</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a><li><a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a></ul><h3><a class="anchor" id="id_tagging_a_story"></a> Tagging a story</h3><p><b>Description</b><p>You can tag a story as a placeholder for stories in incoming XML, or tag an existing story.<p><b>Solution</b><p>The solution depends on whether you have an existing selection. If there is no selection, follow these steps:<ol type="1"><li>Acquire a reference to the story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) of interest; for instance, through its <a class="el" href="class_i_text_model.html">ITextModel</a> interface.<li>Acquire a reference to the tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) you want to use. See <a class="el" href="id_solutions.html#id_acquiring_a_reference_to_a_tag">Acquiring a reference to a tag</a>.<li>Use <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> facade. There is an overloaded CreateElement that takes the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the tag and the story.</ol><p>If there is an existing selection, follow these steps:<ol type="1"><li>Acquire an <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a> interface pointer.<li>Acquire a reference to the tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) you want to use.<li>Use the appropriate method on <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a> (SetTag) to tag the story, verifying the preconditions (CanTag) before executing it.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html">SnpManipulateXMLSelection</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a><li><a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a><li><a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a></ul><h3><a class="anchor" id="id_tagging_a_text_range"></a> Tagging a text range</h3><p>You can tag a range of text, either text within a paragraph or a paragraph itself.<p><b>Solution</b><ol type="1"><li>Tag the story in which the text range is located with the desired story-level tag, if it is not already tagged. Otherwise, the default Story tag is used.<li>Use the <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> command facade (<a class="el" href="classk_utils_boss.html">kUtilsBoss</a>).</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html">SnpManipulateXMLSelection</a><li>XMLMarkupInjector</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a></ul><h3><a class="anchor" id="id_tagging_a_table"></a> Tagging a table</h3><p>If you have an InDesign table, you can turn it into a structured table; for example, so it can be round-tripped through XML.<p><b>Solution</b><ol type="1"><li>Acquire a reference to the table model (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) you want to tag; for instance, through its <a class="el" href="class_i_table_model.html">ITableModel</a> interface. In the CHM documentation, search for the string literal &quot;virtual ITableModel&quot; (with quotes).<li>Use <a class="el" href="class_i_x_m_l_element_commands.html#aa56e02f215f3f71aa2d6e186d32520d8">IXMLElementCommands::CreateTableElement</a> to create an element for the table, and specify the names of tags to use for the table and cells within the table.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html#ab87dd712e9d92d60805b6ad692ee8ccc">SnpManipulateXMLElements::TagTable</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_table_model.html">ITableModel</a><li><a class="el" href="classk_table_model_boss.html">kTableModelBoss</a><li><a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a></ul><h3><a class="anchor" id="id_adding_comments_and_processing_instructions"></a> Adding comments and processing instructions</h3><p><b>Description</b><p>You can add comments and/or processing instructions, regardless of whether there is a selection.<p><b>Solution</b><ul><li>If there is a selection, use <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a> to add a comment and/or processing instructions, based on the selected text.<li>If there is no selection, you must process low-level commands yourself. To create a comment (<a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a>), process an instance of the <a class="el" href="classk_x_m_l_create_comment_cmd_boss.html">kXMLCreateCommentCmdBoss</a> command boss class. To create a processing instruction (<a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a>), process an instance of the <a class="el" href="classk_x_m_l_create_p_i_cmd_boss.html">kXMLCreatePICmdBoss</a> command boss class.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a><li><a class="el" href="class_snp_manipulate_x_m_l_selection.html">SnpManipulateXMLSelection</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a><li><a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a><li><a class="el" href="classk_x_m_l_create_comment_cmd_boss.html">kXMLCreateCommentCmdBoss</a><li><a class="el" href="classk_x_m_l_create_p_i_cmd_boss.html">kXMLCreatePICmdBoss</a><li><a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a></ul><h3><a class="anchor" id="id_modifying_and_deleting_comments_and_processing_instructions"></a> Modifying and deleting comments and processing instructions</h3><p><b>Solution</b><p>Again the solution depends on whether there is a selection and, if there is a selection, what type of selection it is. Modifying comments and processing instructions without a selection involves processing low-level commands.<p>When there is a selection, follow these steps:<ul><li>To modify a comment or processing instruction, use <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a>.<li>If there is a selection in the structure view, you also can delete a comment or processing instruction, using the <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> suite interface.</ul><p>If there is no selection, follow these steps:<ul><li>To change an XML comment, use low-level commands like <a class="el" href="classk_x_m_l_set_comment_cmd_boss.html">kXMLSetCommentCmdBoss</a>. To change a processing instruction, use the low-level command kXMLPISetCmdBoss. There are no wrapper methods for these.<li>Deleting processing instructions and comments is like deleting other XML elements, since they all aggregate <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>, from which you can get an <a class="el" href="class_x_m_l_reference.html">XMLReference</a> (see <a class="el" href="class_i_i_d_x_m_l_element.html#a755bf8972965cd7fa17da29e7de64e9c">IIDXMLElement::GetXMLReference</a>). To delete comments and processing instructions, use the <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> command facade.</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a><li><a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a><li><a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a><li><a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a><li><a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a><li><a class="el" href="classk_x_m_l_set_comment_cmd_boss.html">kXMLSetCommentCmdBoss</a><li><a class="el" href="classk_x_m_l_set_p_i_cmd_boss.html">kXMLSetPICmdBoss</a></ul><h3><a class="anchor" id="id_getting_notified_of_xml-related_changes_in_a_document"></a> Getting notified of XML-related changes in a document</h3><p>You can be notified when particular XML-related changes occur, such as an element being deleted.<p>When the logical structure is changed (e.g., elements are added or deleted, or associations are added to the tag-style mappings), notifications are sent out. If you know how the change is identified, you can attach your own observer to the correct subject and listen for these notifications.<p>Changes are notified to observers of changes to the backing-store subject. For instance, the structure-view tree widget has an observer on the backing store subject, to enable it to synchronize its state with the model&#39;s state.<p><b>Solution</b><ol type="1"><li>Acquire a reference to the backing store, a non-user-accessible story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). For example: <div class="fragment"><div class="line"><span class="comment">// The XML document element lives in the backing store</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IIDXMLElement&gt;</a> docElement(<a class="code" href="class_utils.html">Utils&lt;IXMLUtils&gt;</a>()-&gt;QueryDocElement(db));</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> baseUIDRef = docElement-&gt;GetXMLReference().GetUIDRef();</div><div class="line"><span class="comment">// baseUIDRef now refers to the backing store</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISubject&gt;</a> backingSubject(baseUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="comment">// This is the subject you need to attach to for notification on XML changes</span></div></div><li>Attach to its <a class="el" href="class_i_subject.html">ISubject</a> interface as an observer along the protocol of interest; for instance, IID_IIDXMLELEMENT.</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_subject.html">ISubject</a><li><a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a><li><a class="el" href="class_x_m_l_reference.html">XMLReference</a></ul><h3><a class="anchor" id="id_associating_a_dtd_with_a_document"></a> Associating a DTD with a document</h3><p><b>Description</b><p>You can associate a DTD with the logical structure of a document, to allow you to perform validation and other functions, like discovering what elements are valid to insert at a given node in the logical structure.<p><b>Solution</b><p>Process the low-level command <a class="el" href="classk_x_m_l_load_d_t_d_cmd_boss.html">kXMLLoadDTDCmdBoss</a>. This creates an instance of the boss class <a class="el" href="classk_x_m_l_d_t_d_boss.html">kXMLDTDBoss</a> in the document&#39;s backing store.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a></ul><p><b>Related API</b><ul><li><a class="el" href="classk_x_m_l_load_d_t_d_cmd_boss.html">kXMLLoadDTDCmdBoss</a></ul><h3><a class="anchor" id="id_validating_logical_structure_against_a_dtd"></a> Validating logical structure against a DTD</h3><p>If you associated a DTD with the logical structure of a document, you can determine the validity of the logical structure, given the grammar represented by the DTD.<p><b>Solution</b><p>There are several ways to validate the logical structure of a document against a DTD:<ul><li>Use the action manager (<a class="el" href="class_i_action_manager.html">IActionManager</a>) to perform the equivalent action to when the corresponding structure menu item is executed (kStructureValidateRootActionID to validate from the root, for instance). If you have a selection in the structure view, you also can execute kStructureValidateElementActionID.<li>Use <a class="el" href="class_i_x_m_l_utils.html#a84e7ce685d73a329525be891d8194a63">IXMLUtils::ValidateXML</a> and report the validation errors yourself.<li>When there is a selection, use the <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> suite interface and report the errors yourself. When the validation has run, <a class="el" href="class_i_x_m_l_validator.html">IXMLValidator</a> (on <a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>) stores a collection of instances of <a class="el" href="class_x_m_l_d_t_d_validation_error.html">XMLDTDValidationError</a> containing information about the errors.</ul><p>The ActionID for actions to validate the logical structure from the root can be found in the header file source/public/includes/XMediaUIID.h. Note that there is no public API to give you easy access to change the contents of the validation window in the InDesign user interface (see &quot;XML validation errors window&quot; in the Programming Guide chapter titled &quot;XML fundamentals&quot;) and you have to figure out how to display these errors yourself if you take this route.<p><b>Sample code</b><ul><li><a class="el" href="class_snp_manipulate_structure_view.html">SnpManipulateStructureView</a><li><a class="el" href="class_snp_manipulate_x_m_l_elements.html">SnpManipulateXMLElements</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_action_manager.html">IActionManager</a>, <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a><li><a class="el" href="class_i_x_m_l_validator.html">IXMLValidator</a>, <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>, <a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a></ul><h3><a class="anchor" id="id_finding_valid_elements_to_insert_given_a_dtd"></a> Finding valid elements to insert, given a DTD</h3><p><b>Description</b><p>Suppose you imported a DTD into an InDesign document, as in <a class="el" href="id_solutions.html#id_associating_a_dtd_with_a_document">Associating a DTD with a document</a>. You can constrain the elements that can be added by an end user at a given node in the logical structure.<p><b>Solution</b><ol type="1"><li>Use <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>. On each XML element in the logical structure, this provides methods enabling you to find the list of elements that are valid to insert as a child or sibling of the element or are valid replacements for the element (given the DTD).<li>Pass the objects representing valid elements to insert directly to the command facade to create new elements (<a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a>).</ol><p><b>Related APIs</b><ul><li><a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a><li><a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a><li>XMLDTDInsertElement<li>XMLDTDInsertElementList</ul><h2><a class="anchor" id="id_xslt"></a> XSLT</h2><h3><a class="anchor" id="id_transforming_imported_xml"></a> Transforming imported XML</h3><p>You can transform incoming XML with an XSL stylesheet. Specifically, you can translate one XML vocabulary in which the source XML is expressed into another XML vocabulary that your XML template understands.<p><b>Solution</b><p>In addition to implementing an XML transformer, you need to invoke the built-in XSLT engine within InDesign. Follow these steps:<ol type="1"><li>If you implement an XML transformer that manipulates the DOM, use <a class="el" href="class_i_x_s_l_services.html#ad4147f9643c66dc43ce7c39cf4d99d72">IXSLServices::Transform</a>.<li>When implementing an XML transformer to transform incoming XML with XSLT, you can pass a reference to the stylesheet (<a class="el" href="class_i_stylesheet_data.html">IStylesheetData</a>) to the import XML command through its data object (instance of <a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a>). The <a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a> boss class exposes the <a class="el" href="class_i_stylesheet_data.html">IStylesheetData</a> interface.<li>From the context of the XML transformer, you have a reference to the importer governor (<a class="el" href="classk_x_m_l_importer_boss.html">kXMLImporterBoss</a>). The <a class="el" href="class_i_p_m_unknown_data.html">IPMUnknownData</a> interface on this lets you acquire a reference to the data object (<a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a>). From the data object, you can recover the stylesheet (<a class="el" href="class_i_stylesheet_data.html">IStylesheetData</a>) and parameters passed in from the client code processing the import, via <a class="el" href="classk_import_x_m_l_file_cmd_boss.html">kImportXMLFileCmdBoss</a>.<li>Alternatively, if the inbound XML uses the &quot;xml-stylesheet&quot; processing instruction, you can parse this processing instruction in your XML transformer implementation, to discover what XSL stylesheet to use.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_x_doc_bk_x_m_l_transformer.html">XDocBkXMLTransformer</a><li>XDocBookWorkflow sample</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_import_x_m_l_data.html">IImportXMLData</a><li><a class="el" href="class_i_stylesheet_data.html">IStylesheetData</a><li><a class="el" href="class_i_x_s_l_services.html">IXSLServices</a></ul><h1><a class="anchor" id="id_versioning_persistent_data"></a> Versioning Persistent Data</h1><h2><a class="anchor" id="id_getting_started"></a> Getting started</h2><p>To learn how versioning persistent data works:<ul><li>Work through the activities in&quot;Exploring versioning persistent data with SnippetRunner&quot; to familiarize yourself with available sample code and documentation.<li>Read the &quot;Persistent Data and Data Conversion&quot; chapter in Adobe InDesign Programming Guide.</ul><p>For help with your specific programming problem, see the sections below for a use case that matches your need.<h3><a class="anchor" id="id_exploring_versioning_persistent_data_with_snippetrunner"></a> Exploring versioning persistent data with SnippetRunner</h3><p><b>Description</b><p>SnippetRunner is an SDK-supplied plug-in that lets you run code snippets, which can help you explore your use case.<p><b>Recommendations</b><ol type="1"><li>See the related sample code listed below, to see whether SDK code snippets exist to help you explore versioning persistent data.<li>If so, run Adobe InDesign &reg; with the SnippetRunner plug-in loaded.<li>See &lt;SDK&gt;/docs/references/index.chm (or HTML format), and select the &quot;Snippets&quot; tab for more information about a snippet or instruction on using SnippetRunner itself.<li>Browse the sample code of the snippets you have been running.<li>For additional help, see &quot;Related API&quot;.</ol><p><b>Sample code</b><ul><li>For help identifying the string value of IDs when you are investigating versioning, see <a class="el" href="class_snp_x_m_l_resolution_helper.html">SnpXMLResolutionHelper</a>.</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_conversion_provider.html">IConversionProvider</a>, <a class="el" href="class_i_content_iterator_register.html">IContentIteratorRegister</a></ul><h3><a class="anchor" id="id_finding_resources_related_to_versioning_persistent_data_on_the_sdk"></a> Finding resources related to versioning persistent data on the SDK</h3><p><b>Description</b><p>Suppose you are looking for assets on the SDK that will help you program with versioning persistent data.<p><b>Recommendations</b><p>See &lt;SDK&gt;/docs/references/index.chm (or HTML format). SDK sample plug-in descriptions are available from the &quot;Samples&quot; tab. API documentation is available from the &quot;API Classes&quot; tab. Documentation for boss classes and their aggregated interfaces is available from the &quot;Boss Classes&quot; tab.<h2><a class="anchor" id="id_working_with_data_conversion_strategies"></a> Working with data conversion strategies</h2><h3><a class="anchor" id=""></a></h3><p>To use the schema-based conversion mechanism, tell the conversion manager that your plug-in has a conversion provider. For an example, see &lt;SDK&gt;/source/sdksamples/persistentlist/PstLst.fr.<p>Implementations are supplied by the SDK. Remember to include <a class="el" href="_shuksan_i_d_8h_source.html">ShuksanID.h</a> in your .fr file.<h3><a class="anchor" id="id_changing_the_format_of_data_stored_by_a_persistent_implementation"></a> Changing the format of data stored by a persistent implementation</h3><p>To determine how to change the format of your plug-in&#39;s persistent data, follow these steps:<ol type="1"><li>Note the current format number, and identify how your data is rearranged in each of your ReadWrite() methods. This helps you track changes.<li>Determine what you need to modify:<ul><li>Does the order of any of the data types for the data change, or are you removing some data within an implementation? If so, write a schema for the SchemaList resource. (For details on these resources, see the &quot;Persistent Data and Data Conversion&quot; chapter in Adobe InDesign Programming Guide.) Then modify the ReadWrite() methods as needed.<li>Are you changing any boss class or implementation IDs? If so, add a set of directives in a DirectiveList resource. See <a class="el" href="id_solutions.html#id_changing_the_id_of_a_boss_class_or_implementation">Changing the ID of a boss class or implementation</a>.</ul></ol><h3><a class="anchor" id="id_adding_and_removing_boss_classes_or_implementations"></a> Adding and removing boss classes or implementations</h3><p>No conversion is required to add boss classes or implementations. To remove a boss class or an implementation at a specific format number, use the RemoveClass, RemoveImplementation, or RemoveAllImplementation directives.<p>The following example shows a resource that holds a list of individual directives that define the history of the plug-in&#39;s bosses and implementations: <div class="fragment"><div class="line">resource DirectiveList(kMyDirectiveRsrcID) {</div><div class="line"> {</div><div class="line"> {RemoveClass{kSomeBoss, {1, 2}} }, </div><div class="line"> {RemoveImplementation{kMyBoss, kMyDataImpl, {2, 1}} }, </div><div class="line"> {RemoveAllImplementation {kMyDeadImpl, {4, 2}} },</div><div class="line"> } </div><div class="line">};</div></div><p>You can put as many individual directives into a single DirectiveList resource as you like. Line by line, the preceding list of directives tells the conversion manager the following:<ul><li>Class kSomeBoss was completely removed from the document at format number 1.2.<li>Implementation kMyDataImpl was removed from class kMyBoss at format number 2.1.<li>Implementation kMyDeadImpl was removed from all classes at format number 4.2.</ul><p>You might need to use this technique in the following situations:<ul><li>If you remove a persistent data interface from a page item, story, or workspace, record this removal in a DirectiveList.<li>If you remove a dialog boss class from your plug-in, record this removal to allow the saved user interface state to recover properly.</ul><h3><a class="anchor" id="id_changing_the_id_of_a_boss_class_or_implementation"></a> Changing the ID of a boss class or implementation</h3><p>To change the ID of a boss or of an implementation, use the ReplaceClass or ReplaceImplementation directives, as shown in the following example: <div class="fragment"><div class="line">resource DirectiveList(kMyDirectiveRsrcID){</div><div class="line"> { </div><div class="line"> {ReplaceClass {kOldBossID, kNewBossID, {5, 2}} }, </div><div class="line"> {ReplaceImplementation {kSomeBoss, kOldImplID, kNewImplID, {4, 12}} }, </div><div class="line"> {ReplaceAllImplementation {kOldImplID, kNewImplID, {4, 12}} },</div><div class="line"> } </div><div class="line">};</div></div><p>Line by line, the preceding list of directives tells the conversion manager the following:<ul><li>Change the ID from kOldBossID to kNewBossID. The new format number was first used in format number 5.2.<li>Change implementation kOldImplID to kNewImplID for boss kSomeBoss. The new format number was first used in format number 4.12.<li>Change implementation kOldImplID to kNewImplID in all boss classes. The new format number was first used in format number 4.12.</ul><h3><a class="anchor" id="id_adding_moving_or_removing_a_xferid_call_for_classids_or_implementationids"></a> Adding, moving, or removing a XferID() call for ClassIDs or ImplementationIDs</h3><p>If you change the ReadWrite() of a persistent implementation such that you are adding, moving, or removing an XferID() call (used to read or write ClassIDs and implementationIDs), you need a content iterator. If you do not have one, you will get an assert when the debug application shuts down, to remind you that you need one.<p>The conversion manager algorithm relies on the ability to find every ClassID and ImplementationID in a document. It then determines, for each ID, whether it needs to be converted. It finds all these IDs by iterating through the document database. At the outermost level, the conversion algorithm iterates through all UIDs in the database. Because each UID is a class, it first asks whether the class needs conversion. Next, it gets the content iterator for the class and iterates through all ImplementationIDs the class contains.<p>If an implementation does not need to be converted, the conversion manager checks whether there is a content iterator associated with the implementation. Unless the implementation contains embedded ClassIDs or ImplementationIDs, usually there is not an iterator, because the implementation reads and writes only simple data (for example, <a class="el" href="class_p_m_string.html">PMString</a> and Int32). If there is a content iterator, however, the conversion manager looks at each ClassID and ImplementationID the implementation contains, to see whether it needs conversion. (This process is recursive.) The content iterator must match what the ReadWrite() routine does, or it fails.<p>To add a content iterator for your implementation:<ol type="1"><li>Add a Content Iterator Register boss to your plug-in&#39;s ClassDescriptionTable, as shown below: <div class="fragment"><div class="line">Class </div><div class="line">{</div><div class="line"><a class="code" href="classk_snap_iterator_register_boss.html">kSnapIteratorRegisterBoss</a>,</div><div class="line"> kInvalidClass, </div><div class="line"> {</div><div class="line"> IID_ICONTENTITERATORREGISTER, kSnapIteratorRegisterImpl,</div><div class="line"> IID_IK2SERVICEPROVIDER, kContentIteratorRegisterServiceImpl, </div><div class="line"> } </div><div class="line">},</div></div><li>Implement your own content iterator register, by extending <a class="el" href="class_i_content_iterator_register.html">IContentIteratorRegister</a>. See <a class="el" href="class_snap_iterator_register.html">SnapIteratorRegister</a>.<li>Use the schema-based iterator to provide a schema that describes what the data looks like, as shown here: <div class="fragment"><div class="line">resource Schema(kFormatRsrcID)</div><div class="line">{</div><div class="line"> kFooImpl, <span class="comment">// ImplementationID </span></div><div class="line"> {RezLong(1), RezLong(0)}, <span class="comment">// format number </span></div><div class="line"> {</div><div class="line"><span class="comment">// FieldID 1, default is empty string </span></div><div class="line"> {<a class="code" href="class_p_m_string.html">PMString</a> {0x0001, <span class="stringliteral">&quot;&quot;</span>}}, <span class="comment">// FieldID 2, default = 0 </span></div><div class="line"> {<a class="code" href="class_i_d_type.html">ClassID</a> {0x0002, 0}}, <span class="comment">// FieldID 3, default = 1.0 </span></div><div class="line"> {Real {0x0003, 1.0}}, <span class="comment">// FieldID 4, default = 0 </span></div><div class="line"> {Bool16 {0x0004, 0}}, <span class="comment">// FieldID 5, default = 512 </span></div><div class="line"> {Int32 {0x0005, 512}},</div><div class="line"> } </div><div class="line">};</div></div></ol><p>For a working example of a content iterator, see Snapshot SDK sample.<h3><a class="anchor" id="id_incrementing_format_number_without_changing_data_format_null_conversions"></a> Incrementing format number without changing data format (null conversions)</h3><p>You might want to increment a plug-in&#39;s format number in the PluginVersion resource, even though you did not change the data format. In this case, you can perform a null conversion to tell the content manager about the new format number. For example, working with the SchemaFormatNumber resource: <div class="fragment"><div class="line">resource SchemaFormatNumber(1) {</div><div class="line"> {</div><div class="line"> { kMyFirstPersistMajorVersionNumber, kMyFirstPersistMinorVersionNumber, }</div><div class="line"> { kMyFirstPersistMajorVersionNumber, kMySecondPersistMinorVersionNumber,}</div><div class="line"> } </div><div class="line">};</div></div><p>This resource, along with the lack of any DirectiveList resources specific to these versions, causes the schema-based converter to generate a null conversion from format number 1.0 of each implementation to format number 2.1. Not including this resource causes an assert:Assert: &quot;ConversionMgr::AddTargetConversion() - Unable to convert plugin &#39;MYPLUGIN.PLN&#39; from format 1.0 to format 2.0.&quot;<dl class="section note"><dt>Note<dd>If you did not change the persistent data format, it is not necessary to increment the format number; leave it unchanged. Because the SDK samples use a macro for format numbers, you might need to edit your PluginVersion resource so the actual number stays the same. By not changing the format number, you can avoid unnecessary work by the conversion manager, and you will not need a conversion provider.</dl><h3><a class="anchor" id="id_changes_to_data_conversion-related_apis"></a> Changes to data conversion-related APIs</h3><p>To find out about changes to data conversion-related APIs, see the API Advisor reports, found in &lt;SDK&gt;/docs/references.<h3><a class="anchor" id="id_why_indesign_wont_open_documents_saved_with_older_versions_of_your_plug-in"></a> Why InDesign won&#39;t open documents saved with older versions of your plug-in</h3><p>If your plug-in stores a persistent preference <a class="el" href="class_p_m_string.html">PMString</a> on the kDocWorkspace, you might have done either of the following:<ul><li>Changed your persistent data implementation in some way but forgotten to tell the conversion manager. See <a class="el" href="id_solutions.html#id_changing_the_format_of_data_stored_by_a_persistent_implementation">Changing the format of data stored by a persistent implementation</a>.<li>Changed the format number unintentionally, without changing your persistent data implementation. See <a class="el" href="id_solutions.html#id_incrementing_format_number_without_changing_data_format_null_conversions">Incrementing format number without changing data format (null conversions)</a>, or change the persistent data format number to be the same as that in the 2.0 version of your plug-in, so no conversion occurs.</ul><h3><a class="anchor" id="id_which_types_use_implicit_type_conversion"></a> Which types use implicit type conversion</h3><p>When specifying a schema resource, some fields might require implicit type conversion. The following table shows which data types can be implicitly converted and which cause an illegal conversion. In the table, Y denotes a legal conversion, and N denotes an illegal conversion. Here are further notes on Y:<ul><li>Y1 - False converts to zero; true converts to one.<li>Y2 - Zero converts to false; any other value converts to true.<li>Y3 - Nonnegative values are converted; negative values are a conversion error.<li>Y4 - Like Y3, with the restriction that positive values outside the range of the target are conversion errors.<li>Y5 - The real number is rounded to an integer, then treated like Y4.<li>Y6 - Values outside the range of the target are conversion errors.<li>Y7 - The real number is rounded to an integer, then treated like Y6.<li>Y8 - If the ID is invalid, the data is converted to kFalse; otherwise, it is converted to kTrue.</ul><table class="doxtable"><tr><th>&Acirc;&nbsp; </th><th>Bool8 </th><th>Bool16 </th><th>Int8 </th><th>Uint8 </th><th>Int16 </th><th>Uint16 </th><th>Int32 </th><th>Uint32 </th><th>Real </th><th>ID </th><th>Obj </th><th>Ref </th></tr><tr><td>Bool8 </td><td>&mdash; </td><td>Y </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>N </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Bool16 </td><td>Y </td><td>&mdash; </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>Y1 </td><td>N </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Int8 </td><td>Y2 </td><td>Y2 </td><td>&mdash; </td><td>Y3 </td><td>Y </td><td>Y3 </td><td>Y </td><td>Y3 </td><td>Y </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Uint8 </td><td>Y2 </td><td>Y2 </td><td>Y6 </td><td>&mdash; </td><td>Y </td><td>Y </td><td>Y </td><td>Y </td><td>Y </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Int16 </td><td>Y2 </td><td>Y2 </td><td>Y6 </td><td>Y4 </td><td>&mdash; </td><td>Y3 </td><td>Y </td><td>Y3 </td><td>Y </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Uint16 </td><td>Y2 </td><td>Y2 </td><td>Y6 </td><td>Y6 </td><td>Y6 </td><td>&mdash; </td><td>Y </td><td>Y </td><td>Y </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Int32 </td><td>Y2 </td><td>Y2 </td><td>Y6 </td><td>Y4 </td><td>Y6 </td><td>Y4 </td><td>&mdash; </td><td>Y3 </td><td>Y </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Uint32 </td><td>Y2 </td><td>Y2 </td><td>Y6 </td><td>Y6 </td><td>Y6 </td><td>Y6 </td><td>Y6 </td><td>&mdash; </td><td>Y </td><td>N </td><td>N </td><td>N </td></tr><tr><td>Real </td><td>N </td><td>N </td><td>Y7 </td><td>Y5 </td><td>Y7 </td><td>Y5 </td><td>Y7 </td><td>Y5 </td><td>&mdash; </td><td>N </td><td>N </td><td>N </td></tr><tr><td>ID </td><td>Y8 </td><td>Y8 </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>&mdash; </td><td>N </td><td>N </td></tr><tr><td>Obj </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>&mdash; </td><td>N </td></tr><tr><td>Ref </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>N </td><td>&mdash; </td></tr></table><h1><a class="anchor" id="id_commands"></a> Commands</h1><p>This chapter describes use cases and frequently asked questions related to commands.<h2><a class="anchor" id="id_finding_commands_provided_by_the_api"></a> Finding commands provided by the API</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to determine whether an API is provided that can help you perform a task, such as the following:<ul><li>Create, open, save, or close a document.<li>Create, modify, or delete an object in a document. For example, you may want to modify a text style, create a frame, or copy a frame to another document.<li>Create, modify, or delete an object in defaults. For example, you may want to modify a text style preference.</ul><h3><a class="anchor" id="id_solution"></a> Solution</h3><p>To determine whether an API is provided that will help you:<ul><li>See the chapters of this manual and Adobe InDesign Products Programming Guide on the domain that contains the objects you want to change. For example, to manipulate page items, see the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of the Adobe InDesign Products Programming Guide and the &quot;Layout&quot; chapter of this manual.<li>Look for a utility that encapsulates processing of the commands required and saves you writing the code that processes commands. See <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> in the API Reference for a list of utility interfaces. See <a class="el" href="class_i_document_commands.html">IDocumentCommands</a>, <a class="el" href="class_i_path_utils.html">IPathUtils</a>, <a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a>, <a class="el" href="class_i_table_commands.html">ITableCommands</a>, and <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a> for examples of those that are used often.<li>To modify objects that are selected or that form part of the active context, look for a suite that does the modification you want. See <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a> in the API Reference and the &quot;Selection&quot; chapter of the Adobe InDesign Products Programming Guide.<li>Determine the command the application uses to effect the change in which you are interested. See <a class="el" href="id_solutions.html#id_spying_on_command_processing">Spying on command processing</a>.<li>Examine the API Reference page for the command, for detailed documentation. For example, see kNewSpeadCmdBoss.</ul><h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li>For a list of all commands, see <a class="el" href="class_i_command.html">ICommand</a> in the API Reference. Alternatively, search the API Reference for the string &quot;k*CmdBoss.&quot;&quot;Spying on command processing&quot;.</ul><h2><a class="anchor" id="id_spying_on_command_processing"></a> Spying on command processing</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to determine the commands that the application uses to effect some change. For example, you want to find the command that is processed when you use the Paragraph Options dialog to change a text style.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>Using the Spy plug-ins:<ol type="1"><li>Start the debug build of InDesign.<li>Open the Preferences dialog, by selecting Test &gt; Spy &gt; Spy Preferences...<li>Check the EnableSpy &gt; SpyOnCommand preference, and check the output sink you want to use to log the commands. For output on Windows &reg;, use Notepad; on Mac OS&reg;, use Debug Log.<li>Perform the desired user action in InDesign and examine the output to see the commands that were processed.</ol><p>Using the Diagnostics plug-in, turn on command tracing, by selecting Test &gt; Diagnostics &gt; <a class="el" href="class_command.html">Command</a> &gt; Trace All Commands.<p>Treat the output with caution. It reveals the commands used to make the change, but a utility may exist that can process this command for you. Check the command&#39;s documentation in the API Reference for information on available utilities.<h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li><a class="el" href="id_solutions.html#id_finding_commands_provided_by_the_api">Finding commands provided by the API</a>.</ul><h2><a class="anchor" id="id_processing_a_command"></a> Processing a command</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you need to modify an object that persists in a document or defaults.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>Objects that persist in a database that supports undo, such as documents (see <a class="el" href="classk_doc_boss.html">kDocBoss</a>) or defaults (see <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>), must be modified using commands. You must not call interfaces that set persistent data on these objects directly.<dl class="section note"><dt>Note<dd>Utilities are provided to encapsulate the processing of many commands, so you need not write that. See <a class="el" href="id_solutions.html#id_finding_commands_provided_by_the_api">Finding commands provided by the API</a>.</dl><p>To process a command:<ol type="1"><li>Create the command, using <a class="el" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>.<li>Specify the command&#39;s input parameters. Parameters are passed into a command using data interfaces on the command object and the command&#39;s item list. Often, the objects to be operated on by the command are passed using the item list (see <a class="el" href="class_i_command.html#af77616b39cea19b0de97c3fc4844fe04">ICommand::GetItemList</a>). Some other commands operate on predetermined objects or objects identified using a data interface on the command.<li>Process the command, using <a class="el" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>.<li>Check for errors. <a class="el" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a> returns an error code; check for kSuccess before continuing. Alternatively, check the global error code (<a class="el" href="class_error_utils.html#ad32805d9e73399357297c07e60fde65a">ErrorUtils::PMGetGlobalErrorCode</a>).<li>On error, do not continue to process commands, just return to your caller. The application is responsible for reverting the model back to its state before the command was processed and informing the user of the error. <dl class="section note"><dt>Note<dd>If you continue to process commands while the global error code is set, protective shutdown occurs.</dl><li>On success, continue and get the command&#39;s output parameters (if appropriate). <dl class="section note"><dt>Note<dd>If you need more sophisticated flow control that allows for fail/retry semantics, use an abortable command sequence . See <a class="el" href="id_solutions.html#id_processing_an_abortable_command_sequence">Processing an abortable command sequence</a>.</dl></ol><h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li><a class="el" href="class_cmd_utils.html">CmdUtils</a> and <a class="el" href="class_i_command.html">ICommand</a> in the API Reference.</ul><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li><a class="el" href="class_snp_process_document_layer_cmds.html#a45caa7a192600eb3b4dfb03c4007873c">SnpProcessDocumentLayerCmds::CreateNewLayer</a><li><a class="el" href="class_b_p_i_helper.html#af362b0fbbfc8e4bdf067878cd9ebdaff">BPIHelper::ProcessBPISetDataCmd</a></ul><h2><a class="anchor" id="id_scheduling_a_command"></a> Scheduling a command</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to make a change to a document or defaults, but you need to delay the change so it occurs later. For example, when the application is launched, you want to automatically load some data into defaults. There is a service you can use to get called on start-up (see the <a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a> interface), but you need to wait until the application is fully initialized before loading the data.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>Schedule a command to be processed at a later time. The command is processed when the application is idle, based on the specified priority.<p>To schedule a command:<ol type="1"><li>Create the command, using <a class="el" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a><li>Specify the command&#39;s input parameters. Parameters are passed into a command using data interfaces on the command object and the command&#39;s item list.<li>Schedule processing of the command, using <a class="el" href="class_cmd_utils.html#a4b3f5c21f9801b6b620d92bcb6320c91">CmdUtils::ScheduleCommand</a>.<li><a class="el" href="class_cmd_utils.html#a4b3f5c21f9801b6b620d92bcb6320c91">CmdUtils::ScheduleCommand</a> returns an error code that indicates whether the command was scheduled successfully.<li>The application processes the command later, using an idle task. If the command returns with the global error code set, the application is responsible for reverting the model back to its state before the command was processed and informing the user of the error.</ol><h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li><a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a> in the API Reference.</ul><h2><a class="anchor" id="id_processing_a_command_sequence"></a> Processing a command sequence</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to group a set of modifications into one undoable operation. For example, you want to place a set of images into a document and apply a special effect to each one. On undo, all images should be removed from the document; on redo, they should be restored.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>Process the commands that perform the changes within a new command sequence:<ol type="1"><li>Create an instance of the SequencePtr helper class. This class calls <a class="el" href="class_cmd_utils.html#a6b11ea77d40620d2231f9fc4523c2bc2">CmdUtils::BeginCommandSequence</a> to begin a new command sequence in its constructor: <div class="fragment"><div class="line"><a class="code" href="class_cmd_utils_1_1_sequence_ptr.html">CmdUtils::SequencePtr</a> cmdSeq;</div></div><dl class="section note"><dt>Note<dd>If you prefer that your commands join an existing command sequence if one exists, use SequenceContext as the helper class.</dl><li>Optionally, give the sequence a name, using <a class="el" href="class_i___base___command_sequence.html#a396cfdf862d68eda9c24fbb532dadf74">ICommandSequence::SetName</a>. If you do not set the name, the sequence inherits the name of the first command processed within it. <div class="fragment"><div class="line">cmdSeq-&gt;<a class="code" href="class_i___base___command_sequence.html#a396cfdf862d68eda9c24fbb532dadf74">SetName</a>(<span class="stringliteral">&quot;Your sequence name&quot;</span>);</div></div><li>Process the first command. See <a class="el" href="id_solutions.html#id_processing_a_command">Processing a command</a>.<li>Check for errors. <a class="el" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a> returns an error code; check for kSuccess before continuing. If you called another utility that returns an error code, check it instead. Otherwise, check the global error code (<a class="el" href="class_error_utils.html#ad32805d9e73399357297c07e60fde65a">ErrorUtils::PMGetGlobalErrorCode</a>) for kSuccess.<li>On success, process the next command.<li>On error, do not continue processing commands. Optionally, you can change the global error code (<a class="el" href="class_error_utils.html#ae603b63520be78e0d9875cc99e9bfeca">ErrorUtils::PMSetGlobalErrorCode</a>) to some other error, but you must not set it back to kSuccess. <dl class="section note"><dt>Note<dd>If you continue processing commands while the global error code is set, protective shutdown occurs.</dl><li>When the SequencePtr class goes out of scope, its destructor ends the sequence using <a class="el" href="class_cmd_utils.html#a4449513fbe55f8b70da53dd159b230bb">CmdUtils::EndCommandSequence</a>.<li>Return to your caller. If an error was detected, either return an error code to your caller (if appropriate), or make sure the global error code is set before returning. The application is responsible for reverting the model back to its state before the command was processed and informing the user of the error.</ol><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li><a class="el" href="class_cmd_utils_1_1_sequence_ptr.html">CmdUtils::SequencePtr</a> in the API reference and SnpManipulateInline::InsertInline.<li><a class="el" href="class_cmd_utils_1_1_sequence_context.html">CmdUtils::SequenceContext</a> in the API Reference and <a class="el" href="class_snp_perform_x_m_p_commands.html#a38818607ffd6fc8e865f40eaf73b628f">SnpPerformXMPCommands::ReplaceMetaDataFromFile</a>.<li>CommandSequence in the API Reference and <a class="el" href="class_snp_process_document_layer_cmds.html#a8c909cbc289635c8d9e1c26cfb2c9111">SnpProcessDocumentLayerCmds::CopyToNewLayer</a>.</ul><h2><a class="anchor" id="id_processing_an_abortable_command_sequence"></a> Processing an abortable command sequence</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to group a set of modifications into one undoable operation and, within this operation, you need sophisticated flow control that allows for fail/retry semantics. For example, while refreshing the content of the files linked to a document, you find a file is missing and want to allow the user to browse for the missing file and then proceed.<dl class="section note"><dt>Note<dd>Abortable command sequences should be used only where absolutely necessary, since they incur a heavy performance overhead. If you are in any doubt, use a regular command sequence; see <a class="el" href="id_solutions.html#id_processing_a_command_sequence">Processing a command sequence</a>.</dl><h3><a class="anchor" id="id_solution"></a> Solution</h3><p>To process two or more commands within an abortable command sequence:<ol type="1"><li>Begin the sequence, using <a class="el" href="class_cmd_utils.html#af2957bb45581f92ec2551fd24448463a">CmdUtils::BeginAbortableCmdSeq</a><li>Optionally, give the sequence a name using <a class="el" href="class_i___base___command_sequence.html#a396cfdf862d68eda9c24fbb532dadf74">IAbortableCmdSeq::SetName</a>. If you do not set the name, the sequence inherits the name of the first command you process.<li>Process commands and use <a class="el" href="class_cmd_utils.html#a299c10309cea2e1e84c0a4c9012e0a6f">CmdUtils::SetSequenceMark</a> to mark points in the sequence to which you want to be able to roll back. On failure, use <a class="el" href="class_cmd_utils.html#a0133de74a7e787c83ba4be245b02e993">CmdUtils::RollBackCommandSequence</a> to roll back. Reset the global error code (<a class="el" href="class_error_utils.html">ErrorUtils</a>) to kSuccess, and then process the commands in your retry strategy.<li>On success, end the sequence using <a class="el" href="class_cmd_utils.html#a4449513fbe55f8b70da53dd159b230bb">CmdUtils::EndCommandSequence</a>. On failure, end the sequence using <a class="el" href="class_cmd_utils.html#a05b5591741cd0bf42e3ec2422e025137">CmdUtils::AbortCommandSequence</a>; any changes made are aborted.</ol><dl class="section note"><dt>Note<dd>If you continue processing commands while the global error code is set, protective shutdown occurs.</dl><p>Example of fail/retry semantics in an abortable command sequence: <div class="fragment"><div class="line"><a class="code" href="class_i_abortable_cmd_seq.html">IAbortableCmdSeq</a>* sequ = <a class="code" href="class_cmd_utils.html#af2957bb45581f92ec2551fd24448463a">CmdUtils::BeginAbortableCmdSeq</a>();</div><div class="line">SequenceMark sequenceMark = <a class="code" href="class_cmd_utils.html#a299c10309cea2e1e84c0a4c9012e0a6f">CmdUtils::SetSequenceMark</a>(sequ);</div><div class="line">ErrorCode status = TrySomeCommands();</div><div class="line"><span class="keywordflow">if</span> (status != kSuccess){</div><div class="line"> status = <a class="code" href="class_cmd_utils.html#a0133de74a7e787c83ba4be245b02e993">CmdUtils::RollBackCommandSequence</a>(sequ, sequenceMark);</div><div class="line"><span class="keywordflow">if</span> (status == kSuccess)</div><div class="line"> {</div><div class="line"><a class="code" href="class_error_utils.html#ad32805d9e73399357297c07e60fde65a">ErrorUtils::PMGetGlobalErrorCode</a>(kSuccess);</div><div class="line"> status = RetryOtherCommands();</div><div class="line"> }</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (status == kSuccess){</div><div class="line"><a class="code" href="class_cmd_utils.html#a4449513fbe55f8b70da53dd159b230bb">CmdUtils::EndCommandSequence</a>(sequ);</div><div class="line">}<span class="keywordflow">else</span>{</div><div class="line"><a class="code" href="class_cmd_utils.html#a05b5591741cd0bf42e3ec2422e025137">CmdUtils::AbortCommandSequence</a>(sequ);</div><div class="line">}</div></div><h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li><a class="el" href="class_i_abortable_cmd_seq.html">IAbortableCmdSeq</a> and <a class="el" href="class_cmd_utils.html">CmdUtils</a> in the API Reference. <a class="el" href="id_solutions.html#id_processing_a_command_sequence">Processing a command sequence</a>.</ul><h2><a class="anchor" id=""></a></h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you call a method on an interface, and you get the assert &quot;DataBase change outside of Begin/End Transaction!&quot;<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>You must process a command to modify that interface. Call a utility that processes the command for you.<h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li><a class="el" href="id_solutions.html#id_finding_commands_provided_by_the_api">Finding commands provided by the API</a> and <a class="el" href="id_solutions.html#id_processing_a_command">Processing a command</a>.</ul><h1><a class="anchor" id="id_notification"></a> Notification</h1><p>This chapter describes solutions to problems that can be encountered when working with notification.<h2><a class="anchor" id="id_finding_responder_events_and_their_associated_serviceid"></a> Finding responder events and their associated ServiceID</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to know the predefined set of events for which the application calls responders. For example, the application can call responders when documents open and close.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>Each event has a corresponding ServiceID. A responder can register interest in one or more of these events by returning the ServiceIDs of interest from its <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> implementation. The following table lists the ServiceIDs for events in which responders frequently are interested.<p>Frequently used responder events and ServiceIDs<table class="doxtable"><tr><th>Event</th><th>ServiceID</th><th>Signal-manager boss class </th></tr><tr><td rowspan="3">Create document</td><td>kBeforeNewDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kDuringNewDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterNewDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td rowspan="3">Open document</td><td>kBeforeOpenDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kDuringOpenDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterOpenDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td rowspan="2">Save document</td><td>kBeforeSaveDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterSaveDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td rowspan="2">Save document as a new file</td><td>kBeforeSaveAsDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterSaveAsDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td rowspan="3">Save copy of document</td><td>kBeforeSaveACopyDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kDuringSaveACopyDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterSaveACopyDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td rowspan="2">Revert document</td><td>kBeforeRevertDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterRevertDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td rowspan="2">Close document</td><td>kBeforeCloseDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>kAfterCloseDocSignalResponderService</td><td><a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a></td></tr><tr><td>Create new page item</td><td>kNewPISignalResponderService</td><td><a class="el" href="classk_new_p_i_signal_mgr_boss.html">kNewPISignalMgrBoss</a></td></tr><tr><td>Create new story</td><td>kNewStorySignalResponderService</td><td><a class="el" href="classk_new_story_signal_mgr_boss.html">kNewStorySignalMgrBoss</a></td></tr><tr><td>Delete story</td><td>kDeleteStoryRespService</td><td><a class="el" href="classk_delete_story_cmd_boss.html">kDeleteStoryCmdBoss</a></td></tr></table><p>The preceding table is not a complete list of the responder services provided by the application. See the documentation on working with a particular domain, such as layout or text, for information on the responder services the domain provides. If you do not find the information you need, you can determine the current set of responder services supported by the application as follows:<ol type="1"><li>Search the public API headers for the string &quot;kServiceIDSpace.&quot; This gives the complete set of services available (only a subset of which are responder services). For example: <div class="fragment"><div class="line">DECLARE_PMID(kServiceIDSpace, kComponentVersionService, ...)</div><div class="line">DECLARE_PMID(kServiceIDSpace, kMenuRegisterService, ...)</div><div class="line">...</div></div><li>Search the results above for the string &quot;Resp&quot;. For example: <div class="fragment"><div class="line">DECLARE_PMID(kServiceIDSpace, kAppChangesSignalResponderService, ...)</div><div class="line">DECLARE_PMID(kServiceIDSpace, kDocChangesSignalResponderService, ...)</div><div class="line">...</div></div><li>This yields the list of ServiceIDs for the predefined set of events that the application makes available for responders to register interest in.</ol><p>If the responder is to handle a single event, the API provides service-provider implementations that can be used to register interest. As a result, you need not write the C++ class that implements <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. For example, if a responder is required that reacts to the before close signal, the existing API-supplied implementation (kBeforeCloseDocSignalRespServiceImpl) can be declared in the boss class definition. The following table lists frequently used service-provider implementations provided by the API.<table class="doxtable"><tr><th>ServiceID </th><th>API-provided ImplementationID </th></tr><tr><td>kBeforeNewDocSignalResponderService </td><td>kBeforeNewDocSignalRespServiceImpl </td></tr><tr><td>kDuringNewDocSignalResponderService </td><td>kDuringNewDocSignalRespServiceImpl </td></tr><tr><td>kAfterNewDocSignalResponderService </td><td>kAfterNewDocSignalRespServiceImpl </td></tr><tr><td>kBeforeOpenDocSignalResponderService </td><td>kBeforeOpenDocSignalRespServiceImpl </td></tr><tr><td>kDuringOpenDocSignalResponderService </td><td>kDuringOpenDocSignalRespServiceImpl </td></tr><tr><td>kAfterOpenDocSignalResponderService </td><td>kAfterOpenDocSignalRespServiceImpl </td></tr><tr><td>kBeforeSaveDocSignalResponderService </td><td>kBeforeSaveDocSignalRespServiceImpl </td></tr><tr><td>kAfterSaveDocSignalResponderService </td><td>kAfterSaveDocSignalRespServiceImpl </td></tr><tr><td>kBeforeSaveAsDocSignalResponderService </td><td>kBeforeSaveAsDocSignalRespServiceImpl </td></tr><tr><td>kAfterSaveAsDocSignalResponderService </td><td>kAfterSaveAsDocSignalRespServiceImpl </td></tr><tr><td>kBeforeSaveACopyDocSignalResponderService </td><td>kBeforeSaveACopyDocSignalRespServiceImpl </td></tr><tr><td>kDuringSaveACopyDocSignalResponderService </td><td>kDuringSaveACopyDocSignalRespServiceImpl </td></tr><tr><td>kAfterSaveACopyDocSignalResponderService </td><td>kAfterSaveACopyDocSignalRespServiceImpl </td></tr><tr><td>kBeforeRevertDocSignalResponderService </td><td>kBeforeRevertDocSignalRespServiceImpl </td></tr><tr><td>kAfterRevertDocSignalResponderService </td><td>kAfterRevertDocSignalRespServiceImpl </td></tr><tr><td>kBeforeCloseDocSignalResponderService </td><td>kBeforeCloseDocSignalRespServiceImpl </td></tr><tr><td>kAfterCloseDocSignalResponderService </td><td>kAfterCloseDocSignalRespServiceImpl </td></tr><tr><td>kNewPISignalResponderService </td><td>kNewPISignalRespServiceImpl </td></tr><tr><td>kNewStorySignalResponderService </td><td>kNewStorySignalRespServiceImpl </td></tr><tr><td>kDeleteStoryRespService </td><td>kDeleteStoryRespServiceImpl </td></tr></table><h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li>For general documentation on services: the &quot;Service Providers&quot; chapter.</ul><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li>For a sample of a service provider implementation that registers interest in multiple events: <a class="el" href="class_doc_wch_service_provider.html">DocWchServiceProvider</a> in the DocWatch plug-in.<li>For a sample of a responder that reuses a service-provider implementation provided by the API: the boss class definition for <a class="el" href="classk_b_p_i_new_doc_responder_boss.html">kBPINewDocResponderBoss</a> in the BasicPersistInterface sample.</ul><h2><a class="anchor" id="id_spying_on_observer_notification_broadcasts"></a> Spying on observer notification broadcasts</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you want to discover the broadcasts that the application makes to notify a change.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>The Spy plug-in can be configured to log all commands that are executing, along with the subjects notified, the protocol used for notification, and the change that occurs. Perform the action of interest, and Spy provides the information required to observe the action.<p>Using the Spy plug-in, do the following:<ol type="1"><li>Start the debug build of InDesign.<li>Open the preferences dialog by selecting Test &gt; Spy &gt; Spy Preferences...<li>Check the EnableSpy &gt; SpyOnBroadcast preference, and check the output sink that you want to use to log the commands. For output on Windows, use Notepad; for Mac OS, use Debug Log.<li>Perform the gesture in the application you are interested in, and examine the output to see the notifications that were broadcast. For example, the ClassID of the subject and the message protocol used for the notification performed when you use the Paragraph Options dialog to change a text style is reported after the @ sign in the output: <div class="fragment"><div class="line">&gt; <a class="code" href="classk_edit_text_style_cmd_boss.html">kEditTextStyleCmdBoss</a> @ <a class="code" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> (IID_ISTYLEINFO)</div></div></ol><h2><a class="anchor" id="id_accessing_lazy_notification_data_objects_used_by_the_application"></a> Accessing lazy notification data objects used by the application</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you use lazy notification to observe objects in the model and want to access the information in the lazy notification data that is broadcast by the application.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>The lazy notification data objects used within the application are not documented in the public API.<dl class="section note"><dt>Note<dd>Refresh the observer&#39;s state entirely when <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> is called.</dl><p>Lazy notification data objects are data-carrying (C++) objects created by the message originator before they call <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a>. The type of data contained in a lazy notification data object varies. Each notification protocol used by the application either has a fixed C++ data type or does not use lazy notification data at all. Observers need to know the type, so they can safely cast a <a class="el" href="class_lazy_notification_data.html">LazyNotificationData</a> pointer to a concrete class. For example, changes to the spread list are notified on protocol IID_ISPREADLIST, using a type of ListLazyNotificationData&lt;UID&gt;.<h3><a class="anchor" id="id_related_documentation"></a> Related documentation</h3><ul><li>Material about lazy notification in the &quot;Notification&quot; chapter of the Adobe InDesign Products Programming Guide.</ul><h2><a class="anchor" id="id_using_lazy_notification_data"></a> Using lazy notification data</h2><h3><a class="anchor" id="id_description"></a> Description</h3><p>Suppose you need to optimize lazy notification. For example, you observe a large number of objects in the model and present a view of all these objects in your user interface. Your command is changing only a small subset of those objects, and you want the observer to refresh the data in the view for only the objects that change.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>The API provides the templated lazy notification data types identified in the following table, which can be used to pass information about the objects that change, from the message originator into <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a>.<table class="doxtable"><tr><th>API </th><th>Note </th></tr><tr><td><a class="el" href="class_list_lazy_notification_data.html">ListLazyNotificationData</a></td><td>Templated class used to pass a list containing a given type. For example, ListLazyNotificationData&lt;UID&gt; can be used for a list of UIDs, and ListLazyNotificationData&lt;ClassID&gt; can be used to pass a list of ClassIDs. </td></tr><tr><td><a class="el" href="class_tree_lazy_notification_data.html">TreeLazyNotificationData</a></td><td>Templated class used to pass a tree containing a given type. For example, <a class="el" href="class_tree_lazy_notification_data.html">TreeLazyNotificationData&lt;UID&gt;</a> can be used to pass a tree of UIDs. </td></tr></table><p>For example, consider a plug-in that adds a list of custom styles to a document and a panel that displays them. The panel has an observer that receives lazy notification when custom styles are modified. If the observer receives a nil-pointer for the lazy notification data, this indicates that all custom styles were modified. The observer should examine all custom styles in the document and refresh the entire panel. If the observer receives a lazy notification data object that is not nil, the object can be used to discover the subset of custom styles that were modified. The observer needs to examine only the affected custom styles in the document and refresh their associated data in the panel.<p>Consider a command that can lock one custom style object at a time. The command notifies using the document&#39;s <a class="el" href="class_i_subject.html">ISubject</a> interface and broadcasts the UID of the affected custom style in a lazy notification data object, as shown in the following example. <div class="fragment"><div class="line"><span class="keywordtype">void</span> LockYourStyleCmd::DoNotify(){</div><div class="line"><span class="comment">// Broadcast change to document subject</span></div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> styleRef = this-&gt;GetItemList()-&gt;GetRef(0);</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* db = styleRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> iDoc(db, db-&gt;<a class="code" href="class_i_data_base.html#a7fe2aa8e012510c2dfe26c8427ce5b5a">GetRootUID</a>(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISubject&gt;</a> docSubject(iDoc, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (docSubject)</div><div class="line"> {</div><div class="line"><a class="code" href="class_list_lazy_notification_data.html">ListLazyNotificationData&lt;UID&gt;</a>* lnData = <span class="keyword">new</span> <a class="code" href="class_list_lazy_notification_data.html">ListLazyNotificationData&lt;UID&gt;</a>;</div><div class="line"><span class="comment">// This command only locks one style at a time.</span></div><div class="line"> lnData-&gt;<a class="code" href="class_list_lazy_notification_data.html#a2de8456e9581c2ec65dc783c75834c42">ItemChanged</a>(styleRef.<a class="code" href="class_u_i_d_ref.html#a83f8135c77064949d35b8b435517adf4">GetUID</a>());</div><div class="line"> docSubject-&gt;ModelChange(kLockCustomStyleCmdBoss, IID_ICUSTOMSTYLELIST, <span class="keyword">this</span>, lnData);</div><div class="line"> }</div><div class="line">}</div></div><p>Consider an observer that refreshes a list of these custom styles in a panel. It is attached to a document&#39;s <a class="el" href="class_i_subject.html">ISubject</a> interface for lazy notification when custom styles change. It can use the lazy notification data object to discover the custom style that was affected and optimize the objects that are refreshed, as shown in the following example, which receives UIDs of affected objects via ListLazyNot ificationData: <div class="fragment"><div class="line"><span class="keywordtype">void</span> YourStyleObserver::LazyUpdate(<a class="code" href="class_i_subject.html">ISubject</a>* theSubject, <span class="keyword">const</span> <a class="code" href="class_i_d_type.html">PMIID</a> &amp;protocol, <span class="keyword">const</span> <a class="code" href="class_lazy_notification_data.html">LazyNotificationData</a>* data) {</div><div class="line"><span class="keywordflow">if</span> (protocol == IID_ICUSTOMSTYLELIST)</div><div class="line"> {</div><div class="line"><span class="comment">// Cast the data pointer to the concrete type.</span></div><div class="line"><span class="keyword">const</span> <a class="code" href="class_list_lazy_notification_data.html">ListLazyNotificationData&lt;UID&gt;</a>* lnData = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="class_list_lazy_notification_data.html">ListLazyNotificationData&lt;UID&gt;</a>*<span class="keyword">&gt;</span>(data);</div><div class="line"> this-&gt;HandleUpdate(theSubject, lnData);</div><div class="line"> }</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> CustomStyleObserver::HandleUpdate(<a class="code" href="class_i_subject.html">ISubject</a>* theSubject, <span class="keyword">const</span> <a class="code" href="class_list_lazy_notification_data.html">ListLazyNotificationData&lt;UID&gt;</a>* lnData){</div><div class="line"><span class="keywordflow">if</span> (lnData == nil)</div><div class="line"> {</div><div class="line"><span class="comment">// Refresh all objects in the panel...</span></div><div class="line"> }</div><div class="line"><span class="keywordflow">else</span></div><div class="line"> {</div><div class="line"><span class="comment">// Discover the affected objects using the data.</span></div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* db = ::GetDataBase(theSubject);</div><div class="line"><a class="code" href="class_k2_vector.html">K2Vector&lt;UID&gt;</a> addedItems;</div><div class="line"><a class="code" href="class_k2_vector.html">K2Vector&lt;UID&gt;</a> deletedItems;</div><div class="line"><a class="code" href="class_k2_vector.html">K2Vector&lt;UID&gt;</a> changedItems;</div><div class="line"> lnData-&gt;<a class="code" href="class_list_lazy_notification_data.html#ad9ed7c1d1b022c6b4dadc866410ae19d">BreakoutChanges</a>(&amp;addedItems, &amp;deletedItems, &amp;changedItems);</div><div class="line"><span class="comment">// Refresh the affected objects in the panel...</span></div><div class="line"> }</div><div class="line">}</div></div><p><b>Lazy notification data-object lifetime</b><p>A lazy notification data object is created and populated by a message originator (the entity that calls <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a>, usually a command). The lazy notification data object is allocated on the heap using the new operator, and it is passed to the subject via the <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> method; ownership passes to the application core. Since only one update message is set to observers for all messages sent (per protocol on a subject) in a sequence, changes in the lazy notification data object accumulate (see <a class="el" href="class_lazy_notification_data.html#ad5c1106c8c8f4895bbc4fe4069b6e516">LazyNotificationData::Add()</a>). For example, if within a command sequence a loop creates several page items, the creation of the page items being broadcast using lazy notification. Any lazy notification data objects passed into the <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> method of the subject by the command creating the individual page items are merged. Only one lazy notification data object is passed to the lazy observers. Lazy notification data objects are tied to the lifetime of the command history; however, they can be purged in certain situations (such as low memory). Observers using lazy notification must not assume the existence of an lazy notification data.<p><b>Lazy-notification data and undo/redo</b><p>Lazy notification data objects must deal appropriately with undo and redo. For example, if the do operation creates a page item, resulting in a UID being placed in the lazy notification data, some understanding of what this means must be provided for undo/redo. API-supplied lazy notification data objects dealing with UIDs generally maintain three sets, those that were added, those that were removed, and those that changed. On undo/redo, the lazy notification data object is invoked to provide a clone (see <a class="el" href="class_lazy_notification_data.html#a625da57fb00c024fd24bd15edef42b6b">LazyNotificationData::Clone()</a>). For our simple example, this means on undo the &quot;removed&quot; and &quot;added&quot; lists are swapped, and the observer is called with the cloned list.<p><b>Lazy-notification data values</b><p>A lazy notification data parameter can be nil; in this case, the observer must re-build whatever information it requires directly from the model. The parameter also can be nil under certain circumstances (such as low memory conditions) controlled by the core application.<p><b>Implementation</b><p>The abstract base class for lazy notification data classes is <a class="el" href="class_lazy_notification_data.html">LazyNotificationData</a>. To use the templated classes <a class="el" href="class_list_lazy_notification_data.html">ListLazyNotificationData</a> or <a class="el" href="class_tree_lazy_notification_data.html">TreeLazyNotificationData</a> for your own types, follow the instructions provided in the API Reference. To implement a new type of lazy notification data object, provide an implementation of <a class="el" href="class_lazy_notification_data.html">LazyNotificationData</a>.<h3><a class="anchor" id="id_related_documentations"></a> Related documentations</h3><ul><li>Material about lazy notification in the &quot;Notification&quot; chapter of volume 1 of the programming guide.</ul><h1><a class="anchor" id="id_snippets"></a> Snippets</h1><p>This chapter presents case studies of working with snippet export, snippet import, and snippets and libraries.<h2><a class="anchor" id="id_working_with_snippet_export"></a> Working with snippet export</h2><h3><a class="anchor" id="id_exporting_a_snippet_from_a_selection"></a> Exporting a snippet from a selection</h3><p><b>Description</b><p>Suppose you have a selection or want to make one programmatically and export a snippet from the selection.<p><b>Solution</b><ol type="1"><li>If you have no selection but want to create one and are not concerned about trampling the user selection, you can create a selection. For example, you can create a selection in the layout with <a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a>, or select nodes in the structure view with <a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a>.<li>Now that you have a selection, you can export (via <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>) either a selection of XML elements in the structure view, or a text selection (as InCopy Interchange) or page items from the layout view.</ol><p><b>Related documentation</b><ul><li>&quot;Selection&quot; chapter</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a><li><a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a><li><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a><li><a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a></ul><p><b>Related function</b><ul><li>Test &gt; Snippet &gt; Export Selection (menu item on testing menu)</ul><h3><a class="anchor" id="id_exporting_page_items_to_a_snippet_without_selection"></a> Exporting page items to a snippet (without selection)</h3><p>Suppose you want to export page items as a snippet, without involving the selection subsystem; for example, because you do not want to trample the end-user selection, or you do not have a view open onto the document.<p><b>Solution</b><p>If you want to export without involving selection, you are responsible for collecting the root objects for your snippet, which should have <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interfaces. That is, these objects must participate in the scripting DOM. To export page items, you need to create a PageItem snippet, which uses the default export policy. Follow these steps:<ol type="1"><li>Identify the root objects that you want to export; you need <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interfaces to refer to these objects for export. For information on acquiring references to page items in the layout, see the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter of Adobe InDesign Products Programming Guide.<li>After you identify the content that you want to export and have created a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>), you can use <a class="el" href="class_i_snippet_export.html#a3579253078b3f5d9cbdae5f1cc6feccb">ISnippetExport::ExportPageitems</a>.</ol><p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_snippet.html">SnpImportExportSnippet</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_d_o_m_element.html">IDOMElement</a><li><a class="el" href="class_i_snippet_export.html">ISnippetExport</a></ul><h3><a class="anchor" id="id_exporting_swatches_to_a_snippet"></a> Exporting swatches to a snippet</h3><p>Suppose you want to export all swatches in a given document to a snippet file, including all the gradients, solid colors, and tints. Alternately, you might be interested in exporting one or a set of swatches from a given document.<p><b>Solution</b><p>Use ISnippetExport::ExportDocumentResource(), as demonstrated in the <a class="el" href="class_snp_import_export_snippet.html">SnpImportExportSnippet</a> code snippet.<p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide<li>&quot;Graphics Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide (look for more information on swatches)</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_snippet.html">SnpImportExportSnippet</a></ul><p><b>Related APIs (for swatches)</b><ul><li><a class="el" href="class_i_rendering_object.html">IRenderingObject</a><li><a class="el" href="class_i_swatch_list.html">ISwatchList</a><li><a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a><li><a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a><li><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></ul><h3><a class="anchor" id="id_exporting_text_styles_to_a_snippet"></a> Exporting text styles to a snippet</h3><p>Suppose you want to export all paragraph styles and character styles from a document, or export a subset of the styles to a snippet.<p><b>Solution</b><p>Use ISnippetExport::ExportAppPrefs(), as demonstrated by the <a class="el" href="class_snp_share_app_resources.html">SnpShareAppResources</a> code snippet.<p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide<li>&quot;Text Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_share_app_resources.html">SnpShareAppResources</a><li><a class="el" href="class_snp_inspect_text_styles.html">SnpInspectTextStyles</a><li><a class="el" href="class_snp_manipulate_text_style.html">SnpManipulateTextStyle</a></ul><h3><a class="anchor" id="id_exporting_object_styles_from_a_document_to_a_snippet"></a> Exporting object styles from a document to a snippet</h3><p>Suppose you want to export all object styles in a given document, or a subset of those styles, to a snippet.<p><b>Solution</b><p>Use ISnippetExport::ExportDocumentResource(), as demonstrated by the SnpImportExport code snippet.<p><b>Sample code</b><ul><li>SnpImportExportSnippet::ExportObjectStyles</ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_object_style_info.html">IObjectStyleInfo</a><li>IObjectStylesFacade<li><a class="el" href="class_i_object_styles_suite.html">IObjectStylesSuite</a><li><a class="el" href="class_i_style_name_table.html">IStyleNameTable</a></ul><h3><a class="anchor" id="id_exporting_xml_elements_as_a_snippet"></a> Exporting XML elements as a snippet</h3><p>Suppose you want to export a set of nodes in the logical-structure tree, along with the placed content items, because you want to transfer the logical structure and the associated content items into another document. For example, you want to transfer part of one XML template into another, including the frames in the first document, as well as the logical structure.<p><b>Solution</b><p>Export a snippet based on the set of XML elements of interest. This lets you import the snippet into another document, and the placed content items would be transferred over into the new document.<p>The difference between this and a normal XML export is that the normal export does not know how to export any information about the native InDesign document objects; for example, exported XML does not carry information about text frames, graphic frames, spread layers and so on. This information is represented in the snippet, which lets you interchange chunks of an InDesign document with another, carrying over all the dependencies.<p>Follow these steps:<ol type="1"><li>Identify the elements (by <a class="el" href="class_x_m_l_reference.html">XMLReference</a>) you want to export.<li>Create a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>). See <a class="el" href="class_s_d_k_file_save_chooser.html">SDKFileSaveChooser</a> to ease the process of selecting an output file.<li>Acquire <a class="el" href="class_i_snippet_export.html">ISnippetExport</a> (from <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>), and call the appropriate overload of ExporttoStream.</ol><p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_snippet.html#adcb63383b7f150a6c2fe0999c8d71642">SnpImportExportSnippet::ExportTaggedContentItem</a></ul><h2><a class="anchor" id="id_working_with_snippet_import"></a> Working with snippet import</h2><h3><a class="anchor" id="id_importing_swatches_from_a_snippet"></a> Importing swatches from a snippet</h3><p>Suppose you already exported some or all of the swatches from a document, and you want to import them into another document.<p><b>Solution</b><p>You need to decide what node in the scripting DOM will be the target for the import. You need to target the document, which means you should parent the incoming snippet on the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). Follow these steps:<ol type="1"><li>Assume you opened a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>) onto the snippet file you want to import.<li>If you have a document interface (<a class="el" href="class_i_document.html">IDocument</a>, say), you only need to query its IXMLFragment interface and use that in <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream</a>.<li>Since you are importing into the document element in the scripting DOM, you should have an import policy of <a class="el" href="classk_doc_element_import_boss.html">kDocElementImportBoss</a>.</ol><p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide.</ul><p><b>Sample code</b><ul><li>SnpImportExportSnippet::ImportToDocumentElement</ul><h3><a class="anchor" id="id_importing_paragraph_and_character_styles_from_a_snippet"></a> Importing paragraph and character styles from a snippet</h3><p>Suppose you want to import a set of paragraph and/or character styles from a snippet.<p><b>Solution</b><p>You can import these into the document element. If you have a document reference (<a class="el" href="class_i_document.html">IDocument</a>), acquire the IXMLFragment interface and use <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream</a>.<p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Related API</b><ul><li><a class="el" href="class_i_snippet_import.html">ISnippetImport</a></ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_share_app_resources.html">SnpShareAppResources</a></ul><h3><a class="anchor" id="id_importing_object_styles_from_a_snippet"></a> Importing object styles from a snippet</h3><p>Suppose you want to import object styles previously exported as a snippet.<p><b>Solution</b><p>Use <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream</a>, as demonstrated in <a class="el" href="class_snp_import_export_snippet.html">SnpImportExportSnippet</a>.<h3><a class="anchor" id="id_importing_styled_text_from_a_snippet"></a> Importing styled text from a snippet</h3><p>Suppose you want to import some styled text, and you are not sure exactly what the target for the import should be. Assume you exported a story and already have one in a snippet.<p>The behavior of the application when it comes to snippets containing text needs to be examined carefully. If the root object in the snippet is a story (from a <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> object), the snippet expects to be inside an ICML or INCX file. If you drag this onto a document, it places the styled text as you expect. If you change the snippet file extension to .idms or .inds, instead of .icml or .incx, the snippet will not create styled text on import; instead, you will see the XML content.<p>On the other hand, if you export from the containing frame, you can drag in an .idms or .inds file containing styled text and get back a text frame with your styled text in it.<p><b>Solution</b><p>Using the low-level snippet-import mechanism is not easy when importing a story from INCX. It is safer to use the InCopy import provider (<a class="el" href="class_i_import_provider.html">IImportProvider</a>).<p><b>Related documentation</b><ul><li>Adobe InDesign Interchange (INX) File Format</ul><h3><a class="anchor" id="id_importing_page_items_from_a_snippet"></a> Importing page items from a snippet</h3><p>Suppose you want to import some page items you have already exported as described in <a class="el" href="id_solutions.html#id_exporting_page_items_to_a_snippet_without_selection">Exporting page items to a snippet (without selection)</a>.<p><b>Solution</b><ol type="1"><li>If you want the imported page item to be at the exact same location as when it was exported, set the &quot;snippet import uses original location&quot; preference (kSetSnippetImportLocationPrefCmdBoss) to kTrue; otherwise, set it to kFalse.<li>If these are to be top-level elements on the page, target the spread element (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a> in the boss DOM).<li>You may be importing into a group (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>). For more information, see the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> chapter; in particular, the section on groups.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_snippet.html#a1927a58b963cb91abd2f8247a53046a0">SnpImportExportSnippet::ImportToSpreadElement</a></ul><h3><a class="anchor" id="id_importing_xml_elements_from_a_snippet"></a> Importing XML elements from a snippet</h3><p>Suppose you want to import a set of XML elements that were already exported as described in <a class="el" href="id_solutions.html#id_exporting_xml_elements_as_a_snippet">Exporting XML elements as a snippet</a>. Suppose the XML elements were placed, and you want to create content in the layout on import.<p><b>Solution</b><ol type="1"><li>Open a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>) onto the snippet.<li>Decide what element on the scripting DOM (<a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>) to import the snippet into. To do this, you decide what <a class="el" href="class_x_m_l_reference.html">XMLReference</a> in the logical structure to target.<li>You may have to construct a proxy boss object (<a class="el" href="classk_x_m_l_item_proxy_script_object_boss.html">kXMLItemProxyScriptObjectBoss</a>) associated with the <a class="el" href="class_x_m_l_reference.html">XMLReference</a> that should parent the snippet content. This lets you acquire an IXMLFragment reference that you need for <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream</a>.</ol><p><b>Related documentation</b><ul><li>&quot;Snippet Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_snippet.html#aab640c504e0d3c4dae1490e4c89331b7">SnpImportExportSnippet::ImportXMLElements</a></ul><h2><a class="anchor" id="id_working_with_snippets_and_libraries"></a> Working with snippets and libraries</h2><h3><a class="anchor" id="id_using_asset_libraries"></a> Using asset libraries</h3><p>To a large extent, the dependence of asset libraries on snippets is hidden from end users. If your customers use asset libraries in their workflow, however, and you have persistent data added to document objects, you may need to add function so you can round-trip your data through snippets, because that is how assets with your data would be stored in asset libraries.<p><b>Solution</b><p>Be sure that any persistent data you add to the boss DOM also is added into the scripting DOM. This means making at least the persistent data in your plug-in scriptable.<p><b>Related documentation</b><ul><li>The &quot;Scriptable Plug-in Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Sample code</b><ul><li>CandleChart</ul><h3><a class="anchor" id="id_converting_the_indesign_cs_version_3_asset_library_to_the_current_version"></a> Converting the InDesign CS (Version 3) asset library to the current version</h3><p>Suppose you have an InDesign CS (version 3) asset library (INDL) file, and you want to update it to the current version.<p><b>Solution</b><p>Use the ConvertToSnippets method on <a class="el" href="class_i_library_asset_collection.html">ILibraryAssetCollection</a>.<p><b>Related documentation</b><ul><li>The &quot;Scriptable Plug-in Fundamentals&quot; chapter of Adobe InDesign Products Programming Guide</ul><p><b>Sample code</b><ul><li>CandleChart</ul><h3><a class="anchor" id="id_exporting_snippets_directly_from_an_asset_library"></a> Exporting snippets directly from an asset library</h3><p>Since assets are held as snippet in library files, is there some way to get at the data? For example, suppose your end users create asset libraries locally, but you do not want to store libraries in the back-end database; rather, you want to just store the assets in them as individual snippets, and re-create the libraries from snippets stored in your back-end database. You then have a requirement to break apart an asset library into individual snippets. Fortunately, because the asset library is just a wrapper around snippets with other directory-type information, it is relatively easy to do this.<p><b>Solution</b><p>If you just wanted to place a page item from an existing asset library to a document, you would use the existing API; for example, <a class="el" href="class_i_library_suite.html">ILibrarySuite</a> or <a class="el" href="class_i_library_cmd_utils.html">ILibraryCmdUtils</a>. Both of these require you to be familiar with the representation of assets in the library, so some of the content is still relevant to that use case.<p>Suppose, however, you want to export the contents of an asset library as individual snippet files. Follow these steps:<ol type="1"><li>Assets in an asset library (kSnippetBasedCatalogBoss) are represented by kLibraryAssetBoss. If you examine the profile of the interfaces kLibraryAssetBoss exposes, you can see <a class="el" href="class_i_library_asset_contents.html">ILibraryAssetContents</a>.<li><a class="el" href="class_i_library_asset_contents.html">ILibraryAssetContents</a> has methods to let you acquire the data for the asset as a sequence of bytes, which correspond to the serialized asset in snippet format.<li>Save the memory-based buffer to a file-based stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>), and you have a snippet file.</ol><p><b>Sample code</b><ul><li><a class="el" href="class_snp_import_export_snippet.html">SnpImportExportSnippet</a></ul><p><b>Related APIs</b><ul><li><a class="el" href="class_i_library.html">ILibrary</a><li><a class="el" href="class_i_library_asset.html">ILibraryAsset</a><li><a class="el" href="class_i_library_asset_collection.html">ILibraryAssetCollection</a><li><a class="el" href="class_i_library_asset_contents.html">ILibraryAssetContents</a> (kLibraryAssetBoss)</ul><h3><a class="anchor" id="id_adding_a_snippet_directly_to_an_asset_library"></a> Adding a snippet directly to an asset library</h3><p>Suppose you have a snippet file and want to somehow add it directly into an asset library, without going through the operation of placing the file into a document and then adding it from the document into the asset library.<p><b>Solution</b><p>If you just want to add an existing page item in a document to an asset library (kSnippetBasedCatalogBoss), there are APIs such as <a class="el" href="class_i_library_suite.html">ILibrarySuite</a> and <a class="el" href="class_i_library_cmd_utils.html">ILibraryCmdUtils</a> that help in this operation.<p>A more interesting operation from the snippet perspective is adding a snippet directly from a file into an asset library (kSnippetBasedCatalogBoss), without first placing the snippet in a document. Implementing this operation on the current public API is impossible. You might think of going through the scrap database rather than having to create a document, but you cannot import a snippet file into the scrap database, as it does not have a DOM element (<a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>) hierarchy; see <a class="el" href="classk_scrap_doc_boss.html">kScrapDocBoss</a> and compare with <a class="el" href="classk_doc_boss.html">kDocBoss</a>.<h1><a class="anchor" id="id_incopy_assignments"></a> InCopy: Assignments</h1><h2><a class="anchor" id="id_creating_an_assignment"></a> Creating an assignment</h2><p>Suppose you want to create a new assignment in an InDesign document.<h3><a class="anchor" id="id_solution"></a> Solution</h3><p>There are several ways to create a new assignment:<ul><li>If you want the end user to have full user-interface control, call <a class="el" href="class_i_assignment_u_i_utils.html#a8565d7df6cd58edd5ec8274e73767d66">IAssignmentUIUtils::NewAssignment</a>, which returns a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the new assignment. You can get <a class="el" href="class_i_assignment_u_i_utils.html">IAssignmentUIUtils</a> because it is aggregated into <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>.<li>If you do not want any user interface, use <a class="el" href="class_i_assignment_mgr.html#aefd6c4ad7778ee13e2ad5a42183914e7">IAssignmentMgr::CreateAssignmentCmd</a>, which returns an <a class="el" href="class_i_assignment.html">IAssignment</a> pointer. You can get <a class="el" href="class_i_assignment_mgr.html">IAssignmentMgr</a> from <a class="el" href="classk_session_boss.html">kSessionBoss</a> because it is aggregated into <a class="el" href="classk_session_boss.html">kSessionBoss</a>.<li>To use <a class="el" href="classk_assign_doc_cmd_boss.html">kAssignDocCmdBoss</a> directly, you need to pass the command various data. For an example, see the code snippet provided in the SDK.</ul><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li><a class="el" href="class_snp_manipulate_assignment.html#a61ac3c11efa3cb470a61c3811cf37cfc">SnpManipulateAssignment::NewAssignment</a></ul><h3><a class="anchor" id="id_related_apis"></a> Related APIs</h3><ul><li><a class="el" href="class_i_assignment.html">IAssignment</a><li><a class="el" href="class_i_assignment_mgr.html">IAssignmentMgr</a><li><a class="el" href="class_i_assignment_u_i_utils.html">IAssignmentUIUtils</a><li><a class="el" href="classk_assign_doc_cmd_boss.html">kAssignDocCmdBoss</a></ul><h2><a class="anchor" id="id_adding_content_to_an_assignment"></a> Adding content to an assignment</h2><p>Suppose you want to add text stories or images to an existing assignment.<h3><a class="anchor" id="id_solution"></a> Solution</h3><ol type="1"><li>Get <a class="el" href="class_i_assignment_selection_suite.html">IAssignmentSelectionSuite</a> from active context.<li>Use <a class="el" href="class_i_assignment_selection_suite.html#ab2aaa414bb5975091c3637ab342799e2">IAssignmentSelectionSuite::Assign</a>.</ol><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li><a class="el" href="class_snp_manipulate_assignment.html#ad2867673ade36634996dac284452f109">SnpManipulateAssignment::AddToAssignment</a></ul><h3><a class="anchor" id="id_related_apis"></a> Related APIs</h3><ul><li><a class="el" href="class_i_assignment_mgr.html">IAssignmentMgr</a><li><a class="el" href="class_i_assignment_selection_suite.html">IAssignmentSelectionSuite</a><li><a class="el" href="classk_add_to_assignment_cmd_boss.html">kAddToAssignmentCmdBoss</a></ul><h2><a class="anchor" id="id_examining_the_content_of_an_assignment"></a> Examining the content of an assignment</h2><p>Suppose you want to know the content of an assignment.<h3><a class="anchor" id="id_solution"></a> Solution</h3><ol type="1"><li>Instantiate the <a class="el" href="class_i_assignment.html">IAssignment</a> interface of the assignment.<li>Get information about the assignment from the interface, like assignment name, assignee, and assignment file path.<li>Get a list of <a class="el" href="class_i_assigned_story.html">IAssignedStory</a> objects from <a class="el" href="class_i_assignment.html#ac688504477b110379e98c8aaf31a7061">IAssignment::GetStories</a>.<li>See whether each assigned story is a text story or an image story, by examining the ClassID of the object.<li>Get information about each assigned story through the <a class="el" href="class_i_assigned_story.html">IAssignedStory</a> interface.</ol><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li><a class="el" href="class_snp_manipulate_assignment.html#ae0b3f216f8db5579b3f045a79b2d6cd1">SnpManipulateAssignment::InspectAssignment</a></ul><h3><a class="anchor" id="id_related_apis"></a> Related APIs</h3><ul><li><a class="el" href="class_i_assigned_story.html">IAssignedStory</a><li><a class="el" href="classk_assigned_story_boss.html">kAssignedStoryBoss</a><li><a class="el" href="class_i_assignment.html">IAssignment</a><li><a class="el" href="classk_assigned_image_boss.html">kAssignedImageBoss</a></ul><h2><a class="anchor" id="id_deleting_an_assignment"></a> Deleting an assignment</h2><p>Suppose you want to delete an existing assignment from a document.<h3><a class="anchor" id="id_solution"></a> Solution</h3><ol type="1"><li>Create <a class="el" href="classk_unassign_doc_cmd_boss.html">kUnassignDocCmdBoss</a>.<li>Get the assignment file path from the <a class="el" href="class_i_assignment.html">IAssignment</a> interface.<li>Pass the document <a class="el" href="class_u_i_d_ref.html">UIDRef</a> as the command&#39;s ItemList, and pass the assignment file path as command data.<li>Process the command.</ol><h3><a class="anchor" id="id_sample_code"></a> Sample code</h3><ul><li><a class="el" href="class_snp_manipulate_assignment.html#a6869a9ff8176c4fb0b04ad8b268d0faf">SnpManipulateAssignment::DeleteAssignment</a></ul><h3><a class="anchor" id="id_related_apis"></a> Related APIs</h3><ul><li><a class="el" href="class_i_assignment.html">IAssignment</a><li>IID_ISTRINGDATA<li><a class="el" href="classk_unassign_doc_cmd_boss.html">kUnassignDocCmdBoss</a></ul></div></div></div><div class="navpath" id="nav-path"><ul><li class="footer">Generated on Sat Sep 22 2018 10:53:01 for InDesign SDK by <a href="http://www.doxygen.org/index.html"> <img alt="doxygen" class="footer" src="doxygen.png" /></a> 1.8.3.1 </ul></div></body></html>

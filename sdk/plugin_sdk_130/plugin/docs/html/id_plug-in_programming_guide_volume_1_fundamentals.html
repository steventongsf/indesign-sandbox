<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/xhtml;charset=UTF-8" http-equiv="Content-Type" /><meta content="IE=9" http-equiv="X-UA-Compatible" /><meta content="Doxygen 1.8.3.1" name="generator" /><title>id_plug-in_programming_guide_volume_1_fundamentals</title><link href="tabs.css" rel="stylesheet" type="text/css" /><script src="jquery.js" type="text/javascript"></script><script src="dynsections.js" type="text/javascript"></script><link href="navtree.css" rel="stylesheet" type="text/css" /><script src="resize.js" type="text/javascript"></script><script src="navtree.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(initResizable);

  $(window).load(resizeHeight);

</script><link href="search/search.css" rel="stylesheet" type="text/css" /><script src="search/search.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(function() { searchBox.OnSelectItem(0); });

</script><link href="doxygen.css" rel="stylesheet" type="text/css" /></head><body><div id="top"><div id="titlearea"><table cellpadding="0" cellspacing="0"><tbody><tr style="height: 56px;"><td id="projectlogo"><img alt="Logo" src="adobe_logo.png" /></td><td style="padding-left: 0.5em;"><div id="projectname">InDesign SDK &nbsp;<span id="projectnumber">14.0.0</span></div></td></tr></tbody></table></div><script type="text/javascript">

var searchBox = new SearchBox("searchBox", "search",false,'Search');

</script><div class="tabs" id="navrow1"><ul class="tablist"><li><a href="index.html"><span>InDesign&nbsp;SDK</span></a><li class="current"><a href="pages.html"><span>Documentation</span></a><li><a href="group__bosses__parent.html"><span>Bosses</span></a><li><a href="group__sdk.html"><span>Sample&nbsp;plug-ins</span></a><li><a href="classes.html"><span>Class&nbsp;Index</span></a><li><div class="MSearchBoxInactive" id="MSearchBox"><span class="left"> <img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="search/mag_sel.png" /> <input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search" /> </span><span class="right"> <a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="search/close.png" /></a> </span></div></ul></div></div><div class="ui-resizable side-nav-resizable" id="side-nav"><div id="nav-tree"><div id="nav-tree-contents"><div class="sync" id="nav-sync"></div></div></div><div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;"></div></div><script type="text/javascript">

$(document).ready(function(){initNavTree('id_plug-in_programming_guide_volume_1_fundamentals.html','');});

</script><div id="doc-content"><div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()"><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Pages</a></div><div id="MSearchResultsWindow"><iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)"></iframe></div><div class="header"><div class="headertitle"><div class="title">Plug-In Programming Guide I </div></div></div><div class="contents"><div class="textblock"><h1><a class="anchor" id="id_introduction"></a> Introduction</h1><p>This document is not designed to be a starting point for InDesign development. It picks up where the getting started document ends, and is designed for understanding specific development topics more deeply.<h1><a class="anchor" id="id_persistent_data_and_data_conversion"></a> Persistent Data and Data Conversion</h1><p>For troubleshooting related to converting persistent data, see <a class="el" href="id_solutions.html#id_versioning_persistent_data">Versioning Persistent Data</a> in the solutions guide.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><h3><a class="anchor" id="id_persistence"></a> Persistence</h3><p>A persistent object can be removed from main memory and returned again, unchanged. A persistent object can be part of a document (like a spread or page item) or part of the application (like a dialog box, menu item, or default setting). Persistent objects can be stored in a database, to last beyond the end of a session. Nonpersistent objects last only until memory is freed, when the destructor for the object is called. Only persistent objects are stored in databases.<h3><a class="anchor" id="id_databases"></a> Databases</h3><p>The application uses lightweight databases to store persistent objects. The host creates a database for each document created. The host also creates a database for the clipboard storage space, the object model information (the InDesign SavedData or Adobe InCopy SavedData file), and the workspace information (the InDesign Defaults or InCopy Defaults file).<p>Each document is contained in its own database. Each persistent object in the database has a UID, a ClassID, and a stream of persistent data.<p>The stream with the persistent object data contains a series of records that correspond to the persistent object. The object&#39;s UID is stored with the object, as a key for the record. The variable-length records have one segment for each persistent interface. Every segment has the same structure:<div class="fragment"><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> tag</div><div class="line">int32 length</div><div class="line">&lt;data&gt;</div></div><p>The following figure is a conceptual diagram of this structure; it does not represent the actual content of any database. The format and content of the data are determined by the implementation of the interface. See see &quot;Reading and writing persistent data&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_implementing_persistent_objects">Implementing persistent objects</a>.<div class="image"><img alt="plugin-programming-guide-vol1-1.gif" src="plugin-programming-guide-vol1-1.gif" /></div><p>For each object, the ClassID value is stored in the table, and the ImplementationID values are stored in the stream, but the InterfaceID value is not stored with either. Adding an existing implementation (that is, an implementation supplied by the SDK) to an existing class can cause problems if another software developer adds the same implementation to the class: one of the two plug-ins will fail on start-up. To avoid this collision, create a new implementation for any persistent interface to be added to a class, using ImplementationAlias. For an example, see &lt;SDK&gt;/source/sdksamples/dynamicpanel/DynPn.fr.<h2><a class="anchor" id="id_persistent_objects"></a> Persistent objects</h2><p>This section discusses how persistent objects are created, deleted, and manipulated.<p>The application stores persistent objects in a database, and each object has a unique identifier within the database. The methods for creating, instantiating, and using a persistent object are different from the methods for nonpersistent objects.<h3><a class="anchor" id="id_using_persistent_objects"></a> Using persistent objects</h3><p>When a persistent object is created, its record exists in memory. Certain events, like a user&#39;s request to save a document, trigger the writing of the record to storage. (See the following figure.) A count is maintained of the number of references to each persistent object. Any object with a reference count greater than zero remains active in memory. If the reference count for a persistent object reaches zero, the object may be asked to write itself to its database and be moved to the instance cache, which makes the object a candidate for deletion from memory. Events that require access to the object, like drawing or manipulating it, trigger the host to read the object back into memory. Because individual objects can be saved and loaded, the host does not have to load the entire document into memory at once.<p>This figure shows creating and storing persistent objects:<div class="image"><img alt="plugin-programming-guide-vol1-2.gif" src="plugin-programming-guide-vol1-2.gif" /></div><p><b>Creating a persistent object</b><p>Creating a new instance of a persistent object differs from creating a nonpersistent object, because it requires a unique identifier to associate the object with its record in the database. For the CreateObject and CreateObject2 methods used to create persistent objects, see &lt;SDK&gt;/source/public/includes/CreateObject.h.<p>For examples of the creation of persistent objects, see the CreateWidgetForNode method in &lt;SDK&gt;/source/sdksamples/paneltreeview/PnlTrvTVWidgetMgr.cpp or the StartupSomePalette method in &lt;SDK&gt;/source/sdksamples/dynamicpanel/DynPnPanelManager.cpp.<p>You also can call <a class="el" href="class_i_data_base.html#a7b9090fdc18c31c3e46310c2aa06be5a">IDataBase::NewUID</a> method to create a new UID in the database. It adds an entry to the database relating the UID to the class of the object being created; however, the object is not instantiated yet, and no other information about it exists in the database.<p><b>Instantiating a persistent object</b><p>Before you instantiate a new object, use the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> template to retrieve one of the object&#39;s interfaces. Pass the returned <a class="el" href="class_interface_ptr.html">InterfacePtr</a> to the IDatabase::Instantiate method, which calls the database to instantiate the object.<p>There is only one object in memory for any UID and database. This method checks whether the object already is in memory and, if so, returns a reference to that object. If the object is marked as changed, it is written to the database. For more information, see &quot;Reading and writing persistent data&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_implementing_persistent_objects">Implementing persistent objects</a>. If the object is not in memory, the method checks for previously stored data in the database. If data is found, the method instantiates the object from this data. Otherwise, the method instantiates the object from the object&#39;s constructor. Each implementation has a constructor, so the boss and all its implementations are instantiated.<p>An object is stored to the database only if it is changed, making the default object data invalid. A single object could exist and be used in several user sessions without ever being written to the database. A persistent object whose data is not stored in the database is constructed from the object&#39;s constructor.<p>Whether it instantiates a new object or returns a reference to an object previously instantiated, IDatabase::Instantiate increments the reference count on the object and returns an IPMUnknown* to the requested interface, if the interface is available.<p><b>Using commands and wrappers</b><p>There are commands for creating new objects of many of the existing classes (for example, <a class="el" href="classk_new_doc_cmd_boss.html">kNewDocCmdBoss</a>, <a class="el" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a>, <a class="el" href="classk_new_story_cmd_boss.html">kNewStoryCmdBoss</a>, and <a class="el" href="classk_new_u_i_d_cmd_boss.html">kNewUIDCmdBoss</a>). When you need to create an object, first look for a suite interface, utility interface, or facade interface to make creating your object safe and easy. If no such interface exists, use a command if one is available, rather than creating the object with general functions.<p>Using a command to create an object protects the database. Commands are transaction based; if you use a command when the application already is in an error state, the command performs a protective shut-down, which quits the application rather than permitting a potentially corrupting change to be made to the document. Commands also provide notification for changes to the model, allowing observers to be updated when the change is made, including changes made with undo and redo operations.<p>When you implement a new type of persistent object, also implement a command to create objects of that type, using methods outlined in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_implementing_persistent_objects">Implementing persistent objects</a>.<p><b>Types of references to objects</b><p>There are four types of reference to a persistent object: UID, <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, <a class="el" href="class_interface_ptr.html">InterfacePtr</a>, and <a class="el" href="class_u_i_d_list.html">UIDList</a>. Each type of reference serves a different purpose. Understanding these reference types makes working with persistent objects easier.<ul><li>UID is the type used for a unique identifier within the scope of a database. The UID value by itself is not sufficient to identify the object outside the scope of the database. Like a record number, a UID value has meaning only within a given database. UID values are useful for storing, passing, and otherwise referring to boss objects, because UID values have no run-time dependencies, and there is an instance cache ensuring fast access to the instantiated objects. kInvalidUID is a value used to identify a UID that does not point at a valid object. Any time a UID is retrieved and needs to be tested to see if it points at a valid object, the UID should be compared to kInvalidUID.<li>A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> object contains two pieces of information: a pointer to a database and the UID of an object within this database. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> is useful for referring to objects, because it identifies both the database and the object. Using a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> object is a common means of referring to a persistent object, especially when the persistent object is to be passed around or stored, since a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> does not require the referenced object to be instantiated. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> object cannot itself be persistent data, because it has a run-time dependency, the database pointer. An empty or invalid <a class="el" href="class_u_i_d_ref.html">UIDRef</a> object has kInvalidUID as its UID and a nil pointer as its database pointer.<li>An <a class="el" href="class_interface_ptr.html">InterfacePtr</a> object contains a pointer to an interface (on any type of boss object) and identify an instantiated object in main memory. While an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> object on the boss is necessary for working with the boss, it should not be used to track a reference to a persistent object, because this forces the object to stay in memory. In many cases, a nil pointer returned from <a class="el" href="class_interface_ptr.html">InterfacePtr</a> does not indicate an error state but simply means the requested interface does not exist on the specified boss.<li>A <a class="el" href="class_u_i_d_list.html">UIDList</a> object contains a list of UIDs and a single pointer to a database. This means all objects identified by a <a class="el" href="class_u_i_d_list.html">UIDList</a> must be within the same database. A <a class="el" href="class_u_i_d_list.html">UIDList</a> is a class object and should be used any time a list of objects is needed for a selection or a command.</ul><p><b>Destroying an object</b><p>There are commands for deleting persistent objects. Use the command rather than calling the DeleteUID method directly, to be sure of cleaning up all references to the object or item references contained in the object.<p>When you implement a command to delete a persistent object, after you remove the references to the object, use DeleteUID to delete the object from the database, as follows: <div class="fragment"><div class="line"><a class="code" href="class_i_data_base.html#aeb5462fe60d1a1f2f36bd014a0514510">IDataBase::DBResultCode</a> dbResult = database-&gt;DeleteUID(uid);</div></div><h3><a class="anchor" id="id_implementing_persistent_objects"></a> Implementing persistent objects</h3><p>To make a boss object persistent, add the <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> interface. Any boss with this interface is persistent and, when an object of the boss is created, it is assigned a UID. Even though the object has a UID, and the UID has an entry in the (ClassID, UID) pairings in a database, the object does not automatically store data. It is up to the interface to store the data it needs. To implement this, add the ReadWrite method to the interface (see &quot;Reading and writing persistent data&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_implementing_persistent_objects">Implementing persistent objects</a>), and make sure the PreDirty method is called before information is changed (see &quot;Marking changed data&quot;).<dl class="section note"><dt>Note<dd>If you add an interface to an existing persistent boss, the interface also may be made persistent. If so, you must obey the following implementation rules for it.</dl><p><b>Adding the <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> interface to a boss</b><p>All instances of <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> must use the kPMPersistImpl implementation. For an example, see the <a class="el" href="classk_pst_lst_data_boss.html">kPstLstDataBoss</a> boss class definition in &lt;SDK&gt;/source/sdksamples/persistentlist/PstLst.fr<p><b>Creating an interface factory for a persistent interface</b><p>For a persistent implementation, use the CREATE_PERSIST_PMINTERFACE macro.<p><b>Reading and writing persistent data</b><p>To store data, your interface must support the ReadWrite method. This method does the actual reading and writing of persistent data in the database. The method takes a stream argument containing the data to be transferred. Read and write stream methods are generalized, so one ReadWrite method handles transfers in both directions. For example, XferBool reads a boolean value for a read stream and writes a boolean value for a write stream. For an example, see the <a class="el" href="class_b_p_i_data_persist.html#a2a21c352632b1d670fb8afbbeb1a1e6e">BPIDataPersist::ReadWrite</a> method in &lt;SDK&gt;/source/sdksamples/basicpersistinterface/BPIDataPersist.cpp.<p><b>Marking changed data</b><p>When data changes for a persistent object that resides in memory, there is a difference between the current version of the object and the object as it exists in the database&#39;s storage. When this happens, the object in memory is said to be dirty, meaning it does not match the version in storage. Before a persistent object is modified, you must call the PreDirty method to mark the object as being changed, so it is written to the database. For an example, see the <a class="el" href="class_b_p_i_data_persist.html#a1ab2ff22a302114d20e22e401e1c05c7">BPIDataPersist::Set</a> method in &lt;SDK&gt;/source/sdksamples/basicpersistinterface/BPIDataPersist.cpp.<p>The PreDirty method called from within <a class="el" href="class_b_p_i_data_persist.html#a1ab2ff22a302114d20e22e401e1c05c7">BPIDataPersist::Set</a> is implementation-independent, so you can rely on the version provided by HELPER_METHODS macros defined in <a class="el" href="_helper_interface_8h_source.html">HelperInterface.h</a> (DECLARE_HELPER_METHODS, DEFINE_HELPER_METHODS, and HELPER_METHODS_INIT).<h2><a class="anchor" id="id_streams"></a> Streams</h2><p>This section discusses how streams are used to move information into and out of a document.<p>Streams are used by persistent objects to store their information to a database. Streams also are used by the host application, to move data like placed images, information copied to the clipboard, and objects stored in the database. <a class="el" href="class_i_p_m_stream.html">IPMStream</a> is the public interface to streams. Implementations of <a class="el" href="class_i_p_m_stream.html">IPMStream</a> typically use the <a class="el" href="class_i_xfer_bytes.html">IXferBytes</a> interface to move data.<p>Stream utility methods (in <a class="el" href="_stream_util_8h_source.html">StreamUtil.h</a>) are helpers for creating all the common types of streams used to move information within or between InDesign databases. The stream utility methods and general read, write, and copy methods are needed any time you work with a stream.<h3><a class="anchor" id="id_ipmstream_methods"></a> IPMStream methods</h3><p><a class="el" href="class_i_p_m_stream.html">IPMStream</a> is a generalized class for both reading and writing streams. Any particular stream implementation is either a reading stream or a writing stream, and the type of stream can be determined with the <a class="el" href="class_i_p_m_stream.html#a903b27c57e663ca0a8ec4c8547244680">IPMStream::IsReading</a> and <a class="el" href="class_i_p_m_stream.html#acf15c6fdcee428cfb6d3964a5e11c1dd">IPMStream::IsWriting</a> methods.<p>Any persistent implementation has a ReadWrite method, which uses a set of data-transferring methods on the stream to read and write its data. (See &quot;Reading and writing persistent data&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_implementing_persistent_objects">Implementing persistent objects</a>). The <a class="el" href="class_i_p_m_stream.html">IPMStream</a> methods starting with the Xfer prefix are used for transferring the data type identified in the method name. For example, XferByte transfers a byte, XferInt16 transfers a 16-bit integer, XferBool transfers a Boolean value, and so on. All transferring methods are overloaded, so they can take a single item or an array of items. (The XferByte(uchar, int32) version typically is used for buffers.) Streams also handle byte swapping, if required. If swapping is not set (SetSwapping(bool16)), the default is to not do byte-order swapping.<p>Additional <a class="el" href="class_i_p_m_stream.html">IPMStream</a> methods, XferObject and XferReference, transfer boss objects and references to objects. XferObject transfers an owned object, and XferReference transfers a reference to an object not owned by the object using the stream. To decide which method to use, think about what should happen to the object if the owning object were deleted. If the object should still be available (as, for example, the color a page item refers to), use XferReference. If the item is owned by the object and should be deleted with the owner (as, for example, the page a document refers to), use XferObject.<h3><a class="anchor" id="id_implementing_a_new_stream"></a> Implementing a new stream</h3><p>If you must read from or write to a location the host application does not recognize, you must create a new type of stream. For example, you might need to create a new stream type to import and export files stored on an FTP site or in a database.<p><b>Stream boss</b><p>The first step in implementing a new stream is to define the boss. Typically, a stream boss contains <a class="el" href="class_i_p_m_stream.html">IPMStream</a> and any interface required to identify the type of information in the stream, the target or source of the stream, or both. This example creates kExtLinkPointerStreamWriteBoss, a pointer-based read-stream boss:<div class="fragment"><div class="line">Class{</div><div class="line"> kExtLinkPointerStreamWriteBoss,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IPMSTREAM, kExtLinkPointerStreamWriteImpl,</div><div class="line"> IID_IPOINTERSTREAMDATA, kPointerStreamDataImpl,</div><div class="line"> }</div><div class="line">};</div></div><p><a class="el" href="class_i_p_m_stream.html">IPMStream</a> is the only interface all stream bosses have in common. In the preceding example, the <a class="el" href="class_i_pointer_stream_data.html">IPointerStreamData</a> controls a stream that writes out to memory; it contains a buffer and a length.<p>The following is another example, showing <a class="el" href="classk_file_stream_read_boss.html">kFileStreamReadBoss</a>, a stream commonly used in importing:<div class="fragment"><div class="line">Class{</div><div class="line"><a class="code" href="classk_file_stream_read_boss.html">kFileStreamReadBoss</a>,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IPMSTREAM, kFileStreamReadLazyImpl,</div><div class="line"> IID_IFILESTREAMDATA, kFileStreamDataImpl,</div><div class="line"> }</div><div class="line">};</div></div><p><b><a class="el" href="class_i_p_m_stream.html">IPMStream</a> interface and the <a class="el" href="class_i_xfer_bytes.html">IXferBytes</a> class</b><p>When implementing your own stream, take advantage of the default implementations of <a class="el" href="class_i_p_m_stream.html">IPMStream</a>, <a class="el" href="class_c_stream_read.html">CStreamRead</a>, and <a class="el" href="class_c_stream_write.html">CStreamWrite</a>. These default implementations use an abstract base class, <a class="el" href="class_i_xfer_bytes.html">IXferBytes</a>, to do the actual reading and writing. To implement a stream for a new data source, you must create an <a class="el" href="class_i_xfer_bytes.html">IXferBytes</a> subclass that can read and write to that data source.<h2><a class="anchor" id="id_missing_plug_ins"></a> Missing plug-ins</h2><p>This section discusses how to open a document that contains data saved by a plug-in that is no longer available.<p>Plug-ins you create can add data to the document. When your plug-in is present and loaded, it can open and interpret the data; however, if the user removes the plug-in and then opens the document, or gives the document to someone who does not have the plug-in, the plug-in is not available to interpret the data.<p>You have two ways to handle such situations:<ul><li>Control what warning is shown when the document is opened without the plug-in.<li>Implement code to update the data the next time the document is opened with the plug-in.</ul><p>The rest of this section describes these options.<h3><a class="anchor" id="id_warning_levels"></a> Warning levels</h3><p>The application can give a warning when it opens a document that contains data created by a plug-in that is not available. There are three warning levels: critical, default, and ignore. By setting the warning level, the plug-in can specify the relative importance of its data. Data created by the plug-in has the &quot;default&quot; warning level unless you override the setting and identify the data as more important (critical) or less important (ignored). This importance settings can be modified by adding resources to the plug-in&#39;s boss definition file:<ul><li>CriticalTags - A &quot;critical&quot; warning tells the user the document contains data from missing plug-ins and strongly advises the user not to open the document. If the user continues the open operation, the application opens an untitled document that is a copy of the original, to preserve the original document. Use this level when the data is visible in the document or contributes objects owned by another object in the database, like text attributes, owned by the text model.<li>DefaultTags - A &quot;default&quot; warning tells the user the document contains data from missing plug-ins and asks whether to continue the open operation. If the user continues the open operation, the application opens the original document. Use this level when the data is self-contained and invisible to the user, but the user might encounter missing function that would have been provided by the plug-in.<li>IgnoreTags - An &quot;ignore&quot; warning provides no warning message at all; the application proceeds with the open operation as if there were no missing plug-ins. Use this level when the data is invisible to the user and completely self-contained. In this case, the user does not need to know the plug-in was involved in the construction of this document. If the plug-in stored data in the document, but that data is used only by this plug-in and does not reference objects supplied by other plug-ins, the user sees no difference in the document when the plug-in is missing. For example, the plug-in might store preferences information in every document for its own use.</ul><p>You can set these warnings to use ClassID (when the plug-in creates new bosses) or ImplementationID (when the plug-in adds interfaces to existing bosses) values as triggers. Use kImplementationIDSpace to specify a list of ImplementationID values, and kClassIDSpace for ClassID values. You can put any number of IDs in the list, but all the IDs must be of the same type. Use a second resource to mark IDs of another type. the following examples set the warning level to ignore data stored by the PersistentList plug-in in the SDK by adding two resources to PstLst.fr:<p>This example marks implementation IDs as ignored:<div class="fragment"><div class="line">resource IgnoreTags(1){</div><div class="line"> kImplementationIDSpace,</div><div class="line"> {</div><div class="line"> kPstLstDataPersistImpl,</div><div class="line"> kPstLstUIDListImpl,</div><div class="line"> }</div><div class="line">};</div></div><p>This example marks boss classes as ignored:<div class="fragment"><div class="line">resource IgnoreTags(2){</div><div class="line"> kClassIDSpace,</div><div class="line"> {</div><div class="line"><a class="code" href="classk_pst_lst_data_boss.html">kPstLstDataBoss</a>,</div><div class="line"> }</div><div class="line">};</div></div><p>You do not need to mark any IDs that do not appear in the document (for example, data that was written out to saved data) or implementations that are not persistent.<p>You do not need to mark IDs if you want the default behavior.<h3><a class="anchor" id="id_missing_plug-in_alert"></a> Missing plug-in alert</h3><p>This alert is activated when a document is opened and contains data from one or more missing plug-ins that cannot be ignored. The document contains a list of the plug-ins that added data to it. Each piece of data added has an importance attached to it; this may be critical, default, or ignorable. Data marked as ignorable does not cause the alert to be activated. Data marked as critical or default causes the alert to be activated. In the case of critical data, the alert works more strongly; this is the only difference between critical and default data.<p>The alert tells the user data is missing, presents a list of missing plug-ins, and allows the user to continue or cancel the open operation. Each missing plug-in has the chance to add a string to the alert that specifies additional useful information (for example, a URL for purchasing or downloading the plug-in). The alert is modeled on the missing-font alert.<p>The &quot;Don&#39;t Warn Again For These Plug-ins&quot; option is deselected by default. If this option is selected, the alert is not activated the next time a document is opened and any subset of the listed plug-ins is missing (and no other plug-ins are missing). This allows users accustomed to seeing (and ignoring) alerts concerning specific plug-ins to automatically bypass the alert, while still getting warned about data from any plug-ins newly found to be missing. The alert is activated again if a document is opened that uses other missing plug-ins. The alert is activated again if the &quot;Don&#39;t Warn Again For These Plug-ins&quot; option is deselected.<h3><a class="anchor" id="id_guidelines_for_handling_a_missing_plug-in"></a> Guidelines for handling a missing plug-in</h3><p>If a plug-in creates persistent data in a document, these guidelines ensure that the document behaves gracefully if a user tries to open it when the plug-in is missing or if the document has been edited by a user who did not have the plug-in:<ul><li>If your plug-in does not store data in documents, you do not need to take any special precautions.<li>If the data stored by your plug-in does not reference other data in the document and does not appear visually in the document, mark the data as ignorable.<li>If editing the document without your plug-in could corrupt the document, mark the data as critical. You can specify a string that is displayed when the plug-in is missing and the user opens a document that contains data added by the plug-in. See the ExtraPluginInfo resource, which may provide information like the URL of a site from which the missing plug-in can be obtained. See an example of the use of this resource in &lt;SDK&gt;/source/sdksamples/transparencyeffect/TranFx.fr.<li>If your plug-in can check and restore the data&#39;s integrity when opening a document edited without the plug-in, supply a FixUpData method. For an example, see &lt;SDK&gt;/source/sdksamples/persistentlist/PstLstPlugIn.cpp.<li>If you want your plug-in to handle the storage of its own data, use the application-supplied mechanism that treats the plug-in&#39;s data like a black box. (See &quot;Black-box data storage&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_data_handling_for_missing_plug-ins">Data handling for missing plug-ins</a>).</ul><h3><a class="anchor" id="id_data_handling_for_missing_plug-ins"></a> Data handling for missing plug-ins</h3><p>If a document contains data placed there by a plug-in that is not available, the user can choose to open the document anyway. If the data is completely self-contained, there may be no problem; however, if the plug-in&#39;s data depends on anything else in the document, undesirable things can happen.<p><b>Missing data not copied</b><p>InDesign maintains most data in a centrally managed model in which the core-content manager keeps track of what information is added to the document, handles conversion of the data, and provides a convenient mechanism for instantiating objects based on the data. This approach does not allow the data to be copied when the plug-in is missing, however, because the content manager would not be able to provide these services for the missing plug-in&#39;s copied data, and that potentially can leave the document in an invalid state. With the exception of those objects that hold onto only ClassID values, InDesign blocks copying data associated with missing plug-ins.<p>This means no attribute is copied if the plug-in that supplies the attribute is missing. This applies to all attributes: text, graphics, table, cjk, and so on. Furthermore, if a plug-in attached a data interface to an existing attribute, and the plug-in is missing, the attribute is copied but the add-in data interface is not. This is consistent with how InDesign handles UID-based objects.<p>Likewise, if a data interface is added to an XML element, the data interface is not copied if the plug-in that supplied it is missing.<p>There are several features based on an object from a required plug-in holding a ClassID from an optional plug-in, including adornments, text composer, pair-kern algorithm, section numbers, and unit defaults. In these cases, the consequences of losing track of the plug-in that supplied the data is much less severe. Conversion of these ClassIDs is quite unusual and could be handled if necessary by issuing new ClassIDs. Error handling in the user interface when the plug-in is missing is much more graceful.<p><b>Black-box data storage</b><p>A second, simpler data-model storage mechanism was added for software developers requiring that data (like text attributes) is copied with the text, and for developers who want to attach data to other ID objects, such that it gets copied even when the source plug-in is missing. This mechanism is black-box data storage.<p>In the simplest case, the black box is just a new persistent interface that sits on the object. A plug-in can store data in the box or fetch data out of the box. The data is keyed by a ClassID, which is supplied by the plug-in. Multiple plug-ins can store their data in the same black box, and each plug-in gets its own unique streamed access to its data. The black box just keeps track of the key, the length of the data, and the data stream. The software developer is responsible for handling everything else-conversion, swapping, and so on. Users do not get a missing plug-in alert for data placed in a black box.<p>Any UID-based object could have a black box. In addition, attributes and small bosses (used for XML elements) can have black boxes.<p>The following objects support black boxes:<ul><li><a class="el" href="classk_doc_boss.html">kDocBoss</a> - The root object of the document does not get copied.<li><a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> - This includes all page item objects, including spreads, master pages, splines, frames, images, and text frames.<li>Attributes - This includes text, graphic, table, cjk, and so on (that is, everything that appears in an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a>).</ul><p>For more information on the black-box mechanism, refer to <a class="el" href="class_i_black_box_commands.html">IBlackBoxCommands</a>, <a class="el" href="class_i_black_box_cmd_data.html">IBlackBoxCmdData</a>, and <a class="el" href="class_i_black_box_data.html">IBlackBoxData</a> in the API reference.<p><b>FixUpData</b><p>Suppose that a hyperlink attribute is linked to another frame, and the user can double-click the link to go to the frame. A plug-in supplies an observer, so if the frame is deleted, the link is severed. Now suppose that you give the document containing the hyperlinks to someone who does not have the hyperlink plug-in. This person edits the document, deletes the frame, saves the document, then returns the document to you. The document is now corrupted, because your plug-in was unable to delete the associated link, which now points to an undefined frame.<p>To restore the integrity of a document in this case, the plug-in can override the <a class="el" href="class_i_plug_in.html#a2e8fb8d1e072d6a969f1c8dc701a33ba">IPlugIn::FixUpData</a> method. This method is called when the document is opened, if the plug-in was used to store data in the document and the document was edited and saved without the plug-in. In this case, the hyperlinks plug-in could override FixUpData to scan all its objects, checking whether the linked frame UIDs were deleted; when the document is opened with the plug-in, the method correctly severs the links.<h2><a class="anchor" id="id_conversion_of_persistent_data"></a> Conversion of persistent data</h2><p>This section describes types of conversion providers and the advantages of each type.<p>Converting persistent data from an old document to a new one is complex, because each plug-in can store data independently in the document. When the host opens a document created with an older version of the application or an older version of any plug-in used in the document, you must convert and update the older data to match the new format.<p>Versioning persistent data is the process of converting persistent data in a database from one format to another. The data in different formats usually resides in different databases; for example, data in a database (document) from a previous version of InDesign versus that in a database (document) from a newer version of InDesign. Just as each plug-in that has a persistent data implementation is responsible for the order of reading and writing its own data (thus implicitly defining a data format), each plug-in also is responsible for converting its own data from one format to another. Whether data in a database requires conversion usually is determined when the database is opened.<p>There are two approaches to converting persistent data:<ul><li>You can use the host&#39;s conversion manager to manage the conversion process. This approach is the most common. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_converting_data_with_the_conversion_manager">Converting data with the conversion manager</a>.<li>The plug-in that owns the data can manage when and how data is converted, using version information or other data embedded with the object data. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_converting_data_without_the_conversion_manager">Converting data without the conversion manager</a>.</ul><h3><a class="anchor" id="id_when_to_convert_persistent_data"></a> When to convert persistent data</h3><p>As a plug-in developer, you want to ensure that your users can open documents with persistent data from an older version of your plug-in. To do this, your plug-in must provide data conversion functions. The best time to consider your data-conversion strategy is when you realize that your plug-in will store some data to a database. You need to implement data-conversion utilities in the following cases:<ul><li>You change the order of IPMStream::Xfer* calls in the ReadWrite method.<li>You change a persistent object&#39;s definition.<li>You renumber (change the value of) an ImplementationID or ClassID identifier.<li>You remove a plug-in and data from the removed plug-in might be in a document a user wants to open.</ul><p>In any of these cases, the conversion manager needs to be notified how to convert the persistent data for use by the loaded plug-in.<p>Specifying how the persistent data format changed is somewhat different from adding persistent data to or removing it from a document. Besides telling the conversion manager to add or delete any obsolete data, the conversion provider has to be able to tell the conversion manager about every implementation in the plug-in that was ever removed, to keep the content manager up to date about the various persistent data formats.<dl class="section note"><dt>Note<dd>To provide a document for use with an earlier version of InDesign, use the InDesign Interchange file format.</dl><p>At the very least, the resources required to support data conversion can help you keep a log of how your persistent data format has changed. Such a log can be useful.<p><b>Sample conversion scenario</b><p>Consider a plug-in with two released versions, 1 and 2, which use the same data format; in this case, both versions of the plug-in have the same format version number, 1. A new release of the plug-in, version 3, stores additional data, such as a time stamp. You must update the format version number to match the current plug-in version number; so, for plug-in version 3, the format version also would be 3. Because you changed the format version number, you must create a converter that converts from version 1 to version 3. The following table shows an example of version changes:<table class="doxtable"><tr><th>Plug-in version </th><th>Format change </th><th>Format version </th></tr><tr><td>1 </td><td>N/A (new plug-in) </td><td>1.0 </td></tr><tr><td>2 </td><td>No </td><td>1.0 </td></tr><tr><td>3 </td><td>Yes </td><td>3 </td></tr><tr><td>4 </td><td>Yes </td><td>4 </td></tr></table><p>For a fourth version of the plug-in, you again change the format, allowing a date stamp to be signed. Change the plug-in and format version numbers to 4, and add an additional converter to convert from version 3 to version 4. Conversions from version 1 to version 4 are done by the conversion manager, which chains the converters together; the first converts from format version 1 to format version 3, and the second converts from format version 3 to format version 4).<h3><a class="anchor" id="id_converting_data_with_the_conversion_manager"></a> Converting data with the conversion manager</h3><p>Each document contains header information about the content, which includes a list of all plug-ins that wrote data to the document and the version number of the plug-in last used to write that data. When a document is opened, the application checks whether any plug-ins are missing or out of date. If a plug-in is missing, it might provide an alert embedded in the document. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_missing_plug_ins">Missing plug-ins</a>.)<p>If a plug-in is out of date, data written by the old plug-in must be updated to match the format required by the loaded plug-in. A plug-in can register a conversion service to do the update. The InDesign conversion manager (<a class="el" href="class_i_conversion_mgr.html">IConversionMgr</a>) determines which conversions are required for opening the document and calls the appropriate plug-in to do the conversion.<p>When the persistent data for any plug-in changes, this is a document format change. Any of the following can change the document format:<ul><li>Changes to the ReadWrite method - If the ReadWrite method is used to stream data to the document, changing the ReadWrite method might change the document format; however, an implementation might have a ReadWrite method that works with some other database or other data source, not with the document itself. For example, a widget has a ReadWrite method used for streaming to and from resources and to and from the SavedData file. Changes to a method that does not work with the document database do not require any special conversion.<li>Changes to an object&#39;s definition- If you add an implementation to (or remove an implementation from) the definition of a persistent boss in the framework resource (.fr) file, you change how the object is streamed. If you add a new implementation, an old version of the object will stream, but it will not contain the data normally appearing for the implementation you added. This is fine if the data can be initialized adequately from the implementation&#39;s constructor; otherwise, you may need to add a converter. If you change the implementation of an interface from one ImplementationID to another, you must convert the data. If you remove an ImplementationID from a class, you should add a converter to strip the old data from the object; otherwise, the obsolete data is carried around with the object indefinitely.<li>Renumbering an ImplementationID or ClassID - If an ImplementationID or ClassID changes, you must register a converter so occurrences of the ImplementationID or ClassID in old documents can be updated. In practice, renumbering a ClassID or ImplementationID is a source of many bugs and typically leads to corrupt documents, so we strongly recommend that you do not renumber an ImplementationID or ClassID.</ul><p>When you make a format change, you must do two things to maintain backward compatibility:<ul><li>Update the version number of the plug-in whose data format you changed.<li>Provide a converter that can convert between the previous format and the new format.</ul><p><b>Updating version numbers</b><p>Each plug-in has a plug-in version resource of type PluginVersion. The PluginVersion resource appears in the boss definition file. The first entry of this resource describes the application&#39;s build number; on the release build, this entry is the final-release version number. The second entry of the resource is the plug-in&#39;s ID, followed by three sets of version numbers, followed by an array of feature-set IDs. If any of the IDs in this list matches the current feature-set ID, the plug-in is loaded. To see an example, open any example .fr file in the SDK.<p>Each version number has a major number and a minor number. The first version number is the version of the plug-in, which gets updated for every release of the plug-in. The second version number is the version of the application with which the plug-in expects to run. This ensures that the user does not drop a plug-in compiled for one version of the application into an installation of another version of the application. The last number is the format version number, which indicates the version of the plug-in that last changed the file format; this is the version number written into the document, and it is the number the conversion manager checks to see whether conversion is required.<p>The format version number does not always match the plug-in&#39;s version number. The format version number does not generally change as often as the plug-in version number. The plug-in version number changes for every release of a plug-in, but the format version number changes only if the format for the data the plug-in stores in the document has changed and the conversion manager is required to convert the data.<p><b>Adding a converter</b><p>Converters can be implemented as conversion services. InDesign supports two types of service-provider-based data conversion:<ul><li>Schema-based provider - Schema-based converters are configured through resources, are easier to use than code-based converters, and cover most format-change needs. Use this type of converter unless it cannot handle the special needs of your plug-in.<li>Code-based provider - If your implementation uses a special data-compression algorithm or other storage optimizations, involves data of variable length, or uses virtual object store (VOS) objects, schema-based converters cannot handle the necessary data format conversions. In this case, you must implement your own custom conversion provider.</ul><p>A conversion service is responsible for all conversions done by the plug-in. A converter might at first handle only a single conversion, from the first format to the second. Later, if you change the format again, you can add another conversion to the converter, to convert from the second format to the third.<p>Suppose you market a plug-in that supplies a date stamp. You had released two versions (version 1.0 and version 2.0) of the plug-in without changing the persistent data created by the plug-in; so both releases have the same format version number (1.0). For the third released version of the plug-in, you add a time stamp. You must update the format version number to match the current plug-in version number; for example, for plug-in version 3.0, the format version also must be 3.0.<p>Suppose for the fourth released version of the plug-in (version 4.0), you again change the format, allowing a date stamp to be signed. You then change the format version number to 4.0 and add an additional converter, capable of converting from format version 3.0 to format version 4.0. Conversions from format version 1.0 to format version 4.0 can be done by the conversion manager, which chains the two converters together, using the first converter to convert from format version 1.0 to format version 3.0, and using the second converter to convert format version 3.0 to format version 4.0.)<p>Adding a converter (either schema-based or code-based) to your plug-in means adding a new boss with two interfaces, <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> and <a class="el" href="class_i_conversion_provider.html">IConversionProvider</a>. The <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> implementation, kConversionServiceImpl, is provided by the application. You need to supply the <a class="el" href="class_i_conversion_provider.html">IConversionProvider</a> implementation. Here is a sample boss:<div class="fragment"><div class="line"><span class="comment">//This boss provides a conversion service to the conversion manager to use the schema-based implementation.</span></div><div class="line">Class{</div><div class="line"> kMyConversionProviderBoss, kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_ICONVERSIONPROVIDER, kMySchemaBasedConversionImpl,</div><div class="line"> IID_IK2SERVICEPROVIDER, kConversionServiceImpl,</div><div class="line"> }</div></div><p>Most of the work is done in the conversion provider supplied with the SDK.<p>The default implementation of <a class="el" href="class_i_conversion_mgr.html">IConversionMgr</a> calls <a class="el" href="class_i_conversion_provider.html#a9ab454fe5711ee7a5f647035a5868475">IConversionProvider::CountConversions</a> and <a class="el" href="class_i_conversion_provider.html#abc9bf33c6a94428767f3c8da4ae001ff">IConversionProvider::GetNthConversion</a> to determine which conversions are supported by the converter. When you implement a new converter, CountConversions returns 1, and GetNthConversion returns fromVersion set to the version number before your change and toVersion set to the version number having your change in it. <a class="el" href="class_version_i_d.html">VersionID</a> is a data type in the Public library; it consists of the PluginID value, the major format version number, and the minor format version number.<p>For a new converter, fromVersion should be VersionID(yourPluginID, kOldPersistMajorVersionNumber, kOldPersistMinorVersionNumber). The toVersion should be the new format version number.<p>Your new conversion is added as conversion index 0. For a new converter, it looks like this:<div class="fragment"><div class="line">int32 TextConversionProvider::CountConversions()<span class="keyword"> const </span>{</div><div class="line"><span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> TextConversionProvider::GetNthConversion(int32 i, <a class="code" href="class_version_i_d.html">VersionID</a>* fromVersion, <a class="code" href="class_version_i_d.html">VersionID</a>* toVersion)<span class="keyword"> const </span>{</div><div class="line"> *fromVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kTextPluginID, kOldPersistMajorVersionNumber, kOldPersistMinorVersionNumber);</div><div class="line"> *toVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kTextPluginID, kNewPersistMajorVersionNumber, kNewPersistMinorVersionNumber);</div><div class="line">}</div></div><p>When adding another change after a changed version already exists, the change numbers should chain together so the conversion manager can do changes across multiple formats. So, if your plug-in used three formats-starting with version 1, then changed in version 3, and changed again in version 4-your plug-in should register one converter that handles the conversion from format version 1 to format version 3 and another converter that handles the conversion from format version 3 to format version 4. If necessary, the conversion manager can chain them together to convert a document from version 1 to version 4. The methods would look like this:<div class="fragment"><div class="line"><span class="keyword">const</span> int32 kFirstFormatVersion = 1;</div><div class="line"><span class="keyword">const</span> int32 kSecondFormatVersion = 3;</div><div class="line"><span class="keyword">const</span> int32 kThirdFormatVersion = 4;</div><div class="line"><span class="keyword">const</span> int32 kFirstChange = 0;</div><div class="line"><span class="keyword">const</span> int32 kNewChange = 1;</div><div class="line"></div><div class="line">int32 TextConversionProvider::CountConversions()<span class="keyword"> const </span>{</div><div class="line"><span class="keywordflow">return</span> 2;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TextConversionProvider::GetNthConversion(int32 i, <a class="code" href="class_version_i_d.html">VersionID</a>* fromVersion, <a class="code" href="class_version_i_d.html">VersionID</a>* toVersion)<span class="keyword"> const </span>{</div><div class="line"><span class="keywordflow">if</span> (i == kFirstChange) {</div><div class="line"> *fromVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kTextPluginID, kMajorVersionNumber, kFirstPersistMinorVersionNumber);</div><div class="line"> *toVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kTextPluginID, kMajorVersionNumber, kSecondPersistMinorVersionNumber);</div><div class="line"> }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == kNewChange) {</div><div class="line"> *fromVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kTextPluginID, kMajorVersionNumber, kSecondPersistMinorVersionNumber);</div><div class="line"> *toVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kTextPluginID, kMajorVersionNumber, kThirdPersistMinorVersionNumber);</div><div class="line"> }</div><div class="line">}</div></div><p>Next, tell the conversion manager which information you changed. The default implementation of <a class="el" href="class_i_conversion_mgr.html">IConversionMgr</a> calls <a class="el" href="class_i_conversion_provider.html#a4ee516cd5bf35e59fd1083d0d77b62c0">IConversionProvider::ShouldConvertImplementation</a> with each implementation in the document supplied by the plug-in. Depending on the data status of the implementation, the plug-in must return kMustConvert when the content must be modified, kMustRemove when the data is obsolete and must be removed, kMustStrip when the content must be stripped, or kNothingToConvert for all other cases.<p>Using kTextFrameImpl as an example, define a method for <a class="el" href="class_i_conversion_provider.html#a4ee516cd5bf35e59fd1083d0d77b62c0">IConversionProvider::ShouldConvertImplementation</a>, returning kMustConvert when the tag is kTextFrameImpl and kNothingToConvert in all other cases. The plug-in should do this when the conversion manager is converting that plug-in&#39;s data and not performing another conversion, so check the conversion index and make sure it is the one that you added. It might look like the following:<div class="fragment"><div class="line"><a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12">IConversionProvider::ConversionStatus</a> TextConversionProvider::ShouldConvertImplementation(<a class="code" href="class_i_d_type.html">ImplementationID</a> tag, <a class="code" href="class_i_d_type.html">ClassID</a> context, int32 conversionIndex)<span class="keyword"> const </span>{</div><div class="line"><a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12">IConversionProvider::ConversionStatus</a> status = <a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a5a6f8b581d3b920823f698cd56f86af6">IConversionProvider::kNothingToConvert</a>;</div><div class="line"><span class="keywordflow">switch</span> (conversionIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> 0:</div><div class="line"><span class="keywordflow">if</span> (tag == kTextFrameImpl)</div><div class="line"> status = <a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a61e7e6af49fbe9dbe85a114d08a23e02">IConversionProvider::kMustConvert</a>;</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">default</span>:</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> status;</div><div class="line">}</div></div><p>Next, implement ConvertTag to do the actual conversion. Suppose the TextFrame ReadWrite method writes an integer value and a real value, and you are adding a boolean. The ConvertTag implementation might look like the following, which illustrates what most converters look like:<div class="fragment"><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> TextConversionProvider::ConvertTag(<a class="code" href="class_i_d_type.html">ImplementationID</a> tag, <a class="code" href="class_i_d_type.html">ClassID</a> forClass, int32 conversionIndex, int32 inLength, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* inStream, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* outStream, IterationStatus whichIteration) {</div><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> outTag = tag;</div><div class="line"><span class="keywordflow">switch</span> (conversionIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> 0:</div><div class="line"><span class="keywordflow">if</span> (tag == kTextFrameImpl)</div><div class="line"> {</div><div class="line"><span class="keywordflow">if</span> (inLength &gt; 0)</div><div class="line"> {</div><div class="line"> int32 passThruInt;</div><div class="line"> inStream-&gt;<a class="code" href="class_i_p_m_stream.html#add11be8a793b60535ccc132378375244">XferInt32</a>(passThruInt);</div><div class="line"> outStream-&gt;<a class="code" href="class_i_p_m_stream.html#add11be8a793b60535ccc132378375244">XferInt32</a>(passThruInt);</div><div class="line"> int32 passThruReal;</div><div class="line"> inStream-&gt;<a class="code" href="class_i_p_m_stream.html#add11be8a793b60535ccc132378375244">XferInt32</a>(passThruReal);</div><div class="line"> outStream-&gt;<a class="code" href="class_i_p_m_stream.html#add11be8a793b60535ccc132378375244">XferInt32</a>(passThruReal);</div><div class="line"><span class="comment">// Adding new field </span></div><div class="line"> bool16 smartQuotes = kTrue;</div><div class="line"> outStream-&gt;<a class="code" href="class_i_p_m_stream.html#add11be8a793b60535ccc132378375244">XferInt32</a>(smartQuotes);</div><div class="line"> }</div><div class="line"> }</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">default</span>:</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> outTag;</div><div class="line">}</div></div><p>If the converter needs to convert a class, it implements ShouldConvertClass and ConvertClass. This is necessary only if the class is being deleted or is a container for some other data. (See &quot;Containers and embedded data&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_converting_data_with_the_conversion_manager">Converting data with the conversion manager</a>).<p><b>Removing classes or implementations</b><p>If you remove a ClassID or an ImplementationID from a version of your plug-in, the identifier also must be removed from documents as they are converted. The conversion manager removes an identifier for you if you implement your converter to return invalid status. For example, to remove a tag, implement ConvertTag as follows: <div class="fragment"><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> TextConversionProvider::ConvertTag( <a class="code" href="class_i_d_type.html">ImplementationID</a> tag, <a class="code" href="class_i_d_type.html">ClassID</a> forClass, int32 conversionIndex, int32 inLength, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* inStream, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* outStream, IterationStatus whichIteration){</div><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> outTag = tag;</div><div class="line"><span class="keywordflow">switch</span> (conversionIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> 0:</div><div class="line"><span class="keywordflow">if</span> (tag == kTagToRemove)</div><div class="line"> outTag = kInvalidImpl;</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">default</span>:</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> outTag;</div><div class="line">}</div></div><p>Deleting a class is similar: implement ConvertClass to return kInvalidClass.<p><b>Changing an implementation in one class</b><p>Suppose a boss is defined with an <a class="el" href="class_i_bool_data.html">IBoolData</a> interface, implemented as kPersistBoolTrue, meaning it defaults to true. Suppose you change this to kPersistBoolFalse. When you read an old document with the new boss, you want it to use the new implementation. You would then write a converter to take the data stored as kPersistBoolTrue and switch it to be stored as kPersistBoolFalse. When you first access the boss, it has the old value. If you do not make a converter, the boss will not read the old data, because there is no interface in the new boss using the kPersistBoolTrue ImplementationID. Instead, the boss looks for kPersistBoolFalse but does not find it, because the old boss did not have it; therefore, the value is false, because it is the default value instead of the old value.<p>To change the ImplementationID of the data in the document, make a conversion method to catch the old ImplementationID and change it to the new one. Do this only for your boss; do not change other bosses using kPersistBoolTrue. Your method might look like this:<div class="fragment"><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> TextConversionProvider::ConvertTag(<a class="code" href="class_i_d_type.html">ImplementationID</a> tag, <a class="code" href="class_i_d_type.html">ClassID</a> forClass, int32 conversionIndex, int32 inLength, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* inStream, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* outStream, IterationStatus whichIteration) {</div><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> outTag = tag;</div><div class="line"><span class="keywordflow">switch</span> (conversionIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> 0:</div><div class="line"><span class="keywordflow">if</span> (tag == kPersistBoolTrue &amp;&amp; forClass == kMyBoss)</div><div class="line"> outTag = kPersistBoolFalse;</div><div class="line"> bool16 theBool;</div><div class="line"> inStream-&gt;<a class="code" href="class_i_p_m_stream.html#a1b90b2dfec3df59333478a77ab2770ad">XferBool</a>(theBool);</div><div class="line"> outStream-&gt;<a class="code" href="class_i_p_m_stream.html#a1b90b2dfec3df59333478a77ab2770ad">XferBool</a>(theBool);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">default</span>:</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> outTag;</div><div class="line">}</div></div><p>forClass is the boss in which the data was found. The conversion should be done only if forClass is the one you want changed.<p>Also implement ShouldConvertImplementation. forClass is either the class in which the data was found or kInvalidClass if any class should match. The implementation of ShouldConvertImplementation looks like this:<div class="fragment"><div class="line"><a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12">IConversionProvider::ConversionStatus</a> TextConversionProvider::ShouldConvertImplementation ( <a class="code" href="class_i_d_type.html">ImplementationID</a> tag, <a class="code" href="class_i_d_type.html">ClassID</a> forClass, int32 conversionIndex)<span class="keyword"> const </span>{</div><div class="line"><a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12">IConversionProvider::ConversionStatus</a> status = <a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a5a6f8b581d3b920823f698cd56f86af6">IConversionProvider::kNothingToConvert</a>;</div><div class="line"><span class="keywordflow">switch</span> (conversionIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> 0:</div><div class="line"><span class="keywordflow">if</span> (tag == kTextFrameImpl &amp;&amp; (forClass == kMyBoss &acirc;&#148;&#130;&acirc;&#148;&#130; forClass == kInvalidClass))</div><div class="line"> status = <a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a61e7e6af49fbe9dbe85a114d08a23e02">IConversionProvider::kMustConvert</a>;</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">default</span>:</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> status;</div><div class="line">}</div></div><p><b>Containers and embedded data</b><p>InDesign does not have many instances of containers. One example is in the text attribute code. A text style is a UID-based boss object containing an implementation, TextAttributeList, that contains a list of attribute bosses (Bold, Point Size, Leading, and so on). These attribute bosses are not UID-based bosses; instead, TextAttributeList streams the ClassID for a boss, followed by the boss&#39;s data, then streams the next boss in the list. TextAttributeList, therefore, must call the stream&#39;s content tracker to notify the content manager that a new class was added to the document.<p>The following example illustrates why this is important.<p>Suppose a new Red-Line plug-in adds an attribute to the style and the text does not compose correctly if the Red-Line plug-in is removed. Red-Line can list the attribute as critical, so the host provides a strongly worded warning when the user tries to open the document without the Red-Line plug-in. However, if TextAttributeList does not register the attribute boss with the content manager, the application never knows the attribute is in the document and cannot warn the user. Suppose the Red-Line plug-in is updated, and the attribute boss in particular is updated to store its data differently. The Red-Line plug-in registers a converter handling the format change. If the host does not know the attribute appears in the document, the Red-Line converter is never called to perform the conversion. The document appears to open correctly, but it crashes on the attribute&#39;s ReadWrite method the first time the style is read.<p>For the Red-Line attribute to be converted, TextAttributeList must register a converter. If the content manager was notified when the attribute was streamed, the conversion manager knows the attribute needs to be converted. It even knows the attribute was streamed by TextAttributeList. But the conversion manager has no way of knowing where the attribute is inside the data streamed by TextAttributeList; therefore, TextAttributeList should register a converter that calls back to the conversion manager to convert each piece of embedded data. Otherwise, the embedded data is not converted.<p><b>Content manager</b><p>The host has a content manager that tracks what data is stored in the document, which plug-in stored it, and the format version number of the plug-in last used to write the data.<p>Think of this as a table attached to the root of the document: every ImplementationID part of the document appears in the table. This table also includes all ClassID values in the document. The following tables are an example.<p>This table shows version information:<table class="doxtable"><tr><th>ImplementationID </th><th>PluginID </th><th>Format version number (only minor number) </th></tr><tr><td>kSpreadImpl </td><td>kSpreadPluginID </td><td>0 </td></tr><tr><td>kSpreadLayerImpl </td><td>kLayerPluginID </td><td>0 </td></tr><tr><td>kTextAttrAlignJustImpl </td><td>kTextAttrPluginID </td><td>1 </td></tr><tr><td>kCMSProfileListImpl </td><td>kColorMgmtPluginID </td><td>3 </td></tr><tr><td>... </td><td>... </td><td>... </td></tr></table><p>This table shows class IDs in the document:<table class="doxtable"><tr><th>ClassID </th><th>Plug-in ID </th><th>Format version number (only minor number) </th></tr><tr><td><a class="el" href="classk_spread_boss.html">kSpreadBoss</a></td><td>kSpreadPluginID </td><td>1 </td></tr><tr><td><a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a></td><td>kLayerPluginID </td><td>1 </td></tr><tr><td>kTextAttrAlignBodyBoss </td><td>kTextAttrPluginID </td><td>3 </td></tr><tr><td><a class="el" href="classk_doc_boss.html">kDocBoss</a></td><td>kDocFrameworkPluginID </td><td>1 </td></tr></table><p>When an object is streamed to a document, the document receives the ClassID of the object and the data streamed by each of the object&#39;s ReadWrite methods. The data written by a ReadWrite method is marked with the ImplementationID of the ReadWrite implementation; this way, when the data is read later, the system knows which C++ class to instantiate to read the data. <a class="el" href="class_i_content_mgr.html">IContentMgr</a> maintains an overall list of the ClassID and ImplementationID values used in the document. When a new ClassID or ImplementationID is added to the document, <a class="el" href="class_i_content_mgr.html">IContentMgr</a> checks which plug-in supplied the ClassID or ImplementationID, notes the plug-in ID and the format version number, and adds the new entry to the table.<p>The plug-in supplying a ClassID is the one supplying the class definition. Only the plug-in supplying the original class definitions is considered; add-in classes do not count. The plug-in supplying an ImplementationID is the one that registered a factory for the ImplementationID.<p>This data is used to detect missing plug-ins and manage document conversion. When the user opens a document containing data supplied by a missing plug-in, the host alerts the user that the document contains data from a missing plug-in. The host detects missing plug-ins by looking in the content manager to see which plug-ins supplied data to the document and checking this list against the list of loaded plug-ins to see whether any are missing.<p>This data also is used for document conversion. When the user opens a document, the default implementation of <a class="el" href="class_i_conversion_mgr.html">IConversionMgr</a> checks the format version number of the plug-ins supplying data to the document and compares it with the format version number of loaded plug-ins. Any mismatch means a conversion is required before the document can be opened. If there is a format version change without a supplied data converter, the document will not open.<p><b>Conversion manager</b><p>When a document is opened, the conversion manager is called to check whether any data in the document requires conversion. If the data requires conversion and a converter is available, the document is converted and opens as an untitled document. If a converter cannot be found, the host displays an alert message that warns the user the document cannot be opened because it cannot be converted.<p>This initial check, implemented in <a class="el" href="class_i_conversion_mgr.html#a7ddd8266b2844fed183d75d65dfaa34a">IConversionMgr::GetStatus</a>, happens very early in the process of trying to open the document, before any objects in the document are accessed (that is, before any of their ReadWrite methods are called). This is critical, because a ReadWrite method will not succeed if the object needs to be converted. The conversion manager accesses the content manager (converting it if necessary), and uses the content manager to find out what plug-ins supplied data to the document. If any plug-ins used in the document have different formats than the formats of the loaded plug-ins, conversion is necessary. Next, the conversion manager sees whether there is a converter to convert from the format in the document to the format associated with the loaded plug-in. If such a converter is available, conversion is possible; the document may be closed and opened again as an untitled document.<p>If the GetStatus method returns with a result indicating conversion is not necessary, the open operation proceeds without calling the conversion manager again. If the GetStatus method returns with a result indicating conversion is necessary but impossible, the open operation is aborted. If the GetStatus method returns with a result indicating conversion is required and a converter is available, the conversion manager&#39;s ConvertDocument method is called to perform the conversion.<p>The first thing ConvertDocument does is compile a list of the classes and implementations in the document that must be converted. A plug-in may have many different implementations that wrote data to the document, but only one of these implementations might require conversion. The conversion manager uses the content manager to iterate over classes and implementations supplied by the plug-in, and the conversion manager calls the converter to find out which classes and implementations require conversion. Each class or implementation in the document that the converter says must be converted is added to the list of classes or list of implementations to be converted. Other data written by the plug-in is ignored by the converter; it is not converted.<p>The next step is to iterate over the UIDs in the document. For each UID, the conversion manager gets the class of the UID. If the class is on the list of classes to be converted, the conversion manager calls a converter for the class. If, as is more common, the class contains an implementation needing to be converted, the conversion manager opens an input stream on the UID and iterates through the implementations in the UID. If any implementation in the UID requires conversion, an output stream is opened on the UID. Any implementation not requiring conversion is copied to the output stream. If an implementation requires conversion, its converter is called. The converter gets passed the input stream and the output stream. The converter reads from the input stream in the old format and writes to the output stream in the new format.<p>After the UID iteration is completed, the content manager is called to update the format numbers for all plug-ins that were outdated, to show their data was converted and is up to date. After this, it is safe for ReadWrite methods to be called on objects in the document.<p>If any converter requires access to another object to do its conversion, it is called in the last phase of conversion. For example, suppose there was one document-wide preference setting for whether text in frames has smart quotes turned on, but you want to make this a per-frame setting. The text frame must store a new flag that indicates whether smart quotes are on or off. The converter adds a new flag in the first phase of conversion, but the converter cannot set the correct value for the flag until the preferences are converted. So, the converter needs to be called once again, after the first phase is complete and it is safe to instantiate the preferences, to get the value of the document-wide smart-quotes setting so the converter can set the frame&#39;s new smart-quotes setting accordingly.<h3><a class="anchor" id="id_converting_data_without_the_conversion_manager"></a> Converting data without the conversion manager</h3><p>To perform format conversion without the conversion manager, the persistent data itself must identify the version of the plug-in that originally wrote the information. To use this method, add a version number to the implementation classes, and implement the ReadWrite method to write the version number first whenever the method writes data, as shown in the following figure. This method has the advantage of forward compatibility.<p>The following figure shows persistent data with version number:<div class="image"><img alt="plugin-programming-guide-vol1-3.gif" src="plugin-programming-guide-vol1-3.gif" /></div><p>For example, suppose the first version of your plug-in stores two-byte values, fOne and fTwo, and uses a byte value to store the data&#39;s version number. The ReadWrite method for this implementation would be something like the following example, which supports multiple versions (version 1 of the plug-in):<div class="fragment"><div class="line">FooStuff::ReadWrite(<a class="code" href="class_i_p_m_stream.html">IPMStream</a>* stream, <a class="code" href="class_i_d_type.html">ImplementationID</a> implementation){</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(0x01);</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(fOne);</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(fTwo);</div><div class="line">}</div></div><p>The second version of this plug-in modifies the data format by adding a 16-bit integer value, fThree. In this version, your ReadWrite method must be able to read data in either format, but it always must write data back in the new format. The following example shows a ReadWrite method supporting multiple versions (version 2 of the plug-in):<div class="fragment"><div class="line">FooStuff::ReadWrite(<a class="code" href="class_i_p_m_stream.html">IPMStream</a>* stream, <a class="code" href="class_i_d_type.html">ImplementationID</a> implementation){</div><div class="line"> uchar version = 0x02; <span class="comment">//Always *write* version 2 data</span></div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(version);</div><div class="line"><span class="keywordflow">if</span> (version == 0x01) {</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(fOne);</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(fTwo);</div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span> {</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(fOne);</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#ab10cd211d3dd9f6e2af870287719a043">XferByte</a>(fTwo);</div><div class="line"> stream-&gt;<a class="code" href="class_i_p_m_stream.html#a50f258bcf722450eb9cc783b873b36fc">XferInt16</a>(fThree);</div><div class="line"> }</div><div class="line">}</div></div><p>This code both reads and writes all data for this implementation. It could check whether the stream is a reading or writing stream and perform only the needed operation, but the dual-purpose code actually is simpler and accomplishes the same thing. If the stream is a ReadStream, the version is initialized as 0x02 but immediately replaced by the contents of the first byte in the stream, and the rest of the stream is processed according to the version number found. If this plug-in encounters data claiming a version number greater than 2, only the data it understands (processed by the else clause) is read. This method allows the version 2 plug-in to work with data from both earlier and later versions. Each new version of the plug-in using this method must preserve the portion of the stream previous versions created and add new information only to the end.<p>When using this approach, the plug-in&#39;s data version number must not change between versions of the plug-in, but only when a data converter is being supplied to convert the data from one version to another.<h2><a class="anchor" id="id_resources"></a> Resources</h2><p>This section explains the fundamental elements and ODFRez resources you need when incorporating a converter in your plug-in.<h3><a class="anchor" id="id_pluginversion_resource_format_numbers_and_their_macros"></a> PluginVersion resource, format numbers, and their macros</h3><p>PluginVersion is a resource included in every InDesign and InCopy plug-in. Part of the resource is the declaration of a persistent data format number, like the following:<div class="fragment"><div class="line">kSDKDefPersistMajorVersionNumber, kSDKDefPersistMinorVersionNumber,</div></div><p>For an example, see the resource definition in &lt;SDK&gt;/source/sdksamples/basicdialog/BscDlg.fr.<p>Each plug-in specifies a different format number. These format numbers are stored in documents, so when a document is opened, the content manager can determine whether data conversion is needed. This determination is made by comparing the format numbers stored in the document for each plug-in with the format numbers declared by loaded plug-ins. If the format numbers are different, the conversion manager is called upon to do a data conversion.<p>Format number values must meet the following criteria:<ul><li>Be greater than or equal to zero.<li>Increase with each format change.<li>Increment if the data format of any persistent class in a plug-in changes.</ul><dl class="section note"><dt>Note<dd>If multiple persistent classes in a plug-in change their data formats at the same time, the data-format version number needs to increment only once. How much you increment data format version numbers is up to you.</dl><p>Format-number values are just numbers; however, you might find it easier to use #define macros for format numbers instead of using their values directly.<p>The following table lists format-number macros and their values from InDesign SDKs. See &lt;SDK&gt;/source/sdksamples/common/SDKDef.h.<table class="doxtable"><tr><th>Version </th><th>Macro: Major </th><th>Macro: Minor </th><th>Tuple </th></tr><tr><td>1.0 </td><td>kSDKDef_10_PersistMajorVersionNumber </td><td>kSDKDef_10_PersistMinorVersionNumber </td><td>{0, 307} </td></tr><tr><td>1.5 </td><td>kSDKDef_15_PersistMajorVersionNumber </td><td>kSDKDef_15_PersistMinorVersionNumber </td><td>{1, 0} </td></tr><tr><td>1.0J </td><td>kSDKDef_1J_PersistMajorVersionNumber </td><td>kSDKDef_1J_PersistMinorVersionNumber </td><td>{2, 1} </td></tr><tr><td>2.0 / 2.0J </td><td>kSDKDef_20_PersistMajorVersionNumber </td><td>kSDKDef_20_PersistMinorVersionNumber </td><td>{4, 1} </td></tr><tr><td>CS / CSJ (3.0 / 3.0J) </td><td>kSDKDef_30_PersistMajorVersionNumber </td><td>kSDKDef_30_PersistMinorVersionNumber </td><td>{5, 1} </td></tr><tr><td>CS2 / CS2J (4.0 / 4.0J) </td><td>kSDKDef_40_PersistMajorVersionNumber </td><td>kSDKDef_40_PersistMinorVersionNumber </td><td>{6, 1} </td></tr><tr><td>CS3 / CS3J (5.0 / 5.0J) </td><td>kSDKDef_50_PersistMajorVersionNumber </td><td>kSDKDef_50_PersistMinorVersionNumber </td><td>{7, 1} </td></tr><tr><td>CS4 / CS4J (6.0 / 6.0J) </td><td>kSDKDef_60_PersistMajorVersionNumber </td><td>kSDKDef_60_PersistMinorVersionNumber </td><td>{8, 1} </td></tr><tr><td>CS5 / CS5J (7.0 / 7.0J) </td><td>kSDKDef_70_PersistMajorVersionNumber </td><td>kSDKDef_70_PersistMinorVersionNumber </td><td>{9, 1} </td></tr><tr><td>CS6 / CS6J (8.0 /8.0J) </td><td>kSDKDef_80_PersistMajorVersionNumber </td><td>kSDKDef_80_PersistMinorVersionNumber </td><td>{10, 1} </td></tr></table><h3><a class="anchor" id="id_setting_up_resources"></a> Setting up resources</h3><p>With the first format change for a plug-in, you must add a converter (either schema-based or code-based) to your plug-in (only one converter per plug-in). See &quot;Adding a converter&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_converting_data_with_the_conversion_manager">Converting data with the conversion manager</a>.<h3><a class="anchor" id="id_schemas"></a> Schemas</h3><p>The schema resource defines which formats of which implementations the converter should handle. The schema resource is defined in your .fr file and compiled using the ODFRC (Open Document Framework Resource Compiler). See the following example and &lt;SDK&gt;/public/includes/Schema.fh.<div class="fragment"><div class="line">resource Schema(uniqueResourceID) {</div><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a>,</div><div class="line"> { schemaFormatMajorNumber, schemaFormatMinorNumber },</div><div class="line"> { <span class="comment">// [0..n] SchemaFields go here (see SchemaFields.fh) }</span></div><div class="line">};</div></div><p><b>Examples</b><p>When you define a schema resource, you explicitly state which format number of which implementation it defines. It knows which plug-in contains the implementation, because it is defined implicitly to be the plug-in that contains the schema resource. In other words, all schemas defined in plug-in A are for implementations provided by plug-in A. The schema-based converter uses the information in this resource (or the SchemaList resource) to determine how to map persistent data from one format to another.<p>In the following example, (1) identifies the schema resource ID. The value does not matter, as long as it is unique among all schema resources compiled into the plug-in. The first item in the schema specifies the implementation ID, and the second item specifies the format number as a tuple {1, 0}. Next comes the schema field list. Curly brackets ( { } ) delimit the list, and commas separate the individual fields. Each field has a type, name, and default value. It is extremely important each field name is unique and these values are not reused when a field is deleted. Field names must be unique among the schemas that describe different formats of the same implementation, because this is what allows data mapping between different format numbers.<dl class="section note"><dt>Note<dd>Although it is not done in the following example, we recommend that you use #define macros for each field name, to enhance readability.</dl><p>The following is a schema resource from &lt;SDK&gt;/sdksamples/snapshot/Snap.fr:<div class="fragment"><div class="line">resource Schema(1)</div><div class="line">{</div><div class="line"> kSnapPrefsDataPersistImpl, <span class="comment">// ImplementationID</span></div><div class="line"> {RezLong(1), RezLong(0)}, <span class="comment">// format number</span></div><div class="line"> {{<a class="code" href="class_p_m_string.html">PMString</a> {0x0001, <span class="stringliteral">&quot;&quot;</span>}}, <span class="comment">// dialog default file name</span></div><div class="line"> {<a class="code" href="class_i_d_type.html">ClassID</a> {0x0002, 0}}, <span class="comment">// format class ID, fFormatClassID</span></div><div class="line"> {Real {0x0003, 1.0}}, <span class="comment">// fScale</span></div><div class="line"> {Real {0x0004, 72.0}}, <span class="comment">// fResolution</span></div><div class="line"> {Real {0x0005, 72.0}}, <span class="comment">// fMinimumResolution</span></div><div class="line"> {Real {0x0006, 0.0}}, <span class="comment">// fBleed</span></div><div class="line"> {Bool16 {0x0007, 0}}, <span class="comment">// fDrawArea</span></div><div class="line"> {Bool16 {0x0008, 0}}, <span class="comment">// fFullResolutionGraphics</span></div><div class="line"> {Bool16 {0x0009, 0}}, <span class="comment">// fDrawGray</span></div><div class="line"> {Bool16 {0x000a, 0}}, <span class="comment">// fAddAlpha</span></div><div class="line"> {Int32 {0x000b, 512}}, <span class="comment">// fDrawingFlags, set default to IShape::kPrinting == 512</span></div><div class="line"> {Bool16 {0x000c, 0}}, <span class="comment">// fIndexedColour</span></div><div class="line"> }</div><div class="line">};</div></div><p>In the following example (based on the preceding Snap.fr example), there is a new schema resource ID (2). Inside the schema, the following changes occurred:<ul><li>The implementation ID has not changed, but the format number is specified as a tuple {1, 1}.<li>schemaFormatMinorNumber changed from 0 to 1.<li>In the schema field list, the fifth field (0x0005, fMinimumResolution) was deleted. During conversion, the fifth field (Real) is stripped from the existing data.<li>The seventh field changed its type. It uses the same name but is now of type Bool8. This requires an implicit conversion. (For a table of valid and invalid type conversions, see <a class="el" href="id_solutions.html#id_versioning_persistent_data">Versioning Persistent Data</a>.<li>A new field (0x000d, fMaximumResolution) was added. On conversion, an element of type Int32 (with a value of 3) is appended to the end of the existing data.</ul><p>This example is a hypothetical schema resource:<div class="fragment"><div class="line">resource Schema(2){</div><div class="line"> kSnapPrefsDataPersistImpl, <span class="comment">// implementation ID {RezLong(1), RezLong(1)}, // format number {</span></div><div class="line"></div><div class="line"> {<a class="code" href="class_p_m_string.html">PMString</a> {0x0001, <span class="stringliteral">&quot;&quot;</span>}}, <span class="comment">// dialog default file name</span></div><div class="line"> {<a class="code" href="class_i_d_type.html">ClassID</a> {0x0002, 0}}, <span class="comment">// format class ID, fFormatClassID</span></div><div class="line"> {Real {0x0003, 1.0}}, <span class="comment">// fScale</span></div><div class="line"> {Real {0x0004, 72.0}}, <span class="comment">// fResolution</span></div><div class="line"> {Real {0x0006, 0.0}}, <span class="comment">// fBleed</span></div><div class="line"> {Bool8 {0x0007, 0}}, <span class="comment">// fDrawArea</span></div><div class="line"> {Bool16 {0x0008, 0}}, <span class="comment">// fFullResolutionGraphics</span></div><div class="line"> {Bool16 {0x0009, 0}}, <span class="comment">// fDrawGray</span></div><div class="line"> {Bool16 {0x000a, 0}}, <span class="comment">// fAddAlpha</span></div><div class="line"> {Int32 {0x000b, 512}}, <span class="comment">// fDrawingFlags, set default IShape::kPrinting == 512</span></div><div class="line"> {Bool16 {0x000c, 0}}, <span class="comment">// fIndexedColour</span></div><div class="line"> {Int32 {0x000d, 3}}, <span class="comment">// minimum resolution enum }};</span></div></div><p><b>Default values</b><p>Default values in a schema are used only when the associated field is added to the data stream by conversion. For example, if an implementation originally contained only one int32 value but now also needs a bool16 value, the first schema lists only the int32 and the second schema lists both the int32 and the bool16. When the conversion runs, the schema converter writes a bool16 into the output stream, using the value specified as the default. Because the int32 already existed, the default value specified by the schema is not used.<p>Suppose you have an implementation with two int32 values. In your constructor, you give them values of 11 and 52. The schema should reflect this. If you later decide 53 is a better default value for the second one, change the schema to match. In this case, however, you do not need a new schema.<h3><a class="anchor" id="id_schemalist"></a> SchemaList</h3><p>The SchemaList resource allows you to specify several schemas in one resource, for convenience. The following example shows the two previous schema resources combined in one SchemaList.<p>Even if initially you have only one Schema inside your SchemaList, it is a good idea to create this resource because, over the course of development, this SchemaList resource acts as a persistent data format log.<p>This example shows a hypothetical SchemaList resource:<div class="fragment"><div class="line">resource SchemaList(uniqueResourceID) {{</div><div class="line"> Schema <span class="comment">// schemaTypeIdentifier {</span></div><div class="line"></div><div class="line"> kSnapPrefsDataPersistImpl,</div><div class="line"> {RezLong(1), RezLong(0)},</div><div class="line"> {</div><div class="line"> {<a class="code" href="class_p_m_string.html">PMString</a> {0x0001, <span class="stringliteral">&quot;&quot;</span>}},</div><div class="line"> {<a class="code" href="class_i_d_type.html">ClassID</a> {0x0002, 0}},</div><div class="line"> {Real {0x0003, 1.0}},</div><div class="line"> {Real {0x0004, 72.0}},</div><div class="line"> {Real {0x0005, 72.0}},</div><div class="line"> {Real {0x0006, 0.0}},</div><div class="line"> {Bool16 {0x0007, 0}},</div><div class="line"> {Bool16 {0x0008, 0}},</div><div class="line"> {Bool16 {0x0009, 0}},</div><div class="line"> {Bool16 {0x000a, 0}},</div><div class="line"> {Int32 {0x000b, 512}},</div><div class="line"> {Bool16 {0x000c, 0}},</div><div class="line"> }</div><div class="line"> };</div><div class="line"></div><div class="line"> Schema <span class="comment">// schemaTypeIdentifier {</span></div><div class="line"></div><div class="line"> kSnapPrefsDataPersistImpl,</div><div class="line"> {RezLong(1), RezLong(1)},</div><div class="line"> {</div><div class="line"> {<a class="code" href="class_p_m_string.html">PMString</a> {0x0001, <span class="stringliteral">&quot;&quot;</span>}},</div><div class="line"> {<a class="code" href="class_i_d_type.html">ClassID</a> {0x0002, 0}},</div><div class="line"> {Real {0x0003, 1.0}},</div><div class="line"> {Real {0x0004, 72.0}},</div><div class="line"> {Real {0x0006, 0.0}},</div><div class="line"> {Bool8 {0x0007, 0}},</div><div class="line"> {Bool16 {0x0008, 0}},</div><div class="line"> {Bool16 {0x0009, 0}},</div><div class="line"> {Bool16 {0x000a, 0}},</div><div class="line"> {Int32 {0x000b, 512}},</div><div class="line"> {Bool16 {0x000c, 0}},</div><div class="line"> {Int32 {0x000d, 3}},</div><div class="line"> }</div><div class="line"> };</div><div class="line">}}</div></div><p>The possible types for schemaTypeIdentifier (see the preceding example) are the following. See Schema.fh for their definitions.<ul><li>ClassSchema - Schema for classes in the current plug-in.<li>OtherClassSchema - Like ClassSchema, but you can specify it for another plug-in by an additional PluginID field.<li>ImplementationSchema - Schema for implementations in the current plug-in.<li>Schema - Another name for ImplementationSchema, because this is the most common type.<li>OtherImplementationSchema - Like ImplementationSchema, but you can specify it for another plug-in by an additional PluginID field.</ul><h3><a class="anchor" id="id_directivelist"></a> DirectiveList</h3><p>To instruct the schema-based converter to add or remove implementations or an entire boss, specify a DirectiveList resource to your resource file, as shown in the following example. (The DirectiveList resource formerly was known as BossDirective.) The DirectiveList resource is defined in your .fr file and compiled using ODFRC. <div class="fragment"><div class="line">resource DirectiveList(uniqueResourceID) {</div><div class="line"> { <span class="comment">// [0..n] Directives go here } };</span></div></div><p>A DirectiveList resource is required each time you do any of the following:<ul><li>Add a new boss or remove an existing one.<li>Add an implementation to a boss or remove one from a boss.<li>Change the ID of a boss or implementation.</ul><p>The DirectiveList resource serves several purposes:<ul><li>Helps the conversion manager delete unnecessary data from a document when a boss or implementation is removed.<li>Keeps the content manager up to date regarding a document&#39;s contents.<li>Allows the conversion manager to do its job correctly, even when a boss or implementation moves to a different plug-in.</ul><p>The following table lists the possible directives.<table class="doxtable"><tr><th>Directive </th><th>Description </th></tr><tr><td>IgnorePlugin </td><td>Marks a plug-in as ignorable. </td></tr><tr><td>MoveClass </td><td>Moves a boss class from one plug-in to another. </td></tr><tr><td>MoveClassToPlugin </td><td>A boss was moved from one plug-in to another. </td></tr><tr><td>MoveImplementation </td><td>Moves an implementation from one plug-in to another. </td></tr><tr><td>MoveImplementationToPlugin </td><td>An implementation was moved from one plug-in to another. </td></tr><tr><td>RemoveAllImplementation </td><td>Removes an implementation from all boss classes. </td></tr><tr><td>RemoveAllOtherImplementation </td><td>Removes an implementation from all boss classes. </td></tr><tr><td>RemoveClass </td><td>Removes a boss class from a plug-in. </td></tr><tr><td>RemoveImplementation </td><td>Removes an implementation from a boss class. </td></tr><tr><td>RemoveOtherClass </td><td>Removes a boss class from another plug-in. </td></tr><tr><td>RemoveOtherImplementation </td><td>Removes an implementation from a boss class. </td></tr><tr><td>RemovePlugin </td><td>Removes an entire plug-in. </td></tr><tr><td>RenumberPlugin </td><td>Renumbers an entire plug-in. </td></tr><tr><td>ReplaceAllImplementation </td><td>Replaces one implementation with another in all plug-ins. </td></tr><tr><td>ReplaceClass </td><td>Replaces one boss class with another. </td></tr><tr><td>ReplaceImplementation </td><td>Replaces one implementation with another in a specific plug-in. </td></tr></table><dl class="section note"><dt>Note<dd>See Schema.fh. Fields vary by type of directive.</dl><h2><a class="anchor" id="id_advanced_schema_topics"></a> Advanced schema topics</h2><h3><a class="anchor" id="id_arrays_of_values"></a> Arrays of values</h3><p>Suppose an implementation contains three Boolean flags followed by four uint32 values. The schema could contain seven separate fields, or it could define two array fields, as in this example:<div class="fragment"><div class="line"><span class="preprocessor">#define kBarOptions 1 </span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define kBarValues 2 </span></div><div class="line"><span class="preprocessor"></span>resource Schema(2) {</div><div class="line"> kBarImpl, </div><div class="line"> {1, 0},</div><div class="line"> {</div><div class="line"> {Bool16Array{kBarOptions, {kTrue, kFalse, kTrue}}}, </div><div class="line"> {Uint32Array{kBarValues, {0, 0, 0, 0}}}</div><div class="line"> } </div><div class="line">};</div></div><p>The number of default values statically determines the number of elements in each array. Note that the set of default values is enclosed in braces.<h3><a class="anchor" id="id_fieldarray"></a> FieldArray</h3><p>If the quantity of array elements is dynamic or an array consists of structures rather than single elements, use a FieldArray, which is a type of field, like Bool16, Uint32Array, or any of the other types in Schema.fh.<p>In the following example, the Bar implementation differs slightly from the previous example. Instead of having three flags followed by four values, it has a value associated with each flag, and the number of (flag, value) pairs is dynamic:<div class="fragment"><div class="line"><span class="preprocessor">#define kBarPairs 1 </span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define kBarOption 2 </span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define kBarValue 3 </span></div><div class="line"><span class="preprocessor"></span>resource Schema(3) {</div><div class="line"> kBarImpl, </div><div class="line"> {1, 0},</div><div class="line"> {</div><div class="line"> {FieldArray{kBarPairs, {Uint16{0}}, {{Bool16{kBarOption, kFalse}}, {Uint32{kBarValue, 0}}}}}</div><div class="line"> } </div><div class="line">};</div></div><p>The syntax looks slightly complicated because of ODFRC limitations, but it is fairly straightforward. The schema contains only one field; its type is FieldArray, and its name is kBarPairs.<p>Following the field&#39;s name is its iteration count. Because this is an attribute of the FieldArray, it has a type but not a name. It also has a default value, which usually is zero. The counter might be a signed or unsigned integer that is 8, 16, or 32 bits wide.<dl class="section note"><dt>Note<dd>The iteration count immediately precedes the iterated values. (If your implementation&#39;s persistent data requires the count be elsewhere, you must write your own conversion provider.)</dl><p>Following the iteration count is the list of iterated fields. Each has a type, name, and default value, like any other field. The default value is not used unless the iteration count has a nonzero default. In the preceding example, the output stream would simply be &quot;0&quot;. If the default iteration count were 2, the output would be &quot;2, kFalse, 0, kFalse, 0&quot;.<p>FieldArrays can be nested up to three levels deep.<h3><a class="anchor" id="id_conditional-field_inclusion"></a> Conditional-field inclusion</h3><p>An important variant of the FieldArray type is the FieldIf type. Use this construct to include a block of fields zero times if a condition is not met or once if the condition is met. The conditional value can be of type Bool8, Bool16, ClassID, or ImplementationID. If the conditional value is of type ClassID or ImplementationID, the fields are included if the ID is valid.<p>The following is a slight variant of the preceding example:<div class="fragment"><div class="line">resource Schema(4) {</div><div class="line"> kBarImpl, </div><div class="line"> {1, 0}, </div><div class="line"> {</div><div class="line"> {FieldIf{kBarPairs, {Bool16{kFalse}}, {{Bool16{kBarOption, kFalse}}, {Uint32{kBarValue, 0}}}}}</div><div class="line"> } </div><div class="line">};</div></div><p>In this case, kBarOption and kBarValue are included zero or one times, depending on the Bool16 value.<p>FieldIf constructs can be nested up to three levels deep.<h1><a class="anchor" id="id_commands"></a> Commands</h1><p>This chapter describes InDesign&#39;s command architecture. It also outlines how to find and use the commands provided by the InDesign API, how to implement new commands of your own, and other extension patterns associated with commands.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>This section introduces the generic command pattern, databases that provide persistence to the application&#39;s objects, and models that represent the application&#39;s objects in memory.<h3><a class="anchor" id="id_command_pattern"></a> Command pattern</h3><p>The intent of the command pattern is as follows: &quot;Encapsulate a request as an object, thereby letting you parameterize clients with different requests, queue or log requests and support undoable operations.&quot; (This is described in Gamma, Helm, Johnson, and Vlissides, Design Patterns, Addison-Wesley, 1995.) The structure of this pattern is shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-4.gif" src="plugin-programming-guide-vol1-4.gif" /></div><p>This pattern decouples the object that invokes an operation from the object that implements it. The client wants an operation to be performed, the receiver knows how to perform the operation, and the two are decoupled by this pattern. The command declares an interface for executing an operation. The client does not send messages directly to the receiver; rather, the client creates a concrete command object and sets its receiver. The concrete command implements execute by calling the corresponding operation on the receiver. The invoker asks the command to carry out the request, which causes the receiver to perform the operation.<p>Within the InDesign API, an implementation of the command pattern is used in situations where preventing data corruption is paramount and users must be able to undo or redo changes.<h3><a class="anchor" id="id_databases_and_undoability"></a> Databases and undoability</h3><p>A persistent object has its state maintained outside the application runtime. It can be removed from main memory and returned again, unchanged. The application maintains persistent objects in a database. A database on disk is an opaque binary file in the operating system&#39;s file system. This database file stores the serialized state of a collection of objects. The set of objects stored in a particular database is collectively known as a model. For example, an InDesign document file like Untitled-1.indd is a database file that represents the state of an instance of a document model.<p>Objects are stored in a database in the following format:<ul><li>Objects that persist are stored as a tree of objects, each of which is associated with and persisted by a database.<li>Each persistent object has a identifier, the UID, that identifies it uniquely within its database.<li>Each persistent object (except the root object) is owned and referred to by another object, the parent. A persistent object also can be referenced by other objects, though this does not indicate any form of ownership.</ul><p>The class that represents a database is <a class="el" href="class_i_data_base.html">IDataBase</a>.<p>For more detail, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_data_and_data_conversion">Persistent Data and Data Conversion</a>.<p>Databases must be consistent and stable. Some databases also need to support undoability-the ability for a user to undo or redo changes. For example, the ability to undo changes made to a document is required; however, there is no requirement to undo changes made to the database that persists the user interface state.<p>The table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_managers_databases_and_undo_support">Command managers, databases, and undo support</a> shows the databases that exist and their support for undoability. If a database supports undoability, that support cannot be turned off. All changes to objects that persist in the database must be undo-able. Turning off undo support is not allowed, because it would disable error handling and increase the risk of document corruption.<dl class="section note"><dt>Note<dd>To change objects that persist in a database that supports undo, we recommend using commands. If, however, you need to change data without showing something in the Edit &gt; Undo menu, you can bypass commands and wrap your changes in calls to <a class="el" href="class_cmd_utils.html#aeaabfa56926baea24cd080b26d6f0d79">CmdUtils::BeginAutoUndoSequence</a> and <a class="el" href="class_cmd_utils.html#a34690388468a68a577673bf98cb471b8">CmdUtils::EndAutoUndoSequence</a>.</dl><h3><a class="anchor" id="id_models"></a> Models</h3><p>A model is a collection of objects backed by a database for persistent storage. A model is a tree-structured graph of objects. The ownership relationships between objects in a model defines this tree structure. Ownership relationships are just parent-child relationships within the tree.<p><b>Document model</b><p>Documents are represented by the document model. The following figure shows an example of objects in a document model (instance diagram):<div class="image"><img alt="plugin-programming-guide-vol1-5.gif" src="plugin-programming-guide-vol1-5.gif" /></div><p>The document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) is the root object in the document model. It owns a collection of spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), stories (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), a workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), and so on. These objects may own further objects specific to their domain. The document&#39;s workspace owns objects like styles and swatches, which can be used throughout the document.<p>The database file that provides persistence for a document model is an end-user document file; for example, a file Untitled-1.indd saved from InDesign.<p><b>Defaults model</b><p>Global preference settings are represented by the defaults model. The following figure shows an example of objects in the defaults model (instance diagram):<div class="image"><img alt="plugin-programming-guide-vol1-6.gif" src="plugin-programming-guide-vol1-6.gif" /></div><p>The workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) is the root object in a defaults model. It owns the objects that represent default preference settings like styles, swatches and so on. The defaults model is global and is accessed from the session (<a class="el" href="classk_session_boss.html">kSessionBoss</a>) via the <a class="el" href="class_i_session.html">ISession</a> interface. When a new document is created, preference settings can be copied from the defaults model into the document&#39;s workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).<p>The database file that provides persistence for this model is an application defaults file. For example, the file named InDesign Defaults is the database file used by InDesign to persist the defaults model.<p><b>Session model</b><p>A session of an application is represented by the session model. shows an example of objects in the session model (instance diagram):<div class="image"><img alt="plugin-programming-guide-vol1-7.gif" src="plugin-programming-guide-vol1-7.gif" /></div><p>The session (<a class="el" href="classk_session_boss.html">kSessionBoss</a>) is the root object in the session model. This model owns application-related objects that must persist from session to session. For instance, user interface objects are found here, together with other objects that store the application &#39;s type system (the boss classes provided by all registered plug-ins).<p>The database file that persists objects in this model is the application&#39;s saved data file. For example, the file named InDesign SavedData is the database file used by InDesign to persist the session model.<dl class="section note"><dt>Note<dd>Objects in the session model can be modified by calling mutator methods on their interfaces directly. There is no need to modify them using commands. The database that persists this model does not support undo.</dl><p><b>Books, asset libraries, and other models</b><p>Several other features in an application have their own dedicated model, together with a database that provides that model with persistence. Prominent examples are books, asset libraries, and the scrap. See the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_managers_databases_and_undo_support">Command managers, databases, and undo support</a> for the level of undo support provided by their databases.<h2><a class="anchor" id="id_commands"></a> Commands</h2><p>This section describes how commands are used in the application. It includes sections on the <a class="el" href="class_cmd_utils.html">CmdUtils</a> class, which is fundamental to the processing of commands, and how to use command sequences to group multiple commands into one logical unit.<p>Within the application, the most prevalent use of commands by client code is to modify persistent objects in the document model or defaults model. For example, plug-ins use commands to create frames in a document or modify the default text style.<p>Commands encapsulate the changes made to persistent objects into a database transaction. Encapsulating changes in this way helps prevent corruption. Furthermore, any change to the state of persistent objects that needs to support undo must be made using a command.<p>Commands change persistent objects by doing the following:<ul><li>Calling mutator methods on interfaces that exist on persistent objects.<li>Processing other commands (that call mutator methods on interfaces that exist on persistent objects).<li>Calling utilities that process commands (that call mutator methods on interfaces that exist on persistent objects).<li>A mixture of the above.</ul><p>A command is processed by the application; this means an instance of the command is passed to the application to be executed. A command can change persistent data within only one database each time it is processed. The processing of a command moves the database from one consistent state to another.<p>When a command is used to modify objects that persist in a database that supports undo, that command can manifest on the Undo and Redo menu items, and the database automatically reverts the state of affected objects on undo and restore the changed state on redo.<p>The InDesign API provides commands for plug-ins to use. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_processing_and_the_cmdutils_class">Command processing and the CmdUtils class</a> and &quot;Key client APIs&quot;.<p>Plug-ins also can introduce new commands using the command extension pattern. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_command">Command</a>. This is required when a plug-in adds custom persistent data to a document, defaults, or other objects that persist in a database that supports undo. The extension patterns named persistent interface and persistent boss are ways in which custom persistent data can be added to a database. See &quot;Persistent interface&quot; on page 63 and &quot;Persistent boss&quot;.<h3><a class="anchor" id="id_command_parameters"></a> Command parameters</h3><p>Commands implement the protocol used to modify objects that persist in a database that supports undo. A client initiates this protocol by instantiating a command and passing it off to the application for processing. The client also is responsible for initializing the state of the command, including the setting of parameters. In general, the command pattern supports two mechanisms for parameter passing:<ul><li>The <a class="el" href="class_u_i_d_list.html">UIDList</a> in the <a class="el" href="class_i_command.html">ICommand</a> interface (the &quot;item list&quot;), which identifies a set of persistent objects; see <a class="el" href="class_i_command.html#a6f9f6afa9a67a910288ae792b8bcfe41">ICommand::SetItemList</a>. On input, this might identify the set of page items on which the command operates. For example, a page item move command (<a class="el" href="classk_move_absolute_cmd_boss.html">kMoveAbsoluteCmdBoss</a>) would use this to identify the set of items to be moved. On output, the item list might identify the set of object manipulated by a command. For example, a page item create command (<a class="el" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a>) would provide the UIDs of the objects created as a result of the command being processed. The use of the command&#39;s item list is specific to each command; a command is not required to use the item list.<li>Data-carrying interfaces on the command&#39;s boss class. For example, the command used to apply a particular text style aggregates an <a class="el" href="class_i_bool_data.html">IBoolData</a> interface to define whether character styles should be overridden, and an <a class="el" href="class_i_range_data.html">IRangeData</a> interface to indicate the range of text that should be updated by the command.</ul><p>These two approaches for passing parameters are shown in the following figure. There is a command boss class showing two aggregated interfaces, <a class="el" href="class_i_command.html">ICommand</a> and a data-carrying interface (ISomeData). Parameters can be passed through the item list in <a class="el" href="class_i_command.html">ICommand</a>, the data-carrying interface, or both.<div class="image"><img alt="plugin-programming-guide-vol1-8.gif" src="plugin-programming-guide-vol1-8.gif" /></div><h3><a class="anchor" id="id_command_undoability"></a> Command undoability</h3><p>Each command has a property called undoability (see <a class="el" href="class_i_command.html#a9b7f77ae8c7947d4dcf20b808a2c9f37">ICommand::Undoability</a>), which determines whether the command name can appear in Undo and Redo menu items (that is, whether the changes made by the command can be undone or redone in a distinct step).<ul><li>An undoability of kRegularUndo is used by commands whose changes need to appear as a separate named step in Undo and Redo menu items. This is the default behavior.<li>An undoability of kAutoUndo is used by commands whose changes do not appear as a separate named step; for example, commands whose changes should be undone or redone with an existing step.</ul><p>Changes made to objects that persist in a database that supports undo must be undoable. To achieve this, the various extension patterns involved, such as commands and persistent interfaces, must be implemented following the rules described in this chapter. The database then automatically reverts the state of affected objects on undo and restores the changed state on redo. The undoability of a command (kRegularUndo / kAutoUndo) has no effect on this behavior. It affects only whether the command appears as a distinct step in Undo and Redo menu items.<h3><a class="anchor" id="id_command_processing_and_the_cmdutils_class"></a> Command processing and the CmdUtils class</h3><p>Client code uses commands when changing objects that persist state in any database that supports undo. For example, commands are used to change objects in the document model or the defaults model. The level of support for undo of each database is given in the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_managers_databases_and_undo_support">Command managers, databases, and undo support</a>.<p>To change the objects, client code creates instances of one or more commands and submits these instances to the application for execution. For example, to create frames in a document, a plug-in either creates commands to be processed and passes them to the application or calls a helper class that encapsulates both the creation and request for processing. The helper classes provided by the InDesign API are introduced in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_command_facades_and_utilities">Command facades and utilities</a>.<p>Client code that must create commands uses the <a class="el" href="class_cmd_utils.html">CmdUtils</a> class. <a class="el" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a> creates an instance of a specific command. The client code parameterizes the command, using the command&#39;s item list and data interfaces. The client code submits the command to the application for execution, by calling <a class="el" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>. Client code can group the commands it processes into command sequences, using methods and classes provided by <a class="el" href="class_cmd_utils.html">CmdUtils</a>. Guidance on processing commands and command sequences is in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_processing_apis">Command-processing APIs</a> and <a class="el" href="id_solutions.html#id_commands">Commands</a>.<p>The sequence of calls involved in processing a command is shown in the following figure. The client code creates the command, populates the item list and other data interfaces, then passes the command off for processing.<div class="image"><img alt="plugin-programming-guide-vol1-9.gif" src="plugin-programming-guide-vol1-9.gif" /></div><h3><a class="anchor" id="id_command_sequences"></a> Command sequences</h3><p>A command sequence (see <a class="el" href="class_i_command_sequence.html">ICommandSequence</a>) groups a set of commands into a single undoable step that changes the model from one consistent state into another. The command sequence manifests on the Undo and Redo menu items as a single item.<p><a class="el" href="class_command.html">Command</a> sequences can be nested. For example, say you begin a sequence in one method, then call a second method that begins a second sequence. The second sequence is said to be nested within the first. When sequences are nested, only one sequence-the outermost one-appears on Undo and Redo menu items.<p><a class="el" href="class_command.html">Command</a> sequences assimilate all commands are processed within their scope, whether the command is processed directly from within the sequence or indirectly through subcommands (commands processed by a command). See <a class="el" href="id_solutions.html#id_commands">Commands</a> for how to write code that uses command sequences.<p>A typical scenario for a command sequence is shown in the following figure. Between the BeginCommandSequence and EndCommandSequence calls, all commands processed act as a single set of changes; only one element will appear on Undo and Redo menu items.<div class="image"><img alt="plugin-programming-guide-vol1-10.gif" src="plugin-programming-guide-vol1-10.gif" /></div><p>A command sequence can change persistent objects in more that one database. (A command, on the other hand, can change objects only in one database each time it is processed.) Operations that change objects in two or more documents can be implemented using a command sequence. Such a set of modifications manifests in Undo and Redo menu items for all affected documents.<p>A command sequence has limited support for error handling: the sequence either succeeds entirely or fails. An abortable command sequence (see <a class="el" href="class_i_abortable_cmd_seq.html">IAbortableCmdSeq</a>) allows more sophisticated error handling, to allow for fail/retry semantics. Abortable command sequences incur a significant performance overhead and should be used only where absolutely necessary. Guidance on using these types of sequence is in <a class="el" href="id_solutions.html#id_commands">Commands</a>.<h2><a class="anchor" id="id_command_managers_databases_and_undo_support"></a> Command managers, databases, and undo support</h2><p>This section describes how command managers relate to the application&#39;s databases.<p>The application object model realizes a tree-structured graph of boss objects. Within this tree are several distinct models, notably the session model, the defaults model, and one or more document models (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_models">Models</a>). Each model has a distinct database that provides persistence for its objects (see &quot;Databases and undoability&quot;). Each database has an associated boss, called a command manager. When commands are used to change objects in a model, the command manager is responsible for executing the commands.<p>The following figure shows that the application object model has several distinct databases that provide persistence for its objects. The diagram shows some of the objects in an InDesign session (with two open documents) and the databases with which these objects are associated. Each UID-based object refers to its associated database through its <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> interface. The defaults model, represented by an instance of <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, persists in the InDesign Defaults database file. Each document model, represented by an instance of <a class="el" href="classk_doc_boss.html">kDocBoss</a>, persists in an InDesign document database file. The session model, represented by the instance of <a class="el" href="classk_session_boss.html">kSessionBoss</a> and the child objects that do not belong to any other model, persists in the InDesign SavedData database file.<p>Each database has an associated command manager (see objects in the following figure that have an <a class="el" href="class_i_command_mgr.html">ICommandMgr</a> interface). The command manager is responsible for managing database transactions and executing the commands that change the objects that persist in the database. If an object has an <a class="el" href="class_i_command_mgr.html">ICommandMgr</a> interface, it is the root object of its associated database. This is shown in the figure. Key objects that are command managers are listed in the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_managers_databases_and_undo_support">Command managers, databases, and undo support</a>; for the complete list, refer to <a class="el" href="class_i_command_mgr.html">ICommandMgr</a> in the API Reference.<dl class="section note"><dt>Note<dd>The class that represents a database is <a class="el" href="class_i_data_base.html">IDataBase</a>. This class is an abstract C++ class, but it is not an <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> interface.</dl><p>The following figure shows models and databases in an indesign session (object diagram):<div class="image"><img alt="plugin-programming-guide-vol1-11.gif" src="plugin-programming-guide-vol1-11.gif" /></div><p>The following table shows frequently used databases and their support for undoability:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a> manager / root boss class </th><th>Database </th><th>Undo support </th><th>Example filename and use </th></tr><tr><td><a class="el" href="classk_session_boss.html">kSessionBoss</a></td><td>Application SavedData </td><td>None </td><td>InDesign SavedData User interface objects like tools, menus, panels, dialogs, controls, and string translations. Objects that define the application object model, like plug-ins and boss classes. </td></tr><tr><td><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a></td><td>Application Defaults </td><td>Full </td><td>InDesign Defaults Default resources like swatches, fonts, and styles inherited by new documents. </td></tr><tr><td><a class="el" href="classk_doc_boss.html">kDocBoss</a></td><td>InDesign Document </td><td>Full </td><td>Your.indd Document content like spreads, pages, page items, and text. </td></tr><tr><td><a class="el" href="classk_book_boss.html">kBookBoss</a></td><td>InDesign Book </td><td>Partial </td><td>Your.indb A collection of InDesign documents and associated resources. </td></tr><tr><td>kCatalogBoss </td><td>InDesign Asset Library </td><td>Partial </td><td>Your.indl A collection of page items. </td></tr><tr><td>Clipboard/scrap </td><td>Application ClipboardScrap </td><td>Partial </td><td>. </td></tr></table><p>Each database has a level of support for undo which is fixed when the database is created and can be one of the following:<ul><li>Full - The database fully supports undoable operations. The changes made by a transaction can be reversed automatically on undo and restored on redo. Undo and rRdo menu items are fully supported.<li>Partial - The database can undo only the most recent operation. If an error occurs, the database is rolled back to its state before the transaction began; however, once a transaction is committed, it is irreversible. There is no support for Undo and Redo menu items.<li>None - The database does not support undoable operations. There is no support for error handling, abortable command sequences, or Undo and Redo menu items.</ul><dl class="section note"><dt>Note<dd>Undo support varies by product. In InDesign and InCopy, full undo support is provided for documents and defaults. In InDesign Server, only partial undo support is provided for these databases; the server has no concept of user undo and redo.</dl><p>Objects that persist in a database with full or partial support for undo must be modified using commands. For example, a plug-in must process commands to change document content such as spreads, pages, or page items.<p>Objects that persist in a database without support for undo can be modified by calling mutator methods on persistent interfaces directly. Commands are not required. For example, a plug-in can call interfaces on user interface objects, such as widgets, that set state directly.<h2><a class="anchor" id="id_the_command_processor"></a> The command processor</h2><p>This section describes how a command is passed through the application until it is processed.<p>The session (see the <a class="el" href="class_i_session.html">ISession</a> interface) has a singleton instance of the command processor (see <a class="el" href="classk_command_processor_boss.html">kCommandProcessorBoss</a> and the <a class="el" href="class_i_command_processor.html">ICommandProcessor</a> interface). The command processor is the core application component to which all commands are submitted via <a class="el" href="class_cmd_utils.html">CmdUtils</a>.<p>The command processor&#39;s structure is shown in the following figure. A command targets one or more objects for change, and these objects persist in a particular database. Normally, client code creates a command instance and sets this target by passing parameters to the command (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_parameters">Command parameters</a>). The client code submits the command instance for processing using <a class="el" href="class_cmd_utils.html">CmdUtils</a>. The following figure shows the internal collaboration between the objects involved.<div class="image"><img alt="plugin-programming-guide-vol1-12.gif" src="plugin-programming-guide-vol1-12.gif" /></div><p>The command processor examines the command and determines which database contains the objects the command changes. Each database has an associated command manager boss (see <a class="el" href="class_i_command_mgr.html">ICommandMgr</a> interface), shown in the preceding figure as the boss class named kSomeModelRootBoss. For example, the root of the document model is <a class="el" href="classk_doc_boss.html">kDocBoss</a>, and <a class="el" href="classk_doc_boss.html">kDocBoss</a> is a command manager. The command processor calls the associated command manager to execute the command.<p>The following figure shows the internal processing of a command. The call to process a command is passed to the session-wide command processor. This determines which database is targeted by the command, and the command is passed to the command manager for the specified database. The command manager processes the command, and the command updates an interface on a persistent (UID based) boss object. On completion, control returns to the client that initiated the process.<div class="image"><img alt="plugin-programming-guide-vol1-13.gif" src="plugin-programming-guide-vol1-13.gif" /></div><dl class="section note"><dt>Note<dd>Third party plug-ins should not interact directly with the command processor or command manager interfaces. <a class="el" href="class_cmd_utils.html">CmdUtils</a> provides all methods needed by third parties for processing commands.</dl><h2><a class="anchor" id="id_scheduled_commands"></a> Scheduled commands</h2><p>Commands can be scheduled for later processing, using <a class="el" href="class_cmd_utils.html#a4b3f5c21f9801b6b620d92bcb6320c91">CmdUtils::ScheduleCommand</a>. The command is placed in a queue and processed when the application is idle as part of the main event loop, before idle tasks are processed. The sequence of calls involved in processing a scheduled command is shown in the following figure. Compare this with the more normal case of immediately processing a command, shown in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_the_command_processor">The command processor</a>. In the following figure, the scheduled command is passed to the command processor (through the <a class="el" href="class_cmd_utils.html#a4b3f5c21f9801b6b620d92bcb6320c91">CmdUtils::ScheduleCommand</a> call). At some later time, after all other processing is complete and control is returned to the main application event loop, all scheduled commands are processed.<p>Guidance on using scheduled commands is in <a class="el" href="id_solutions.html#id_commands">Commands</a>.<div class="image"><img alt="plugin-programming-guide-vol1-14.gif" src="plugin-programming-guide-vol1-14.gif" /></div><h2><a class="anchor" id="id_snapshots_and_interface_implementation_types"></a> Snapshots and interface implementation types</h2><p>A snapshot is a copy of the state of an interface at a particular time. Undo and redo are achieved automatically by the application, which keeps snapshots of the interfaces changed within an undoable transaction. The snapshots are kept in the command history (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_history">Command history</a>) of the database with which the interface is associated.<p>The way in which an <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> interface is implemented determines whether its data is persistent and/or needs a snapshot to support undo or redo:<ul><li>Regular interfaces store transient data that is not maintained on undo or redo. They are declared to the object model using CREATE_PMINTERFACE, and their state is lost if they are removed from memory. Data in a regular interface is not persistent, and no snapshot is taken.<li>Persistent interfaces are declared to the object model using the CREATE_PERSIST_PMINTERFACE macro. They serialize their state to their associated database via the ReadWrite method and can be removed from memory and returned again unchanged. Persistent interfaces that are part of a database that supports undo also are called to serialize their state (again via their ReadWrite method) to a snapshot. This mechanism is required to support undo and redo. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_interface">Persistent interface</a>.<li>Snapshot interfaces store transient data that must be maintained on undo and redo. They are declared to the object model using the CREATE_SNAPSHOT_PMINTERFACE macro, and they serialize their state in a snapshot via the SnapshotReadWrite method. Snapshot interfaces are aggregated on a boss that persists in a database that supports undo; however, their data is not persistent. Data maintained by a snapshot interface is lost whenever the associated database is closed or when the command history for the database is cleared. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_snapshot_interface">Snapshot interface</a>.<li>Snapshot view interfaces are similar to snapshot interfaces, which also store transient data that must be maintained on undo and redo. The distinction is that a snapshot view interface depends on model objects that persist in another database. A snapshot view interface is part of a user interface object and must explicitly identify the database containing the model of interest. Also, the database on which a snapshot view interface depends can change. For example, a widget that tracks some state in the front document must change the database on which its snapshot view interface depends when the front document changes. Snapshot view interfaces are declared to the object model using the CREATE_VIEW_PMINTERFACE macro. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_snapshot_view_interface">Snapshot view interface</a>.<li>It also is possible to create a hybrid interface to allow the data that persists in the database to differ from the data of which a snapshot is taken for undo and redo. This can be used by complex data structures, like collections that need to optimize performance. Such an interface is declared to the object model using the CREATE_PERSIST_SNAPSHOT_PMINTERFACE macro. Data is serialized to the database via the ReadWrite method and to the snapshot via the SnapshotReadWrite method. For example, consider this approach if you have a collection of some sort and want to serialize only those objects that changed relative to the snapshot (rather than the entire collection).</ul><h2><a class="anchor" id="id_command_history"></a> Command history</h2><p>Consider a database to be the state of the persistent object model. For example, a document database is the state of the document object model (<a class="el" href="classk_doc_boss.html">kDocBoss</a> and all its dependents) at a particular time. Persistent interfaces (on dependent objects) are called to serialize their state to the database when necessary, via their ReadWrite method.<p>The command history (<a class="el" href="class_i_cmd_history.html">ICmdHistory</a>) provides a history of the undoable operations that were performed on each database. It records the state changes made by a particular command or command sequence, for the purposes of undo and redo. The name of the first command or command sequence processed to perform an operation on the model appears as a named step in the command history. These steps manifest as Undo and Redo menu items. The command history is used to automatically revert the state of affected objects on undo and to restore the changed state on redo.<p>The database and its command history are related but distinct states.<p>To maintain the command history, the database monitors which of its objects change when commands are processed. It tracks the UIDs that are deleted, created, or undeleted. It tracks persistent interfaces, snapshot interfaces and snapshot view interfaces that are modified, and it takes snapshots of them. This information is kept in the command history as a set of CmdStackItem objects. (CmdStackItem is opaque on the SDK; third parties cannot access its data.) When undo is invoked, the application automatically reverts the database state to its previous revision, using this information. When redo is invoked, the application automatically restores the database state to its next revision.<p>See the following figure. The command processor (<a class="el" href="classk_command_processor_boss.html">kCommandProcessorBoss</a>) aggregates the command history (interface <a class="el" href="class_i_cmd_history.html">ICmdHistory</a>), which is responsible for maintaining the state changes made by a particular command or command sequence (which manifests on the Undo and Redo menu). This state, represented as CmdStackItems, is used to move the model to previous and next states on undo and redo. The CmdStackItem encapsulates all data required for an undo and redo that occurred while processing a command or command sequence.<div class="image"><img alt="plugin-programming-guide-vol1-15.gif" src="plugin-programming-guide-vol1-15.gif" /></div><h3><a class="anchor" id="id_merging_changes_with_an_existing_step_in_the_command_history"></a> Merging changes with an existing step in the command history</h3><p>Sometimes it is desirable to extend the scope of an existing step shown in the Undo and Redo menus to include functionality that occurs after the step finished. This can be done using either of the following:<ul><li>A command with undoability of kAutoUndo.<li>A command sequence with undoability of kAutoUndo.</ul><h2><a class="anchor" id="id_undo_and_redo"></a> Undo and redo</h2><p>To enable a user to undo or redo a change, the objects changed must:<ul><li><a class="el" href="namespace_persist.html">Persist</a> in a database that supports undo (see the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_managers_databases_and_undo_support">Command managers, databases, and undo support</a>).<li>Be modified by processing commands.</ul><p>The application maintains the state required for undo/redo of changes made to persistent objects, as commands are processed. Each database that supports undo has a command history in which the necessary information is recorded, as described in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_history">Command history</a>. Each persistent interface on a UID-based boss object has its ReadWrite method called to add the state to the command history (for undo and redo) and to the database (to persist its state). On undo, the ReadWrite method is called to reset the state back to that from before the action, and on Redo, the ReadWrite method is called again to set the state back to that from the initial action. The sequence of calls to a persistent interface is shown in the architecture figure in &quot;Persistent interface&quot; on page 63. Snapshot interfaces are called on their SnapshotReadWrite method using a similar approach; see the architecture figure in &quot;Snapshot interface&quot;.<p>The command processor records in the command history the set of undoable operations it has performed (see the <a class="el" href="class_i_cmd_history.html">ICmdHistory</a> interface on <a class="el" href="classk_command_processor_boss.html">kCommandProcessorBoss</a>). The steps in the command history appear in Undo and Redo menu items and are modelled internally using CmdStackItems. (These are internal only. Discussion is provided here to give some notion of how the command processor works.) This is shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-16.gif" src="plugin-programming-guide-vol1-16.gif" /></div><p>The command history maintains a stack of CmdStackItem objects for each database that supports undo; see the preceding figure. A CmdStackItem (opaque in the SDK) represents the set of changes made by the sequence or command that manifests on the Undo and Redo menus. It contains data gathered during a database transaction for the purposes of undo and redo. On undo/redo, the &quot;current&quot; CmdStackItem is used to revert the state of the model. The CmdStackItem encapsulates all data required for an undo/redo that occurred while processing a command or command sequence. This includes all changes to persistent interface and snapshot interface data that were predirtied. The CmdStackItem also maintains any inval handler cookies (see &quot;Inval handler&quot;) created as part of the sequence.<p>Each step has a name of either a command or a command sequence that performed the operation. On undo, the application automatically reverts the database to its state before the operation was performed. On redo, the application automatically restores the database to its state after the operation was performed.<h3><a class="anchor" id="id_extension_patterns_involved_in_undo_and_redo"></a> Extension patterns involved in undo and redo</h3><p>The following extension patterns are called at undo or redo:<ul><li>Persistent interfaces; see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_interface">Persistent interface</a>.<li>Snapshot interfaces; see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_snapshot_interface">Snapshot interface</a>.<li>Snapshot view interfaces; see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_snapshot_view_interface">Snapshot view interface</a>.<li>Inval cookies; see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_inval_handler">Inval handler</a>.<li>Observers, via their LazyUpdate method; see <a class="el" href="id_solutions.html#id_notification">Notification</a>.</ul><h2><a class="anchor" id="id_notification_within_commands"></a> Notification within commands</h2><p>A command can initiate notification, so observers interested in changes to the objects it modifies are notified. See <a class="el" href="id_solutions.html#id_notification">Notification</a>.<p>Commands also can be processed within observers and responders. Take care with commands that modify the model in this way. See <a class="el" href="id_solutions.html#id_notification">Notification</a> for further discussion of model changes within the context of notification.<p>If you are implementing your own command, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_command">Command</a> for additional information on notification in the command extension pattern.<h2><a class="anchor" id="id_error_handling"></a> Error handling</h2><p>In response to a user gesture or another event, the application calls a plug-in to carry out an action. For example, the user creates a text frame. In this case, the plug-in creates and processes the commands that perform the action. On detecting an error, a plug-in normally sets the global error code (see <a class="el" href="class_error_utils.html">ErrorUtils</a>) to something other than kSuccess and returns. When control returns to the application, the global error code is checked. If it is set, the database is reverted to the state it had before the modifications began. Extension patterns that participated in the transaction being rolled back are called as follows:<ol type="1"><li>Persistent interfaces, snapshot interfaces, and snapshot view interfaces modified by the transaction are called to revert their state. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_interface">Persistent interface</a>, Snapshot interface, and &quot;Snapshot view interface&quot;.<li>Inval cookies created during the transaction are called to undo. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_inval_handler">Inval handler</a>).</ol><p>When the application returns to its main event loop, it informs the user through an alert, using the string associated with the error code that is set (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_error_string_service">Error string service</a>). The global error code is then cleared, and the application continues.<p>Plug-in code that processes commands or command sequences must check for errors. <a class="el" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a> returns an error code that should be checked for kSuccess before continuing. Alternatively, you can check the global error code using <a class="el" href="class_error_utils.html">ErrorUtils</a>. Details are in <a class="el" href="id_solutions.html#id_commands">Commands</a>. If a plug-in tries to process a command while the global error code is set, protective shutdown occurs to protect the integrity of the document or defaults databases (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_protective_shutdown">Protective shutdown</a>).<p><a class="el" href="class_command.html">Command</a> implementation code also must check for errors. If a command encounters an error condition within the scope of its <a class="el" href="class_command.html#a42808d588c09a77a366a26d6cab12138">Command::Do</a> method, it should set the global error code using <a class="el" href="class_error_utils.html">ErrorUtils</a> and return. Details on error handling is in the command extension pattern; see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_command">Command</a>.<p>Plug-in code that requires more sophisticated error handling, to allow for fail/retry semantics, must use an abortable command sequence. For information on using abortable command sequences, see <a class="el" href="id_solutions.html#id_commands">Commands</a>.<h3><a class="anchor" id="id_protective_shutdown"></a> Protective shutdown</h3><p>Protective shutdown is a mechanism that helps prevent document corruption. Any attempt to process a command when the global error code is set (to something other than kSuccess) causes a protective shutdown. The application creates a log file describing the problem it encountered and then exits.<h2><a class="anchor" id="id_key_client_apis"></a> Key client APIs</h2><p>This section summarizes the APIs a plug-in can use to interact with commands.<h3><a class="anchor" id="id_command_facades_and_utilities"></a> Command facades and utilities</h3><p>There are many command-related boss classes named k&lt;whatever&gt;CmdBoss, but in many cases you do not need to instantiate these commands, as there are command facades and utilities in the API that encapsulate parameterizing and processing these commands.<p>Interfaces like those in the following table are examples of command facades and utilities. These encapsulate processing of many commands required by plug-in code. These interfaces are aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>; the smart pointer class <a class="el" href="class_utils.html">Utils</a> makes it straightforward to acquire and call methods on these interfaces. You can call their methods by writing code that follows this pattern: <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;IDocumentCommands&gt;</a>()-&gt;MethodName(...)</div></div><table class="doxtable"><tr><th>API </th><th>Used for manipulating... </th></tr><tr><td><a class="el" href="class_i_document_commands.html">IDocumentCommands</a></td><td>Documents. </td></tr><tr><td><a class="el" href="class_i_path_utils.html">IPathUtils</a></td><td>Frames and splines. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a> for other APIs that help with layout. </td></tr><tr><td><a class="el" href="class_i_graphic_attribute_utils.html">IGraphicAttributeUtils</a></td><td>Graphic attributes. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a> for other APIs that help with graphics. </td></tr><tr><td><a class="el" href="class_i_text_model_cmds.html">ITextModelCmds</a></td><td>Text. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a> for other APIs that help with text. </td></tr><tr><td><a class="el" href="class_i_table_commands.html">ITableCommands</a></td><td>Tables. See <a class="el" href="id_idml_cookbook.html#id_tables">Tables</a> for other APIs that help with tables. </td></tr><tr><td><a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a></td><td>XML. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_xml_fundamentals">XML Fundamentals</a> for other APIs that help with XML. </td></tr><tr><td><a class="el" href="classk_utils_boss.html">kUtilsBoss</a></td><td>Refer to <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> in the API Reference for a complete list of command facades and utilities. </td></tr></table><p>These utility classes abstract over low-level commands. Before using commands, always look for such a utility to see if there is a method that serves your purpose on one of these interfaces. By doing so, you avoid the increased chance of confusion and error that comes with processing commands. Your use case may require you to process some commands, if the utilities do not provide all of the functionality you require.<p>As used in the application, command &quot;facade&quot; and &quot;utility&quot; are just different names for the same thing, a class that reduces and simplifies the amount of client code you need to write to change objects in the model. They decouple client code from command creation, initialization, and processing.<p>When implementing custom commands, it is advisable to provide your own command facade or utility. If you want to share your class with other plug-ins, implement it as an add-in interface on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>; for example, see <a class="el" href="class_x_doc_bk_facade.html">XDocBkFacade</a>. If the class is used only by one plug-in, a C++ class is sufficient; for example, see <a class="el" href="class_b_p_i_helper.html">BPIHelper</a>.<h3><a class="anchor" id="id_command_processing_apis"></a> Command-processing APIs</h3><p>The classes used when writing client code to process commands are listed in the following table.<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_cmd_utils.html">CmdUtils</a></td><td>Provides methods that create, process, or schedule commands and manage command sequences. </td></tr><tr><td>PersistUtils </td><td>Provides methods like GetDataBase, GetUID, and GetUIDRef, which are used to identify the objects to be operated on by a command. </td></tr><tr><td><a class="el" href="class_error_utils.html">ErrorUtils</a></td><td>Provides access to the global error code. </td></tr></table><dl class="section note"><dt>Note<dd>You must use <a class="el" href="class_cmd_utils.html">CmdUtils</a> to process commands. Do not use the <a class="el" href="class_i_command_processor.html">ICommandProcessor</a> or <a class="el" href="class_i_command_mgr.html">ICommandMgr</a> interfaces for this. Misuse of these interfaces can easily cause document corruption.</dl><p>For information on finding and processing the commands provided by the API, see <a class="el" href="id_solutions.html#id_commands">Commands</a>.<h2><a class="anchor" id="id_extension_patterns"></a> Extension patterns</h2><p>This section summarizes the mechanisms a plug-in can use to extend the command subsystem.<h3><a class="anchor" id="id_command"></a> Command</h3><p><b>Description</b><p>Suppose:<ul><li>You added a new persistent boss to a document or a persistent interface to an object in a document, and you need to set custom data in these objects.<li>The API does not provide a command that sets the model data you need to change.<li>You want do some processing, and you concluded that a command provides the best pattern in which to encapsulate it.</ul><p><b>Architecture</b><p>To implement a command:<ol type="1"><li>Define a new boss class in your plug-in that aggregates IID_ICOMMAND. If you require input parameters over and above the command&#39;s item list, aggregate further data interfaces to the boss through which the parameters can be passed.<li>Provide an implementation of <a class="el" href="class_i_command.html">ICommand</a> using <a class="el" href="class_command.html">Command</a> as a base class.<li>Add client code that processes your new command. See <a class="el" href="id_solutions.html#id_commands">Commands</a>.<li>For more guidance, refer to the <a class="el" href="class_command.html">Command</a> page in the API Reference and see the following &quot;Best practices&quot;.</ol><p><b>Best practices</b><ul><li>The Do method contains the code that modifies the model. The model is changed by calling mutator methods on model interfaces, processing commands, processing commands in a command sequence, or calling utilities that process commands for you.<li>If you encounter an error condition within your Do method, set the global error code (<a class="el" href="class_error_utils.html#ae603b63520be78e0d9875cc99e9bfeca">ErrorUtils::PMSetGlobalErrorCode</a>) and return. The application is responsible for reverting the model back to its state before the Do method was called and informing the user of the error.<li>If you need more sophisticated flow control that allows for fail/retry semantics, use an abortable command sequence (see <a class="el" href="class_i_abortable_cmd_seq.html">IAbortableCmdSeq</a>).<li>The Do method can change objects in only one database each time it is called. To change objects in more than one database in one undoable step, use a command sequence (<a class="el" href="class_i_command_sequence.html">ICommandSequence</a>).<li>Normally, the database containing the objects to be changed is passed using the command&#39;s item list. Alternatively, a command can target a predetermined database, by calling <a class="el" href="class_command.html#abe92a9a5749433745f30b37fa248964c">Command::SetTarget</a> in its constructor. It also can override <a class="el" href="class_command.html#a484fff81f8b9aef551714d3aae1e6917">Command::SetUpTarget</a> and determine the database containing the objects to be changed when the command is processed.<li>Normally, the DoNotify method contains the code that initiates notification, should you require it. Initiate notification by calling <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> (not <a class="el" href="class_i_subject.html#a31c9c940770e9a9a1b286e5a7f48d057">ISubject::Change</a>). Calling <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> when model objects are changed broadcasts regular and lazy notification (see <a class="el" href="id_solutions.html#id_notification">Notification</a>). The application calls DoNotify after the Do method of the command is called; however, notification need not be restricted to this method.<li>Notification can be performed for each object that was modified using the <a class="el" href="class_i_subject.html">ISubject</a> interface of affected objects. Notification also can be performed centrally. For example, many commands that modify the document model notify change using the <a class="el" href="class_i_subject.html">ISubject</a> interface of the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). Sometimes commands use both these approaches. The benefit of using a centralized approach is that an observer needs to attach to only one subject to receive the notification.<li>If you need to notify observers before the model is changed, call your DoNotify method from your Do method before making any changes to the model.<li>Notification can result in the processing of further commands, which can result in global error code being set. If further commands are processed, application shutdown occurs. If multiple subjects are notified by a command, the global error code should be tested between notifications. If the error code is set, the DoNotify method should return without calling further subjects, or it should consume the error and reset the global error code.<li>The undoability of a command should be fixed at command construction (see <a class="el" href="class_i_command.html#a754cd20130dd5be310f570a756c9d777">ICommand::GetUndoability</a>). Its default value is kRegularUndo. If a different undoability is required, it should be set in the command&#39;s constructor. Refer to <a class="el" href="class_i_command.html#a9b7f77ae8c7947d4dcf20b808a2c9f37">ICommand::Undoability</a> in the API Reference.<li>A command must have a name (see <a class="el" href="class_command.html#ac6b9a71827c0217d4aad6f72bcf2ea72">Command::CreateName</a>), if it has an undoability of kRegularUndo and it returns kTrue for IsNameRequired. Such commands can appear in Undo and Redo menu items. The name must have a translation, so it can be displayed in Undo and Redo menu items in a localized form. Commands with an undoability of kRegularUndo that override IsNameRequired to return kFalse must pick up their name from a subcommand. Some commands create and process other commands (subcommands) to make their changes and want to pick up the name of the first subcommand called within their scope instead of providing their own name.<li>Commands with undoability of kAutoUndo do not need a name, because their changes merge with an existing step in the Undo and Redo menu items.<li>The destructor of a command normally is empty. Do not change the model within the destructor.</ul><p><b>See also</b><ul><li>For documentation on commands: <a class="el" href="class_command.html">Command</a> and <a class="el" href="class_i_command.html">ICommand</a> in the API Reference.<li>For documentation on notification: <a class="el" href="class_i_subject.html">ISubject</a> and <a class="el" href="class_i_observer.html">IObserver</a> in the API Reference.<li>If you need error codes set by your command to map onto strings that describe the error condition: <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_error_string_service">Error string service</a>.<li>For sample code: <a class="el" href="classk_b_p_i_set_data_cmd_boss.html">kBPISetDataCmdBoss</a>, <a class="el" href="class_b_p_i_set_data_cmd.html">BPISetDataCmd</a>, and <a class="el" href="class_b_p_i_helper.html">BPIHelper</a> from the BasicPersistInterface plug-in.</ul><h3><a class="anchor" id="id_error_string_service"></a> Error string service</h3><p><b>Description</b><p>Suppose error conditions can occur in your plug-in, and you need to inform the user of these errors.<p><b>Architecture</b><p>Sometimes, error conditions can occur in your plug-in, often within commands or command sequences. When control is returned to the application by your plug-in, and the global error code is set to something other than kSuccess, the user is informed and the model is reverted back to the last consistent state. An error string service provides the ability to map error codes onto error strings. To handle this:<ol type="1"><li>Provide an error string service. This service allows ODFRez resources in your plug-in to map error codes onto strings that describe the error. Detailed documentation on how to define the error codes, resources, and implementations involved is the API Reference for <a class="el" href="class_i_error_string_service.html">IErrorStringService</a>.<li>On detecting the error condition, call <a class="el" href="class_error_utils.html#ae603b63520be78e0d9875cc99e9bfeca">ErrorUtils::PMSetGlobalErrorCode</a> to set your error and return control to the application. The application informs the user of the error.</ol><p><b>See also</b><p>For sample code: <a class="el" href="class_b_p_i_error_string_service.html">BPIErrorStringService</a> from the BasicPersistInterface plug-in.<h3><a class="anchor" id="id_persistent_interface"></a> Persistent interface</h3><p><b>Description</b><p>Suppose you need to add custom data to an existing object in the model and have that persist. For example, you want frames in a document to have a set of custom properties that you control.<p><b>Architecture</b><p>The state of a persistent interface that is associated with a database that supports undo is captured by the application before it is changed; its state is reverted on undo and restored on redo. The state is saved in the command history (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_history">Command history</a>) for undo and redo, and in the database for persistence. The following figure shows the typical sequence of calls made to modify persistent interface, and when that modification subsequently is undone or redone.<div class="image"><img alt="plugin-programming-guide-vol1-17.gif" src="plugin-programming-guide-vol1-17.gif" /></div><p>To implement a persistent interface:<ol type="1"><li>Aggregate your interface on the boss class in the model to which you want to add custom data that persists. Use an add-in interface (an ODFRez AddIn statement) if you are adding the interface to an existing boss class. To define a new type of persistent boss, see Persistent boss.<li>Provide an abstract interface that uses <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> as a base class.<li>Provide an implementation of this abstract interface.<li>Use CREATE_PERSIST_PMINTERFACE to make your implementation class available to the application (instead of CREATE_PMINTERFACE).<li>Define a ReadWrite method for your implementation class. It gets called to serialize your data when needed.<li>Call PreDirty within mutator methods before changing member variables that need to be serialized. This gives the application the ability to recognize that this interface is about to change.<li>Call mutator methods to update the state of your interface. The application calls your ReadWrite method to serialize your data when needed.</ol><dl class="section note"><dt>Note<dd>If your interface persists in a document, you must consider what should happen when users who do not have your plug-in open documents that contain your plug-in&#39;s data. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_missing_plug_ins">Missing plug-ins</a>.</dl><p><b>See also</b><ul><li><a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_command">Command</a>.<li>For sample code: <a class="el" href="class_i_b_p_i_data.html">IBPIData</a>, <a class="el" href="class_b_p_i_data_persist.html">BPIDataPersist</a> and <a class="el" href="class_b_p_i_set_data_cmd.html">BPISetDataCmd</a> from the BasicPersistInterface plug-in.<li>For documentation on persistence: <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_data_and_data_conversion">Persistent Data and Data Conversion</a>.</ul><h3><a class="anchor" id="id_persistent_boss"></a> Persistent boss</h3><p><b>Description</b><p>Suppose you need to add a new type of persistent object to the model. For example, you need to add a list of custom style objects to defaults.<p><b>Architecture</b><p>To implement a persistent boss that has a UID:<ol type="1"><li>Define a new boss class.<li>Aggregate IID_IPMPERSIST, and use the kPMPersistImpl implementation provided by the API.<li>Add persistent interfaces to the boss to store your custom data. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_interface">Persistent interface</a>.<li>Choose a boss class to own the instances of your new persistent boss. Add a persistent interface into the boss class you have chosen that stores the UIDs of the new persistent boss. For example, to add custom styles to defaults, add this interface into <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.</ol><dl class="section note"><dt>Note<dd>If your boss persists within a database that supports undo, such as a document or defaults, you must create, modify, and delete the persistent boss using commands. Implement a create command to allocate a new UID for each new instance of the peristent boss, and store this UID in an interface on boss that owns it. The delete command deletes all child UIDs owned by the persistent boss, removes all references to the persistent boss from the model, then deletes the UID.</dl><p><b>See also</b><ul><li>For sample code: <a class="el" href="classk_pst_lst_data_boss.html">kPstLstDataBoss</a> and <a class="el" href="class_pst_lst_u_i_d_list.html">PstLstUIDList</a> from the PersistentList plug-in.<li>For documentation on persistence: <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_data_and_data_conversion">Persistent Data and Data Conversion</a>.<li><a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_command">Command</a>.</ul><h3><a class="anchor" id="id_snapshot_interface"></a> Snapshot interface</h3><p><b>Description</b><p>Suppose you have an object containing transient data, which depends on model objects that persist in a database that supports undo, and:<ul><li>Your object needs to be updated when the model objects are modified initially and on any subsequent undo or redo.<li>You cannot use lazy notification to update your object, because it must be kept up to date with changes to the model at all times.<li>Your object must be updated on undo or redo, before observers get called.</ul><p>For example, the text state (see the <a class="el" href="class_i_text_state.html">ITextState</a> interface) caches the text attributes that are applied to the &quot;text caret&quot;; the next text insertion uses these attributes. This cache is implemented as a snapshot interface and maintained on undo and redo.<p><b>Architecture</b><p>The state of an snapshot interface is captured by the application before it is changed; its state is reverted on undo and restored on redo. The state is saved in the command history (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_command_history">Command history</a>) for undo and redo. The following figure shows a typical sequence of calls for a snapshot interface when it is modified, and when that modification is subsequently undone or redone.<div class="image"><img alt="plugin-programming-guide-vol1-18.gif" src="plugin-programming-guide-vol1-18.gif" /></div><p>Often, an observer or responder is used to modify a snapshot interface, as shown in <a class="el" href="class_g_t_txt_edt_snapshot_interface.html">GTTxtEdtSnapshotInterface</a>. Before changing any data, the snapshot interface implementation calls PreDirty, indicating to the application that the SnapshotReadWrite method should be called to capture the state of the interface (this state is associated with the CmdStackItem for the current sequence)). On undo or redo, the SnapshotReadWrite method is invoked with the data associated with that particular sequence on the Undo and Redo menus.<p>To implement a snapshot interface:<ol type="1"><li>Add your interface to a persistent boss class that is part of the model on whose state your interface depends. Check that this class aggregates <a class="el" href="class_i_p_m_persist.html">IPMPersist</a>, since the boss must have a UID to support a snapshot interface. For example, if your object depends on objects in a document, you might choose <a class="el" href="classk_doc_boss.html">kDocBoss</a>.<li>Provide an abstract interface that uses <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> as a base class.<li>Provide an implementation of this abstract interface.<li>Use CREATE_SNAPSHOT_PMINTERFACE to make your implementation class available to the application (instead of CREATE_PMINTERFACE).<li>Define a SnapshotReadWrite method for your implementation class. It gets called to serialize snapshots of your data when needed.<li>Call PreDirty within mutator methods before changing member variables you serialize in SnapshotReadWrite.<li>When the model objects you depend on are changed, call mutator methods to modify the state of your interface. You might need to track the change to the object using regular notification. The application takes a snapshot of your interface, reverts the state on undo, and restores it on redo.</ol><dl class="section note"><dt>Note<dd>Even though this extension pattern is very similar in its implementation to a persistent interface, its effect is very different. The information in your snapshot interface is transient and not saved persistently with a document, defaults, or whatever other model it is associated.</dl><p><b>See also</b><ul><li>For sample code: <a class="el" href="class_lnk_wtch_cache.html">LnkWtchCache</a> in the LinkWatcher plug-in and <a class="el" href="class_g_t_txt_edt_snapshot_interface.html">GTTxtEdtSnapshotInterface</a> in the GoToLastTextEdit plug-in. <a class="el" href="id_solutions.html#id_notification">Notification</a>.</ul><h3><a class="anchor" id="id_inval_handler"></a> Inval handler</h3><p><b>Description</b><p>Suppose you have an object that depends on model objects that persist in a database that supports undo, and:<ul><li>Your object must be updated at undo and at redo when the model objects it depends on change.<li>You cannot use lazy notification (see <a class="el" href="id_solutions.html#id_notification">Notification</a>) to update your object, because you need it to be kept up to date with changes to the model at all times.<li>You cannot use a snapshot interface (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_snapshot_interface">Snapshot interface</a>) because you need to do more than restore the state of an object within the application.<li>You need to program behavior that runs at undo and redo.</ul><dl class="section note"><dt>Note<dd>This extension pattern is very rare. This is an advanced pattern and should be used only if absolutely necessary.</dl><p>For example, an observer might watch a subject that can be deleted from the model. Typically, such observers are attached to the subject when it is created and detached just before it gets deleted. If an object is created, the observer is attached. If there is an undo at this point, the observer should be detached; a subsequent redo should result in the observer being re-attached. Similarly, if an object is deleted, the observer is detached. At this point, an undo should result in the observer being attached; a subsequent redo should result in the observer being detached.<p>Consider an observer that attaches to a spread (see <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). When a spread is created, the observer gets attached to the new spread. If the creation of the spread is undone, this observer must be detached before the undo takes place. If the creation of the spread is redone, the observer must be reattached after the redo takes place. The inval handler extension pattern allows for this. The GoToLastTextExit plug-in provides sample code that shows how to use an inval handler to manage the attachment and detachment of an observer that watches stories in a document.<p><b>Architecture</b><p>Inval handlers allow plug-in code to be called at undo and redo. There are two parts to the mechanism:<ul><li>An inval handler (see <a class="el" href="class_i_inval_handler.html">IInvalHandler</a>) that registers interest in a database that supports undo.<li>An inval cookie that gets called on undo and redo. The inval cookie is created by the inval handler at the end of a transaction that contained changes in which the plug-in was interested.</ul><p>Inval handlers are used in situations where a plug-in needs to achieve more than the restoration of the state (through persistent interfaces and snapshot interfaces), and the lazy notification broadcast occurs too late to meet this need. The plug-in has code that must be called immediately at undo or redo.<p>To implement an inval handler:<ol type="1"><li>Provide an implementation of an inval handler (refer to the <a class="el" href="class_i_inval_handler.html">IInvalHandler</a> class in the API Reference for details. See <a class="el" href="class_g_t_txt_edt_inval_handler.html">GTTxtEdtInvalHandler</a> for sample code).<li>Provide an implementation of an inval cookie (refer to the <a class="el" href="class_i_inval_cookie.html">IInvalCookie</a> class in the API Reference for details. See <a class="el" href="class_g_t_txt_edt_inval_cookie.html">GTTxtEdtInvalCookie</a> for sample code).<li>Create an instance of the inval handler, and call <a class="el" href="class_d_b_utils.html#ae249e149f270864b6168c3a0963cb19e">DBUtils::AttachInvalHandler</a> to associate this instance with the database that retains the objects in which you are interested. The scope of this association can be defined by the lifetime of the database or the enabling of particular functionality. For example, an inval handler might be attached to a database when a document is opened.<li>After an inval handler is attached to a database, call <a class="el" href="class_d_b_utils.html#a7c40a2bc700e1a6eaf87cb3935460e34">DBUtils::StartCollectingInvals</a> to indicate that the inval handler is interested in participating in undo and redo. This usually occurs on some event (through an observer or some other means). The StartCollectingInvals call informs the database that the inval handler should be called at the end of the current transaction. If an undoable transaction is ongoing, the inval handler is said to be &quot;collecting invals.&quot;<li>The plug-in code records the semantics of the change. Where this is recorded is implementation-dependent: it could be in the state associated with the inval handler (recommended), an inval handler cookie, or elsewhere.<li>Further changes of interest can occur within the same transaction. The plug-in code should record the semantics of the changes; for example, by adding state to a list within the inval handler.<li>At the completion of the transaction, the <a class="el" href="class_i_inval_handler.html#a82f5374485ae494dd77aab7b7a5a3115">IInvalHandler::EndCollectingInvals</a> method is called. The inval handler can return an instance of an inval cookie representing the change(s) of interest that occurred. This inval cookie is kept in the command history for this database transaction. The inval handler is now said to be &quot;not collecting invals.&quot;<li>The inval cookie is called on undo and redo of the transaction.<li>When the lifetime of an inval handler is over, call <a class="el" href="class_d_b_utils.html#a07bc0f662e354685fd8b7c5935c85bf4">DBUtils::DetachInvalHandler</a> to detach the inval handler from the database. For example, an inval handler might be detached from a document database when a document is closed.</ol><p>The following figure shows the lifetime of a typical inval handler. <div class="image"><img alt="plugin-programming-guide-vol1-19.gif" src="plugin-programming-guide-vol1-19.gif" /></div><p>The following figure shows the typical sequence of calls made to an inval cookie on undo. On undo, any inval cookies that were previously associated with the CmdStackItem are called. The inval cookie setting the error state aborts the undo (the model is reset to the state from before the undo).<div class="image"><img alt="plugin-programming-guide-vol1-20.gif" src="plugin-programming-guide-vol1-20.gif" /></div><p>There are times where the lifetime of an inval handler does not match that of the command history. Inval handlers can be attached and detached at any time, asynchronously with anything else happening in the model. This means there are entries in the command history that do not have corresponding inval cookies for a particular inval handler. In this situation, the inval handler&#39;s BeforeRevert_InvalAll and AfterRevert_InvalAll methods are used to provide the opportunity to rebuild the required state directly.<p>There are times when an inval cookie instance can be asked to merge another instance. This causes the <a class="el" href="class_i_inval_cookie.html#a5cc0abe35df61530f3d7fe1f97b34f92">IInvalCookie::Merge</a> method to be called, to merge cookies that were returned by each call to IInvalHander::EndCollectingInvals within one undoable transaction. For example, this can happen at the end of an abortable command sequence.<p><b>See also</b><ul><li><a class="el" href="class_i_inval_handler.html">IInvalHandler</a>, <a class="el" href="class_i_inval_cookie.html">IInvalCookie</a>, <a class="el" href="class_d_b_utils.html#ae249e149f270864b6168c3a0963cb19e">DBUtils::AttachInvalHandler</a>, <a class="el" href="class_d_b_utils.html#a7c40a2bc700e1a6eaf87cb3935460e34">DBUtils::StartCollectingInvals</a>, and <a class="el" href="class_d_b_utils.html#a07bc0f662e354685fd8b7c5935c85bf4">DBUtils::DetachInvalHandler</a> in the API Reference.<li>For sample code: <a class="el" href="class_g_t_txt_edt_inval_handler.html">GTTxtEdtInvalHandler</a> in the GoToLastTextEdit plug-in.<li>For documentation on how to detect change in other objects using observers and responders: <a class="el" href="id_solutions.html#id_notification">Notification</a>.</ul><h3><a class="anchor" id="id_snapshot_view_interface"></a> Snapshot view interface</h3><p><b>Description</b><p>Suppose you have a user interface object like a widget, which has data that depends on model objects that persist in a database that supports undo, and:<ul><li>Your data needs to be updated when the model objects it depends on are modified or when modifications are undone or redone.<li>You cannot use lazy notification to update your data, because it must be kept up to date with changes to the model at all times.</ul><dl class="section note"><dt>Note<dd>Use of this pattern is extremely rare in the application codebase. For example, it is used by interface <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a> on the layout widget. The data in this interface is depended on by many other objects and always must be kept in tight synchronization with the database. This is an advanced pattern and should be used only if absolutely necessary.</dl><p><b>Architecture</b><p>A snapshot is taken of the state of a snapshot view interface, before it is changed, reverted on undo, and restored on redo. It is very similar to a snapshot interface (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_snapshot_interface">Snapshot interface</a>). The distinction is that the database with which a snapshot interface is associated is fixed and implicitly defined by the persistent boss on which it is aggregated. A snapshot view interface, on the other hand, is part of a user interface object and must explicitly identify the database containing the model objects on which it depends. Also, it is not one specific database. For example, a widget that tracks some state in the front document must change the database on which its snapshot view interface depends, when the front document changes.<p>To implement a snapshot view interface, follow the steps described under <a class="el" href="class_c_view_interface.html">CViewInterface</a> in the API Reference.<p><b>See also</b><p>The <a class="el" href="class_c_view_interface.html">CViewInterface</a> template class in the API Reference.<h1><a class="anchor" id="id_notification"></a> Notification</h1><p>Notification patterns inform interested parties of certain changes. This chapter describes the prevalent notification patterns used by products in the InDesign family.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>Notification is a mechanism by which an interested object can be made aware of changes in other components or subsystems. This section focusses on two prevalent notification patterns, the observer and the responder.<h3><a class="anchor" id="id_observer_pattern"></a> Observer pattern</h3><p>The observer pattern is described in Design Patterns by Gamma et al. The intent of the pattern is to &quot;Define a one to many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.&quot; The following figure shows the structure.<div class="image"><img alt="plugin-programming-guide-vol1-21.gif" src="plugin-programming-guide-vol1-21.gif" /></div><p>The pattern consists of a subject and one or more observers. A subject is an object that needs to inform other objects that are interested in changes to the subject&#39;s state. An observer is an object that needs to keep its state consistent with the state of a subject. A subject can have an association with multiple observers. An observer can observe multiple subjects.<p>The association between observers and subjects is managed through Attach and Detach calls. Any change to the subject is declared through a call to the Notify method, which in turn calls Update on any associated observers.<p>The subject supports three operations:<ul><li>Attach - Associates a specific observer with a subject.<li>Detach - Detaches a specific observer from a subject.<li>Notify - Notifies all associated observers of some change to the subject.</ul><p>The observer supports one operation:<ul><li>Update - Keeps the observer&#39;s state consistent with the subject&#39;s state.</ul><p>Typically, when a client wants to be notified of changes in a subject, it calls Attach, passing an observer that will be the recipient of update messages.<p>Any update to the subject that could be of interest to observers results in a call to the subject&#39;s Notify method. The subject, in turn, iterates through all attached observers, calling their Update operations.<p>At any point, a client can remove the observer from the subject, using Detach. The observer no longer receives update events from that subject.<p>For more information, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_observers">Observers</a>.<h3><a class="anchor" id="id_responder_pattern"></a> Responder pattern</h3><p>With the observer pattern, notification is provided when an object is modified. The responder pattern provides notification on an event. Notification consists of a signal sent from one party to a responder that can react to the event. The application predefines a set of events and corresponding signals in which responders can register interest. For example, signals are associated with document events like create, open, save, and close. A responder that registers interest in the document open event is called each time a document is opened. The following figure shows the structure.<div class="image"><img alt="plugin-programming-guide-vol1-22.gif" src="plugin-programming-guide-vol1-22.gif" /></div><p>The pattern consists of a signal manager and responders. The signal manager is the object responsible for notifying responders of some event. A responder is an object that is called as a result of that event. A responder registers its interest in a particular event using the service provider extension pattern. A responder is a service provider, although this is not shown explicitly in the figure. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_responders">Responders</a>.<h2><a class="anchor" id="id_observers"></a> Observers</h2><p>This section describes the implementation of the observer pattern (see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_observer_pattern">Observer pattern</a>) within the application. The implementation consists of two interfaces, a subject (see the <a class="el" href="class_i_subject.html">ISubject</a> interface) and an observer (see the <a class="el" href="class_i_observer.html">IObserver</a> interface), as shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-23.gif" src="plugin-programming-guide-vol1-23.gif" /></div><h3><a class="anchor" id="id_subjects"></a> Subjects</h3><p>A subject is an object potentially of interest to other objects. Within the application, any object that maintains state of interest to other objects is a candidate for being a subject. An object with an <a class="el" href="class_i_subject.html">ISubject</a> interface is a subject. The interface supports the following key operations:<ul><li>AttachObserver - Associates a particular observer with the subject.<li>DetachObserver - Detached a particular observer from the subject.<li>Change - Notifies observers of a change to the subject. Observers get called on their <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> method. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_regular_and_lazy_notification">Regular and lazy notification</a>.<li>ModelChange - Notifies observers of a change to a subject. Observers get called on their <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> method and/or their <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> method. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_regular_and_lazy_notification">Regular and lazy notification</a>.</ul><p><b>Change manager</b><p>Subjects within the application defer the functionality required to track the subject and observer dependencies to the change manager (the <a class="el" href="class_i_change_manager.html">IChangeManager</a> signature interface). The <a class="el" href="class_i_subject.html">ISubject</a> interface forms a facade over the change manager. It is unlikely third-party developers need to interact with the change manager directly. It is not considered further here.<h3><a class="anchor" id="id_observers"></a> Observers</h3><p>An observer is an object interested in changes to a subject. Any object within the application object model can be an observer by aggregating the <a class="el" href="class_i_observer.html">IObserver</a> interface. The interface supports the following key operations:<ul><li>AutoAttach and AutoDetach - Provided when the observer knows the subject with which it should be associated. A client would then delegate the association of subject and observer to the observer. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_relating_observers_to_subjects">Relating observers to subjects</a> for a description of how to associate an observer with a subject.<li>Update and LazyUpdate - Receives notification when a subject changes. An observer can get called via its Update or LazyUpdate method, depending on how it chooses to receive notifications from the subject. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_regular_and_lazy_notification">Regular and lazy notification</a>.</ul><h3><a class="anchor" id="id_message_protocols"></a> Message protocols</h3><p>Normally, an observer attaching to a subject indicates a protocol of interest. This protocol (identified by type PMIID) allows the observer to be called only for a subset of the total set of messages being broadcast by the subject. Generally, the protocol is synonymous with a data interface on the subject. Observers interested in changes to a specific data interface on the subject attach using the PMIID of the data interface.<p>The following figure shows a subject, kSomeSubjectBoss, that aggregates a data interface, ISomeData. The observer, kSomeObserverBoss, is interested in changes to this data interface. The observer attaches to the subject, specifying IID_ISOMEDATA as the protocol of interest. This corresponds to the PMIID of the data interface. After the data interface is modified, the <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> or <a class="el" href="class_i_subject.html#a31c9c940770e9a9a1b286e5a7f48d057">ISubject::Change</a> method is called to broadcast notification. Observers are called via their Update or LazyUpdate methods, with a message protocol of IID_ISOMEDATA.<p>The object that actually modifies the data interface and calls the <a class="el" href="class_i_subject.html">ISubject</a> interface to broadcast notification is not shown in this figure. If the subject object is part of a document or defaults, the object that calls the mutator method on the data interface normally is a command (see <a class="el" href="id_solutions.html#id_commands">Commands</a>). The command calls <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> if it performs notification. If the subject object is a user interface object, mutator methods on the data interface itself normally call <a class="el" href="class_i_subject.html#a31c9c940770e9a9a1b286e5a7f48d057">ISubject::Change</a> to broadcast notification.<div class="image"><img alt="plugin-programming-guide-vol1-24.gif" src="plugin-programming-guide-vol1-24.gif" /></div><h3><a class="anchor" id="id_subject_and_observer_types"></a> Subject and observer types</h3><p>Within the application, subjects are split into distinct &quot;types.&quot; The type of object a subject is determines the method on <a class="el" href="class_i_subject.html">ISubject</a> that is called to perform notification. The types of subject are as follows:<ul><li>Model - An object that is part of the document model (see <a class="el" href="classk_doc_boss.html">kDocBoss</a>), the defaults model (see <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>), or another model that supports undo. The <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> method is used to broadcast notification when model objects change.<li>User interface - An object that is part of the user interface; for example a checkbox or button. This is distinct from an element in the user interface that is interested in model data. The <a class="el" href="class_i_subject.html#a31c9c940770e9a9a1b286e5a7f48d057">ISubject::Change</a> method is used to broadcast notification when user interface objects change.</ul><p>Within the application, observers are split into distinct &quot;types.&quot; The type of subject object an observer is watching determines the type of observer. The types of observers are as follows:<ul><li>Model - An observer attached to objects that persist in a document (see <a class="el" href="classk_doc_boss.html">kDocBoss</a>), defaults (see <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>), or another model that supports undo. Notification of model observers is done through a call to <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a>.<li>User interface - An observer attached to a user interface object; for example a checkbox or button.<li>Selection - An observer watching an artifact of the current application selection.<li>Context - An observer watching some context, such as the active document.<li>Hybrid - An observer watching multiple types of subjects. A particular observer may attach to any set of objects; however we do not consider what requirements observers that attach to multiple types of subjects might have.</ul><h3><a class="anchor" id="id_regular_and_lazy_notification"></a> Regular and lazy notification</h3><p>The application supports two types of notification, regular and lazy. If an observer needs to be called as soon as a subject broadcasts the change message, it should request regular notification. If the observer can afford to wait until idle time before being notified that a change of interest occurred, it can register for lazy notification. When an observer attaches to a subject, it defines whether it wants to attach for regular notification, lazy notification, or both.<p><b>Regular notification</b><p>Regular notification is passed to an observer via the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> method.<p>With regular notification, an observer is called within the scope of the call to a subject&#39;s <a class="el" href="class_i_subject.html#a31c9c940770e9a9a1b286e5a7f48d057">ISubject::Change</a> (or <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a>) method. The following figure shows the typical sequence of calls made when a subject notifies an observer using regular notification.<div class="image"><img alt="plugin-programming-guide-vol1-25.gif" src="plugin-programming-guide-vol1-25.gif" /></div><p>A client object is called and modifies some data interface, then broadcasts notification about the changes it makes. It mutates the state of a data interface and then calls <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a>. Observers get called via <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> and can retrieve the state of the data interface. The subject and the data interface are most often on the same boss object, but not always.<p>If a change is undone or redone, the observer is not notified. That is, the Update message is not rebroadcast. See the figure on page 81 for the sequence of calls made on undo.<p><b>Lazy notification</b><p>Lazy notification is passed to observers via the <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> method. Lazy notification is available only to observers of subject objects associated with persistent databases supporting undo.<p>Lazy notification is used when observers do not need to be in tight synchronization with changes being made to the subject objects they observe. Rather than participating in each change that occurs on a subject object, observers using lazy notification are notified after all updates are made and the application is idle.<p>When the state of an object in the model is changed (for instance, by a command), and notification is required, the notification always is broadcast by calling <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a>. The <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> method queues a message to be broadcast later. Once the application is idle, observers get called with this message via the <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> method, as shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-26.gif" src="plugin-programming-guide-vol1-26.gif" /></div><dl class="section note"><dt>Note<dd>The approach above holds for subject objects in the document model, the defaults model, or, in general, any subject object that persists in a database that supports undo. Only subject objects which persist in a database that supports undo can use lazy notification.</dl><p>Regardless of the number of changes made to the persistent interface, only one LazyUpdate call is made per sequence for a given message protocol.<p>An implication of this is that ordering of lazy notification with respect to other lazy notification messages cannot be guaranteed. Lazy notification can be thought of as a message indicating a change was applied to an object some time in the past. The observer is responsible for determining the nature of the change.<p>An observer that registers for lazy notification is not guaranteed to receive all messages. For example, suppose an observer is attached to a page item and is watching for the page item to move. If a sequence moves the page item and then deletes it, a lazy update message for the move is not sent to the observer. If a subject object is deleted, any lazy notification messages being queued for that object are purged.<p>We recommend any model observer used to keep some user interface component synchronized with the model should use lazy notification. This eliminates any unnecessary refresh of user interface data. An example use of lazy notification is a user interface panel that reports information about the set of text frames in a document. The user interface panel is associated with a model observer watching for textual changes or the addition or removal of text frames. These operations result in the panel being updated. There is no real requirement for the panel to be updated in real time as these changes are made; the panel should be updated when the text updates are complete (and the application is idle). Lazy notification enables this by sending a single <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> message to the observer when the move is complete.<p>If a change is undone or redone, the observer is notified; that is, the LazyUpdate message is rebroadcast. The sequence of calls made to an observer&#39;s LazyUpdate method on undo is shown in the following figure. <div class="image"><img alt="plugin-programming-guide-vol1-27.gif" src="plugin-programming-guide-vol1-27.gif" /></div><p><b>Both notifications</b><p>An observer can register for both regular and lazy notification. The following figure shows the sequence of calls this might involve. <div class="image"><img alt="plugin-programming-guide-vol1-28.gif" src="plugin-programming-guide-vol1-28.gif" /></div><p>While every <a class="el" href="class_i_subject.html#a4a418b40c50b705616b2fb2d84b10e6a">ISubject::ModelChange</a> message sent to the subject is propagated to the observer via <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a>, only one <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> call is made, regardless of the number of changes made in a single transaction. For example, if multiple updates are made on an object, the update messages being transmitted using a single protocol identifier, and the lazy update method is called only once.<p>On undo or redo, only the LazyUpdate messages are rebroadcast.<p>Registering for both notifications allows an observer to have the rich context of the Update message and have to rebuild their view of the model only on rarer undo/redo events.<p><b>Lazy notification data</b><p>With regular notification, the observer (<a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a>) method is passed a context about what caused the change (usually, the command that initiated the notification). With lazy notification (<a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a>), the observer gets notified only that something changed. The observer must be capable (for instance, by examining the model) of deducing or otherwise rebuilding the set of information it requires. In some cases, the time this takes causes performance issues; therefore, the API provides lazy notification data as an optimization.<p>Lazy notification data objects are data-carrying (C++) objects created by the message originator. For example, a command that deletes a document page object (<a class="el" href="classk_page_boss.html">kPageBoss</a>) might create a lazy notification data object and populate it with the UID of the deleted page. Generally, this lazy notification data object is passed to observers via <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a>. There are situations where the lazy notification data objects associated with a change are purged (for example, in low memory condition), and the observer is called with a nil-pointer; therefore it is important that observers be designed to deal with this.<p>The lazy notification data objects used within the application are not documented in the public API.<dl class="section note"><dt>Note<dd>Use of lazy notification data objects is not pervasive in the application. They exist only as an optimization, and the types of data they consist of varies. We recommend you avoid using them if possible and refresh the observer&#39;s state entirely when <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> is called.</dl><h3><a class="anchor" id="id_observers_and_undo"></a> Observers and undo</h3><p>Only observers registered for lazy notification are signalled when an object they are associated with is modified through an undo or redo action. For each undo or redo, the observer receives one call (per message protocol), regardless of the number of changes made to the subject object.<p>If the observer performs model modifications using commands, on undo or redo these are automatically undone or redone as required. For observers watching the model to update some aspect of the user interface, lazy notification should give the required update. If there are more exotic requirements for notification on undo and redo, two other patterns exist: see the Snapshot interface and Inval Handler extension patterns in <a class="el" href="id_solutions.html#id_commands">Commands</a>.<h3><a class="anchor" id="id_relating_observers_to_subjects"></a> Relating observers to subjects</h3><p>This section discusses how observers are attached to particular subjects.<p><b>Determining the subject</b><p>Before being able to attach and detach observers, an understanding of both the subject to attach to and the protocol to listen along is required. The sample code provided as part of the SDK has examples for many key events of interest. Similarly, Adobe InDesign SDK Solutions has advice on detecting when events occur for domains like layout, text, XML, and so on.<p>If neither of these resources provide the answer, the debug version of the application can be used. In the Test menu is the Spy command. It can be configured to log all executing commands, along with the subjects that are notified, the protocol used for notification, and the change that occurs. Perform the action of interest, and Spy provides the information required to observe the action.<p><b>Attaching and detaching subjects</b><p>In most situations, an observer understands the subjects in which it is interested and how to attach to them. Such an observer attaches to the subjects in the <a class="el" href="class_i_observer.html#a12bc459ed90506d5db2f65eba174cbb5">IObserver::AutoAttach</a> call and detaches in <a class="el" href="class_i_observer.html#a445bcbf0de3bc0ba9b07eae6ff5a8206">IObserver::AutoDetach</a>. For example, an observer on a panel can discover the widgets it contains (see the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface) and attach to their subject interface.<dl class="section note"><dt>Note<dd>There are other situations where the observer does not know the subject(s) with which it should be associated. Given a subject and an observer, a client object can directly attach or detach the observer using <a class="el" href="class_i_subject.html#a4ef07306ece5c3f2f0f28b56b78ada57">ISubject::AttachObserver</a> and <a class="el" href="class_i_subject.html#a571b03a9b739fe969d73a235664927fa">ISubject::DetachObserver</a> calls.</dl><p><b>Using a responder to attach and detach an observer</b><p>Sometimes, an observer is required based on an action within the application. Responders (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_responders">Responders</a>) are called on different application events and can be used to manage the association between an observer and a subject. For example, a responder can be called when documents are created, opened, or closed. On create or open, the responder can attach an observer to the document. On close, the responder can detach the observer.<p><b>Using an observer to attach and detach another observer</b><p>Sometimes, an observer attaches and detaches a second observer based on notification received by the first observer. This pattern commonly is seen in user interface objects that view objects in the front most document. The active context (see <a class="el" href="classk_active_context_boss.html">kActiveContextBoss</a>, the <a class="el" href="class_i_active_context.html">IActiveContext</a> interface, and the IID_IACTIVECONTEXT protocol) is the subject that is updated when the user chooses the document on which to work. The user interface object has a first observer that watches the active context. This observer attaches and detaches a second observer to the subjects of interest in the front-most document.<p><b>Observing a subject that can be deleted</b><p>Sometimes, a client object needs to observe a subject created as part of an undoable action. To do this, a pattern involving two observers and an inval handler can be used (inval handlers are described in <a class="el" href="id_solutions.html#id_commands">Commands</a>). The first observer watches for create events for the subject and attaches the second observer to the newly created subject. To ensure this second observer gets detached if the create action is undone, the first observer also must set up an inval handler. The inval handler provides a mechanism to detach the observer on undo and reattach it on redo.<p>Observing a subject that can be deleted as part of an undoable action is similar. On undo, the observer must be reattached; on redo, it must be detached. Again, this requires the use of an inval handler.<h3><a class="anchor" id="id_document_notification"></a> Document notification</h3><p>The application supports a large object model. Any object is a candidate for becoming a subject (and thousands of subjects exist). Management of observers interested in the set of messages broadcast from a subject can be difficult, if many instances of a subject can exist. For example, consider objects in the page item hierarchy (which can be deleted and recreated, undone and redone, as a consequence of user actions). It is difficult and undesirable to maintain an observer on each page item. To solve this problem, as well as the actual subject object broadcasting the change message, the document&#39;s subject also broadcasts the change. This means any observer associated with the <a class="el" href="class_i_subject.html">ISubject</a> interface on the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) subject is notified, without the overhead of managing the association with finer-grained objects within the document.<p>Notification of changes to page items are broadcast on the document subject using <a class="el" href="class_i_page_item_utils.html#a81f8bf9a366c9bf549fe288dd115772e">IPageItemUtils::NotifyDocumentObservers</a>. Some other types of object use the <a class="el" href="class_i_subject.html">ISubject</a> interface of the document (see <a class="el" href="classk_doc_boss.html">kDocBoss</a>) directly to notify of a change.<h3><a class="anchor" id="id_observers_and_the_model"></a> Observers and the model</h3><p>This section details some considerations around the use of model observers within the application.<p>Observers &quot;watch&quot; model data for two primary reasons:<ol type="1"><li>To update a user interface element to reflect the state of the model. (This type of observer is distinct from user interface observers, which watch for changes in user interface elements like checkboxes.)<li>To provide a point where existing functionality can be extended. For example, an observer can be used to set custom data in a story object (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), on story creation. There are side effects for both the error state and model modifications that should be considered when using observers to extend the model.</ol><p><b>Error state</b><p>Model observers that extend functionality can set the global error state either directly (using <a class="el" href="class_error_utils.html#ae603b63520be78e0d9875cc99e9bfeca">ErrorUtils::PMSetGlobalErrorCode</a>) or indirectly (through processing of commands). Generally, observers are notified during the processing of a command or sequence of commands. If the application tries to process a command when the global error state indicates anything but success (kSuccess), a protective shutdown is invoked to protect the integrity of open documents.<p>An observer setting the global error state either aborts the current change (that is, the current change is undone) or causes the shutdown of the application. The behavior is determined on a per-use basis and can be complicated by the use of commands in different scenarios. For example, the creation of a text story object (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) can occur through the type text tool or from an import and place operation. The type text tool is straightforward, and an observer setting global error state causes the change to be undone. For import and place, however, the story creation occurs as part of a longer sequence of commands. A similar observer setting global error state causes an application shutdown as further commands are processed.<p>Unless it is explicitly suggested that it is appropriate to set error state in an observer of a particular subject change, an observer should not set error state. Also, an observer that uses objects that potentially set error state (such as commands) should test for and consume any errors, taking appropriate remedial action.<p><b>Model modifications</b><p>A common pattern involves calling commands within an observer to make further modifications to the model. This can lead to problems. If the observer is notified as part of a sequence of commands, and the commands that are due to be processed after the current notification phase ends make any assumptions about the state of the model, instability and document corruption can result.<p>For example, consider a sequence of two commands. The first inserts text into a text story object (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). The second changes the color of the newly inserted text to blue. Pseudo-code for this sequence is in the following example.<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyTextUtils::AddNote(<span class="keywordtype">string</span> str, <a class="code" href="class_i_text_model.html">ITextModel</a>* story, TextIndex position) {</div><div class="line"> int32 stringLen = str.Length();</div><div class="line"> BeginSequence(<span class="stringliteral">&quot;AddNote&quot;</span>);</div><div class="line"> MyTextUtils::AddToStory(story,position,str,stringLen);</div><div class="line"> MyTextUtils::SetTextColor(story,position,stringLen,BLUE);</div><div class="line"> EndSequence(<span class="stringliteral">&quot;AddNote&quot;</span>);</div><div class="line">}</div></div><p>At some point, a third party decides to extend the text functionality by writing a macro expander, the purpose of which is to expand known acronyms as text is entered into stories. The third party uses an observer that is notified when text is added to a story. If the observer modifies the model, specifically changing the number of characters entered into the story, it breaks the sequence in the example. The stringLen value is no longer valid.<p>If there is no risk of side effects from the model change within an observer (for example, the observer modifies custom data, not the core application data on the object), it is safe to proceed with the change. If there is a need to perform further modifications on the core application data, consider factoring the change to execute as a separate task (possibly on application idle).<p>In the preceding example, the observer might mark some custom, persistent data in the story, indicating it needs to be processed, and schedule a custom command. The custom command examines the story, determines whether the macro expansion operation is still valid, and updates the story if required. No assumptions can be made about what might occur between marking the story in the observer and the follow-on processing (for example, the document could close, further updates could occur, or the application could terminate).<p>Commands that delete objects generally prenotify, so subject observers get an opportunity to tidy up associated objects before the object is deleted. Observers called in this context should ensure the command state is CommandState::kNotDone.<h2><a class="anchor" id="id_responders"></a> Responders</h2><p>This section describes the implementation of the responder pattern (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_responder_pattern">Responder pattern</a>) within the application. The responder pattern provides notification that a specific event has occurred. For example, a responder can be called when a document is created, opened, or closed. The following figure shows the general structure.<div class="image"><img alt="plugin-programming-guide-vol1-29.gif" src="plugin-programming-guide-vol1-29.gif" /></div><p>The components to the responder pattern shown in this figure are as follows:<ul><li>Signal manager (signature interface <a class="el" href="class_i_signal_mgr.html">ISignalMgr</a>) - The entity responsible for notifying responders of an event.<li>Service provider (interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) - The entity that identifies the object as a responder and indicates the events of interest.<li>Responder (signature interface <a class="el" href="class_i_responder.html">IResponder</a>) - The entity invoked as a result of some event.</ul><h3><a class="anchor" id="id_signal_manager"></a> Signal manager</h3><p>A signal manager is an object that controls the calling of responders. A boss class that has an <a class="el" href="class_i_signal_mgr.html">ISignalMgr</a> interface is a signal manager. A signal manager is called by some other object that wants responders to be notified when an event of interest has occurred. The object that calls a signal manager is often a command (see interface <a class="el" href="class_i_command.html">ICommand</a>). For example, the command that opens a document calls the signal manager to notify responders which have registered an interest in this event.<p>Responders are service providers. Each event for which a responder can be notified has a corresponding ServiceID. The application predefines a set of events and corresponding ServiceIDs in which responders can register interest. For example, the open document event has a ServiceID of kOpenDocSignalResponderService. See <a class="el" href="id_solutions.html#id_notification">Notification</a>.<p>When a particular event occurs the signal manager is called to signal all responders that have registered interest. The signal manager uses the service registry (not shown in the preceding figure) to find the responders that need to be called for the event.<p>If a responder sets the global error state, the signal manager is responsible for calling previously signalled responders indicating there was an error condition (allowing the responder to take whatever action might be necessary) and the action is aborted.<h3><a class="anchor" id="id_responder"></a> Responder</h3><p>A responder is a boss class that supports two specific interfaces, the service provider interface (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) that identifies the events the responder is interested in, and the responder interface (signature interface <a class="el" href="class_i_responder.html">IResponder</a>) that is called for a particular event.<p><b>Responder registration</b><p>Each event for which a responder can be called has a corresponding ServiceID. A responder registers for one or more of these events by returning the ServiceIDs for the events of interest via its <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> implementation. See the <a class="el" href="id_solutions.html#id_notification">Notification</a> for details on the predefined events the application makes available. For sample code, see the <a class="el" href="class_doc_wch_service_provider.html">DocWchServiceProvider</a> class in the DocWatch plug-in.<p><b>Responder implementation</b><p>The responder is called via <a class="el" href="class_i_responder.html#a2d44b72b022abc9d650749c5b5ce463e">IResponder::Respond</a> on an event of interest. The Respond method performs whatever functionality is required and returns.<p>If the global error state is set (<a class="el" href="class_error_utils.html#ae603b63520be78e0d9875cc99e9bfeca">ErrorUtils::PMSetGlobalErrorCode</a>) by a responder, any previously signalled responders have their IRespond::SignalFailed method called to indicate failure. The SignalFailed method performs the function needed to recover. For example, if the Respond method attached an observer to an object, the SignalFailed method detaches that observer.<p>Both methods receive a pointer to a signal manager interface, so they can find out information about the event. Typically, the Respond and SignalFailed methods query the signal manager interface for other contextual interfaces. For example, the document signal manager (see <a class="el" href="classk_document_signal_mgr_boss.html">kDocumentSignalMgrBoss</a>) provides context in the <a class="el" href="class_i_document_signal_data.html">IDocumentSignalData</a> data interface. Responders that register for document signals like kAfterOpenDocSignalResponderService use this data interface to access the document being opened.<p>The Respond and SignalFailed methods often call the service manager using the <a class="el" href="class_i_signal_mgr.html#a5e0d95a2b149f084bc747aecbae07d3d">ISignalMgr::GetServiceID</a> method, to verify the ID of the service that occurred. This allows one responder implementation to be handle more than one type of event<p>For sample code, see the <a class="el" href="class_doc_wch_responder.html">DocWchResponder</a> class in the DocWatch plug-in.<h3><a class="anchor" id="id_responders_and_the_model"></a> Responders and the model</h3><p>Responder implementations can perform follow-on modifications to the model. For example, a responder called as the result of a command modifying the model can make further changes to the model by calling other commands.<p>Take care that these modifications do not interfere with the model data on which the signal is based. For example, if a responder signalled on a create story signal (kNewStorySignalResponderService) deletes or otherwise modifies the created story, commands, observers, and responders that might follow the errant responder could make assumptions about the state of the story. Avoid direct modifications that interfere with the data on which a responder is based. If such a change is required, consider using the responder to set an associated, independent state that can be used by an idle task (or similar) to perform the actual modification on the model. This technique guarantees the model is in a consistent state before modifications are made.<dl class="section note"><dt>Note<dd>A responder should check the global error state is kSuccess (<a class="el" href="class_error_utils.html#ad32805d9e73399357297c07e60fde65a">ErrorUtils::PMGetGlobalErrorCode</a>), before modifying the model.</dl><h3><a class="anchor" id="id_responders_and_global_error_state"></a> Responders and global error state</h3><p>Responders are designed to accommodate error; however, in practice, how a particular signal service deals with error state is implementation dependent.<dl class="section note"><dt>Note<dd>If you set global error state in the <a class="el" href="class_i_responder.html#a2d44b72b022abc9d650749c5b5ce463e">IResponder::Respond</a> method, thoroughly test all areas in the domain in which you are working.</dl><p>If a responder sets global error state, the signal manager calls all previously signalled responders via <a class="el" href="class_i_responder.html#a6d85320457e29d91cd1a69b6195e4609">IResponder::SignalFailed</a> and aborts the action. The ability to clean up a failed action is implementation and context dependent. For example, the creation of a text story object (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) can occur as a result of using the type text tool or importing a file. In the case of importing a file, the responder is called from a much deeper stack than in the case of using the type text tool. The implementation in the latter case does not handle aborting the import from a responder.<p>Another implication of the <a class="el" href="class_i_responder.html#a6d85320457e29d91cd1a69b6195e4609">IResponder::SignalFailed</a> method being called on error is the method must be able to consume and take remedial action for any errors caused within the method. There is nothing the application core can do if an <a class="el" href="class_i_responder.html#a6d85320457e29d91cd1a69b6195e4609">IResponder::SignalFailed</a> method itself fails; the condition is indeterminate.<h3><a class="anchor" id="id_ordering_of_responders"></a> Ordering of responders</h3><p>No guarantees can be made about the order in which responders are called to react to an event. If a client requires a particular responder to be called before another, the implementation of the second responder should call <a class="el" href="class_i_signal_mgr.html#a8ad8480c7594d268781b90809d2c32b0">ISignalMgr::SignalResponder</a> (identifying the first responder) at the start of its respond method. Even though the signal manager&#39;s iteration of the responders has been short-circuited by calling one of the responders directly, no responder is called more than once.<h3><a class="anchor" id="id_responders_and_undo"></a> Responders and undo</h3><p>Responders for the predefined events made available by the application are not called at undo or redo of an operation.<p>If a responder processes commands to make follow-on changes to the model, these changes are undone automatically as part of an undo operation; the client code need to manage this. The same is true for redo of an operation.<p>If a responder is being used to attach an observer to a newly created model object, that observer must be detached on undo and reattached on redo. Similarly, if a responder is being used to detach an observer from a model object about to be deleted, that observer must be reattached on undo and detached on redo. To achieve this, the undo or redo actions need to be tracked using an inval handler. See <a class="el" href="id_solutions.html#id_commands">Commands</a> for a description of the inval handler extension pattern.<p>If the responder is being used for a nonmodel based activity (for example, keeping a log of specific operations), and the undo or redo actions need to be tracked, an inval handler again is required.<h2><a class="anchor" id="id_key_client_apis"></a> Key client APIs</h2><p>The following table shows key client APIs for observers and responders.<table class="doxtable"><tr><th>API </th><th>Note</th><th></th></tr><tr><td colspan="1" rowspan="2">Observers</td><td><a class="el" href="class_i_observer.html">IObserver</a></td><td>Client code mainly calls AutoAttach and AutoDetach to have an observer attach or detach automatically to or from the subject(s) of interest. </td></tr><tr><td><a class="el" href="class_i_subject.html">ISubject</a></td><td>Client code mainly calls AttachObserver and DetachObserver methods to attach or detach an observer. </td></tr><tr><td>Responders</td><td>ISignalManager</td><td>If you are extending the application and need to signal new types of events to responders you will call the signal manager to perform the notification. Often this notification is performed by a custom command that you provide. Signal managers in the application use the default implementation, kSignalMgrImpl, provided by the API. This default implementation provides all functionality for the signal manager, it is unlikely that a third party developer would need to further specialize it. </td></tr></table><h2><a class="anchor" id="id_extension_patterns"></a> Extension patterns</h2><p>This section describes the mechanisms a plug-in can use to receive notification.<h3><a class="anchor" id="id_user-interface_widget_observer"></a> User-interface widget observer</h3><p><b>Description</b><p>This observer is attached to the subject object for a user interface artifact and called on a user interface event, such as selection of a checkbox or activation of a button.<p><b>Architecture</b><p>To implement a user-interface observer:<ol type="1"><li>Subclass the widget type you are creating (for example, <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> for dialogs), as described in the. <a class="el" href="id_solutions.html#id_user_interfaces">User Interfaces</a>.<li>Provide an implementation for <a class="el" href="class_i_observer.html">IObserver</a>. The AutoAttach and AutoDetach methods should attach the observer to any sub-widgets (for example, all buttons on a dialog). Partial implementations exist; for example <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> for dialogs and <a class="el" href="class_c_widget_observer.html">CWidgetObserver</a> for widgets.<li>User interface widget observers register for regular notification. Implement the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> method to react to the user interface state change.</ol><p><b>See also</b><ul><li>id_user_interface_fundamentals.<li><a class="el" href="id_solutions.html#id_user_interfaces">User Interfaces</a>.<li>For sample code: PictureIcon/PicIcoRollOverButtonObserver and WListBoxComposite/WLBCmpListBoxObserver.</ul><h3><a class="anchor" id="id_model_observer"></a> Model observer</h3><p><b>Description</b><p>A model observer provides an extension point for when a persistent object supported by an application database supporting undo is updated.<p><b>Architecture</b><p>To implement a model observer:<ol type="1"><li>Determine the subject that is to be observed, the protocol to listen on, and the change of interest. See <a class="el" href="id_solutions.html#id_notification">Notification</a>.<li>Determine which boss class in the object model will aggregate the observer. Commonly, the boss class that represents the object being observed is a good candidate (for example, aggregating the observer on the document if you are interested in changes to the document). If the observer relates to multiple subjects (for example, attaching to all open documents), place the observer somewhere accessible from client code.<li>Provide the implementation of <a class="el" href="class_i_observer.html">IObserver</a>, deriving from the <a class="el" href="class_c_observer.html">CObserver</a> partial implementation.<li>Determine whether it is appropriate to implement the AutoAttach and AutoDetach methods. Generally, these methods can be used if the subject object to be observed is known within the scope of the observer (for example, if the subject is on the same boss object as the observer). If the AutoAttach and AutoDetach methods are implemented, client code still needs to call them to create the dependency between subject and observer. If these methods are not provided, client code needs to manage the dependency between subject and observer directly (through the <a class="el" href="class_i_subject.html#a4ef07306ece5c3f2f0f28b56b78ada57">ISubject::AttachObserver</a> and <a class="el" href="class_i_subject.html#a571b03a9b739fe969d73a235664927fa">ISubject::DetachObserver</a> calls).<li>Determine whether the subject object is maintained in a database that supports undo. If so, lazy notification is available.<li>If lazy notification is available, determine the type of notification required. If the subject object represents a UID-based object from a database that supports undo/redo, lazy notification is available. If the observer does not need to track every change to an object within a sequence of changes (for example, the observer is used to keep information in a user interface panel up to date, and the panel needs to be updated just once, after all changes are applied), lazy notification can be used. If the observer needs to be aware of all changes to the object as they occur, use regular notification. When attaching the observer to the subject (either in the AutoAttach/AutoDetach methods or through client code), specify the notification type.<li>If lazy notification is not available, register for regular notification.<li>Provide implementations of the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> and/or <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a> methods, as required.</ol><p><b>See also</b><ul><li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_relating_observers_to_subjects">Relating observers to subjects</a><li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_regular_and_lazy_notification">Regular and lazy notification</a><li>For sample code showing a model observer using lazy notification: CustomDataLink / <a class="el" href="class_cus_dt_lnk_u_i_tree_observer.html">CusDtLnkUITreeObserver</a>, LinkWatcher / <a class="el" href="class_lnk_wtch_active_context_observer.html">LnkWtchActiveContextObserver</a>, PanelTreeView / <a class="el" href="class_pnl_trv_tree_observer.html">PnlTrvTreeObserver</a>.<li>For sample code showing a model observer using regular notification: CustomDataLink/ <a class="el" href="class_cus_dt_lnk_doc_observer.html">CusDtLnkDocObserver</a>, GoToLastTextEdit/GTTxtEdtNewDeleteStoryObserver, LinkWatcher/LnkWtchCacheManager, and PersistentList/PstLstDocObserver.</ul><h3><a class="anchor" id="id_selection_observer"></a> Selection observer</h3><p><b>Description</b><p>Selection observers provide an opportunity for client code to be called when there is a change in the active selection.<p><b>See also</b><ul><li>For details:<li>&quot;Selection Observers&quot; section in <a class="el" href="id_solutions.html#id_selection">Selection</a>.<li>For sample code: TableAttributes/TblAttSelectionObserver, StrokeWeightMutator/StrMutSelectionObserver, BasicPersistInterface/BPISelectionObserver, and Persistent List/PstLstUISelectionObserver.</ul><h3><a class="anchor" id="id_document_observer"></a> Document observer</h3><p><b>Description</b><p>As well as notifying a change on a subject, often the notification is repeated on the document for a subject. This allows observers to watch for a change of interest on a document (rather than attach/detach from every object within the document). For example, an observer interested in page items being moved around the layout does not need to attach to each page item (and detach if the page item is deleted, reattaching if it is undeleted, and so on), but attaches to the document instead.<p>A document observer is a special example of a model observer, using the document object (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) as the subject.<p><b>See also</b><ul><li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_model_observer">Model observer</a><li>For sample code: CustomDataLink/CusDtLnkDocObserver, LinkWatcher <a class="el" href="class_lnk_wtch_cache_manager.html">LnkWtchCacheManager</a>, and PersistentList/PstLstDocObserver.</ul><h3><a class="anchor" id="id_active_context_observer"></a> Active context observer</h3><p><b>Description</b><p>A context observer is an observer that watches the active context.<p><b>Architecture</b><p>The active context object (<a class="el" href="classk_active_context_boss.html">kActiveContextBoss</a>) is session wide and available from the session object (<a class="el" href="classk_session_boss.html">kSessionBoss</a>) through the <a class="el" href="class_i_session.html#a76c876ee3f5a1f27c83e3e95f8f6a84c">ISession::GetActiveContext</a> call. An active context observer is an observer attached to the subject interface on the active context object. Active context notifications always are broadcast on the IID_IACTIVECONTEXT protocol. Only regular notification is available. The change context provided is another IID, indicating the type of contextual change that occurred. The common contextual changes of interest are shown in the following table.<table class="doxtable"><tr><th>changedBy </th><th>Note </th></tr><tr><td>IID_IDOCUMENT </td><td>The active document changed. </td></tr><tr><td>IID_ICONTROLVIEW </td><td>The active layout view changed (for example, when the document has multiple layout views open). </td></tr><tr><td>IID_ISPREAD </td><td>The current spread changed. </td></tr><tr><td>IID_ISELECTIONMANAGER </td><td>The type of selection changed. </td></tr></table><p>To implement a context observer:<ol type="1"><li>Aggregate an observer on a boss class accessible from client code.<li>Provide implementations of <a class="el" href="class_i_observer.html#a12bc459ed90506d5db2f65eba174cbb5">IObserver::AutoAttach</a> and <a class="el" href="class_i_observer.html#a445bcbf0de3bc0ba9b07eae6ff5a8206">IObserver::AutoDetach</a> (attaching to the <a class="el" href="class_i_subject.html">ISubject</a> interface on the <a class="el" href="classk_active_context_boss.html">kActiveContextBoss</a> accessible from the GetExecutionContextSession()-&gt; GetActiveContext() call).<li>Provide an implementation of the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> method. The protocol ID is IID_IACTIVECONTEXT.</ol><p>The following example shows how to detect when the active document has changed.<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyObs::Update(<span class="keyword">const</span> <a class="code" href="class_i_d_type.html">ClassID</a>&amp; theChange, <a class="code" href="class_i_subject.html">ISubject</a>* iSubj, <span class="keyword">const</span> PMMID&amp; protocol, <span class="keywordtype">void</span>* changedBy){</div><div class="line"><span class="keywordflow">if</span> (protocol == IID_IACTIVECONTEXT){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IActiveContext&gt;</a> context(iSubj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="struct_key_value_pair.html">IActiveContext::ContextInfo</a>* info= (<a class="code" href="struct_key_value_pair.html">IActiveContext::ContextInfo</a>*)changedBy;</div><div class="line"><span class="keywordflow">if</span>(info-&gt;<a class="code" href="struct_key_value_pair.html#a63c77496c9f8b79cad593f9be2d73a28">Key</a>() == IID_IDOCUMENT){</div><div class="line"> HandleDocumentChange(context);</div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><p><b>See also</b><ul><li>For sample code: LinkWatcher/LnkWtchActiveContextObserver.</ul><h3><a class="anchor" id="id_subject"></a> Subject</h3><p><b>Description</b><p>If there is a need for a boss class to be observable, it needs to be a subject.<p><b>Architecture</b><p>To turn a boss class into a subject:<ol type="1"><li>Aggregate the <a class="el" href="class_i_subject.html">ISubject</a> interface onto the boss class.<li>Provide the implementation for the interface. Generally, reusing the API-supplied implementation (kCSubjectImpl) is sufficient, and there should be no need for further specialization of this interface.</ol><p><b>See also</b><ul><li>For sample code: PersistentList/kPstLstDataBoss.</ul><h3><a class="anchor" id="id_responder"></a> Responder</h3><p><b>Description</b><p>A responder provides notification of an event, such as document open.<p><b>Architecture</b><p>To implement a responder:<ol type="1"><li>Determine the event of interest (as described in <a class="el" href="id_solutions.html#id_notification">Notification</a>).<li>Aggregate the service provider interface (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) on a boss class. Either reuse an existing implementation (see <a class="el" href="id_solutions.html#id_notification">Notification</a>), or provide an implementation that defines the set of ServiceIDs for the events of interest.<li>Aggregate the responder (<a class="el" href="class_i_responder.html">IResponder</a>) on the same boss class.<li>Provide an implementation for the responder, derived from the <a class="el" href="class_c_responder.html">CResponder</a> partial implementation.</ol><p><b>See also</b><ul><li><a class="el" href="id_solutions.html#id_notification">Notification</a>.<li>For sample code: DocWatch/DocWchResponder, CustomDataLink/CusDtLnkDocResponder, and BasicPersistInterface/BPIDefaultResponder.</ul><h1><a class="anchor" id="id_selection"></a> Selection</h1><p>This chapter describes the InDesign/InCopy selection architecture. The selection architecture is based on the concept of suites-abstract interfaces that allow client code to interact with an abstract selection. A suite remains neutral to the underlying format of the objects that are selected.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><h3><a class="anchor" id="id_selection"></a> Selection</h3><p>A selection is whatever is chosen or picked out. For instance, when a user selects a range of text with the Text tool, the user chooses a range of characters. In this case, the selection is a choice of characters from the text model. Highlighting in the user interface is incidental feedback that helps the user make the intended selection. Usually, making a choice using selection is a precursor to modifying the properties of the model underlying the selection. Selection primarily is about targeting objects on which to perform some action, and the selection subsystem exists to mediate changes to those objects.<h3><a class="anchor" id="id_selection_format_and_target"></a> Selection format and target</h3><p>It is necessary to distinguish between the format of a selection and its content, the selection target. A selection format describes the model format of a selectable object, like the layout (frames), text, table cells, or XML structure. Each of these has a distinct arrangement of objects that represents its model. A selection target specifies a set of selected objects of a given selection format, like particular frames or a specific range of text.<p>The principal goal of the selection subsystem is to hide all details about formats and targets from client code. Client code needs ask only &quot;Can this client code do this operation to the selection?&quot; If yes, the client code can try to change the properties of the selection target. This encapsulation is achieved by means of the facade pattern discussed in &quot;Design patterns&quot;.<p>InDesign 2.0 included support for a handful of selection formats, including layout objects (frames), text, table cells, and XML-structure items. InCopy CS added support for other selection formats, like notes.<p>The following table shows selection formats and their targets:<table class="doxtable"><tr><th>Selection format </th><th>When obtained </th><th>Selection target </th></tr><tr><td>Application defaults </td><td>No documents are open. </td><td>Global preferences </td></tr><tr><td>Document defaults </td><td>Document is open with nothing selected. </td><td>Document preferences </td></tr><tr><td>Galley text </td><td>Insertion position is in text, or text range is chosen in Galley view. </td><td>Range of characters in a text model (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td></tr><tr><td>Layout </td><td>One or more page items are chosen in a layout view. </td><td>Layout objects (see <a class="el" href="class_i_layout_target.html">ILayoutTarget</a>) </td></tr><tr><td>Note </td><td>Insertion position or text range is chosen in a note view. </td><td>Range of characters in note text (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td></tr><tr><td>Story editor text </td><td>Insertion position is in text, or text range is chosen in a story-editor view. </td><td>Range of characters in a text model (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td></tr><tr><td>Table (table cells) </td><td>One or more table cells are chosen in a layout view. </td><td>Table cells in a table model (<a class="el" href="class_i_table_target.html">ITableTarget</a>) </td></tr><tr><td>Text </td><td>Insertion position is in text, or text range is chosen in a layout view. </td><td>Range of characters in a text model (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td></tr><tr><td>XML structure </td><td>One or more nodes are chosen in an XML-structure view. </td><td>Elements/attributes in the XML structure (<a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a>) </td></tr></table><h3><a class="anchor" id="id_design_patterns"></a> Design patterns</h3><p>A key task for a plug-in developer is writing model code that extends some aspect of the document model. For instance, if your principal requirement is adding private data to the layout model (see the BasicPersistInterface sample plug-in), the data added extends the layout model and persists with document contents. The command pattern, used in the application API to support undo and preserve document integrity, requires you to write further code to change your model. The API already uses the facade pattern, like <a class="el" href="class_i_table_commands.html">ITableCommands</a> and <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a>, to hide the complexity of parameterizing and processing low-level commands.<p>The selection architecture is an instance of the facade pattern, in that it makes client code easier to write by defining a high-level interface on top of the selection subsystem. The selection architecture shields client code from requiring detailed knowledge of what was selected in the selection subsystem. A facade also makes software maintenance easier, because a facade weakens the coupling between a subsystem and its clients. This weak coupling allows the subsystem components to be varied without necessarily affecting its clients.<h2><a class="anchor" id="id_selection_architecture"></a> Selection architecture</h2><p>The most important objective of the selection architecture is to ensure that new selection formats can be added easily.<p>To support new selection formats without rewriting large parts of the application, client code must be decoupled from the selection format. Client code must not need to know the selection&#39;s subject identifier, meaning client code must not need to know which objects are selected or any boss object associations in the underlying model (for example, the architecture of a text frame). Client code also must not need to know any commands that manipulate the objects.<p>To achieve this goal, the selection architecture makes extensive use of suites that are neutral to selection format. A suite provides a high-level, model-independent API that encapsulates the details of the boss classes, interfaces, and commands in the underlying model. Clients interact with suites instead of directly with the selected objects. In programming terms, a suite is a layer of abstraction that sits on top of the selection and provides a narrow API through which client code communicates its intent with respect to the portion of the model selected. In design-pattern terms, a suite represents a facade that makes it easier to write client code. Writing code that sits on the model-manipulation side requires an understanding of the selection architecture and the model.<p>The following figure shows the layers of encapsulation in the selection architecture. Client code communicates through suites on an abstract selection boss (ASB) class. In turn, these suites communicate with concrete selection boss (CSB) suites on one or more CSB classes. The CSB suites deal with the selection format of only their CSB, and they know how to access and change objects only in the part of the model the CSB manipulates.<div class="image"><img alt="plugin-programming-guide-vol1-30.gif" src="plugin-programming-guide-vol1-30.gif" /></div><p>A window can have one or more views that can support selection. Each view that uses selection instantiates a selection subsystem. In general, client code can remain unaware of what selection subsystem is in operation. While software developers need to be concerned about selection formats if they are writing code that manipulates the model, there is less need to be concerned about selection subsystems. For more information about selection subsystems, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_architecture">Selection architecture</a>.<p>To write code that uses selection to choose attributes of the model to be displayed or changed, it is important to understand the structure that owns the selection format. To illustrate this, a schematic diagram of the selection subsystem used by the layout view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) to edit design documents is shown in the following figure. It presents the static structure and highlights important boss classes and interfaces.<div class="image"><img alt="plugin-programming-guide-vol1-31.gif" src="plugin-programming-guide-vol1-31.gif" /></div><p>The ASB provides the suites called by client code. In this figure, interface IXxxxSuite illustrates such a capability. The suite implementation on the ASB is an integrator suite; its responsibilities are described in detail in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_integrator_suites">Integrator suites</a> on page 108. For now, think of these suites as forwarding any calls they receive to corresponding suites on the CSBs. Further implementations of IXxxxSuite are provided on each CSB that supports the capability. These implementations are CSB suites; their role is discussed further in &quot;CSB suites&quot;<p>In the figure, you can see that IXxxxSuite is implemented on the layout CSB and the text CSB. This means layout and text selections have its capability. Also, when nothing is selected, client code still has the capability represented by IXxxxSuite, because the ASB then targets defaults and finds an implementation of the suite on <a class="el" href="classk_document_default_suite_boss.html">kDocumentDefaultSuiteBoss</a>. For more information on how to use suites to manage preferences, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_architecture">Selection architecture</a>. Table selections do not have the capability represented by IXxxxSuite, because there is no implementation of the suite on the table CSB.<p><a class="el" href="class_i_selection_manager.html">ISelectionManager</a> is the signature interface that identifies a boss class as an ASB. To obtain a suite, client code queries an <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> interface for the suite of interest. If the suite is available, its interface is returned; otherwise, nil is returned. The ASB is not a normal boss class; all suite interfaces are aggregated on the ASB, but an interface pointer is returned to client code only when an active CSB (or the default CSB) that supports the suite exists. The ASB uses a special implementation of <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> to control whether a query for an interface returns the interface or nil.<p>Suite implementations get added to suite boss classes. The following suite boss classes are in the preceding figure:<ul><li><a class="el" href="classk_document_default_suite_boss.html">kDocumentDefaultSuiteBoss</a> for defaults<li><a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a> for the ASB<li><a class="el" href="classk_layout_suite_boss.html">kLayoutSuiteBoss</a> for the layout CSB<li><a class="el" href="classk_table_suite_boss.html">kTableSuiteBoss</a> for the table CSB<li><a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a> for the text CSB</ul><p>A suite boss class has a target (like <a class="el" href="class_i_integrator_target.html">IIntegratorTarget</a> or <a class="el" href="class_i_layout_target.html">ILayoutTarget</a>) and a collection of suite implementations. The figure shows how the selection extends the suite boss classes. Other boss classes extend the suite boss classes in different ways. For example, scripting uses the suite boss <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a> to manipulate text content.<p>Each box in the figure is a self-contained, portable unit. This is one reason why the selection architecture is not coupled to a view, and CSBs do not have pointers to their ASB. This design allows reuse of suite boss classes by other features in the future. A catalogue of suite boss classes is provided in the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_custom_suites">Custom suites</a>.<p>Each selection format has a CSB that extends its suite boss class. <a class="el" href="class_i_concrete_selection.html">IConcreteSelection</a> is the signature interface that identifies a boss class as a CSB. Only those CSBs that join the selection subsystem used by the layout view are shown in the the preceding figure. Other CSBs exist and are used by other subsystems. For a complete list of all CSBs, refer to the API Reference for <a class="el" href="class_i_concrete_selection.html">IConcreteSelection</a>. To understand more about the responsibilities of a CSB, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_concrete_selection_bosses">Concrete selection bosses</a>.<p>Also, the ASB supports a set of interfaces that allows the selection content to be set programmatically. <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> provides the ability to select/deselect all objects. Each selection format provides an interface to allow the selection target to be varied. In the preceding figure, for example, <a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a> allows page items to be selected, and <a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a> allows text to be selected.<h2><a class="anchor" id="id_abstract_selection_bosses_and_suites"></a> Abstract selection bosses and suites</h2><p>The selection architecture isolates client code from model code by means of an ASB. The ASB provides suite interfaces, which are collections of capabilities, as well as other interfaces needed for managing the selection. The main point to understand about the ASB is that it implements the facade for the selection subsystem. Client code interacts with the facade (a suite on the ASB). Writing client code to take advantage of the selection architecture is straightforward; you need to understand only the facade. To write model code and code to change your model or the existing document model, however, it is important to understand how to interact fully within the selection subsystem, and this is less straightforward.<p>The client code in the following example uses a parameter to determine which selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) to use by calling IActiveContext::GetContextSelection. The client code then queries for the suite of interest, IFooSuite. If the suite is available, the client checks to see if the capability it wants is enabled by calling IFooSuite::CanDoSomething. If so, the client uses the capability on the selection by calling IFooSuite::DoSomething. If someone were to create a new selection format and add support for IFooSuite, this client code would work. It does not need to know any details of how IFooSuite is implemented on any specific selection format.<div class="fragment"><div class="line"><span class="keywordtype">void</span> FooActionComponent::DoAction(<a class="code" href="class_i_active_context.html">IActiveContext</a>* ac, <a class="code" href="class_i_d_type.html">ActionID</a> actionID...) {</div><div class="line"> ...</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFooSuite&gt;</a> iFooSuite(ac-&gt;GetContextSelection(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (iFooSuite != nil &amp;&amp; iFooSuite-&gt;CanDoSomething()) {</div><div class="line"> iFooSuite-&gt;DoSomething();</div><div class="line"> }</div><div class="line"> ...</div><div class="line">}</div></div><p>In most cases, either client code is passed a parameter that identifies the selection manager to query for a suite, or the selection manager is implied by the kind of code being written.<h2><a class="anchor" id="id_concrete_selection_bosses"></a> Concrete selection bosses</h2><p>A CDB is a boss class that encapsulates a selection format. It supports the manipulation and observation of the selected objects in the part of the model where the objects are located.<p>This section describes the available selection formats and their associated CSB. The key properties of each CSB are tabulated. The following table describes the label for each field.<table class="doxtable"><tr><th>Label </th><th>Specifies </th></tr><tr><td>CSB </td><td>The boss class that represents this concrete selection. </td></tr><tr><td>CSB name </td><td>The name of the CSB that represents this concrete selection. </td></tr><tr><td>Description </td><td>A general description of this concrete selection. </td></tr><tr><td>Selection attribute extensibility </td><td>Indicates whether this concrete selection can be extended to notify of changes to new selection attributes introduced by third-party software developers. Each CSB is responsible for defining the mechanism used to call selection extensions when selection attributes change. Some CSBs allow the mechanism to be extended. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_extensions">Selection extensions</a> and &quot;Selection observers&quot;. </td></tr><tr><td>Selection format </td><td>The format of the objects this concrete selection makes selectable. </td></tr><tr><td>Selection suite </td><td>The interface that can specify the set of objects selected for this concrete selection. </td></tr><tr><td>Suite boss class </td><td>The boss class to which suites get added that extend the attributes that can be manipulated by this concrete selection. A list of all suites supported by the CSB is in the documentation for this boss class. Custom suites get added to the suite boss class. </td></tr><tr><td>Target </td><td>The interface that identifies the set of objects selected for this concrete selection. </td></tr></table><h3><a class="anchor" id="id_layout_selection"></a> Layout selection</h3><p>Layout selections-made with the Selection tool or programmatically-are represented by the layout CSB. For examples of the suites available, see <a class="el" href="class_i_geometry_suite.html">IGeometrySuite</a>, <a class="el" href="class_i_transform_suite.html">ITransformSuite</a>, and <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a>. For a complete list of available suites, refer to the API Reference for <a class="el" href="classk_layout_suite_boss.html">kLayoutSuiteBoss</a>. Also see the follo wing figure and table.<p>This figure shows a layout selection containing a page item:<div class="image"><img alt="plugin-programming-guide-vol1-32.gif" src="plugin-programming-guide-vol1-32.gif" /></div><p>The following table shows the layout-selection CSB:<table class="doxtable"><tr><td>CSB Name</td><td>Layout CSB </td></tr><tr><td>Selection format</td><td>Layout objects like frames and other kinds of page items. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_new_layout_selection_boss.html">kNewLayoutSelectionBoss</a>. </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_layout_suite_boss.html">kLayoutSuiteBoss</a>. </td></tr><tr><td>Target</td><td><a class="el" href="class_i_layout_target.html">ILayoutTarget</a>. </td></tr><tr><td>Selection suite</td><td>LayoutSelectionSuite. </td></tr><tr><td>Selection attribute extensibility</td><td>Extensible. The CSB has a shared observer attached to the document&#39;s subject (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). Selection extensions define CreateObserverProtocolCollection to extend the protocols that are attached. Selection extensions define SelectionAttributeChanged to handle change broadcasts. </td></tr></table><h3><a class="anchor" id="id_table_selection"></a> Table selection</h3><p>Table selections-made with the Type tool or programmatically-are represented by the table CSB. For an example of a suite, see <a class="el" href="class_i_table_suite.html">ITableSuite</a>. For a complete list of available suites, refer to the API Reference for <a class="el" href="classk_table_suite_boss.html">kTableSuiteBoss</a>. Also see the following figure and table.<p>This figure shows a table selection containing table cells:<div class="image"><img alt="plugin-programming-guide-vol1-33.gif" src="plugin-programming-guide-vol1-33.gif" /></div><p>This table shows the table-selection CSB:<table class="doxtable"><tr><td>CSB Name</td><td>Table CSB </td></tr><tr><td>Selection format</td><td>Table cells. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_table_selection_boss.html">kTableSelectionBoss</a>. </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_table_suite_boss.html">kTableSuiteBoss</a>. </td></tr><tr><td>Target</td><td><a class="el" href="class_i_table_target.html">ITableTarget</a>. </td></tr><tr><td>Selection suite</td><td><a class="el" href="class_i_table_selection_suite.html">ITableSelectionSuite</a>. </td></tr><tr><td>Selection attribute extensibility</td><td>Extensible. The CSB has a cell focus (<a class="el" href="class_i_cell_focus.html">ICellFocus</a>) that monitors table-attribute changes in the selection. Changes to custom table attributes also are detected by this CSB. Also, the CSB has a shared observer attached to the document&#39;s subject (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). Selection extensions define CreateObserverProtocolCollection to extend the protocols that are attached. Selection extensions define SelectionAttributeChanged to handle change broadcasts. </td></tr></table><h3><a class="anchor" id="id_text_selection"></a> Text selection</h3><p>Text selections in the Layout view-made with the Type tool or programmatically-are represented by the text CSB. Text selection take one of two principal forms, a selected range of characters in a story (TextRange) or an insertion point within a story (represented by a TextRange with zero span). Although it may not seem intuitive that an insertion point is considered a text selection, it is considered a selection from the viewpoint of selection management.<dl class="section note"><dt>Note<dd>Other views use other CSBs to represent text selection.</dl><p>For examples of the suites available, see <a class="el" href="class_i_text_edit_suite.html">ITextEditSuite</a> and <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a>. For a complete list of available suites, refer to the API Reference for <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>. Also see the following figures and table.<p>This figure shows a text selection containing a range of characters:<div class="image"><img alt="plugin-programming-guide-vol1-34.gif" src="plugin-programming-guide-vol1-34.gif" /></div><p>This figure shows a text selection containing an insertion point:<div class="image"><img alt="plugin-programming-guide-vol1-35.gif" src="plugin-programming-guide-vol1-35.gif" /></div><p>This table shows the text-selection CSB:<table class="doxtable"><tr><td>CSB name</td><td>Text CSB. </td></tr><tr><td>Selection format</td><td>Text. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_text_selection_boss.html">kTextSelectionBoss</a>. </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>. </td></tr><tr><td>Target</td><td><a class="el" href="class_i_text_target.html">ITextTarget</a>. </td></tr><tr><td>Selection suite</td><td><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>. </td></tr><tr><td>Selection attribute extensibility</td><td>Extensible. The CSB has a text focus (<a class="el" href="class_i_text_focus.html">ITextFocus</a>) on <a class="el" href="classk_text_selection_focus_boss.html">kTextSelectionFocusBoss</a> that monitors text-attribute changes; this picks up changes to custom text attributes. Also, the CSB has a shared observer attached to the document&#39;s subject (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). Selection extensions define CreateObserverProtocolCollection to extend the protocols that are attached. Selection extensions define SelectionAttributeChanged to handle change broadcasts. </td></tr></table><p>The following figure shows a text selection in a table cell. Although the selection is inside a table, this is a text selection and not a table selection. The selected text is indicated by the <a class="el" href="class_i_text_target.html">ITextTarget</a> target interface. The table implied by this selection is indicated by <a class="el" href="class_i_table_target.html">ITableTarget</a>, a secondary targeting interface provided by text selection.<div class="image"><img alt="plugin-programming-guide-vol1-36.gif" src="plugin-programming-guide-vol1-36.gif" /></div><h3><a class="anchor" id="id_galley_text_selection"></a> Galley text selection</h3><p>Text selections in the galley view-made with the Type tool or programmatically-are represented by the galley-text CSB. The galley-text CSB represents text selection made in a galley view window.<p>Text selection uses many subsystems. For the most part, client code can remain unaware of what subsystem is in operation, but suite developers need to know, because the CSB that supports text selection in the galley view is different than the one that supports it in the layout view. If you do not add your suite to the appropriate suite boss class, your suite might not be available when you want it. In most cases, the same suite implementation can be reused. For an example of a suite that is available, see <a class="el" href="class_i_text_edit_suite.html">ITextEditSuite</a>. For a complete list of available suites, refer to the API Reference for <a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a>. Also see the following figure and table.<p>This figure shows a galley text selection containing a range of characters:<div class="image"><img alt="plugin-programming-guide-vol1-37.gif" src="plugin-programming-guide-vol1-37.gif" /></div><table class="doxtable"><tr><td>CSB name</td><td><p class="starttd">Galley text CSB.<p class="endtd"></td></tr><tr><td>Selection format</td><td><p class="starttd">Galley text.<p class="endtd"></td></tr><tr><td>CSB</td><td><p class="starttd"><a class="el" href="classk_galley_text_selection_boss.html">kGalleyTextSelectionBoss</a>.<p class="endtd"></td></tr><tr><td>Suite boss class</td><td><p class="starttd"><a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a>.<p class="endtd"></td></tr><tr><td>Target</td><td><p class="starttd"><a class="el" href="class_i_text_target.html">ITextTarget</a>.<p class="endtd"></td></tr><tr><td>Selection suite</td><td><p class="starttd"><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>.<p class="endtd"></td></tr><tr><td>Selection attribute extensibility</td><td>Limited extensibility. The CSB has a text focus (<a class="el" href="class_i_text_focus.html">ITextFocus</a>) on <a class="el" href="classk_text_selection_focus_boss.html">kTextSelectionFocusBoss</a>, which monitors text-attribute changes. Changes to custom text attributes are picked up by this. </td></tr></table><h3><a class="anchor" id="id_story-editor_text_selection"></a> Story-editor text selection</h3><p>The story editor is available in InDesign and InCopy.<p>Text selections by the story editor are similar to galley text selection. The story-editor CSB extends the galley-text CSB, and both share the same suite boss class, <a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a>. For an example of a suite that is available, see <a class="el" href="class_i_text_edit_suite.html">ITextEditSuite</a>. For a complete list of available suites, refer to the API Reference for <a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a>. Also see the following figures and table.<p>This figure shows a story-editor text selection in InCopy:<div class="image"><img alt="plugin-programming-guide-vol1-38.gif" src="plugin-programming-guide-vol1-38.gif" /></div><p>This figure shows a story-editor text selection in InDesign:<div class="image"><img src="plugin-programming-guide-vol1-39.gif" /></div><p>This table shows the story-editor text-selection CSB:<table class="doxtable"><tr><td>CSB name</td><td>Story-editor text CSB. </td></tr><tr><td>Selection format</td><td>Story editor text. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_story_editor_selection_boss.html">kStoryEditorSelectionBoss</a>. </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a>. </td></tr><tr><td>Target</td><td><a class="el" href="class_i_text_target.html">ITextTarget</a>. </td></tr><tr><td>Selection suite</td><td><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>. </td></tr><tr><td>Selection attribute extensibility</td><td>Limited extensibility. The CSB has a text focus (<a class="el" href="class_i_text_focus.html">ITextFocus</a>) on <a class="el" href="classk_text_selection_focus_boss.html">kTextSelectionFocusBoss</a>, which monitors text attribute changes. Changes to custom text attributes are also picked up by this. </td></tr></table><h3><a class="anchor" id="id_note_text_selection"></a> Note text selection</h3><p>When text is selected in a note, the CSB involved is not the same as the one used for normal text selection. The note-text CSB represents text selection made in a note. For an example of a suite that is available, see <a class="el" href="class_i_note_suite.html">INoteSuite</a>. For the complete list of available suites, refer to the API Reference for <a class="el" href="classk_note_text_suite_boss.html">kNoteTextSuiteBoss</a>. Also see the following figure and table.<p>This figure shows a note selection:<div class="image"><img alt="plugin-programming-guide-vol1-40.gif" src="plugin-programming-guide-vol1-40.gif" /></div><p>This table shows the note text-selection CSB:<table class="doxtable"><tr><td>CSB name</td><td>Note text CSB. </td></tr><tr><td>Selection format</td><td>Note text. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_note_text_selection_boss.html">kNoteTextSelectionBoss</a>. </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_note_text_suite_boss.html">kNoteTextSuiteBoss</a>. </td></tr><tr><td>Target</td><td><a class="el" href="class_i_text_target.html">ITextTarget</a>. </td></tr><tr><td>Selection suite</td><td><a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>. </td></tr><tr><td>Selection attribute extensibility</td><td>Limited extensibility. The CSB has a text focus (<a class="el" href="class_i_text_focus.html">ITextFocus</a>) on <a class="el" href="classk_text_selection_focus_boss.html">kTextSelectionFocusBoss</a>, which monitors text attribute changes. Changes to custom text attributes are also picked up by this. </td></tr></table><h3><a class="anchor" id="id_xml_selection"></a> XML selection</h3><p>XML selections in the structure view (the left panel of the following figure) -made with the Selection tool or programmatically-are represented by the XML CSB. There is a selection subsystem associated with the XML structure view that is distinct from the selection subsystem associated with the layout view, even though both views are displayed in the same window. Do not confuse XML selection with the XML tags shown in the layout view (the right panel of the following figure). For examples of suites that are available, see <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> and <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a>. For a complete list of available suites, see the documentation for <a class="el" href="classk_x_m_l_structure_suite_boss.html">kXMLStructureSuiteBoss</a>. Also see the following figure and table.<p>This figure shows XML node selections in an XML-structure view:<div class="image"><img alt="plugin-programming-guide-vol1-41.gif" src="plugin-programming-guide-vol1-41.gif" /></div><p>This table shows XML-selection CSB:<table class="doxtable"><tr><td>CSB name</td><td>XML CSB </td></tr><tr><td>Selection format</td><td>XML node (element, attribute, or both) </td></tr><tr><td>CSB</td><td><a class="el" href="classk_x_m_l_structure_selection_boss.html">kXMLStructureSelectionBoss</a></td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_x_m_l_structure_suite_boss.html">kXMLStructureSuiteBoss</a></td></tr><tr><td>Target</td><td><a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a></td></tr><tr><td>Selection suite</td><td><a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a></td></tr><tr><td>Selection attribute extensibility</td><td>Not extensible. </td></tr></table><h3><a class="anchor" id="id_document_defaults"></a> Document defaults</h3><p>When a document is open but nothing is selected, the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) becomes the selection subsystem&#39;s target. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_architecture">Selection architecture</a>. Also see the following figure and table.<p>This figure shows document defaults: An open document with no selection:<div class="image"><img alt="plugin-programming-guide-vol1-42.gif" src="plugin-programming-guide-vol1-42.gif" /></div><p>This table shows document-defaults CSB:<table class="doxtable"><tr><td>CSB name</td><td>Defaults. </td></tr><tr><td>Selection format</td><td>Preferences maintained as data interfaces on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>. (Strictly speaking, this is not a CSB, because it does not aggregate <a class="el" href="class_i_concrete_selection.html">IConcreteSelection</a>; however, <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> often is referred to as the defaults CSB.) </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_document_default_suite_boss.html">kDocumentDefaultSuiteBoss</a>. </td></tr><tr><td>Target</td><td>NA </td></tr><tr><td>Selection suite</td><td>NA </td></tr><tr><td>Selection attribute extensibility</td><td>Extensible. The CSB has a shared observer attached to the document workspace&#39;s subject (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). Selection extensions define CreateObserverProtocolCollection to extend the protocols that are attached. Selection extensions define SelectionAttributeChanged to handle change broadcasts. </td></tr></table><h3><a class="anchor" id="id_application_defaults"></a> Application defaults</h3><p>When no document is open, a special selection subsystem (the workspace selection, <a class="el" href="classk_abstract_workspace_selection_boss.html">kAbstractWorkspaceSelectionBoss</a>) is activated. It targets application-wide defaults on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_architecture">Selection architecture</a>. Also see the following figure and table.<p>This figure shows application defaults: No document open:<div class="image"><img alt="plugin-programming-guide-vol1-43.gif" src="plugin-programming-guide-vol1-43.gif" /></div><p>This table shows application-defaults CSB:<table class="doxtable"><tr><td>CSB name</td><td>Defaults. </td></tr><tr><td>Selection format</td><td>Preferences maintained as data interfaces on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. </td></tr><tr><td>CSB</td><td><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. (Strictly speaking, <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> is not a CSB, because it does not aggregate <a class="el" href="class_i_concrete_selection.html">IConcreteSelection</a>; however, <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> often is referred to as the defaults CSB.) </td></tr><tr><td>Suite boss class</td><td><a class="el" href="classk_application_default_suite_boss.html">kApplicationDefaultSuiteBoss</a>. </td></tr><tr><td>Target</td><td>NA </td></tr><tr><td>Selection suite</td><td>NA </td></tr><tr><td>Selection attribute extensibility</td><td>Extensible. The CSB has a shared observer attached to the session workspace&#39;s subject (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). Selection extensions define CreateObserverProtocolCollection to extend the protocols that are attached. Selection extensions define SelectionAttributeChanged to handle change broadcasts. </td></tr></table><h2><a class="anchor" id="id_integrator_suites"></a> Integrator suites</h2><p>An integrator suite is an implementation of a suite that was added to <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>, which is part of an ASB. Consequently, an integrator suite sometimes is known as an ASB suite. All communication between client code and the selection is performed using the integrator suite. A properly designed suite API is neutral to selection format, meaning there are no references to a specific selection format. This is essential to avoid tight coupling between the client code and the model.<p>The purpose of an integrator suite is to iterate over the concrete-selection formats supported by the suite or, more formally, to integrate over the integrator target (represented by <a class="el" href="class_i_integrator_target.html">IIntegratorTarget</a>). Although it may seem that &quot;iterator&quot; may be a more appropriate name, &quot;integrator&quot; is correct in this context, because it means &quot;to join together.&quot; In the mathematical sense, &quot;integrate&quot; also can refer to summation, and the integrator suite performs a summation over the capabilities of individual selection-for mat-specific suites.<p>The implementation of an integrator suite is very stereotypical; it delegates any call to CSB suites on CSBs that are active (that is, on CSBs that have a selection). Integrator-suite implementations should be based on templates provided by the SDK. The templates reduce the amount of code you need to write.<p>An example of an integrator suite is the kTableSuiteIntegratorImpl implementation of <a class="el" href="class_i_table_suite.html">ITableSuite</a> on <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>. Both text (<a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>) and table selections (<a class="el" href="classk_table_suite_boss.html">kTableSuiteBoss</a>) provide support for <a class="el" href="class_i_table_suite.html">ITableSuite</a>. The client code is shielded from the selection format that is providing the implementation. Integrator suite calls are forwarded to the selection-format &acirc;&#128;&#147;specific implementations on the CSB suites.<h2><a class="anchor" id="id_csb_suites"></a> CSB suites</h2><p>A CSB suite is a suite implementation on a CSB. CSB suites receive calls forwarded from integrator suites when they are called by client code.<p>CSB suites exist to do model-specific work, like navigating relationships between objects in the model and processing of commands. When you manipulate the model from within a CSB suite, you interact with objects in a specific selection format (for example, by means of target interfaces like <a class="el" href="class_i_text_target.html">ITextTarget</a> or <a class="el" href="class_i_layout_target.html">ILayoutTarget</a>). There are several CSBs that extend suite-boss classes; for example, <a class="el" href="classk_text_selection_boss.html">kTextSelectionBoss</a> subclasses <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>. For a complete list of CSBs, refer to the API Reference for the <a class="el" href="class_i_concrete_selection.html">IConcreteSelection</a> interface, from which you can examine the documentation page for each CSB to see which suite boss it extends.<h2><a class="anchor" id="id_encapsulation"></a> Encapsulation</h2><p>A key concept in the selection architecture is that client code should be insulated from code that accesses and modifies the model (both the document and associated data). Code that works in terms of UID, <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, or <a class="el" href="class_u_i_d_list.html">UIDList</a> values that relate to stories (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> objects) or layout objects (for example, something that exposes an <a class="el" href="class_i_graphic_frame_data.html">IGraphicFrameData</a> interface) interacts with a portion of the document model.<p>A selection of objects that is represented, for example, as a <a class="el" href="class_u_i_d_list.html">UIDList</a> (as would have been the case in the old selection architecture) is tightly coupled to the model. Such tight coupling makes it very difficult to add new selection formats, because client code already has detailed knowledge about what is in a selection. Also, with such tight coupling, you cannot change the way in which the model is represented without breaking client code, because the client code has detailed model knowledge.<p>To add new selection formats, the client code needs to be decoupled from the selection formats. This means client code should be neutral with respect to selection format when dealing with the selection. The client code communicates by means of ASB suites. These suites, in turn, communicate with CSB suites. The CSB suites deal only with the model format of their CSB; they do not even know about the ASB. This is necessary because an alternative use for suites is scripting, which most likely does not have an analog to the ASB.<h2><a class="anchor" id=""></a></h2><p>In the StrokeWeightMutator sample plug-in, the stroke-weight drop-down widget is enabled when the stroke weight of whatever is selected can be changed. These steps are followed:<ol type="1"><li>The widget looks for the API&#39;s stroke attribute suite (<a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a>).<li>If the suite is available, a CSB (the one with something selected or the defaults, if nothing is selected) has an implementation of the suite.<li>The widget asks the integrator suite on the ASB whether the stroke-weight attribute is available, by calling <a class="el" href="class_i_stroke_attribute_suite.html#a73dc6b7ca6810bc54e3381ac021ab523">IStrokeAttributeSuite::GetStrokeWeightCount</a>.<li>The integrator-suite implementation on the ASB forwards the call to the CSB-suite implementations.<li>The CSB implementation accesses the model for the selection format it supports and returns the answer.<li>The widget then calls <a class="el" href="class_i_stroke_attribute_suite.html#a28bfa849068994bc2f3916e8097e4bcd">IStrokeAttributeSuite::GetStrokeWeight</a> to retrieve the value if applicable.</ol><p>When the widget handles a user click to change the stroke weight, the widget calls <a class="el" href="class_i_stroke_attribute_suite.html#a58bccbc72445cc851b37c2a6d5fefbc6">IStrokeAttributeSuite::ApplyStrokeWeight</a> on the integrator suite to dispatch to the CSB suites, which change the value stored in the model. The widget synchronizes what it displays with any changes to the selection using a selection observer. It is sent a message when the stroke weights displayed in the widget need to be refreshed. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_observers">Selection observers</a>.)<h2><a class="anchor" id="id_responsibilities"></a> Responsibilities</h2><h3><a class="anchor" id="id_basic_client-code_responsibilities"></a> Basic client-code responsibilities</h3><p>If you are writing client code that modifies the properties of an abstract selection and can use a preexisting suite, your responsibilities are minor. Query the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) that represents the abstract selection for the suite you want (like <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> to change properties of text in a selection) and, if you get the suite, use it. Look for a code fragment showing these responsibilities for the <a class="el" href="class_i_text_miscellany_suite.html">ITextMiscellanySuite</a> suite.<p>You must understand how to query the abstract selection for a particular capability. To understand what suites are provided by the API, refer to the API Reference and examine the boss classes that aggregate <a class="el" href="class_i_text_miscellany_suite.html">ITextMiscellanySuite</a>, to see the selection formats that support this particular capability.<h3><a class="anchor" id="id_selection-observer_responsibilities"></a> Selection-observer responsibilities</h3><p>If you are writing code that needs to update when the selection changes, implement a selection observer (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_observers">Selection observers</a>). If there is a preexisting suite that informs your client code of the changes you are interested in, your selection observer looks for messages from this suite. For example, <a class="el" href="class_i_text_attribute_suite.html">ITextAttributeSuite</a> notifies clients when a text-attribute change happens to the selection. Otherwise, implement a custom suite to inform client code about the changes of interest (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_custom_suites">Custom suites</a>).<h3><a class="anchor" id="id_custom-suite_responsibilities"></a> Custom-suite responsibilities</h3><p>If you have any client code that depends on the state of the selection, write a custom suite to access that state. For example, the BasicMenu sample implements a custom suite because it has menu items that need to know whether a page item is selected. A suite is required because the client code needs to access a selection target interface to determine whether a page item is selected.<p>If you are writing code that changes the existing document model (for example, you are implementing or processing commands that change this model), and you want to use selection to target the objects, you must create a suite.<p>If you are writing code that extends the document model (for example, you are adding a custom data interface to the layout model, like BasicPersistInterface), and you want to use selection to target the manipulation of this data, you must create a suite.<p>The model also extends to default preferences; changes to the application&#39;s default preferences and the document default preferences can be mediated by the selection subsystem.<h2><a class="anchor" id="id_custom_suites"></a> Custom suites</h2><p>When writing a custom suite that you want to make available to client code in one or more selection formats, provide two implementations, one relating to abstract selections and another to concrete selections. The former (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_integrator_suites">Integrator suites</a> on page 108) is added to the <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a> suite boss class, and the latter (see &quot;CSB suites&quot; on page 109) is added to the selection-format-specific suite boss classes. For details about the selection formats that can be of interest to client code, see &quot;Concrete selection bosses&quot;. The following table lists suite boss classes.<table class="doxtable"><tr><th>Suite boss class </th><th>Selection format </th><th>Rationale </th></tr><tr><td><a class="el" href="classk_application_default_suite_boss.html">kApplicationDefaultSuiteBoss</a></td><td>Application defaults </td><td>If you want your suite to be available to client code when no documents are open, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_document_default_suite_boss.html">kDocumentDefaultSuiteBoss</a></td><td>Document defaults </td><td>If you want your suite to be available to client code when a document is open but nothing is selected, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a></td><td>Text in InCopy Galley or Story Editor views (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td><td>If you want your suite to be available to client code during galley- or story-editor-view text selections, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a></td><td>Abstract (<a class="el" href="class_i_integrator_target.html">IIntegratorTarget</a>) </td><td>Required for any custom suite. </td></tr><tr><td><a class="el" href="classk_layout_suite_boss.html">kLayoutSuiteBoss</a></td><td>Layout (<a class="el" href="class_i_layout_target.html">ILayoutTarget</a>) </td><td>If you want your suite to be available to client code during layout selections, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_note_text_suite_boss.html">kNoteTextSuiteBoss</a></td><td>Text in InCopy Note (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td><td>If you want your suite to be available to client code during note selections, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_selection_interface_always_active_boss.html">kSelectionInterfaceAlwaysActiveBoss</a></td><td>. </td><td>If you want your suite to be available to client code regardless of the kind of concrete selection that exists, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_story_editor_suite_boss.html">kStoryEditorSuiteBoss</a></td><td>Text in Story Editor view (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td><td>(Not supported.) If you want the story editor suite to be different from that for InCopy Galley view, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_table_suite_boss.html">kTableSuiteBoss</a></td><td>Tables (<a class="el" href="class_i_table_target.html">ITableTarget</a>) </td><td>If you want your suite to be available to client code during table selections, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a></td><td>Text (<a class="el" href="class_i_text_target.html">ITextTarget</a>) </td><td>If you want your suite to be available to client code during text selections, add the suite to this boss class. </td></tr><tr><td><a class="el" href="classk_x_m_l_structure_suite_boss.html">kXMLStructureSuiteBoss</a></td><td>XML structure, (<a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a>) </td><td>If you want your suite to be available to client code during XML selections, add the suite to this boss class. </td></tr></table><h2><a class="anchor" id="id_selection_extensions"></a> Selection extensions</h2><p>A selection extension (<a class="el" href="class_i_selection_extension.html">ISelectionExtension</a>) is a bridge between a suite implementation with an unknown interface and the selection architecture. A suite that requires advanced function registers a selection extension with the selection subsystem. The selection subsystem then communicates with the extension, which in turn forwards a message to the suite implementation. If your suite requires one or more of the services described in this section, you must implement a selection extension.<h3><a class="anchor" id="id_caches"></a> Caches</h3><p>A suite may need to cache data to improve performance. You can add caches to suite implementations. In general, caches are added to CSB suite implementations. Cache validation should be delayed as long as possible. Rather than updating the cache every time a model change occurs, declare a Boolean cacheValid flag. When the model changes, set the flag to kFalse. Before accessing the cache, rebuild it if it is invalid. Thus, if your suite provides data to a user-interface panel and that panel is not visible, your suite does not needlessly consume CPU cycles recalculating cache values the user does not need.<p>Furthermore, caches should be enabled only on CSB boss classes, not suite boss classes. Because the scripting architecture extends suite boss classes, no caching should be done on them. If you are implementing a custom suite that needs a cache, add your cache interface only to the CSB. <a class="el" href="class_i_concrete_selection.html">IConcreteSelection</a> is the signature interface that identifies a boss class as a CSB. Your custom suite implementation can then perform a run-time check to see if your cache interface is available. If not, it can handle this situation gracefully and carry on without using the cache.<h3><a class="anchor" id="id_selection_change_notification"></a> Selection change notification</h3><p>The design of some suites requires notification of selection changes. A selection extension allows your suite to be called by a CSB whenever the selection changes. A selection extension allows you to control whether clients of your suite-in the form of selection observers-get notified. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_observers">Selection observers</a>.)<p>There are two kinds of selection change events:<ul><li>An object is added to or removed from the selection (that is, the selection changes); for example, a user Shift-clicks to add a frame to the selection.<li>An attribute of an object in the selection changes (that is, a selection attribute changes); for example, the stroke color of selected frames changes.</ul><p>A suite that has a cache must mark its cache as invalid when notified the selection has changed. A suite needs to invalidate its cache when notified that a selection attribute changed only if the specific selection-attribute change affects this suite&#39;s cache. Many selection-attribute changes may not affect a particular cache.<dl class="section note"><dt>Note<dd>Selection-attribute change notification is not supported on all CSBs. For information on each CSB, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_concrete_selection_bosses">Concrete selection bosses</a>.</dl><h3><a class="anchor" id="id_initialization"></a> Initialization</h3><p>Some suites need to perform an action on start-up or shut-down of a selection subsystem. Any such initialization is done by implementing a selection extension. Do not confuse this kind of start-up and shut-down with application services, like <a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a>, which are called for the application session. Selection subsystems get created and destroyed as the views that own them open and close.<h3><a class="anchor" id="id_communication_with_integrator_suite"></a> Communication with Integrator suite</h3><p>Rarely, a CSB implementation needs to communicate with its integrator. Because there is no pointer on the CSB back to the integrator, a messaging system was created: <a class="el" href="class_i_concrete_selection.html#a7a6b0ac839b444d37cd5230a86e1a770">IConcreteSelection::BroadcastToIntegratorSuite</a>.<h2><a class="anchor" id="id_selection_observers"></a> Selection observers</h2><p>As described in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_change_notification">Selection change notification</a>, there are two kinds of selection change event: selection-changed event and selection-attribute-changed event. A selection observer (<a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a>) is the abstraction that allows client code to be called when a selection-changed event occurs. For more information, see the <a class="el" href="_selection_observer_8h_source.html">SelectionObserver.h</a> header file.<p>Suites that need to communicate extra data to selection observers during the selection-changed event implement a selection extension. Suites that need to include information about a selection-attribute&acirc;&#128;&#147;changed event also implement a selection extension. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_selection_extensions">Selection extensions</a>.)<p>When a selection-changed event occurs, a selection observer&#39;s <a class="el" href="class_active_selection_observer.html#a935def19f5239e5e9efa34efc2b56eb9">ActiveSelectionObserver::HandleSelectionChanged</a> member method is called. On receiving this call, an observer can take action. For example, the observer can update some data displayed in a user-interface widget. Optionally, before taking action, the observer can examine the message parameter (<a class="el" href="class_i_selection_message.html">ISelectionMessage</a>) and look for extra data placed there by a suite.<p>When a selection-attribute&acirc;&#128;&#147;changed event occurs, a selection observer&#39;s <a class="el" href="class_active_selection_observer.html#a574eca31346764d87016c49ca5f562dc">ActiveSelectionObserver::HandleSelectionAttributeChanged</a> member method is called. On receiving this call, an observer must call <a class="el" href="class_i_selection_message.html#a0f834959950b169ba0086bb620ff58cc">ISelectionMessage::WasSuiteAffected</a> before taking action. There are many kinds of selection attributes, and they can be given meaning only by the CSB suite. It examines the broadcast from the selection format that changed (originating from a command notification that the model was updated), then passes a model-independent message about the change to selection observers. A selection observer may be called when any attribute of the selected objects changes, so a selection observer can receive messages that do not affect it. The selection observer must filter these calls, so it does not needlessly take action and waste CPU cycles. For sample code, see BasicPersistInterface.<h2><a class="anchor" id="id_selection-utility_interface_iselectionutils"></a> Selection-utility interface (ISelectionUtils)</h2><p>A utility interface for selection (<a class="el" href="class_i_selection_utils.html">ISelectionUtils</a>) is provided on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>. For detailed information on the member methods, refer to the API Reference for <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a>.<p>Some member methods provided by <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a> allow you to access the active selection. Most client code does not need to depend on the active selection, because client code normally is given access to the selection manager to use. If you want the active selection, <a class="el" href="class_i_selection_utils.html#af710ece9449e7c801bdc89e684e970aa">ISelectionUtils::GetActiveSelection</a> returns the selection manager from the active context. There also are other member methods, like QueryActiveLayoutSelectionSuite and QueryActiveTextSelectionSuite, that depend on the active selection manager; these should be used only by client code that needs to work with the active selection.<h1><a class="anchor" id="id_model_and_ui_separation"></a> Model and UI Separation</h1><p>You must separate your model operations from your user-interface (UI) operations by placing them into different plug-ins. This chapter discusses this required separation.<h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>InDesign requires that model and UI components be in separate plug-ins. Plug-ins must declare whether they support model or UI operations, and model plug-ins must not depend on UI plug-ins or libraries.<p>This is required in InDesign Server, InDesign, and InCopy to support multithreading.<dl class="section note"><dt>Note<dd>In this chapter, InDesign refers to InDesign, InCopy, and InDesign Server unless otherwise noted.</dl><h2><a class="anchor" id="id_separating_model_and_ui_components"></a> Separating model and UI components</h2><p>You must separate model and user interface (UI) components into different plug-ins.<h3><a class="anchor" id="id_benefits_of_separation"></a> Benefits of separation</h3><p>This required separation offers several benefits:<ul><li>Plugs-in can safely work in background threads.<li>Classes and implementations from model plug-ins are available to multithreaded operations such as IDML export. UI plug-ins are not.<li>The user interface for a set of features can be refactored easily at any time.<li>Users can be given a model plug-in, so they can open and print documents with customized persistent data without gaining access to the ability to manipulate such features.</ul><h3><a class="anchor" id="id_declaring_a_plug-in_as_either_ui_or_model"></a> Declaring a plug-in as either UI or model</h3><p>A plug-in must identify itself as either model or UI; it cannot be both. Refer to <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_multithreading">Multithreading</a> for additional information. The plug-in type is identified in the plug-in&#39;s PluginVersion resource in its .fr file. If you do not specify either model or UI, you will get an error in the PluginVersion resource when ODFRC tries to compile your resource file.<p>To specify this, #include <a class="el" href="_plug_in_model___u_i_attributes_8h_source.html">PlugInModel_UIAttributes.h</a> in your .fr file and add a line (before the version and after the feature set) that contains kUIPlugIn or kModelPlugIn. For example, in the framelabel sample application, in FrmLbl.fr, this declares the plug-in to be a model plug-in (kModelPlugIn):<div class="fragment"><div class="line">resource PluginVersion (kSDKDefPluginVersionResourceID){</div><div class="line"> kTargetVersion,</div><div class="line"> kFrmLblPluginID,</div><div class="line"> kSDKDefPlugInMajorVersionNumber, kSDKDefPlugInMinorVersionNumber,</div><div class="line"> kSDKDefHostMajorVersionNumber, kSDKDefHostMinorVersionNumber,</div><div class="line"> kFrmLblLastMajorFormatChange, kFrmLblLastMinorFormatChange,</div><div class="line"> { kInDesignProduct, kInCopyProduct, kInDesignServerProduct},</div><div class="line"> { kWildFS },</div><div class="line"> kModelPlugIn,</div><div class="line"> kFrmLblVersion</div><div class="line">};</div></div><h3><a class="anchor" id="id_model_component_content"></a> Model component content</h3><p>The following are model components:<ul><li>Core model data (including persistent data) and preferences (on either <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> or <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).<li>Commands that modify such data.<li>Fa&Atilde;&sect;ades that call core model commands and do not make calls to UI components.<li>Selection Suites (ASB/CSBs) that operate on the model and do not make calls to UI components. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_note_about_selection_suites">Note about selection suites</a>.<li>Observers that are used for keeping other model components up to date.<li>Service providers that participate in model changes, including startup/shutdown service providers and import/export providers. (NOTE: Methods in import/export providers use the UIFlag. Make sure that the kSuppressUI mode is supported and that UI components are in other plug-ins.)<li>Any other code, such as utility classes (also called as fa&Atilde;&sect;ades or helper classes), that do not directly make calls to UI components.</ul><h3><a class="anchor" id="id_ui_component_content"></a> UI component content</h3><p>The following are UI components:<ul><li>Typical user-interface components, such as menus (action components), dialogs, dock bars, kits, panels, and rulers. This also includes observers that are attached to widgets on user-interface components, and event handlers that supplement the widget behavior.<li>Observers that are used for keeping user interfaces up to date, such as ActiveSelectionObservers.<li>Service providers that participate in user-interface changes.<li>Commands that present a dialog.</ul><h3><a class="anchor" id="id_note_about_selection_suites"></a> Note about selection suites</h3><p>The following selection suite bosses are part of the model:<ul><li><a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a><li><a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a><li><a class="el" href="classk_layout_suite_boss.html">kLayoutSuiteBoss</a><li><a class="el" href="classk_application_default_suite_boss.html">kApplicationDefaultSuiteBoss</a><li><a class="el" href="classk_document_default_suite_boss.html">kDocumentDefaultSuiteBoss</a></ul><p>AddIns that add model suites to these bosses belong in the model. Most suites are model suites, but there are some view (UI) suites. These would be suites that operate on the user interface; for example, <a class="el" href="class_i_drag_drop_source_suite.html">IDragDropSourceSuite</a> and IEyeDropperSuite. The AddIns for such UI suites belong in the user interface.<p>When identifying whether a suite is model or UI, be careful when you see &quot;selection&quot; in a method name. For example, the <a class="el" href="class_i_text_miscellany_suite.html">ITextMiscellanySuite</a> suite has a GetFirstSelectedWord method. This method probably should be named GetFirstWord or GetFirstTargetedWord. Just because a method name contains &quot;selection&quot; does not necessarily mean that the suite is a UI suite. As n oted above, often a better word to use in the method is &quot;target,&quot; as suites operate on targeted data. One kind of target is the selection, but scripting also can target data and use suites to operate on that data. The kind of target is abstracted out of the suite.<p>Other user-interface-specific bosses to which plug-ins often add interfaces are <a class="el" href="classk_selection_interface_always_active_boss.html">kSelectionInterfaceAlwaysActiveBoss</a> and <a class="el" href="classk_abstract_layout_document_selection_boss.html">kAbstractLayoutDocumentSelectionBoss</a>. <a class="el" href="classk_selection_interface_always_active_boss.html">kSelectionInterfaceAlwaysActiveBoss</a> is a special class used only by the selection subsystem to determine which interfaces to always &quot;leave on.&quot; The <a class="el" href="classk_abstract_layout_document_selection_boss.html">kAbstractLayoutDocumentSelectionBoss</a> and the others that sub-boss from <a class="el" href="classk_abstract_selection_boss.html">kAbstractSelectionBoss</a> also are only user interface.<h2><a class="anchor" id="id_detecting_plug-ins_that_mix_model_and_ui_components"></a> Detecting plug-ins that mix model and UI components</h2><p>It is possible that your plug-in violates the requirement for separating model and UI operations, whether you are aware of the violation or not. There are three ways to detect plug-ins that mix model and UI components:<ul><li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_using_a_script">Using a script</a>.<li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_examining_your_plug_in_project_for_invalid_links_">Examining your plug-in project for invalid links</a>.<li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_using_dumpbin">Using Dumpbin (Windows)</a>.</ul><h3><a class="anchor" id="id_using_a_script"></a> Using a script</h3><p>The debug build of InDesign Server includes an extra script provider to help determine whether any plug-ins mix model and UI components. Specifically, the script provider iterates through the object model and reports bosses that aggregate interface implementations with well-known user-interface-related IIDs, which include the following:<ul><li>IID_IACTIONCOMPONENT<li>IID_ICONTROLVIEW<li>IID_IDIALOGCONTROLLER<li>IID_IDIALOGCREATOR<li>IID_IDRAGDROPSOURCE<li>IID_IDRAGDROPTARGET<li>IID_ILAYOUTACTION<li>IID_ISELECTIONFILTER<li>IID_ISNAPTOSERVICE<li>IID_ISPRITE<li>IID_ITIP<li>IID_ITOOL<li>IID_ITOOLREGISTER<li>IID_ITRACKER<li>IID_ITRACKERFACTORY<li>IID_ITRACKERREGISTER<li>IID_IWIDGETCREATOR</ul><p>This script provider adds the following read-only properties to the Application script object, exclusively in the debug build:<ul><li>modelpluginswithui<li>pluginswithui<li>uipluginswithmodel</ul><p>For more information on scripting objects that you can use for testing, and for sample scripts, see &quot;Scripting objects you can use for testing&quot; in the &#39;Getting Started&#39; guide.<h3><a class="anchor" id="id_examining_your_plug_in_project_for_invalid_links_"></a> Examining your plug-in project for invalid links</h3><p>Check your model plug-in project for the following links, remove them if they exist, and rebuild the plug-in project:<ul><li>On Windows, do not link to WidgetBin.lib.<li>On Mac OS &reg;, do not link to InDesignModelAndUI; instead, you can use InDesignModel.</ul><p>If you get linker errors, modify your code to remove dependencies on these user-interface-related components.<h3><a class="anchor" id="id_using_dumpbin"></a> Using Dumpbin (Windows)</h3><p>If you are developing a plug-in for Windows, you can use Dumpbin to see whether your plug-in (.pln file) imports any symbols from WidgetBin.dll. DUMPBIN is installed with Microsoft &reg; Visual Studio 2017. To locate it, run the appropriate command prompt for VS 2017 based on your system, and then navigate to folder VCToolsInstallDir%. Then go to sub-folder bin[Hostx86 or Hostx64][x86 or x64].<p>For more information, type &quot;dumpbin /?&quot; after opening above mentioned command window and going to the appropriate folder.<h3><a class="anchor" id="id_problems_when_mixing_model_and_ui"></a> Problems when mixing model and UI</h3><p>When InDesign Server launches, it will not load any model plug-in that links against InDesignModelAndUI or WidgetBin. However, InDesign Server cannot detect the following situations and will therefore load them; this causes severe runtime problems, including crashes or corrupt documents:<ul><li>Model plug-ins that instantiate or inherit from bosses provided by UI plug-ins.<li>Model plug-ins that attempt to reuse UI implementations</ul><p>When InDesign Server tries to load a plug-in with UI components, you might see warning messages on the console window or log at startup, or asserts might be raised when you try to instantiate it or use it. For example, if a boss named kCHDMPanelWidgetBoss in your plug-in inherits from <a class="el" href="classk_palette_panel_widget_boss.html">kPalettePanelWidgetBoss</a> in the WidgetBin plug-in:<ul><li>Could not find parent class WidgetPrefix + 23 (0x617) to get inherited interfaces!<li>Error in Class 0x47f04 (294660), kCHDMPanelWidgetBoss, the class&#39;s Parent with Class ID 0x617 (1559) doesn&#39;t Exist</ul><p>Because the WidgetBin plug-in is not available in the InDesign Server object mode or background threads, the object model cannot set up this boss properly and you might get asserts or other problems.<h2><a class="anchor" id="id_conversion_issues"></a> Conversion issues</h2><p>If you are converting existing plug-ins that mix model and UI components, follow the instructions in the preceding sections and then review this section.<h3><a class="anchor" id="id_note_about_moving_actionids"></a> Note about moving ActionIDs</h3><p>If you have model and UI components in the same plug-in, the easiest way to separate the components into different plug-ins is to leave the model components in the existing plug-in and move the UI components to a new plug-in.<p>If you move your UI components to a new plug-in (with a new plug-in prefix ID), the ActionIDs should move with the components. This means that the value of ActionIDs changes. Some ActionIDs are hard-coded in keyboard shortcut files (if you ship them), so when you change the value of an ActionID, each keyboard shortcut file that maps that ID to a shortcut needs to be fixed. You can do this on an action-by-action basis, using the InDesign keyboard shortcut editor.<h3><a class="anchor" id="id_moving_persistent_data_from_ui_plug-ins_to_model_plug-ins_"></a> Moving persistent data from UI plug-ins to model plug-ins</h3><p>This section provides general guidelines for data conversion. For details on data conversion, see <a class="el" href="id_solutions.html#id_versioning_persistent_data">Versioning Persistent Data</a>.<p>If you are moving UI operations out of a model plug-in into a new UI plug-in&ndash;which is the recommended strategy&ndash;you most likely will not need to do any data conversion. If, however, you have model data in a UI plug-in that you want to move out, here&#39;s the process for doing so.<p>Moving persistent data from a UI plug-in to a model plug-in is fairly straightforward, as long as all previous conversions were handled by schemas. Even if the UI plug-in contains code conversions, this is not difficult after you understand the steps. The following steps apply only if code converters need to be moved from a UI plug-in to a model plug-in.<p>Mainly, the conversion manager needs to be notified of the conversion change to both the UI plug-in and the model plug-in. To convert the data:<ol type="1"><li>Preserve the original IDs of the persistent data in the UI plug-in&#39;s *ID.h file, by appending _Obsolete to the name.<li>Move the IDs for the persistent data from the UI plug-in to the model plug-in and renumber to match the IDs in the destination plug-in.<li>In the UI plug-in&#39;s *ID.h file, increment the conversion version number so that the PluginVersion resource is changed. If this is the first conversion required for InDesign, it would look something like this: <div class="fragment"><div class="line"><span class="preprocessor">#define kMoveClippingPathSettingsToModel kFiredrakeInitialMinorFormatNumber</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define kClippingDlgLastFiredrakeFormatChange kMoveClippingPathSettingsToModel</span></div><div class="line"><span class="preprocessor"></span><span class="comment">// These things control the plug-in&#39;s conversion schemas</span></div><div class="line"><span class="preprocessor">#define kClippingDlgLastMajorFormatChange kFiredrakeMajorFormatNumber</span></div><div class="line"><span class="preprocessor">#define kClippingDlgLastMinorFormatChange kClippingDlgLastFiredrakeFormatChange</span></div></div><li>Increment the conversion number of the model plug-in in the same manner, using a similar but unique identifier. We suggest appending &quot;ToModel&quot; to the ID in the UI conversion *ID.h file and &quot;FromUI&quot; to the ID in the model conversion *ID.h file. In this example, it would be &quot;kMovePreferencesFromUI&quot; in the model conversion *ID.h file. This matters in cases when the UI and model plug-ins have different numbers of minor conversions. These two identifiers are used in the rest of this procedure in different places. It is important to use the correct one in each place.<li>If the UI plug-in contains code converters, move them to the model plug-in. These converters are just service providers, which are nonpersistent. You can move the class and implementation definitions as well as the IDs, just like you would any other nonpersistent boss.<li>For the code converters that you moved in the previous step, modify the code converters (the C++ classes that derive from <a class="el" href="class_c_conversion_provider.html">CConversionProvider</a>) by renaming the object-model IDs that you obsoleted in step 1 to the obsoleted version. You will need to include the UI conversion ID header file to get access to these. Typically, these IDs are used in the ConvertTag and ShouldConvertImplementation methods. An example follows. Note the use of kClipSettingsImpl_Obsolete instead of kClipSettingsImpl. <div class="fragment"><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> Clip_ConversionProvider::ConvertTag(<a class="code" href="class_i_d_type.html">ImplementationID</a> tag, <a class="code" href="class_i_d_type.html">ClassID</a> forClass, int32 conversionIndex, int32 inLength, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* inStream, <a class="code" href="class_i_p_m_stream.html">IPMStream</a>* outStream, IterationStatus whichIteration)</div><div class="line">{</div><div class="line"><span class="keywordflow">if</span> (conversionIndex == kSaveClipTypeChgIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">switch</span> (tag.Get())</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> kClipSettingsImpl_Obsolete:</div><div class="line"><span class="keywordflow">if</span> (inLength &gt; 0)</div><div class="line"> ConvertClipSettings(inStream, outStream);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> } </div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> (tag);</div><div class="line">}</div></div><li>In the model plug-in&#39;s other schema resource, add a null conversion. Most plug-ins will not have an OtherSchemaFormatNumber resource; you will need to create one. This resource lets you add a null conversion for a plug-in other than the one containing the resource. This is required here rather than in the UI plug-in, because the UI plug-in will not exist in the server product. The null conversion is needed because we incremented the version number of the UI plug-in. An example follows. Note the use of the minor version ID defined in the UI plug-in&#39;s conversion ID header file. <div class="fragment"><div class="line"><span class="comment">// SchemaFormatNumber - Define null conversions</span></div><div class="line">resource OtherSchemaFormatNumber(2)</div><div class="line">{</div><div class="line"> {</div><div class="line"> kClippingDlgPluginID,</div><div class="line"> { kFiredrakeMajorFormatNumber, kMoveClippingPathSettingsToModel },</div><div class="line"> }</div><div class="line">};</div></div><li>Note that the plug-in ID used here, kClippingDlgPluginID, should be the plug-in ID of the UI plug-in. It is the ID of the plug-in for which we are defining the null conversion.<li>For each code converter moved in step 5 that contains a code-null-converter, define a null converter in the OtherSchemaFormatNumber created in the previous step 8. A code-null-converter is a code converter that defines a conversion by returning a version number y from its GetNthConversion method, but then returns <a class="el" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a5a6f8b581d3b920823f698cd56f86af6">IConversionProvider::kNothingToConvert</a> from all of the ShouldConvert methods for version number y. The version number used in the OtherSchemaFormatNumber should be the one used in the code converter. For example, in the following GetNthConversion method implementation, two code conversions are defined. The later one is a null conversion. <div class="fragment"><div class="line"><span class="keywordtype">void</span> Clip_ConversionProvider::GetNthConversion(int32 n,<a class="code" href="class_version_i_d.html">VersionID</a>* fromVersion, <a class="code" href="class_version_i_d.html">VersionID</a>* toVersion)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line"><span class="keywordflow">switch</span> (n)</div><div class="line"> {</div><div class="line"><span class="comment">// Added eyedropper target to definition</span></div><div class="line"><span class="keywordflow">case</span> kSaveClipTypeChgIndex: </div><div class="line"> *fromVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kClippingDlgPluginID, kK2MajorFormatNumber, kLastK2MinorVersionNumber);</div><div class="line"> *toVersion = <a class="code" href="class_version_i_d.html">VersionID</a> (kClippingDlgPluginID,</div><div class="line"> kSherpaMajorFormatNumber, kSherpaClippingChanged);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="comment">// ID 1.0J changed our version number (no changes to be made)</span></div><div class="line"><span class="keywordflow">case</span> kHotakaRenumberChgIndex:</div><div class="line"> *fromVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kClippingDlgPluginID, </div><div class="line"> kSherpaMajorFormatNumber,kSherpaClippingChanged);</div><div class="line"> *toVersion = <a class="code" href="class_version_i_d.html">VersionID</a>(kClippingDlgPluginID,</div><div class="line"> kHotakaMajorFormatNumber,kHotakaInitialMinorFormatNumber);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line">}</div><div class="line"><a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12">IConversionProvider::ConversionStatus</a> Clip_ConversionProvider::ShouldConvertImplementation(</div><div class="line"><a class="code" href="class_i_d_type.html">ImplementationID</a> implID, <a class="code" href="class_i_d_type.html">ClassID</a> context, </div><div class="line"> int32 conversionIndex <span class="comment">// Which converter is being evaluated</span></div><div class="line">)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line"><a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12">IConversionProvider::ConversionStatus</a> conversionStatus = <a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a5a6f8b581d3b920823f698cd56f86af6">IConversionProvider::kNothingToConvert</a>;</div><div class="line"><span class="keywordflow">if</span> (conversionIndex == kSaveClipTypeChgIndex)</div><div class="line"> {</div><div class="line"><span class="keywordflow">switch</span> (implID.Get())</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> kClipSettingsImpl_Obsolete:</div><div class="line"><span class="comment">// Always convert because these are containers </span></div><div class="line"> conversionStatus = <a class="code" href="class_i_conversion_provider.html#a6a6635b8113bf929766c6d84181b3b12a61e7e6af49fbe9dbe85a114d08a23e02">IConversionProvider::kMustConvert</a>;</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> (conversionStatus);</div><div class="line">}</div></div><li>Now that we identified that the conversion from kSherpaMajorFormatNumber, kSherpaClippingChanged to kHotakaMajorFormatNumber, kHotakaInitialMinorFormatNumber) is a null conversion, we add the &quot;to&quot; version number to the OtherSchemaFormatNumber resource: <div class="fragment"><div class="line">resource OtherSchemaFormatNumber(2) {</div><div class="line"> {</div><div class="line"> kClippingDlgPluginID, </div><div class="line"> { kHotakaMajorFormatNumber, kHotakaInitialMinorFormatNumber },</div><div class="line"> kClippingDlgPluginID, </div><div class="line"> kFiredrakeMajorFormatNumber, kMoveClippingPathSettingsToModel },</div><div class="line"> }</div><div class="line">};</div></div><li>In the model plug-in&#39;s schema resource, for each implementation moved, add a MoveImplementation conversion. This describes where the data came from and what its new ID is. This is why we need to preserve the original ID with the _Obsolete appendix. An example follows: <div class="fragment"><div class="line">{</div><div class="line"> MoveImplementation</div><div class="line"> {</div><div class="line"> kClipSettingsImpl_Obsolete, </div><div class="line"> kClippingDlgPluginID, </div><div class="line"> { kHotakaMajorFormatNumber, kHotakaInitialMinorFormatNumber },</div><div class="line"> kClipSettingsImpl, </div><div class="line"> { kFiredrakeMajorFormatNumber, kMoveClippingPathSettingsFromUI }</div><div class="line"> }</div><div class="line">},</div></div><li>Because the UI plug-in now contains no data as far as the conversion manager is concerned, and because on the server the UI plug-in will not exist, we need to tell the conversion manager that the UI plug-in was removed, as far as persistent data is concerned. To do this, add a RemovePlugin directive to the model plug-in, as shown below: <div class="fragment"><div class="line">{</div><div class="line"> RemovePlugin</div><div class="line"> {</div><div class="line"> { kFiredrakeMajorFormatNumber, kMoveClippingPathSettingsFromUI },</div><div class="line"> kClippingDlgPluginID,</div><div class="line"> { }</div><div class="line"> { }</div><div class="line"> }</div><div class="line">}</div></div><li>The version number in the remove plug-in directive is the version number of the plug-in that the directive is in when the plug-in being removed was removed. Here, we use the model plug-in version number we created in step 4 and the plug-in ID of the plug-in being removed. Both the classes and implementations removed section are empty. We did not remove them; we moved them.</ol><h1><a class="anchor" id="id_multithreading"></a> Multithreading</h1><p>This chapter describes how InDesign and InCopy use multithreading and explains how to ensure that your plug-ins are thread safe.<p>This chapter covers the following:<ul><li>The purpose of multithreading<li>What multithreading is<li>Model-based multithreading in InDesign<li>Which InDesign features use multithreading<li>Coding and testing your plug-in to ensure thread safety</ul><h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>This section defines multithreading and explains its purpose<h3><a class="anchor" id="id_background"></a> Background</h3><p>Not long ago, application developers could count on improvements in performance because radically faster CPUs regularly became available. For decades, processors (CPUs) increased in speed exponentially, doubling roughly every two years. Presently, CPU makers are facing limitations that make it difficult or impossible to continue to improve CPU speeds at this rate. The complexity of applications and the need to continue to sell CPUs call for improved performance.<p>CPU makers are now attempting to improve performance by adding multiple cores. A multicore machine has multiple processing units, meaning that it is essentially a multiprocessor machine. Machines with two, four, or eight cores are now commonly seen. It is reasonable to expect to see machines with many more cores. These machines may be referred to as many-core machines, and they very well might ship with hundreds of cores.<p>While the old processor improvements helped any application to run faster, improving performance by adding processors is highly dependent on whether software is written to take advantage of the separate processors. Most applications, including prior versions of InDesign, have not been designed to do this. The challenge for application developers now is to take advantage of multiple processors within a single application. In some sense, it is similar to the change that takes place when a company grows from a one-man operation to one with numerous employees.<h3><a class="anchor" id="id_what_is_multithreading"></a> What is multithreading?</h3><p>Multithreading is a way of simultaneously executing multiple software operations within the same program. Each such operation is said to occur in a separate thread. Threads can operate on data that is global (shared with other threads) or local (specific to the thread).<p>Computers with multiple processors can simultaneously execute multiple threads. In most cases, there will be more threads of execution than processors. Where fewer processors exist than threads of execution, the operating system suspends and revives threads as necessary. More available processors ultimately equals more available processing time.<h3><a class="anchor" id="id_why_multithreading_"></a> Why multithreading?</h3><p>Multithreading allows InDesign to take advantage of multiple processors. This provides opportunities to improve performance and responsiveness.<h3><a class="anchor" id="id_terminology"></a> Terminology</h3><dl class="section note"><dt>Note<dd>InDesign means the InDesign and InCopy desktop applications. These applications make use of multithreading; InDesign Server does not.</dl><p>In general:<ul><li>Synchronous processing means that operations take place in a specific sequence; if separate processes occur, one must wait for another to complete before it can do anything.<li>Asynchronous processing means that multiple operations can occur simultaneously, and some operations might be able to continue without waiting for other operations to complete. This implies multithreaded execution with one or more tasks running on a background thread.<li>A model is a collection of objects that are backed by a database for persistent storage. InDesign includes several models, including document models, session models, book models, and several others; for more information, see the discussion on models in the &quot;Concepts&quot; section of <a class="el" href="id_solutions.html#id_commands">Commands</a>.<li>Model operations are operations that affect the content of a model.</ul><h2><a class="anchor" id="id_multithreading_in_indesign"></a> Multithreading in InDesign</h2><p>This section describes the InDesign approach to multithreading.<h3><a class="anchor" id="id_overview_of_model-based_multithreading"></a> Overview of model-based multithreading</h3><p>Multithreading for InDesign focuses on model operations because this yields the greatest impact on performance. This approach leans heavily on the InDesign database and requires model/user interface (UI) separation, a practice previously required only by InDesign Server.<p>To support model-based threading, InDesign has a means for multiple threads to operate on a single InDesign database. This mechanism is called database and merging. It allows the document database to be cloned at a particular point, operated on by a background thread, and, if necessary, merged back into the actual database. While this capability is not publicly exposed in the InDesign SDK, it is important to understand because all model code can be called by background threads. It is your responsibility when developing plug-ins to ensure that your code is thread safe.<p>Most InDesign execution occurs on the main thread. This includes all user interactions and launching the product. It is in the main thread that InDesign responds to typing and mouse events. It is also in the main thread that changes to a document become visible. Both model and UI operations can be carried out in the main thread.<p>Any additional thread is referred to as a background thread. Background threads have no access to object-model constructs that come from UI plug-ins. They are limited to model operations and thus resemble instances of InDesign Server. Model operations are equivalent whether run on the main thread or a background thread; they must produce the same results in either case.<h3><a class="anchor" id="id_features_that_use_multithreading"></a> Features that use multithreading</h3><p>InDesign applies multithreading to only the following features:<ul><li>Updating the status of links in a document. This is carried out asynchronously. Link status is always updated when a document is opened. If the &quot;Check Links Before Opening Document&quot; preference is off, the update occurs asynchronously; the document becomes available to the user immediately without waiting for links to be updated. If the preference is on, the updates are made synchronously; any outstanding updates are completed before the document becomes available to the user. In both cases, additional link updates continue asynchronously as long as the document remains open. This is described as lightweight because such background threads merely gather information. No changes are made to the document on background threads.<li>PDF (print) export. All InCopy PDF exports take place on the main thread. InDesign exports can be carried out synchronously (on the main thread) or asynchronously (each on its own background thread). By default, the InDesign Export UI exports PDF asynchronously. When exporting PDF from InDesign via scripting or the C++ API, you can control whether export occurs synchronously or asynchronously. See &quot;Asynchronous exports&quot;.<li>IDML export. This can be carried out synchronously or asynchronously. The Export UI exports IDML asynchronously. When exporting IDML via scripting or the C++ API, you can control whether export occurs synchronously or asynchronously. See &quot;Asynchronous exports&quot;<li>InCopy Save All. This uses multiple background threads when more than one InCopy story needs to be saved. Multiple stories are distributed among several threads, but each story is processed in a single thread (not split among threads). The entire operation is synchronous in that it waits until all threads are complete before control returns to the user.<li>InCopy Save. This occurs on a background thread.</ul><p>While this list isn&#39;t large, keep the following in mind:<ul><li>Model plug-ins are called by background threads during export. Export exercises nearly every model plug-in, including yours.<li>Expect Adobe to add additional asynchronous operations in the future.</ul><h3><a class="anchor" id="id_effect_on_indesign_s_behavior"></a> Effect on InDesign&#39;s behavior</h3><p>Multithreading has several effects on InDesign&#39;s behavior:<ul><li>InDesign must postpone certain user actions until all background threads complete. In particular, quitting, closing, and reverting are postponed until all background operations are complete. As an alternative, the user can cancel the foreground action.<li>InDesign&#39;s capacity to run background threads is based on the number of processors present and the available memory. InDesign may queue requests if the required resources are unavailable or are insufficient for optimal performance.<li>Background threads cannot directly report to the user on progress, success, or errors. These are presented in the Background Tasks panel. Also, an animation appears in the application bar when background tasks are in progress, and a Background Task Alert might appear when a background task needs to convey a message to the user.<li>Activity on background threads can have a negative impact on the performance of the main thread. This depends on the number of background thread operations, processor availability, physical memory, and storage.</ul><h2><a class="anchor" id="id_ensuring_thread_safety_in_your_plug-in_"></a> Ensuring thread safety in your plug-in</h2><p>Ensuring thread safety is the process of following the rules that make plug-in code safe to run in the InDesign multiple-threaded environment. As a plug-in developer, this is where you will spend your time supporting multithreading. All model code must be made thread safe. (UI operations always run on the main thread. They do not have to be made thread safe.)<p>This section provides an overview and detailed steps on how to make your plug-in thread safe.<h3><a class="anchor" id="id_rules_for_thread_safety"></a> Rules for thread safety</h3><p>InDesign&#39;s multithreading environment provides a separate execution context (a cloned copy of the database) for each thread. Making a plug-in thread safe amounts to making all components safe to be instantiated and operated on by multiple threads simultaneously.<dl class="section note"><dt>Note<dd>You must ensure that your plug-ins are thread safe. If you don&#39;t, InDesign will behave inconsistently and may randomly crash.</dl><p>Threads do not share object-model instances. They do share globals and statics, so a big part of your effort is removing or synchronizing such variables.<p>The following rules summarize what plug-in developers must do to support multithreading:<ul><li>Separation of model and UI operations is now mandatory. A plug-in must declare whether it provides model support or user-interface (UI) support. Object-model constructs (bosses and implementations) provided by model plug-ins can be instantiated by background threads. Constructs from UI plug-ins cannot be instantiated on background threads; if you try to do so, the system behaves as if the plug-in were missing and returns a nil pointer. It is critical that you write model code that expects to be able to receive nil pointers if it queries bosses that are provided by a UI plug-in. For information on declaring model or UI support, see id_model_and_ui_seperation.<li>All model plug-ins must be made thread safe. This amounts to eliminating or synchronizing global and external resources as described later in this chapter. (Because UI plug-ins are called only from the main thread, thread safety is not an issue.)<li>Third-party code using its own background threads must not operate on InDesign object-model constructs from those threads. Object-model operations are thread safe only when using the internal database cloning and merging mechanism discussed earlier in &quot;Overview of model-based multithreading&quot;. This mechanism is internal and is not directly exposed to third-party developers. Bypassing this mechanism results in crashes, document corruption, and/or unpredictable behavior because multiple threads would be sharing the same execution context. InDesign&#39;s model requires each thread to have its own execution context (and cloned database).<li>Service providers must now declare whether they are available on background threads. This is done using the <a class="el" href="class_i_k2_service_provider.html#a777c6b69e8db8cff259e4b263e7aa087">IK2ServiceProvider::GetThreadingPolicy()</a> method. You must call and implement service providers with this in mind. For details, see &quot;Threading and service providers&quot;.<li>Startup/shutdown services can now be called on application and/or thread start-up. This is specified using a ServiceID. For details, see &quot;Threading and startup/shutdown services&quot;. Make sure that your service is using the appropriate ID.<li>All libraries that are used by plug-in code must be thread safe. For example, InDesign uses the thread-safe versions of all Boost libraries.</ul><h3><a class="anchor" id="id_thread_safety_porting_and_development_procedures"></a> Thread safety porting and development procedures</h3><p>We recommend the following steps for porting plug-ins from prior versions of InDesign or developing new plug-ins to support multithreading:<ol type="1"><li>Read about &quot;Thread-safe coding constructs&quot;.<li>If you have not already done so, enforce complete model/UI separation on all your plug-ins as described in id_model_and_ui_seperation, &quot;Model and UI Separation.&quot; Use the original prefix ID in the model plug-in, and acquire a new prefix ID for the UI components.<li>Update your PlugInVersion resource as described in &quot;Separating model and UI components&quot; in id_model_and_ui_seperation.<li>Do enough nonmultithreading porting to get your plug-ins compiling.<li>Review &quot;Threading and service providers&quot; and make sure that your code follows those rules. Note:<ul><li>Ensure that your service providers are available on background threads if necessary.<li>Most significant service providers are available on background threads, but some service providers reside in a UI plug-in, hence are not available on background threads. Ensure that your model code does not rely on any UI service providers, or ensure that these service providers are moved to model plug-ins.</ul><li>Review &quot;Threading and startup/shutdown services&quot; and make sure that your code meets the requirements. Note:<ul><li>Decide whether your startup/shutdown services need to be called on application and/or thread startup and shutdown. Use the appropriate service-provider implementation. In most cases, your code will be application specific, so you will most often use kCAppStartupShutdownProviderImpl.</ul><li>Run the Statics Reporter tool on your plug-ins. This tool detects and reports the use of any global or static variables in your plug-in. Running the tool requires some configuration. You also should be aware that the tool makes use of some naming conventions to filter results. See &lt;SDK&gt;/devtools/statics_reporter/ReadMe.txt for details about setting up and executing the Statics Reporter tool.<li>Remove any globals and statics that you can. Some variables are acceptable: statically initialized const variables are fundamentally safe, but other global variables that change state are not safe. Such variables can be used to optimize performance, but they often are used just for convenience; often, such code can be efficiently rewritten without a global variable. Regardless, the fact that such code can run on multiple threads fundamentally changes the execution scenario.<li>Remove any function-local static variables. Substitute globals in an anonymous namespace with appropriate synchronization, or use nonstatic const objects.<li>Certain globals will be difficult or impossible to remove, so some synchronization will be required. Study the threading APIs and libraries, and use the appropriate constructs to make your code thread-safe. For your convenience, we include several thread safety recipes; see &quot;Thread-safety recipes&quot;.<li>If necessary, apply the same synchronization techniques to your use of external resources, such as files. For example, if your plug-in writes to an external text file, use the described synchronization strategies to ensure that only one thread writes to it at a time.<li>Launch the debug version of InDesign with your plug-in present. Fix any asserts or error messages related to multithreading. In particular, fix violations of object-model rules reported on startup, as described in &quot;Object-Model Rules&quot;.<li>Follow the guidance in &quot;Testing for thread safety&quot;.</ol><h3><a class="anchor" id="id_object-model_rules"></a> Object-Model Rules</h3><p>Refer to the rules in this section while developing plug-ins to ensure that your plug-in is thread safe.<p><b>A model boss cannot derive from a UI boss</b><p>For example:<div class="fragment"><div class="line"><span class="comment">// In model plugin Foo, foo.fr file</span></div><div class="line">Class{</div><div class="line"> kMyModelFooBoss,</div><div class="line"> kSomeUIBoss, <span class="comment">// defined in MyUIPlugin</span></div><div class="line"> {</div><div class="line"><span class="comment">// interfaces</span></div><div class="line"> }</div><div class="line">}</div></div><p>This code generates the following assert on startup:<div class="fragment"><div class="line">Class kMyModelFooBoss is defined in a model plugin (Foo.apln) but derives from class kSomeUIBoss which is defined in a UI plugin (MyUIPlugin.apln)! This is not allowed because the main thread and worker threads will behave differently!</div></div><p><b>Model plug-ins cannot refer to classes or implementations in UI plug-ins</b><p>Model plug-ins must not depend on UI classes or implementations. For example:<div class="fragment"><div class="line"><span class="comment">// In model plugin Foo, foo.fr file</span></div><div class="line">Class</div><div class="line">{</div><div class="line"> kMyModelFooBoss,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IMYUIINTERFACE, kMyUIInterfaceImpl <span class="comment">// defined in MyUIPlugin</span></div><div class="line"> }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// OR:</span></div><div class="line">AddIn</div><div class="line">{</div><div class="line"> kMyModelFooBoss,</div><div class="line"> {</div><div class="line"> IID_IMYUIINTERFACE, kMyUIInterfaceImpl <span class="comment">// defined in MyUIPlugin</span></div><div class="line"> }</div><div class="line">}</div></div><p>These two scenarios generate the following assert on startup:<div class="fragment"><div class="line">Model plugin Foo.apln is attempting to use UI <span class="keyword">interface </span>implementation kSomeUIImpl provided by plugin kMyUIPlugin in class kMyModelFooBoss. A UI interface implementation can be added to a model boss only via the AddIn directive in a UI plugin resource, and that implementation will not be present in the boss when running in a background task.</div></div><p><b>UI classes derived from a model class cannot override model implementations in the base class</b><p>Allowing such an override would result in different boss definitions in the main and background threads. For example:<div class="fragment"><div class="line"><span class="comment">// in GenericClass.fr (model plugin):</span></div><div class="line">Class</div><div class="line">{</div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>, <span class="comment">// subclasses page item</span></div><div class="line"><a class="code" href="classk_page_item_boss.html">kPageItemBoss</a>,</div><div class="line"> {</div><div class="line"> ... <span class="comment">// a bunch of interfaces</span></div><div class="line"> IID_IPLACEBEHAVIOR, kCGraphicPlaceBehaviorImpl,</div><div class="line"> }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// in epsclass.fr (model plugin):</span></div><div class="line">Class</div><div class="line">{</div><div class="line"><a class="code" href="classk_in_design_page_item_boss.html">kInDesignPageItemBoss</a>, <span class="comment">// subclasses drawable page item</span></div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>,</div><div class="line"> {</div><div class="line"> ... <span class="comment">// a bunch of interfaces</span></div><div class="line"> }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// in ImportExportUIClass.fr (UI plugin):</span></div><div class="line">AddIn</div><div class="line">{</div><div class="line"><a class="code" href="classk_in_design_page_item_boss.html">kInDesignPageItemBoss</a>, <span class="comment">// overrides base class interface implementation</span></div><div class="line"> kInvalidClass</div><div class="line"> {</div><div class="line"> IID_IPLACEBEHAVIOR, kInDesignDocPlaceBehaviorImpl,</div><div class="line"> }</div><div class="line">}</div></div><p>This situation is detected at startup and you get the following error message in a dialog box:<div class="fragment"><div class="line">Add-in <span class="keyword">class </span><a class="code" href="classk_in_design_page_item_boss.html">kInDesignPageItemBoss</a> defined in UI plugin IMPORT EXPORT UI.RPLN overrides model implementation kCGraphicPlaceBehaviorImpl in parent class <a class="code" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a> from model plugin GENERIC PAGE ITEM.RPLN! This is not allowed because the class will have a different behavior on main thread than on the other threads! The override will be ignored.</div></div><h3><a class="anchor" id="id_threading_and_service_providers"></a> Threading and service providers</h3><p>There are some thread-safety concerns when calling and implementing service providers. Some service providers are available on both the main and background threads, while others are available only on the main thread. To facilitate this, <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> now contains a method called GetThreadingPolicy(). Implementations of <a class="el" href="class_i_k2_service_provider.html#a777c6b69e8db8cff259e4b263e7aa087">IK2ServiceProvider::GetThreadingPolicy()</a> can return either<ul><li>kMainThreadOnly, indicating that the service is limited to the main thread.<li>kMultipleThreads, indicating that the service provider is available on both the main and background threads.</ul><p>Like all boss objects, service providers that are implemented in UI plug-ins are not available on background threads. Such implementations should return kMainThreadOnly; they should never return kMultipleThreads. Violating this causes an assert in the debug build.<p>The SDK includes <a class="el" href="class_c_service_provider.html">CServiceProvider</a>, a default implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. <a class="el" href="class_c_service_provider.html">CServiceProvider</a> is the standard base class for service providers. It provides a default implementation of GetThreadingPolicy that returns a threading policy based on the plug-in in which the service provider boss resides. If the boss comes from a UI plug-in, it returns kMainThreadOnly. If the service is in a model plug-in, it returns kMultipleThreads. A service from a model plug-in can override <a class="el" href="class_i_k2_service_provider.html#a777c6b69e8db8cff259e4b263e7aa087">IK2ServiceProvider::GetThreadingPolicy</a> and return kMainThreadOnly to restrict itself to the main thread.<p>Typically, service providers are used to identify some other extension pattern, such as a responder or startup/shutdown service. Most implementations, like kResponderServiceProviderImpl, inherit their behavior from <a class="el" href="class_c_service_provider.html">CServiceProvider</a>, although any subclass can override GetThreadingPolicy.<h3><a class="anchor" id=""></a></h3><p>Startup/shutdown services are a type of service provider. Each startup/shutdown service must provide implementations for both of the following:<ul><li><a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>, which identifies the startup/shutdown service and its threading policy.<li><a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a>, which provides the actual code to be run on startup and shutdown.</ul><p>The implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> identifies itself as a startup/shutdown service by returning kStartupShutdownService in GetServiceID() or GetServiceIDs(). As described above, it identifies a threading policy by what it returns in GetThreadingPolicy(). Returning IPlugIn::kMainThreadOnly restricts the service to startup and shutdown of the main thread. Returning IPlugIn::kMultipleThreads means the service will be called on both the main thread and background thread startup and shutdown.<dl class="section note"><dt>Note<dd>Starupt/shutdown services that are intended to work on IPlugIn::kMultipleThreads must be implemented in the model plug-ins.</dl><p>However, it is unlikely that you will need to provide a custom implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>, because the SDK includes service-provider implementations for application startup, thread startup, and a combination:<ul><li>kCMainThreadStartupShutdownProviderImpl is for startup/shutdown services that are called only on the main thread.<li>kCMTStartupShutdownProviderImpl is for startup/shutdown services that are called on the main and background thread startup and shutdown. Such startup services must reside in a model plug-in.<li>kCStartupShutdownProviderImpl derives its implementation of GetThreadingPolicy from <a class="el" href="class_c_service_provider.html">CServiceProvider</a>. If the startup/shutdown service boss resides in a model plug-in, the service will be called on both main and background thread startup and shutdown. If the boss resides in a UI plug-in, the service will be called only on main thread startup and shutdown.</ul><h3><a class="anchor" id="id_thread-safe_coding_constructs"></a> Thread-safe coding constructs</h3><p>InDesign uses several APIs and libraries to support making code thread safe. This amounts to a mixture of the Boost.Threads Library and some Adobe-authored implementations.<p><b>Boost.Threads</b><p>Before you start using the recipes and code, it is best to develop some background on writing thread-safe code outside of InDesign. The following article is a good introduction to threading with Boost. The &quot;Thread Creation&quot; section is of limited value in porting InDesign plug-ins, but the sections explaining mutexes, conditional variables, thread-local storage, and once routines are directly relevant.<ul><li>&quot;The Boost.Threads Library&quot; (May 1, 2002), <a href="http://www.drdobbs.com/cpp/184401518">http://www.drdobbs.com/cpp/184401518 </a></ul><p>(There is an update to the article that is of less value to making InDesign plug-ins thread-safe, as it deals more with managing threads.)<p>If you use Boost.Threads in your code, you must link against the correct library files in the various configurations of your project files. On Windows, use the BoostThreadLib macro that is defined in the platform-specific vsprops files (for example, DebugWin32.vsprops and Debugx64.xvsprops). The correct path is already defined for each platform; you simply have to add &quot;$(BoostThreadLib)&quot; to each of the Additional Dependencies (AdditionalDependencies in the XML) settings for the linker.<p>Mac OS projects that use the included xcconfig files are also configured to link against the correct frameworks:<div class="fragment"><div class="line">\&lt;SDK\&gt;/build/mac/debug|release/packagefolder/contents/Frameworks/boost_threads.framework</div></div><p><b>IDThreading and IDThreadingPrimitives</b><p>A handful of threading constructs are provided in Adobe-authored headers. Two files in particular provide some useful tidbits:<ul><li><a class="el" href="_i_d_threading_8h_source.html">IDThreading.h</a> declares the IDThreading namespace and provides an InDesign-specific version of thread-local storage. Thread-local storage provides thread-specific static and global variables. InDesign&#39;s version works much like the thread-local storage in Boost.Threads, but with some advantages. InDesign&#39;s thread-local storage implementation provides a virtually unlimited number of thread locals. It also provides several &quot;managed&quot; thread-local storage types, which offer advanced capabilities that are not in Boost. In Boost, thread-local storage is limited to four or eight bytes, but IDThreading&#39;s ThreadLocalManagedObject and ThreadLocalManagedArray allow you to store variable-sized objects.<li><a class="el" href="_i_d_threading_primitives_8h_source.html">IDThreadingPrimitives.h</a> provides a method that allows you to determine whether you are executing on the main thread (or a background thread). It also provides several template functions that support atomic operations (AtomicIncrement, AtomicDecrement, and CompareAndSwap). Atomic operations allow you to perform as a single operation any operations that require multiple processor instructions. This may not be obvious, but incrementing and decrementing require more than one instruction. It&#39;s possible for two threads to attempt to increment a variable at the same time. If the later thread checks the memory before the earlier thread is done incrementing, it may increment the old value and save it in memory after the earlier thread completes. This negates the earlier increment. Atomic operations prevent this from happening.</ul><h2><a class="anchor" id="id_thread-safety_recipes"></a> Thread-safety recipes</h2><p>This section describes additional situations that Adobe encountered when making InDesign and SDK samples thread safe. You may encounter these situations when developing or porting plug-in code.<h3><a class="anchor" id="id_synchronizing_an_operation"></a> Synchronizing an operation</h3><p>Synchronizing an operation amounts to preventing other threads from executing the same code. If you need to synchronize an operation, you can do so with boost::mutex. Mutex is short for mutual exclusion. It is a construct that allows you to ensure that only one thread can execute a particular piece of code at a time.<p>The basic steps are as follows:<ol type="1"><li>Add a boost::mutex variable to your .cpp file.<li>Enclose your operation in a single scope or method call.<li>Lock the mutex using a boost::mutex::scoped_lock. (The mutex will be unlocked when the variable goes out of scope.)</ol><p>See SDKODBCCache::Rebuild() for an example of using a mutex to provide exclusive access to a method that rebuilds a cache. This particular code prevents other threads from building the cache while it&#39;s under construction.<h3><a class="anchor" id="id_constructing_a_singleton_"></a> Constructing a singleton</h3><p>If your plug-in code includes a singleton object, you must ensure that it is created in a thread-safe manner, that is, to prevent more than one thread trying to simultaneously create such an object. Such an attempt could result in more than one copy of the singleton, because there is an opportunity for a second thread to create the object between the original creation of the object and when it&#39;s marked as created. This eventually results in invalid results and unpredictable behavior in your plug-in.<p>To ensure that only one thread can create a singleton, use boost::call_once to initialize the single object. This construct guarantees that a particular function can be called only once by an application, even if multiple threads reach the call_once statement simultaneously. To construct the initial singleton instance:<ol type="1"><li>Add a boost::once_flag variable to your .cpp file.<li>Create a private static method that actually initializes the private singleton data.<li>Use boost::call_once to call the initialize from the method that creates and returns an instance. This takes a pointer to the static method and the boost::once_flag.</ol><p>For sample code, see SDKODBCCache::Instance().<h3><a class="anchor" id="id_preventing_reentrancy"></a> Preventing reentrancy</h3><p>It is not uncommon for a global variable to be used as a flag to prevent reentrancy into a particular function. There are two ways to deal with this situation; which is appropriate depends on the code that calls the method:<ul><li>If you need to prevent reentrancy on a particular object, you can move the flag into the class.<li>If you need to prevent reentrancy on any instance, a member variable will not suffice. In this case, it is best to use thread-local storage.</ul><p>For an example of using thread-local storage to prevent reentrancy, see <a class="el" href="class_tran_fx_matte_factory.html#a75b9d68f6f3acdc2888810b9d2fb4a06">TranFxMatteFactory::GetPaintedBBoxWithoutMatte()</a>.<h2><a class="anchor" id="id_asynchronous_exports"></a> Asynchronous exports</h2><p>You can optionally code an InDesign plug-in or script to asynchronously export IDML and PDF. If you do this, be aware that the main thread continues to execute your code while the export continues on a background thread, so control returns to your code before the export operation is complete. Therefore, immediately after starting the export thread, your code can&#39;t do operations such as checking the results of the export or copying the exported file, because the operation might not have completed.<dl class="section note"><dt>Note<dd>InDesign allows asynchronous exports only to files, not to streams. This is due to limitations that prevent transferring streams between threads.</dl><h3><a class="anchor" id="id_asynchronous_export_with_cpp"></a> Asynchronous export with C++</h3><p>Asynchronous export from C++ is straightforward. <a class="el" href="class_i_export_provider.html">IExportProvider</a> contains methods that facilitate asynchronous file export:<ul><li>CanExportToFileAsynchronously() returns whether the export provider can export asynchronously. The only such providers are IDML and PDF export. A third-party plug-in developer cannot write an asynchronous export because that requires database cloning, which is not available to third-party developers in CC.<li>AsynchronousExportToFile() can be called on export providers that support asynchronous export.</ul><p>Export calling code typically looks something like the following:<div class="fragment"><div class="line">exportProvider-&gt;ExportToFile(file,...);</div><div class="line"><span class="keywordflow">if</span>(ErrorUtils::GetPMGlobalErrorCode() == kSuccess)</div><div class="line"> doSomething(file);</div></div><p>This continues to work for ExportToFile(), but a similar pattern when calling AsynchronousExportToFile() is incorrect. That is because the export will still be in progress on a background thread. It will not have set the global error code, so the following code is incorrect:<div class="fragment"><div class="line"><a class="code" href="class_task_info.html">TaskInfo</a> TI = exportProvider-&gt;AsynchronousExportToFile(file);</div><div class="line"><span class="comment">// PMGlobalErrorCode is unchanged because the export is still in progress</span></div><div class="line"><span class="keywordflow">if</span>(ErrorUtils::GetPMGlobalErrorCode() == kSuccess)</div><div class="line"> doSomething(file); </div><div class="line"><span class="comment">// file may not be valid yet!!</span></div></div><p>Instead, a plug-in that needs to check the status of an export must provide an export responder. (If the event is started from a script, you could use attachable events for a similar effect.) Such a responder receives notifications before export, after export, and upon export failures. Such a responder boss will include an <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> implementation that specifies one or more of the following services in GetServiceID() or GetServiceIDs():<ul><li>kBeforeExportSignalResponderService - Called before export.<li>kAfterExportSignalResponderService - Called after export.<li>kFailedExportSignalResponderService - Called on export failure and export cancellation.</ul><p>The responder would then respond to these conditions in its <a class="el" href="class_i_responder.html#a2d44b72b022abc9d650749c5b5ce463e">IResponder::Respond()</a> implementation, which is called with an <a class="el" href="class_i_signal_mgr.html">ISignalMgr</a> pointer. This object is an <a class="el" href="class_i_signal_mgr.html">ISignalMgr</a> on the <a class="el" href="classk_export_provider_signal_mgr_boss.html">kExportProviderSignalMgrBoss</a>. It can be queried for an instance of <a class="el" href="class_i_export_provider_signal_data.html">IExportProviderSignalData</a>.<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IExportProviderSignalData&gt;</a> signalData(signalMgr,<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>This interface can be used to determine useful information about the file, such as the source document or the destination file.<h3><a class="anchor" id="id_checking_and_canceling_tasks"></a> Checking and Canceling Tasks</h3><p>InDesign creates a background task for each asynchronous export. Use ITaskMonitorFacade to monitor background tasks. This facade provides methods to get a <a class="el" href="class_task_info.html">TaskInfo</a> (a class that provides information about the background task) instance for one or all background tasks. <a class="el" href="class_task_info.html#aaf5649cc3da3ee3102b0953e749c3981">TaskInfo::WaitForTask()</a> causes the caller to wait for a background task to complete. <a class="el" href="class_task_info.html#ab74f8d7b17c40c6daf823f5acced0e95">TaskInfo::Cancel()</a> cancels the background task. Cancels occur asynchronously, so code should call the appropriate wait method before continuing. ITaskMonitorFacade includes utility methods that can be used to wait for or cancel all background tasks.<h2><a class="anchor" id="id_testing_for_thread_safety"></a> Testing for thread safety</h2><p>Testing your plug-ins for thread safety takes some creativity. Your testing must cover more than simply whether your feature behaves in the UI or with scripting. You should attempt to verify that your model plug-in behaves appropriately when exercised simultaneously on the main thread and on a large number of background threads. Consider the following recommendations when testing for thread safety:<ol type="1"><li>Test with the debug build. It contains numerous thread-safety asserts. Pay attention to these asserts and fix them immediately.<li>Write a script that starts multiple IDML and/or PDF exports of large files. This should allow you to create a large queue of exports on background threads.<li>While the exports are running in the background, have the script make a change to the data model on the main thread and export, then repeat the change and export steps on the main thread repeatedly while the background threads are running.<li>Verify that all exports produce the same results and that there are no inconsistent results or crashes. Concentrate on your plug-in data.<li>Further enhance your test to include scripting changes to your feature on the main thread while many other exports are queued and running.<li>Verify that changes made in the main thread did not affect exports on background threads.<li>Verify that the changes made in the main thread exported as expected.</ol><h1><a class="anchor" id="id_layout_fundamentals"></a> Layout Fundamentals</h1><p>This chapter describes the features and supporting architecture of the layout subsystem, as well as how a client can use these features and the layout-related extension patterns in the InDesign API.<p>For use cases related to layout, see <a class="el" href="id_solutions.html#id_layout">Layout</a>.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>The following figure shows a facing-pages publication with three pages arranged over two spreads. The document is presented for edit in the layout presentation. The Pages panel is used to edit the spreads and pages, including the master spreads and master pages. The Layers panel is used to edit the layers and to list objects in the active spread.<div class="image"><img alt="plugin-programming-guide-vol1-44.gif" src="plugin-programming-guide-vol1-44.gif" /></div><p>Some basic terms are given below. A full layout-related glossary is in <a class="el" href="id_adobe_indesign_cc_tool_kit_guide.html#id_terminology">Terminology</a>.<ul><li>Document - An InDesign document, unless otherwise stated.<li>Layer - The abstraction that controls whether objects in a document are displayed and printed and whether they can be edited. A layer can be shown or hidden, locked or unlocked, arranged in front-to-back drawing order, and so on. A page item is assigned to a layer. If a layer is shown, its associated page items are drawn; if a layer is hidden, its associated page items are not drawn. Layers affect an entire document: if you alter a layer, the change applies across all spreads.<li>Layers panel -The user interface for creating, deleting, and arranging layers and for listing objects in the active spread.<li>Layout presentation - The user-interface window in which the layout of a document is presented for viewing and editing. The layout presentation contains the layout view and other widgets that control the presentation of the document within the view.<li>Master page - A page that provides background content for another page. When a page is based on a master page, the page items that lie on the master page also appear on the page. A master page eliminates the need for repetitive page formatting and typically contains page numbers, headers and footers, and background pictures.<li>Master spread - A special kind of spread that contains a set of master pages.<li>Page - The object in a spread on which page items are arranged.<li>Page item - Represents content the user creates and edits on a spread, like a path, a group, or a frame and its content.<li>Pages panel - The user interface for creating, deleting, and arranging pages and masters.<li>Spread - The primary container for layout data. A spread contains a set of pages on which page items that represent pictures, text, and other content are arranged. The pages can be kept together to form an island spread, a layout that spans more than one page.</ul><h2><a class="anchor" id="id_documents_and_the_layout_hierarchy"></a> Documents and the layout hierarchy</h2><p>This section introduces the data model on which the layout subsystem is based. The boss classes and interfaces that represent spreads, pages, and page items in a document are described in general.<h3><a class="anchor" id="id_architecture"></a> Architecture</h3><p>This section shows how the items introduced in <a class="el" href="id_adobe_indesign_cc_tool_kit_guide.html#id_concepts">Concepts</a> are represented by boss classes and interfaces in a document. The following figure shows the overall arrangement.<div class="image"><img alt="plugin-programming-guide-vol1-45.gif" src="plugin-programming-guide-vol1-45.gif" /></div><p>A document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) comprises one or more spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) and master spreads (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>). The <a class="el" href="class_i_spread_list.html">ISpreadList</a> interface lists the spreads. The <a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a> interface lists the master spreads.<p>Each spread contains one or more pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>), ruler guides (<a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>), frames (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), paths (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), or groups (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>). These objects are arranged in a spread in a tree represented by the interface <a class="el" href="class_i_hierarchy.html">IHierarchy</a>.<p>Frames and groups have additional page items nested within them.<p>The objects in a layout are layered, and this layering is reflected within each spread. A layer is represented by a document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) that has two corresponding spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) in each spread. The document layers are listed by the <a class="el" href="class_i_layer_list.html">ILayerList</a> interface; the spread layers are the immediate children of a spread on the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface.<p>A spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) contains 2n spread layers as children, where n is the number of document layers. All the immediate children of a spread must be spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>).<p>The preceding figure shows a document that has at least two layers:<ul><li>The pages layer - Pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) always are associated with the pages layer. The pages layer is represented by the document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) found at index 0 in the <a class="el" href="class_i_layer_list.html">ILayerList</a> interface. It has two corresponding spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) in each spread. The spread layer that owns the spread&#39;s pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) is found at child index 0 in the spread&#39;s hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>); the other spread layer, which is always empty, is found at child index 1.<li>A layer for content.</ul><p>The remaining layers-and there always is at least one other layer in the <a class="el" href="class_i_layer_list.html">ILayerList</a> interface-are the layers to which guides (<a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>), frames (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), paths (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), and groups (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>) can be assigned. Each of these layers is represented by a document layer that has two corresponding spread layers. When a page item is assigned to belong to a particular layer, the object becomes owned by the corresponding spread layer through <a class="el" href="class_i_hierarchy.html">IHierarchy</a>. Changes to document layers are document-wide, meaning changes to document layers affect all spreads in the document, including master spreads. For more information about layers, see <a class="el" href="id_idml_cookbook.html#id_spreads_and_pages">Spreads and pages</a>.<p>The preceding figure also shows that master spreads (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) have the same organization as spreads. A master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) contains master pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>), which provide background content for other pages. Master spreads form their own hierarchy, and each page connects to its master by the interface <a class="el" href="class_i_master_page.html">IMasterPage</a>. For more information, see <a class="el" href="id_solutions.html#id_master_spreads_and_master_pages">Master spreads and master pages</a>.<p>The key interfaces involved in the layout data model are summarized in the following table. For more information, refer to the API Reference for these interfaces.<table class="doxtable"><tr><th>Interface </th><th>Note </th></tr><tr><td><a class="el" href="class_i_document_layer.html">IDocumentLayer</a></td><td>Signature interface for a document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>). Stores a document layer&#39;s properties. Has an associated content-spread layer and guide-spread layer. </td></tr><tr><td><a class="el" href="class_i_hierarchy.html">IHierarchy</a></td><td>Connects boss objects in a tree that represents a layout hierarchy. Provides a mechanism to find parent and child objects and interfaces. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_parent_and_child_objects_and_ihierarchy">Parent and child objects and IHierarchy</a>. </td></tr><tr><td><a class="el" href="class_i_layer_list.html">ILayerList</a></td><td>List of document layers (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) in a document. A layer is represented by a <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object that has two associated <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> objects in each spread. </td></tr><tr><td><a class="el" href="class_i_master_page.html">IMasterPage</a></td><td>Stores the master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) associated with a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) and the index of the master page within the master spread on which this page is based. </td></tr><tr><td><a class="el" href="class_i_master_spread.html">IMasterSpread</a></td><td>Signature interface for a master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>). Stores the name of a master spread and contains the incremental information that defines a master spread. This information is beyond what is contained in a spread. </td></tr><tr><td><a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a></td><td>List of the master spreads (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) in a document. </td></tr><tr><td><a class="el" href="class_i_spread.html">ISpread</a></td><td>Signature interface for a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). Contains useful methods for discovering the page items that lie on a page or spread and for navigating between document layers (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) and spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>). A document is laid out as a set of spreads in which each spread contains one or more pages and other page items. </td></tr><tr><td><a class="el" href="class_i_spread_layer.html">ISpreadLayer</a></td><td>Signature interface for a spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>). A spread layer is the container for the page items in a layer through the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface on the <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>. The <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a> interface maintains a relationship back to the corresponding document layer boss (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>). </td></tr><tr><td><a class="el" href="class_i_spread_list.html">ISpreadList</a></td><td>List of the spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) in a document. </td></tr></table><p>The <a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a> code snippet can inspect the layout hierarchy. Run the snippet in SnippetRunner to create a textual report for a document. See <a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a> for sample code that examines the layout hierarchy in various ways.<h3><a class="anchor" id="id_parent_and_child_objects_and_ihierarchy"></a> Parent and child objects and IHierarchy</h3><p>A page item can contain other page items. The containing object is the parent; the contained objects are the children. Child index order defines z-order, the order in which objects draw; the child with index 0 draws first (behind), and the child with index n-1 draws last (in front). This association between page items is implemented by the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface, as shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-46.gif" src="plugin-programming-guide-vol1-46.gif" /></div><p><a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> is the abstract base class for objects that participate in the layout hierarchy. <a class="el" href="class_i_hierarchy.html">IHierarchy</a> is a required interface. Subclasses of <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> include spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>), and frames (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>). To see all subclasses, refer to the API Reference for <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a>. Each subclass of <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> may have different constraints on the number and type (boss class) of children it can contain.<p>The child objects contained within the parent are said to be nested. The following figure shows an example. The object diagram is an example of how the internal representation changes when a circle is nested inside a square using cut and paste. The parent-child association between boss objects in a layout is realized by the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. When the circle is cut, the association with its initial parent, the spread layer, is broken. When the circle is pasted, it is associated with its new parent, the square. The square becomes a frame, because it now contains the circle. The drawing of the circle is then clipped to its frame.<div class="image"><img alt="plugin-programming-guide-vol1-47.gif" src="plugin-programming-guide-vol1-47.gif" /></div><p>The low-level commands used to edit the hierarchy programmatically are <a class="el" href="classk_add_to_hierarchy_cmd_boss.html">kAddToHierarchyCmdBoss</a> and <a class="el" href="classk_remove_from_hierarchy_cmd_boss.html">kRemoveFromHierarchyCmdBoss</a>. A utility interface, <a class="el" href="class_i_hierarchy_utils.html">IHierarchyUtils</a>, provides a facade that processes these commands. For more information, refer to the API Reference.<p>The boss objects in the hierarchy illustrated above can be visited using a recursive function, as shown in the following example, which visits each child boss object in a hierarchy:<div class="fragment"><div class="line"><span class="keywordtype">void</span> VisitChildren(<a class="code" href="class_i_hierarchy.html">IHierarchy</a>* parent){</div><div class="line"> int32 childCount = parent-&gt;<a class="code" href="class_i_hierarchy.html#a83650a15e9dc70f876592f75f5f73282">GetChildCount</a>();</div><div class="line"><span class="keywordflow">for</span> (int32 childIndex = 0; childIndex &lt; childCount; childIndex++){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> child(parent-&gt;<a class="code" href="class_i_hierarchy.html#af345ca29851669d1e0917f52e6660032">QueryChild</a>(childIndex));</div><div class="line"><span class="preprocessor"> #ifdef DEBUG</span></div><div class="line"><span class="preprocessor"></span> <span class="comment">// Trace the boss class name of the child.</span></div><div class="line"> DebugClassUtilsBuffer className;</div><div class="line"> DebugClassUtils::GetIDName(&amp;className, ::GetClass(child));</div><div class="line"> TRACEFLOW(<span class="stringliteral">&quot;LayoutFundamentals&quot;</span>, <span class="stringliteral">&quot;%s\n&quot;</span>, className);</div><div class="line"><span class="preprocessor"> #endif</span></div><div class="line"><span class="preprocessor"></span> <span class="comment">// Add code to examine other interfaces on the boss object.</span></div><div class="line"> VisitChildren(child);</div><div class="line"> }</div><div class="line">}</div></div><h2><a class="anchor" id="id_spreads_and_pages"></a> Spreads and pages</h2><p>A spread is the primary container for layout data. A spread contains a set of pages on which the page items that represent pictures, text, or content of another format are arranged. A spread owns all the objects it contains, including its pages, ruler guides, frames, paths, groups, and any nested content. The objects in a spread are organized into layers, so the user can control whether the objects assigned to a layer should be displayed or editable. See the following figure for the user&#39;s perspective. The publication shown is a facing-pages document with one spread, one page, and one layer.<div class="image"><img alt="plugin-programming-guide-vol1-48.gif" src="plugin-programming-guide-vol1-48.gif" /></div><p>The following is an object diagram showing the layout-related boss objects that exist in a publication containing a ruler guide and graphic frame on a page. The sample document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) contains a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), page (<a class="el" href="classk_page_boss.html">kPageBoss</a>), graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), and ruler guide (<a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>). The content of the spread is layered on spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) that map onto corresponding document layers (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>). There are two document layers (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>), the pages layer and layer 1. The page, graphic frame, and ruler guide are arranged on spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) under the spread&#39;s <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface.<div class="image"><img alt="plugin-programming-guide-vol1-49.gif" src="plugin-programming-guide-vol1-49.gif" /></div><p>A layer is represented by a <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object with two corresponding <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> objects in each spread.<p>The pages layer is the layer to which pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) are assigned. In the figure, the pages layer is represented by the <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object named &quot;pages&quot; and the <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> objects named &quot;pages&quot; and &quot;private.&quot; The pages document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) always is at index 0 in the layer list (<a class="el" href="class_i_layer_list.html">ILayerList</a>). The first child on the spread&#39;s hierarchy always is the associated page&#39;s spread layer and contains the spread&#39;s pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>). The second child of the spread is a private spread layer that always is empty. Pages are drawn behind all other objects, because they always are stored on the spread&#39;s hierarchy at child index 0. Note that the pages layer is not shown in the Layers panel.<p>In the preceding figure, Layer 1 is represented by the <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object layer1. It has two corresponding spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) on the spread&#39;s hierarchy:<ul><li>One for content: layer1-content, which stores the graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>).<li>One for ruler guides: layer1-guides, which stores the ruler guide.</ul><p>The order of these spread layers can vary, depending on whether guides are being drawn behind or in front of content. The preceding figure illustrates the order when guides are drawn in front of content.<dl class="section note"><dt>Note<dd>Child index order in <a class="el" href="class_i_hierarchy.html">IHierarchy</a> defines z-order, the order in which objects on those spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) draw. The child with index 0 draws first (behind); the child with index n-1 draws last (in front).</dl><p>The code in the following example visits each child boss object of the spread shown in the preceding figure. (For the implementation of VisitChildren, see the example in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_parent_and_child_objects_and_ihierarchy">Parent and child objects and IHierarchy</a>). All boss objects on the spread&#39;s hierarchy are visited by the code in the following example, including the spread layer and page boss objects.<div class="fragment"><div class="line"><span class="keywordtype">void</span> VisitSpreadChildren(<a class="code" href="class_u_i_d_ref.html">UIDRef</a>&amp; documentUIDRef){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> document(documentUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadList&gt;</a> spreadList(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* database = documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>();</div><div class="line"> int32 spreadCount = spreadList-&gt;GetSpreadCount();</div><div class="line"><span class="keywordflow">for</span> ( int32 spreadIndex = 0; spreadIndex &lt; spreadCount; spreadIndex++ ){</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> spreadUIDRef(database, spreadList-&gt;GetNthSpreadUID(spreadIndex));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> spreadHierarchy(spreadUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> VisitChildren(spreadHierarchy);</div><div class="line"> }</div><div class="line">}</div></div><p>In contrast, the code shown in the following example filters the objects by the pages on which they lie. The method <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a> calculates which items lie on a page. Because pages do not own the items that lie on them (spreads own the items), the calculation of which items lie on a page is geometrical, comparing the intersection of the bounding box of each item with the bounding box of the page. (For details, see <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a>.) If this code is run on the spread shown in the preceding figure, the only object that appears in the list itemsOnPage is the graphic frame. The ruler guide is not returned as an item, because it is a pasteboard-ruler guide; if the ruler guide were a page-ruler guide, the code in the following example would list it.<div class="fragment"><div class="line"><span class="keywordtype">void</span> FilterItemsByPage(<a class="code" href="class_u_i_d_ref.html">UIDRef</a>&amp; documentUIDRef){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> document(documentUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadList&gt;</a> spreadList(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* database = documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>();</div><div class="line"> int32 spreadCount = spreadList-&gt;GetSpreadCount();</div><div class="line"><span class="keywordflow">for</span> ( int32 spreadIndex = 0; spreadIndex &lt; spreadCount; spreadIndex++ ){</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> spreadUIDRef(database, spreadList-&gt;GetNthSpreadUID(spreadIndex));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpread&gt;</a> spread(spreadUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">for</span> (int32 pageIndex = 0; pageIndex &lt; spread-&gt;GetNumPages(); pageIndex++)</div><div class="line"> {</div><div class="line"><a class="code" href="class_u_i_d_list.html">UIDList</a> itemsOnPage(database);</div><div class="line"><span class="keyword">const</span> bool16 bIncludePage = kFalse;</div><div class="line"><span class="keyword">const</span> bool16 bIncludePasteboard = kFalse; </div><div class="line"> spread-&gt;GetItemsOnPage(pageIndex, &amp;itemsOnPage, bIncludePage, bIncludePasteboard);</div><div class="line"><span class="comment">// Add code to manipulate itemsOnPage.</span></div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><p>The <a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a> code snippet can inspect the spreads in a document and their associated hierarchy. Run the snippet in SnippetRunner to create a textual report. For sample code, see <a class="el" href="class_snp_inspect_layout_model.html#a04001bc2fef65ae7a819f33f303560f2">SnpInspectLayoutModel::ReportDocumentByHierarchy</a>.<h2><a class="anchor" id="id_layers"></a> Layers</h2><p>Layers are presented to the user and edited with the Layers panel. Layers can be shown or hidden, locked or unlocked. By rearranging the order of layers, the user can control the front-to-back order in which page items assigned to those layers draw. The user also can change the layer to which a selected page item is assigned, by dragging and dropping in the Layers panel.<p>The following figure shows the user&#39;s perspective of a layer. The document shown is a facing-pages document with one spread, one page, and one layer.<div class="image"><img alt="plugin-programming-guide-vol1-50.gif" src="plugin-programming-guide-vol1-50.gif" /></div><h3><a class="anchor" id="id_layers_in_a_basic_document"></a> Layers in a basic document</h3><p>The following figure is an object diagram showing the layout hierarchy that results when a new layer is added to the document in the frame-and-ruler diagram in <a class="el" href="id_idml_cookbook.html#id_spreads_and_pages">Spreads and pages</a>. The diagram shows a document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) containing one spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), one page (<a class="el" href="classk_page_boss.html">kPageBoss</a>), and three layers. Each layer is represented by one <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object that has two corresponding <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> objects in each spread. The pages layer that stores the page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) is represented by the <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object named &quot;pages&quot; and the <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> objects named &quot;pages&quot; and &quot;private.&quot; Layer 1 is represented by the objects layer1, layer1-content, and layer1-guides. Layer 2 is represented by the objects layer2, layer2-content, and layer2-guides. A graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) and a ruler guide (<a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>) are assigned to Layer 1. Layer 2 is empty.<div class="image"><img alt="plugin-programming-guide-vol1-51.gif" src="plugin-programming-guide-vol1-51.gif" /></div><p>When a new layer is added, three new objects are created:<ul><li>A new document layer is added to the layer list (<a class="el" href="class_i_layer_list.html">ILayerList</a>). This is the <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> object layer2.<li>Two corresponding spread layers are added to the spread. One new spread layer is added to contain paths, frames, or groups; the other new spread layer is added to contain ruler guides. These are the <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> objects layer2-content and layer2-guides.</ul><p>This figure shows that, when a document layer is created, two corresponding spread layers are added to each spread. When a document layer is deleted, its corresponding spread layers are removed from each spread. Document-layer edits are document-wide; that is, they affect all spreads in a document.<p>Content-spread layers are stored contiguously in the spread&#39;s hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>). Guide-spread layers also are stored contiguously. For example, the layer1-content and layer2-content objects in this figureare contiguous content-spread layers, and layer1-guides and layer2-guides are contiguous guide-spread layers.<p>The order of content-spread layers and guide-spread layers as child objects of the spread&#39;s hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) varies, depending on whether guides are being drawn in front or in back of content. Ruler guides are kept in a distinct spread layer, to allow them to be drawn in front of or behind other content, or even to turn them off completely, as determined by a preference setting. (See <a class="el" href="id_solutions.html#id_guides_and_grids">Guides and grids</a>.) This figure shows the order when guides are drawn in front of content. The corresponding index order is as follows:<div class="fragment"><div class="line">index[0] pages spread layer</div><div class="line">index[1] <span class="keyword">private</span> spread layer</div><div class="line">index[2] layer1-content spread layer</div><div class="line">index[3] layer2-content spread layer</div><div class="line">index[4] layer1-guides spread layer</div><div class="line">index[5] layer2-guides spread layer</div></div><p>If guides are drawn behind other content, the index order of spread layers in the spread&#39;s hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) is as follows:<div class="fragment"><div class="line">index[0] pages spread layer</div><div class="line">index[1] <span class="keyword">private</span> spread layer</div><div class="line">index[2] layer1-guides spread layer</div><div class="line">index[3] layer2-guides spread layer</div><div class="line">index[4] layer1-content spread layer</div><div class="line">index[5] layer2-content spread layer</div></div><dl class="section note"><dt>Note<dd>Child-index order in <a class="el" href="class_i_hierarchy.html">IHierarchy</a> defines z-order, the order in which objects on those spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) draw. The child with index 0 draws first (behind); the child wth index n-1, last (in front).</dl><p>The spread&#39;s <a class="el" href="class_i_spread.html">ISpread</a> interface has methods that return the spread layer associated with a given document layer. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_navigating_spread_content_using_ispread">Navigating spread content using ISpread</a>). The associations are calculated using the following algorithm.<p>The indices of the pages-spread layer and private-spread layer are fixed:<ul><li>Pages-spread layer <a class="el" href="class_i_hierarchy.html">IHierarchy</a> child index = 0.<li>Private-spread layer <a class="el" href="class_i_hierarchy.html">IHierarchy</a> child index = 1.</ul><p>Variable definitions:<ul><li>i = index of document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) in <a class="el" href="class_i_layer_list.html">ILayerList</a> whose associated spread layer (kSpreadlayerBoss) is wanted.<li>c = number of document layers in <a class="el" href="class_i_layer_list.html">ILayerList</a>.</ul><p>If guides are displayed in front of content, the following calculations are used:<ul><li>Content-spread layer <a class="el" href="class_i_hierarchy.html">IHierarchy</a> child index = i + 1.<li>Guide-spread layer <a class="el" href="class_i_hierarchy.html">IHierarchy</a> child index = i + c.</ul><p>If guides are displayed behind content, the following calculations are used:<ul><li>Content-spread layer <a class="el" href="class_i_hierarchy.html">IHierarchy</a> child index = i +c.<li>Guide-spread layer <a class="el" href="class_i_hierarchy.html">IHierarchy</a> child index = i + 1.</ul><h3><a class="anchor" id="id_layer_options"></a> Layer options</h3><p>There are layer options that can be controlled via the Layers Options dialog. User can double click on a layer name in the Layers panel to bring up the Layer Options dialog, as shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-52.gif" src="plugin-programming-guide-vol1-52.gif" /></div><p>The attributes in the Layer Options dialog are managed by the <a class="el" href="class_i_document_layer.html">IDocumentLayer</a> interface, which is aggregated on the <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>. The following table lists some of the commands that can be used to modify layer options.<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Note </th></tr><tr><td><a class="el" href="classk_change_layer_name_cmd_boss.html">kChangeLayerNameCmdBoss</a></td><td>Changes the name of the layer. </td></tr><tr><td><a class="el" href="classk_ignore_hidden_text_wrap_cmd_boss.html">kIgnoreHiddenTextWrapCmdBoss</a></td><td>Sets text-wrap options for a document layer. </td></tr><tr><td><a class="el" href="classk_lock_guide_layer_cmd_boss.html">kLockGuideLayerCmdBoss</a></td><td>Locks or unlocks a guide layer. When the guide layer is locked, nothing in that layer (that is, guides) can be selected. </td></tr><tr><td><a class="el" href="classk_lock_layer_cmd_boss.html">kLockLayerCmdBoss</a></td><td>Locks or unlocks a layer. A &quot;locked&quot; layer means that nothing in that layer can be selected. Layers are unlocked by default. </td></tr><tr><td><a class="el" href="classk_print_layer_cmd_boss.html">kPrintLayerCmdBoss</a></td><td>Sets the printability of the layer. A nonprintable layer does not print or export. </td></tr><tr><td><a class="el" href="classk_set_layer_color_cmd_boss.html">kSetLayerColorCmdBoss</a></td><td>Changes the layer color. </td></tr><tr><td><a class="el" href="classk_show_guide_layer_cmd_boss.html">kShowGuideLayerCmdBoss</a></td><td>Sets the visibility of the guide layer. An &quot;invisible&quot; layer is not displayed on the screen. </td></tr><tr><td><a class="el" href="classk_show_layer_cmd_boss.html">kShowLayerCmdBoss</a></td><td>Sets the visibility of the layer. An &quot;invisible&quot; layer is not displayed on the screen. </td></tr></table><p>Use the commands in this table whenever possible to modify layer options.<p>The SnpPrintDocument.cpp SDK snippet allows the user to select which layer to print. It uses <a class="el" href="classk_print_layer_cmd_boss.html">kPrintLayerCmdBoss</a> to set the printability for each layer. For more information, see the snippet source code.<dl class="section note"><dt>Note<dd>A similar set of attributes also exists in the <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a>. <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layers_in_a_basic_document">Layers in a basic document</a> explains the relationship between <a class="el" href="class_i_document_layer.html">IDocumentLayer</a> and <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a> in a document. The <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a> interface primarily provides &quot;getter&quot; methods that forward the request for information to the corresponding <a class="el" href="class_i_document_layer.html">IDocumentLayer</a> interface</dl><h3><a class="anchor" id="id_navigating_spread_content_using_ispread"></a> Navigating spread content using ISpread</h3><p><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layers_in_a_basic_document">Layers in a basic document</a> shows the content of a spread is stored on its <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. Locating content using <a class="el" href="class_i_hierarchy.html">IHierarchy</a> can be laborious. Alternately, the <a class="el" href="class_i_spread.html">ISpread</a> interface makes it easy to examine the content of a spread, as shown in the object diagram in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-53.gif" src="plugin-programming-guide-vol1-53.gif" /></div><p>This figure shows that you can use the <a class="el" href="class_i_spread.html">ISpread</a> interface on a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) to find the guide or content spread layer associated with a document layer. (For more information, see <a class="el" href="class_i_spread.html#a48e0c4d322acbd18f94ad694709630c0">ISpread::QueryLayer</a>.) You also can discover which page items lie on a given page. (For more information, see <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a>.)<p>Using <a class="el" href="class_i_spread.html">ISpread</a> to discover the content of a spread is much easier than using <a class="el" href="class_i_hierarchy.html">IHierarchy</a>.<p>When run on the document shown in this figure, the code in the following example visits the content of spread layer layer1-content if parameter wantGuideLayer is kFalse. The code visits the content of spread layer layer1-guides if parameter wantGuideLayer is kTrue.<p>This code iterates over spreads in a document, then iterates over document layers to visit items on the spread layer associated with each document layer:<div class="fragment"><div class="line"><span class="keywordtype">void</span> FilterItemsByLayer(<a class="code" href="class_u_i_d_ref.html">UIDRef</a>&amp; documentUIDRef, bool16 wantGuideLayer){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> document(documentUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadList&gt;</a> spreadList(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILayerList&gt;</a> layerList(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* database = documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>();</div><div class="line"> int32 spreadCount = spreadList-&gt;GetSpreadCount();</div><div class="line"><span class="keywordflow">for</span> ( int32 spreadIndex = 0; spreadIndex &lt; spreadCount; spreadIndex++ ){</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> spreadUIDRef(database, spreadList-&gt;GetNthSpreadUID(spreadIndex));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpread&gt;</a> spread(spreadUIDRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> int32 layerCount = layerList-&gt;GetCount();</div><div class="line"><span class="comment">// Skip the pages layer (layer 0).</span></div><div class="line"><span class="keywordflow">for</span> (int32 layerIndex = 1; layerIndex &lt; layerCount; layerIndex++)</div><div class="line"> {</div><div class="line"><a class="code" href="class_i_document_layer.html">IDocumentLayer</a>* documentLayer = layerList-&gt;QueryLayer(layerIndex);</div><div class="line"> int32 pPos;</div><div class="line"><span class="comment">// Visit the content spread layer associated with the document layer</span></div><div class="line"><span class="comment">// if wantGuideLayer is kFalse, the guide spread layer otherwise.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadLayer&gt;</a> contentSpreadLayer(spread-&gt;QueryLayer(documentLayer, &amp;pPos, wantGuideLayer));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> hierarchy(contentSpreadLayer, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> VisitChildren(hierarchy);</div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><dl class="section note"><dt>Note<dd>For an implementation of VisitChildren, see the example in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_parent_and_child_objects_and_ihierarchy">Parent and child objects and IHierarchy</a>.</dl><h2><a class="anchor" id="id_master_spreads_and_master_pages"></a> Master spreads and master pages</h2><p>A master spread is a special kind of spread that contains master pages. A master page is a page that contains background content for another page. When a page is based on a master page, the page items that lie on the master page also appear on the page. A master page eliminates the need for repetitive page formatting and typically contains page numbers, headers and footers, and background pictures. The layout presentation is used to edit the content of master spreads. The Pages panel is used to arrange the pages in a master spread and to assign a master page to a page.<p>The following figure shows the user&#39;s perspective on master spreads and master pages. The publication shown is a facing-pages document with a master spread containing two master pages.<div class="image"><img alt="plugin-programming-guide-vol1-54.gif" src="plugin-programming-guide-vol1-54.gif" /></div><h3><a class="anchor" id="id_master_spreads_and_master_pages_in_a_basic_document"></a> Master spreads and master pages in a basic document</h3><p>A master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) is a special kind of spread; it extends the spread boss class (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). The content of a master spread is organized the same way as a spread: each has a hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) with spread layers acting as parent objects for content. Compare the spread shown in the frame-and-ruler figure in <a class="el" href="id_idml_cookbook.html#id_spreads_and_pages">Spreads and pages</a> to the master spread shown in the following figure. The document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) shown contains a master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) with two pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>), and two paths (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) in the form of a square and a circle.<dl class="section note"><dt>Note<dd>Pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) that are part of a master spread are master pages. This name clashes with the name of the master-spread boss class, <a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>, so the distinction between the two is worth repeating: a master page is a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) owned by a master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>).</dl><div class="image"><img alt="plugin-programming-guide-vol1-55.gif" src="plugin-programming-guide-vol1-55.gif" /></div><p>When a page is based on a master page, the page items that lie on the master page also appear on the page. When the master spread in this figure is applied to page 1 of the facing-pages document in the frame-and-ruler figure, page items from the master page appear on page 1. The circle in the screenshot of page 1 in the following figure is an object from the master spread.<p>The following figure is an object diagram showing a one-page document that has a master (A-Master) applied. The circle drawn on page 1 is an object inherited from the associated master page. The boss objects that represent the spread and the master spread it is based on are shown. The association between a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) and its master page is implemented by the <a class="el" href="class_i_master_page.html">IMasterPage</a> interface. The screenshot shows that filtering of the objects on the master spread is being performed. Objects that intersect the bounding box of the master page associated with the page are drawn; other objects on the master spread are filtered out. The circle is the only object from the master spread to draw, because it is the only object that intersects the bounding box of the master page associated with page 1.<p>This figure shows a spread based on a master spread:<div class="image"><img alt="plugin-programming-guide-vol1-56.gif" src="plugin-programming-guide-vol1-56.gif" /></div><p>When two new pages based on the master shown in the first figure in this subsection are added to the document, the layout hierarchy is as shown in the following figure. The object diagram shows the boss objects that represent three pages in a facing-pages document based on the same master spread. The circle and square objects drawn on pages 1, 2, and 3 come from the master.<p>The following figure shows two spreads based on a facing-pages master spread:<div class="image"><img alt="plugin-programming-guide-vol1-57.gif" src="plugin-programming-guide-vol1-57.gif" /></div><p>The master spread (<a class="el" href="classk_master_pages_boss.html">kMasterPagesBoss</a>) associated with a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) is found by calling <a class="el" href="class_i_master_page.html#ade07db3d307fb65c1f57f5c6bb554881">IMasterPage::GetMasterSpreadUID</a>. The associated master page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) within that master spread is calculated by calling update to <a class="el" href="class_i_master_page.html#a4b96c6f7ebc0a9df1e309fde2603ae38">IMasterPage::GetMasterSpreadPageIndex</a>. The calculation depends on the index position (0, 1, 2, ...) of the page within its spread and the document set-up. Given the result returned by <a class="el" href="class_i_master_page.html#a4b96c6f7ebc0a9df1e309fde2603ae38">IMasterPage::GetMasterSpreadPageIndex</a>, <a class="el" href="class_i_spread.html#a9b62e506756b79643190031d0cf221ed">ISpread::GetNthPageUID</a> can be called to get a reference to the master page (<a class="el" href="classk_page_boss.html">kPageBoss</a>), or <a class="el" href="class_i_spread.html#a90f32503a5e8d43fc8088a1eafe6acaa">ISpread::GetItemsOnPage</a> can be called to calculate the objects on the master spread that intersect the bounding box of the master page.<p>To base a page or set of pages on a master spread, process the <a class="el" href="classk_apply_master_spread_cmd_boss.html">kApplyMasterSpreadCmdBoss</a> command.<h3><a class="anchor" id="id_master-page_item_overrides"></a> Master-page item overrides</h3><p>Page items from a master spread can be overridden. For example, to change the fill color of the circle on page 1 in the preceding figure, a master page item override is created. A record of the override is kept by the page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) in the <a class="el" href="class_i_master_override_list.html">IMasterOverrideList</a> interface.<p>Overrides to master-page items are applied programmatically with <a class="el" href="classk_override_master_page_item_cmd_boss.html">kOverrideMasterPageItemCmdBoss</a>.<p>Even when a master-page item is overridden, changes made to its counterpart on the master still can effect page items. An overridden page item continues to inherit all properties of its master counterpart that are not overridden. For example, if the only property that was overridden on page 1 is the fill color of the circle, modifying the position of the circle in the master causes the position of the circle to be updated on the pages based on that master (pages 1 and 3). The application of the initial fill-color override creates a copy of the circle (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) object on spread 1; a record of the override is kept in <a class="el" href="class_i_master_override_list.html">IMasterOverrideList</a> on page 1. The circle on spread 1 is a controlled page item; the circle on the master spread is the controlling page item. Master page items maintain a list of controlled page items in the <a class="el" href="class_i_controlled_page_items.html">IControlledPageItems</a> interface, which represents the page items for which overrides were made. An overridden master-page item on a spread maintains a reference to its controlling master-page item, in the <a class="el" href="class_i_controlling_page_item.html">IControllingPageItem</a> interface.<h3><a class="anchor" id="id_basing_one_master_page_on_another"></a> Basing one master page on another</h3><p>A master page can be based on another master page. The association is maintained by the <a class="el" href="class_i_master_page.html">IMasterPage</a> interface as it is for a normal page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) owned by a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). For example, consider two masters, A and B, with different sets of page items. When you drag master A onto master B in the Pages panel, master B becomes based on master A. Master page items on master A appear on master B; however, the page items on master B inherited from master A remain owned by master A. If you alter the page items on master A, the change is inherited by master B. Master B can override page items from master A for individual properties, just as the master-page items on a spread can be overridden.<h2><a class="anchor" id="id_page_items"></a> Page Items</h2><p>A page item is a path, frame, group, picture, text frame, or page-item type that represents content the user creates and edits on a spread. For general information about the organization of page items in a spread, see <a class="el" href="id_idml_cookbook.html#id_spreads_and_pages">Spreads and pages</a>.<h3><a class="anchor" id="id_frames_and_paths"></a> Frames and paths</h3><p>A path represents a straight line, curved line, or closed shape like a rectangle, ellipse, or polygon. A path comprises one or more segments, each of which may be straight or curved. Each path is open (the default) or closed. Graphic attributes are properties that control how the path is formatted when drawn, like stroke weight and color. For more information about paths, see the &quot;Paths&quot; section of <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>. A frame is simply a path that contains-or is designated to contain-other objects, like a graphic page item, text page item, or page item that represents another type of content.<p>Frames and paths are represented by the same boss class, <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>.<p>A path can become a frame, and a frame can become a path. The difference between a path and a frame is the state of the interfaces on <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>. A path is a <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object that contains no children in its <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. A graphic frame is a <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object that contains a graphic page item in its <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. (For more information about graphic page items, see the &quot;Graphic Page Items&quot; section of <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>). A text frame is a <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object that contains a text page item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). (For more information on text page items, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<p>The following figure shows a square path, an empty graphic frame, a graphic frame displaying a picture, an empty text frame, and a text frame containing text. The object diagram shows a square being used as a path and as a frame.<div class="image"><img alt="plugin-programming-guide-vol1-58.gif" src="plugin-programming-guide-vol1-58.gif" /></div><p>The toolbox palette provides the user with several path-drawing tools. The Rectangle, Ellipse, Polygon, and Line tools create basic shapes. The Rectangle Frame, Ellipse Frame, and Polygon Frame tools create basic graphic-frame shapes. The Pen and Pencil tools create free-form shapes. When one of these tools is used to draw a path, a spline item (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) is created to represent the path. The <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> interface on <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> describes the points in the path. Other interfaces on <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> provide properties like stroke weight and stroke color that control how the path is drawn. When a path is used as a frame, the content is clipped by the frame&#39;s path.<p><a class="el" href="class_i_graphic_frame_data.html">IGraphicFrameData</a> is a frame&#39;s signature interface. <a class="el" href="class_i_graphic_frame_data.html">IGraphicFrameData</a> stores data that distinguishes whether the boss object represents a frame or a path. <a class="el" href="class_i_frame_type.html">IFrameType</a> is an alternative signature interface. It provides an easy-to-use interface that indicates whether the object represents a path or a frame. Major interfaces on <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, the boss class representing paths and frames, are shown in the class diagram in the following figure and summarized in the following table. For more information on the interfaces noted and details of the other interfaces on <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, refer to the API Reference.<div class="image"><img alt="plugin-programming-guide-vol1-59.gif" src="plugin-programming-guide-vol1-59.gif" /></div><p>The following table lists Key <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> interfaces:<table class="doxtable"><tr><th>Interface </th><th>Note </th></tr><tr><td><a class="el" href="class_i_frame_type.html">IFrameType</a></td><td>Indicates whether the boss object is a path or frame. </td></tr><tr><td><a class="el" href="class_i_geometry.html">IGeometry</a></td><td>Stores the bounding box of the boss object in inner coordinates. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_bounding_box_and_igeometry">Bounding box and IGeometry</a>. </td></tr><tr><td><a class="el" href="class_i_graphic_frame_data.html">IGraphicFrameData</a></td><td>Stores whether the boss object is a graphic frame and provides other helper methods to determine the content of a frame. </td></tr><tr><td><a class="el" href="class_i_handle_shape.html">IHandleShape</a></td><td>Draws selection handles on the boss object&#39;s bounding box. These selection handles are used to move and resize the object. </td></tr><tr><td><a class="el" href="class_i_handle_shape.html">IHandleShape</a> (IID_IPATHHANDLESHAPE) </td><td>Draws selection handles on the points in the boss object&#39;s path. These selection handles are used to edit the path points. </td></tr><tr><td><a class="el" href="class_i_hierarchy.html">IHierarchy</a></td><td>Connects the boss object into a tree that represents a layout hierarchy. Provides mechanism to find parent and child objects and interfaces. The objects the boss object contains are the children of the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. The object in which the boss object is contained is its parent. The child-index order in <a class="el" href="class_i_hierarchy.html">IHierarchy</a> defines the z-order of child objects. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_parent_and_child_objects_and_ihierarchy">Parent and child objects and IHierarchy</a>. </td></tr><tr><td><a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a></td><td>A list of adornments that the page item object may have. For details, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>. </td></tr><tr><td><a class="el" href="class_i_path_geometry.html">IPathGeometry</a></td><td>Stores the points in the boss object&#39;s path in inner coordinates. The interface can describe multiple paths. </td></tr><tr><td><a class="el" href="class_i_scrap_item.html">IScrapItem</a></td><td>Creates commands that can copy and paste the boss object. Different types of page items need to transfer different kinds of data. For example, a path transfers a description of its shape, and a text frame transfers text as well as a description of the frame. </td></tr><tr><td><a class="el" href="class_i_shape.html">IShape</a></td><td>Draws the boss object. </td></tr><tr><td><a class="el" href="class_i_transform.html">ITransform</a></td><td>Represents any transformation applied to the boss object (for example, translation, rotation, scaling) in a transformation matrix (<a class="el" href="class_p_m_matrix.html">PMMatrix</a>). See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_transformation_and_itransform">Transformation and ITransform</a>. </td></tr></table><p>A frame can contain at most one child in its hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>). The child boss object is the content of the frame. The child may be one of the following boss classes: <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>, a graphics page item (for example, <a class="el" href="classk_image_item.html">kImageItem</a>, kSVGItem, <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>, and <a class="el" href="classk_e_p_s_item.html">kEPSItem</a>), a text page item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>), or another content page item.<dl class="section note"><dt>Note<dd>The child object can be a group (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>). To put several objects in a frame, first group them.</dl><p>A frame can be owned by one parent using its hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) interface. Typically, a frame on a spread is owned by a spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>), but a frame also can be owned by other boss objects. For example, a frame that is part of a group is owned by the <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>, a frame nested inside a frame is owned by a <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, and an inline frame is owned by a <a class="el" href="classk_inline_boss.html">kInlineBoss</a>.<p>Paths and frames are created programmatically using <a class="el" href="class_i_path_utils.html">IPathUtils</a>. For sample code, see <a class="el" href="class_s_d_k_layout_helper.html#aa86a0c234cb467c214d2de955e3fcabe">SDKLayoutHelper::CreateRectangleGraphic</a>, <a class="el" href="class_s_d_k_layout_helper.html#a3956a719066e628345c326d2bc82b2b4">SDKLayoutHelper::CreateSplineGraphic</a>, <a class="el" href="class_s_d_k_layout_helper.html#a71bbdb53e542c3320032b11bf146c0f3">SDKLayoutHelper::CreateRectangleFrame</a>, and <a class="el" href="class_s_d_k_layout_helper.html#a0a8d0fb2f115bdb9878c4f14b32b3c4e">SDKLayoutHelper::CreateTextFrame</a>. The frame for a page item can be created when a file is placed.<p>For sample code that can be used to examine the content of a frame, see the example in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_parent_and_child_objects_and_ihierarchy">Parent and child objects and IHierarchy</a> on page 142. For sample code that can be used to discover frames in a document, see the examples in &quot;Spreads and pages&quot;.<p>The <a class="el" href="class_snp_inspect_layout_model.html">SnpInspectLayoutModel</a> code snippet can inspect the spreads in a document and their associated hierarchy, including their frames. To create a textual report, run the snippet in SnippetRunner. For sample code, see <a class="el" href="class_snp_inspect_layout_model.html#a04001bc2fef65ae7a819f33f303560f2">SnpInspectLayoutModel::ReportDocumentByHierarchy</a>.<h3><a class="anchor" id="id_graphic_page_items"></a> Graphic page items</h3><p>A graphic page item represents a picture. The following table shows the boss classes that represent graphics-format files that are imported and placed in a document. Graphic page items are contained in frames (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) when placed on a spread. For more information, see &quot;Graphic Page Items&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>.<table class="doxtable"><tr><th>Boss class </th><th>Represented graphics format </th></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td>DCS </td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td>EPS </td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td>Raster image formats (for example, TIFF, JPEG, PNG, GIF) </td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td>PICT </td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td>PDF </td></tr><tr><td>kSVGItem </td><td>SVG </td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td>WMF </td></tr></table><h3><a class="anchor" id="id_text_page_items"></a> Text page items</h3><p>A text page item represents a visual container that displays text. The following table shows the boss classes that participate in the display of text. Text page items are contained in frames (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) when placed on a spread. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<table class="doxtable"><tr><th>Boss class </th><th>Represents </th></tr><tr><td><a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a></td><td>Column </td></tr><tr><td><a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a></td><td>Column controller </td></tr></table><h3><a class="anchor" id="id_interactive_page_items"></a> Interactive page items</h3><p>An interactive page item represents an item in a multimedia format. The following table shows the boss classes that represent interactive page items. Interactive page items are contained in frames (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) when placed on a spread.<table class="doxtable"><tr><th>Boss class </th><th>Represents </th></tr><tr><td><a class="el" href="classk_movie_page_item_boss.html">kMoviePageItemBoss</a></td><td>Movie </td></tr><tr><td><a class="el" href="classk_multi_state_object_item_boss.html">kMultiStateObjectItemBoss</a></td><td>MultiStateObject </td></tr><tr><td><a class="el" href="classk_push_button_item_boss.html">kPushButtonItemBoss</a></td><td>Button </td></tr><tr><td><a class="el" href="classk_sound_page_item_boss.html">kSoundPageItemBoss</a></td><td>Audio </td></tr></table><h3><a class="anchor" id="id_groups"></a> Groups</h3><p>Grouping is a way to combine two or more objects so they can be worked with as a single object. The objects in a group move, transform, copy, and paste as a unit. Grouping boss objects results in the creation of a <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a> to represent the group. The grouped objects become the children of the group in its <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. Unlike a frame, a group does not have a path that clips its content when drawn. The geometry and shape of the group is defined by the objects in the group.<p>The object diagram in the following figure shows an example of how the internal representation changes when two objects are grouped.<p>This figure shows the grouping of two <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> path objects:<div class="image"><img alt="plugin-programming-guide-vol1-60.gif" src="plugin-programming-guide-vol1-60.gif" /></div><p>A group must contain at least two children in its <a class="el" href="class_i_hierarchy.html">IHierarchy</a>. The only boss classes that can be part of a group are <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> and <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>. In other words, only frames, paths, and groups can be grouped. To put a graphic page item-such as an image (<a class="el" href="classk_image_item.html">kImageItem</a>)-into a group, that item must be contained in a frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>).<p>There is no signature interface on <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a> that identifies a boss object uniquely as a group. To test for a group, call <a class="el" href="class_i_page_item_type_utils.html#ad6b0bfdac62430c4110ad915a77a8709">IPageItemTypeUtils::IsGroup</a>.<p>Objects are grouped using the <a class="el" href="classk_group_cmd_boss.html">kGroupCmdBoss</a> command and ungrouped using the <a class="el" href="classk_ungroup_cmd_boss.html">kUngroupCmdBoss</a> command. Selected objects can be grouped and ungrouped using <a class="el" href="class_i_group_item_suite.html">IGroupItemSuite</a>.<h3><a class="anchor" id="id_abstract_page_items_and_kpageitemboss"></a> Abstract page items and kPageItemBoss</h3><p>The <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> boss class is the abstract base class for page items. The <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a> boss class is the abstract base class for page items that can be selected and edited on a spread. These abstract classes are subclassed and implemented by the set of page items that can be created and edited on a spread, such as <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>, and <a class="el" href="classk_image_item.html">kImageItem</a>.<p>In general terms, a page item is any object that can participate in a hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>). This perspective is valid and includes spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) and pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) as page items. There is an alternative, more advanced definition of page item. To see all subclasses of <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a>, refer to the API Reference for <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a>.<h2><a class="anchor" id="id_guides_and_grids"></a> Guides and grids</h2><p>Guides and grids are used to align and position objects. Some, like ruler guides, can be dynamically created and changed. Others, like the margins of a page, are static properties of an object.<h3><a class="anchor" id="id_ruler_guides"></a> Ruler guides</h3><p>A ruler guide is a horizontal or vertical guide line used to align and position objects on a spread. Ruler guides are represented by the <a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a> boss class and are a type of page item. Ruler guides are represented as page items, because ruler guides share many behaviors of page items. Ruler guides can be associated with a layer, moved around on a spread, and copied and pasted. The signature interface that identifies a boss object as a ruler guide is <a class="el" href="class_i_guide_data.html">IGuideData</a>, which stores the properties of the guide. There are two kinds of ruler guides: page guides span a specific page, and pasteboard guides span the pasteboard of a spread.<p>Ruler guides are kept in their own spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) in the spread hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>), so ruler guides can be drawn in front or back of other content or completely hidden. For a description of this organization, see <a class="el" href="id_solutions.html#id_layers">Layers</a>.<p>Ruler guides are created by the <a class="el" href="classk_new_guide_cmd_boss.html">kNewGuideCmdBoss</a> command. They can be changed by the <a class="el" href="classk_move_guide_relative_cmd_boss.html">kMoveGuideRelativeCmdBoss</a>, <a class="el" href="classk_move_guide_absolute_cmd_boss.html">kMoveGuideAbsoluteCmdBoss</a>, <a class="el" href="classk_set_guide_view_threshold_cmd_boss.html">kSetGuideViewThresholdCmdBoss</a>, <a class="el" href="classk_change_guide_color_cmd_boss.html">kChangeGuideColorCmdBoss</a>, <a class="el" href="classk_set_guides_back_cmd_boss.html">kSetGuidesBackCmdBoss</a>, <a class="el" href="classk_set_guide_orientation_cmd_boss.html">kSetGuideOrientationCmdBoss</a>, and <a class="el" href="classk_set_guide_fit_to_page_cmd_boss.html">kSetGuideFitToPageCmdBoss</a> commands.<p>Guide preferences are stored in the <a class="el" href="class_i_guide_prefs.html">IGuidePrefs</a> interface on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). A distinct set of preferences that are inherited by new documents is maintained on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). The <a class="el" href="classk_set_guide_prefs_cmd_boss.html">kSetGuidePrefsCmdBoss</a> command is used to manipulate these preferences.<h3><a class="anchor" id="id_margin_and_column_guides"></a> Margin and column guides</h3><p>Margin guides represent the margins of a page. Column guides represent columns on a page. Each page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) has its own margin and column settings stored in <a class="el" href="class_i_margins.html">IMargins</a> and <a class="el" href="class_i_columns.html">IColumns</a> interfaces, respectively.<p>The margins for a page can be changed using <a class="el" href="classk_set_page_margins_cmd_boss.html">kSetPageMarginsCmdBoss</a>. The columns for a page can be changed using <a class="el" href="classk_set_page_columns_cmd_boss.html">kSetPageColumnsCmdBoss</a> and <a class="el" href="classk_set_column_gutter_cmd_boss.html">kSetColumnGutterCmdBoss</a>.<h3><a class="anchor" id="id_document_grid"></a> Document grid</h3><p>The document grid is a grid (like graph paper) across a spread, on which page items can be aligned.<p>Grid preferences are stored in the <a class="el" href="class_i_grid_prefs.html">IGridPrefs</a> interface on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). A distinct set of preferences that are inherited by new documents is maintained on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). The <a class="el" href="classk_set_grid_prefs_cmd_boss.html">kSetGridPrefsCmdBoss</a> command is used to manipulate these preferences.<h3><a class="anchor" id="id_baseline_grid"></a> Baseline grid</h3><p>The baseline grid is used to align the baseline of text across multiple columns on a spread.<p>Baseline-grid preferences are stored in the <a class="el" href="class_i_baseline_grid_prefs.html">IBaselineGridPrefs</a> interface on a story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), and the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). When a new story is created, the preferences in the document workspace are inherited by the story. New documents inherit preferences from the session workspace. The <a class="el" href="classk_set_baseline_grid_prefs_cmd_boss.html">kSetBaselineGridPrefsCmdBoss</a> command is used to manipulate these preferences. Each story can override its baseline-grid preference settings.<h3><a class="anchor" id="id_snap"></a> Snap</h3><p>If snapping is on, when the user drags an object within a certain distance of a guide or grid, the object&#39;s position is snapped to the guide or grid. If snapping is off, an object can be moved freely. Snapping is implemented by interaction between three main objects:<ul><li>The object on which other objects are being moved around; for example, a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). This object supports snapping by instantiating the <a class="el" href="class_i_snap_to.html">ISnapTo</a> interface.<li>An object that can be snapped onto, like a guide or grid. The snapping is performed by a snap-to service. The signature interface is <a class="el" href="class_i_snap_to_service.html">ISnapToService</a>, and the ServiceID is kSnapToService.<li>The object handling the user interaction. Normally, this is a tracker created by a tool of some sort. Refer to the API Reference for the <a class="el" href="class_i_tracker.html">ITracker</a> interface.</ul><p>Snap preferences are stored in the <a class="el" href="class_i_snap_to_prefs.html">ISnapToPrefs</a> interface on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). A distinct set of preferences that are inherited by new documents is maintained on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). The <a class="el" href="classk_set_snap_to_prefs_cmd_boss.html">kSetSnapToPrefsCmdBoss</a> command is used to manipulate these preferences.<h2><a class="anchor" id="id_layout-related_preferences"></a> Layout-related preferences</h2><p>The interfaces that store the major preference settings related to layout are summarized in the following table. Unless noted otherwise, each interface is present on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) and document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> contains the settings inherited when a new document is created. <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> contains the settings for the document. For more information about the interfaces and commands listed, refer to the API Reference.<table class="doxtable"><tr><th>Interface</th><th>Note</th><th>Mutator </th></tr><tr><td><a class="el" href="class_i_auto_text_frame_prefs.html">IAutoTextFramePrefs</a></td><td></td><td><a class="el" href="classk_set_auto_text_frame_prefs_cmd_boss.html">kSetAutoTextFramePrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_baseline_grid_prefs.html">IBaselineGridPrefs</a></td><td></td><td><a class="el" href="classk_set_baseline_grid_prefs_cmd_boss.html">kSetBaselineGridPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_column_prefs.html">IColumnPrefs</a></td><td></td><td><a class="el" href="classk_set_column_prefs_cmd_boss.html">kSetColumnPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_doc_style_list_mgr.html">IDocStyleListMgr</a></td><td>Stores a list of InDesign document presets (<a class="el" href="classk_doc_style_boss.html">kDocStyleBoss</a>). The Save Preset button in the New Document dialog box saves entries into this list. Present only on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>).</td><td><a class="el" href="classk_doc_add_style_cmd_boss.html">kDocAddStyleCmdBoss</a>, <a class="el" href="classk_doc_delete_style_cmd_boss.html">kDocDeleteStyleCmdBoss</a>, <a class="el" href="classk_doc_edit_style_cmd_boss.html">kDocEditStyleCmdBoss</a>, <a class="el" href="classk_doc_set_style_name_cmd_boss.html">kDocSetStyleNameCmdBoss</a>, <a class="el" href="classk_save_document_style_data_cmd_boss.html">kSaveDocumentStyleDataCmdBoss</a>, <a class="el" href="classk_doc_set_default_style_name_cmd_boss.html">kDocSetDefaultStyleNameCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_frame_edge_prefs.html">IFrameEdgePrefs</a></td><td></td><td><a class="el" href="classk_set_frame_edge_prefs_cmd_boss.html">kSetFrameEdgePrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_grid_prefs.html">IGridPrefs</a></td><td></td><td><a class="el" href="classk_set_grid_prefs_cmd_boss.html">kSetGridPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_guide_prefs.html">IGuidePrefs</a></td><td></td><td><a class="el" href="classk_set_guide_prefs_cmd_boss.html">kSetGuidePrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_layer_prefs.html">ILayerPrefs</a></td><td></td><td><a class="el" href="classk_set_layer_prefs_cmd_boss.html">kSetLayerPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_margin_prefs.html">IMarginPrefs</a></td><td></td><td><a class="el" href="classk_set_margin_prefs_cmd_boss.html">kSetMarginPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_page_layout_prefs.html">IPageLayoutPrefs</a></td><td>Stores the default shuffling behavior preferences for pages (between spreads) when pages are added, deleted, or moved. </td><td><a class="el" href="classk_set_page_layout_prefs_cmd_boss.html">kSetPageLayoutPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a></td><td>Stores the default set-up of an InDesign document (number of pages, page size, orientation, etc.). </td><td><a class="el" href="classk_set_page_setup_prefs_cmd_boss.html">kSetPageSetupPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_pasteboard_prefs.html">IPasteboardPrefs</a></td><td></td><td><a class="el" href="classk_set_pasteboard_prefs_cmd_boss.html">kSetPasteboardPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_snap_to_prefs.html">ISnapToPrefs</a></td><td></td><td><a class="el" href="classk_set_snap_to_prefs_cmd_boss.html">kSetSnapToPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_zero_point_prefs.html">IZeroPointPrefs</a></td><td></td><td><a class="el" href="classk_set_zero_point_pref_cmd_boss.html">kSetZeroPointPrefCmdBoss</a></td></tr></table><h2><a class="anchor" id="id_coordinate_systems"></a> Coordinate systems</h2><p>This section describes the coordinate spaces used by layout, and the arrangement of the layout-related interfaces that store geometric data.<p>Coordinate systems define the geometrical location of objects in a document and the canvas on which drawing occurs. Coordinate systems determine the position, orientation, and size of the text, graphics, and images that appear on a page.<p>InDesign uses two-dimensional graphics. Position is defined in terms of coordinates on a two-dimensional surface (a Cartesian plane). A coordinate is a pair of real numbers, x and y, that locate a point horizontally and vertically within a two-dimensional coordinate space. A coordinate space is determined by the location of the origin, the orientation of the x and y axes, and the lengths of the units along each axis.<p>InDesign defines several coordinate spaces in which the coordinates that specify objects are interpreted. The following sections describe these spaces and the relationships among them. Transformations among coordinate spaces are defined by transformation matrices, which can specify any linear mapping of two-dimensional coordinates, including translation, scaling, rotation, reflection, and skewing. Matrices are used to move from one coordinate space to another.<p>The approach used by InDesign aligns with PostScript and Adobe PDF. for more information, refer to the Adobe PDF Reference (<a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">http://www.adobe.com/devnet/pdf/pdf_reference.html </a>). Computer Graphics Principles and Practice (Foley, James D., et al., Addison-Wesley, 1990) also provides useful theory on two-dimensional geometrical transformation.<h3><a class="anchor" id="id_transformation_matrices"></a> Transformation matrices</h3><p>A transformation matrix specifies the relationship between two coordinate spaces as a linear mapping of one coordinate space to another. By modifying a transformation matrix, objects can be scaled, rotated, translated, or transformed in other ways.<p>In InDesign, a transformation matrix is specified by six numbers in the form of a <a class="el" href="class_p_m_matrix.html">PMMatrix</a>. In its most general form, this <a class="el" href="class_p_m_matrix.html">PMMatrix</a> is denoted [a b c d e f]; it can represent any linear transformation from one coordinate system to another.<p>The <a class="el" href="class_p_m_matrix.html">PMMatrix</a> patterns that specify the most common transformations are as follows:<ul><li>Translation is specified by [1 0 0 1 Tx Ty], where Tx and Ty are the distances to translate the origin of the coordinate system in the horizontal and vertical dimensions, respectively.<li>Scaling is specified by [Sx 0 0 Sy 0 0]. This scales the coordinates so one unit in the horizontal and vertical dimensions of the new coordinate system is the same size as Sx and Sy units, respectively, in the previous coordinate system.<li>Rotation is specified by [cos(A) sin(A) -sin(A) cos(A) 0 0], which has the effect of rotating the coordinate system axes by an angle A counterclockwise.<li>Skew is specified by [1 tan(A) tan(B) 1 0 0], which skews the x axis by angle A and the y axis by angle B.</ul><h3><a class="anchor" id="id_pasteboard_coordinate_space"></a> Pasteboard coordinate space</h3><p>The pasteboard coordinate space is the global coordinate system that encloses all objects in a document, as shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-61.gif" src="plugin-programming-guide-vol1-61.gif" /></div><p>All objects in a layout can have their coordinates expressed in pasteboard coordinates. The origin is the center of the first spread. The x axis increases from left to right; the y axis decreases from up to down. The length along each axis is measured in the PostScript unit of points. For example, the following figure shows the pasteboard coordinates of the bounding boxes for the spreads and pages in a basic document. The figure shows the pasteboard coordinates of the bounding box of each spread and page in a facing-page document with letter-sized pages of width 612 points and height 792 points. All values shown are in PostScript points.<div class="image"><img alt="plugin-programming-guide-vol1-62.gif" src="plugin-programming-guide-vol1-62.gif" /></div><p>The unit in which all measurements are stored in a document is the PostScript point. The unit in which measurements are shown in the user interface is controlled by a preference (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_measurement_units">Measurement units</a>).<h3><a class="anchor" id="id_inner_coordinate_space_and_parent_coordinate_space"></a> Inner coordinate space and parent coordinate space</h3><p>Each page item has its own coordinate system, known as its inner coordinate space. Each page item has an associated parent coordinate space. The inner coordinate space and its relationship with its parent coordinate space are defined by three interfaces:<ul><li><a class="el" href="class_i_hierarchy.html">IHierarchy</a> defines the parent association. The parent coordinate space is the first ancestor boss object on <a class="el" href="class_i_hierarchy.html">IHierarchy</a> that has an <a class="el" href="class_i_geometry.html">IGeometry</a> interface. This may not be the boss object&#39;s immediate parent. For example, many objects are owned by a spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>). Spread layers are not geometrical objects; they do not have an <a class="el" href="class_i_geometry.html">IGeometry</a> interface; therefore, the parent coordinate space for a boss object owned by a spread layer is the spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>).<li><a class="el" href="class_i_geometry.html">IGeometry</a> defines the bounding box, which implies the origin and orientation of the x and y axes.<li><a class="el" href="class_i_transform.html">ITransform</a> defines the transformation matrix that maps from the inner coordinate space to the parent coordinate space.</ul><p>The following figure shows a square containing a rectangular child page item as an example of a parent page item. The inner coordinate system of the parent as defined by its <a class="el" href="class_i_geometry.html">IGeometry</a> interface is shown.<div class="image"><img alt="plugin-programming-guide-vol1-63.gif" src="plugin-programming-guide-vol1-63.gif" /></div><p>In the A part of this figure, the parent is a square (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), 200 points wide. The child is a rectangle (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), 40 points wide and 30 points high. The square is used as a frame for the rectangle; this association is defined by the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. The objects are shown on a document grid with a grid line every 100 points and subdivisions every 10 points.<p>In the B part of this figure, the bounding box stored by the square&#39;s <a class="el" href="class_i_geometry.html">IGeometry</a> interface defines the origin of the object&#39;s inner coordinate space and the orientation of its x and y axes. The coordinates of the bounding box of the square in its inner coordinate space are shown, together with the x and y axes these coordinates imply. For a parent object, this is known as the parent coordinate space.<p>The <a class="el" href="class_i_geometry.html">IGeometry</a> and <a class="el" href="class_i_transform.html">ITransform</a> interfaces on the child object express the coordinate system relationship to the parent. There is more than one way to arrange this data. In the following figure, the child&#39;s coordinate system (the rectangle) is coincident with the parent&#39;s coordinate system (the square).<div class="image"><img alt="plugin-programming-guide-vol1-64.gif" src="plugin-programming-guide-vol1-64.gif" /></div><p>In the C part of this figure, the rectangle has its own inner coordinate space. The bounding box stored by the rectangle&#39;s <a class="el" href="class_i_geometry.html">IGeometry</a> interface is shown. This bounding box defines the origin of the object&#39;s inner coordinate space and the orientation of its x and y axes, labeled xchild and ychild. The transformation matrix defined by the rectangle&#39;s <a class="el" href="class_i_transform.html">ITransform</a> interface maps the rectangle&#39;s inner coordinate space (the child coordinate space) into the square&#39;s coordinate space (the parent coordinate space). In the arrangement shown, the parent and child coordinate systems are coincident; therefore, the transformation matrix in <a class="el" href="class_i_transform.html">ITransform</a> is the identity matrix.<p>In the D part of this figure, when the bounding box of the child (the rectangle) is transformed using the child&#39;s transformation matrix to the parent coordinate space (the square), the coordinates are expressed in the parent coordinate space as shown.<p>In the arrangement shown in the following figure, the child coordinate space is not coincident with its parent coordinate space. Instead, the origin of the rectangle&#39;s coordinate space is located at the rectangle&#39;s center.<div class="image"><img alt="plugin-programming-guide-vol1-65.gif" src="plugin-programming-guide-vol1-65.gif" /></div><p>In the E part of this figure, the origin of the rectangle&#39;s inner coordinate space is located at its center. The coordinates of the bounding box defined by the rectangle&#39;s <a class="el" href="class_i_geometry.html">IGeometry</a> interface, are shown together with the x and y axes these coordinates imply, labeled xchild and ychild. The transformation matrix defined by the child&#39;s <a class="el" href="class_i_transform.html">ITransform</a> inter face specifies the translation required to map to the parent coordinate space.<p>In the F part of this figure, when the bounding box of the child (the rectangle) is transformed using the child&#39;s transformation matrix to the parent coordinate space (the square), the coordinates are expressed in the parent coordinate space as shown.<p>A comparison of this figure and the one that precedes it shows that, after transformation, the bounding box of the rectangle in its parent&#39;s coordinate space is the same.<dl class="section note"><dt>Note<dd>To transform any point from inner coordinate space to any other coordinate space, the page item&#39;s transformation matrix (<a class="el" href="class_i_transform.html">ITransform</a>) must be applied. For utilities to help with the calculations, see TransformUtils.</dl><p>Tools like the Rectangle tool use a tracker (<a class="el" href="class_c_path_creation_tracker.html">CPathCreationTracker</a>) to create a path (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) whose coordinate system is coincident with their parent coordinate system as shown in the preceding figure with parts C and D. Facades like <a class="el" href="class_i_path_utils.html">IPathUtils</a> often are used to create a path (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) arranged as shown in the preceding figure with parts E and F.<h3><a class="anchor" id="id_spread_coordinate_space"></a> Spread coordinate space</h3><p>Spread coordinate space is the coordinate system of a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). Each spread has its own coordinate space, also known as the inner coordinate space for a spread. The origin of the spread coordinate space is the center of the spread. The parent coordinate space is pasteboard coordinate space. Unlike other page items, the parent of a spread is not defined by <a class="el" href="class_i_hierarchy.html">IHierarchy</a>; the parent of a spread is fixed as the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). See the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-66.gif" src="plugin-programming-guide-vol1-66.gif" /></div><p>In spread coordinates, the bounding box of each spread is identical. It is returned by <a class="el" href="class_i_geometry.html#ab06802236ea88e3f8fe478e49e846605">IGeometry::GetStrokeBoundingBox</a>. The spread&#39;s (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) implementation of <a class="el" href="class_i_geometry.html">IGeometry</a> determines the bounding box using the IPasteboard interface. The spread&#39;s <a class="el" href="class_i_transform.html">ITransform</a> interface stores a transformation matrix that translates the spread coordinate space to pasteboard coordinate space. This matrix is a translation matrix [1 0 0 1 0 Ty], where Ty specifies the spread&#39;s offset in the vertical dimension.<p>The following figure shows the spread coordinates of the bounding box of each spread and page in a basic facing-page document with letter-sized pages 612 points wide and 792 points high.<div class="image"><img alt="plugin-programming-guide-vol1-67.gif" src="plugin-programming-guide-vol1-67.gif" /></div><h3><a class="anchor" id="id_page_coordinate_space"></a> Page coordinate space</h3><p>Each page has its own coordinate space, also known as the inner coordinate space for a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>). The parent coordinate space for page coordinate space is spread coordinate space. The origin of page coordinate space is the top-left corner of the page. See the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-68.gif" src="plugin-programming-guide-vol1-68.gif" /></div><p>In page coordinates, the bounding boxes of each page(kPageBoss) in a document can be different. They are returned by <a class="el" href="class_i_geometry.html#ab06802236ea88e3f8fe478e49e846605">IGeometry::GetStrokeBoundingBox</a>. The page&#39;s <a class="el" href="class_i_transform.html">ITransform</a> interface stores a transformation matrix that translates the page coordinate space to spread coordinate space.<p>The following figure shows the page coordinates of the bounding box of each page in a facing-page document with letter-sized pages 612 points wide and 792 points high.<div class="image"><img alt="plugin-programming-guide-vol1-69.gif" src="plugin-programming-guide-vol1-69.gif" /></div><h3><a class="anchor" id="id_page-item_coordinate_space"></a> Page-item coordinate space</h3><p>Each page item has its own coordinate space, known as its inner coordinate space. The page item&#39;s bounding box is stored in interface <a class="el" href="class_i_geometry.html">IGeometry</a>. The geometrical data stored in <a class="el" href="class_i_geometry.html">IGeometry</a> and other data interfaces specific to the page item type are in the inner coordinate space of the page item. For example, the points that describe a path in interface <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> are stored in the inner co ordinate space. A transformation matrix that transforms from inner coordinate space to parent coordinate space is stored in the <a class="el" href="class_i_transform.html">ITransform</a> interface. The parent coordinate system is defined by the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface.<p>For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_inner_coordinate_space_and_parent_coordinate_space">Inner coordinate space and parent coordinate space</a>.<h3><a class="anchor" id="id_bounding_box_and_igeometry"></a> Bounding box and IGeometry</h3><p>The bounding box (<a class="el" href="class_i_geometry.html#ab06802236ea88e3f8fe478e49e846605">IGeometry::GetStrokeBoundingBox</a>) is the smallest rectangle (<a class="el" href="class_p_m_rect.html">PMRect</a>) that encloses a geometric page item:<ul><li>The bounding box of an image (<a class="el" href="classk_image_item.html">kImageItem</a>) encloses the pixels that define its raster data.<li>The bounding box of a group (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>) is the union of the bounding boxes of the objects in the group.<li>The bounding box of a path (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) encloses all points in the path (<a class="el" href="class_i_path_geometry.html">IPathGeometry</a>) and includes the effect of the properties that control how the path is stroked, such as stroke weight and corner style.<li>The bounding box of a page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) or spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) encloses the objects that lie on it.</ul><p>For illustrations, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_spread_coordinate_space">Spread coordinate space</a> and &quot;Page coordinate space&quot;.<p>A page item stores the data that describes its geometry in its inner coordinate space. For example, the bounding box in <a class="el" href="class_i_geometry.html">IGeometry</a> and the points that describe a path in interface <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> are stored in inner coordinate space (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_inner_coordinate_space_and_parent_coordinate_space">Inner coordinate space and parent coordinate space</a>). This stored data is independent of any transformation that may be in effect. Transformation (for example, scaling and rotation) is described by the page item&#39;s <a class="el" href="class_i_transform.html">ITransform</a> interface.<p>The <a class="el" href="class_i_geometry.html#a695d1dfd884d83dfb4b9f2b4cc812d31">IGeometry::GetPathBoundingBox</a> method gives the path bounding box, the bounding box of a path excluding the effects of adornments.<dl class="section note"><dt>Note<dd>Paths (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) have path bounding boxes; page items of other types may not.</dl><p>The <a class="el" href="class_i_shape.html#afba35af65bf27c0075d3a05d22cff2a7">IShape::GetPaintedBBox</a> method gives the painted bounding box, the bounding box of the page item including the effect of adornments.<p>The following table lists some useful geometry-related APIs.<table class="doxtable"><tr><th>API </th><th>Note </th></tr><tr><td><a class="el" href="class_i_geometry.html">IGeometry</a></td><td>Stores the bounding box of a page item. </td></tr><tr><td>IGeometryFacade </td><td>Positions and resizes page items. </td></tr><tr><td><a class="el" href="class_i_geometry_suite.html">IGeometrySuite</a></td><td>Positions and resizes objects currently selected. </td></tr></table><h3><a class="anchor" id="id_transformation_and_itransform"></a> Transformation and ITransform</h3><p>A page item has its own coordinate space, its inner coordinate space. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_inner_coordinate_space_and_parent_coordinate_space">Inner coordinate space and parent coordinate space</a>.) The coordinates of the points that describe the page item are stored in this inner coordinate space. A transformation matrix (<a class="el" href="class_p_m_matrix.html">PMMatrix</a>) that maps from inner coordinate space to the parent coordinate space is stored in the <a class="el" href="class_i_transform.html">ITransform</a> interface. Scaling, rotation, and other transformations that may be in effect are represented in this matrix. <a class="el" href="class_points.html">Points</a> in inner coordinate space are mapped to the parent coordinate space using the matrix obtained from <a class="el" href="class_i_transform.html#af49f1b0819dc98abcccd169fe593beb3">ITransform::GetInnerToParentMatrix</a>. There are useful functions in <a class="el" href="_transform_utils_8h_source.html">TransformUtils.h</a> that help to get the transform matrix (InnerToParentMatrix) and perform transform calculations. For details, refer to the API Reference.<p>For example, to calculate the bounding box of a page item in its parent coordinate space, get the bounding box from the page item (<a class="el" href="class_i_geometry.html#ab06802236ea88e3f8fe478e49e846605">IGeometry::GetStrokeBoundingBox</a>), and apply its transformation matrix (<a class="el" href="class_i_transform.html#af49f1b0819dc98abcccd169fe593beb3">ITransform::GetInnerToParentMatrix</a>). The calculated bounding box takes into account all scaling, rotation, and other transformations that are applied. The parent could be a group (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>), frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), or other kind of page item.<p>A transformation matrix can be inverted (<a class="el" href="class_p_m_matrix.html#a0c89605222f684d30808a801c244ffb2">PMMatrix::Invert</a>) to create a matrix that performs the inverse transformation. For example, if you have a matrix that transforms from inner coordinate space to parent coordinate space (InnerToParentMatrix), the inverse matrix can be used to transform points from parent coordinate space to inner coordinate space.<p>The matrix that transforms from inner coordinate space to pasteboard coordinate space is returned by ITransform::GetInnerToRootMatrix. To access it, we recommend you use a helper function, InnerToPasteboardMatrix. This code walks up the hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>) and concatenates the transformation matrix (<a class="el" href="class_i_transform.html#af49f1b0819dc98abcccd169fe593beb3">ITransform::GetInnerToParentMatrix</a>) of each page item. The end result is a matrix that maps from the inner coordinates of the page item it started from into pasteboard coordinates.<p>To compare the coordinates of two or more page items, the coordinates first should be transformed to a common coordinate space. The pasteboard coordinate space often is used for this purpose.<p>When creating a path (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), it often is useful to specify its position in pasteboard coordinates. You often position new page items relative to an existing boss object, like a spread, page, or frame. For example, to determine a position relative to a page, you first need the <a class="el" href="class_i_geometry.html">IGeometry</a> interface of the page (<a class="el" href="classk_page_boss.html">kPageBoss</a>); then you can call InnerToPasteboard to transform points on that page into pasteboard coordinates. When you have the points described in pasteboard coordinates, you can use <a class="el" href="class_i_path_utils.html">IPathUtils</a> to create the path. Alternately, you can describe the points in the parent coordinate space as shown by the sample code in <a class="el" href="class_snp_create_frame.html">SnpCreateFrame</a> and <a class="el" href="class_s_d_k_layout_helper.html">SDKLayoutHelper</a>.<p>The following table lists some useful transformation-related APIs.<table class="doxtable"><tr><th>API </th><th>Note </th></tr><tr><td><a class="el" href="class_i_transform.html">ITransform</a></td><td>Stores the page item&#39;s transformation matrix. </td></tr><tr><td>TransformUtils </td><td>Utility functions for transform calculations. See methods like InnerToPasteboard and PasteboardToInner in <a class="el" href="_transform_utils_8h_source.html">TransformUtils.h</a>. </td></tr><tr><td>ITransformFacade </td><td>Scale, rotate, skew, or move page items. </td></tr><tr><td><a class="el" href="class_i_transform_suite.html">ITransformSuite</a></td><td>Scale, rotate, skew, or move objects currently selected. </td></tr></table><h3><a class="anchor" id="id_measurement_units"></a> Measurement units</h3><p>The internal unit of measurement used by the application is PostScript points. All measurements in a document are stored in the internal measurement unit as <a class="el" href="class_p_m_real.html">PMReal</a> values. The user can choose to work in other measurement units, like centimeters, inches, picas, or ciceros. The user&#39;s preferred measurement unit is converted to and from the standard internal unit (PostScript points) at the boundary between the user interface and the document model.<p><b>Unit-of-measure service</b><p>The conversion from a specific measurement unit to the internal measurement unit is performed by a unit-of-measure service.<p>A unit-of-measure service is a boss class that aggregates the <a class="el" href="class_i_unit_of_measure.html">IUnitOfMeasure</a> and <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interfaces. <a class="el" href="class_i_unit_of_measure.html">IUnitOfMeasure</a> is the interface responsible for converting between the unit of measure and the internal unit of measure. <a class="el" href="class_i_unit_of_measure.html">IUnitOfMeasure</a> also has methods for producing a formatted string representation from units and tokenizing a string to produce a formatted number from the string. The measurement units supported by the application can be extended. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_custom_unit_of_measure_service">Custom unit-of-measure service</a>.<p>Common unit-of-measure services include <a class="el" href="classk_points_boss.html">kPointsBoss</a>, <a class="el" href="classk_inches_boss.html">kInchesBoss</a>, <a class="el" href="classk_inches_decimal_boss.html">kInchesDecimalBoss</a>, <a class="el" href="classk_millimeters_boss.html">kMillimetersBoss</a>, <a class="el" href="classk_picas_boss.html">kPicasBoss</a>, <a class="el" href="classk_ciceros_boss.html">kCicerosBoss</a>, and <a class="el" href="classk_centimeters_boss.html">kCentimetersBoss</a>.<p><b>Measurement-unit preferences</b><p>The user&#39;s preferred measurement unit is stored in the <a class="el" href="class_i_unit_of_measure_settings.html">IUnitOfMeasureSettings</a> interface. The session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores the measurement-unit preferences inherited by new documents. The document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) stores the document&#39;s preferences. The user changes these preferences by choosing Edit &gt; Preferences &gt; Units &amp; Increments and using the resulting dialog box. To change these preferences programmatically, use the <a class="el" href="classk_set_measure_units_cmd_boss.html">kSetMeasureUnitsCmdBoss</a> command.<p>The following is a class diagram of <a class="el" href="class_i_unit_of_measure_settings.html">IUnitOfMeasureSettings</a>.<div class="image"><img alt="plugin-programming-guide-vol1-70.gif" src="plugin-programming-guide-vol1-70.gif" /></div><p>The measurement system, <a class="el" href="class_i_measurement_system.html">IMeasurementSystem</a>, is an interface aggregated on <a class="el" href="classk_session_boss.html">kSessionBoss</a> that is used to help locate and use a unit-of-measure service. Unit-of-measure services can be referred to by either their ClassID or an index the measurement system assigns. The index assigned by the measurement system is used while referring to a unit of measure in memory, but this index should be converted to a ClassID when writing or reading from a stream. The following figure is a class diagram of <a class="el" href="class_i_measurement_system.html">IMeasurementSystem</a>.<div class="image"><img alt="plugin-programming-guide-vol1-71.gif" src="plugin-programming-guide-vol1-71.gif" /></div><h3><a class="anchor" id="id_geometrical_data_types"></a> Geometrical data types</h3><p>The core geometrical data types are as follows:<ul><li><a class="el" href="class_p_m_point.html">PMPoint</a> - (x, y) coordinates expressed as real (<a class="el" href="class_p_m_real.html">PMReal</a>) numbers.<li><a class="el" href="class_p_m_rect.html">PMRect</a> - Rectangle represented by points that designate the top-left and bottom-right corners.<li><a class="el" href="class_p_m_matrix.html">PMMatrix</a> - Two-dimensional transformation matrix that maps from one coordinate space to another.</ul><p>The core geometrical-collection data types are as follows:<ul><li>PMPointList<li>PMRectCollection<li>PMMatrixCollection</ul><h2><a class="anchor" id="id_the_layout_presentation_and_view"></a> The layout presentation and view</h2><p>This section describes the objects that present the layout to the user and allow the content to be edited interactively.<h3><a class="anchor" id="id_layout_presentation"></a> Layout presentation</h3><p>The layout of a document is presented within a layout presentation. A document has a layout presentation (<a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a>) for each view of the publication&#39;s layout. A layout presentation is implemented by <a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a> and its associated widgets. The pages and spreads are presented by the layout view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>). The general arrangement is shown in the class diagram in the following figure. <div class="image"><img alt="plugin-programming-guide-vol1-72.gif" src="plugin-programming-guide-vol1-72.gif" /></div><p>The application may have several layout presentations open at once, each displaying different documents or different views of the same document, as shown in the class diagram in the following figure. The figure shows a screenshot of the application with three layout presentations open. The boss classes and interfaces that are required to discover the open documents under the current session also are also shown. Each document knows the windows that are open on it by means of the <a class="el" href="class_i_presentation_list.html">IPresentationList</a> interface on <a class="el" href="classk_doc_boss.html">kDocBoss</a>.<div class="image"><img alt="plugin-programming-guide-vol1-73.gif" src="plugin-programming-guide-vol1-73.gif" /></div><p>A document does not need to have a presentation view. Documents that do not have a presentation view can be edited programmatically. Sometimes this called editing a headless document.<h3><a class="anchor" id="id_layout_view"></a> Layout view</h3><p>The layout view presents the layout of a document and is represented by the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> boss class. Documents can contain a variety of objects, like spreads, pages, frames, text, and graphics. The document stores these objects; the layout view displays them and allows them to be edited interactively. The layout view is part of a layout presentation (see the layout presentation class diagram in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_presentation">Layout presentation</a>).<p>Only the visible part of a document is presented in layout view. The layout presentation controls which part of a document is visible using magnification and page navigation widgets, etc. Other panels, like the Pages and Navigation panels, also may adjust the view.<p>The layout view sometimes is known as the layout widget.<p>The layout view causes the visible objects to draw by discovering the spreads that are visible and calling each spread to draw. The general arrangement is shown in the class diagram in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-74.gif" src="plugin-programming-guide-vol1-74.gif" /></div><p>The layout view uses its <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a> interface to get to its associated document. The <a class="el" href="class_i_spread_list.html">ISpreadList</a> interface on the document provides access to any particular spread. The <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface can be used to access children of the spread. For reasons of efficiency, navigation of the layout hierarchy during a window draw is somewhat more selective than shown in the figure in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_view">Layout view</a>. Portions of spreads that are not visible in a window are not called to draw. The layout view also discriminates between redrawing an entire window and drawing only the region that changed. These two strategies mean page items are not guaranteed to be called to draw during every window draw.<h3><a class="anchor" id="id_current_spread_and_active_layer"></a> Current spread and active layer</h3><p>The current spread is the spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) targeted for edit operations. Normally, new page items created by the tools that handle user actions in the layout view are created in the current spread. Each view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) stores a reference to its current spread in <a class="el" href="class_i_layout_control_data.html#a4ba566f81248c59955ac95cc7e9d80df">ILayoutControlData::GetSpreadRef</a>. The current spread is set in the user interface by clicking on a spread in the layout view. The tool that handles the click processes the <a class="el" href="classk_set_spread_cmd_boss.html">kSetSpreadCmdBoss</a> command. A reference to the current spread of the view that most recently edited the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) is stored in the <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> interface with PMIID IID_ICURRENTSPREAD.<p>The active layer is the layer targeted for edit operations. New page items created by the tools that handle user actions in the layout view are assigned to the active layer. Each view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) has a reference to its active layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>) given by <a class="el" href="class_i_layout_control_data.html#ae5b974377382dfb6e422a0a70489b181">ILayoutControlData::GetActiveDocLayerUID</a>. The active layer is set in the user interface by clicking on a layer in the Layers panel, which then processes the <a class="el" href="classk_set_active_layer_cmd_boss.html">kSetActiveLayerCmdBoss</a> command. A reference to the active layer of the view that most recently edited the document can be found by calling <a class="el" href="class_i_layer_utils.html#a48897e0bd1fc51caea557ec51d3588e1">ILayerUtils::QueryDocumentActiveLayer</a>.<p>When creating a page item programmatically, choose its parent boss object. Normally, this is a spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>). If you have access to a layout view, <a class="el" href="class_i_layout_control_data.html#a129562acf095e681ea7006c565f4ed89">ILayoutControlData::QueryActiveLayer</a> returns the hierarchy of the spread layer to use.<dl class="section note"><dt>Note<dd>The current page is not stored anywhere in a document (in contrast, the current spread and active layer are stored as described above). <a class="el" href="class_i_layout_control_data.html#a2ecb5508c566a401c98aa3aee651bc2b">ILayoutControlData::GetPage</a> returns the visible page. This is calculated by means of <a class="el" href="class_i_layout_u_i_utils.html#a1cccc207aa0b555ec0f6e37b3f089959">ILayoutUIUtils::GetVisiblePageUID</a>, by finding the page whose center point is closest to the center of the layout view.</dl><h3><a class="anchor" id="id_layout-presentation_and_layout-view_coordinate_spaces"></a> Layout-presentation and layout-view coordinate spaces</h3><p>The relationship between layout-presentation coordinates and layout-view coordinates is relatively static and is described by the respective <a class="el" href="class_i_control_view.html">IControlView</a> implementations. When the user hides the rulers, the layout-view coordinate space is coincident with the layout-presentation coordinate space. The relationship between pasteboard coordinates and layout-view coordinates is stored in the layout view&#39;s <a class="el" href="class_i_control_view.html">IControlView</a> interface. The layout view&#39;s <a class="el" href="class_i_control_view.html#a4a11909e95333128554cf4eee437ad68">IControlView::GetContentToWindowTransform</a> method returns the transform that maps from pasteboard coordinates to layout-view coordinates. See the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-75.gif" src="plugin-programming-guide-vol1-75.gif" /></div><p>As the user zooms and scrolls the view, the relationship between layout-view coordinates and pasteboard coordinates changes. The layout view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) has an <a class="el" href="class_i_panorama.html">IPanorama</a> interface to track the scroll and zoom changes. The relationship between the pasteboard and layout-view coordinate systems is stored in the layout view&#39;s <a class="el" href="class_i_control_view.html">IControlView</a> interface. The layout view&#39;s <a class="el" href="class_i_control_view.html">IControlView</a>::<p>Global-screen coordinates can be converted to pasteboard coordinates using <a class="el" href="class_i_layout_u_i_utils.html">ILayoutUIUtils</a>::<h2><a class="anchor" id="id_key_client_apis"></a> Key client APIs</h2><p>This section summarizes the APIs provided to manipulate layout-related objects. For more information, refer to the API Reference.<p>The layout view (<a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>) displays a document for editing and provides some important data interfaces, summarized in the following table. The layout view can be obtained in several ways, one of which is calling <a class="el" href="class_i_layout_u_i_utils.html#a3c10226d6bbf34506baf26d7792cac64">ILayoutUIUtils::QueryFrontLayoutData</a>.<table class="doxtable"><tr><th>API </th><th>Note </th></tr><tr><td><a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a></td><td>Data interface that refers to the document being viewed and the spread, page, and layer currently selected </td></tr><tr><td><a class="el" href="class_i_layout_control_view_helper.html">ILayoutControlViewHelper</a></td><td>Helper routines for performing page item hit-testing </td></tr></table><p>This table summarizes the suite interfaces that manipulate layout-related objects that are selected. To obtain a suite, client code can query a selection manager interface (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for the suite of interest. If the suite is available, its interface is returned; otherwise, a nil pointer is returned. For details of how to obtain the selection manager, see <a class="el" href="id_solutions.html#id_selection">Selection</a>. Given a selection manager, you can call suite methods using code that follows this pattern: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGeometrySuite&gt;</a> suite(selectionManager,<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()</div><div class="line"><span class="keywordflow">if</span> (suite) </div><div class="line"> suite-&gt;MethodName();</div></div><table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_align_and_distribute_suite.html">IAlignAndDistributeSuite</a></td><td>Aligns and distributes objects that are selected. </td></tr><tr><td><a class="el" href="class_i_arrange_suite.html">IArrangeSuite</a></td><td>Brings forward, sends backward, or performs other z-order-related operations on objects that are selected. </td></tr><tr><td><a class="el" href="class_i_frame_content_suite.html">IFrameContentSuite</a></td><td>Content-fitting operations and frame conversion operations on objects that are selected. </td></tr><tr><td><a class="el" href="class_i_geometry_suite.html">IGeometrySuite</a></td><td>Positions and resizes objects that are selected. </td></tr><tr><td><a class="el" href="class_i_group_item_suite.html">IGroupItemSuite</a></td><td>Groups and ungroups objects that are selected. </td></tr><tr><td><a class="el" href="class_i_guide_data_suite.html">IGuideDataSuite</a></td><td>Manipulates the properties of guides that are selected. </td></tr><tr><td><a class="el" href="class_i_layer_suite.html">ILayerSuite</a></td><td>Manipulates document layers. </td></tr><tr><td><a class="el" href="class_i_layout_hit_test_suite.html">ILayoutHitTestSuite</a></td><td>Hit-tests objects that are selected. </td></tr><tr><td><a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a></td><td>Sets the page items that are selected. </td></tr><tr><td><a class="el" href="class_i_master_page_suite.html">IMasterPageSuite</a></td><td>Manipulates master page item overrides. </td></tr><tr><td><a class="el" href="class_i_page_item_lock_suite.html">IPageItemLockSuite</a></td><td>Locks or unlocks objects that are selected. </td></tr><tr><td><a class="el" href="class_i_path_operation_suite.html">IPathOperationSuite</a></td><td>Performs path operations of selected page items. </td></tr><tr><td><a class="el" href="class_i_path_selection_suite.html">IPathSelectionSuite</a></td><td>Performs path selections. </td></tr><tr><td><a class="el" href="class_i_reference_point_suite.html">IReferencePointSuite</a></td><td>Manipulates reference point. </td></tr><tr><td><a class="el" href="class_i_transform_suite.html">ITransformSuite</a></td><td>Scales, rotates, skews, or moves objects that are currently selected. </td></tr></table><p>There are many command boss classes related to layout, as summarized in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_commands_that_manipulate_page_items">Commands that manipulate page items</a>. When possible, try to avoid to avoid processing low-level commands when possible; instead, look for a facade or utility, to see if there is a method that serves your purpose on one of these interfaces. Facades encapsulate parameterizing and processing the low-level commands. For example, to add an item to a page-item hierarchy, you could process <a class="el" href="classk_add_to_hierarchy_cmd_boss.html">kAddToHierarchyCmdBoss</a>, but instead you should use <a class="el" href="class_i_hierarchy_utils.html#a12205133d8ae3f085ecd41e61b14b80c">IHierarchyUtils::AddToHierarchy</a>, which provides a ready-made facade.<p>The facades and utilities related to layout are listed in the following tables. These interfaces are aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>. The <a class="el" href="class_utils.html">Utils</a> smart pointer class makes it straightforward to acquire and call methods on these interfaces. You can call their methods by writing code that follows this pattern: <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;IPathUtils&gt;</a>()-&gt;MethodName(...)</div></div><p>This table lists layout facades and utilities:<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td>IGeometryFacade </td><td>Positions and resizes page items. </td></tr><tr><td>ITransformFacade </td><td>Scales, rotates, skews, or moves page items. </td></tr><tr><td>IPageItemNameFacade </td><td>Gets and sets page item names. </td></tr><tr><td>IPageItemVisibilityFacade </td><td>Shows and hides page items. </td></tr><tr><td><a class="el" href="class_i_path_utils.html">IPathUtils</a></td><td>Creates and works with paths (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>). </td></tr><tr><td><a class="el" href="class_i_frame_content_utils.html">IFrameContentUtils</a></td><td>Helps work with text or graphic-frame content. </td></tr><tr><td><a class="el" href="class_i_hierarchy_utils.html">IHierarchyUtils</a></td><td>Adds and removes page items from a hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>). </td></tr><tr><td><a class="el" href="class_i_image_utils.html">IImageUtils</a></td><td>Helper functions to get image information. </td></tr><tr><td><a class="el" href="class_i_layout_u_i_utils.html">ILayoutUIUtils</a></td><td>Helper functions related to the layout user interface. Most of these are related to the active or front document. </td></tr><tr><td><a class="el" href="class_i_layout_utils.html">ILayoutUtils</a></td><td>Helper functions related to layout. Most of these are related to pages or the page-item hierarchy. </td></tr><tr><td><a class="el" href="class_i_master_spread_utils.html">IMasterSpreadUtils</a></td><td>Helper functions for master spreads and master page items. </td></tr><tr><td><a class="el" href="class_i_page_item_utils.html">IPageItemUtils</a></td><td>Page-item helper functions, like cache and change notifications. </td></tr><tr><td><a class="el" href="class_i_page_item_type_utils.html">IPageItemTypeUtils</a></td><td>Helps determine the type of a page item (for example, path, frame, and image). </td></tr><tr><td><a class="el" href="class_i_pasteboard_utils.html">IPasteboardUtils</a></td><td>Helps determine the spread by location or gets the location of page items. </td></tr><tr><td><a class="el" href="class_i_path_info_utils.html">IPathInfoUtils</a></td><td>Helps get path information. </td></tr><tr><td><a class="el" href="class_i_path_point_utils.html">IPathPointUtils</a></td><td>Stores path points during path-point transformation. </td></tr><tr><td><a class="el" href="class_i_path_utils.html">IPathUtils</a></td><td>Creates and manipulates path page items. </td></tr><tr><td><a class="el" href="class_i_ref_point_utils.html">IRefPointUtils</a></td><td>Utility interface for functions that compute reference points. </td></tr><tr><td><a class="el" href="class_i_transform_update_utils.html">ITransformUpdateUtils</a></td><td>Helps determine values relative to the zero point. </td></tr><tr><td>IValidateGeometryUtils </td><td>Validates transformation data. </td></tr></table><p>This table lists layout helper classes:<table class="doxtable"><tr><th>API </th><th>Note </th></tr><tr><td><a class="el" href="class_arranger.html">Arranger</a></td><td>Brings to front, sends to back, and performs other z-order-related operations. See <a class="el" href="_arrange_utils_8h_source.html">ArrangeUtils.h</a>. </td></tr><tr><td>TransformUtils </td><td>Utility functions for transform calculations. See methods in <a class="el" href="_transform_utils_8h_source.html">TransformUtils.h</a>, such as such as InnerToPasteboard and PasteboardToInner. </td></tr></table><h2><a class="anchor" id="id_extension_patterns"></a> Extension patterns</h2><p>This section summarizes the mechanisms a plug-in can use to extend the layout subsystem.<h3><a class="anchor" id="id_new-page-item_responder"></a> New-page-item responder</h3><p>A new-page-item responder lets a plug-in receive notification when a new page item (for example, frame, path, group, or image) is created by <a class="el" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a>. For the complete list of page item types, see <a class="el" href="id_idml_cookbook.html#id_page_items">Page items</a>.<p>A new-page-item responder often is used to detect the creation of a specific type of page item. For example, to detect the creation of a graphic frame, implement a new-page-item responder that gets a reference to the new page item (INewPISignalData::GetPageItem) and then checks whether it is a graphic frame (<a class="el" href="class_i_page_item_type_utils.html#a50ee0a59104a1b1466a9db60bee23d2a">IPageItemTypeUtils::IsGraphicFrame</a>).<p>Another common use of a new-page-item responder is initializing a custom data interface on a page item from defaults.<p>Consider the case where you defined a custom data interface and added this data interface to the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) to store default data. You also added this data interface to <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a> to store the settings per page item, and you want the default data to be inherited when new page items are created. In this case, you can implement a new-page-item responder that copies the data from defaults into the new page item. For an implementation of this pattern, see BasicPersistInterface.<p>A new-page-item responder is a service provider characterized by the following:<ul><li>The responder interface <a class="el" href="class_i_responder.html">IResponder</a> - The implementation can expect to be able to acquire an <a class="el" href="class_i_new_p_i_signal_data.html">INewPISignalData</a> interface from the signal manager (<a class="el" href="class_i_signal_mgr.html">ISignalMgr</a>) that it is passed.<li>The signature interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> - The ServiceID must be of type kNewPISignalResponderService. You can reuse the API implementation kNewPISignalRespServiceImpl for this.</ul><p><b>Sample code</b><p>BasicPersistInterface copies data from defaults into new page items.<h3><a class="anchor" id="id_custom_page_item"></a> Custom page item</h3><p>A custom page item lets a plug-in extend the set of objects that can be laid out on a page. A custom page item gives the plug-in control of how the object is drawn and how it behaves when selected and manipulated by the user. A common use of a custom page item is adding support for a graphics format for which the application provides no native support. In this case, the custom page item also requires a custom import provider (<a class="el" href="class_i_import_provider.html">IImportProvider</a>), to allow files of that graphics format to be placed. Some custom page items also may require custom tools to be implemented to create and manipulate the custom page items.<p>Implementing a custom page item can be complex. Before beginning development of a custom page item, evaluate whether another type of extension pattern-like a page-item adornment or draw-event handler-might meet your needs. If you do need to implement a custom page item, study the subclasses of <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> to see if there is an existing page item that is a close match to what you need. (Refer to <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> in the API Reference.) If an existing page item comes close to meeting your needs, use this boss class as the base class for your implementation. The examples provided in the SDK show only the basics of what is involved.<p><b>Sample code</b><ul><li>BasicShape specializes <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> and shows how to implement the interfaces involved in drawing a page item.<li>CandleChart specializes <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> to show how to draw some data as a chart.</ul><h3><a class="anchor" id="id_custom_unit_of_measure_service"></a> Custom unit-of-measure service</h3><p>Plug-ins can extend the set of measurement units supported by the application by defining a unit-of-measure service. The following steps outline what a plug-in needs to do to make a custom unit of measure appear in the Edit &gt; Preferences &gt; Units &amp; Increments dialog box:<ol type="1"><li>Define a unit-of-measure service boss class.<li>Implement the C++ code for <a class="el" href="class_i_unit_of_measure.html">IUnitOfMeasure</a>, using <a class="el" href="class_c_unit_of_measure.html">CUnitOfMeasure</a> as a base.<li>Implement <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> using the default kUnitOfMeasureService provided by the API, which registers the custom unit with the application-measurement system.<li>Include a ruler-resource description of the ODFRez type RulerDataType for your custom unit of measure in the .fr resource file.</ol><p><b>Rulers</b><p>Rulers are displayed by the ruler widgets (<a class="el" href="classk_horz_ruler_widget_boss.html">kHorzRulerWidgetBoss</a> and <a class="el" href="classk_vert_ruler_widget_boss.html">kVertRulerWidgetBoss</a>). The presentation of the ruler is described by the data defined in the ODFRez resource type, RulerDataType. This type describes the font, associated unit-of-measure service ClassID, and tick-mark layout. For more details, see RulerType.fh.<p>Typically, a ruler is associated with a particular unit-of-measure service. The resource description for the ruler is in the same plug-in as the unit-of-measure service. The unit-of-measure service returns the resource ID of its ruler description in its implementation of <a class="el" href="class_i_unit_of_measure.html#ac08e80a55c0bb7c759f4a91f9f43885c">IUnitOfMeasure::GetRulerSpecRsrcSpec</a>.<p>When a new view is created on a document, the preferred measurement unit is determined. Then, the associated unit-of-measure service is queried for the resource ID of its ruler description. If one exists, that description is used to create a new ruler as part of the new view of the document.<p><b>Sample code</b><p>CustomUnits creates a custom unit. In addition, it provides a resource description of how the ruler tick markers are specified for the custom units. CstUniRuler.fr from the sample shows a sample ruler resource.<h2><a class="anchor" id="id_commands_that_manipulate_page_items"></a> Commands that manipulate page items</h2><h3><a class="anchor" id="id_page-item_creation_commands"></a> Page-item creation commands</h3><p>This table lists commands that create page items<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_create_multi_column_item_cmd_boss.html">kCreateMultiColumnItemCmdBoss</a></td><td>Creates a new text frame. </td></tr><tr><td>kImportAndLoadPlaceGunCmdBoss </td><td>Combination of kImportPIFromFileCmdBoss and kLoadPlaceGunCmdBoss. </td></tr><tr><td>kImportAndPlaceCmdBoss </td><td>Combination of kImportPIFromFileCmdBoss and <a class="el" href="classk_place_p_i_cmd_boss.html">kPlacePICmdBoss</a>. </td></tr><tr><td>kImportPIFromFileCmdBoss </td><td>First, this command imports a file. If what is imported is a story, a multicolumn item is created. If what is imported is not in a graphic frame, a new graphic frame is created and the imported file is put into the frame. The UID of the new item is returned on the command&#39;s item list. </td></tr><tr><td>kLoadPlaceGunCmdBoss </td><td>Loads the item specified on the command&#39;s item list into the place gun. Only one item can be loaded by this command. </td></tr><tr><td><a class="el" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a></td><td>Used to create a new page item. You will need to use this command only if you are creating a custom page item. Do not use this command to create a page-item type supplied by the API, a <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, <a class="el" href="classk_image_item.html">kImageItem</a>, or <a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>. Each page-item type provides a command to create it. The newly created page item can be any simple page item that supports the <a class="el" href="class_i_geometry.html">IGeometry</a> interface. All attributes for the new page item are stored in the <a class="el" href="class_i_new_page_item_cmd_data.html">INewPageItemCmdData</a> interface. The UID of the new page item is returned in the command&#39;s item list. If the parent is supplied, the new page item is added to the hierarchy. </td></tr><tr><td><a class="el" href="classk_place_graphic_frame_cmd_boss.html">kPlaceGraphicFrameCmdBoss</a></td><td>Creates a graphic frame and places an image item into it. The item to be placed can be passed through the command&#39;s item list or placed from the place gun. To use the place gun, set the usePlaceGunContents parameter on the <a class="el" href="class_i_place_p_i_data.html">IPlacePIData</a> interface to kTrue, and do not set the command&#39;s item list. When passing the UID of the placed item using the command&#39;s item list, set the usePlaceGunContents parameter to kFalse. </td></tr><tr><td><a class="el" href="classk_place_item_in_graphic_frame_cmd_boss.html">kPlaceItemInGraphicFrameCmdBoss</a></td><td>Places a page item into an existing graphic frame. The page item can be passed into the command&#39;s item list, or it can be placed from the place gun. The UID of the graphic frame is returned on the command&#39;s item list. </td></tr><tr><td><a class="el" href="classk_place_p_i_cmd_boss.html">kPlacePICmdBoss</a></td><td>Places a page item. This command does not create a new page item. It command takes an existing page item from the command&#39;s item list or the place gun, then places the page item into the page item hierarchy. </td></tr><tr><td>kReplaceCmdBoss </td><td>Replaces one page item with another. Both the old page item and the new page item are specified in the <a class="el" href="class_i_replace_cmd_data.html">IReplaceCmdData</a> interface. </td></tr></table><h3><a class="anchor" id="id_page-item_update_commands"></a> Page-item update commands</h3><p>The following table lists commands that add/remove a page item to/from a hierarchy:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_add_to_hierarchy_cmd_boss.html">kAddToHierarchyCmdBoss</a></td><td>Adds the page item in the command&#39;s item list to the parent specified in the <a class="el" href="class_i_hierarchy_cmd_data.html">IHierarchyCmdData</a> interface. The index position for the page item also is specified on the <a class="el" href="class_i_hierarchy_cmd_data.html">IHierarchyCmdData</a> interface. For example, when a new page item is created, it calls this command if the new item&#39;s parent was supplied. </td></tr><tr><td><a class="el" href="classk_remove_from_hierarchy_cmd_boss.html">kRemoveFromHierarchyCmdBoss</a></td><td>Removes a page item from its parent when deleting a page item or detaching the imported content from the imported frame. </td></tr></table><p>The following table lists commands that position page items:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_align_cmd_boss.html">kAlignCmdBoss</a></td><td>Aligns the page items in the command&#39;s item list to the alignment type specified in the <a class="el" href="class_i_int_data.html">IIntData</a> interface. The command itself is a compound command made up of a set of move-relative commands. Since the move commands are undoable, the align command also is undoable. </td></tr><tr><td><a class="el" href="classk_center_items_in_view_cmd_boss.html">kCenterItemsInViewCmdBoss</a></td><td>Moves a set of page items so they appear centered in the current view. This command is not undoable. </td></tr><tr><td><a class="el" href="classk_fit_page_item_in_window_cmd_boss.html">kFitPageItemInWindowCmdBoss</a></td><td>Used to make the current selected page items fit in a window. This command is not undoable. </td></tr><tr><td><a class="el" href="classk_move_to_layer_cmd_boss.html">kMoveToLayerCmdBoss</a></td><td>Moves the page items specified on the command&#39;s item list to the document layer specified on the <a class="el" href="class_i_u_i_d_data.html">IUIDData</a> interface. The page items appear in the same z-order relative to each other as before in front of the new layer. This command does not move the items that are children of a group or a graphic frame, nor does it move standoffs. </td></tr><tr><td><a class="el" href="classk_move_to_spread_cmd_boss.html">kMoveToSpreadCmdBoss</a></td><td>Like <a class="el" href="classk_move_to_layer_cmd_boss.html">kMoveToLayerCmdBoss</a>, except <a class="el" href="classk_move_to_spread_cmd_boss.html">kMoveToSpreadCmdBoss</a> moves the page items from one spread to another. </td></tr></table><p>The following table lists commands for content fitting:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_align_content_in_frame_cmd_boss.html">kAlignContentInFrameCmdBoss</a></td><td>Aligns the contents in the command&#39;s item list to the specified corners of their respective frames. The corner, which is the same for all items, is specified on the <a class="el" href="class_i_align_content_in_frame_cmd_data.html">IAlignContentInFrameCmdData</a> interface. This command ignores frames without content. The command&#39;s item list holds the UIDs of the contents, not the UIDs of the frames that contain the contents. This command sends out a notification that the content&#39;s subject has changed. </td></tr><tr><td><a class="el" href="classk_center_content_in_frame_cmd_boss.html">kCenterContentInFrameCmdBoss</a></td><td>Positions the contents at the centers of their respective frames. The content UIDs are stored in the command&#39;s item list. </td></tr><tr><td><a class="el" href="classk_fit_content_prop_cmd_boss.html">kFitContentPropCmdBoss</a></td><td>Takes a list of frame content and modifies the content size and transformation to fit the frames and maintain the content&#39;s proportions. </td></tr><tr><td><a class="el" href="classk_fit_frame_to_content_cmd_boss.html">kFitFrameToContentCmdBoss</a></td><td>Resizes each frame in the command&#39;s item list to fit its content&#39;s path bounding box. This command takes a list of page items, filters out the empty frame and nongraphical frame, and transforms the frame&#39;s path geometry. The text frames are still in the command&#39;s item list, even though they are not affected by this and other commands. </td></tr></table><dl class="section note"><dt>Note<dd>Sometimes, after replace or paste operations, the graphic frame content (for example, the placed image, PDF, or EPS item) does not fit into the frame or is not at the position you want inside the frame. Unfortunately, there is no graphic attribute or helper function that can determine the fitting mode for a page item. You can compare the bounding boxes for the content (for example, the image item) and the parent (the frame), to decide whether the content should be positioned in the center, fit into the frame, or aligned to the corner of the frame using a content-fitting command. Because these commands are one-time actions and not attributes, however, these commands must be executed again if the page items are resized.</dl><p>The following table lists commands that designate the type of a frame:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_convert_frame_to_item_cmd_boss.html">kConvertFrameToItemCmdBoss</a></td><td>Takes a list of graphic frames and text frames with no content and converts them to graphic items (unassigned), which are neither text frames nor graphic frames. This command sets the graphic-frame attribute of the specified page items to kFalse. </td></tr><tr><td><a class="el" href="classk_convert_item_to_frame_cmd_boss.html">kConvertItemToFrameCmdBoss</a></td><td>The opposite of <a class="el" href="classk_convert_frame_to_item_cmd_boss.html">kConvertFrameToItemCmdBoss</a>. <a class="el" href="classk_convert_item_to_frame_cmd_boss.html">kConvertItemToFrameCmdBoss</a> sets the graphic-frame attribute of the specified page items to kTrue and converts unassigned graphic items to graphic frames. It command also converts empty text frames to empty graphic frames. </td></tr><tr><td><a class="el" href="classk_convert_item_to_text_cmd_boss.html">kConvertItemToTextCmdBoss</a></td><td>Converts unassigned page items and empty graphic frames to empty text frames. </td></tr></table><p>The following table lists commands that copy and paste page items:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_copy_cmd_boss.html">kCopyCmdBoss</a></td><td>A generic command for copying page items from one document to another. This command applies to any page item that supports the <a class="el" href="class_i_scrap_item.html">IScrapItem</a> interface. </td></tr><tr><td><a class="el" href="classk_copy_image_item_cmd_boss.html">kCopyImageItemCmdBoss</a></td><td>Copies the specified image item to the specified target. Both the image item and the target are specified in the <a class="el" href="class_i_copy_cmd_data.html">ICopyCmdData</a> interface. </td></tr><tr><td><a class="el" href="classk_copy_page_item_cmd_boss.html">kCopyPageItemCmdBoss</a></td><td>Copies one or more page items to the specified parent object, if any. A <a class="el" href="class_u_i_d_list.html">UIDList</a> of the page items created is returned in the command&#39;s item list. </td></tr><tr><td><a class="el" href="classk_duplicate_cmd_boss.html">kDuplicateCmdBoss</a></td><td>Duplicates the items specified in the command&#39;s item list. The page items in the command&#39;s item list are duplicated if the command is prepared successfully. </td></tr><tr><td><a class="el" href="classk_paste_cmd_boss.html">kPasteCmdBoss</a></td><td>Pastes one or more page items to the specified database in the command&#39;s <a class="el" href="class_i_copy_cmd_data.html">ICopyCmdData</a> interface. The <a class="el" href="class_u_i_d_list.html">UIDList</a> of the items to paste are passed to the command in the <a class="el" href="class_i_copy_cmd_data.html">ICopyCmdData</a> interface. </td></tr><tr><td><a class="el" href="classk_paste_graphic_item_cmd_boss.html">kPasteGraphicItemCmdBoss</a></td><td>Used for pasting EPS, image, and PDF items into the destination database. The difference between <a class="el" href="classk_paste_graphic_item_cmd_boss.html">kPasteGraphicItemCmdBoss</a> and <a class="el" href="classk_copy_page_item_cmd_boss.html">kCopyPageItemCmdBoss</a> is that if the specified parent is a graphic frame, the graphic item (EPS, image, PDF) is created as a child of the frame. If no frame is specified as the parent, <a class="el" href="classk_paste_graphic_item_cmd_boss.html">kPasteGraphicItemCmdBoss</a> creates a new rectangular frame as its parent and applies all its transformation values to the frame, so it appears in the correct location. </td></tr><tr><td><a class="el" href="classk_paste_inside_cmd_boss.html">kPasteInsideCmdBoss</a></td><td>Pastes the specified content into a frame and, if necessary, deletes previous content. The pasted content is aligned to the top left. </td></tr></table><p>The following table lists commands that transform page items:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_transform_page_items_cmd_boss.html">kTransformPageItemsCmdBoss</a></td><td>Performs various page-item transformations, such as move, rotate, scale, and skew. The caller needs to pass in appropriate data. </td></tr><tr><td><a class="el" href="classk_transform_path_points_cmd_boss.html">kTransformPathPointsCmdBoss</a></td><td>Transforms path points of page items. The transformation could be move, rotate, scale, skew, etc. The caller needs to pass in appropriate data. </td></tr></table><dl class="section note"><dt>Note<dd>We strongly recommend using ITransformFacade and <a class="el" href="class_i_transform_suite.html">ITransformSuite</a> for your transformation needs.<dd> Although other transform commands are still available, they may be removed in the future, so we strongly recommend you use only the two commands in the preceding table.</dl><p>The following table lists commands that group page items:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_group_cmd_boss.html">kGroupCmdBoss</a></td><td>Groups selected items in the list and creates a new page item consisting of the group. The parent for the group is the same as the parent of the last item in the sorted selected-item list. The UID of the new group page item is returned in the command&#39;s item list. This command requires that the items to be grouped have valid parents, because only items at the same level in the hierarchy can form a group. For example, it is invalid to try to group an image with the spline item that contains it (or any other splines not at the same level as the image of the document hierarchy). </td></tr><tr><td><a class="el" href="classk_ungroup_cmd_boss.html">kUngroupCmdBoss</a></td><td>Ungroups the items specified in the command&#39;s item list. The parent of the group becomes the parent of all ungrouped items. </td></tr></table><p>The following table lists commands that lock page items:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_set_lock_position_cmd_boss.html">kSetLockPositionCmdBoss</a></td><td>Used to lock/unlock the page items. (See the <a class="el" href="class_i_lock_position.html">ILockPosition</a> interface.) </td></tr></table><h3><a class="anchor" id="id_page-item_deletion_commands"></a> Page-item deletion commands</h3><p>The following table lists commands that delete page items:<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a></th><th>Description </th></tr><tr><td><a class="el" href="classk_delete_cmd_boss.html">kDeleteCmdBoss</a></td><td>Deletes the page items specified in the command&#39;s item list. Any groups left empty by the deletions also are deleted. </td></tr><tr><td><a class="el" href="classk_delete_frame_cmd_boss.html">kDeleteFrameCmdBoss</a></td><td>Deletes both the frame and its contents. In general, you should avoid directly calling this command. Instead, use the GetDeleteCmd method of the <a class="el" href="class_i_scrap_item.html">IScrapItem</a> interface to delete the frame. </td></tr><tr><td><a class="el" href="classk_delete_page_item_cmd_boss.html">kDeletePageItemCmdBoss</a></td><td>Deletes the page items specified in the command&#39;s item list and removes the items from the hierarchy. In general, you should avoid directly calling this command. Instead, use the GetDeleteCmd method of the <a class="el" href="class_i_scrap_item.html">IScrapItem</a> interface to delete the page item. </td></tr><tr><td><a class="el" href="classk_delete_image_item_cmd_boss.html">kDeleteImageItemCmdBoss</a></td><td><a class="el" href="classk_delete_image_item_cmd_boss.html">kDeleteImageItemCmdBoss</a> is a subclass of <a class="el" href="classk_delete_page_item_cmd_boss.html">kDeletePageItemCmdBoss</a>. The purpose of <a class="el" href="classk_delete_image_item_cmd_boss.html">kDeleteImageItemCmdBoss</a> is to release an image object when the page item is deleted. This command deletes the image items on the command&#39;s item list. If the ClassID of any item is not <a class="el" href="classk_image_item.html">kImageItem</a>, that item is not deleted. </td></tr><tr><td><a class="el" href="classk_delete_layer_cmd_boss.html">kDeleteLayerCmdBoss</a></td><td>Deletes the layer specified on the command&#39;s item list. The layers in the item list must be in the same document. After this operation, all page items on the layer list also are deleted. </td></tr><tr><td><a class="el" href="classk_delete_page_cmd_boss.html">kDeletePageCmdBoss</a></td><td>Deletes the pages specified on the command&#39;s item list. Page items on the pages also are deleted. If the spread is left without pages by this command, the spread also is deleted. If page reshuffling is specified on the <a class="el" href="class_i_bool_data.html">IBoolData</a> interface, the remaining pages in the affected spread and pages in the spreads that follow are reallocated so each spread has the number of pages specified in the page set-up preferences for the document. </td></tr><tr><td><a class="el" href="classk_delete_spread_cmd_boss.html">kDeleteSpreadCmdBoss</a></td><td>Deletes one or more spreads and all their pages and page items. If the deletion would leave the document without spreads, the command is aborted and nothing is deleted. The list of spreads to delete is specified in the command&#39;s item list. </td></tr><tr><td><a class="el" href="classk_delete_u_i_ds_cmd_boss.html">kDeleteUIDsCmdBoss</a></td><td>Deletes the UIDs specified on the command&#39;s item list. </td></tr><tr><td><a class="el" href="classk_remove_internal_cmd_boss.html">kRemoveInternalCmdBoss</a></td><td>Used when you delete a page item with embedded data. This command removes the embedded data from the publication. </td></tr></table><h1><a class="anchor" id="id_graphics_fundamentals"></a> Graphics Fundamentals</h1><p>This chapter explains how the appearance of page items is specified, how page items are drawn, and how you can customize how page items are drawn.<p>The objectives of this chapter are as follows:<ul><li>Show how paths are defined and manipulated.<li>Illustrate graphic page-item structure and how to import and export graphics files.<li>Examine how colors and related properties of graphics are represented.<li>Introduce graphic attributes.<li>Describe stroke-related effects, like custom path strokers.<li>Introduce transparency and transparency effects.<li>Outline how spreads and page items are drawn to the screen and printed.<li>Describe extension patterns to let you customize how page items are drawn.</ul><p>For definitions of terms, see the &quot;Glossary.&quot;<h2><a class="anchor" id="id_paths"></a> Paths</h2><p>This section shows how a path is defined and drawn according to its control points.<h3><a class="anchor" id="id_path_concepts"></a> Path concepts</h3><p><b>Paths</b><p>Paths can be created using various tools in InDesign. Shape tools and Frame tools create closed paths, the Pencil tool creates continuous smooth paths with lots of anchor points, and the Pen tool allows you create paths with great precision.<p>A path page item may have one or more paths. For example, a line, a rectangle, or an oval consists of one path; a compound path, two or more paths.<p><b>Path points</b><p>A path is defined by its path points. A path may have one or more path points. Path points are represented by <a class="el" href="class_p_m_path_point.html">PMPathPoint</a> objects. There are three types of path points:<ul><li>kL, line point - Used to form a straight line. These (and kCK path points) are called corner points.<li>kCS, continuous smooth point - Used to form a continuous smooth curve. These are called smooth points.<li>kCK, continuous unsmooth point - The point&#39;s left and right tangents are not on the same line. These (and kL path points) are called corner points.</ul><p>A <a class="el" href="class_p_m_path_point.html">PMPathPoint</a> object stores three <a class="el" href="class_p_m_point.html">PMPoint</a> objects, represented as pairs of (x,y) coordinates. These <a class="el" href="class_p_m_point.html">PMPoint</a> objects represent the anchor point, the left-direction point, and the right-direction point, respectively (see the figure in Path drawing). For a kL path point, the left- and right-direction points are the same as the anchor point.<p>The following figure shows examples of path points. In part A, the line consists of two kL points. In part B, the middle kCK point has two direction points that are not on a line with the anchor point. In part, the middle kCS point&#39;s anchor point and two direction points form a line.<div class="image"><img alt="plugin-programming-guide-vol1-76.gif" src="plugin-programming-guide-vol1-76.gif" /></div><p><b>Path drawing</b><p>A path is controlled by its path points. InDesign draws Bezier curves based on the path points.<p>The following figure shows an open path with six path points.<div class="image"><img alt="plugin-programming-guide-vol1-77.gif" src="plugin-programming-guide-vol1-77.gif" /></div><p>In the figure, note the following:<ul><li>Every anchor point (1, 2, 3, 4, 5, and 6) is on the path.<li><a class="el" href="class_points.html">Points</a> 21, 31, 41, 51, and 61 are left-direction points. <a class="el" href="class_points.html">Points</a> 22, 32, 42, 52, and 62 are right-direction points.<li>Direction lines (from anchor point to direction point) always are tangent to (perpendicular to the radius of) the curve at the anchor points.<li>The angle of each direction line determines the slope of the curve, and the length of each direction line determines the height, or depth, of the curve.<li>A path is drawn segment by segment. The shape of each segment is determined by its two end anchor points and their direction points. For example, curve (1,2) is determined by anchor points 1 and 2 and left-direction point 21; curve (2,3) is determined by anchor points 2 and 3, right-direction point 22, and left-direction point 31.</ul><p>If a path is closed, the last segment is controlled by the last and first path points.<p>For more details, see <a class="el" href="_p_m_bezier_curve_8h_source.html">PMBezierCurve.h</a>.<p><b>Winding rule</b><p>The winding rule determines whether a given point is inside or outside the area defined by a path. InDesign supports both even-odd and nonzero winding rules:<ul><li>Even-odd winding rule - If a ray drawn from a point in any direction crosses the path an odd number of times, the point is inside; otherwise, the point is outside.<li>Nonzero winding rule - The crossing count for a ray is the total number of times the ray crosses a left-to-right portion of the path minus the total number of times the ray crosses a right-to-left portion of the path. If a ray drawn from a point in any direction has a crossing count of zero, the point is outside; otherwise, the point is inside.</ul><p>For details, refer to the book PostScript Language Reference, available on the Adobe Web site.<p>The winding rule of an object is stored as a graphic attribute of the <a class="el" href="classk_graphic_style_even_odd_attr_boss.html">kGraphicStyleEvenOddAttrBoss</a> page item; therefore, you can get or set the winding rules through IGraphicsAttributeUtils the same way as other graphic attributes. For more information, see <a class="el" href="id_solutions.html#id_graphic_attributes">Graphic attributes</a>.<h3><a class="anchor" id="id_paths_data_model"></a> Paths data model</h3><p><b>Path page-item structure</b><p>Paths can exist on any page item that defines an <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> interface. The following figure show the relationship among page item, path, path point, and point. A path can be viewed as connected path segments or connected path points.<div class="image"><img alt="plugin-programming-guide-vol1-78.gif" src="plugin-programming-guide-vol1-78.gif" /></div><p><b>Path geometry</b><p>There is no object in the InDesign object model that maps to a single path directly; instead, all path points of all paths of a page item are stored using the interface defined by the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> class. <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> is the signature interface of a path page item. It has methods to access path information of a page item, like the number of paths the page item has and whether a path is open or closed.<p>Paths are differentiated using a path index. Methods for accessing path points normally require a path index parameter.<p>The PMPathPointList type is defined as <a class="el" href="class_k2_vector.html">K2Vector</a> &lt;PMPathPoint&gt;. An item of this type stores a list of path points; for example, all path points of a path. Unlike with <a class="el" href="class_i_path_geometry.html">IPathGeometry</a>, path points stored in an item of type PMPathPointList are not divided into paths by path index.<p>The most common path page item is the spline item, represented by <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>. Spline items include paths (lines, curves, frames) like those shown in Path points and &quot;Path drawing&quot;. There are several other kinds of paths, including image-clipping paths, text-wrap paths, and text outlines. All paths use <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> to store paths.<h3><a class="anchor" id="id_path_operations"></a> Path operations</h3><p>You can access paths of a page item through the interface defined by the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> class. InDesign also encapsulates some complex manipulations into several high-level path operations, which are provided as commands and selection suites.<p><b>Compound paths</b><p>You can combine two or more paths, compound paths, grouped page items, text outlines, text frames, or other shapes that interact with and intercept one another to create a new compound path. The advantage of a compound path over individual paths is that a compound path is a single object, so you can apply attributes to the compound path as a whole.<p>Use <a class="el" href="classk_make_compound_path_cmd_boss.html">kMakeCompoundPathCmdBoss</a> to create a new compound path and <a class="el" href="classk_release_paths_cmd_boss.html">kReleasePathsCmdBoss</a> to split a compound path into individual paths.<dl class="section note"><dt>Note<dd>A compound path does not connect or join any two points of existing paths; it only puts two paths together in one page item.</dl><p><b>Comparing compound paths and groups</b><p>Both compound paths and groups involve combining multiple page items as a whole. The main difference between compound paths and groups is that making compound paths combines all items together into one page item (all other original page items are deleted), whereas grouping does not delete the original page items; they are just moved into the new group item. See the following figure. The steps in the figure are explained below.<div class="image"><img alt="plugin-programming-guide-vol1-79.gif" src="plugin-programming-guide-vol1-79.gif" /></div><p>In this figure:<ol type="1"><li>The original page items are a red rectangle and a yellow oval, represented by <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object A and <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object B, respectively.<li>To make a compound path out of these two objects, to take the path points from <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object B and add them to <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object A through the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> interface, then delete <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object B. The result is only one <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object, A, with new path points. The new item retains the first item&#39;s graphic attributes, including fill color. All path operations use the even-odd winding rule, resulting in the hole in the compound path.<li>To group the two page items instead, InDesign first creates a <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a> object, then removes both <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object A and <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> object B from their current hierarchical parents and adds them as hierarchical children to <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>. The result is three different boss objects. The graphic attributes of the original items are retained. You can apply graphic attributes to a group page item or its children independently.</ol><p><b>Path-finder operations</b><p>Path-finder operations, also referred to as compound-shape operations, combine shapes enclosed by the paths. InDesign supports adding, subtracting, intersecting, excluding-overlap, and minus-back operations. The following figure illustrates the results of these path finder operations.<div class="image"><img alt="plugin-programming-guide-vol1-80.gif" src="plugin-programming-guide-vol1-80.gif" /></div><p>You can use <a class="el" href="classk_merge_path_cmd_boss.html">kMergePathCmdBoss</a> or <a class="el" href="class_i_path_operation_suite.html">IPathOperationSuite</a> to achieve the effect.<p>Path-finder operations require exactly two input objects. The attributes of the front object are retained by the result object, except in the case of the subtract operation.<p><b>Shape conversion</b><p>Shape conversion changes the current shape to a new shape. InDesign can convert to various shapes, including lines, triangles, rectangles with corner effects, ovals, and polygons. The following figure shows the result of converting a rectangle and an oval to inverse-rounded rectangles.<div class="image"><img alt="plugin-programming-guide-vol1-81.gif" src="plugin-programming-guide-vol1-81.gif" /></div><p>The command to achieve this effect is <a class="el" href="classk_convert_shape_cmd_boss.html">kConvertShapeCmdBoss</a>. It gets the bounding box of the current shape, then inserts or changes path points in the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> object to represent the desired shape, so the resulting page item maintains the same bounding box as the original shape.<p><a class="el" href="class_i_convert_shape_suite.html">IConvertShapeSuite</a> takes shape type, corner effects, and several other parameters. You can use this method to convert a shape to a new shape with a new combination of attributes, like shape type, corner effects, and number of polygon sides.<dl class="section note"><dt>Note<dd>If you convert a page item from shape A to shape B, then convert from shape B back to shape A again, the number of path points and their coordinates may be different than for your original shape A.</dl><h2><a class="anchor" id="id_graphic_page_items"></a> Graphic page items</h2><p>This section discusses the concepts and data model for graphic page items, as well as graphic page-item special operations, like setting clipping paths and text-wrap contours. This section also covers importing and exporting graphics files.<h3><a class="anchor" id="id_graphic_page-item_types"></a> Graphic page-item types</h3><p>Computer graphics fall into two main categories, vector graphics and raster images.<p>InDesign can import raster images, vector graphics, or a combination of both, depending on the graphics-file format.<p><b>Raster images</b><p>Raster images, or bitmap images, are the most common electronic medium for such continuous-tone images as photographs or images created in painting programs like Adobe Photoshop &reg;. Raster images are resolution dependent.<p>InDesign supports almost all popular raster-image formats, including PSD, JPEG, TIFF, GIF, PNG, BMP, and Scitex, all of which are represented by <a class="el" href="classk_image_item.html">kImageItem</a> boss, which is discussed in more detail in &quot;Graphic page-item boss-class inheritances&quot; (in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphic_page_item_data_model">Graphic page-item data model</a>).<p>An alpha channel is an invisible channel that defines transparent areas of a graphic. The alpha channel is stored in a graphic with the RGB or CMYK channels. A user can create alpha channels using background-removal features in Photoshop.<p><b>Vector graphics</b><p>Vector graphics use geometrical formulas to represent images. Paths created using the drawing tools in the InDesign Toolbox are examples of vector graphics.<p>Vector graphics are more flexible than bitmaps, because vector graphics can be resized without losing resolution. Another advantage of vector graphics is that their representations often require less memory than representations of bitmap images.<dl class="section note"><dt>Note<dd>Since most output devices are raster devices, vector objects must be translated into bitmaps before being printed or displayed. For example, PostScript printers have a raster image processor (RIP) that performs the translation within the printer.</dl><p>Vector-graphic formats can differ dramatically. InDesign supports import and export of most common vector graphics (see the following table).<table class="doxtable"><tr><th>File format </th><th>Import </th><th>Export </th><th>Related page-item boss </th></tr><tr><td>DCS </td><td>Yes </td><td>No </td><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td></tr><tr><td>EPS </td><td>Yes </td><td>Yes </td><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td></tr><tr><td>PDF </td><td>Yes </td><td>Yes </td><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td></tr><tr><td>PICT </td><td>Yes </td><td>No </td><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td></tr><tr><td>SVG </td><td>No </td><td>Yes </td><td>N/A. You can export various content or documents to SVG file format, but there is no page item for SVG format. </td></tr><tr><td>WMF </td><td>Yes </td><td>No </td><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td></tr></table><p>For more information on importing vector graphics, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_import">Graphics import</a>. For more information on exporting vector graphics, see &quot;Export to graphics file format&quot;.<h3><a class="anchor" id="id_graphic_page-item_settings"></a> Graphic page-item settings</h3><p><b>Content fitting</b><p>Sometimes the size of the graphic page item is not the same as the size of the parent graphics frame, causing the graphic to be displayed incorrectly. Usually, end users can move, resize, or rotate the graphic page item or the graphics frame in the same way as any other page item.<p>Taking advantage of the relationship between the graphic page item and the graphics frame, InDesign has several content-fitting options:<ul><li>Fit content to frame - Resizes the graphic page item to the same size as the graphics frame.<li>Fit frame to content - Resizes the graphics frame to the same size as the graphic page item.<li>Center content in frame - Moves the graphic page item to the center of the graphics frame. No resizing is involved.<li>Fit content proportionally - Resizes the graphic page item to barely fit the frame (that is, the graphic page-item edge touches the frame vertically or horizontally), while maintaining the aspect ratio of the graphic page item.<li>Fill frame proportionally - Resizes the graphic page item while maintaining its aspect ratio until all white space in the frame is filled.</ul><p>If there is a selection, we recommend you use <a class="el" href="class_i_frame_content_suite.html">IFrameContentSuite</a> or IFrameContentFacade where possible to perform these operations, though individual commands for these operations do exist.<dl class="section note"><dt>Note<dd>These transformations of graphic page items and frames change only the <a class="el" href="class_i_geometry.html">IGeometry</a> or <a class="el" href="class_i_transform.html">ITransform</a> objects. These transformations do not alter the structure of the graphic page item and frame objects.</dl><p><b>Clipping paths</b><p>A clipping path crops part of the image so only part image appears through the shape you create. The clipping path is stored separately from its graphics frame, so you can freely modify one without affecting the other. The clipping path does not change the image; the clipping path affects only how the image is drawn.<p>Clipping paths can be created in the following ways:<ul><li>Use existing paths or alpha channels. You can add paths and alpha channels in Photoshop files.<li>Let InDesign generate a clipping path with Detect Edges.<li>Draw a path in the shape you want, and paste the graphic into the path.</ul><p>When you set or generate a clipping path, the clipping path is attached to the image, resulting in an image that is drawn clipped by the path and cropped by the frame.<p><a class="el" href="class_i_path_geometry.html">IPathGeometry</a> aggregated on the graphic page-item bosses stores the clipping path. For more information on how a path is defined, see Path geometry.<p>The <a class="el" href="class_i_clip_settings.html">IClipSettings</a> interface is aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, and each graphic page-item boss, to define preferences or individual graphic page items&#39; clipping-path settings. For more details on <a class="el" href="class_i_clip_settings.html">IClipSettings</a>, refer to the API Reference.<p>Not all settings in <a class="el" href="class_i_clip_settings.html">IClipSettings</a> are required to determine a clipping path. For example, if you choose the kClipEmbeddedPath type, you need to know only the embedded path index. Settings like threshold, tolerance, and inset are required only to detect edges. We highly recommend you use the <a class="el" href="class_i_clipping_path_suite.html">IClippingPathSuite</a> selection-suite interface.<p><b>Text wrap</b><p>You can wrap text around the frame of any page-item object.<p>The text-wrap data model is discussed in detail in the second volume of this guide: &quot;Text Fundamentals&quot;. The path the text wraps around is defined by a separate page item, <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a>, which is accessible through <a class="el" href="class_i_stand_off_data.html">IStandOffData</a>, aggregated both on the graphic-frame boss (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) and graphic page-item boss (See the figure in &quot;Graphic page-item class hierarchy&quot;). Whenever the text-wrap object changes, the path is copied to the IID_ITEXTWRAPPATH interface (same implementation as <a class="el" href="class_i_path_geometry.html">IPathGeometry</a>) of the graphic page-item boss; this improves the performance of text composition and screen redrawing.<p>What makes the graphic page item special in text wrapping is that you can specify the contour options when the text-wrap mode is set to Wrap Around Object Shape. In addition to setting the text-wrap contour to the stroke bounding box of the graphics frame that owns a graphic page item, you also can specify that text wrap around any of the following:<ul><li>The rectangle formed by the graphic&#39;s height and width (the stroke bounding box of the graphic page item).<li>Paths generated by edge detection. You can adjust edge detection manually, using a clipping path (Clipping paths).<li>The image&#39;s alpha channel.<li>The image&#39;s embedded Photoshop path.<li>The image&#39;s clipping path.</ul><p>As with the clipping path setting, contour options for text wraps are specified by <a class="el" href="class_i_stand_off_contour_wrap_settings.html">IStandOffContourWrapSettings</a> aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, and individual graphic page-item bosses. We highly recommend you use ITextWrapFacade to manipulate text wraps, including setting contour options.<p><b>Display performance</b><p>Display performance is used to set the balance between graphic display speed and quality. You can specify the quality of how raster images, vector graphics, and transparencies are drawn to the screen. A display performance group is a set of values for these categories.<dl class="section note"><dt>Note<dd>Graphics display performance options do not affect output resolution when exporting or printing images in an InDesign document. When printing to a PostScript device, packaging for GoLive, or exporting to EPS or PDF, the final image resolution depends on the output options you choose when you print or export the file.</dl><p>The following display performance groups are available:<ul><li>Fast - The highest display speed but the lowest display quality. In the standard setting for this group, InDesign draws a raster image or vector graphic as a gray box.<li>Typical - The default option for graphic page items. In the standard setting for this group, InDesign draws a low-resolution proxy image appropriate for identifying and positioning a graphic.<li>High Quality - The highest quality but the lowest display speed. In the standard setting for this group, InDesign draws a raster image or vector graphic at high resolution (that is, uses the file provided by the graphic page item&#39;s link).</ul><dl class="section note"><dt>Note<dd>Standard settings of display performance groups can be modified through the Display Performance area of the Preferences dialog box or programmatically. See <a class="el" href="id_solutions.html#id_graphics">Graphics</a>.</dl><p>These display performance groups are session preferences, represented by <a class="el" href="class_i_draw_options.html">IDrawOptions</a>, aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> (see the following figure). The interface stores an array of <a class="el" href="class_draw_options_set.html">DrawOptionsSet</a> (also defined in <a class="el" href="_i_draw_options_8h_source.html">IDrawOptions.h</a>), corresponding to the fast, typical, and high-quality groups, respectively. Each group itself, represented by a <a class="el" href="class_draw_options_set.html">DrawOptionsSet</a>, has a set identifier and defines the qualities for each category, including vector, raster, and transparency. (For details, refer to the API Reference.) The array of <a class="el" href="class_draw_options_set.html">DrawOptionsSet</a> defines a two-dimensional map that indicates whether the graphic page item should be displayed as a gray box, proxy image, or a high-resolution graphic, given a display group (such as fast) and a category (such as raster). You can contain the current active group by calling <a class="el" href="class_i_draw_options.html#a783e390ab21288bbae633d38af96cb23">IDrawOptions::GetActiveSetID</a>, and can set groups through the Edit &gt; Preferences &gt; Display Performance menu.<p>Display-performance settings are not document-level preferences; instead, they are set as view preferences. <a class="el" href="class_i_draw_options_set_i_d.html">IDrawOptionsSetID</a>, aggregated on <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> (see the following figure), allows each layout presentation to have different default settings, even if they are of the same document. <a class="el" href="class_i_draw_options_set_i_d.html">IDrawOptionsSetID</a> stores a <a class="el" href="class_draw_options_set.html">DrawOptionsSet</a> as default settings when importing graphic page items. These settings can be set through the View &gt; Display Performance menu.<p>Individual graphic page items can have their own display-performance overrides. <a class="el" href="class_i_draw_option_overrides.html">IDrawOptionOverrides</a>, aggregated on kDrawablePageItemBoss-which is inherited by all graphic page item bosses (see the following figure)-stores a display-performance group (<a class="el" href="class_draw_options_set.html">DrawOptionsSet</a>) for each graphic page item. Display performance overrides can be set through the Object &gt; Display Performance menu. The IDisplayPerformanceSuite selection-suite interface facilitates the manipulation of display-performance settings.<dl class="section note"><dt>Note<dd>To let page item overrides take effect, the <a class="el" href="class_i_draw_options.html#a9171653093271bd6558fe8f3af628032">IDrawOptions::GetIgnoreOverrides</a> preferences flag must be kFalse. You can set this flag through the View &gt; Display Performance menu.</dl><p>The display-performance object model is summarized in the class diagram in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-82.gif" src="plugin-programming-guide-vol1-82.gif" /></div><p><b>Drawing a graphic page item</b><p>Changing display performance from typical to fast does not replace a proxy image with a gray box directly. In fact, changing display performance does not change the instance of the graphic page item at all. The effect is achieved by invalidating the layout and letting the page-item drawing process take care of displaying.<p>Drawing a layout containing graphic page items follows a generic drawing process detailed in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_dynamics_of_drawing">Dynamics of drawing</a>. A graphic page item is drawn in the following steps:<ol type="1"><li>Set the crop rectangle. This involves calculating the graphic page item&#39;s bounding box, cropped by the frame bounding box and view bounding box.<li>Clip the graphics with their clipping paths.<li>Determine drawing options and draw the graphics.</ol><p>You can participate in the graphic page-item drawing process by implementing the custom, drawing event-handler extension pattern, described in <a class="el" href="id_adobe_indesign_cc_tool_kit_guide.html#id_extension_patterns">Extension patterns</a>.<h3><a class="anchor" id="id_graphic_page_item_data_model"></a> Graphic page-item data model</h3><p>This section illustrates the data model and common interfaces for graphic page items.<p><b>Graphic page-item boss-class inheritances</b><p>Although graphic page items are represented by various boss classes (kImageBoss and bosses for vector graphics in the table in Vector graphics), they share similar interfaces and demonstrate similar properties.<p><a class="el" href="classk_image_item.html">kImageItem</a> (the boss representing raster images), <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>, <a class="el" href="classk_e_p_s_item.html">kEPSItem</a>, <a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a>, and <a class="el" href="classk_w_m_f_item.html">kWMFItem</a> directly or indirectly inherit from <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>, which aggregates interfaces necessary for page-item drawing. For the complete inheritance graph for the bosses, refer to the API Reference; search for <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>.<p><b>Graphic page-item class hierarchy</b><p>Graphic page-item boss classes have the following characteristics:<ul><li>Are wrapped in a spline item (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>).<li>Have text wrap around their contour or frame (represented as <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a>).<li>Store low-resolution proxy images as <a class="el" href="classk_image_in_d_b.html">kImageInDB</a>.<li>Store a link object (<a class="el" href="class_i_link_object.html">ILinkObject</a>) which keeps the UIDRef(s) of link boss(es). A link boss, like <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>, links the link object (page item) and external graphic files.<li>May embed link resources internally as <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a>.</ul><p>The following figure is a simplified view of the graphic page items in the class hierarchy of an InDesign document. <a class="el" href="class_i_link_object.html">ILinkObject</a> provides access to the link object, which can be used to access the linked graphic resource. If the link is embedded, <a class="el" href="class_i_store_internal.html">IStoreInternal</a> provides access to <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a>, which stores the bitmap of the image. <a class="el" href="class_i_image_data_access.html">IImageDataAccess</a> provides access to the proxy image, and the bitmap of the images also are stored as <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a>, which is accessible through <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> on <a class="el" href="classk_image_in_d_b.html">kImageInDB</a>. Navigation from the document root to the <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> is wrapped into a package, which is discussed in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>.<div class="image"><img alt="plugin-programming-guide-vol1-83.gif" src="plugin-programming-guide-vol1-83.gif" /></div><p><b>Graphic page-item interfaces</b><p>Several common interfaces are aggregated on graphic page-item bosses to provide features specific to graphic page items. These interfaces are either aggregated directly on the boss (for example, <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>), or aggregated by way of their parent bosses (for example, <a class="el" href="classk_image_base_item.html">kImageBaseItem</a>, the parent of <a class="el" href="classk_image_item.html">kImageItem</a>, or <a class="el" href="classk_display_list_page_item_boss.html">kDisplayListPageItemBoss</a>, the parent of all other vector graphic page item bosses). The following table summarizes these important interfaces and their uses.<table class="doxtable"><tr><th>Interface ID </th><th>Interface </th><th>Description </th></tr><tr><td>IID_IGRAPHICITEM </td><td><a class="el" href="class_i_int_data.html">IIntData</a></td><td>This is the signature interface for all graphic types (raster, EPS, etc.). The integer data is never used. </td></tr><tr><td>IID_IIMAGEITEM </td><td><a class="el" href="class_i_image_item.html">IImageItem</a></td><td>Aggregated onto <a class="el" href="classk_image_base_item.html">kImageBaseItem</a>, this interface provides access to the embedded color profile of the image. More importantly, testing the presence of this interface verifies that a page item boss is a raster image. </td></tr><tr><td>IID_IGEOMETRY </td><td><a class="el" href="class_i_geometry.html">IGeometry</a></td><td>This interface defines the geometry (position, size, etc.) of a graphic page item. It is used for calculating cropping during the graphic page-item drawing process. </td></tr><tr><td>IID_IPATHGEOMETRY </td><td><a class="el" href="class_i_path_geometry.html">IPathGeometry</a></td><td>This interface stores the clipping path of a graphic page item (see Clipping paths). </td></tr><tr><td>IID_ITEXTWRAPPATH </td><td><a class="el" href="class_i_path_geometry.html">IPathGeometry</a></td><td>This interface stores the text-wrap path; however, this path is only a cache (or mirror) of the text-wrap path. The real path is stored at <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> on <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a>. Every time the real text-wrap path is changed, this path is updated. (See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_wrap">Text wrap</a>). </td></tr><tr><td>IID_IIMAGEATTRIBUTES </td><td><a class="el" href="class_i_image_attributes.html">IImageAttributes</a></td><td>This interface stores a set of tags to describe the attributes of a raster image. Predefined tags are defined as enumerators, each of which describes the type, length, and data of a raster image. These tags are crucial in defining image item properties, such as alpha channel, clipping path, and color profile. </td></tr></table><p><b>Proxy images</b><p>When a graphic is placed, the contents of the original file are not actually copied into the document. Instead, InDesign creates a link to the original file on the disk and adds a screen-resolution bitmap image (the proxy image) to the layout, so you can view and move the graphic. When you export or print, InDesign uses the link to retrieve the original graphic, creating the final, desired, full-resolution output. Although end users can set preferences to tell InDesign to show high-resolution images (see Display performance), by default InDesign shows a low-resolution proxy image for performance reasons; the proxy image is created by processing <a class="el" href="classk_create_low_res_image_cmd_boss.html">kCreateLowResImageCmdBoss</a> during the import process.<p>A proxy image is represented by the boss <a class="el" href="classk_image_in_d_b.html">kImageInDB</a>, which is accessible from the graphic page item through <a class="el" href="class_i_image_data_access.html#a9a812ebbb0470e547449e5e0f82c72f5">IImageDataAccess::GetLowResImageUID</a>. The connection is established during the image-import process. For the data model of the proxy image in relation to the graphic page items, see Graphic page-item class hierarchy on page 200 and &quot;Graphic page-item examples&quot;.<p>One of the most important interfaces on <a class="el" href="classk_image_in_d_b.html">kImageInDB</a> is <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a>, which holds a UID pointing to an instance of <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a>, which stores the bitmap of the proxy image.<p>The proxy image is not always created by asking the image-import filter for the data. For raster images, if image auto-embedding is allowed in the image-import preferences, and the image is smaller than a predefined amount (defaults to 48 KB, accessible through <a class="el" href="class_i_link_state.html#a3b00682185a70eb9d222376f34b80f4f">ILinkState::GetEmbedSize</a>), the original high-resolution image is embedded directly.<p>Creating a proxy image is aided by the <a class="el" href="class_i_image_stream_manager.html">IImageStreamManager</a> interface, which provides a mechanism to convert the source-image format to a destination-image format according to the image attributes.<p><b>Graphic page items and links</b><p>Every graphic page item that was placed from a file has an associated link. End users can choose the Embed Link menu in the Links panel&#39;s menu to embed the link manually. The file remains in the Links panel, marked with an embedded link icon.<dl class="section note"><dt>Note<dd>This behavior differs from link for a text file. You can create a link when placing a text file; however, since text is inheritently part of the InDesign document, you cannot really &quot;embed&quot; the link. If you create a link when placing a text file, you can choose to unlink the file from the Links panel. Once it is unlinked, the link is removed from the Links panel.</dl><p>As a software developer, you also can use ILinkFacade::EmbedLinks to embed the image link (ILinkFacade is aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>). kStoreInternalCmdBoss, processed internally, reads the original high-resolution file and stores the image data as a data blob, referenced by the <a class="el" href="class_i_store_internal.html">IStoreInternal</a> interface on the graphic page item.<p>Embedding a link is not the same as embedding the small image to create a proxy image, discussed in Proxy images:<ul><li>The image data is stored in a different place. Embedding a link stores a data blob referenced by <a class="el" href="class_i_store_internal.html">IStoreInternal</a> on the graphic page item. Embedding an image as a proxy stores the data blob referenced by <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> on <a class="el" href="classk_image_in_d_b.html">kImageInDB</a> boss.<li>Embedding a link does not cause a check for the size of the image.Embedding an image as a proxy requires the image file to be smaller than a predefined size.</ul><h3><a class="anchor" id="id_graphic_page_item_examples"></a> Graphic page-item examples</h3><p>New graphics can be placed into a layout with or without an existing graphics frame. This section illustrates how instances of graphics objects evolve as you place a PDF file, replace it with an image, move the image around, embed a link, and set clipping-path and text-wrap contour options.<p><b>Begin with an empty graphics frame</b><p>We start exploring the graphics object model by examining an empty graphics frame. The following figure shows a screenshot and the object model when only an empty graphics frame is created. The graphics frame is represented by <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, and it does not have any hierarchical children.<div class="image"><img alt="plugin-programming-guide-vol1-84.gif" src="plugin-programming-guide-vol1-84.gif" /></div><p><b>Place a PDF item in a graphics frame</b><p>Next, we place a PDF file into the graphics frame. During import, InDesign creates a <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a> object to represent the PDF item and adds it as a child of the graphics frame. The following figure shows the object model of the graphics frame with a PDF item. A few other objects are created to represent information of the PDF item. New objects are marked in yellow.<p>Comparing this figure to the figure in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphic_page_item_examples">Graphic page-item examples</a>, notice that the Links panel shows a link to the external PDF file. The link is represented by <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a> through <a class="el" href="class_i_link_object.html">ILinkObject</a>, aggregated on <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>.<p>A proxy image is created for the PDF item as <a class="el" href="classk_image_in_d_b.html">kImageInDB</a> boss (UID 0xcd), and the proxy image bitmap is represented by <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a> (UID 0xce).<p>By default, a graphic page item is put into the graphics frame with an offset of (0,0) in inner coordinate space, so the PDF item has the same <a class="el" href="class_p_m_rect.html#acb1362ffec919adb2ed13ee1132655d5">PMRect::LeftTop</a> position (obtained from <a class="el" href="class_i_geometry.html#a695d1dfd884d83dfb4b9f2b4cc812d31">IGeometry::GetPathBoundingBox</a>) on the pasteboard as the graphics frame. Although the PDF item is slightly wider than the frame (<a class="el" href="class_p_m_rect.html#aef29e88422c8e734eac39912ebda8dc2">PMRect::RightBottom</a> member), InDesign does not draw that part, because it is cropped by the frame.<div class="image"><img alt="plugin-programming-guide-vol1-85.gif" src="plugin-programming-guide-vol1-85.gif" /></div><p><b>Replace a PDF item with an image</b><p>Next, we import an image file to replace the PDF item and examine the changes to the object model. The following figure shows the screenshot and object model after the change. Again, new objects are marked in yellow. Note the following:<ul><li>The Links panel shows a link to the new image file (PalmTreeCMYK.tif).<li>The overall structure of the object model did not change, but a new boss object <a class="el" href="classk_image_item.html">kImageItem</a> replaced <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>.<li>The UID of the link, proxy image, and proxy image data blob also changed. These objects were created during the import process -and the old objects were deleted.</ul><div class="image"><img alt="plugin-programming-guide-vol1-86.gif" src="plugin-programming-guide-vol1-86.gif" /></div><p><b>Move an image within a frame</b><p>You may have noticed the palm tree image is large, and we can only see a small part of the tree. Now we move the image a little bit within the graphics frame, using the Direct Selection tool. The following figure shows the resulting object model. Everything is the same, except the pasteboard coordinates of the image item. The changed object is marked by a red circle; changed values are marked in yellow. The coordinates represent the bounding box of the image item.<div class="image"><img alt="plugin-programming-guide-vol1-87.gif" src="plugin-programming-guide-vol1-87.gif" /></div><p><b>Embed an image&#39;s datalink</b><p>Next, we manually embed the image into the document by choosing Embed Link on the Links panel menu. The following figure shows the changed object model after the image is embedded. The new object is within the red circle, marked in yellow. A new <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a> is created to store the embedded image information. Other bosses-including the link object (<a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>)-do not change.<p>There are two <a class="el" href="classk_p_m_persist_data_blob_boss.html">kPMPersistDataBlobBoss</a> objects in the object model, but they represent different things. The one accessible through <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> on the proxy image:<a class="el" href="classk_image_in_d_b.html">kImageInDB</a> boss represents the proxy image; the other-accessible through <a class="el" href="class_i_store_internal.html">IStoreInternal</a> on the image:<a class="el" href="classk_image_item.html">kImageItem</a> boss-represents the embedded image data.<div class="image"><img alt="plugin-programming-guide-vol1-88.gif" src="plugin-programming-guide-vol1-88.gif" /></div><p><b>Setting clipping path and text wrap</b><p>Let&#39;s use a different image to set clipping-path and text-wrap options. In this section, we place a linked image, overlap it on top of a text frame, and examine how the image and text frame change when you set clipping-path and text-wrap options.<p>The following figure shows examples of clipping-path options. In the left screenshot, no clipping path was set, so the image overlaps the background text. The center screenshot shows the result of the clipping-path Detect Edges option (with the Threshold parameter set to 150). Although Detect Edges can detect most of the contours of the bottle, the result looks even better if you use the existing Photoshop paths, as shown in the right screenshot.<div class="image"><img alt="plugin-programming-guide-vol1-89.gif" src="plugin-programming-guide-vol1-89.gif" /></div><p>Reminder: The clipping path is stored with the <a class="el" href="class_i_path_geometry.html">IPathGeometry</a> interface of the graphic page item, so no extra object is created. For the graphic page item&#39;s class diagram, see the figure in Graphic page-item class hierarchy; for descriptions, see &quot;Clipping paths&quot;.<p>Now we set the text wrap of the image item, shown in the following figure. All three screenshots were taken with the text wrap set to wrap around the graphic page item&#39;s object shape. The left screenshot shows the result when the text-wrap contour option is set to Same As Clipping, with clipping-path type set to Detect Edges. The top-right corner of the bottle frame does not have text, because a small part of the image is there. You can set the contour option to use existing Photoshop paths independent of the clipping path, shown in the center screenshot. You also can set both the clipping path and text-wrap contour options to use the Photoshop path, which produces the best result, as shown in the right screenshot.<p>Object model changes after setting the text-wrap options are shown in the lower part of the figure. A new <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a> object -within the red circle, marked in yellow-is created to hold the text-wrap path. For information on how this affects text composition, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<div class="image"><img alt="plugin-programming-guide-vol1-90.gif" src="plugin-programming-guide-vol1-90.gif" /></div><h3><a class="anchor" id="id_graphics_import"></a> Graphics import</h3><p><b>Overview of the import process</b><p>When a user chooses to place a graphic into a document, InDesign performs a sequence of steps to import the graphics file as a graphic page item. The following figure shows the steps involved in importing PDF, EPS, and image files.<p>You also can import another InDesign document to a document. The import process works like PDF import. The only difference is that importing an InDesign document also imports swatches, inks, fonts, links, and so on and creates secondary links if the document being imported also contains links. You can set InDesign document-import options like other graphic file types; see &quot;InDesign document-import preferences&quot; (in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_import">Graphics import</a>).<p>You can also import multimedia files such as movie clips and sounds. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_rich_interactive_documents">Rich Interactive Documents</a>.<div class="image"><img alt="plugin-programming-guide-vol1-91.gif" src="plugin-programming-guide-vol1-91.gif" /></div><p>At a high level, the process involves the following steps:<ol type="1"><li>Create a <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a> that connects the link resource and the page item.<li>Query for an import provider that provides kImportProviderService for the graphic. This service also is used for importing other types of files, like plain-text files. For graphics files, one of four providers is called: <a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a>, <a class="el" href="classk_image_place_provider_boss.html">kImagePlaceProviderBoss</a>, <a class="el" href="classk_e_p_s_place_provider_boss.html">kEPSPlaceProviderBoss</a> or <a class="el" href="classk_native_import_service_boss.html">kNativeImportServiceBoss</a>. See The following table shows details on file formats supported by these providers.</ol><table class="doxtable"><tr><th>Import provider </th><th>Filename extension </th><th>Page-item boss </th></tr><tr><td><a class="el" href="classk_e_p_s_place_provider_boss.html">kEPSPlaceProviderBoss</a></td><td>AI, EPS, DCS </td><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td></tr><tr><td><a class="el" href="classk_e_p_s_place_provider_boss.html">kEPSPlaceProviderBoss</a></td><td>PCT, PIC </td><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td></tr><tr><td><a class="el" href="classk_e_p_s_place_provider_boss.html">kEPSPlaceProviderBoss</a></td><td>WMF, EMF </td><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td></tr><tr><td><a class="el" href="classk_image_place_provider_boss.html">kImagePlaceProviderBoss</a></td><td>TIF, TIFF, SCT, PSD, PNG, PCX, JPEG, JPG, GIF, DIB </td><td><a class="el" href="classk_image_item.html">kImageItem</a></td></tr><tr><td><a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a></td><td>PDF </td><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td></tr><tr><td><a class="el" href="classk_native_import_service_boss.html">kNativeImportServiceBoss</a></td><td>INDD </td><td><a class="el" href="classk_in_design_page_item_boss.html">kInDesignPageItemBoss</a></td></tr></table><ol type="1"><li>Create the appropriate new page item according to the type of the graphics file as shown in the table.<li>Import the file and set new page-item attributes, like <a class="el" href="class_i_p_d_f_attributes.html">IPDFAttributes</a>, <a class="el" href="class_i_e_p_s_attributes.html">IEPSAttributes</a>, and <a class="el" href="class_i_image_attributes.html">IImageAttributes</a>. This may involve searching for an appropriate image import filter (&quot;Image-import filters&quot; in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_import">Graphics Import</a>) and setting import options (&quot;Import options&quot;).<li>Create and set a low-resolution proxy image for the new page item, which is accessible through IImageAccess on the new page item.</ol><p><b>Import options</b><p>To control how the file should be imported, end users can choose Show Import Options in the Place dialog box, which allows the user to set import options through an Import Options dialog box. The specific options depend on the file type and graphics data in the file.<p><b>PDF-import preferences</b><p>The <a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a> (IID_IPDFPLACEPREFS) interface allows you to set various PDF import options, like how to crop the graphic and which pages to import. If the PDF file contains layers, you can set up layer information on the dialog using <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a>.<p>Both interfaces are aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> can be initialized by the imported file before bringing up the Import Options dialog. The following table lists some default settings of <a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a>.<p>For details, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_import_and_export">Import and Export</a>.<table class="doxtable"><tr><th>Preference </th><th>Default value </th></tr><tr><td>Crop </td><td>kCropToContent </td></tr><tr><td>Page number </td><td>1 </td></tr><tr><td>Proxy resolution </td><td>72 </td></tr><tr><td>Show preview </td><td>kTrue </td></tr><tr><td>Transparent background </td><td>kTrue </td></tr></table><p><b>EPS-import preferences</b><p><a class="el" href="class_i_e_p_s_preferences.html">IEPSPreferences</a> (IID_IEPSPREFERENCES) also is aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. Some settings are set programmatically; for example, importing an EPS graphic from a file (not from the clipboard) automatically sets the import mode to &quot;import whole&quot; (kImportWhole). The following table lists some default settings of <a class="el" href="class_i_e_p_s_preferences.html">IEPSPreferences</a>.<table class="doxtable"><tr><th>Preference </th><th>Default value </th></tr><tr><td>Import mode </td><td>kImportWhole </td></tr><tr><td>Display resolution </td><td>72 </td></tr><tr><td>Read OPI comments </td><td>kDontReadOPIComments </td></tr><tr><td>Create frame </td><td>kDontCreateFrameFromClipPath </td></tr><tr><td>Create proxy </td><td>kCreateIfNeeded </td></tr></table><dl class="section note"><dt>Note<dd>&quot;Create frame&quot; corresponds to the Apply Photoshop Clipping Path checkbox, and kAlwaysCreate corresponds to the Rasterize The PostScript radio button in the EPS Import Options dialog box.</dl><p><b>Image-import preferences</b><p>The Raster Image Import Options dialog box uses separate panels to set raster image-specific import options, like color profile and clipping path. Usually, InDesign uses session preferences (<a class="el" href="class_i_image_i_o_preferences.html">IImageIOPreferences</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) to import an image file. The following table lists some of the default settings.<table class="doxtable"><tr><th>Preference </th><th>Default value </th></tr><tr><td>Allow auto-embedding </td><td>kTrue </td></tr><tr><td>Create clip frame </td><td>kTrue </td></tr><tr><td>Preview resolution </td><td>72 </td></tr></table><p>When auto-embedding is allowed and the image size is small, InDesign automatically embeds the high-resolution image as the proxy image, so the data and the interfaces of <a class="el" href="classk_image_in_d_b.html">kImageInDB</a> reflect the high-resolution image rather than a new, low-resolution image.<p><b>InDesign document-import preferences</b><p>Placing InDesign document directly into an InDesign document has advantages in the publishing workflow, including automatically maintained links, fonts, swatches, links and so on. The <a class="el" href="class_i_import_doc_options.html">IImportDocOptions</a> (IID_IIMPORTDOCOPTIONS) interface allows you to set various InDesign document-import options, like how to crop the pages, which pages to import, and where to display previews. <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> let you set up layer information on the dialog to choose which layer to import.<p>Both <a class="el" href="class_i_import_doc_options.html">IImportDocOptions</a> and <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> are session preferences aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. They also store information to pass to <a class="el" href="classk_import_doc_cmd_boss.html">kImportDocCmdBoss</a>, if you want to use the command directly to place InDesign files. The following table lists some default settings of <a class="el" href="class_i_import_doc_options.html">IImportDocOptions</a>.<table class="doxtable"><tr><th>Preference </th><th>Default value </th></tr><tr><td>Crop </td><td>kCropToPage </td></tr><tr><td>Page number </td><td>1 </td></tr><tr><td>Show preview </td><td>kTrue </td></tr></table><p><b>Image-import filters</b><p>You may have noticed in the table in Overview of the import process that the same <a class="el" href="classk_image_place_provider_boss.html">kImagePlaceProviderBoss</a> is used for importing various kinds of raster images. These raster images have different file formats and, therefore, they need different ways to read data. InDesign provides another level of abstraction: the image-import provider queries for service providers that support kImageReadFormatService. This mechanism also serves as another extension pattern software developers may implement to support new raster-image formats.<p>InDesign implements a set of providers to read various image formats, to import TIF (TIFF), SCT, PSD, PNG, PCX, JPEG (JPG), GIF, and DIB files. These providers serve as the image-import filters. When InDesign is instructed to place an image, it iterates over all the providers until it finds one that can import the image. See the following table for a list of these providers.<table class="doxtable"><tr><th>File type </th><th>Image read-format provider </th></tr><tr><td>TIF </td><td><a class="el" href="classk_t_i_f_f_image_read_format_boss.html">kTIFFImageReadFormatBoss</a></td></tr><tr><td>SCT </td><td><a class="el" href="classk_s_c_t_image_read_format_boss.html">kSCTImageReadFormatBoss</a></td></tr><tr><td>PSD </td><td><a class="el" href="classk_p_s_image_read_format_boss.html">kPSImageReadFormatBoss</a></td></tr><tr><td>PNG </td><td><a class="el" href="classk_p_n_g_image_read_format_boss.html">kPNGImageReadFormatBoss</a></td></tr><tr><td>PCX </td><td><a class="el" href="classk_p_c_x_image_read_format_boss.html">kPCXImageReadFormatBoss</a></td></tr><tr><td>JPEG </td><td><a class="el" href="classk_j_p_e_g_image_read_format_boss.html">kJPEGImageReadFormatBoss</a></td></tr><tr><td>GIF </td><td><a class="el" href="classk_g_i_f_image_read_format_boss.html">kGIFImageReadFormatBoss</a></td></tr><tr><td>DIB </td><td><a class="el" href="classk_d_i_b_image_read_format_boss.html">kDIBImageReadFormatBoss</a></td></tr></table><h3><a class="anchor" id="id_export_to_graphics_file_format"></a> Export to graphics file format</h3><p>InDesign supports exporting all or part of a document to PDF, EPS, SVG, and JPEG formats.<p>All the export processes are alike at a high level: exports are implemented using the <a class="el" href="class_i_export_provider.html">IExportProvider</a> service-provider mechanism. Each type of export destination format provides export services. The following table lists export providers that export to a graphics file format.<table class="doxtable"><tr><th>Export destination </th><th>Export provider </th></tr><tr><td>PDF </td><td><a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a></td></tr><tr><td>EPS </td><td><a class="el" href="classk_e_p_s_export_boss.html">kEPSExportBoss</a></td></tr><tr><td>SVG </td><td>kSVGExportProviderBoss </td></tr><tr><td>JPEG </td><td><a class="el" href="classk_j_p_e_g_export_provider_boss.html">kJPEGExportProviderBoss</a></td></tr></table><p>For examples of export provider implementations, see SDK samples like CHMLFilter, TextExportFilter, and XDocBookWorkflow.<p>Each export provider has a corresponding command that exports content to a desired file format in the following two stages:<ol type="1"><li>Drawing - Drawing page items to an intermediate entity, such as a viewport.<li>Streaming - Writing the content to the provided file stream.</ol><p>Export to PDF and EPS are discussed in detail in the &quot;Exporting to EPS and PDF&quot; section of <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_printing">Printing</a>. PDF import and export also are discussed in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_import_and_export">Import and Export</a>.<p>Only SVG and JPEG export are discussed in this section. The following figure shows high-level activities of SVG and JPEG export.<div class="image"><img alt="plugin-programming-guide-vol1-92.gif" src="plugin-programming-guide-vol1-92.gif" /></div><p><b>SVG export</b><p><b>SVG export preferences</b><p>Settings for SVG export are stored with the <a class="el" href="class_i_s_v_g_export_preferences.html">ISVGExportPreferences</a> interface on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. For details, refer to the API Reference.<p>End users can modify the preferences through the SVG Export Options dialog box. You also can change the preferences programmatically, with the <a class="el" href="classk_s_v_g_export_set_prefs_command_boss.html">kSVGExportSetPrefsCommandBoss</a> command. The following table lists some of the default SVG-export preferences.<table class="doxtable"><tr><th>Preference </th><th>Description </th><th>Default value </th></tr><tr><td>Embed fonts </td><td>Whether to embed fonts in the SVG file </td><td>kTrue </td></tr><tr><td>Embed image </td><td>Whether the image should be embedded in the SVG file </td><td>kTrue </td></tr><tr><td>Export bitmap sampling </td><td>Sampling quality </td><td>kHiResSampling </td></tr><tr><td>Image format </td><td>Image format </td><td>kDefaultImageFormat, which is set to the same as kPNGImageFormat </td></tr><tr><td>JPEG quality </td><td>Image quality </td><td>kJPEGQualityMed </td></tr><tr><td>Page item export </td><td>Whether to export the selected page item only </td><td>kFalse </td></tr><tr><td>Range format </td><td>The range of pages to export </td><td>kAllPages </td></tr></table><p><b>Exporting to SVG format</b><p>InDesign exports to SVG format by drawing page items and documents to a special viewport, <a class="el" href="classk_s_v_g_export_view_port_boss.html">kSVGExportViewPortBoss</a>. For more information about viewports, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_data_model_for_drawing">Data model for drawing</a>. <a class="el" href="classk_s_v_g_export_command_boss.html">kSVGExportCommandBoss</a> aggregates ISVGExportController, which controls the drawing process and hides much of the complexity involved in SVG export. <a class="el" href="classk_s_v_g_export_view_port_boss.html">kSVGExportViewPortBoss</a> aggregates ISVGWriterAccess, which helps in writing contents to an SVG file stream.<p><b>JPEG export</b><p><b>JPEG export preferences</b><p>Settings for JPEG export are stored with the IJPEGExportPreferences interface on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. For details, refer to the API Reference.<p>End users can modify the preferences through the JPEG Export Options dialog box. You also can change the preferences programmatically, with the <a class="el" href="classk_j_p_e_g_export_set_prefs_command_boss.html">kJPEGExportSetPrefsCommandBoss</a> command. The following table lists some of the default JPEG-export preferences.<table class="doxtable"><tr><th>Preference </th><th>Description </th><th>Default value </th></tr><tr><td>Export bitmap sampling </td><td>Sampling quality </td><td>kHiResSampling </td></tr><tr><td>JPEG quality </td><td>Image quality </td><td>kJPEGQualityMed </td></tr><tr><td>Range format </td><td>The range of pages to export </td><td>kAllPages </td></tr></table><p><b>Exporting to JPEG format</b><p><a class="el" href="classk_j_p_e_g_export_command_boss.html">kJPEGExportCommandBoss</a> creates a <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> object and draws document contents on it. <a class="el" href="classk_j_p_e_g_export_command_boss.html">kJPEGExportCommandBoss</a> then calls <a class="el" href="class_snapshot_utils_ex.html#aa0b9039b572c6ffa53db89870df5648c">SnapshotUtilsEx::ExportImageToJPEG</a> to write to the file stream. <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> also has methods to export to TIFF and GIF formats, so you can export to TIFF and GIF if you write your own export command, though you may need to provide your own image-write format boss. In the case of JPEG, the write-format boss provided is <a class="el" href="classk_j_p_e_g_image_write_format_boss.html">kJPEGImageWriteFormatBoss</a>. For more information on <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a>, see Snapshots. For use of SnapshotUtils (the older version of <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a>, see the Snapshot SDK sample plug-in).<dl class="section note"><dt>Note<dd>Multiple JPEG files are created for documents with multiple pages.</dl><h2><a class="anchor" id="id_colors_and_swatches"></a> Colors and swatches</h2><p>This section examines the data model for swatches, colors, and gradients.<h3><a class="anchor" id="id_architecture"></a> Architecture</h3><p>This section covers the representation of color, a fundamental graphic property, in the InDesign API. When we talk about color in the context of InDesign, we refer to the following:<ul><li>A color system refers to how colors and gradients are represented and printed and how to achieve consistent color throughout different applications and different devices. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_color_management">Color management</a>.<li>A rendering attribute of a page item refers to how a color or gradient can be used to render a page item<li>&#39;s graphic attributes, like stroke and fill. See <a class="el" href="id_solutions.html#id_graphic_attributes">Graphic attributes</a>.</ul><p>The following figure shows some key color-related concepts and how they appear in the user interface.<div class="image"><img alt="plugin-programming-guide-vol1-93.gif" src="plugin-programming-guide-vol1-93.gif" /></div><p>The following figure shows some of the key color-related concepts and the relationships among them.<div class="image"><img alt="plugin-programming-guide-vol1-94.gif" src="plugin-programming-guide-vol1-94.gif" /></div><p>The following figure is a UML class diagram involving color-related boss classes. It shows the relationship among color and swatch&acirc;&#128;&#147;related boss classes. The relationships also apply if you replace <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> with <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<div class="image"><img alt="plugin-programming-guide-vol1-95.gif" src="plugin-programming-guide-vol1-95.gif" /></div><p>Comparing this figure to the to the conceptual diagrams, note the following:<ul><li>The <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> is used here to show where these boss classes belong. These interfaces also exist on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<li>The boss objects of type <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> and <a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a> and other classes represent swatches directly. <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> is the signature interface.<li><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> implements solid color, tint, mixed ink, process color, and spot color.</ul><p>When swatches are created, modified, or deleted, the state of the swatch list changes. For a detailed discussion of these changes, see Swatch-list state.<h3><a class="anchor" id="id_swatches"></a> Swatches</h3><p>A swatch is an abstraction that can represent a color, gradient, tint or mixed ink.<p>A rendering object implements the <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> interface. <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> represents information about a color or gradient and exposes capabilities to render this information to a device. The following are some of the boss classes that expose the <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> interface:<ul><li><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> represents colors (including tint and mixed ink)<li><a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a> represents gradient.<li><a class="el" href="classk_graphic_state_none_rendering_object_boss.html">kGraphicStateNoneRenderingObjectBoss</a> represents the absence of rendering information; for example, this boss can represent no-fill or no-stroke attributes. This boss is used internally.<li><a class="el" href="classk_a_g_m_black_box_rendering_object_boss.html">kAGMBlackBoxRenderingObjectBoss</a> is used for special page items created from Adobe Illustrator &reg; clipboard format. It is only for internal use.</ul><p>Some methods of <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> take an <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> item as an argument. <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> is an interface with methods that parallel PostScript operators like setcolorspace. The key responsibility of the rendering object implementation is to set up the color space, tint, and color components to draw to the graphics port. <a class="el" href="class_i_rendering_object_apply_action.html">IRenderingObjectApplyAction</a> is another required interface on rendering objects. For more details on <a class="el" href="class_i_rendering_object.html">IRenderingObject</a>, <a class="el" href="class_i_rendering_object_apply_action.html">IRenderingObjectApplyAction</a>, <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a>, and the other interfaces on rendering object boss classes, refer to the API Reference.<h3><a class="anchor" id="id_solid_colors"></a> Solid colors</h3><p>Color is represented by the <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> class, responsible for representing solid colors, including tints and mixed inks. In addition to the signature interface for a rendering object, <a class="el" href="class_i_rendering_object.html">IRenderingObject</a>, <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> aggregates several other interfaces, including the following:<ul><li><a class="el" href="class_i_color_overrides.html">IColorOverrides</a> - Stores tint and color remarks so the <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> also can represent tint and special color types (for example, reserved color). For details, refer to the API Reference.<li><a class="el" href="class_i_ink_data.html">IInkData</a> - Stores the ink information used by the color. InkType represents color type (process or spot).<li><a class="el" href="class_i_color_data.html">IColorData</a> - Represents color coordinates in a ColorArray vector and a color space.</ul><p>There are three color spaces of interest:<ul><li>CMYK defines a color with four components: cyan, magenta, yellow, and black. Typically, these components are represented by percentages.<li>RGB represents colors with three components: red, green, and blue. Typically, these components are represented by values between 0 and 255.<li>LAB (more precisely, L*a*b*) is a device-independent color space</ul><p>See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_color_management">Color management</a>.<h3><a class="anchor" id="id_gradients"></a> Gradients</h3><p>Gradients are represented by the <a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a> boss class, which aggregates <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> as well as <a class="el" href="class_i_gradient_fill.html">IGradientFill</a>, representing gradient-specific properties. For details, refer to the API Reference.<p>Gradients can be linear or radial; see the enum declaration of GradientType in <a class="el" href="_graphic_types_8h_source.html">GraphicTypes.h</a>. A gradient consists of one or more ranges of color, which are smooth interpolations between gradient stop positions. The color is defined only at the gradient stop positions, with calculated color values at intermediate positions. For more detail on working with gradients, see &quot;Gradients&quot; in InDesign Help.<h3><a class="anchor" id="id_swatch_lists"></a> Swatch lists</h3><p>Rendering objects (<a class="el" href="class_i_rendering_object.html">IRenderingObject</a>) are referenced in a swatch list (<a class="el" href="class_i_swatch_list.html">ISwatchList</a>). The swatch list (<a class="el" href="class_i_swatch_list.html">ISwatchList</a>) is exposed on workspaces (<a class="el" href="class_i_workspace.html">IWorkspace</a>). For examples of the swatch list (and ink list) when an end user creates and applies swatches to page items in a document, see Swatch-list state.<p>If you create a color through the Color panel, or create a new gradient through the Gradient panel and then apply the gradient to a page item without creating a swatch beforehand, an unnamed (or local) swatch is created in the swatch list. The unnamed swatches do not appear in the Swatches panel, but they can be used for the strokes and fills of document objects by client code.<p><b>User-interface color list</b><p>Colors and color names that appear in the application user interface in places like the Layers panel and Tags panel are not the same ones used in representing color in the document. User-interface colors also are stored in an <a class="el" href="class_i_swatch_list.html">ISwatchList</a> interface on workspaces (<a class="el" href="class_i_workspace.html">IWorkspace</a>), but with the interface identifier IID_IUICOLORLIST.<p>User-interface colors are normally RGB only. A key utility interface for working with user-interface colors is <a class="el" href="class_i_u_i_color_utils.html">IUIColorUtils</a>. User-interface colors are represented by <a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a> rather than a rendering-object boss class.<h3><a class="anchor" id="id_inks"></a> Inks</h3><p>Colors are ultimately printed by means of inks; for example, CMYK color separation is performed before printing to a four-color press. Inks are represented by the <a class="el" href="classk_p_m_ink_data_boss.html">kPMInkDataBoss</a> boss class.<p>The rendering object classes like <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> or <a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a> aggregate the <a class="el" href="class_i_ink_resources.html">IInkResources</a> interface, with which you can refer to the inks used in a color (or other page item) by using the <a class="el" href="class_i_ink_resources.html#a0dd35c48ffbc884676a6e728f237f95f">IInkResources::GetUsedInks</a> method, then querying for IPMInkDataBoss.<p><a class="el" href="class_i_ink_data.html#a050ed72f82edfb851847c3edf8ce414a">IInkData::GetInkUIDList</a> returns an empty list when the color type is process. <a class="el" href="class_i_ink_data.html">IInkData</a> is an interface on <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a>.<p>There is an <a class="el" href="class_i_ink_list.html">IInkList</a> interface on the workspace boss classes that specifies the inks needed for all swatches in the document and application. The ink list contains process inks and zero or more spot inks.<p>The relation between inks and the swatch list is fairly direct: adding a new spot color to the swatch list and applying it to a document object results in a new entry in the ink list. However, creating another swatch that is a process color and applying it does not necessarily change the entries in the ink list, if the process inks needed to print this new color already are in the ink list.<p>The ink-manager feature (Ink Manager in the Swatches panel menu) shows the inks associated with the contents of the swatch list. For example, if the swatches in the document were defined in terms of four process colors and two spot colors, the ink-manager user interface is similar to that shown in the following figure. For information on how to work with the ink manager and iterate through the ink list, see the &quot;Graphics&quot; chapter of Adobe InDesign SDK Solutions.<div class="image"><img alt="plugin-programming-guide-vol1-96.gif" src="plugin-programming-guide-vol1-96.gif" /></div><p>It is necessary to preflight documents to ensure they print correctly when submitted to the press. As far as color is concerned, it is necessary to identify the inks that must be loaded in the press for a job to print correctly.<h2><a class="anchor" id="id_color_management"></a> Color management</h2><p>The purpose of color management is to get accurate color on all kinds of devices. Color-management modules provide color-conversion calculations from one device&#39;s color space to another, based on ICC device profiles. For detailed descriptions of the color spaces used by InDesign, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_color_spaces">Color spaces</a>.<h3><a class="anchor" id="id_icc_profiles"></a> ICC profiles</h3><p>An ICC profile is a record of the unique color characteristics of a color input or output device. An ICC profile contains data for the translation of device-dependent color to L*a*b* color. The following illustrates the concept of translation from the L*a*b* color space to RGB and CMYK color spaces using ICC profiles:<ul><li>L*a*b* = RGB + ICC profile<li>L*a*b* = CMYK + ICC profile</ul><p>With an ICC profile, color-management systems can do the following:<ul><li>Translate a user-defined, device-specific color to a device-independent, L*a*b* color. For example, if the user creates an RGB color for a specific computer monitor, that color could be translated to L*a*b*.<li>Translate a L*a*b* color to a device-specific color. For example, when printing to a printer, the L*a*b* color is translated to a CMYK color.</ul><h3><a class="anchor" id="id_color-management_workflow"></a> Color-management workflow</h3><p>Color management within InDesign is relatively complex because of the following:<ul><li>InDesign supports multiple color spaces per document. For example, a user could assign text in one paragraph an RGB color, another paragraph a CMYK color, and so on.<li>InDesign supports external links (by means of <a class="el" href="class_i_link.html">ILink</a>) to assets that can have different color settings than those used in the document.</ul><p>There are three levels of ICC profile sets involved in InDesign:<ul><li>Image ICC profile - This is embedded in the image file when the image is created.<li>Document ICC profile - This is associated with a particular InDesign document.<li>Application ICC profile preference - This is the default profile of the application. The default profile is assigned to any new document.</ul><p>InDesign features relating to color management are described comprehensively in &quot;Color Management&quot; in InDesign Help.<h3><a class="anchor" id="id_data_model_for_color_management"></a> Data model for color management</h3><p>The implementation of color management is somewhat complex. The class diagram in the following figure illustrates some color management-related boss class relationships in InDesign.<div class="image"><img alt="plugin-programming-guide-vol1-97.gif" src="plugin-programming-guide-vol1-97.gif" /></div><p><b>Color presets</b><p>Outside the application, predefined Adobe color-management settings are stored in color preset files, which are saved at the following location:<ul><li>Windows: <div class="fragment"><div class="line">Program Files\Common Files\Adobe\Color\Settings\</div></div><li>Mac OS: <div class="fragment"><div class="line">Library/Application Support/Adobe/Color/Settings</div></div></ul><p>These presets are shared among all Adobe Creative Suite &reg; applications, to make it easier to achieve consistent color across the suite. The <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> boss class aggregates the <a class="el" href="class_i_color_presets_manager.html">IColorPresetsManager</a> interface, which is responsible for managing the presets, like loading color preset files and saving customized presets. The settings of the current preset are populated into the <a class="el" href="class_i_color_presets_settings.html">IColorPresetsSettings</a> interface on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<p>The <a class="el" href="class_i_color_presets_settings.html">IColorPresetsSettings</a> interface stores the working color-management settings of the application, like RGB and CMYK, the ICC profile, and color-management policies. In the user interface, the color-management settings are accessed through the Color Settings dialog box.<p><b>Color profile</b><p>The <a class="el" href="classk_c_m_s_profile_boss.html">kCMSProfileBoss</a> boss class represents a color profile. The <a class="el" href="class_i_c_m_s_profile.html">ICMSProfile</a> interface on <a class="el" href="classk_c_m_s_profile_boss.html">kCMSProfileBoss</a> stores information about the type and category of the profile. This interface has a method for getting and setting profile data by accessing the IACESpecificProfileData interface on the same boss.<p>The <a class="el" href="class_i_c_m_s_profile_list.html">ICMSProfileList</a> interface, exposed on workspaces (<a class="el" href="class_i_workspace.html">IWorkspace</a>), indicates which profiles are used, as either document profiles or image profiles, and which are assigned to specific document categories (for example, document CMYK and document RGB). A profile can be assigned to each category of a document through Edit &gt; Assign Profiles.<p><b>Image settings</b><p>Any imported image can have either an embedded profile or a profile already assigned to it. (See Object &gt; Image Color Settings.) The <a class="el" href="class_i_c_m_s_item_profile_source.html">ICMSItemProfileSource</a> interface aggregated on the <a class="el" href="classk_image_base_item.html">kImageBaseItem</a> boss class stores the basic profile-assignment type (see the enumeration ICMSItemProfileSource::ProfileSourceType) and the name of the image&#39;s embedded profile, if any.<p>If an image uses an external profile or an embedded profile, an interface <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> (with interface identifier IID_ICMSPROFILEUID) stores the UID of an instance of <a class="el" href="classk_c_m_s_profile_boss.html">kCMSProfileBoss</a>, so you will be able to instantiate an interface on <a class="el" href="classk_c_m_s_profile_boss.html">kCMSProfileBoss</a> from this UID and get the profile data needed.<p>There is no link from a specific profile to the images that use that profile. To find the images that use a specific profile in the profile list, you need to iterate through all images using the links manager (<a class="el" href="class_i_links_manager.html">ILinksManager</a>).<p><b>Rendering intent</b><p>The <a class="el" href="class_i_c_m_s_settings.html">ICMSSettings</a> interface is aggregated on docworkspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) and the <a class="el" href="classk_image_base_item.html">kImageBaseItem</a> boss class, a superclass for image boss classes, which stores rendering-intent information for document and image page item. Please use the <a class="el" href="class_i_c_m_s_utils.html">ICMSUtils</a> interface to set rendering intent, rather than manipulating the <a class="el" href="class_i_c_m_s_settings.html">ICMSSettings</a> interface directly.<p>For application defaults, rendering intent are determined by <a class="el" href="class_i_color_presets_settings.html">IColorPresetsSettings</a> interface aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. You can use GetIntent and SetIntent methods to manipulate rendering intent.<p><b>Proofing</b><p>The <a class="el" href="class_i_c_m_s_proofing.html">ICMSProofing</a> interface is aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, <a class="el" href="classk_document_presentation_boss.html">kDocumentPresentationBoss</a>, and several user-interface panels. The implementation on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> is a proofing preference, and the implementation on <a class="el" href="classk_document_presentation_boss.html">kDocumentPresentationBoss</a> is responsible for setting up drawing when users choose to proof their design using the Proof Setup dialog box. This <a class="el" href="class_i_c_m_s_proofing.html">ICMSProofing</a> interface stores the proofing settings as well as a proofing profile.<h2><a class="anchor" id="id_graphic_attributes"></a> Graphic attributes</h2><p>A graphic attribute describes an aspect of how a page item should be drawn. There are many kinds of graphic attribute for properties like stroke color, fill color, stroke type, and stroke weight. This section introduces the concepts involved and describes specific sets of graphic attributes for features like page-item rendering.<h3><a class="anchor" id="id_graphic-attribute_data_model"></a> Graphic-attribute data model</h3><p>The following figure is a conceptual model of the graphic attributes associated with a page item.<div class="image"><img alt="plugin-programming-guide-vol1-98.gif" src="plugin-programming-guide-vol1-98.gif" /></div><p>A page item owns a collection of graphic attributes, specifying properties that control how the page item is drawn, like stroke color, stroke style, and transparency. Each attribute is responsible for a single aspect of how the page item is drawn. A list of graphic attributes is represented by <a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a>.<p>The following figure shows the graphic-attribute UML class model of a drawable page item.<div class="image"><img alt="plugin-programming-guide-vol1-99.gif" src="plugin-programming-guide-vol1-99.gif" /></div><p>There are several important interfaces on a page item responsible for managing graphic attributes:<ul><li><a class="el" href="class_i_graphic_state_is_applicable.html">IGraphicStateIsApplicable</a>.<li><a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a> (IID_IGRAPHICSTYLE_OVERRIDES), which stores a list of graphic attributes that override those stored in a graphic style.<li><a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a>.<li><a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a>.<li><a class="el" href="class_i_graphic_style_reference.html">IGraphicStyleReference</a>.</ul><p>For details on each interface&#39;s responsibilities, refer to the API Reference.<h3><a class="anchor" id="id_representation_of_graphic_attributes"></a> Representation of graphic attributes</h3><p>Graphic attributes are represented by boss classes with the signature interface <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a>. The graphic attributes in the application appear in the API Reference for <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a>. Typically, they derive from the <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a> boss class.<p>The <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a> interface stores the name and type of the attribute. Some graphic attributes have corresponding text and table attributes. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_mapping_graphic_attributes_between_domains">Mapping graphic attributes between domains</a>.<p>Graphic attributes have additional data interfaces that specify their values. Because there are many graphic attributes, sometimes it is a challenge to determine which attribute boss corresponds to which attribute. For a description of attributes, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_catalog_of_graphic_attributes">Catalog of graphic attributes</a>.<p>Most of the attributes represent a single value, like a Boolean, int16, int32, <a class="el" href="class_p_m_point.html">PMPoint</a>, or <a class="el" href="class_p_m_real.html">PMReal</a>. These simple attributes generally are backed by interfaces like <a class="el" href="class_i_graphic_attr_boolean.html">IGraphicAttrBoolean</a>, <a class="el" href="class_i_graphic_attr_int16.html">IGraphicAttrInt16</a>, <a class="el" href="class_i_graphic_attr_int32.html">IGraphicAttrInt32</a>, <a class="el" href="class_i_graphic_attr_point.html">IGraphicAttrPoint</a>, and <a class="el" href="class_i_graphic_attr_real_number.html">IGraphicAttrRealNumber</a>. For example, <a class="el" href="classk_graphic_style_even_odd_attr_boss.html">kGraphicStyleEvenOddAttrBoss</a> (<a class="el" href="class_i_graphic_attr_boolean.html">IGraphicAttrBoolean</a>) corresponds to the even-odd fill rule when you have a compound path; set it to kTrue to use the even-odd rule or to kFalse to use the default InDesign fill rule (nonzero winding fill rule).<p>Some other attributes have UID values. For example, attributes related to object rendering refer to a rendering object through the <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> interface. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_rendering_attributes">Rendering attributes</a>.<p>Some other attributes have ClassID values, which are all stored with <a class="el" href="class_i_graphic_attr_class_i_d.html">IGraphicAttrClassID</a>. These attributes are used to specify stroke effects of a page item. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_stroke_effects">Stroke effects</a>.<h3><a class="anchor" id="id_graphic_styles"></a> Graphic styles</h3><p>A graphic style (<a class="el" href="classk_graphic_style_boss.html">kGraphicStyleBoss</a>, UID-based) is a collection of graphic attributes. The <a class="el" href="class_i_graphic_style_name_table.html">IGraphicStyleNameTable</a> interface exposed on workspaces (<a class="el" href="class_i_workspace.html">IWorkspace</a>) stores the names and UIDs of graphic styles.<p>There are two key interfaces on <a class="el" href="classk_graphic_style_boss.html">kGraphicStyleBoss</a>:<ul><li><a class="el" href="class_i_graphic_style_info.html">IGraphicStyleInfo</a> stores the name and UID for the style on which this style is based (the style from which this style inherits).<li><a class="el" href="class_i_graphic_style_attribute_boss_list.html">IGraphicStyleAttributeBossList</a> (IID_IGRAPHICSTYLE_DEFINITION) stores the list of graphic attributes this graphic style owns.</ul><p>Only [No Style] is used in InDesign and InCopy. <a class="el" href="classk_graphic_style_none_boss.html">kGraphicStyleNoneBoss</a> implements the default [No Style], which is set up during application start-up (for the session workspace) and document creation (for document workspace). This style stores default settings of various graphic attributes, like stroke weight as 1.0 and stroke type as solid line.<p>Although there still is a public API to work with user-named graphic styles, these are deprecated since the introduction of object styles. Adobe applications do not define user-named styles using graphic styles as the container. We recommend you avoid using graphic styles for this purpose in your plug-ins. User-named styles are supported by the object styles feature.<p>An object style is a style that defines the appearance of a page-item object. An object style contains settings of a set of attributes, including graphic attributes and text attributes. An object style is a superset of graphic style.<h3><a class="anchor" id="id_graphic_state"></a> Graphic state</h3><p>Graphic state is the representation of the current state of things related to the graphic attributes. Usually this is a collection of graphic attributes for the current selection or, if there is no selection, the current defaults. The graphic state is represented by <a class="el" href="classk_graphic_state_boss.html">kGraphicStateBoss</a>.<p>An active graphic state refers to the graphic state at the current context. Active graphic state can be accessed through <a class="el" href="class_i_graphic_state_accessor.html">IGraphicStateAccessor</a>, aggregated on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> or <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. A reference to an interface of the active graphic state also can be acquired through <a class="el" href="class_i_graphic_state_utils.html#aa7cc5c674a358de7abf4db4945f67eb4">IGraphicStateUtils::QueryActiveGraphicState</a>, aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>.<p>The <a class="el" href="classk_graphic_state_boss.html">kGraphicStateBoss</a> boss class aggregates interfaces like <a class="el" href="class_i_graphic_state_render_objects.html">IGraphicStateRenderObjects</a> and <a class="el" href="class_i_graphic_state_data.html">IGraphicStateData</a>.<p><b><a class="el" href="class_i_graphic_state_render_objects.html">IGraphicStateRenderObjects</a></b><p>This interface is key to the graphic state. It can be acquired from the <a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a> utility interface by querying active graphic state or the graphic state of a specific database. For sample code that shows how to acquire the interface, see the &quot;Graphics&quot; chapter of Adobe InDesign SDK Solutions.<p>Given this interface, you can query the current <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> interface for the specified rendering class or the active rendering class in the graphic state. The active rendering could be fill or stroke.<p><b>Changing the graphic state</b><p>Changing any graphic attributes changes the graphic state. Virtually every user-interface action-like selecting a new swatch, picking a color in the Color Picker panel, switching fill and stroke, selecting a different stroke style, changing selection, or changing the front document-causes a change to current active graphic state. You can use methods on <a class="el" href="class_i_graphic_attribute_utils.html">IGraphicAttributeUtils</a> or IGraphicSta teUtils to acquire appropriate commands.<p><a class="el" href="classk_graphic_state_boss.html">kGraphicStateBoss</a> also aggregates an <a class="el" href="class_i_subject.html">ISubject</a> interface. Changes to the graphic state can be observed by listening along the IID_IGRAPHICSTATE_RENDEROBJECTS and IID_IGRAPHICSTATE_DATA protocols.<p><b>Creating new page items using default attributes</b><p>When a new page item is created, default attributes in the graphic-state boss objects are copied and applied to new page items when you specify INewPageitemCmdData::kDefaultGraphicAttributes as attrType parameter on spline creation methods on <a class="el" href="class_i_path_utils.html">IPathUtils</a>.<h3><a class="anchor" id="id_mapping_graphic_attributes_between_domains"></a> Mapping graphic attributes between domains</h3><p>Some graphic attributes also can be applied to text or tables. For example, the following figure shows stroke and fill colors and gradients applied to text, table cells, and a spline item. Although the intent is the same in each case, the attributes differ in each case. Text and tables have some attributes corresponding to the graphic attributes.<div class="image"><img alt="plugin-programming-guide-vol1-100.gif" src="plugin-programming-guide-vol1-100.gif" /></div><p>There are independent attributes for each of these domains. For example, an attribute represented by <a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a> on a spline page item is represented by the <a class="el" href="classk_cell_attr_fill_color_boss.html">kCellAttrFillColorBoss</a> type when the attribute is applied to a table cell, and it is represented by the <a class="el" href="classk_text_attr_color_boss.html">kTextAttrColorBoss</a> type when the attribute is applied to a text run.<p>When a graphic attribute is applied to a text run, there is a conversion process in which a new text attribute is applied as an override to the run. The same applies when trying to apply a graphic attribute to a table; the graphic attribute can be converted to a corresponding table attribute.<p>Not all graphic attributes apply to text or tables. The <a class="el" href="class_i_graphic_attribute_info.html#a2fa6a39c29fee1ac60e62e96780a2b37">IGraphicAttributeInfo::IsTextAttribute</a> and <a class="el" href="class_i_graphic_attribute_info.html#a718bae93a8d818af4c9e7745bcf6bd77">IGraphicAttributeInfo::IsTableAttribute</a> methods return kTrue if the corresponding attribute in the respective domain exists. <a class="el" href="class_i_graphic_attribute_info.html#a775b4516ffa67c0595d38447067a4183">IGraphicAttributeInfo::CreateTextAttribute</a> returns a text attribute that maps onto the equivalent graphic attribute. Similarly, <a class="el" href="class_i_graphic_attribute_info.html#afd786d5105f5abae7c675fe8ed5d7b96">IGraphicAttributeInfo::CreateTableAttribute</a> returns a table attribute that maps onto the equivalent graphic attribute. Each of these methods is expected to return a nonzero value if the Is &lt;XXX&gt;Attribute method returns kTrue.<p>The selection suites (for example, <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a> and <a class="el" href="class_i_gradient_attribute_suite.html">IGradientAttributeSuite</a>) make it straightforward for client code to change the properties of a selection; the client code needs to work with only the graphic attributes. There is no need to worry about whether the selection is text, choosing the specific text attribute, and whether the selection is text, table, or layout.<p>The mapping between different domains is hard-coded. New graphic attributes added by third-party software developers may provide their own mapping by overriding the default implementations of <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a>. The mappings between graphic attributes and text attributes, and between graphic attributes and table attributes, are shown in the tables in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_mappings_between_attribute_domains">Mappings between attribute domains</a>. Note that the mapping between graphic attributes and table attributes is many-to-one rather than one-to-one because; for example, the <a class="el" href="classk_cell_stroke_attr_data_boss.html">kCellStrokeAttrDataBoss</a> boss class can represent information about multiple stroke parameters, whereas each of the corresponding graphic attributes refers to one parameter.<h2><a class="anchor" id="id_rendering_attributes"></a> Rendering attributes</h2><p>A rendering attribute refers to a swatch to be used when drawing an aspect of a page item. Rendering attributes are a special kind of graphic attribute that refer to their associated swatch by UID. The swatch can be a color, gradient, tint, etc.<h3><a class="anchor" id="id_color-rendering_attributes"></a> Color-rendering attributes</h3><p>A page item&#39;s stroke, fill, or gap can be rendered independently. The following table lists color-rendering attributes.<table class="doxtable"><tr><th>Rendering-attribute class </th><th>Description </th></tr><tr><td><a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a></td><td>Fill rendering object </td></tr><tr><td><a class="el" href="classk_graphic_style_fill_tint_attr_boss.html">kGraphicStyleFillTintAttrBoss</a></td><td>Fill tint </td></tr><tr><td><a class="el" href="classk_graphic_style_gap_rendering_attr_boss.html">kGraphicStyleGapRenderingAttrBoss</a></td><td>Gap rendering object </td></tr><tr><td><a class="el" href="classk_graphic_style_gap_tint_attr_boss.html">kGraphicStyleGapTintAttrBoss</a></td><td>Gap tint </td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_rendering_attr_boss.html">kGraphicStyleStrokeRenderingAttrBoss</a></td><td>Stroke rendering object </td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_tint_attr_boss.html">kGraphicStyleStrokeTintAttrBoss</a></td><td>Stroke tint </td></tr></table><h3><a class="anchor" id="id_gradient_attributes"></a> Gradient attributes</h3><p>Page items also can be rendered using gradients; however, multiple graphic attributes are needed to represent a gradient. For example, you need to specify gradient fill angle, center, and length. There is no characteristic signature for a gradient attribute other than the boss class name; for the canonical graphic attributes, the boss-class name is of the following form: <div class="fragment"><div class="line">kGraphicStyleGradient&lt;graphic_attribute&gt;AttrBoss.</div></div><p>A list of these boss classes is in the master attributes list in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_catalog_of_graphic_attributes">Catalog of graphic attributes</a>.<p>You can use the same color-rendering attributes class name to apply gradient attributes to page items. <a class="el" href="class_i_rendering_object_apply_action.html#a9f8c6c4d13e8b907fc8f8b88dcffcafc">IRenderingObjectApplyAction::PreGraphicApply</a> automatically forwards the attributes to appropriate gradient attributes. For example, if you are supplying <a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a>, the method adds attributes including the following:<ul><li><a class="el" href="classk_graphic_style_gradient_fill_angle_attr_boss.html">kGraphicStyleGradientFillAngleAttrBoss</a><li><a class="el" href="classk_graphic_style_gradient_fill_grad_center_attr_boss.html">kGraphicStyleGradientFillGradCenterAttrBoss</a><li><a class="el" href="classk_graphic_style_gradient_fill_hilite_angle_attr_boss.html">kGraphicStyleGradientFillHiliteAngleAttrBoss</a><li><a class="el" href="classk_graphic_style_gradient_fill_hilite_length_attr_boss.html">kGraphicStyleGradientFillHiliteLengthAttrBoss</a><li><a class="el" href="classk_graphic_style_gradient_fill_length_attr_boss.html">kGraphicStyleGradientFillLengthAttrBoss</a><li><a class="el" href="classk_graphic_style_gradient_fill_radius_attr_boss.html">kGraphicStyleGradientFillRadiusAttrBoss</a></ul><p>The situation gets more complicated by the possibility of applying gradients to table cells; when a gradient is applied to a table cell, additional cell-specific attributes are involved. For example, <a class="el" href="classk_cell_attr_gradient_fill_boss.html">kCellAttrGradientFillBoss</a> and <a class="el" href="classk_cell_attr_gradient_stroke_boss.html">kCellAttrGradientStrokeBoss</a> are table-cell attributes representing properties of gradients.<h2><a class="anchor" id="id_stroke_effects"></a> Stroke effects</h2><p>There are several graphic attributes that define the look and feel of the stroke of a page item. Some of these attributes are straightforward, like <a class="el" href="classk_graphic_style_stroke_weight_attr_boss.html">kGraphicStyleStrokeWeightAttrBoss</a>, which defines stroke weight.<h3><a class="anchor" id="id_path_stroker"></a> Path stroker</h3><p>A path stroker is responsible for the basic drawing of a path. To find existing path-stroker boss classes, refer to the API Reference for <a class="el" href="class_i_path_stroker.html">IPathStroker</a>. For information on how to add custom path strokers, see Custom path-stroker effects.<p><a class="el" href="class_i_path_stroker_list.html">IPathStrokerList</a> allows you to access the list of available path strokers. <a class="el" href="class_i_path_stroker_utils.html">IPathStrokerUtils</a> provides utility methods to do the same thing.<p>The <a class="el" href="classk_graphic_style_stroke_line_impl_attr_boss.html">kGraphicStyleStrokeLineImplAttrBoss</a> boss class specifies the class ID of a path stroker that applies to a particular path.<h3><a class="anchor" id="id_path_corners"></a> Path corners</h3><p>A path-corner effect draws the corners of a stroked path. For a list of path-corner-effect boss classes, refer to the API Reference for <a class="el" href="class_i_path_corner.html">IPathCorner</a>. For information on how to add custom path corners, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_custom_corner_effects">Custom corner effects</a>.<p>The kGraphicStyleCornerImplAttrBoss boss class specifies the class ID of the corner effect.<h3><a class="anchor" id="id_path-end_strokers"></a> Path-end strokers</h3><p>A path-end stroker (<a class="el" href="class_i_path_end_stroker.html">IPathEndStroker</a>) draws the start and end of a stroked path. To find path-end strokers, refer to the API Reference for <a class="el" href="class_i_path_end_stroker.html">IPathEndStroker</a>. For information on how to add custom path ends, see Custom path-end effects.<p>The <a class="el" href="classk_graphic_style_line_end_start_attr_boss.html">kGraphicStyleLineEndStartAttrBoss</a> boss class specifies the class ID of the line-end (for example, arrow) style at the starting side of a line. The <a class="el" href="classk_graphic_style_line_end_end_attr_boss.html">kGraphicStyleLineEndEndAttrBoss</a> boss class specifies the class ID of the line-end style at the terminating side of a line.<h2><a class="anchor" id="id_transparency_effects"></a> Transparency effects</h2><h3><a class="anchor" id="id_concepts"></a> Concepts</h3><p>Transparency effects are a set of graphic attributes that define color blending for overlapped page items and backgrounds. Common transparency effects include basic transparency, drop shadow, and feather. The following figure shows examples of transparency effects supported in InDesign.<div class="image"><img alt="plugin-programming-guide-vol1-101.gif" src="plugin-programming-guide-vol1-101.gif" /></div><p>These transparency effects can be divided into two classes:<ul><li>Outer effects include drop shadow, outer glow, and outer bevel, and emboss. In this class of effects, a copy of the artwork is converted to raster; the raster has the effects applied and is then drawn first, the artwork is then drawn on top of the effect. (The exception is emboss, in which artwork is dean first then the effect is drawn on top)<li>Inner (clipped) effects include inner shadow, inner glow, inner bevel, satin, and feathers. The artwork fill and shape is combined with the effect parameters, and the result is a new fill for the artwork. Because the fill is clipped to the artwork shape, this class of effect is highly dependent on the type of artwork involved.</ul><p><b>Common controlling parameters</b><p>Different transparency effects are controlled by different sets of parameters, Some of these parameters are used commonly in defining different transparency effects.<p><b>Opacity</b><p>Opacity is the converse of transparency. It represented by the following formula:<p>opacity = (1.0 - transparency)<p>Opacity is expressed as a percentage, where 0% is completely clear and 100% is completely opaque. Page items can have individual opacities assigned to them. Items can be grouped and have a group opacity assigned, which is combined with the individual opacities to calculate the resultant color on the backdrop.<p><b>Blending mode</b><p>Blending mode defines how the background (backdrop) and foreground (source) colors interact. In the physical world, transparency is the result of light passing through translucent materials. Blending modes are somewhat different: they do not try to model the complex physics of transparency; rather, they are analytic expressions that produce interesting visual effects. The following blending modes are encountered often: normal, multiply, and screen. There also are blending modes related to color spaces, like hue, saturation, and color-blending modes.<p>Blending modes are vector functions that take as input the object source color and backdrop color and produce a resulting color that is the new color of the backdrop. This is not pixel-based blending; rather, this is in terms of points with no dimension. The colors that are the input for a blending function need to be specified in a common blending-color space (document CMYK or RGB). This is specified document-wide through the Edit menu.<p>A blending mode is described by an analytic expression that specifies how to calculate the resultant backdrop color given the mode, current backdrop color, foreground color, and opacities of the background and foreground. Ordinarily, a blending function is a vector function:<p>C_r = F(Mode, C_b, C_f, O_b, O_f)<p>where C_r is the resultant backdrop color, Mode is the blending mode, C_b is the current backdrop color, O_b is the opacity of the backdrop, and O_f is the opacity of the foreground (source object).<p>In general, the blending function gives the resulting color at a point. The two-dimensional coordinates in the backdrop plane also can be specified in the expression above, to give an exhaustive expression for a blending function.<p>Normal blending mode is a trivial blending mode, which specifies that the resulting blend is the value of the source color. The result of a normal blend is given by the following formula:<p>B(C_b, C_s) = C_s<p>where B is the blending function, C_b is the backdrop color, and C_s the source-object color.<p>Multiply-blending mode is the scalar product of the backdrop color and the source object color. For an additive color space like RGB, the multiply-blending mode is calculated by taking the component-wise product of the two vectors. The multiply blending mode is given by the following formula:<p>B(C_b,C_s) = C_b&acirc;&#128;&cent;C_s<p>With an additive color space, the resulting blend color is darker than either of the two inputs, so the multiply-blending mode also is referred to as shadow mode.<p>For a subtractive color space like CMYK, it is necessary to take the reciprocal of the colors. The expression for the blending mode is identical to the above, but with the substitution of (1-c) for the color.<p>Screen-blending mode often is referred to as highlight mode. The analytic expression for screen blending mode is given by the following formula:<p>B(C_b, C_s) = 1 - (1-C_s)&acirc;&#128;&cent;(1-C_b)<p>This can be thought of as the reciprocal of multiply mode, in the sense that it is multiplying the reciprocal input colors and using the reciprocal of the result. The resulting components are larger than the corresponding input components, so the net effect is a highlight of the two colors.<p><b>Position</b><p>Position determines the location of a transparency effect. It could be specified as an X offset-Y offset pair or a distance-angle pair. They can be used to calculate each other. InDesign also have a concept of global light, which is the angle of the light and is maintained the same for every object of a document.<p><b>Size</b><p>Size refers to the size of a transparency effect. It is specified in number of points. For example, a drop shadow with size of 0p5 mains the shadow width is 5 points.<p><b>Spread</b><p>Adding spread outsets the object&#39;s outline before blurring, so the effect seems bolder. Spread is expressed as a percentage of the blur width. Typically, spread is for outer effects, Spread is the percentage of the size or blur width that is simply outset rather than tapered off. For example, for a drop shadow with a blur width of 10 points and a spread of 0%, you get 10 points of blur. If the spread is 50%, however, you get 5 points of outset and 5 points of blur. If the spread is 100% you get 10 points of outset and no blur.<p><b>Noise</b><p>Random noise can be added to the transparency effect, to give it a rougher appearance.<p><b>Choke</b><p>Choke is conceptually the same as spread, but for effects that go &quot;inward,&quot; like inner glow. For example, an inner glow with size 10 points and spread 50%, you get 5 points of inset and 5 points of blur.<p><b>Feather width</b><p>Feather width is conceptually the same as size, simply the total amount of inset applied. For example, if you have 10 points of width, the feather extends from the edge of the object to 10 points inside the object. For directional feather, you can specify width in four directions.<p><b>Basic transparency</b><p>Basic transparency is an effect that lets the viewer see through an object. The Transparency panel in the user interface allows end users to specify the transparency attributes of selected page items, including blending mode, opacity, whether these should be isolated, and whether knockout is required.<p><b>Transparency in group items</b><p>A group item is a collection of one or more page items. Transparency can be applied to a page item or a group item. Transparency groups are constructs to work around real-world problems involving grouped transparent objects. The application allows the assignment of opacity, knockout, and isolation properties to transparency groups (that is, collections of page items). These group properties determine how a group of page items interact transparently with the backdrop. It also is possible to specify knockout and isolation properties for one page item.<p>Group attributes combine with those of the objects in the group. For example, if objects have 50% opacity and the group has 50% opacity, the resulting opacity of the composited objects is equivalent to an object with 25% opacity.<p>These group properties are independent of, and in addition to, the opacities and blending modes of the individual objects. The objects interact with each other and the backdrop using their individual opacity and blending modes. The group opacity and group-blending mode do not affect the interaction of the individual objects with each other, but they do affect the interaction of these objects with the backdrop.<ul><li>Knockout groups A knockout group is a group whose individual elements do not interact with each other but do interact with the backdrop. The objects within the group paint opaquely over each other, but compositing occurs with the initial backdrop data. An example in which this is useful is a group that consists of the fill and the stroke of a path. If the group is not a knockout group, there is an interaction of the fill and stroke in the region they have in common, which often is undesirable. Instead, the desired effect is to have the stroke opaquely cover the fill in the common overlap, and to have each interact with the backdrop with respect to their individual opacities and blending modes. The following figure shows a comparison of transparency effects with and without knockout groups.</ul><div class="image"><img alt="plugin-programming-guide-vol1-102.gif" src="plugin-programming-guide-vol1-102.gif" /></div><ul><li>Isolated groups An isolated group is a group whose individual elements do not blend with the backdrop independently but do blend with the backdrop as a group. An isolated group can be represented by its group object of color and opacity values. By definition, an isolated group can be represented by color and opacity values that are independent of the backdrop into which it is to be composited.</ul><p><b>Drop shadow</b><p>In the real world, drop shadow is generated when light is blocked by an object. As represented in graphics, drop shadow is a blurred representation of the shape of an object, offset by a user-specified distance and drawn below the object.<p>The parameters that control a drop shadow include the ones listed in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Blending mode </td><td>See Blending mode. </td></tr><tr><td>Noise </td><td>See Noise. </td></tr><tr><td>Object-knockout shadow </td><td>Object does not interact with shadow. </td></tr><tr><td>Opacity </td><td>See Opacity. </td></tr><tr><td>Position </td><td>See Position. </td></tr><tr><td>Shadow honors other effects </td><td>Shadow can be the result when combined with other transparency effects. </td></tr><tr><td>Size </td><td>See Size. </td></tr><tr><td>Spread </td><td>See Spread. </td></tr></table><p><b>Inner shadow</b><p>Inner shadow is very similar to drop shadow. It adds a shadow that falls just inside the edges of the object, giving the object a recessed appearance. The parameters that control an inner shadow effect are like those of drop shadows., as shown in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Blending mode </td><td>See Blending mode. </td></tr><tr><td>Choke </td><td>See Choke. </td></tr><tr><td>Noise </td><td>See Noise. </td></tr><tr><td>Opacity </td><td>See Opacity. </td></tr><tr><td>Position </td><td>See Opacity. </td></tr><tr><td>Size </td><td>See Size. </td></tr></table><p><b>Outer and inner glow</b><p>Glow is a graphic effect that makes an object appear to shine as if with intense heat. Outer glow refers to the glow effect applied to the outside edges of the object; inner glow refers to the glow effect applied to the inside edges. The parameters that control outer glow are listed in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Blending mode </td><td>See Blending mode. </td></tr><tr><td>Noise </td><td>See Noise. </td></tr><tr><td>Opacity </td><td>See Opacity. </td></tr><tr><td>Size </td><td>See Size. </td></tr><tr><td>Spread </td><td>See Spread. </td></tr><tr><td>Technique </td><td>The method to produce angled corners. You can get a smooth/rounded effect (softer) or a mitered effect (precise). </td></tr></table><p>The parameters that control inner glow are listed in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Blending mode </td><td>See Blending mode. </td></tr><tr><td>Choke </td><td>See Choke. </td></tr><tr><td>Noise </td><td>See Noise. </td></tr><tr><td>Opacity </td><td>See Opacity. </td></tr><tr><td>Size </td><td>See Size. </td></tr><tr><td>Source </td><td>Indicates the &quot;polarity&quot; of the glow. &quot;Center&quot; means the center of the object glows and the edges do not. &quot;Edge&quot; means the opposite. </td></tr><tr><td>Technique </td><td>The method to produce angled corners. You can get a smooth/rounded effect (softer) or a mitered effect (precise). </td></tr></table><p><b>Bevel and emboss</b><p>The bevel and emboss effect is a kind of simulation of how an object would look if it were &quot;puffed up&quot; into the third dimension. The parameters that control bevel and emboss are listed in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Style </td><td>A choice of inner bevel, outer bevel, emboss and pillow emboss. </td></tr><tr><td>Direction </td><td>Indicates whether the object appears to be &quot;sunken&quot; or &quot;raised.&quot; </td></tr><tr><td>Technique </td><td>Simulate effect made with smooth, chisel hard and chisel soft. </td></tr><tr><td>Soften </td><td>The amount of blurring, more or less, that is applied to the beveled result. This softens the effect so your bevel is not so harsh. </td></tr><tr><td>Size </td><td>Width of the effect. See Size. </td></tr><tr><td>Depth </td><td>Determines the intensity or sharpness of the bevel. </td></tr><tr><td>Angle </td><td>The direction in the page-plane of the light source. </td></tr><tr><td>Altitude </td><td>The angular distance above the page plane. </td></tr><tr><td>Highlight-blending mode </td><td>See Blending mode. </td></tr><tr><td>Highlight opacity </td><td>See Opacity. </td></tr><tr><td>Shadow-blending mode </td><td>See Blending mode. </td></tr><tr><td>Shadow opacity </td><td>See Opacity. </td></tr></table><p><b>Satin</b><p>Satin applies interior shading that creates a satiny finish. The following table lists its controlling parameters.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Blending mode </td><td>See Blending mode. </td></tr><tr><td>Opacity </td><td>See Opacity. </td></tr><tr><td>Angle </td><td>The direction of the light to create effect. </td></tr><tr><td>Distance </td><td>The distance of the light to satin effect. </td></tr><tr><td>Size </td><td>See Size. </td></tr></table><p><b>Feather effects</b><p>Feather is a graphic effect that allows designers to create a smooth edge around a frame. InDesign support three types of feathers: basic, directional, and gradient. The parameters that control a basic feather effect are listed in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Feather width </td><td>See Feather width. </td></tr><tr><td>Corners </td><td>Diffused, sharp, or rounded. </td></tr><tr><td>Choke </td><td>See Choke. </td></tr><tr><td>Noise </td><td>See Noise. Feather noise is added only to the feather region. </td></tr></table><p>Directional-feather effect feathers only on selected sides of an object and takes additional parameters, listed in the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Angle </td><td>The direction of the feather. </td></tr><tr><td>Choke </td><td>See Choke </td></tr><tr><td>Feather widths </td><td>See Feather width. </td></tr><tr><td>Noise </td><td>See Noise. </td></tr><tr><td>Shape </td><td>First edge only, leading edges, or all edges. </td></tr></table><p>Gradient effect creates a linear or radial gradient of opacity around an object and allows parameters to define a gradient, like gradient stops, gradient type and angle; see the following table.<table class="doxtable"><tr><th>Parameter </th><th>Description </th></tr><tr><td>Gradient stops </td><td>Defines the gradient </td></tr><tr><td>Gradient type </td><td>Linear or radial gradient </td></tr><tr><td>Angle </td><td>The direction of the gradient </td></tr></table><h3><a class="anchor" id="id_flattening"></a> Flattening</h3><p>PostScript and PDF 1.3 have no representation of transparency information. To print or export spreads with transparent information, it is necessary to generate nontransparent representations of the effects of transparency; this is known as flattening. In some cases, the interactions may be among areas of solid color, in which case they can be replaced by a solid color in each region of interaction. If images are involved, a composite image must be calculated that reflects the contributions of the objects being composited, including any solid-color areas.<p>Dealing with text and gradients requires the application of additional rules. If a section of the page is particularly complex, it can be faster to rasterize the area than to try to calculate all the interactions; the flattener user interface supports this feature.<p>The flattener is an Adobe core technology. Its implementation comes from the Adobe Graphics Manager (AGM) library, and it is used in other Adobe applications that support transparency within vector graphics, such as Illustrator.<p>The end user has a degree of control over how the flattener is used. The Print dialog box has an option to parameterize the flattener. The user may choose flattener presets and specify, for example, that high quality is preferred over high speed. There is a trade-off between precision of results and resources used. The lower the resolution, the quicker and less memory-intensive the calculation.<p>Flattening is a complex and potentially resource-expensive process. Various optimizations are required to implement transparency effectively, such as caching high-resolution images to file, to ensure that the memory requirements are minimized. There also are complexities introduced by OPI image substitution, because printing with transparency requires that embedded files write graphic primitives into the output stream.<h3><a class="anchor" id="id_transparency_data_model"></a> Transparency data model</h3><p>Transparency features are complicated, but the principles of their implementation are not. Basically, transparency implementation involves the following related aspects:<ul><li>Graphic attributes used to specify states and parameters of transparency effects<li>Page-item adornments used to draw transparency effects<li>Service providers and drawing-event handler to participate in the printing process that flattens the transparency before printing</ul><p>The boss classes responsible for transparency behavior are delivered mainly by the Transparency plug-in. The user interface to the effects is supplied by the TransparencyUI plug-in.<p>Transparency information is represented by graphic attributes, and transparency is rendered to a device through page-item adornments.<p><b>Defining transparency: graphic-attribute bosses</b><p>Transparency effects are defined programmatically as a set of graphic attributes. These attribute boss classes derive from <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a> and aggregate a collection of interfaces that set and get a variety of graphic-attribute data types. For general information about graphic attributes, see <a class="el" href="id_solutions.html#id_graphic_attributes">Graphic attributes</a>. For a summary of the transparency-attribute boss structure, see &quot;Transparency-attribute boss structure&quot;.<p><b>Transparency-attribute targets</b><p>Transparency effects can be applied to the object, stroke, fill, or content. They are called transparency targets. Accordingly, transparency attributes can be categorized into different targets. Attribute targets are defined as enums in <a class="el" href="class_i_x_p_attribute_suite.html#ae3ae30769d38b6e1248c1e4cba33c5b2">IXPAttributeSuite::AttributeTarget</a>.<p><b>Transparency-attribute groups</b><p>Each transparency effect has a set of attributes to represent the parameters that control the effect. Accordingly, transparency attributes can also be categorized into groups. Each group corresponds to each transparency effect. Transparency-attribute groups are defined as enums in <a class="el" href="class_i_x_p_attribute_suite.html#a05573c978cc0b75828a942f419b475b0">IXPAttributeSuite::AttributeGroup</a>.<p><b>Transparency-attribute data types and values</b><p>Different transparency attributes hold different types of data. The <a class="el" href="class_i_x_p_attribute_suite.html#ab6af8dc1f54317f092e9739d948ff796">IXPAttributeSuite::AttributeDataType</a> enum defines all possible data types a transparency attribute can have.<p><a class="el" href="class_i_x_p_attribute_suite_1_1_attribute_value.html">IXPAttributeSuite::AttributeValue</a> is a class that can hold values for any of the attributes. It serves as a generic container for get and set functions.<p><b>Transparency-attribute boss structure</b><p>Transparency-attribute bosses are organized as a three-level inheritance. The most generic level is the <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a>. This implies transparency attributes work and can be manipulated the same way as any other graphic attributes.<p>The next level is attribute groups. These attribute group bosses inherit from <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a> and aggregate the IID_IOBJECTSTYLEATTRINFO interface with the kXPAttrInfoImpl implementation. These groups correspond to the transparency effects; see the following table.<table class="doxtable"><tr><th>Group-attribute boss </th><th>Transparency effect </th></tr><tr><td><a class="el" href="classk_drop_shadow_attr_boss.html">kDropShadowAttrBoss</a></td><td>Drop shadow </td></tr><tr><td><a class="el" href="classk_vignette_attr_boss.html">kVignetteAttrBoss</a></td><td>Basic feather </td></tr><tr><td><a class="el" href="classk_x_p_attr_boss.html">kXPAttrBoss</a></td><td>Basic transparency </td></tr><tr><td><a class="el" href="classk_x_p_bevel_emboss_attr_boss.html">kXPBevelEmbossAttrBoss</a></td><td>Bevel and emboss </td></tr><tr><td><a class="el" href="classk_x_p_directional_feather_attr_boss.html">kXPDirectionalFeatherAttrBoss</a></td><td>Directional feather </td></tr><tr><td><a class="el" href="classk_x_p_gradient_feather_attr_boss.html">kXPGradientFeatherAttrBoss</a></td><td>Gradient feather </td></tr><tr><td><a class="el" href="classk_x_p_inner_glow_attr_boss.html">kXPInnerGlowAttrBoss</a></td><td>Inner glow </td></tr><tr><td><a class="el" href="classk_x_p_inner_shadow_attr_boss.html">kXPInnerShadowAttrBoss</a></td><td>Inner shadow </td></tr><tr><td><a class="el" href="classk_x_p_outer_glow_attr_boss.html">kXPOuterGlowAttrBoss</a></td><td>Outer glow </td></tr><tr><td><a class="el" href="classk_x_p_satin_attr_boss.html">kXPSatinAttrBoss</a></td><td>Satin </td></tr></table><p>The bottom level has the real transparency attributes that define every transparency. For example, <a class="el" href="classk_x_p_basic_opacity_attr_boss.html">kXPBasicOpacityAttrBoss</a>, <a class="el" href="classk_x_p_stroke_blending_opacity_attr_boss.html">kXPStrokeBlendingOpacityAttrBoss</a>, <a class="el" href="classk_x_p_fill_blending_opacity_attr_boss.html">kXPFillBlendingOpacityAttrBoss</a>, and <a class="el" href="classk_x_p_content_blending_opacity_attr_boss.html">kXPContentBlendingOpacityAttrBoss</a> inherit from <a class="el" href="classk_x_p_attr_boss.html">kXPAttrBoss</a> and aggregate the IID_IGRAPHICATTR_REALNUMBER interface. They define the opacity attribute of basic transparency for object, stroke, fill, and content targets, respectively.<p><b>Transparency-attribute types</b><p>There are about 400 transparency attributes. You may still access them in the general graphic-attribute way; however, the InDesign API also provides utility functions in <a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a> to manipulate transparency attributes more effectively. Part of that is the concept of transparency-attribute types.<p>Transparency-attribute types are defined as enums in IXPAttributeSuite::AttributeType. These enums are divided into segments according to transparency targets and transparency groups. The BASE_XP_ATTR(t,x) macro generates the base index of the segment. For example, if you want to know the enum value of the first transparency attribute for controlling inner shadow on the stroke of an object, use kStrokeInnerShadowBaseID + 1. kStrokeInnerShadowBaseID is calculated as BASE_XP_ATTR(kTargetStroke, kGroupInnerShadow).<p>A transparency-attribute type has a one-to-one mapping to transparency-attribute boss. You can translate between AttributeTypes and attribute-boss ClassIDs using the GetAttributeClassID and GetAttributeFromClassID methods on <a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a>.<p><b>Drawing transparency: adornment bosses</b><p>To create a transparent rendering for an object, add an <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a> implementation to the adornment boss class that provides the behavior for the object. The kBeforeShape and kAfterShape flags specify when to draw in response to the <a class="el" href="class_i_adornment_shape.html#ac2842f657dde1d467227c08ae27a9d4c">IAdornmentShape::GetDrawOrderBits</a> method. The <a class="el" href="class_i_adornment_shape.html#aade73e22c6700437e814b93ea01396e3">IAdornmentShape::GetPaintedAdornmentBounds</a> method specifies the adornment bounding box. Bound of the outer effects are larger than the object&#39;s bounds.<p>The following table lists the adornment bosses responsible for drawing transparency effects. One adornment boss can draw multiple effects. The primary reason we do not have one adornment for every effect is to limit the total number of adornments of a page item, for performance reasons.<table class="doxtable"><tr><th>Boss-class name </th><th>Description </th></tr><tr><td><a class="el" href="classk_x_p_drop_shadow_adornment_boss.html">kXPDropShadowAdornmentBoss</a></td><td>Draws knockout drop shadows and outer glow. </td></tr><tr><td>kXPPageitemAdornmentBoss </td><td>Draws blending and nonknockout drop shadows. </td></tr><tr><td><a class="el" href="classk_x_p_vignette_adornment_boss.html">kXPVignetteAdornmentBoss</a></td><td>Draws basic feather, directional feather, and gradient feather. </td></tr><tr><td><a class="el" href="classk_x_p_inner_effects_adornment_boss.html">kXPInnerEffectsAdornmentBoss</a></td><td>Draws inner effects, like inner shadow, inner glow, bevel and emboss, and satin. </td></tr></table><p><b>Printing transparency: flattening</b><p>Before transparency is printed, transparency effects must be flattened. You can choose different flattener presets to represent transparency using nontransparency representation, then print the result as normal page items.<p><b>Managing flattener presets</b><p>Flattener presets are represented by <a class="el" href="classk_x_p_flattener_style_boss.html">kXPFlattenerStyleBoss</a>. The key interface is <a class="el" href="class_i_flattener_settings.html">IFlattenerSettings</a>, which defines settings of presets, directly corresponding to the Flattener Preset Options dialog box.<p>The flattener preset is an application-wide preference. The <a class="el" href="class_i_flattener_style_list_mgr.html">IFlattenerStyleListMgr</a> interface is aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and is responsible for managing all flattener presets. As with other general presets, like print presets, the <a class="el" href="class_i_flattener_style_list_mgr.html">IFlattenerStyleListMgr</a> implementation hooks flattener presets into the generic presets dialog and provides an entry point for adding, deleting, and editing flattener presets with respective commands.<p>The <a class="el" href="classk_spread_boss.html">kSpreadBoss</a> also aggregates <a class="el" href="class_i_flattener_settings.html">IFlattenerSettings</a>, which allows the spread to override the flattener settings for a specific spread.<p><b>Printing-related bosses</b><p>Transparency participates in the printing process by iterating spreads for pages containing transparency effects that require flattening. With these bosses, the print command can examine transparency use, setting up viewport attributes and so on. Together with drawing in the spread and page item, InDesign can achieve results that appear as if there are transparency interactions, even though these are accomplished through flattened, opaque, drawing instructions. See the following table.<table class="doxtable"><tr><th>Boss-class name </th><th>Description </th></tr><tr><td>kXPGatherProviderBoss </td><td>A document iterator provider that gathers document-wide use of transparency. </td></tr><tr><td><a class="el" href="classk_x_p_print_setup_service_boss.html">kXPPrintSetupServiceBoss</a></td><td>Implements print services to set up global color profiles. </td></tr><tr><td><a class="el" href="classk_x_p_drw_evt_handler_boss.html">kXPDrwEvtHandlerBoss</a></td><td>Transparency start-up and shut-down. Hooks transparency into the draw manager. </td></tr></table><h2><a class="anchor" id="id_data_model_for_drawing"></a> Data model for drawing</h2><h3><a class="anchor" id="id_presentation_views"></a> Presentation views</h3><p>Drawing documents to the screen really means drawing to an application-layout presentation, which is a platform-independent construct containing layout widgets that display the contents of the document. Layout presentation is represented by <a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a>, with the key interface <a class="el" href="class_i_document_presentation.html">IDocumentPresentation</a>. Note that <a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a> is inherited from <a class="el" href="classk_window_boss.html">kWindowBoss</a>; however, it is very important not to use the <a class="el" href="class_i_window.html">IWindow</a> interface for any layout-presentation operation. Instead, always use <a class="el" href="class_i_document_presentation.html">IDocumentPresentation</a> for operations like minimizing the view. The <a class="el" href="class_i_window.html">IWindow</a> on a <a class="el" href="classk_layout_presentation_boss.html">kLayoutPresentationBoss</a> is only for internal use. There may be several layout presentations open at the same time; these can be hosted in one operating-system window as tabbed document presentation views, or each layout presentation can be hosted inside its own operating-system window.<p>In addition to the layout presentation, there are other windows/view containers in InDesign. Dialog boxes and pop-up tips are application windows and are represented by the platform-independent <a class="el" href="classk_window_boss.html">kWindowBoss</a> object. The panel container, often referred to as palette, is represented by a <a class="el" href="class_palette_ref.html">PaletteRef</a>. For more detail on these interfaces and their responsibilities, refer to the API Reference.<p>To summarize, the application manages two main categories of views:<ul><li>Document presentations have a document associated with them and display the content of the document. They also are referred to as layout presentations. A document presentation may not always correspond to a standalone operating-system window, because an operating-system window can have many document presentations in it. Note, however, that &quot;window&quot; is still being referred to throughout this document, because that is still a commonly accepted term for the view to a document.<li>User-interface windows/palettes are used for dialog boxes, panels, and other types of windows that do not have documents associated with them.</ul><p>Most of the detail in the remainder of this section concerns drawing a layout.<h3><a class="anchor" id="id_graphics_context"></a> Graphics context</h3><p>Drawing requires a graphics context. When page items are called to draw, they are provided with a <a class="el" href="class_graphics_data.html">GraphicsData</a> object, which contains a pointer to an InDesign graphics context. Using the application&#39;s graphics context, page items can perform platform-independent drawing to several of device contexts: screen, print, or PDF.<p>The graphics context for application drawing is described by an object derived from <a class="el" href="class_i_graphics_context.html">IGraphicsContext</a>, an abstract-data container interface. This interface is not aggregated on boss classes, nor is it derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. Instead, implementations of <a class="el" href="class_i_graphics_context.html">IGraphicsContext</a> are specialized for different drawing devices.<p>A graphics context is instantiated based on a viewport boss object (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_viewport">Viewport</a>), <a class="el" href="class_i_control_view.html">IControlView</a> interface pointer, and update region. Several important pieces of information are stored in the graphics context object, including the following:<ul><li>The current rectangular clip region for the drawing port.<li>The transform for mapping content to drawing device coordinates.</ul><p>The transform describes the relationship of the content coordinates to the drawing-device coordinates. For screen drawing, the drawing device is a window. The transform is based on the <a class="el" href="class_i_control_view.html">IControlView</a> implementation supplied at the time of the graphics-context instantiation. During a normal screen-drawing sequence, this is the <a class="el" href="class_i_control_view.html">IControlView</a> implementation on the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> that instantiates the graphics context, so the transform is initialized to be pasteboard to the application-window coordinates. During the drawing sequence, this transform is modified to represent parent-window coordinates. For a description of coordinate systems related to drawing, see Chapter 7, &quot;Layout Fundamentals.&quot;<p>Screen draws do not paint the entire document and then copy only a portion of it to the window. Instead, only the region of the window marked invalid is redrawn. The clip region stored in the graphics context is applied like a mask, discarding any drawing outside the clip bounds. During a drawing sequence, the clip represents the update region in the window and is stored in window coordinates.<p>For drawing to the screen, AGM is used to provide the graphics context. An offscreen context is used for drawing, to facilitate a smooth, flicker-free screen update. The drawing code renders off-screen, and the result of the completed drawing is subsequently copied to the screen. For more details, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_offscreen_drawing">Offscreen drawing</a>. The use of off-screen contexts is transparent to page items when they draw. The graphics context provided to the page item hides these implementation details.<h3><a class="anchor" id="id_viewport"></a> Viewport</h3><p>The application &#39;s platform-independent API for drawing is provided by the viewport. Page items use the <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> interface on the viewport boss object for drawing. The viewport boss object does not draw directly to the platform window; instead, the viewport boss object draws through the AGM, which is specialized for the type of drawing device (for example, PostScript printing or the screen). The specialization is transparent to clients of the graphics context and the viewport boss object.<p>A viewport boss object operates as a wrapper between the drawing client (often a page item) and the underlying AGM code that defines the graphics context for the output device. There are several different types of viewport boss classes, each tailored to a particular type of drawing output. For a list of relevant boss classes and the responsibilities of the interfaces on the boss classes, refer to the API Reference for <a class="el" href="class_i_view_port.html">IViewPort</a>. For example, kWindowViewPortBoss is used for drawing to application windows.<h2><a class="anchor" id="id_dynamics_of_drawing"></a> Dynamics of drawing</h2><h3><a class="anchor" id="id_drawing_the_layout"></a> Drawing the layout</h3><p>Layout drawing is the process of drawing page items to the layout presentation. Layout is described in depth in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>. For more detail on how individual page items are drawn, see &quot;Drawing page items&quot;.<p><b>Invalidating a view</b><p>InDesign drawing occurs in response to invalidation of a view, or region. Although InDesign provides platform-independent APIs for invalidating a view, the APIs simply forward the invalidation to the operating system. The invalidation state is maintained by the operating system, which generates update events to the application.<p>Invalidation can be caused by changes to the model (persistent data in a document) or direct invalidation. Both use the same mechanism to invalidate a view.<p>Changes to the model are broadcast to interested observers with regular or lazy notification. For example, the application uses an observer on the layout widget to monitor changes to page items in the layout. When the observer receives notification of a change, it asks the subject of the change to invalidate a region based on its bounding box.<p>Views can be directly invalidated by using the <a class="el" href="class_i_layout_utils.html#a2e7ad8a3c9ca295a12594e0da4ae084b">ILayoutUtils::InvalidateViews</a> method. The collaboration of boss objects is shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-103.gif" src="plugin-programming-guide-vol1-103.gif" /></div><p>The <a class="el" href="class_i_layout_utils.html#a2e7ad8a3c9ca295a12594e0da4ae084b">ILayoutUtils::InvalidateViews</a> method uses a document pointer to locate the views for a document. For each view, the method gets the <a class="el" href="class_i_layout_controller.html">ILayoutController</a> interface on the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> and calls ILayoutController::InvalidateContent, which creates an invalidation region equal to the view&#39;s window. The invalidation region is passed to the <a class="el" href="class_i_window_port.html#a97e2dc7cdb5265ff7372b11ec5fb8b22">IWindowPort::InvalRgn</a> method on the <a class="el" href="class_i_window_port.html">IWindowPort</a> interface of the kWindowViewPortBoss corresponding to the window. This method then passes the invalidation region to the operating system.<p>The invalidation region is then accumulated by the operating system, which generates a paint message. The operating system sends an update message (event) to the InDesign event dispatcher, where the message is wrapped in a platform-independent class and routed to the event handler on the appropriate window.<p>The window&#39;s event handler calls indirectly the <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> method. At that point, the drawing sequence begins following the pattern for drawing a widget hierarchy; Draw uses the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface to locate each of its children and call Draw on the child&#39;s <a class="el" href="class_i_control_view.html">IControlView</a> interface. This means the <a class="el" href="classk_layout_panel_boss.html">kLayoutPanelBoss</a> is called to draw, and it iterates each of its child widgets (scroll bars, the layout widget, rulers, etc.).<p>The drawing sequence concludes with validating the contents of the window. This completes the update cycle, from invalidation to redraw.<p><b>Layout drawing order</b><p>Layout presentations are updated in several steps that allow better performance and the opportunity to interrupt the drawing. Good performance is achieved by specializing the drawing operations according to the view&#39;s z-order, whether the invalidation is due to a selection change or because all objects changed.<p>At the level of the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>, several decisions are made behind the scenes for the sake of drawing performance. The <a class="el" href="class_i_control_view.html">IControlView</a> implementation on the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> chooses what to draw based on the window&#39;s z-order, the selection, and the update region.<p><b>Foreground and background drawing</b><p>If the window is the front view, two views may be drawn: a background view containing all objects and a foreground view containing only the decorations for the selection. Offscreen graphics contexts are created and cached for both views (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_offscreen_drawing">Offscreen drawing</a>). If the update region overlaps the window or the current front view was not the last view to have been drawn, the background view is redrawn. If the selection is not empty, the foreground view also is redrawn.<p>Based on the above rules, the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> <a class="el" href="class_i_control_view.html">IControlView</a> filters the visible spreads and calls their <a class="el" href="class_i_shape.html#a9ca1a20e7a9bbdd0a70e6df06288625c">IShape::ProcessDrawShape</a> methods through the InDesign draw manager. This filtering means page items are not guaranteed to be called for a screen draw. The background draw then propagates through the layout hierarchy, as described in Spread-drawing sequence.<p>After the background draw is complete, if the selection is empty, the background image is copied to the window and the draw is complete. If the selection is not empty, the foreground draw starts by copying the background image to the foreground offscreen context. The selection is drawn to the foreground, then the foreground image is copied to the window.<p>The use of foreground and background draws means a page item could be called twice during a redraw: the first call to <a class="el" href="class_i_shape.html#a9ca1a20e7a9bbdd0a70e6df06288625c">IShape::ProcessDrawShape</a> in the order of the layout hierarchy for the background draw, and the second call to HandleShape::DrawHandleShape in the order of the selection list for the foreground draw.<p>If the window is not the front view, a more abbreviated drawing sequence takes place. Both the document items and the selection are drawn to a foreground offscreen context, and it is copied to the screen.<p><b>Z-order</b><p>Z-order is the order (depth) of page item objects in the direction perpendicular to the screen. Z-order determines which object or part of an object is visible to the user. InDesign handles three levels of z-order:<ol type="1"><li>Window z-order - InDesign windows may overlap.<li>Layer order - InDesign documents are layered. InDesign draws page layers first, then other document layers. For more information, see the &quot;Layers&quot; section of Chapter 7, &quot;Layout Fundamentals.&quot;<li>Page item z-order - On the same layer, page items are ordered according to their positions in the parent object&#39;s hierarchy. The child with index 0 is drawn first; the child with the greatest index is drawn last. For more information, see the &quot;Documents and the Layout Hierarchy&quot; section of Chapter 7, &quot;Layout Fundamentals.&quot;</ol><dl class="section note"><dt>Note<dd>Do not confuse z-order with foreground and background drawing. Z-order controls what is visible to the viewer, whereas foreground and background are just bitmaps for speeding up rendering.</dl><p><b>Draw manager</b><p>Conceptually, <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> calls each spread to draw. In reality, <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> calls through the InDesign draw manager. The draw manager is an interface that exists on each viewport and is used to set clipping areas and initiate the drawing of any page element and its children to that viewport. The draw manager can be used for drawing to the screen, PDF, and print. Drawing in InDesign occurs on a spread-by-spread basis and is hierarchical. Without a service like the draw manager, it would be hard to change the behavior of drawing in a subhierarchy. Optionally, you can create a <a class="el" href="classk_draw_mgr_boss.html">kDrawMgrBoss</a> and use the IterateDrawOrder method, which allows clients to iterate the document in the same manner as drawing, calling a client-provided callback routine for every page item in the hierarchy, but without a graphics context.<p>Funneling all drawing activity through the draw manager provides three important features for changing the behavior of drawing operations:<ul><li>Clipping of areas to be drawn.<li>Filtering of items to be drawn.<li>Interrupting a drawing sequence.</ul><p>Clipping and filtering provide a means to select items for the draw based on regions. The draw manager maintains the current values for the clip and filter regions. Interruption of the drawing sequence relies on the broader mechanism of drawing events. As items draw, they broadcast standard messages that announce the beginning and end of discrete drawing operations. Drawing events are received by special handlers that register interest in particular types of messages, and each drawing-event handler has the opportunity to abort the draw at that point. Clients of the draw manager (like the layout widget) install a default drawing-event handler.<p>The draw manager provides services for hit testing, iterating the drawing order, and drawing. Detail about how spreads are drawn is described in Spread-drawing sequence.<h3><a class="anchor" id="id_drawing_page_items"></a> Drawing page items</h3><p>When page items are called to draw, they are passed information about their drawing context, including a <a class="el" href="class_graphics_data.html">GraphicsData</a> object and <a class="el" href="class_i_shape.html">IShape</a> drawing flags (for example, kPatientUser). For more information, refer to the API Reference for these types. Page items use this information to perform their drawing operations.<p>The <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> interface is the InDesign interface for drawing and is aggregated on all viewport boss classes. The <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> interface is used by all drawing interfaces on a page item, regardless of the output device.<p>The viewport settings can be modified using <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> methods. The <a class="el" href="class_i_graphics_port.html#a3764f1bf8f80d8e61cbd49f4a02b53af">IGraphicsPort::gsave</a> and <a class="el" href="class_i_graphics_port.html#a3a6f5ed188b108c4ead3575f3ea7136e">IGraphicsPort::grestore</a> methods effectively push the current port settings onto a stack and pop the old settings when desired. These methods are used to save the current port settings when setting the port&#39;s transform to a new space. For example, when a page item is called to draw, it should save the port settings, set the port to its inner coordinate space, draw, and restore the port before returning.<p>The <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> implementations provide methods very similar to PostScript graphics operators. These methods support drawing primitives, port-transformation manipulation, and changing port-clip settings. For a complete list of the methods, refer to the API Reference for <a class="el" href="_i_graphics_port_8h_source.html">IGraphicsPort.h</a>. Line-drawing methods like <a class="el" href="class_i_graphics_port.html#a97cab650d6155c91fe82ff7fe90f7eb2">IGraphicsPort::lineto</a>, <a class="el" href="class_i_graphics_port.html#a4534e532778f1c060ecda9682cb29ac2">IGraphicsPort::moveto</a>, <a class="el" href="class_i_graphics_port.html#a3244f9f0996d87d53b5314d5be509245">IGraphicsPort::curveto</a>, <a class="el" href="class_i_graphics_port.html#ad0852cbc253acab99b145e05a4a79350">IGraphicsPort::closepath</a>, <a class="el" href="class_i_graphics_port.html#a9be12e8cd81ad1baebcc6a04f9d07542">IGraphicsPort::fill</a>, and <a class="el" href="class_i_graphics_port.html#a3254d1be69314081d7bf80dd26fa9e3e">IGraphicsPort::stroke</a> are available. If a path is defined in the port, it can be discarded using the <a class="el" href="class_i_graphics_port.html#a8752d1d72e0ccc739835fd1f1cc8fd01">IGraphicsPort::newpath</a> method. These methods are demonstrated in the &quot;Graphics&quot; chapter of Adobe InDesign SDK Solutions. Control over the color space, color values, gradient, and blending modes also is available through <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> methods.<p>See the following table for a list of interfaces for drawing page items.<table class="doxtable"><tr><th>Interface </th><th>Function </th></tr><tr><td><a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a></td><td>Renders graphic attributes. </td></tr><tr><td><a class="el" href="class_i_handle_shape.html">IHandleShape</a></td><td>Renders selection handles. Called during foreground drawing. </td></tr><tr><td><a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a></td><td>Lists adornments for a page item. </td></tr><tr><td><a class="el" href="class_i_path_page_item.html">IPathPageItem</a></td><td>Renders low-level draws for path, fill, and stroke. </td></tr><tr><td><a class="el" href="class_i_shape.html">IShape</a></td><td>Renders path, fill, and stroke. Called during background drawing. </td></tr></table><p><a class="el" href="class_i_shape.html">IShape</a>, <a class="el" href="class_i_path_page_item.html">IPathPageItem</a>, and <a class="el" href="class_i_handle_shape.html">IHandleShape</a> are directly involved in drawing a page item. <a class="el" href="class_i_shape.html">IShape</a> is the main interface for drawing the page item and is called when the entire page item needs to be rendered. Path-based items like spline bosses also have the <a class="el" href="class_i_path_page_item.html">IPathPageItem</a> interface to handle the details of drawing their paths. <a class="el" href="class_i_handle_shape.html">IHandleShape</a> is called when a page item is in the selected state and is used for drawing the decorations that denote selection. <a class="el" href="class_path_handle_shape.html">PathHandleShape</a> is responsible for drawing path-selection handles.<p><a class="el" href="class_i_graphic_style_descriptor.html">IGraphicStyleDescriptor</a> maintains the graphic attributes for the page item. The drawing process sets graphics port settings based on various graphic attributes.<p><a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a> maintains a list of adornments for the page item. Adornments are drawn with the page item. This interface provides a means to enhance or decorate a page item&#39;s appearance. For more detail, see Spread-drawing sequence.<p><a class="el" href="class_i_shape.html">IShape</a> is responsible for providing the drawing, hit testing, drawing-order iteration, and invalidation functions for page items. This interface is responsible for rendering a page item and is used during background draws to create the path, fill, and stroke of an object. For details, refer to the API Reference.<p>There are partial implementation classes like <a class="el" href="class_c_shape.html">CShape</a> and <a class="el" href="class_c_graphic_frame_shape.html">CGraphicFrameShape</a> in the public API. For details, refer to the API Reference.<p>For details on the drawing sequence for a page item, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_drawing_sequence_for_a_page_item">Drawing sequence for a page item</a>.<p><b>The <a class="el" href="class_i_handle_shape.html">IHandleShape</a> interface</b><p>The <a class="el" href="class_i_handle_shape.html">IHandleShape</a> interface is responsible for drawing and hit testing for a page item&#39;s selection handles. This interface is defined in the abstract base class in <a class="el" href="_i_handle_shape_8h_source.html">IHandleShape.h</a>.<p>As with the <a class="el" href="class_i_shape.html">IShape</a> class, the <a class="el" href="class_i_handle_shape.html">IHandleShape</a> drawing sequence includes extensibility points in the form of adornment calls. For more detail, see <a class="el" href="id_adobe_indesign_cc_tool_kit_guide.html#id_extension_patterns">Extension patterns</a>. For more detail on its responsibilities, refer to the API Reference on <a class="el" href="class_i_handle_shape.html">IHandleShape</a>.<p>Most page items (such as <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) that aggregate <a class="el" href="class_i_handle_shape.html">IHandleShape</a> (with the ID IID_IHandleShape interface) also have another implementation of <a class="el" href="class_i_handle_shape.html">IHandleShape</a> which is based on <a class="el" href="class_path_handle_shape.html">PathHandleShape</a> (with the ID IID_IPATHHANDLESHAPE interface). The implementation based on <a class="el" href="class_path_handle_shape.html">PathHandleShape</a> inherits from the same superclass as <a class="el" href="class_i_handle_shape.html">IHandleShape</a>; therefore, it has exactly the same public interface. The purpose of this interface is to draw path-selection handles. Observe the difference in the user interface by switching between the Selection and Direct Selection tools.<p><b>The <a class="el" href="class_i_path_page_item.html">IPathPageItem</a> interface</b><p>The <a class="el" href="class_i_path_page_item.html">IPathPageItem</a> interface encapsulates the specialized drawing functions for path-based page items. This class provides methods for operations like stroke, fill, clip, and copying a path to the graphics port. The <a class="el" href="class_c_graphic_frame_shape.html">CGraphicFrameShape</a> class delegates these specific draw operations to the <a class="el" href="class_i_path_page_item.html">IPathPageItem</a> class.<p>In this class, graphic attributes are used to control the appearance. The <a class="el" href="class_i_path_page_item.html#a16faed4fe82132e3dcaff7d14497b6bb">IPathPageItem::Stroke</a> method first calls IPathPageItem::Setup, which initializes a set of default stroke properties and then tries to get the stroke graphic attributes, like stroke weight and a ClassID for a path stroker. The path stroker is a service provider that delivers the kPathStrokerService. The IPathPageitem::Stroke method then uses the stroke graphic attributes and path stroker to actually create the stroke.<h3><a class="anchor" id="id_drawing_in_user-interface_widget_windows"></a> Drawing in user-interface widget windows</h3><p>A user-interface widget is any descendant of <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>. Drawing in a user-interface widget window -such as a palette, dialog box, or panel-is like drawing to the layout presentation. Instead of calling the draw method of the layout-control view, palette drawing calls <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> methods of various <a class="el" href="class_i_control_view.html">IControlView</a> implementations.<p>The first stage in creating an owner-drawn panel is constructing an AGMGraphicsContext object from the <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> parameters and obtaining an <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a> from the graphic context.<p>Next, set colors and draw the items. This can be done through the <a class="el" href="class_i_interface_colors.html">IInterfaceColors</a> interface, aggregated on <a class="el" href="classk_session_boss.html">kSessionBoss</a>. There are a few standard interface colors common to drawing items in user-interface windows. User-interface colors are defined in <a class="el" href="_interface_color_defines_8h_source.html">InterfaceColorDefines.h</a>. Next, set the color of the graphics port and draw items.<p>Each widget actually is a window, so the <a class="el" href="class_p_m_rect.html">PMRect</a> value from <a class="el" href="class_i_control_view.html#afb162a3bf6bd221653550b1d758ad1ea">IControlView::GetFrame</a> represents the coordinates of the widget in its parent widget. An IControlView::MoveTo(0,0) call is convenient for transforming the coordinates.<p>You can draw lines, boxes, and so on as you normally draw in the layout presentation, using the methods of <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a>. For drawing <a class="el" href="class_p_m_string.html">PMString</a>, InDesign provides utility methods on the StringUtils class (<a class="el" href="_draw_string_utils_8h_source.html">DrawStringUtils.h</a>) that let you measure a <a class="el" href="class_p_m_string.html">PMString</a> and draw strings directly. For more details, refer to the API Reference.<p>For an example of an owner-drawn panel, with a custom <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> implementation, see the SDK sample PanelTreeView in &lt;SDK&gt;/source/sdksamples/paneltreeview, and inspect PnlTrvCustomView.cpp.<h3><a class="anchor" id="id_offscreen_drawing"></a> Offscreen drawing</h3><p><b>Purpose of offscreen drawing</b><p>An offscreen drawing is simply a bitmap. The technique of offscreen drawing has been used for years by various applications to reduce screen flicker and improve performance when drawing to the screen. Mac OS X actually creates a separate offscreen buffer for each window, such that when an application tries to draw to a window, it actually is drawing to the offscreen buffer. The operating system then periodically transfers its offscreen buffer to the actual screen. This process is done at the operating-system level and decreases the number of cases in which InDesign needs to draw offscreen on Mac OS X.<p><b>Drawing layout offscreen</b><p>Offscreen drawing is used just about any time the layout presentation needs to update. InDesign maintains an offscreen representation of the layout presentation with everything except the current selection highlighting. Hence, when the selection changes, InDesign can very quickly redraw the screen from the offscreen buffer, followed by drawing the new selection.<p>The biggest area where offscreen drawing is used is the layout-control view. Drawing background and foreground in layout-control view is discussed in Layout drawing order. What must be emphasized here is that drawing the layout does not really draw to the screen directly; instead, drawing the layout actually draws offscreen.<p>Corresponding to background and foreground drawing, there are background offscreen buffers and foreground offscreen buffers. The background offscreen representation in InDesign is the offscreen buffer maintained by each layout view, containing everything except current selection highlighting. Each layout view has its own offscreen buffer. The background offscreen buffer is invalidated by querying for the <a class="el" href="class_i_layout_controller.html">ILayoutController</a> of the <a class="el" href="class_i_control_view.html">IControlView</a> interface for the layout and calling ILayoutController::InvalidateContent.<p>InDesign can be told to update a layout without dirtying the background offscreen buffer, by querying for the <a class="el" href="class_i_layout_controller.html">ILayoutController</a> of the <a class="el" href="class_i_control_view.html">IControlView</a> interface for the layout and calling ILayoutController::InvalidateSelection.<p>Palettes and dialog boxes are responsible for their own offscreen representations. In general, most panels do not use offscreen drawing; however, a few user-interface windows, like the Navigator panel, maintain their own offscreen representations. As mentioned above, Mac OS X provides offscreen buffers for all windows, so offscreen drawing on Mac OS X is not necessary if the goal is simply to avoid flicker.<p><b>Offscreen data</b><p>Drawing offscreen is drawing to the kOffscreenViewPortBoss. Besides other interfaces that are involved in drawing, one of the most important interfaces on kOffscreenViewPortBoss is IOffscreenPortData. This is the interface that stores a reference to the offscreen bitmap and distinguishes kOffscreenViewPortBoss from other viewports.<p>An offscreen bitmap is wrapped in the platform-independent IPlatformOffscreen. You can get and set bitmaps with IOffscreenPortData; however, you are not allowed to create bitmaps directly. Instead, you may want to aggregate an IOffscreenViewPortCache interface on the control-view boss class, so you can query background and foreground viewport data.<p>For more information, refer to the API Reference for IPlatformOffscreen, IOffscreenPortData, and IOffscreenViewPortCache.<p><b>Snapshots</b><p>A snapshot is a record of a part of the document view at a specific instant. <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> draws items into a memory-based graphics context, creating a bitmap (snapshot) that can be exported to a stream in several formats, like JPEG, TIFF, or GIF.<p><a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> also creates its own offscreen bitmap and uses an <a class="el" href="class_i_draw_mgr.html">IDrawMgr</a> to walk the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> and draw specific page items to the offscreen buffer; however, the internal implementation is different. Like layout offscreen, the viewport <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> interacts with is kAGMImageViewportBoss, the bitmap it draws to is of type AGMImageRecord defined in <a class="el" href="_graphics_external_8h_source.html">GraphicsExternal.h</a>, and it uses IAGMImageViewPort to manipulate the bitmap. <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> does not interact with the layout&#39;s offscreen representation in any way.<p><a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a> is very useful for creating proxy images of documents, since it uses the same draw manager to draw page items in memory, a much faster way. Sample code in the Snapshot sample plug-in and in SnpCreateInddPreview.cpp demonstrates the use.<p>The sample code in the SDK still uses SnapshotUtils. We recommend using the more recent <a class="el" href="class_snapshot_utils_ex.html">SnapshotUtilsEx</a>.<h2><a class="anchor" id="id_client_apis"></a> Client APIs</h2><h3><a class="anchor" id="id_path-related_client_apis"></a> Path-related client APIs</h3><p>High-level APIs provided to manipulate paths are summarized in the following table. For details about them, refer to the API Reference.<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_path_point_script_utils.html">IPathPointScriptUtils</a></td><td>Utility methods related to path point scripting (called by script providers). </td></tr><tr><td><a class="el" href="class_i_page_item_type_utils.html">IPageItemTypeUtils</a></td><td>Utilities to get the type of a page item. </td></tr><tr><td><a class="el" href="class_i_path_utils.html">IPathUtils</a></td><td>Path manipulations. </td></tr><tr><td><a class="el" href="class_i_spline_utils.html">ISplineUtils</a></td><td>Utilities for spline-item manipulations. </td></tr><tr><td><a class="el" href="class_i_path_info_utils.html">IPathInfoUtils</a></td><td>Analyzes whether a list of <a class="el" href="class_path_info.html">PathInfo</a> object forms a point or straight line. </td></tr><tr><td><a class="el" href="class_i_path_point_utils.html">IPathPointUtils</a></td><td>Utility methods related to path point transformations. </td></tr><tr><td><a class="el" href="class_i_path_operation_suite.html">IPathOperationSuite</a></td><td>Manipulates paths on selected page items, including compound paths. Includes path-finder operations. </td></tr><tr><td><a class="el" href="class_i_convert_shape_suite.html">IConvertShapeSuite</a></td><td>Converts selected page items to a new shape. </td></tr></table><h3><a class="anchor" id="id_graphic_page-item_client_apis"></a> Graphic page-item client APIs</h3><p>APIs provided to manipulate graphics are summarized in the following table. For details about them, refer to the API Reference.<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_frame_content_suite.html">IFrameContentSuite</a></td><td>Selection suite interface for content fitting and frame-content conversion. </td></tr><tr><td>IFrameContentFacade </td><td><a class="el" href="namespace_facade.html">Facade</a> for content fitting and frame-content conversion. </td></tr><tr><td><a class="el" href="class_i_frame_content_utils.html">IFrameContentUtils</a></td><td>Utility interface for determining various aspects of frame contents. </td></tr><tr><td><a class="el" href="class_i_clipping_path_suite.html">IClippingPathSuite</a></td><td>Gets and sets clipping path for selected graphics items. </td></tr><tr><td>ITextWrapFacade </td><td><a class="el" href="namespace_facade.html">Facade</a> for manipulating text wrap. </td></tr><tr><td>IDisplayPerformanceSuite </td><td>Changes display performance settings for selection. </td></tr><tr><td><a class="el" href="class_i_image_object_suite.html">IImageObjectSuite</a></td><td>Accesses image layers. </td></tr><tr><td>IImageFacade </td><td><a class="el" href="namespace_facade.html">Facade</a> for getting image information. </td></tr><tr><td>IJPEGExportSuite </td><td>Exports selection to JPEG file format. </td></tr><tr><td>ISVGExportSuite </td><td>Exports selection to SVG file format. </td></tr></table><h3><a class="anchor" id="id_key_color-related_client_apis"></a> Key color-related client APIs</h3><p>Interfaces provided to manipulate color, swatch, ink, and color management objects are summarized in the following table. For details about them, refer to the API Reference.<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_gradient_attribute_suite.html">IGradientAttributeSuite</a></td><td>A selection suite interface. Provides gradient attribute&acirc;&#128;&#147;related operations that apply to the application defaults, document defaults, text, layout, and tables. </td></tr><tr><td><a class="el" href="class_i_swatch_utils.html">ISwatchUtils</a></td><td>Utility interface to manipulate swatches. For example, this interface can be used to acquire the active swatch list, retrieve or instantiate new, persistent, rendering boss objects, and modify the properties of the swatch list. </td></tr><tr><td><a class="el" href="class_i_u_i_color_utils.html">IUIColorUtils</a></td><td>Utility interface for dealing with user-interface colors. </td></tr><tr><td><a class="el" href="class_i_ink_mgr_utils.html">IInkMgrUtils</a></td><td>Utility interface for managing inks. For example, this interface can be used to acquire the active ink list and retrieve information about name, type, ink alias, and corresponding swatches of a spot ink. </td></tr><tr><td><a class="el" href="class_i_ink_mgr_u_i_utils.html">IInkMgrUIUtils</a></td><td>Utility interface, mainly for calling the ink-manager dialog box. </td></tr><tr><td><a class="el" href="class_i_color_system_utils.html">IColorSystemUtils</a></td><td>Utility interface for color-rendering objects. For example, this interface can be used to get color space and color components of a given color swatch. </td></tr><tr><td><a class="el" href="class_i_c_m_s_attribute_suite.html">ICMSAttributeSuite</a></td><td>A selection suite interface. Provides color-management functionality for the selected image page item, like getting or applying color profile or rendering intent. </td></tr><tr><td><a class="el" href="class_i_c_m_s_utils.html">ICMSUtils</a></td><td>Utility interface for the color-management system. For example, this interface can be used to obtain CMSSettings and ProfileList. Provides wrappers for color-management commands. </td></tr><tr><td><a class="el" href="class_i_c_m_s_manager.html">ICMSManager</a></td><td>A manager interface that provides a generic wrapper around a color-management system (CMS). Access to the CMS typically is done by coordinating between this interface and a data interface for the specific CMS implementation. </td></tr><tr><td><a class="el" href="class_i_color_presets_manager.html">IColorPresetsManager</a></td><td>A manager interface that manages a set of color preset files. For example, load or save a color preset, and get or set working RGB/CMYK profile and CMS policy. </td></tr></table><p>Since color-related objects like colors, swatches, inks, and color profiles are stored in the document or application database, you will need commands to manipulate them. The utility interfaces described above provide a higher-level abstraction that wrap the required commands. For a list of commands, refer to the API Reference.<h3><a class="anchor" id="id_graphic-attribute_client_apis"></a> Graphic-attribute client APIs</h3><p>APIs provided to manipulate graphic attributes are summarized in the following table. For details about them, refer to the API Reference.<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_graphic_attribute_utils.html">IGraphicAttributeUtils</a></td><td>Exposes methods that can be used to create lists of attribute overrides and create commands to apply attribute overrides. It also exposes methods to read the graphic attributes of document objects. </td></tr><tr><td><a class="el" href="class_i_graphic_state_utils.html">IGraphicStateUtils</a></td><td>Exposes methods to create or process commands to apply overrides, swap stroke and fill, and so on. It also exposes a key method to acquire a reference to the active graphic state, which is discussed in detail in the &quot;Graphics&quot; chapter of Adobe InDesign SDK Solutions. </td></tr><tr><td><a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a></td><td>Selection suite that can be queried for through an abstract selection (<a class="el" href="classk_abstract_selection_boss.html">kAbstractSelectionBoss</a>). It is aggregated on the concrete selection boss classes connected with application defaults, document defaults, layout, tables, and text. </td></tr><tr><td><a class="el" href="class_i_graphic_attr_proxy_suite.html">IGraphicAttrProxySuite</a></td><td>Selection suite that switches graphic attributes between layout objects and text. </td></tr><tr><td><a class="el" href="class_i_stroke_attribute_suite.html">IStrokeAttributeSuite</a></td><td>High-level attribute suite interface specifically to get and set various stroke attributes. It uses <a class="el" href="class_i_graphic_attribute_suite.html">IGraphicAttributeSuite</a> to get and set appropriate data. </td></tr><tr><td><a class="el" href="class_i_x_p_attribute_suite.html">IXPAttributeSuite</a></td><td>Accesses or changes transparency attributes on the selected page items or group items. This header file also defines all transparency-attribute-related enums such as attribute types. </td></tr><tr><td><a class="el" href="class_i_x_p_attribute_utils.html">IXPAttributeUtils</a></td><td>Transparency-attribute-related utility functions </td></tr><tr><td><a class="el" href="class_i_x_p_attribute_facade.html">IXPAttributeFacade</a></td><td>High-level transparency-attribute facade. Defines methods to get and set all transparency attributes. </td></tr><tr><td><a class="el" href="class_i_x_p_utils.html">IXPUtils</a></td><td>Transparency utility functions. Mainly for flattening. </td></tr><tr><td><a class="el" href="class_i_x_p_manager.html">IXPManager</a></td><td>Transparency helper functions. </td></tr></table><p>There are command boss classes used to manipulate graphic attributes, graphic style, and graphic state. The utility interfaces described in the table in Graphic-attribute client APIs provide a higher-level abstraction that wraps the common commands. For a complete list of provided commands, refer to the API Reference.<h2><a class="anchor" id="id_extension_patterns"></a> Extension patterns</h2><h3><a class="anchor" id="id_custom_graphic_attributes"></a> Custom graphic attributes</h3><p>You can provide custom graphic attributes that extend InDesign function for end users. As explained in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_representation_of_graphic_attributes">Representation of graphic attributes</a>, graphic attributes are applied to page items by adding to a list of attribute boss objects associated with the page item.<p>To define a customized graphic attribute:<ol type="1"><li>Create a new boss class for the attribute. The boss class should inherit from <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a>.<li>Provide an implementation of the <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a> interface.<li>If the graphic attribute value could be stored in an existing data interface, like <a class="el" href="class_i_graphic_attr_boolean.html">IGraphicAttrBoolean</a> or <a class="el" href="class_i_graphic_attr_class_i_d.html">IGraphicAttrClassID</a>, add it to the attribute class; otherwise, implement an interface of your own.<li>Provide your own code to initialize and set your attribute data when the attribute is applied to a page item. Code to apply the attribute to a page item also is required.</ol><p>If you implemented a custom graphic attribute, you are likely to use a page-item adornment to decorate the page item based on your graphic-attribute value. For an example, see the TransparencyEffect and TransparencyEffectUI sample SDK plug-ins.<h3><a class="anchor" id="id_custom_path-stroker_effects"></a> Custom path-stroker effects</h3><p>You can provide custom path strokers with your own stroke implementation through a kPathStrokerService. The service provider should provide an implementation of <a class="el" href="class_i_path_stroker.html">IPathStroker</a>, with <a class="el" href="class_i_stroke_parameters.html">IStrokeParameters</a> used for storing parameters for the stroke. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_path_stroker">Path stroker</a>. To implement a custom path stroker:<ol type="1"><li>Create a new boss class for the service provider (for example k&lt;XXX&gt;PathStrokerBoss). Add a service provider to the boss class (the application-provided kPathStrokerServiceProviderImpl can be reused), and define your implementation of <a class="el" href="class_i_path_stroker.html">IPathStroker</a>.<li>Create your implementation of <a class="el" href="class_i_path_stroker.html">IPathStroker</a>. The interface basically provides methods on how to draw the path on the specific graphic port and hit testing (stroke bounding box, etc.).<li>If the implementation of the stroker is complicated, you may aggregate additional interfaces on the boss. InDesign/InCopy provides a common stroke-parameter implementation of the <a class="el" href="class_i_stroke_parameters.html">IStrokeParameters</a> interface. The interface stores information like where a path segment starts and the length of the segment. For details, refer to the API Reference.</ol><p>To change only the dash and gap of a stroke, you do not need a custom stroke implementation. Instead, just apply the appropriate <a class="el" href="classk_dashed_attribute_values_boss.html">kDashedAttributeValuesBoss</a> attribute.<h3><a class="anchor" id="id_custom_corner_effects"></a> Custom corner effects</h3><p>You can provide a custom corner path with your own corner path implementation through a kPathCornerService. The service provider should provide an implementation of <a class="el" href="class_i_path_corner.html">IPathCorner</a>. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_path_corners">Path corners</a>. To implement a custom corner effect:<ol type="1"><li>Create a new boss class for the service provider (for example k&lt;XXX&gt;CornerBoss). Add a service provider to the boss class (the application-provided kPathCornerServiceProviderImpl can be reused), and define your own implementation of <a class="el" href="class_i_path_corner.html">IPathCorner</a>.<li>Create your implementation of <a class="el" href="class_i_path_corner.html">IPathCorner</a>. The interface basically provides drawing methods from three points on the corner. For detailed definitions of the pointers, refer to the API Reference of the interface. The three points are calculated by a private method not included in the SDK from the stroke path and corner size. You need to provide only the method for creating the corner effect using these points.<li>Determine the size of the corner, and apply kGraphicStyleCornerRadiusAttrBoss to the path page item. The corner-size attribute is decoupled from the corner-path implementation, so you could set and change corner size independently and use this setting with other corner implementations.</ol><h3><a class="anchor" id="id_custom_path-end_effects"></a> Custom path-end effects</h3><p>You can provide a custom path-end effect with your own path-end implementation through a kPathEndStrokerService. The service provider should provide an implementation of <a class="el" href="class_i_path_end_stroker.html">IPathEndStroker</a>. See Path-end strokers. To implement a custom path-end effect:<ol type="1"><li>Create a new boss class for the service provider (for example k&lt;XXX&gt;ArrowHeadBoss). Add a service provider to the boss class (the application-provided kPathEndStrokerServiceProviderImpl can be reused), and define your own implementation of <a class="el" href="class_i_path_end_stroker.html">IPathEndStroker</a>.<li>Create your implementation of <a class="el" href="class_i_path_end_stroker.html">IPathEndStroker</a>. The interface basically provides drawing and hit testing methods for a stroke end. A page item&#39;s stroke bounding box includes both the stroke and stroke-end bounding box returned from the method on this interface.<li>Set the implementation ID to the appropriate line-end attribute, and apply the attribute to the page item.</ol><h3><a class="anchor" id="id_custom_page-item_adornments"></a> Custom page-item adornments</h3><p>Page-item adornments customize the appearance of a page item, giving a plug-in the chance to add drawing when the page item is rendered. For example, if you want to add a drop shadow or label for a specific page item, a page-item adornment is one way to add these extra drawings.<p>Examples of page-item adornments in InDesign are the transparency drop shadow and feather effects, the graphics-frame outline path, and the empty-graphics frame indicator (the X inside the frame).<p>You can participate in page-item drawing by creating a custom page-item adornment. For example, you could provide an adornment to show in magenta type the width and height of each selected page item, as shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-104.gif" src="plugin-programming-guide-vol1-104.gif" /></div><p><b>Architecture</b><p>Page-item adornments are represented by boss objects. There are two main types of page-item adornments:<ul><li><a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a> implementations, drawn during execution of <a class="el" href="class_i_shape.html#a9ca1a20e7a9bbdd0a70e6df06288625c">IShape::ProcessDrawShape</a>.<li><a class="el" href="class_i_adornment_handle_shape.html">IAdornmentHandleShape</a> implementations, drawn during execution of HandleShape::DrawHandleShape.</ul><p>The Draw methods on their implementations determine the appearance of the adornment. Page-item adornments are connected to page items through the <a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a> interface aggregated on the <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> boss class. The following figure illustrates the basic data model for adornments. A page item aggregates the <a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a> interface, which stores a list of adornments the page item has.<div class="image"><img alt="plugin-programming-guide-vol1-105.gif" src="plugin-programming-guide-vol1-105.gif" /></div><p><b><a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a></b><p>The <a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a> interface manages a list of the adornments for a page item. Each adornment in the list is drawn in an order determined by the value of its AdornmentDrawOrder. For page-item adornments, there are several opportunities within the drawing cycle to draw.<p>Each adornment can be drawn at one or more phases within the drawing cycle if you AND together the flags defined in the AdornmentDrawOrder enumeration (defined in <a class="el" href="_i_adornment_shape_8h_source.html">IAdornmentShape.h</a> and <a class="el" href="class_i_adornment_handle_shape.html">IAdornmentHandleShape</a>). These values indicate when the adornment is to be drawn. Upon calling the command kAddPageitemAdornmentCmdBoss, the adornment is inserted into the list based on drawing order.<p>When adding an adornment to a page item, define the adornment as a new boss class that aggregates the <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a> or <a class="el" href="class_i_adornment_handle_shape.html">IAdornmentHandleShape</a> interface. In a more complex case, you can use more than one adornment for a single page item.<p><b><a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a></b><p>When implementing <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a>, you can choose to provide hit testing and invalidation of the view, if needed. At a minimum, your implementation must draw the adornment.<p>When a page item is drawn, each attached adornment is called to draw through the <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a> interface. A page-item shape tells the drawing manager at which of the following times it should be drawn:<ul><li>After the frame shape (kAfterShape).<li>Before the text foreground (kBeforeTextForeground).<li>At one of the other events defined in the adornment objects.</ul><p>The drawing order controls when the adornment is called to draw. The following figure shows the drawing sequences for one rectangle spline item. When the adornments&#39; drawing methods get called depends on the drawing order. For detailed information on page item drawing, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_drawing_page_items">Drawing page items</a>.<div class="image"><img alt="plugin-programming-guide-vol1-106.gif" src="plugin-programming-guide-vol1-106.gif" /></div><p><b><a class="el" href="class_i_adornment_handle_shape.html">IAdornmentHandleShape</a></b><p>Implementing <a class="el" href="class_i_adornment_handle_shape.html">IAdornmentHandleShape</a> lets you decorate the selection handles associated with a page item. This decoration can be drawn with <a class="el" href="class_i_adornment_handle_shape.html#a181d77b48a6a003a827436bde6e348a1aed80f46a675c533f95dbd28d7f4d30e2">IAdornmentHandleShape::kBeforeShape</a> or <a class="el" href="class_i_adornment_handle_shape.html#a181d77b48a6a003a827436bde6e348a1afa5b91c933594ba9f13861a87fa3d1de">IAdornmentHandleShape::kAfterShape</a>; that is, before or after <a class="el" href="class_i_handle_shape.html">IHandleShape</a> calls DrawHandlesImmediate.<p><b>Implementation hints</b><p>To implement a custom page-item adornment, you need to do at least the following:<ol type="1"><li>Define an adornment boss class. Depending on the nature of your adornment, you need to implement <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a> or <a class="el" href="class_i_adornment_handle_shape.html">IAdornmentHandleShape</a>. This determines how and when your adornment is drawn. In providing the implementation aggregated on the adornment boss class, you specify how the adornment is drawn and how the painted bounding box is calculated.<li>Determine when you will connect your adornment to the page-item adornment list, most likely by processing a low-level command.</ol><p>For a sample showing how to implement a custom page-item adornment, see FrameLabel in the SDK; also see other samples that provide an implementation of <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a>, such as TransparencyEffect and CustomDataLink.<h3><a class="anchor" id="id_custom_drawing-event_handler"></a> Custom drawing-event handler</h3><p>You can use a custom drawing-event handler to take control when a page item is being drawn at some point in the drawing cycle, to modify how the item draws or cancel it being drawn.<p><b>Architecture</b><p>Drawing events are messages that are broadcast at specific points in the drawing order. Each drawing event signals the beginning or end of a phase of drawing. Drawing events provide extensibility points in that drawing operations can be modified or cancelled in response to the event.<p>Drawing-event types are defined in <a class="el" href="_document_context_i_d_8h_source.html">DocumentContextID.h</a>. Some of the generic drawing event types associated with shape drawing are shown in the following table.<table class="doxtable"><tr><th>Drawing event </th><th>Use </th></tr><tr><td>kAbortCheckMessage </td><td>Opportunity to abort drawing of an entire item. </td></tr><tr><td>kBeginShapeMessage </td><td>Start of shape drawing. </td></tr><tr><td>kDrawShapeMessage </td><td>Shape drawing is about to begin. </td></tr><tr><td>kEndShapeMessage </td><td>End of shape drawing. </td></tr><tr><td>kFilterCheckMessage </td><td>Opportunity to filter drawing based on object type. </td></tr></table><p>In addition, there are other, more specific event types that signal the beginning and end of spread, layer, and page drawing. Drawing events are generated for each Draw method in the hierarchy: kBegin&lt;XXX&gt;Message, kEnd&lt;XXX&gt;Message, and kDraw&lt;XXX&gt;Message.<p>kBegin&lt;XXX&gt;Message is generated just before a call to the next level of the hierarchy (after any transformation is applied to the object). kEnd&lt;XXX&gt;Message is generated just after execution returns from a lower level of the hierarchy.<p><b>Registering and unregistering</b><p>There are two ways a plug-in can register or unregister for drawing events: as a service provider or using direct registration through the <a class="el" href="class_i_drw_evt_dispatcher.html">IDrwEvtDispatcher</a> interface.<ul><li>Drawing-event handlers can be a type of service provider. If so, they are automatically registered at start-up. A boss can register as a service provider using the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface and the kDrawEventService service ID. The boss must provide an implementation of the <a class="el" href="class_i_drw_evt_handler.html">IDrwEvtHandler</a> interface. When the application starts, the Register method in the drawing-event handler registers for the drawing events it wants to receive.<li>A second method of registering for events is to instantiate the <a class="el" href="class_i_drw_evt_dispatcher.html">IDrwEvtDispatcher</a> interface and call <a class="el" href="class_i_drw_evt_dispatcher.html#a22865b89cda5eb204530acd34c2e617c">IDrwEvtDispatcher::RegisterHandler</a> directly. This requires parameters including the event being registered for, a pointer to the event handler, and the priority of the event handler.</ul><p>In the PrintSelection SDK sample, the <a class="el" href="classk_prn_sel_draw_services_boss.html">kPrnSelDrawServicesBoss</a> boss class does not provide an implementation for <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. This is because this particular sample uses the direct registration method; see the AfterPrintUI method in PrnSelPrintSetupProvider.cpp.<p>Unregistering is similar to registering, except the call to UnRegisterHandler is on the <a class="el" href="class_i_drw_evt_dispatcher.html">IDrwEvtDispatcher</a> interface.<p><b>Drawing event-handling priorities</b><p>Drawing event handlers register their prioritized interest in particular types of drawing events. Priorities are defined in <a class="el" href="_i_drw_evt_dispatcher_8h_source.html">IDrwEvtDispatcher.h</a>. When a handler registers for an event, it must pass a priority to RegisterHandler. The priorities include the following:<ul><li>kDEHPostProcess<li>kDEHLowestPriority<li>kDEHLowPriority<li>kDEHMediumPriority<li>kDEHHighPriority<li>kDEHInitialization</ul><p>As each event is processed, handlers are called in order, from the kDEHInitialization priority down to kDEHPostProcess. If two handlers have the same priority for the same event, the handler registered first is called first. The return code for handlers registered using the kDEHInitialization priority is ignored. For additional information about return codes for the other priorities, see Handling drawing events.<p><b>Handling drawing events</b><p>The drawing-event handler&#39;s HandleEvent method takes two parameters: a ClassID that is the eventID (see <a class="el" href="_document_context_i_d_8h_source.html">DocumentContextID.h</a>) and a void pointer to a class containing the event data. For drawing events, this pointer must be cast to the <a class="el" href="class_draw_event_data.html">DrawEventData</a> class (see <a class="el" href="_i_drw_evt_handler_8h_source.html">IDrwEvtHandler.h</a>) to access the data.<p>In the HandleEvent method of the drawing-event handler, if the method returns kTrue, it is assumed the event was properly handled and no other event handlers are called for the event; therefore, the drawing at that step ceases. If the method returns kFalse, the drawing event is considered not handled, and the drawing step proceeds. A drawing-event handler that modifies or decorates the drawing of an object but does not replace it returns kFalse. Also, kEnd&lt;XXX&gt;Message does not look at the return code from the event handler, because the draw operation already completed.<p><b>Implementation</b><p>A custom drawing-event handler is an extension pattern to let third-party code participate in drawing or printing or interrupt the drawing or printing of a page item. The following steps summarize how to implement a custom drawing-event handler. The signature interface of the pattern is <a class="el" href="class_i_drw_evt_handler.html">IDrwEvtHandler</a>.<ol type="1"><li>Define your own drawing-event handler boss class.<li>Depending on how you want to register and unregister your event handler, you also may need to implement the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface, returning a ServiceID of kDrawEventService.<li>Provide an implementation of <a class="el" href="class_i_drw_evt_handler.html">IDrwEvtHandler</a>.<li>In your IDrwEvtHandler::HandleEvent implementation, you will get an event ID and a void pointer to a class containing the event data. You should cast to the <a class="el" href="class_draw_event_data.html">DrawEventData</a> and obtain the <a class="el" href="class_graphics_data.html">GraphicsData</a> pointer; then you can do your custom drawing in the same context of page-item drawing.</ol><p>For sample code, see BasicDrwEvtHandler and other samples that implement <a class="el" href="class_i_drw_evt_handler.html">IDrwEvtHandler</a> in the SDK.<h2><a class="anchor" id="id_swatch-list_state"></a> Swatch-list state</h2><h3><a class="anchor" id="id_initial_state_of_swatch_list_and_ink_list"></a> Initial state of swatch list and ink list</h3><p>When the application starts, it initializes a swatch list by creating several default swatches (rendering objects). There are reserved swatches: None, Paper, Black, and Registration. The following table lists the initial state of swatch list. Notice there are several invisible, unnamed swatches that are created but do not show up in the Swatches panel.<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Rendering object </th><th>Swatch name </th><th>Color or gradient information </th></tr><tr><td>0 </td><td>11 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Black (reserved) </td><td>kPMCsCalCMYK(0,0,0,1) </td></tr><tr><td>1 </td><td>18 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=0 M=0 Y=100 K=0 </td><td>kPMCsCalCMYK(0,0,1,0) </td></tr><tr><td>2 </td><td>19 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=0 M=100 Y=0 K=0 </td><td>kPMCsCalCMYK(0,1,0,0) </td></tr><tr><td>3 </td><td>20 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=100 M=0 Y=0 K=0 </td><td>kPMCsCalCMYK(1,0,0,0) </td></tr><tr><td>4 </td><td>21 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=100 M=90 Y=10 K=0 </td><td>kPMCsCalCMYK(1,0.9,0.1,0) </td></tr><tr><td>5 </td><td>22 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=15 M=100 Y=100 K=0 </td><td>kPMCsCalCMYK(0.15,1,1,0) </td></tr><tr><td>6 </td><td>23 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=75 M=5 Y=100 K=0 </td><td>kPMCsCalCMYK(0.75,0.05,1,0) </td></tr><tr><td>7 </td><td>12 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Cyan </td><td>kPMCsCalCMYK(1,0,0,0) </td></tr><tr><td>8 </td><td>13 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Magenta </td><td>kPMCsCalCMYK(0,1,0,0) </td></tr><tr><td>9 </td><td>14 </td><td><a class="el" href="classk_graphic_state_none_rendering_object_boss.html">kGraphicStateNoneRenderingObjectBoss</a></td><td>None (reserved) </td><td>N/A </td></tr><tr><td>10 </td><td>15 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Paper (reserved) </td><td>kPMCsCalCMYK(0,0,0,0) </td></tr><tr><td>11 </td><td>16 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Registration (reserved) </td><td>kPMCsCalCMYK(1,1,1,1) </td></tr><tr><td>12 </td><td>17 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Yellow </td><td>kPMCsCalCMYK(0,0,1,0) </td></tr><tr><td>13 </td><td>97 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>(invisible) </td><td>kPMCsCalCMYK(0,0,0,1) </td></tr><tr><td>14 </td><td>99 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>(invisible) </td><td>kPMCsCalCMYK(0,0,0,0) </td></tr><tr><td>15 </td><td>98 </td><td><a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a></td><td>(invisible) </td><td>Stop 0 UID=99, Stop 1 UID=11 </td></tr><tr><td>16 </td><td>100 </td><td><a class="el" href="classk_a_g_m_black_box_rendering_object_boss.html">kAGMBlackBoxRenderingObjectBoss</a></td><td>(invisible) </td><td>N/A </td></tr></table><p>The following table illustrates initial ink list. (UIDs are not necessarily the same for different workspaces.)<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Name </th><th>Type </th></tr><tr><td>0 </td><td>7 </td><td>Process Cyan </td><td>Process </td></tr><tr><td>1 </td><td>8 </td><td>Process Magenta </td><td>Process </td></tr><tr><td>2 </td><td>9 </td><td>Process Yellow </td><td>Process </td></tr><tr><td>3 </td><td>10 </td><td>Process Black </td><td>Process </td></tr></table><h3><a class="anchor" id="id_state_of_swatch_list_and_ink_list_after_adding_a_custom_stop_color"></a> State of swatch list and ink list after adding a custom stop color</h3><p>Adding a custom color swatch, PANTONE 368 C, causes an additional swatch-list entry to be created. For information on how to add a color swatch, see the &quot;Graphics&quot; chapter of Adobe InDesign SDK Solutions. Note the following:<ul><li>The swatch is sorted by swatch name. Since the new swatch&#39;s name is between index 9 and 10, the new color is inserted into position 10. The following row is added: 10, 167, <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a>, PANTONE 368 C, kPMCsCalCMYK (0.57,0,1,0), Spot.<li>The swatch list is reordered, so entries 10 and after are shifted down. The UIDs of the existing swatches do not change.<li>A new spot ink is added to the ink list.</ul><p>The following table illustrates the new state of the swatch list, and the second table illustrates the new state of the ink list.<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Rendering object </th><th>Swatch name </th><th>Color or gradient information </th></tr><tr><td>0 </td><td>11 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Black (reserved) </td><td>kPMCsCalCMYK(0,0,0,1) </td></tr><tr><td>1 </td><td>18 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=0 M=0 Y=100 K=0 </td><td>kPMCsCalCMYK(0,0,1,0) </td></tr><tr><td>2 </td><td>19 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=0 M=100 Y=0 K=0 </td><td>kPMCsCalCMYK(0,1,0,0) </td></tr><tr><td>3 </td><td>20 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=100 M=0 Y=0 K=0 </td><td>kPMCsCalCMYK(1,0,0,0) </td></tr><tr><td>4 </td><td>21 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=100 M=90 Y=10 K=0 </td><td>kPMCsCalCMYK(1,0.9,0.1,0) </td></tr><tr><td>5 </td><td>22 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=15 M=100 Y=100 K=0 </td><td>kPMCsCalCMYK(0.15,1,1,0) </td></tr><tr><td>6 </td><td>23 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>C=75 M=5 Y=100 K=0 </td><td>kPMCsCalCMYK(0.75,0.05,1,0) </td></tr><tr><td>7 </td><td>12 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Cyan </td><td>kPMCsCalCMYK(1,0,0,0) </td></tr><tr><td>8 </td><td>13 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Magenta </td><td>kPMCsCalCMYK(0,1,0,0) </td></tr><tr><td>9 </td><td>14 </td><td><a class="el" href="classk_graphic_state_none_rendering_object_boss.html">kGraphicStateNoneRenderingObjectBoss</a></td><td>None (reserved) </td><td>N/A </td></tr><tr><td>10 </td><td>167 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>PANTONE 368 C </td><td>kPMCsCalCMYK(0.57,0,1,0), Spot </td></tr><tr><td>11 </td><td>15 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Paper (reserved) </td><td>kPMCsCalCMYK(0,0,0,0) </td></tr><tr><td>12 </td><td>16 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Registration (reserved) </td><td>kPMCsCalCMYK(1,1,1,1) </td></tr><tr><td>13 </td><td>17 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Yellow </td><td>kPMCsCalCMYK(0,0,1,0) </td></tr><tr><td>14 </td><td>97 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>(invisible) </td><td>kPMCsCalCMYK(0,0,0,1) </td></tr><tr><td>15 </td><td>99 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>(invisible) </td><td>kPMCsCalCMYK(0,0,0,0) </td></tr><tr><td>16 </td><td>98 </td><td><a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a></td><td>(invisible) </td><td>Stop 0 UID=99, Stop 1UID=11 </td></tr><tr><td>17 </td><td>100 </td><td><a class="el" href="classk_a_g_m_black_box_rendering_object_boss.html">kAGMBlackBoxRenderingObjectBoss</a></td><td>(invisible) </td><td>N/A </td></tr></table><p>Ink list after a stop color is added to swatch:<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Name </th><th>Type </th></tr><tr><td>0 </td><td>7 </td><td>Process Cyan </td><td>Process </td></tr><tr><td>1 </td><td>8 </td><td>Process Magenta </td><td>Process </td></tr><tr><td>2 </td><td>9 </td><td>Process Yellow </td><td>Process </td></tr><tr><td>3 </td><td>10 </td><td>Process Black </td><td>Process </td></tr><tr><td>4 </td><td>166 </td><td>PANTONE 368 C </td><td>Spot </td></tr></table><h3><a class="anchor" id="id_swatch_list_and_ink_list_after_adding_a_gradient_swatch"></a> Swatch list and ink list after adding a gradient swatch</h3><p>The user also may add a custom gradient. Adding a gradient may add additional colors for a gradient stop. Similar to what occurs when adding a custom color swatch, new entries are created for these added colors and gradients. For information on adding a gradient swatch, see the &quot;Graphics&quot; chapter of Adobe InDesign SDK Solutions. The following table lists only the new entries for the swatch list, and the second table illustrates the updated ink list.<p>This table shows new entries in the swatch list after adding a custom gradient:<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Rendering object </th><th>Swatch name </th><th>Color or gradient information </th></tr><tr><td>13 </td><td>169 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Stop 1 </td><td>kPMCsCalCMYK(0.2,1,0.5,0) </td></tr><tr><td>14 </td><td>171 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Stop 2 </td><td>kPMCsCalRGB(0,1,0.5) </td></tr><tr><td>15 </td><td>173 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>Stop 3 </td><td>kPMCsCalCMYK(0,0.3,0.9,0) </td></tr><tr><td>16 </td><td>174 </td><td><a class="el" href="classk_gradient_rendering_object_boss.html">kGradientRenderingObjectBoss</a></td><td>Tie-dye </td><td>Stop 0 UID=169, Stop 1UID=171, Stop 2 UID =173 </td></tr></table><p>The new gradient, Tie-dye, has three stops, so these three color swatches (Stop 1, Stop 2, and Stop 3) also are inserted into the swatch list.<p>For the existing swatches we did not list here, the swatch data did not change, but their indices were changed to make room for new swatches. The new swatches are inserted continuously, because these new swatch names happened to be in continuous position with existing names.<p>This table show the ink list after a gradient with three-stop colors is added to a swatch:<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Name </th><th>Type </th></tr><tr><td>0 </td><td>7 </td><td>Process Cyan </td><td>Process </td></tr><tr><td>1 </td><td>8 </td><td>Process Magenta </td><td>Process </td></tr><tr><td>2 </td><td>9 </td><td>Process Yellow </td><td>Process </td></tr><tr><td>3 </td><td>10 </td><td>Process Black </td><td>Process </td></tr><tr><td>4 </td><td>166 </td><td>PANTONE 368 C </td><td>Spot </td></tr><tr><td>5 </td><td>168 </td><td>Stop 1 </td><td>Spot </td></tr><tr><td>6 </td><td>170 </td><td>Stop 2 </td><td>Spot </td></tr><tr><td>7 </td><td>172 </td><td>Stop 3 </td><td>Spot </td></tr></table><p>Since the gradient stop colors are spot colors, they also are added to the ink list.<h3><a class="anchor" id="id_swatch_list_and_ink_list_after_applying_an_unnamed_color_to_an_object"></a> Swatch list and ink list after applying an unnamed color to an object</h3><p>When an instance of a color is chosen with the Color Picker panel and applied to a page item, a new, unnamed swatch entry is added to the end of the swatch list. See the following table.<table class="doxtable"><tr><th>Index </th><th>UID </th><th>Rendering object </th><th>Swatch name </th><th>Color or gradient information </th></tr><tr><td>22 </td><td>177 </td><td><a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a></td><td>(invisible) </td><td>kPMCsCalCMYK(0.4715,0,0.75,0) </td></tr></table><p>Unnamed swatches are not sorted, so a new unnamed swatch is appended at the end. After the previous step (adding a gradient), there were 22 swatches total in the list, so this step adds the swatch at index 22.<p>Unnamed swatches do not appear in the Swatches panel, but they can be used for the strokes and fills of document objects by client code. When a color is chosen through the Color panel, the active graphic state changes, and a new swatch may be created. A new swatch is created in the swatch list only if the new color is applied to a document object; that is, if there is an active selection when the color is created or the color is applied to an object like a spline page item.<p>Because the added unnamed color is a process color, the inks this color uses to print (that is, Process Cyan, Process Magenta, Process Yellow, and Process Black) already are in the ink list, so the ink list does not change. Applying a new gradient to a page-item object through the Gradient panel results in a similar state.<h3><a class="anchor" id="id_color_spaces"></a> Color spaces</h3><p>There are three common color spaces: RGB, CMYK, and L*a*b*.<p><b>RGB color spaces</b><p>RGB is a device-dependent color model. It is the native color model of monitors, scanners and digital cameras.<p>The kPMCsCalRGB space denotes calibrated RGB. Although the space is device-dependent, coordinates within this space are not arbitrary. There are several, slightly different color spaces that use the RGB color model:<ul><li>Adobe RGB (1998) - Previously referred to as SMPTE-240M.<li>Apple &reg; RGB - The default color space for Photoshop 3 and 4.<li>ColorMatch RGB - Based on the Radius PressView display. This has a smaller gamut than Adobe RGB (1998) and other color spaces for print production jobs.<li>sRGB (IEC61966-2.1) - The default color space for Photoshop 5. This reflects the color properties of the average computer monitor. It was proposed in 1996 by Hewlett-Packard and Microsoft&reg; for representing color on the Internet, as described at <a href="http://www.w3.org/Graphics/Color/sRGB.html">http://www.w3.org/Graphics/Color/sRGB.html </a>. sRGB also is the color space used to represent color in SVG documents. For more information about SVG, go to <a href="http://www.w3.org/TR/SVG">http://www.w3.org/TR/SVG </a> .</ul><p><b>CMYK</b><p>Like RGB, CMYK is a device-dependent color model. It is the native color model of most printers. Many color spaces use the CMYK color model. For example, the InDesign color-management user interface lets the end user specify any of the following:<ul><li>Euroscale Coated v2<li>Euroscale Uncoated v2<li>Japan Standard v2<li>U.S. Sheetfed Coated v2<li>U.S. Sheetfed Uncoated v2<li>U.S. Web Coated (SWOP) v2<li>U.S. Web Uncoated v2</ul><p>The choice of color space is governed by expectations about the properties of the press on which the job will be printed.<p><b>LAB</b><p>L*a*b* (1976 CIE L*a*b* Space) is device-independent and is the basic color model in PostScript. L*a*b* is used for color management as the device-independent model of the ICC device profiles.<p>L*a*b* was standardized in 1976 to provide a space that is perceptually uniform. L*a*b* has its basis in the CIE standard observer, derived by analysis of the physiology of the retina and the early visual pathways.<p>The terms L*, a*, and b* refer to coordinate axes within the space. L is a function of luminance, the physical correlate of brightness. The other coordinates are less easily understood in physical terms and better regarded as mathematical abstractions.<h2><a class="anchor" id="id_catalog_of_graphic_attributes"></a> Catalog of graphic attributes</h2><p>There are many graphic attributes in the application. Sometimes several attributes collaborate to implement a feature, like transparency; sometimes the values of some attributes are important, like color and stroke-line implementations.<p>The following figure is a master list of graphic attributes. The attribute boss class, name, and interface that store the attribute value are listed. Other information is provided in the boolean matrix on the right of the table.<p>The list can be obtained from the API Reference in two ways:<ul><li>Look for <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a> and see which boss classes aggregate this interface.<li>Look at the <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a> boss class and examine the list of subclasses of this class.</ul><dl class="section note"><dt>Note<dd>This list is not a complete list of graphic attributes and is not updated for each release.</dl><div class="image"><img alt="plugin-programming-guide-vol1-107.gif" src="plugin-programming-guide-vol1-107.gif" /></div><div class="image"><img alt="plugin-programming-guide-vol1-108.gif" src="plugin-programming-guide-vol1-108.gif" /></div><div class="image"><img alt="plugin-programming-guide-vol1-109.gif" src="plugin-programming-guide-vol1-109.gif" /></div><p>Some boss classes inherit from <a class="el" href="classk_graphics_attr_boss.html">kGraphicsAttrBoss</a> and implement <a class="el" href="class_i_graphic_attribute_info.html">IGraphicAttributeInfo</a>. They are the base classes for graphic attributes, but they do not represent standalone attributes. These bosses are excluded from the master attributes list and are listed in the following table for reference.<table class="doxtable"><tr><th>Boss ID </th><th>Description </th></tr><tr><td><a class="el" href="classk_vignette_attr_boss.html">kVignetteAttrBoss</a></td><td>Parent attribute boss for all basic feather attributes. </td></tr><tr><td><a class="el" href="classk_drop_shadow_attr_boss.html">kDropShadowAttrBoss</a></td><td>Parent attribute boss for all drop-shadow attributes. </td></tr><tr><td><a class="el" href="classk_x_p_attr_boss.html">kXPAttrBoss</a></td><td>Parent attribute boss for all basic-transparency attributes. </td></tr><tr><td><a class="el" href="classk_x_p_inner_shadow_attr_boss.html">kXPInnerShadowAttrBoss</a></td><td>Parent attribute boss for all inner-shadow attributes. </td></tr><tr><td><a class="el" href="classk_x_p_outer_glow_attr_boss.html">kXPOuterGlowAttrBoss</a></td><td>Parent attribute boss for all outer-glow attributes. </td></tr><tr><td><a class="el" href="classk_x_p_inner_glow_attr_boss.html">kXPInnerGlowAttrBoss</a></td><td>Parent attribute boss for all inner-glow attributes. </td></tr><tr><td><a class="el" href="classk_x_p_bevel_emboss_attr_boss.html">kXPBevelEmbossAttrBoss</a></td><td>Parent attribute boss for all bevel and emboss attributes. </td></tr><tr><td><a class="el" href="classk_x_p_satin_attr_boss.html">kXPSatinAttrBoss</a></td><td>Parent attribute boss for all satin attributes. </td></tr><tr><td><a class="el" href="classk_x_p_directional_feather_attr_boss.html">kXPDirectionalFeatherAttrBoss</a></td><td>Parent attribute boss for all directional-feather attributes. </td></tr><tr><td><a class="el" href="classk_x_p_gradient_feather_attr_boss.html">kXPGradientFeatherAttrBoss</a></td><td>Parent attribute boss for all gradient-feather attributes. </td></tr><tr><td><a class="el" href="classk_default_graphics_attr_boss.html">kDefaultGraphicsAttrBoss</a></td><td>Parent of <a class="el" href="classk_graphic_style_non_print_attr_boss.html">kGraphicStyleNonPrintAttrBoss</a>. </td></tr><tr><td><a class="el" href="classk_stroke_effect_graphics_attr_boss.html">kStrokeEffectGraphicsAttrBoss</a></td><td>Parent of all stroke-effect attributes (line cap, join type, etc.). </td></tr><tr><td><a class="el" href="classk_corner_effect_graphics_attr_boss.html">kCornerEffectGraphicsAttrBoss</a></td><td>Parent of all corner-effect attributes (corner implementation, size). </td></tr><tr><td><a class="el" href="classk_fill_graphics_attr_boss.html">kFillGraphicsAttrBoss</a></td><td>Parent of all fill attributes (gradient fill, gradient fill angle, fill color, overprint, etc.). </td></tr><tr><td><a class="el" href="classk_stroke_graphics_attr_boss.html">kStrokeGraphicsAttrBoss</a></td><td>Parent of all stroke attributes (gradient stroke, gradient-stroke angle, stroke color, stroke weight, etc.). </td></tr><tr><td><a class="el" href="classk_gradient_stroke_graphics_attr_boss.html">kGradientStrokeGraphicsAttrBoss</a></td><td>Gradient stroke itself is parent of all gradient-stroke attributes (length, gradient center, radius, etc.). </td></tr><tr><td><a class="el" href="classk_gradient_fill_graphics_attr_boss.html">kGradientFillGraphicsAttrBoss</a></td><td>Gradient fill stroke itself is parent of all gradient fill attributes (length, gradient center, radius, etc.) </td></tr></table><h2><a class="anchor" id="id_mappings_between_attribute_domains"></a> Mappings between attribute domains</h2><p>The following table lists graphic-attribute-to-text-attribute mappings:<table class="doxtable"><tr><th>Graphic-attribute class </th><th>Text-attribute class </th></tr><tr><td><a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a></td><td><a class="el" href="classk_text_attr_color_boss.html">kTextAttrColorBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_fill_tint_attr_boss.html">kGraphicStyleFillTintAttrBoss</a></td><td><a class="el" href="classk_text_attr_stroke_tint_boss.html">kTextAttrStrokeTintBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_gradient_fill_angle_attr_boss.html">kGraphicStyleGradientFillAngleAttrBoss</a></td><td><a class="el" href="classk_text_attr_grad_length_boss.html">kTextAttrGradLengthBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_gradient_fill_grad_center_attr_boss.html">kGraphicStyleGradientFillGradCenterAttrBoss</a></td><td><a class="el" href="classk_text_attr_grad_center_boss.html">kTextAttrGradCenterBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_gradient_stroke_angle_attr_boss.html">kGraphicStyleGradientStrokeAngleAttrBoss</a></td><td><a class="el" href="classk_text_attr_stroke_grad_angle_boss.html">kTextAttrStrokeGradAngleBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_gradient_stroke_grad_center_attr_boss.html">kGraphicStyleGradientStrokeGradCenterAttrBoss</a></td><td><a class="el" href="classk_text_attr_stroke_grad_center_boss.html">kTextAttrStrokeGradCenterBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_gradient_stroke_length_attr_boss.html">kGraphicStyleGradientStrokeLengthAttrBoss</a></td><td><a class="el" href="classk_text_attr_stroke_grad_length_boss.html">kTextAttrStrokeGradLengthBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_overprint_fill_attr_boss.html">kGraphicStyleOverprintFillAttrBoss</a></td><td><a class="el" href="classk_text_attr_overprint_boss.html">kTextAttrOverprintBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_overprint_stroke_attr_boss.html">kGraphicStyleOverprintStrokeAttrBoss</a></td><td><a class="el" href="classk_text_attr_stroke_overprint_boss.html">kTextAttrStrokeOverprintBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_rendering_attr_boss.html">kGraphicStyleStrokeRenderingAttrBoss</a></td><td><a class="el" href="classk_text_attr_stroke_color_boss.html">kTextAttrStrokeColorBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_weight_attr_boss.html">kGraphicStyleStrokeWeightAttrBoss</a></td><td><a class="el" href="classk_text_attr_outline_boss.html">kTextAttrOutlineBoss</a></td></tr></table><p>The following table lists graphic-attribute-to-table-attribute mapping:<table class="doxtable"><tr><th>Graphic-attribute class </th><th>Table-attribute class </th></tr><tr><td><a class="el" href="classk_graphic_style_fill_rendering_attr_boss.html">kGraphicStyleFillRenderingAttrBoss</a></td><td><a class="el" href="classk_cell_attr_fill_color_boss.html">kCellAttrFillColorBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_fill_tint_attr_boss.html">kGraphicStyleFillTintAttrBoss</a></td><td><a class="el" href="classk_cell_attr_fill_tint_boss.html">kCellAttrFillTintBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_overprint_fill_attr_boss.html">kGraphicStyleOverprintFillAttrBoss</a></td><td><a class="el" href="classk_cell_attr_fill_overprint_boss.html">kCellAttrFillOverprintBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_overprint_stroke_attr_boss.html">kGraphicStyleOverprintStrokeAttrBoss</a></td><td><a class="el" href="classk_cell_stroke_attr_data_boss.html">kCellStrokeAttrDataBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_line_impl_attr_boss.html">kGraphicStyleStrokeLineImplAttrBoss</a></td><td><a class="el" href="classk_cell_stroke_attr_data_boss.html">kCellStrokeAttrDataBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_rendering_attr_boss.html">kGraphicStyleStrokeRenderingAttrBoss</a></td><td><a class="el" href="classk_cell_stroke_attr_data_boss.html">kCellStrokeAttrDataBoss</a></td></tr><tr><td><a class="el" href="classk_graphic_style_stroke_weight_attr_boss.html">kGraphicStyleStrokeWeightAttrBoss</a></td><td><a class="el" href="classk_cell_stroke_attr_data_boss.html">kCellStrokeAttrDataBoss</a></td></tr></table><h2><a class="anchor" id="id_spread-drawing_sequence"></a> Spread-drawing sequence</h2><p>Once the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> <a class="el" href="class_i_control_view.html">IControlView</a> implementation obtains a list of the visible spreads, it has to ask each spread to draw through the InDesign draw manager. This section describes the overall sequence for drawing the layout hierarchy.<p>The collaboration for drawing the layout hierarchy is shown in the following figure. The <a class="el" href="class_i_control_view.html">IControlView</a> implementation on the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> calls the draw manager once for each visible spread in the window&#39;s view. The draw manager is responsible for creating a <a class="el" href="class_graphics_data.html">GraphicsData</a> object that describes the graphics context for the spread&#39;s drawing. Specifically, it sets the transformation matrix in the graphics port to support drawing in the spread&#39;s parent coordinate system, which is the pasteboard. The draw manager then calls the spread&#39;s <a class="el" href="class_i_shape.html#a9ca1a20e7a9bbdd0a70e6df06288625c">IShape::ProcessDrawShape</a> method to initiate the sequence of drawing that spread.<div class="image"><img alt="plugin-programming-guide-vol1-110.gif" src="plugin-programming-guide-vol1-110.gif" /></div><p>When an item&#39;s <a class="el" href="class_i_shape.html#a9ca1a20e7a9bbdd0a70e6df06288625c">IShape::ProcessDrawShape</a> method is called, it must draw itself, then its children. This action is analogous to the mechanism used for the <a class="el" href="class_i_control_view.html">IControlView</a> interface on widgets. The <a class="el" href="class_i_shape.html">IShape</a> implementation provides methods for drawing an object and iterating over the object&#39;s children, asking each of them to draw. Before drawing, the <a class="el" href="class_i_shape.html">IShape</a> implementation sets the transformation matrix in the graphics port to the item&#39;s inner coordinates. This establishes the following conventions:<ul><li>Each drawing object expects to receive the graphics port set to its parent&#39;s coordinate system.<li>Each drawing object sets the graphics port to its inner coordinates before drawing itself or calling its children to draw.<li>Each drawing object reverts the graphics port to its parent&#39;s coordinate system before returning to the caller.</ul><p>Iterating over the object&#39;s children is accomplished by using the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface on each page item. This interface provides methods for iterating over the layout hierarchy. For more information about the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface, see Chapter 7, &quot;Layout Fundamentals.&quot;<p>After being called by the draw manager, spread drawing always follows the layout hierarchy. Users can control whether the guides appear in front of the content or behind it, and this affects the hierarchy. Assuming guides are behind the content, page layers are drawn first, followed by the content layers, then the guide layers. If the guide layers appear in front of the content, the guides draw before the content. All content on a given layer is drawn before proceeding to the next layer. Embedded children of a page item are called to draw before that item completes its drawing. For example, when the <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> is called to draw in step 2.2.1 of the preceding figure, if it had children, they would be called to draw as step 2.2.1.1 and 2.2.1.2. before returning to the <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>.<h2><a class="anchor" id="id_controlling_the_settings_in_a_graphics_port"></a> Controlling the settings in a graphics port</h2><p>The port&#39;s transform can be modified by translations, scale factors, and rotations, and a new transform can be concatenated to the existing port. Concatenation is most often used when page items draw; it is how a page item sets the port to draw to its inner coordinates. The following example shows sample code demonstrating this operation. For more information on the application coordinate systems, see Chapter 7, &quot;Layout Fundamentals.&quot; <div class="fragment"><div class="line"><span class="comment">// Get the graphics port from gd, a GraphicsData*.</span></div><div class="line"><a class="code" href="class_i_graphics_port.html">IGraphicsPort</a>* gPort = gd-&gt;GetGraphicsPort();</div><div class="line"><span class="keywordflow">if</span> (gPort == nil)</div><div class="line"><span class="keywordflow">return</span>;</div><div class="line"><span class="comment">// Save the current port settings.</span></div><div class="line">gPort-&gt;<a class="code" href="class_i_graphics_port.html#a3764f1bf8f80d8e61cbd49f4a02b53af">gsave</a>();</div><div class="line"><span class="comment">// Get this page item&#39;s ITransform interface.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITransform&gt;</a> xform(<span class="keyword">this</span>, <a class="code" href="classk_page_item_boss.html#a339fc3e067d82cab61d1dccc170f048e">IID_ITRANSFORM</a>);</div><div class="line"><span class="comment">// Concatenate the inner to parent matrix to the port.</span></div><div class="line">gPort-&gt;<a class="code" href="class_i_graphics_port.html#a6081265aa1d14616c7a8a838bbd506ab">concat</a>(xform-&gt;CurrentMatrix());</div><div class="line"><span class="comment">// Draw a rectangle around the item.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGeometry&gt;</a> geo (<span class="keyword">this</span>, <a class="code" href="classk_in_design_page_item_boss.html#a0d0f67667837ef8228492323acac7af2">IID_IGEOMETRY</a>);</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_p_m_rect.html">PMRect</a> r = geo-&gt;GetStrokeBoundingBox();</div><div class="line">gPort-&gt;rectpath(r);</div><div class="line">gPort-&gt;<a class="code" href="class_i_graphics_port.html#a3254d1be69314081d7bf80dd26fa9e3e">stroke</a>();</div><div class="line"><span class="comment">// Restore the previous port settings.</span></div><div class="line">gPort-&gt;<a class="code" href="class_i_graphics_port.html#a3a6f5ed188b108c4ead3575f3ea7136e">grestore</a>();</div></div><h2><a class="anchor" id="id_drawing_sequence_for_a_page_item"></a> Drawing sequence for a page item</h2><p>The drawing sequence for a page item that implements <a class="el" href="class_i_shape.html">IShape</a> involves more than just the drawing instructions. Extensibility points are built into the sequence, in the form of drawing events and adornments. Extensibility points are described in <a class="el" href="id_adobe_indesign_cc_tool_kit_guide.html#id_extension_patterns">Extension patterns</a>.<p>Although each <a class="el" href="class_i_shape.html">IShape</a> implementation may have its own specific drawing sequence, all implementations follow these steps as guidelines:<ol type="1"><li>When a page item begins drawing, three drawing events are broadcast (kAbortCheckMessage, kFilterCheckMessage, and kDrawShapeMessage). No <a class="el" href="class_i_shape.html">IShape</a> drawing activities occur between the broadcasts.<li>Save the graphics port state by calling <a class="el" href="class_i_graphics_port.html#a3764f1bf8f80d8e61cbd49f4a02b53af">IGraphicsPort::gsave</a>. The graphics port is set to draw in the page item&#39;s inner coordinate system.<li>A kBeginShapeMessage drawing event is broadcast. If any drawing-event handler returns kTrue, the drawing activity ends.<li>Draw kBeforeShape page item adornments.<li>Draw the page item&#39;s own shape by calling the protected method CShape::DrawShape. This method varies depending on the nature of the page item. The following is a list of common tasks the DrawShape method may accomplish:</ol><ul><li>Define the item&#39;s path.<li>Fill the path.<li>Set the port to clip to the path.<li>Draw the item&#39;s children.<li>Stroke the path.</ul><ol type="1"><li>Draw kAfterShape page-item adornments.</ol><p>There are types of page-item adornments other than kBeforeShape and kAfterShape. These may be called to draw at other points in the sequence. The use of graphics-port save and restore operations allows the adornments and child drawing routines to modify the port as needed and return it to a known state for the next drawing step.<p>For details of the code responsible for drawing, see the CShape.cpp and CGraphicFrameShape.cpp source code in the SDK, under &lt;SDK&gt;/source/public/libs/publiclib/pageitems/basicinterfaces. For examples of how to create your own shapes, also see the BasicShape and CandleChart sample plug-ins.<h1><a class="anchor" id="id_text_fundamentals"></a> Text Fundamentals</h1><p>This chapter provides background on the fundamental concepts and subsystems that implement text features. It has the following objectives:<ul><li>Describe the model for text content -how raw text and formatting information is managed.<li>Describe how the presentation of text (that is, the actual rendered text) is modeled within the application, including both the glyphs that represent the text and the objects that manage the placement of glyphs on a spread.<li>Describe text composition, the process of taking the content model and incomplete presentation model to generate the final appearance of text in the presentation model.<li>Describe fonts and how they relate to the InDesign text subsystem.</ul><p>The following table lists resources for more information on relevant topics.<table class="doxtable"><tr><th>For ... </th><th>Go to ... </th></tr><tr><td>More information on digital typography topics </td><td><a href="http://www.adobe.com/products/type/adobe-type-references-tips.html">http://www.adobe.com/products/type/adobe-type-references-tips.html </a></td></tr><tr><td>A glossary of typographic terms </td><td><a href="http://www.adobe.com/products/type/adobe-type-references-tips/glossary.html">http://www.adobe.com/products/type/adobe-type-references-tips/glossary.html </a></td></tr><tr><td>An overview of Adobe type technology </td><td><a href="http://www.adobe.com/devnet/opentype.html">http://www.adobe.com/devnet/opentype.html </a></td></tr><tr><td>PostScript </td><td><a href="http://www.adobe.com/products/postscript.html">http://www.adobe.com/products/postscript.html </a></td></tr></table><h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>This section introduces the subsystems that implement the text architecture. The core text architecture can be divided into the following core subsystems: text content, text presentation, and text composition. Subsystems that extend the core include import and export, text styles, editors, and text search/replace.<p>The text-content subsystem manages the content of a story. It stores the characters and attributes that control the styled appearance of text.<p>The text-presentation subsystem deals with where the text glyphs appear on the page. Text is composed into frames that display a story. A frame is a visual container for text. Visually, a story is displayed through a linked set of one or more frames. The frames have properties-such as the number of columns, column width, and text inset-that control where text flows. Text-wrap settings on overlapping frames may affect this flow. After text is composed, it has a visual appearance and exhibits many of the same geometry traits as other page items.<p>The text-composition subsystem manages the process that flows text into a set of specified containers. Fonts provide the text-composition subsystem with the glyph dimensions it needs to arrange glyphs into lines of a given width.<h2><a class="anchor" id="id_text_content"></a> Text content</h2><p>This section describes how the raw character and formatting information for a story is maintained within the application. Text content represents the information required to render a set of characters. This information includes the Unicode character values, along with any formatting information that defines the appearance of text, contents of footnotes and tables, inline graphics, and styles that can be applied to text.<h3><a class="anchor" id="id_stories"></a> Stories</h3><p>Text content within a document is represented by a story (signature interface <a class="el" href="class_i_text_model.html">ITextModel</a>). A single, related set of text is maintained within a single story. The document can contain multiple stories. All stories within the document can be accessed through the <a class="el" href="class_i_story_list.html">IStoryList</a> interface on the <a class="el" href="classk_doc_boss.html">kDocBoss</a> class. The following figure shows this relationship.<div class="image"><img alt="plugin-programming-guide-vol1-111.gif" src="plugin-programming-guide-vol1-111.gif" /></div><p>A document can contain private, feature-dependent stories, which are defined not to be user-accessible. Other features (like find/replace and spelling) ignore these stories. Programmatically, they can be accessed through the <a class="el" href="class_i_story_list.html">IStoryList</a> interface, as with any other story.<p>Generally, stories are not directly created or deleted. The life-cycle of a story is controlled as a side effect of another operation. For example, creating a text frame using the Type tool causes a text story to be created, whereas linking two text frames together causes a story to be deleted. It is possible to control the lifetime of a story directly, though the story is still subject to the side effects of manipulating an associated text frame.<p>A story has a length, which can be accessed using <a class="el" href="class_i_text_model.html#a180aa88077b36e3fea671b34508227bd">ITextModel::TotalLength</a>. A story has a minimum length of one character: a terminating kTextChar_CR, which is inserted into the story when the story is created. This character should not be deleted.<p>The textual content of a story is maintained independently from the visual containers in which it is contained; that is, its layout on the page. The text content from a story can be contained within one frame, flow between columns within a frame, or even flow between multiple frames. For example, the following figure shows three stories, each flowing through different sets of containers. The model used in maintaining the text content for each is the same. Determining where a particular glyph is rendered is the responsibility of the composer.<div class="image"><img alt="plugin-programming-guide-vol1-112.gif" src="plugin-programming-guide-vol1-112.gif" /></div><p>Information related to the text in a story is maintained by a set of strands. Strands represent parallel sets of information, each of which holds a component of the story. The strands intertwine to give a complete description of the story. Strands are identified using the <a class="el" href="class_i_strand.html">IStrand</a> signature interface. Some common strands are shown in the following figure, where the text story aggregates the strands representing the content:<div class="image"><img alt="plugin-programming-guide-vol1-113.gif" src="plugin-programming-guide-vol1-113.gif" /></div><p><b>Strands</b><p>Strands (signature interface <a class="el" href="class_i_strand.html">IStrand</a>) model the linear behavior of text. Each strand represents a different aspect of textual information. A story can be thought of as the composition of the set of strands that contain information for a particular aspect of the story. The preceding figure shows a story with associated text, paragraph-attribute, and character-attribute strands. It also shows the owned item strand used to maintain objects within the text, like inline graphics.<p>Each strand has the same virtual length, equal to the value returned by <a class="el" href="class_i_text_model.html#a180aa88077b36e3fea671b34508227bd">ITextModel::TotalLength</a>. Each position within a strand refers to the same logical position within the other strands and the story as a whole. For example, position 10 on the <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a> relates to a particular character -the character at position 10 within the <a class="el" href="classk_char_attr_strand_boss.html">kCharAttrStrandBoss</a> refers to formatting information applicable to this character. Any modification of the text length is reflected in each strand.<p>The following figure shows some text and how it might be represented on two strands. While the actual storage mechanism for the strands is of little interest, both strands have the same virtual length. A story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) comprises a set of strands, each with the same length. The figure shows only the data (<a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a>) and paragraph-attribute (<a class="el" href="classk_para_attr_strand_boss.html">kParaAttrStrandBoss</a>) strands.<div class="image"><img alt="plugin-programming-guide-vol1-114.gif" src="plugin-programming-guide-vol1-114.gif" /></div><p>Formatting is defined in <a class="el" href="id_solutions.html#id_text_formatting">Text formatting</a>.<p><b>Runs</b><p>Strands are further divided into runs. A run represents something about the content of a particular strand. For the <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a>, a run is a manageable-sized chunk of text data. For the <a class="el" href="classk_para_attr_strand_boss.html">kParaAttrStrandBoss</a>, a run exists for each paragraph in the story. For the <a class="el" href="classk_char_attr_strand_boss.html">kCharAttrStrandBoss</a>, a run represents a sequence of characters that share the same formatting information. The semantics of a run is defined by its strand.<p><b>Owned items</b><p>Owned items (signature interface <a class="el" href="class_i_owned_item.html">IOwnedItem</a>) exist to allow some object to be associated with a particular TextIndex position in the text strand. Generally, features anchor the owned item into the text by placing a special character into the <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a>; however, there is no requirement for associating an owned item with a special character in the data strand. The following figure shows an instance diagram associated with a story that contains an inline image. The story has the character &quot;a&quot; followed by an inline image, then the character &quot;b.&quot; The owned item strand (<a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>) maintains the UID of the inline object (<a class="el" href="classk_inline_boss.html">kInlineBoss</a>). The actual image (kImageItem-note the nonstandard name) is associated through the hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>).<div class="image"><img alt="plugin-programming-guide-vol1-115.gif" src="plugin-programming-guide-vol1-115.gif" /></div><p><b>Anchored-item positioning</b><p>The positioning of an inline object relative to its anchor position in the text is controlled through the <a class="el" href="class_i_anchored_object_data.html">IAnchoredObjectData</a> interface. The default behavior is defined by the <a class="el" href="class_i_anchored_object_data.html">IAnchoredObjectData</a> on the session and document-workspace boss classes. Object styles also can define how an inline object is positioned (<a class="el" href="class_i_anchored_object_data.html">IAnchoredObjectData</a> on <a class="el" href="classk_object_style_boss.html">kObjectStyleBoss</a>). Specific inline objects can be modified (<a class="el" href="class_i_anchored_object_data.html">IAnchoredObjectData</a> on <a class="el" href="classk_inline_boss.html">kInlineBoss</a>).<p>The placement of inline objects can be specified as any of the following:<ul><li>Within the text flow (with variable offset on the y axis).<li>Above the line, aligned to the center, right, or left of the text or spline. A variable amount of space before and after the inline object can be specified.<li>A custom position on the page, relative to the anchor point, text frame, page, or spline.</ul><p>As the content that contains the anchor is manipulated (by either adding text that causes the anchor to flow out of the initial frame or manipulating the frames in which the text is contained), the position of the inline object is updated automatically.<p><b>Story threads</b><p>Strands model the linear nature of text; however, not all text within a story is linear. For example, an embedded table can have cells with textual content that flows independently from the main text in the story. Story threads (signature interface <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) represent these distinct flows of text.<p>Each story has at least one story thread, the primary story thread, which represents the main text of the story. Other text elements (like footnotes) contained within a story are anchored off the primary story thread using owned items, as described in Owned items.<p>The interface that models story threads (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) is maintained on the boss class related to the text it represents. For the primary story thread, the interface is found on the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>. For footnotes, the interface is on <a class="el" href="classk_footnote_reference_boss.html">kFootnoteReferenceBoss</a>. The story thread maintains text indices that identify the range of text within the story that relates to the particular strands.<p>The following figure shows a story with only text within the primary story thread (that is, the story uses no features requiring other story threads). The story instance (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) has four associated strands. There is one story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) in this story.<div class="image"><img alt="plugin-programming-guide-vol1-116.gif" src="plugin-programming-guide-vol1-116.gif" /></div><p>The primary story thread always begins at TextIndex 0. Other features, like footnotes and tables, use story threads to maintain the feature text as a distinct entity. The following figure shows an instance diagram of a story with a footnote. In the figure, a text-story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) maintains a relationship with some part of the text in a story. In this example, the primary story thread (on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) ranges between TextIndex 0 and 3, and the footnote (<a class="el" href="classk_footnote_reference_boss.html">kFootnoteReferenceBoss</a>) ranges between TextIndex 4 and 8.<div class="image"><img alt="plugin-programming-guide-vol1-117.gif" src="plugin-programming-guide-vol1-117.gif" /></div><p><b>Story-thread dictionaries and hierarchies</b><p>Each distinct instance of a text feature within a story has a distinct text-story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>), including the main story text (the primary story thread). Text-story threads are associated with a particular TextIndex, known as the anchor, obtainable with <a class="el" href="class_i_text_story_thread_dict.html#a114c37e7422c2b13df37c3bc2cbee372">ITextStoryThreadDict::GetAnchorTextRange</a>. This does not apply to the primary story thread, which is the only thread that always returns an anchor position of zero. An anchor for a footnote appears to the users in the user interface as the footnote-reference character. The anchor for a table appears as the table itself.<p>A text-story thread can contain anchors for other text story threads, subject to some restrictions; for example, footnotes can contain tables but not other footnotes. A feature does not need to associate the story thread with a particular TextIndex, in which case it is associated with the end of story marker for the primary text-story thread (these are unanchored threads).<p>A thread block is a contiguous text range (TextRange) that contains the contents for one text-story thread. If a text-story thread contains a set of anchors, the thread blocks associated with these anchors directly follow the thread block for this story thread. This is depicted in the following figure, which shows a story with two footnotes, one containing a two-cell table. Note how the thread blocks for the table directly follows the thread block for the footnote into which it is anchored. In the figure, <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a> manages the story threads for a particular use of a feature. There is one story thread for the primary story, one for each footnote, and two for the embedded table.<div class="image"><img alt="plugin-programming-guide-vol1-118.gif" src="plugin-programming-guide-vol1-118.gif" /></div><p>The text-story thread dictionary (<a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a>) maintains the set of story threads associated with a particular use of a feature. In the figure, each feature has one associated story thread, apart from the table. Each cell in the table has a distinct story thread. <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a> is responsible for managing the set of threads in the table.<p>Text story threads have a hierarchical relationship (the root being the primary story thread). Individual features are responsible for managing a set of one or more story threads using the story-thread dictionary (<a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a>). In the figure, <a class="el" href="classk_footnote_reference_boss.html">kFootnoteReferenceBoss</a> (UID1) manages one text-story thread, while <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> (UID3) manages two story threads, one for each cell. The story maintains a dictionary hierarchy (<a class="el" href="class_i_text_story_thread_dict_hier.html">ITextStoryThreadDictHier</a>), which provides the ability to iterate across all objects that contain a dictionary associated with the story.<h3><a class="anchor" id="id_text_formatting"></a> Text formatting</h3><p>This section describes how the style information that controls the look of text is maintained within the application.<p><b>Text attributes</b><p>The fundamental component for formatting text is the text attribute (signature interface <a class="el" href="class_i_attr_report.html">IAttrReport</a>). This is a lightweight, nonpersistent set of boss objects, each of which describes one text property; for example, the color or point size of text. Attributes are interpreted by the text-composition subsystem, to define how the text appears when composed.<p>Attributes target either arbitrary ranges of characters (like the color or point size of a set of characters) or a paragraph (like applying a drop cap or setting paragraph alignment).<p>Attributes are managed in an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list, a persistent container class. Consider an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list to be a hash table of attributes, the key being the ClassID. One implication of this is there can be only one instance of any particular attribute within an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list (for example, no conflicting text-color attribute within an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a>).<p>Attributes can be applied directly (within an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list) to the appropriate paragraph or character-attribute strand, or they can be applied to a text style. An example of applying the attribute directly to the strand would be italicizing text directly using the text editor. Such changes are local to the text being formatted and known as local overrides to the current style.<p>An attribute boss class that supports the <a class="el" href="class_i_attr_import_export.html">IAttrImportExport</a> interface can participate in the import and export of InDesign tagged text files.<p><b>Default attributes</b><p>The application provides a set of default attributes. These attributes are maintained within an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> on both the session and document workspace. Default attributes define a set of overrides that are applied to any new stories created. These <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> lists reflect the state of the Character and Paragraph panels when no documents are open (session workspace) or new stories are created (document workspace). When a new document is created, the document workspace inherits the value of the default attributes from the session. The default attributes can be updated directly through the Paragraph and Character panels or by selecting styles in the styles panels; the defaults are updated to match the style.<p><b>Text styles</b><p>A text style (signature interface <a class="el" href="class_i_style_info.html">IStyleInfo</a>) provides a mechanism to name and persist a particular set of text attributes with particular values. The application supports two kinds of styles for text, paragraph styles and character styles. Each style has an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list that maintains the set of attributes that apply to that style. Access to the attributes in a style is achieved through the <a class="el" href="class_i_text_attributes.html">ITextAttributes</a> wrapper interface. Character styles are associated with character attributes; however, paragraph styles can be associated with both paragraph and character attributes. Paragraph styles are applied to whole paragraphs; character styles can be applied to arbitrary ranges of text.<p>All text must be associated with both a paragraph style and character style. To support this, the application defines two default styles: the root character style and the root paragraph style (known in the application user interface as [No Paragraph Style]). The root paragraph style contains a complete set of paragraph-based and character-based attributes. This defines the default look of text with no further formatting applied. The root character style is empty; it exists purely to provide a root for character styles.<p>Styles form a hierarchy rooted at the root style. Each style (except the root style) is based on another style, which becomes its parent. The <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list for a particular style records only the differences from the style on which it is based; that is, the set of attributes that the particular style overrides. This is shown in the following figure. In the figure, the <a class="el" href="classk_style_boss.html">kStyleBoss</a> for the root paragraph style defines all attributes with a default value. The <a class="el" href="classk_style_boss.html">kStyleBoss</a> for the new style (Yellow Text) contains only the attributes that differ from the root style. The root character style contains no attributes; it exists to provide a root to the character-style hierarchy.<div class="image"><img alt="plugin-programming-guide-vol1-119.gif" src="plugin-programming-guide-vol1-119.gif" /></div><p>The application provides two basic styles, one for character attributes and one for paragraph attributes. These are the default styles applied to new stories (assuming no other style is selected in a styles panel). The basic styles cannot be deleted, but you can modify them with plug-ins. Initially, the basic styles are based on the root styles; however, a style&#39;s parent can be replaced with a different style.<p>Users can create, edit, and delete folders, called Groups, in the Character, Paragraph, and Object Styles palettes. A style group is a collection of styles or groups. The user also can nest groups inside groups and drag styles within the palette to edit the contents of a group. Styles do not need to be inside a group and can exist at the root level of the palette. The group concept also is available in the object style palette.<p>Character and paragraph styles are not required to have unique names across groups; however, sibling styles and groups-those at the same level in the hierarchy with the same parent-must have unique names. Style names are case-sensitive, so the user could have both &quot;heading&quot; and &quot;Heading&quot; in the same folder. A group and a style cannot have the same name. Because style names are not unique, they are displayed in the user interface as full paths.<p>The alphabetical sort is an action applied to the entire list of styles. Users can rearrange the styles and groups arbitrarily at any time; to view the list alphabetically, they can resort the list with the Sort By Name command. Styles are intermixed with groups for sorting. Sorting is undo-able. The sorting is language specific, based on the user-interface language. Reserved styles such as [Basic Paragraph] or [Basic Graphics Frame] are not reordered by this command.<p>Styles are accessible through the style group manager (signature interface <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a>) on the document (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) and session (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) workspace boss classes. When a document is created, its style group manager inherits the existing set of styles from the session workspace. There are multiple style group managers supported by the workspaces, each identified by a distinct interface identifier; for example, IID_IPARASTYLEGROUPMANAGER and IID_ICHARSTYLEGROUPMANAGER. <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> has one automatically created object of type <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> called &quot;Root Hierarchy,&quot; represented by the <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a>. <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> provides access to <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a> through its GetRootHierarchy() method.<p>This Root Hierarchy is created on the first call to the GetRootHierarchy method. The <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a> holds all the styles (<a class="el" href="classk_style_boss.html">kStyleBoss</a>) and style groups (<a class="el" href="classk_style_group_boss.html">kStyleGroupBoss</a>) at root level. The key interface on the <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a> is <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a>, which stores the persistent UID-based style tree hierarchy so you can query information like parent/child node information. All children of this root hierarchy must support the <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> interface; therefore, <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> also is aggregated on the <a class="el" href="classk_style_boss.html">kStyleBoss</a> and <a class="el" href="classk_style_group_boss.html">kStyleGroupBoss</a>, so access to the style hierarchy also is available if you have access to the UID of any style or style group in the hierarchy. With <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a>, you gain access to the style-tree hierarchy the user sees in the style panel. <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> has a method to traverse the style hierarchy, which should be used to iterate through all styles. <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> also provides two overloaded FindByName() methods that return the UID of a style or style group.<p>The following figure shows how to navigate the styles, given a particular workspace. The style group manager (<a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> on document and session workspaces) provides access to all paragraph and character styles (<a class="el" href="classk_style_boss.html">kStyleBoss</a>) through the GetRootHierarchy() method, which returns an <a class="el" href="class_i_style_group_hierarchy.html">IStyleGroupHierarchy</a> on the <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a>. <a class="el" href="classk_style_group_hierarchy_boss.html">kStyleGroupHierarchyBoss</a> holds all the styles (<a class="el" href="classk_style_boss.html">kStyleBoss</a>) and style groups (<a class="el" href="classk_style_group_boss.html">kStyleGroupBoss</a>) at root level. Styles can be iterated over using <a class="el" href="class_i_style_group_hierarchy.html#aa7ae9265ce9fc517d4069d98b8503ebb">IStyleGroupHierarchy::GetDescendents</a> or accessed by name using <a class="el" href="class_i_style_group_manager.html#a696274def7651f69ef263c8988a90130">IStyleGroupManager::FindByName</a>. Given a particular style, the style it is based on can be accessed using <a class="el" href="class_i_style_info.html#a95d080fea0ae34012b6ba34103c56d06">IStyleInfo::GetBasedOn</a>.<div class="image"><img alt="plugin-programming-guide-vol1-120.gif" src="plugin-programming-guide-vol1-120.gif" /></div><p>Sorting the style hierarchy is done through the <a class="el" href="class_i_style_group_hierarchy.html#aa41e7cc3e4b1fce6ac50c680d359ca71">IStyleGroupHierarchy::Sort()</a> method, when it is invoked, it sorts its children and calls its children&#39;s Sort method. The call to Sort() on the root hierarchy recursively sorts all styles. This methods takes a flag to indicate whether to sort in descending/ascending order, all child or immediate child, etc.<p><b>Text formatting and stories</b><p>All text has an associated character- and paragraph-attribute style. This style is either the root style (which defines a default value for the complete set of attributes used in composition) or a style that records differences from the root style. Styles form a hierarchy in which the values of attributes in child nodes override those in parent nodes. As well as having the character and paragraph styles defined on the attribute strands, local overrides can be applied. This occurs when a formatting change is made without modifying a style; for example, selecting a word and making it bold.<p>Attributes describe one of the text &#39;s appearance and are used by the composition engine when rendering the associated glyphs. <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> (on the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) provides APIs that allow the value of any attribute to be deduced for any TextIndex. The following figure shows an example of how styles and local attribute overrides combine to describe the exact look of text. The paragraph-attribute strand specifies the text will use the custom style pStyle and two local overrides. The overrides specify the body and last line of the paragraph are to be centered. The character-attribute strand specifies the root style for the word &quot;Aliens,&quot; a local +bold override for the word &quot;and,&quot; and the word &quot;Earth&quot; to use the custom style cStyle.<div class="image"><img alt="plugin-programming-guide-vol1-121.gif" src="plugin-programming-guide-vol1-121.gif" /></div><h3><a class="anchor" id="id_class_associations"></a> Class associations</h3><p>The following figure shows the major classes and associations for text content.<div class="image"><img alt="plugin-programming-guide-vol1-122.gif" src="plugin-programming-guide-vol1-122.gif" /></div><h2><a class="anchor" id="id_text_presentation"></a> Text presentation</h2><p>This section describes the presentation model responsible for managing the final look of text. The layout factors (such as the types of containers with which text can be associated) are described before the representation of the rendered text (the wax) is presented.<p>The text-presentation model represents both the information required to place a set of glyphs on a spread and the management of those glyphs within the application. This includes both the text layout and the wax components. Text layout is concerned with the containers for text and the attributes of a container that can affect how text is placed in respect to that container. The wax models the actual glyphs rendered into the layout.<h3><a class="anchor" id="id_text_layout"></a> Text layout</h3><p>Text layout defines the shape and form of the visual containers in which text is composed and displayed. The textual content is maintained in the text model of the story associated with the layout. This content is divided into one or more story threads, each representing an independent flow of text. See Story threads.<p>In text composition, text flows from the story thread into its associated visual containers to create wax that fits the layout. Text layout, in turn, displays the wax. When the layout is updated, text is recomposed to reflect the change.<h3><a class="anchor" id="id_text_frame"></a> Text frame</h3><p>The text frame is the fundamental container used to place and display text. Text frames have properties, like the number of columns, column width, gutter width, and text inset, that control where text flows. A text frame is represented by several associated boss classes.<p>The following figure shows a text frame containing two columns, with one line of text displayed in each column. The figure after it shows how this instance of a text frame is represented internally. <div class="image"><img alt="plugin-programming-guide-vol1-123.gif" src="plugin-programming-guide-vol1-123.gif" /></div><div class="image"><img alt="instance-text-frame-1-1.gif" src="instance-text-frame-1-1.gif" /></div><p>As shown in the following figure, a text frame consists of a graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) containing one multicolumn item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). The multicolumn item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>) is the controller for the text frame and contains one or more frame items (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>). The <a class="el" href="class_i_text_column_sizer.html">ITextColumnSizer</a> interface stores the major properties of the text frame, such as the number of columns. <a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a> provides access to the associated story, frame list, and the range of text displayed.<div class="image"><img alt="plugin-programming-guide-vol1-124.gif" src="plugin-programming-guide-vol1-124.gif" /></div><p>The relationship between the graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) and its content is maintained by the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. Use <a class="el" href="class_i_hierarchy.html#af345ca29851669d1e0917f52e6660032">IHierarchy::QueryChild</a> to navigate from the graphic frame to its associated multicolumn item, then onto individual columns. Conversely, use <a class="el" href="class_i_hierarchy.html#ae2521e931f5d4f3b7bba6260f2e883f0">IHierarchy::QueryParent</a> to navigate up from a column to the multicolumn item and on up to the graphic frame.<p>The following figure shows a text frame with more frame items than columns<div class="image"><img alt="plugin-programming-guide-vol1-125.gif" src="plugin-programming-guide-vol1-125.gif" /></div><p>The number of columns is not always equal to the number of frame items (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>). When a paragraph has Span Columns or Split Column style, the number of frame items is greater than the number of columns. For example, the text frame shown in Figure 13 has two columns and two frame items. If paragraph 3 is set to use Split Column style, and paragraph 4 to use Span Columns style, as shown in Figure16, there are now six frame items within the two columns in the text frame. You can use <a class="el" href="class_i_hierarchy.html#a83650a15e9dc70f876592f75f5f73282">IHierarchy::GetChildCount</a> or <a class="el" href="class_i_parcel_container.html#a3fd9f30a50fd109326ea6eb3d14e38db">IParcelContainer::GetParcelCount</a> to get the number of frame items.<h3><a class="anchor" id="id_frame_list"></a> Frame list</h3><p>A story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) associates the text frames that display its content through the frame list (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>). Conversely, a text frame associates the story whose text it displays through the frame list. The following figures show the story and frame list objects for the example introduced in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_frame">Text frame</a>. <div class="image"><img alt="plugin-programming-guide-vol1-126.gif" src="plugin-programming-guide-vol1-126.gif" /></div><div class="image"><img alt="instance-text-frame-1-2.gif" src="instance-text-frame-1-2.gif" /></div><p>The following figure shows the general structure of the frame list (<a class="el" href="class_i_frame_list.html">IFrameList</a>) for a story.<div class="image"><img alt="plugin-programming-guide-vol1-127.gif" src="plugin-programming-guide-vol1-127.gif" /></div><h3><a class="anchor" id="id_threading_and_text_frames"></a> Threading and text frames</h3><p>The text in a frame can be independent of other frames, or it can flow between threaded frames. Threading of text is the process of connecting the flow of text between frames. Do not confuse threading text between frames with text-story threads. The connections can be visualized by selecting a text frame and choosing View &gt; Extras &gt; Show Text Threads, as shown in the threaded text frames figure on page page 302. Threaded frames share a common underlying story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) and can be on the same spread or different spreads in the same document.<p>The following figure shows two unthreaded text frames.<div class="image"><img alt="plugin-programming-guide-vol1-128.gif" src="plugin-programming-guide-vol1-128.gif" /></div><p>Because each text frame is associated with a distinct story, editing the text in one of the frames does not affect the text in the other frame (see the following figure).<div class="image"><img alt="instance-text-frame-2-unlinked.gif" src="instance-text-frame-2-unlinked.gif" /></div><p>When the text frames that display a story cannot display all the text, the unseen text is called &quot;overset text.&quot; A red plus sign (+) on the outport of the two-column frame indicates the story has overset text.<p>If the user clicks the outport of the two-column frame with the Selection tool and then clicks the inport of the one-column frame, the frames become threaded. In the following figure, the text from the two-column frame that was overset now flows through the one-column frame. During this process, the text from the story underlying the one-column frame is appended to the story underlying the two-column frame. The frame list (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>) and story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) underlying the one-column frame are deleted.<p>This figure shows threaded text frames:<div class="image"><img alt="plugin-programming-guide-vol1-129.gif" src="plugin-programming-guide-vol1-129.gif" /></div><p>Once threaded, the two frames share the same underlying story (see the following figure, an instance diagram of threaded text frames).<div class="image"><img alt="instance-text-frame-2-linked.gif" src="instance-text-frame-2-linked.gif" /></div><h3><a class="anchor" id="id_parcels"></a> Parcels</h3><p>A flow of text content within a story is a story thread, is represented by a boss class with an <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a> interface. A parcel is a visual container into which the text of a story thread is flowed for layout and display. A parcel is represented by a boss class with an <a class="el" href="class_i_parcel.html">IParcel</a> interface.<p>The text of a story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) can be composed into a list of parcels (<a class="el" href="class_i_parcel.html">IParcel</a>) in a parcel list (<a class="el" href="class_i_parcel_list.html">IParcelList</a>).<p>Examples of application-provided parcels are as follows:<ul><li>Text frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>)<li>Table cell parcel (<a class="el" href="classk_text_cell_parcel_boss.html">kTextCellParcelBoss</a>)<li>Footnote parcel (<a class="el" href="classk_footnote_parcel_boss.html">kFootnoteParcelBoss</a>)</ul><p>The following figure shows how text frames support story threads and parcels. The text in the primary story thread is displayed through parcels given by the parcel list on the frame list. These parcels are the frame items of the text frames that display the story.<p>This figure shows the structure of the parcel implementation for text frames:<div class="image"><img alt="plugin-programming-guide-vol1-130.gif" src="plugin-programming-guide-vol1-130.gif" /></div><p>The following figure shows how tables support story threads and parcels. The text for the story thread of a table cell (<a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>) is displayed through the parcels given by its parcel list. These parcels are text cell parcels (<a class="el" href="classk_text_cell_parcel_boss.html">kTextCellParcelBoss</a>). For more information, see Chapter 1,&quot;Tables.&quot;<p>This figure shows the structure of the parcel implementation for tables:<div class="image"><img alt="plugin-programming-guide-vol1-131.gif" src="plugin-programming-guide-vol1-131.gif" /></div><h3><a class="anchor" id="id_span"></a> Span</h3><p>Each object that displays text is associated with a story thread. After composition, the object stores into the text model both the index (TextIndex) of the first character that it displays and the total number of characters that it shows. This text range is the span. The span is available on several interfaces (see the following tables). Note:<p>The ranges returned from these APIs are accurate only if the text in the object is fully composed. Before relying on these methods, you must check whether there is damage (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_damage">Damage</a>) and whether the object needs to be recomposed.<p>This table lists the APIs that indicate the range of text displayed:<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_frame_list.html">IFrameList</a></td><td>Gives the range of text displayed by each frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>). </td></tr><tr><td><a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a></td><td>Gives the range of text displayed by the frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>). </td></tr><tr><td><a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a></td><td>Gives the range of text displayed by the multicolumn item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). </td></tr><tr><td><a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a></td><td>Gives the range of text displayed by a parcel. All objects that display composed text are a kind of parcel (<a class="el" href="class_i_parcel.html">IParcel</a>). </td></tr></table><p>This table lists the APIs that find the parcel or frame displaying a specific TextIndex.<table class="doxtable"><tr><th>API </th><th>Description </th></tr><tr><td><a class="el" href="class_i_frame_list.html#a83a3f2922d519daf48c8cd0ebd1cd63f">IFrameList::QueryFrameContaining</a></td><td>Use this method to find the frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) that displays the character at a specific index (TextIndex) in the text model. </td></tr><tr><td><a class="el" href="class_i_text_model.html#a4a24897e56c10c9d06e72f370c32f37a">ITextModel::QueryTextParcelList</a></td><td>Call this to find the text parcel list associated with a given TextIndex. After you have the <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>, use ITextParcelList::GetParcelContaining, then IParcelList::QueryParcel. All objects that display composed text are a kind of parcel (<a class="el" href="class_i_parcel.html">IParcel</a>). As a result, this approach finds parcels for text frames, table cells, or other new kinds of parcels. Note, however, that some text embedded in the text model may not be composed or displayed in a parcel. </td></tr><tr><td><a class="el" href="class_i_wax_iterator.html">IWaxIterator</a></td><td>After you know which text model (<a class="el" href="class_i_text_model.html">ITextModel</a>) and what range of text you want, use this class to get the wax data. </td></tr><tr><td><a class="el" href="class_text_iterator.html">TextIterator</a></td><td>After you know which text model (<a class="el" href="class_i_text_model.html">ITextModel</a>) and what range of text you want, use this class to get the character data. </td></tr></table><p>The following figure shows a story displayed in a two-column frame. The range of text displayed in both columns is available in the <a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a> interface on the multicolumn item (<a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>). The range of text available in each frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) is available in both <a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a> and <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>.<p>This figure shows finding the range of text displayed in a frame or parcel:<div class="image"><img alt="plugin-programming-guide-vol1-132.gif" src="plugin-programming-guide-vol1-132.gif" /></div><p>Conversely, you can discover the parcel (<a class="el" href="class_i_parcel.html">IParcel</a>) displaying the character at a specific index (TextIndex) in the text model. It is possible the TextIndex of interest is overset text that is not displayed. The kind of parcel returned depends on the kind of story thread (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) that owns the range of text in which the TextIndex lies.<p>For example, if the TextIndex lies in the primary story thread, it is in the range 0 to (<a class="el" href="class_i_text_model.html#af1103745d4336643788243a63610d32e">ITextModel::GetPrimaryStoryThreadSpan</a> - 1). The primary story thread is displayed by the text frames associated with the story. In this case, the frame item (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) that displays the desired TextIndex is determined. Alternately, the desired TextIndex can be in the range <a class="el" href="class_i_text_model.html#af1103745d4336643788243a63610d32e">ITextModel::GetPrimaryStoryThreadSpan</a> to (<a class="el" href="class_i_text_model.html#a180aa88077b36e3fea671b34508227bd">ITextModel::TotalLength</a> - 1). Text in this range is associated with a table or other feature that embeds text in stories, like notes, footnotes, or tracked changes. If the feature displays composed text, the parcel displaying a specific TextIndex can be determined.<h3><a class="anchor" id="id_text_frames_and_the_wax"></a> Text frames and the wax</h3><p>After text is composed, each line is represented by a wax line (<a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a>). The wax for a story is owned by the wax strand. A text frame is associated with its wax lines by the range of text displayed, which is obtained from <a class="el" href="class_i_text_frame_column.html">ITextFrameColumn</a> or <a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a>. The range of text displayed by the frame is maintained when text is recomposed. Wax lines are accessed using a wax iterator, <a class="el" href="class_i_wax_iterator.html">IWaxIterator</a>, which is a C++ helper class created by calling <a class="el" href="class_i_wax_strand.html#aaf6fe3d7553e9a059764e4a295c8f4d3">IWaxStrand::NewWaxIterator</a>.<p>Consider the wax for a text frame with two columns, each displaying one line of text. See the following figure. Here, the wax line (<a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a>) objects do not have UIDs. They are managed by the wax strand (<a class="el" href="class_i_wax_strand.html">IWaxStrand</a> on <a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>) that persists some wax data and regenerates the rest by recomposing the text when required.<p>This figure shows the structure of the wax for a text frame:<div class="image"><img alt="plugin-programming-guide-vol1-133.gif" src="plugin-programming-guide-vol1-133.gif" /></div><h3><a class="anchor" id="id_text-frame_options"></a> Text-frame options</h3><p>You manipulate text-frame options from the dialog box invoked by choosing Object &gt; Text Frame Options. Default text-frame options store the properties inherited when a new text frame is created. The text-frame options are stored in the <a class="el" href="class_i_text_options.html">ITextOptions</a> interface on the document workspace. A distinct set of defaults are maintained on the session workspace and are inherited. The following figures show the boss classes and interfaces involved.<p>This figure shows interfaces storing text-frame options on a text frame:<div class="image"><img alt="plugin-programming-guide-vol1-134.gif" src="plugin-programming-guide-vol1-134.gif" /></div><p>This figure shows interfaces storing default text-frame options:<div class="image"><img alt="plugin-programming-guide-vol1-135.gif" src="plugin-programming-guide-vol1-135.gif" /></div><h3><a class="anchor" id="id_text-frame_geometry"></a> Text-frame geometry</h3><p>In the following figure, the bounds of the page items that make up the text frame are tabulated in the inner coordinates of the spline. In the following table, the geometries of the multicolumn and column items are expressed in the coordinate space of their parent, the spline. Effectively, they share a common coordinate space.<p>This figure shows text-frame geometry:<div class="image"><img alt="plugin-programming-guide-vol1-136.gif" src="plugin-programming-guide-vol1-136.gif" /></div><table class="doxtable"><tr><th>Item </th><th>Left </th><th>Top </th><th>Right </th><th>Bottom </th></tr><tr><td><a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a> (left column) </td><td>-100.00 </td><td>-15.00 </td><td>-5.00 </td><td>15.00 </td></tr><tr><td><a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a> (right column) </td><td>5.00 </td><td>-15.00 </td><td>100.00 </td><td>15.00 </td></tr><tr><td><a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a></td><td>-100.00 </td><td>-15.00 </td><td>100.00 </td><td>15.00 </td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td>-100.00 </td><td>-15.00 </td><td>100.00 </td><td>15.00 </td></tr></table><h3><a class="anchor" id="id_text_inset"></a> Text Inset</h3><p>Text inset, a property of a text frame, is an area between the edge of the frame and the area where text flows. If the text frame is regular in shape, you can specify the inset independently for each side (see the following figure).<div class="image"><img alt="plugin-programming-guide-vol1-137.gif" src="plugin-programming-guide-vol1-137.gif" /></div><p>With irregularly shaped frames, the inset follows the contour of the text frame, and there is only one inset value (see the following figure).<div class="image"><img alt="plugin-programming-guide-vol1-138.gif" src="plugin-programming-guide-vol1-138.gif" /></div><p>The following figure shows the structure of a text inset. The properties of the text inset are found in the <a class="el" href="class_i_text_inset.html">ITextInset</a> interface on the text frame&#39;s <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>. Even when there is no text inset in effect (all insets have a value of 0 points), a <a class="el" href="classk_text_inset_page_item_boss.html">kTextInsetPageItemBoss</a> is associated with the text frame and describes the contour of the text inset.<div class="image"><img alt="plugin-programming-guide-vol1-139.gif" src="plugin-programming-guide-vol1-139.gif" /></div><h3><a class="anchor" id="id_text_wrap"></a> Text wrap</h3><p>Text in a text frame is affected by other page items that have text wrap applied. Text wrap is represented by a standoff abstraction. A standoff describes whether there should be text wrap and, if so, the contour around which the text should be wrapped.<p>The following figure shows an empty graphic frame with text wrap set at a 4-point offset around the frame&#39;s path. The figure after it shows that if there is no intersection between the boundary of the standoff and the boundary of the text frame, then the text in the text frame is not affected. <div class="image"><img alt="plugin-programming-guide-vol1-140.gif" src="plugin-programming-guide-vol1-140.gif" /></div><div class="image"><img alt="plugin-programming-guide-vol1-141.gif" src="plugin-programming-guide-vol1-141.gif" /></div><p>The following figure shows what happens when the empty graphic frame overlaps the text frame. The text within that frame is forced to wrap around the empty frame, which is said to repel the text. By inverting the text wrap, a page item can indicate it is to be used to attract text within its boundary rather than repel it.<div class="image"><img alt="plugin-programming-guide-vol1-142.gif" src="plugin-programming-guide-vol1-142.gif" /></div><p>This figure shows how this causes text to flow within the set boundaries.<div class="image"><img alt="plugin-programming-guide-vol1-143.gif" src="plugin-programming-guide-vol1-143.gif" /></div><p>The objects representing the text wrap for the sample are shown in the following figure.<div class="image"><img alt="instance-text-wrap-1-1.gif" src="instance-text-wrap-1-1.gif" /></div><p>The general structure of text wrap is shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-144.gif" src="plugin-programming-guide-vol1-144.gif" /></div><p>Properties of a standoff are found in <a class="el" href="class_i_stand_off_data.html">IStandOffData</a> on the page item with the standoff. Use IStandOffData::GetMode to obtain the kind of text wrap and IStandOffData::GetMargin to get the offsets. Each page item has distinct standoff applied, so the page item can be a graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), a group (<a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>), or another type.<p>When a text wrap is applied, a standoff boss class <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a> is associated with the owning page item. The standoff boss class is not part of the page item instance hierarchy; you do not navigate to it using <a class="el" href="class_i_hierarchy.html">IHierarchy</a>. Instead, use IStandOffData::QueryStandOffGeometry to access the standoff boss class. The <a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a> boss class has a path geometry that represents the contour of the standoff, and text in a text frame wraps to this contour.<h3><a class="anchor" id="id_text_on_a_path"></a> Text on a path</h3><p>Text on a path allows text to flow along the contour of a spline (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>). Text on a path frame has an inport and an outport. As a result, you can thread text in other frames to and from it. The following figures show the objects involved in text on a path. <div class="image"><img alt="plugin-programming-guide-vol1-145.gif" src="plugin-programming-guide-vol1-145.gif" /></div><div class="image"><img alt="plugin-programming-guide-vol1-146.gif" src="plugin-programming-guide-vol1-146.gif" /></div><p>The following figure shows the structure of text on a path frame<div class="image"><img alt="plugin-programming-guide-vol1-147.gif" src="plugin-programming-guide-vol1-147.gif" /></div><p>Text on a path can be associated with any spline (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>). The structure of text on a path frame parallels that of a normal text frame. It is represented by three associated boss classes: <a class="el" href="classk_t_o_p_spline_item_boss.html">kTOPSplineItemBoss</a>, <a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>, and <a class="el" href="classk_t_o_p_frame_item_boss.html">kTOPFrameItemBoss</a>. You can navigate from a spline (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) to any associated text on a path (<a class="el" href="classk_t_o_p_spline_item_boss.html">kTOPSplineItemBoss</a>) using the <a class="el" href="class_i_main_item_t_o_p_data.html">IMainItemTOPData</a> interface. You can navigate back using the <a class="el" href="class_i_t_o_p_spline_data.html">ITOPSplineData</a> interface. After you have an interface on the <a class="el" href="classk_t_o_p_spline_item_boss.html">kTOPSplineItemBoss</a>, you can navigate up and down the text on a path frame using <a class="el" href="class_i_hierarchy.html">IHierarchy</a>.<p>The following figures show a text frame that also has text on a path running along its contour. In this example, the text displayed inside the frame and the text that runs its contour have distinct underlying stories. If they were threaded, they would be associated with the same story.<p>Text frame with text on a path:<div class="image"><img alt="plugin-programming-guide-vol1-148.gif" src="plugin-programming-guide-vol1-148.gif" /></div><p>Instance diagram for text frame with text on a path:<div class="image"><img alt="instance-text-on-path-2-1.gif" src="instance-text-on-path-2-1.gif" /></div><h3><a class="anchor" id="id_the_wax"></a> The wax</h3><p>The output of text composition is called the wax. The wax is responsible for drawing and hit testing the text of a story.<p>The term &quot;wax&quot; comes from the manual paste-up process conventionally used to create magazine and newspaper pages before the advent of interactive pagination software. In the old process, typeset columns of text (galleys) were received from the typesetter. The galleys were run through a waxer, cut into sections, and positioned on an art board. Wax was used as an adhesive to stick the sections on the art board.<p>The art board in InDesign is a spread, and you can think of the galleys as text frames. The typeset columns of text are the wax generated by text composition. The wax adheres-fixes-the position of a line of text within a frame.<h3><a class="anchor" id="id_wax_strand"></a> Wax strand</h3><p>The frame list (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>) manages the wax for a story by means of the wax strand (<a class="el" href="class_i_wax_strand.html">IWaxStrand</a> interface). The wax strand owns a collection of wax lines that contain wax runs, as shown in the following class diagram.<div class="image"><img alt="plugin-programming-guide-vol1-149.gif" src="plugin-programming-guide-vol1-149.gif" /></div><p>The wax is organized as a hierarchy of collections and leaf runs. The most common case is a series of wax lines, each with a collection of wax runs. A wax line is created for each line of text in a frame. A wax run is created each time the appearance of the text changes within the line. Examples of this include changes in point size, changes in font, and the interruption of the flow of text in a line because text wrap causes text to flow around another frame.<p>The <a class="el" href="class_i_wax_strand.html">IWaxStrand</a> interface on <a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a> owns all wax lines for a story and is the root of the wax tree. The <a class="el" href="class_i_wax_iterator.html">IWaxIterator</a> and <a class="el" href="class_i_wax_run_iterator.html">IWaxRunIterator</a> iterator classes provide access to wax lines and wax runs.<p><a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a> typically represents the wax for one line of text. (Warichuu is an exception to this, where the Warichuu set contains multiple lines; all lines in the Warichuu set relate to one <a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a> object.) Each line owns its wax runs, collections of wax runs, or combination of runs and collections of runs. <a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a> provides access to its children through the <a class="el" href="class_i_wax_collection.html">IWaxCollection</a> interface.<p>Any boss that supports the <a class="el" href="class_i_wax_collection.html">IWaxCollection</a> interface is a parent in the wax hierarchy to boss objects that support the <a class="el" href="class_i_wax_run.html">IWaxRun</a> interface. A boss can support both the <a class="el" href="class_i_wax_collection.html">IWaxCollection</a> and <a class="el" href="class_i_wax_run.html">IWaxRun</a> interfaces, creating levels in the hierarchy.<p><a class="el" href="classk_wax_text_run_boss.html">kWaxTextRunBoss</a> is the object that represents the wax for ordinary text. This object stores the information needed to render the glyphs and provides the interfaces that draw, hit test, and select the text.<p><a class="el" href="classk_wax_i_l_g_run_boss.html">kWaxILGRunBoss</a> represents the wax for inline frames. Inline frames allow frames to be embedded in the text flow. An inline frame behaves as if it were one character of text and moves along with the text flow when the text is recomposed. <a class="el" href="classk_wax_i_l_g_run_boss.html">kWaxILGRunBoss</a> provides the drawing, hit testing, and selection behavior for inline frames.<p>For a complete list of wax-run boss classes, refer to the API Reference for <a class="el" href="class_i_wax_run.html">IWaxRun</a>.<h3><a class="anchor" id="id_examples_of_the_wax"></a> Examples of the wax</h3><p>This section describes the wax generated for some sample text frames. To recreate these examples, use the Text tool to create the frames. If you use another tool, like the place gun or a graphic frame tool, the inner coordinate spaces for the frames will be different from those illustrated. For simplicity, use a sample page size 200 points wide and 100 points deep, and format text using 8-point type, the Times Regular font, and 10-point leading. All text is composed by the Adobe Paragraph Composer in a horizontal text frame.<p><b>Single line with no format changes</b><p>The wax generated for a single line of text with no format changes is shown in the following figure. This example has a frame 200 points wide and 30 points deep, containing one line of 8-point Times Regular text with 10-point leading. The first baseline offset setting for the frame is set to leading. This forces the baseline of the first line of text in the frame to be offset from the top of the frame by a distance equal to the leading value for the text (10 points).<p>Wax for single line with no format changes:<div class="image"><img alt="plugin-programming-guide-vol1-150.gif" src="plugin-programming-guide-vol1-150.gif" /></div><p>Each node in the wax tree records its position, its width, and a reference to the characters in the text model it describes. The origin records the index into the text model to the first character in the node. The span records the number of characters in the node.<p>Wax lines record their position in the inner coordinate space of the frame in which they are displayed. Wax runs record their position as an offset relative to the position of the wax line. Additional information is stored specific to the type of node-wax line or wax run.<p>The following figure exposes some additional data in the wax. A wax line stores the leading for the line. A wax run stores font name, a font-transformation matrix, glyph information, and other data necessary to describe how the text is to be drawn. A glyph is an element of a font.<div class="image"><img alt="plugin-programming-guide-vol1-151.gif" src="plugin-programming-guide-vol1-151.gif" /></div><p>When a character is composed, its character code is mapped to its corresponding GlyphID from the font being used to display the character. The font provides the initial width of a glyph at a particular point size. This width may be adjusted by composition to account for letter spacing, word spacing, and kerning. The GlyphID values and their widths after composition are stored in the wax run, as shown in the preceding figure.<p><b>Generation of wax runs</b><p>Wax runs are generated for each set of format changes or line breaks that occur in the rendered text. The following figure illustrates the effect of applying text attributes that change text format.<p>This shows the wax for single line with format changes:<div class="image"><img alt="plugin-programming-guide-vol1-152.gif" src="plugin-programming-guide-vol1-152.gif" /></div><p>This figure shows how a wax run is created each time the text attributes specify the appearance of the text is to change. The arrows show the correspondence between the text drawn in the frame and the wax run that describes its appearance and location. A distinct wax run would be required for the following:<ul><li>Each time the appearance of the text changes within the line.<li>Each line of text that appears in the parcel list for a story.<li>Each side of a line that is interrupted, either by using an irregular-shaped frame or by overlapping a page item with wrap turned on within the frame.</ul><h3><a class="anchor" id="id_text_adornments"></a> Text adornments</h3><p>Text adornments provide a way for plug-ins to adorn the wax (composed text). Text adornments give plug-ins the opportunity to do additional drawing when the wax in a frame is drawn. The wax draws the text and calls the text adornments it is aware of to draw. For this to occur, the adornment must be attached to the wax.<p>Text adornments are boss objects attached by ClassID to an individual wax run. When the run is drawn, text adornments are given control using the <a class="el" href="class_i_text_adornment.html">ITextAdornment</a> interface.<p>Calls to the <a class="el" href="class_i_text_adornment.html#aa8bbd32808d6920641af5f91cc11c7b8">ITextAdornment::Draw</a> method are ordered by the priority value returned by the <a class="el" href="class_i_text_adornment.html#a417f0a3e45c039937a49314d1b31079b">ITextAdornment::GetDrawPriority</a> method. Higher-priority adornments (smaller numbers) are called before lower-priority adornments (larger numbers).<p>Text adornments cannot influence how text is composed; for example, they cannot influence how characters are built into wax lines and wax runs by the text-composition subsystem. Instead, text adornments augment the appearance of the text. A text adornment controls whether the adornment is drawn in front of or behind the text.<p>There are two types of text adornments: local and global.<p><b>Local text adornments</b><p>A local text adornment is controlled by one or more text attributes. A local text adornment provides visual feedback of the text the text attributes control. For example, an adornment can highlight the background on which the text is drawn or strike out text by drawing a line in the foreground.<p>The text attribute controls the process by interacting with text composition and associating the adornment with a drawing style (see <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a> and <a class="el" href="classk_compose_style_boss.html">kComposeStyleBoss</a>). This causes the text composer to attach the adornment to a wax run (see <a class="el" href="class_i_wax_render_data.html">IWaxRenderData</a> in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_the_wax">The wax</a>).<p>The following table shows the main text adornments used by the application and the text attributes that control them.<table class="doxtable"><tr><th>Adornment classID </th><th>Attribute classID </th><th>Description </th></tr><tr><td><a class="el" href="classk_text_adornment_index_mark_boss.html">kTextAdornmentIndexMarkBoss</a></td><td><a class="el" href="classk_t_a_index_mark_boss.html">kTAIndexMarkBoss</a></td><td>Index mark </td></tr><tr><td><a class="el" href="classk_text_adornment_kenten_boss.html">kTextAdornmentKentenBoss</a></td><td><a class="el" href="classk_t_a_kenten_size_boss.html">kTAKentenSizeBoss</a>, etc. </td><td>Adorns text for emphasis </td></tr><tr><td><a class="el" href="classk_text_adornment_ruby_boss.html">kTextAdornmentRubyBoss</a></td><td><a class="el" href="classk_t_a_ruby_point_size_boss.html">kTARubyPointSizeBoss</a>, etc. </td><td>Annotates base text </td></tr><tr><td><a class="el" href="classk_text_adornment_strikethru_boss.html">kTextAdornmentStrikethruBoss</a></td><td><a class="el" href="classk_text_attr_strikethru_boss.html">kTextAttrStrikethruBoss</a></td><td>Strikes through text </td></tr><tr><td><a class="el" href="classk_text_adornment_underline_boss.html">kTextAdornmentUnderlineBoss</a></td><td><a class="el" href="classk_text_attr_underline_boss.html">kTextAttrUnderlineBoss</a></td><td>Underlines text </td></tr><tr><td><a class="el" href="classk_text_hyperlink_adornment_boss.html">kTextHyperlinkAdornmentBoss</a></td><td><a class="el" href="classk_hyperlink_attribute_boss.html">kHyperlinkAttributeBoss</a></td><td>Hyperlink mark </td></tr></table><p>To add a local text adornment, first add a new text attribute. In more complex situations, use multiple text attributes to control one text adornment. For example, <a class="el" href="classk_t_a_kenten_size_boss.html">kTAKentenSizeBoss</a>, <a class="el" href="classk_t_a_kenten_related_size_boss.html">kTAKentenRelatedSizeBoss</a>, <a class="el" href="classk_t_a_kenten_font_family_boss.html">kTAKentenFontFamilyBoss</a>, and <a class="el" href="classk_t_a_kenten_font_style_boss.html">kTAKentenFontStyleBoss</a> collectively control the kenten adornment implemented by the <a class="el" href="classk_text_adornment_kenten_boss.html">kTextAdornmentKentenBoss</a>.<p>Local text adornments are attached to a drawing style and subsequently to an individual wax run. These adornments always are called to draw, although they can choose not to draw anything.<p>The following figure shows the sequence of calls that result in an adornment being associated with a particular wax run.<div class="image"><img alt="plugin-programming-guide-vol1-153.gif" src="plugin-programming-guide-vol1-153.gif" /></div><p>The composition subsystem calls the <a class="el" href="class_i_attr_report.html#a49a27ee93a075408124ea7ee6961d7f3">IAttrReport::TellComposition</a> method of each attribute that applies to a particular range of text. This gives the attribute a chance to interact with the composition subsystem. This interaction includes the registering of adornments that are to be associated with the wax and called when the wax is drawn (<a class="el" href="class_i_drawing_style.html#a7493e294ee09a2f86b0737e9182a06b3">IDrawingStyle::AddTextAdornment</a>). The adornments are attached to the wax as ClassIDs (<a class="el" href="class_i_wax_run.html#a65645c482dc4435a69fb7a839bca8caf">IWaxRun::AddAdornment</a>); that is, the adornments are not instantiated at this point.<p>The following figure shows how adornments associated with a wax run are instantiated and called to draw.<div class="image"><img alt="plugin-programming-guide-vol1-154.gif" src="plugin-programming-guide-vol1-154.gif" /></div><p>The Draw signal propagates to the wax run (<a class="el" href="class_i_wax_run_text.html">IWaxRunText</a> on <a class="el" href="classk_wax_text_run_boss.html">kWaxTextRunBoss</a>). The wax run (<a class="el" href="class_i_wax_run.html">IWaxRun</a> on <a class="el" href="classk_wax_text_run_boss.html">kWaxTextRunBoss</a>) is interrogated for the set of adornments registered through composition, as shown in the figure on page page 321. Each adornment (<a class="el" href="class_i_text_adornment.html">ITextAdornment</a>) is created on whichever boss class it is represented on, and the Draw method is called.<p>It is possible to associate a data interface (<a class="el" href="class_i_text_adornment_data.html">ITextAdornmentData</a>) during registration (<a class="el" href="class_i_attr_report.html#a49a27ee93a075408124ea7ee6961d7f3">IAttrReport::TellComposition</a>). This interface allows control over whether the adornment is associated with wax runs.<p><b>Global text adornments</b><p>Global text adornments are attached to all wax runs, though they never have run-specific adornment data. Global text adornments provide the ability to draw something without requiring the text to be recomposed. Unlike local text adornments, global text adornments do not need to be attached to individual wax runs to draw; however, global text adornments are asked if they are active before they are called to draw.<p>For example, the Show Hidden Characters feature is implemented using a global text adornment, <a class="el" href="classk_text_adornment_show_invisibles_boss.html">kTextAdornmentShowInvisiblesBoss</a>. The adornment behaves as if it is attached to all runs, but is called only when the adornment requests draw.<p>The following table lists global text adornments.<table class="doxtable"><tr><th>Adornment boss </th><th>Description </th></tr><tr><td><a class="el" href="classk_text_adornment_h_j_keeps_v_boss.html">kTextAdornmentHJKeepsVBoss</a></td><td>Highlights keeps violations. </td></tr><tr><td><a class="el" href="classk_text_adornment_missing_font_boss.html">kTextAdornmentMissingFontBoss</a></td><td>Highlights missing fonts. </td></tr><tr><td><a class="el" href="classk_text_adornment_missing_glyphs_boss.html">kTextAdornmentMissingGlyphsBoss</a></td><td>Highlights missing glyphs. </td></tr><tr><td><a class="el" href="classk_dynamic_spell_check_adornment_boss.html">kDynamicSpellCheckAdornmentBoss</a></td><td>Squiggle line to mark spell checks. </td></tr><tr><td><a class="el" href="classk_text_adornment_show_invisibles_boss.html">kTextAdornmentShowInvisiblesBoss</a></td><td>Shows hidden characters. </td></tr><tr><td><a class="el" href="classk_position_marker_layout_adornment_boss.html">kPositionMarkerLayoutAdornmentBoss</a></td><td>Draws position marker. </td></tr><tr><td><a class="el" href="classk_text_adornment_show_kinsoku_boss.html">kTextAdornmentShowKinsokuBoss</a></td><td>Shows Japanese character line break. </td></tr><tr><td><a class="el" href="classk_text_adornment_show_custom_char_widths_boss.html">kTextAdornmentShowCustomCharWidthsBoss</a></td><td>Marks character width as a filled rectangle. </td></tr><tr><td><a class="el" href="classk_x_m_l_marker_adornment_boss.html">kXMLMarkerAdornmentBoss</a></td><td>XML marker. </td></tr></table><p>Global text adornments are service providers. The ServiceID is kGlobalTextAdornmentService. Global text adornments aggregate the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface and use the default implementation kGlobalTextAdornmentServiceImpl.<p>Global adornments have the opportunity to participate in drawing if they are enabled. The following figure shows the sequence of events that cause <a class="el" href="class_i_global_text_adornment.html#a4cc66befce5786f44e6dbf886dba7570">IGlobalTextAdornment::Draw</a> to be called. For brevity, the calls to the adornment to determine whether it is enabled (IGlobalTextAdorbment::GetIsActive) and to access the ink bounds of the adornment (<a class="el" href="class_i_global_text_adornment.html#ad21d6dcab1d7e685f8495baba9114db9">IGlobalTextAdornment::GetInkBounds</a>) are not shown.<div class="image"><img alt="plugin-programming-guide-vol1-155.gif" src="plugin-programming-guide-vol1-155.gif" /></div><p>When a frame (<a class="el" href="class_i_parcel_shape.html">IParcelShape</a> on <a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) is instructed to draw, it queries the service registry (<a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a> on <a class="el" href="classk_session_boss.html">kSessionBoss</a>) for the set of global text adornments that are enabled (<a class="el" href="class_i_global_text_adornment.html#acca1c8ebafc340963d92bf34a21d9ab6">IGlobalTextAdornment::GetIsActive</a>). The frame calls Draw on the parcel list (<a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a> on <a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>), which causes the wax line (<a class="el" href="class_i_wax_line_shape.html">IWaxLineShape</a> on <a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a>) and wax run (<a class="el" href="class_i_wax_run_text.html">IWaxRunText</a> on <a class="el" href="classk_wax_text_run_boss.html">kWaxTextRunBoss</a>) Draw methods to be called. During the drawing of the wax run, the global adornments built up previously (Draw from <a class="el" href="class_i_parcel_shape.html">IParcelShape</a> on <a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) have their Draw method called. Compare the preceding figure with the figure on page 322. The set of global adornments are global to the document (maintained by the service registry), whereas local adornments are local to a specific wax run.<h2><a class="anchor" id="id_text_composition"></a> Text composition</h2><p>This section describes the process of creating the final rendered text. It includes information for software developers who want to develop custom composition engines.<p>Text composition is the process of converting text content into its composed representation, the wax. The text-composition subsystem flows text content from a story thread maintained by a story into a layout represented by parcels in a parcel list. Story threads are described in Story threads on page 285; parcels and the wax, in &quot;Text presentation&quot;. The following figure is an overview of text composition.<div class="image"><img alt="plugin-programming-guide-vol1-156.gif" src="plugin-programming-guide-vol1-156.gif" /></div><p>The following figure shows a sample text frame with no format changes. The figure shows the objects representing the story, the frame, and the composed text; it does not show the details of how the text actually gets composed.<div class="image"><img alt="plugin-programming-guide-vol1-157.gif" src="plugin-programming-guide-vol1-157.gif" /></div><p>Text composition creates the wax lines (<a class="el" href="classk_wax_line_boss.html">kWaxLineBoss</a>) and their associated wax runs (<a class="el" href="classk_wax_text_run_boss.html">kWaxTextRunBoss</a>) using the primary story thread&#39;s content and layout as input.<p>Wax lines are added to the wax strand (<a class="el" href="class_i_wax_strand.html">IWaxStrand</a>). Text composition also maintains the range of characters displayed in each parcel/frame (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_span">Span</a>).<h3><a class="anchor" id="id_phases_of_text_composition"></a> Phases of text composition</h3><p>There are two distinct phases of text composition:<ul><li>Damage refers to changes that invalidate the wax for a range of composed text. Inserting text and modifying frame size are examples of changes that cause damage. This is described further in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_damage">Damage</a>.<li>Recomposition is the process that repairs the damage and updates the wax to reflect the change. This is described further in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_recomposition">Recomposition</a>.</ul><p>Text composition toggles the wax between the states shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-158.gif" src="plugin-programming-guide-vol1-158.gif" /></div><p>The flow of damage and recomposition is shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-159.gif" src="plugin-programming-guide-vol1-159.gif" /></div><p>This figure shows that a plug-in can update the text model or text layout, causing the wax (the composed representation of the text) to be damaged.<p>The text-composition subsystem exposes interfaces that mark the damaged story, frame parcels, and wax. The damage-recording flow is represented by dotted lines in the figure. The text-composition subsystem also exposes interfaces that allow text to be recomposed. In the figure, the recomposition flow is represented by solid lines.<p>Background composition (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_background_composition">Background composition</a>) is a separate process that drives text composition. Background composition runs as an idle task when the application has no higher-priority tasks.<p>Consider the example in which the plug-in shown in the figure is the text editor. In response to typing, the plug-in processes a command to insert the typed characters into the text model. This command calls text-composition interfaces that record the damage caused. Background composition detects the damage and recomposes the affected text.<h3><a class="anchor" id="id_damage"></a> Damage</h3><p>Damage refers to changes that invalidate the wax for a range of composed text. Damage is recorded by marking the affected stories, parcels, frames, and wax. The damage indicates where recomposition is required and the type of damage that has to be repaired.<p>The change counter on the frame list is incremented whenever something happens that causes damage. No notification is broadcast when the change counter is incremented, so the change cannot be caught immediately; however <a class="el" href="class_i_frame_list.html#a32591fe34dc730d42c864ffaafb82ae2">IFrameList::GetChangeCounter</a> returns a counter that is incremented each time any parcel in any frame in the frame list goes from undamaged to damaged, indicating some text in the frame list was damaged and must be recomposed.<p>Damage drives and optimizes the recomposition process. For example, recomposition can shuffle existing wax lines between frames to repair damage and avoid recomposing the text from scratch. Damage can be in the following categories:<ul><li>Insert damage occurs when text is inserted.<li>Delete damage occurs when a range of text is deleted.<li>Change damage occurs when a range of text is replaced or the text attributes that apply to a range of text are modified.<li>Resize damage occurs when a frame is resized.<li>Rect damage occurs when text wrap or text inset is applied.<li>Move damage occurs when a frame is moved.<li>Destroyed damage occurs when some combination of the preceding types of damage occurs. When this happens, the existing wax for the affected range must be recomposed.<li>Keeps damage occurs when a line must be pushed to the start of a new frame to eliminate orphans and widows. Orphans and widows are words or single lines of text that become separated from the other lines in a paragraph (see the following figure). An orphan occurs when the first line of a paragraph becomes separated from the rest of the paragraph body. A widow occurs when the last line of a paragraph becomes separated from the rest of the paragraph body.</ul><p>This figure shows an orphan (left) and a widow (right):<div class="image"><img alt="plugin-programming-guide-vol1-160.gif" src="plugin-programming-guide-vol1-160.gif" /></div><p>Check for damage before relying on the information stored in the wax or the frame spans (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_span">Span</a>). If your plug-in detects damage, it can either stop with a suitable error or recompose the text.<p><b>Damage API</b><p>To detect damage, use the interface methods shown in the following table.<table class="doxtable"><tr><th>Interface </th><th>Method </th></tr><tr><td><a class="el" href="class_i_story_list.html">IStoryList</a></td><td>CountDamagedStories, GetLastDamagedStory, GetNthDamagedTextModelUID </td></tr><tr><td><a class="el" href="class_i_frame_list.html">IFrameList</a></td><td>GetFirstDamagedFrameIndex </td></tr><tr><td><a class="el" href="class_i_wax_line.html">IWaxLine</a></td><td>IsContentDamaged, IsDamaged, IsDestroyed, IsGeometryDamaged, IsKeepsDamaged </td></tr><tr><td><a class="el" href="class_i_text_parcel_list_data.html">ITextParcelListData</a></td><td>GetFirstDamagedParcel, GetParcelIsDamaged </td></tr><tr><td><a class="el" href="class_i_text_parcel_list.html">ITextParcelList</a></td><td>GetFirstDamagedParcel, GetIsDamaged </td></tr></table><h3><a class="anchor" id="id_recomposition"></a> Recomposition</h3><p>Recomposition is the process of converting text from a sequence of characters and attributes into the wax (fully formatted paragraphs ready for display). The components of recomposition are as follows:<ul><li>Interfaces that control text composition.<li>The wax strand that manages the wax for the story.<li>Paragraph composers that create the wax for a line or paragraph.</ul><p><b>Recomposition API</b><p>To request recomposition, use the interface methods shown in the following table.<table class="doxtable"><tr><th>Interface </th><th>Method </th><th>Description </th></tr><tr><td><a class="el" href="class_i_frame_list.html">IFrameList</a></td><td>QueryFrameContaining </td><td>Helper method that causes recomposition. </td></tr><tr><td><a class="el" href="class_i_frame_list_composer.html">IFrameListComposer</a></td><td>RecomposeUntil, RecomposeThruTextIndex </td><td>Controls recomposition of frames in the frame list (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>). The methods delegate to the parcel list composer (<a class="el" href="class_i_text_parcel_list_composer.html">ITextParcelListComposer</a>). </td></tr><tr><td><a class="el" href="class_i_text_parcel_list_composer.html">ITextParcelListComposer</a></td><td>RecomposeThru, RecomposeThruTextIndex </td><td>Controls recomposition of parcels in a parcel list. This interface drives the recomposition for the parcel list. </td></tr><tr><td><a class="el" href="class_i_global_recompose.html">IGlobalRecompose</a></td><td>RecomposeAllStories, SelectiveRecompose, ForceRecompositionToComplete </td><td>Provides methods that can be used to force all stories to recompose. This interface marks damage that forces recomposition to recompose the damaged element, even though they were not actually changed. </td></tr></table><p>The interfaces and methods in the following table are not normally called by third-party plug-ins but play a central role in the control of recomposition.<table class="doxtable"><tr><th>Interface </th><th>Method </th><th>See </th></tr><tr><td><a class="el" href="class_i_recomposed_frames.html">IRecomposedFrames</a></td><td>BroadcastRecompositionComplete </td><td><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_recomposition_notification">Recomposition notification</a></td></tr><tr><td><a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a></td><td>Recompose, RebuildLineToFit </td><td><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_paragraph_composers">Paragraph composers</a></td></tr></table><h3><a class="anchor" id="id_wax_strand"></a> Wax strand</h3><p>The wax strand (<a class="el" href="class_i_wax_strand.html">IWaxStrand</a>) manages the wax for a story and is responsible for updating the wax to reflect changes in the text model or text layout. The wax strand controls the existing wax and determines where a paragraph composer needs to be used to create new wax. The wax strand also manages the overall damage-recording process.<p>The lifecycle of the wax is as follows:<ol type="1"><li>The wax strand is informed that a range in the text model was changed. In response, the wax strand locates the wax lines that represent this range and marks them as damaged.<li>On the next recomposition pass, the wax strand finds the first damaged wax line in the story and asks a paragraph composer to recompose it.<li>The paragraph composer creates new wax lines and applies them to the wax strand (RecomposeHelper::ApplyComposedLine). RecomposeHelper is a helper class within <a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a>, so any existing wax lines that represent the same range in the text model are destroyed.<li>Repeat this process until there are no more damaged wax lines or the end of the frame is reached.</ol><h3><a class="anchor" id="id_paragraph_composers"></a> Paragraph composers</h3><p>A paragraph composer (<a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a>) takes no more than a paragraph of text and arranges it into lines to fit a layout. The paragraph composer creates the wax that represents the composed text. Plug-ins can introduce new paragraph composers. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_implementation_notes_for_paragraph_composers">Implementation notes for paragraph composers</a>.<p>The text-composition architecture is designed for paragraph-based composition. The most significant implication of this design is that any change to text or attributes causes at least one paragraph&#39;s composition information to be reevaluated. For example, inserting one character into a paragraph potentially can result in changes to any or all of the line breaks in the paragraph, including those preceding the inserted character.<h3><a class="anchor" id="id_shuffling"></a> Shuffling</h3><p>Avoiding recomposition of text and simply moving existing wax lines up or down is called shuffling. The performance improvement gained by shuffling is significant.<p>The wax strand can determine whether a wax line was damaged because of something that occurred around the wax line and not because the range of text it represents changed, in which case the wax strand knows that the result of recomposing the text is simply to move the wax line up or down. In this case, the content of the wax line after recomposition is identical to its content before recomposition.<p>For example, if you select and delete an entire paragraph of text, the next paragraph has not changed and does not need to be recomposed. By pulling the following paragraph up to the position occupied by the deleted paragraph, the wax strand avoids the cost of recomposition.<p>When shuffling, the wax strand implements some of the behaviors of a paragraph composer, such as dealing with the Space Before and Space After paragraph attributes.<h3><a class="anchor" id="id_iterative_composition"></a> Iterative composition</h3><p>In general, InDesign composes paragraphs relative to previous paragraphs so that text flows down and out of the layout geometry. After a paragraph is composed in a Parcel, it is never changed again unless its attributes or its geometry changes. But text composition cannot arrange wax lines well in one pass for some features, such as balance columns, vertical justification, and span columns. The composition for such features requires first making a valid composition outcome without any adjustments and then iteratively recomposing, changing some aspect of the geometry each time to achieve the desired balanced outcome. This is called iterative composition.<p><b>Vertical justification</b><p>The text frame justifies wax lines within it from the top, center, or bottom, or to fill the available area, according to the setting for vertical justification. Shuffling can be performed for vertical justification if the text container is rectangular. But for nonrectangular text frames, iterative composition is used because the container is not equal in width everywhere. <a class="el" href="class_i_text_frame_options_data.html">ITextFrameOptionsData</a> provides access to the vertical justification attribute.<p><b>Balanced columns</b><p>Column balancing is performed in a paragraph if the Balance Columns option of the text frame is turned on or if the Paragraph Layout attribute of the paragraph below it is set to Span Columns.<p>This action requires iterative composition to first determine the length of the wax lines and then to adjust and recompose. <a class="el" href="class_i_text_frame_options_data.html">ITextFrameOptionsData</a> provides access to the Balance Columns attribute.<p><b>Span columns</b><p>Within a multicolumn text frame, a paragraph with the Span Columns option stretches across multiple columns; this is called straddling or spanning. This style requires that text must be balanced in the columns preceding the spanning paragraph to determine the vertical position in those columns where the straddle must begin. InDesign dynamically establishes the Parcels to hold the spanning text in the <a class="el" href="class_i_multi_column_text_frame.html">IMultiColumnTextFrame</a>. <a class="el" href="class_i_composition_style.html">ICompositionStyle</a> provides access to attributes such as span columns.<h3><a class="anchor" id="id_background_composition"></a> Background composition</h3><p>Background composition looks for damage, then fixes it by calling for recomposition. Background composition runs in the background as an idle task (IID_ICOMPOSITIONTHREAD on <a class="el" href="classk_session_boss.html">kSessionBoss</a>) and recomposes text. Each time that InDesign calls background composition, it performs the following actions in priority order:<ol type="1"><li>Recomposes visible frames of damaged stories in the frontmost document.<li>Recomposes other damaged stories in the frontmost document.<li>Recomposes damaged stories in other open documents.</ol><p>The actions are performed until the time slice allocated for background text composition expires. Background composition requests recomposition by calling the RecomposeUntil method on <a class="el" href="class_i_frame_list_composer.html">IFrameListComposer</a>.<h3><a class="anchor" id="id_recomposition_transactional_model"></a> Recomposition transactional model</h3><p>Plug-ins use commands to update the input data that drives text composition (the text model and text layout). The commands cause damage to occur. Recomposition subsequently recomposes the text and generates the wax to reflect the changes. Recomposition does not execute within the scope of a command; instead, the wax strand begins and ends a database transaction around the recomposition process. This means that recomposition cannot directly be undone; however, the commands used to update the input data are undoable. Undo causes damage, and recomposition repairs it to ensure that the wax (the text displayed) reflects the state of the text model and text layout.<h3><a class="anchor" id="id_recomposition_notification"></a> Recomposition notification</h3><p>The <a class="el" href="class_i_recomposed_frames.html">IRecomposedFrames</a> interface on the frame list (<a class="el" href="classk_frame_list_boss.html">kFrameListBoss</a>) keeps track of which frames are recomposed, so text frame observers can be notified when recomposition completes. When InDesign calls the BroadcastRecompositionComplete method, each affected column (<a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a>) receives notification that it was recomposed. Observers attach to the <a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a> in which they are interested and then watch for the Update method to be called with theChange == kRecomposeBoss and protocol==IID_IFRAMECOMPOSER.<h3><a class="anchor" id="id_implementation_notes_for_paragraph_composers"></a> Implementation notes for paragraph composers</h3><p>This section provides more in-depth background for software developers developing a custom paragraph composer for the application.<p><b>Paragraph composers</b><p>A paragraph composer (<a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a>) takes up to a paragraph of text, arranges it into lines to fit a layout, and creates the wax that represents the text it composed. Plug-ins can introduce new paragraph composers.<p>The user selects the composer to be used for a paragraph from the menu on the Paragraph panel (see the following figure) or by using the Paragraph Styles palette. Selecting a paragraph composer sets the <a class="el" href="classk_text_attr_composer_boss.html">kTextAttrComposerBoss</a> paragraph attribute to indicate which paragraph composer to use.<div class="image"><img alt="plugin-programming-guide-vol1-161.gif" src="plugin-programming-guide-vol1-161.gif" /></div><p><b>Hyphenation and justification (HnJ)</b><p>The term &quot;hyphenation and justification&quot; (&acirc;&#128;&#152;HnJ&#39;) often is used in computer systems to refer to breaking of text into lines and spacing of text so it aligns with the margins. This term is not used in this application&#39;s API or documentation; however, the role performed by an HnJ system is similar to the role of a paragraph composer. Hyphenation is intimately associated with line breaking. In this application, the role is split out and implemented by a hyphenation service (<a class="el" href="class_i_hyphenation_service.html">IHyphenationService</a>). A paragraph composer that needs to hyphenate a word uses a hyphenation service.<p><b>A paragraph composer&#39;s environment</b><p>Paragraph composers are called by the text-composition subsystem. When text is to be recomposed, the wax strand examines the paragraph attribute <a class="el" href="classk_text_attr_composer_boss.html">kTextAttrComposerBoss</a> that specifies the paragraph composer to be used, locates it through the service registry, and calls the <a class="el" href="class_i_paragraph_composer.html#aa1bd1631f2b0696942d29a1280a49a87">IParagraphComposer::Recompose</a> method. This call gives the paragraph composer a context stored in the helper class in which to work. <div class="fragment"><div class="line"><span class="keyword">virtual</span> bool16 Recompose(RecomposeHelper* helper)</div></div><p>The RecomposeHelper class is a wrapper of the story being recomposed. It stores information like the story &#39;s compose scanner, tiler, starting index, text span, and position. The RecomposeHelper class definition is in <a class="el" href="_i_paragraph_composer_8h_source.html">IParagraphComposer.h</a>.<p>The following figure shows an example of a paragraph composer called to compose text.<div class="image"><img alt="plugin-programming-guide-vol1-162.gif" src="plugin-programming-guide-vol1-162.gif" /></div><p>The following steps occur:<ol type="1"><li>The paragraph composer composes the text and creates at least one wax line in the helper.<li>The paragraph composer accesses the character-code and text-attribute data for the story, using the <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> interface acquired from helper-&gt;GetComposeScanner.<li>The paragraph composer determines the areas in a line where glyphs can flow, using <a class="el" href="class_i_paragraph_composer_1_1_tiler.html">IParagraphComposer::Tiler</a>.<li>The wax lines are applied to the <a class="el" href="class_i_wax_strand.html">IWaxStrand</a> interface by calling helper-&gt;ApplyComposedLine.</ol><dl class="section note"><dt>Note<dd>Both yPosition and tiles are specified in the inner bounds (coordinate system) in RecomposeHelper.</dl><p><b>The scanner and drawing style</b><p>The scanner (<a class="el" href="class_i_compose_scanner.html">IComposeScanner</a>) provides access to both character and formatting (text attributes) information from the text model, as shown in the following figure. The drawing style (interface <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>) represents the effective value of text attributes at a given index in the text model. The drawing style cached by interfaces on <a class="el" href="classk_compose_style_boss.html">kComposeStyleBoss</a> considerably simplifies accessing text-attribute values. These interfaces remove the need to resolve text-attribute values from their representation in the text model and the text styles it references. A drawing style applies to at least one character. The range of characters it applies to is a run. For more information on styles and overrides, see <a class="el" href="id_solutions.html#id_text_formatting">Text formatting</a>.<div class="image"><img alt="plugin-programming-guide-vol1-163.gif" src="plugin-programming-guide-vol1-163.gif" /></div><p><b>Fonts and glyphs</b><p>Fonts contain the glyphs that display characters for a typeface at a particular size. Paragraph composers use the drawing style (<a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>) to find the font to be used. The font APIs provide the metrics required to compose the text into lines composed of a run of glyphs for each stylistic run of text.<p>A font represents a typeface with a given size and style. A typeface, like Times, is the letters, numbers, and symbols that make up a design of type. A glyph is a shape in a font that is used to represent a character code on screen or paper. The most common example of a glyph is a letter, but the symbols and shapes in a font like ITC Zapf Dingbats also are glyphs. For more information, see the following figure and <a class="el" href="id_solutions.html#id_fonts">Fonts</a>.<div class="image"><img alt="plugin-programming-guide-vol1-164.gif" src="plugin-programming-guide-vol1-164.gif" /></div><p><b>Tiles</b><p>Tiles (<a class="el" href="class_i_paragraph_composer_1_1_tiler.html">IParagraphComposer::Tiler</a>) represent the areas on a line into which text can flow. Normally, there is only one tile on a line; however, text wrap may cause intrusions that break up the places in the line where text can go. The tiler takes care of this, as well as accounting for the effect of irregularly shaped text containers.<p>Intrusions are the counterparts of tiles. Intrusions are not the inverse of tiles: they do not specify the areas in the line where text cannot be flowed. From the perspective of <a class="el" href="class_i_text_tiler.html">ITextTiler</a>, an intrusion is a horizontal band within a frame, in which text flow within the bounding box of the frame may be interrupted. Intrusions can be used to optimize recomposition. An intrusion is a flag that indicates that text cannot be flowed into the entire width of a line. Intrusions are caused by text wrap and nonrectangular frames.<p>The tiles returned for a line depend on the y position where they are requested, their depth, and their minimum width. The intrusions and tiles for some sample text frames are shown in the following figures.<p>Text frame with no intrusions:<div class="image"><img alt="plugin-programming-guide-vol1-165.gif" src="plugin-programming-guide-vol1-165.gif" /></div><p>Effect of image frame with text wrap:<div class="image"><img alt="plugin-programming-guide-vol1-166.gif" src="plugin-programming-guide-vol1-166.gif" /></div><p>Effect of two images with text wrap:<div class="image"><img alt="plugin-programming-guide-vol1-167.gif" src="plugin-programming-guide-vol1-167.gif" /></div><p>Effect of text inset:<div class="image"><img alt="plugin-programming-guide-vol1-168.gif" src="plugin-programming-guide-vol1-168.gif" /></div><p>Effect of nonrectangular frame:<div class="image"><img alt="plugin-programming-guide-vol1-169.gif" src="plugin-programming-guide-vol1-169.gif" /></div><p><b>First-baseline offset</b><p>The first-baseline offset setting controls the distance between the top of a parcel or frame and the baseline of the first line of text it displays. Some sample settings are shown in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-170.gif" src="plugin-programming-guide-vol1-170.gif" /></div><p><b>Control characters</b><p>A paragraph composer can apply an appropriate behavior to correctly implement the semantic intent of many control characters. For a complete list of control-character codes, see <a class="el" href="_text_char_8h_source.html">TextChar.h</a> in the API Reference.<p><b>Inline frames</b><p>Inline frames (<a class="el" href="classk_inline_boss.html">kInlineBoss</a>) allow frames to be embedded in the text flow. An inline frame behaves as if it were one text character and moves along with the text flow when the text is recomposed. The kTextChar_ObjectReplacementCharacter or kTextChar_Inline character is inserted into the text data strand to mark the position of the inline frame in the text. The inline frames are owned by the owned item strand (<a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>) in the text model. Paragraph composers obtain the geometry of the frame associated with the <a class="el" href="classk_inline_boss.html">kInlineBoss</a> by using <a class="el" href="class_i_text_model.html">ITextModel</a> to access this strand directly. Inline frames are represented in the wax by their own type of wax run, <a class="el" href="classk_wax_i_l_g_run_boss.html">kWaxILGRunBoss</a>.<p><b>Table frames</b><p>Table frames (<a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a>) are owned items anchored on a kTextChar_Table character embedded in the text flow. Paragraph composers can and do compose text displayed in table cells.; however, they never compose (create wax for) the character codes related to tables (kTextChar_Table and kTextChar_TableContinued). When a paragraph composer encounters either of these characters, it should create wax for any buffered text and return control to its caller.<p><b>Creating the wax</b><p>During the process of building lines, a paragraph composer normally uses an intermediate representation of the glyphs, so it can evaluate potential line-break points and adjust glyph widths. The specific arrangement used depends on the overall feature set of the paragraph composer and is beyond the scope of this document. Once the line-break decisions are made, the paragraph composer must create wax lines and runs.<p>For details of the mechanics of the creation of wax lines and runs, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_the_wax">The wax</a>. Once created by a call to RecomposeHelper::QueryNewWaxLine, new wax lines are added to the wax strand for a story with the following call: <div class="fragment"><div class="line">RecomposeHelper::ApplyComposedLine(<a class="code" href="class_i_wax_line.html">IWaxLine</a>* newLine, int32 newTextSpan)</div></div><p>The following figure shows an example of the wax generated by a paragraph composer.<p>Wax for a single line with format changes:<div class="image"><img alt="plugin-programming-guide-vol1-171.gif" src="plugin-programming-guide-vol1-171.gif" /></div><p><b>Adobe paragraph composers</b><p>Paragraph composers are implemented as service providers (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) and can be located using the service registry. The ServiceID used to identify paragraph composers is kTextEngineService.<p>The following figure shows the paragraph composers provided by the application under the Roman feature set.<div class="image"><img alt="plugin-programming-guide-vol1-172.gif" src="plugin-programming-guide-vol1-172.gif" /></div><p>The following figure shows the paragraph composers provided under the Japanese feature set.<div class="image"><img alt="plugin-programming-guide-vol1-173.gif" src="plugin-programming-guide-vol1-173.gif" /></div><p>The following figure shows the world-ready composers that provide Middle Eastern support under the Middle Eastern version of InDesign and InDesign Server. Roman paragraph composers<div class="image"><img alt="plugin-programming-guide-vol1-174.gif" src="plugin-programming-guide-vol1-174.gif" /></div><p><b>Key APIs</b><p><b>Class diagram</b><p>Paragraph composers are boss classes that implement <a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a>, the interface called by the application to compose text. To be recognized as a text composer, the boss class also must implement a text-engine service (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) with a ServiceID of kTextEngineService. The service also must provide a name (a translatable string) for the paragraph composer, which is displayed in the user interface. As output, composers generate wax lines (<a class="el" href="class_i_wax_line.html">IWaxLine</a>) and associated wax runs (<a class="el" href="class_i_wax_run.html">IWaxRun</a>) for up to one paragraph of text at a time. The following figure shows the class diagram of a custom paragraph composer.<div class="image"><img alt="plugin-programming-guide-vol1-175.gif" src="plugin-programming-guide-vol1-175.gif" /></div><p><b><a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a></b><p>There are two distinct phases to text composition, and <a class="el" href="class_i_paragraph_composer.html">IParagraphComposer</a> reflects these roles:<ul><li>Positioning the line and, if necessary, deciding where text in the line should break. This information is represented persistently in the wax line. Features that affect line-break decisions belong here. This is the role of the Recompose method.<li>Positioning glyphs that represent the characters in the line and, if necessary, adjusting their widths. This information is represented by a set of wax runs associated with the wax line. Wax runs are not persistent and must be rebuilt for display when a wax line is read from disk. Features that affect glyph position (paragraph alignment, justification, letter spacing, word spacing, and kerning) belong here. This is the role of the RebuildLineToFit method, which regenerates composed text data from the minimal data stored on disk.</ul><p>Recompose is called when text needs to be fully recomposed. Each time this method is called, it should compose at least one line and at most one paragraph of text into the passed-in helper. RecomposeHelper actually does all the work, by creating wax starting from the character in the story indicated by RecomposeHelper::GetStartingTextIndex. The top of the area text flows into is given by RecomposeHelper::GetStartingYPosition, and composition is done using the supplied scanner and tiler. The wax lines generated as a result are applied to the given wax strand.<dl class="section note"><dt>Note<dd>The paragraph composer is expected to create at least one wax line each time Recompose is called, even when overset text is what is being composed.</dl><p>RebuildLineToFit is called to regenerate the wax runs for a wax line from the minimal data stored on the disk. No line breaking or line positioning needs to be done here.<p><b><a class="el" href="class_i_compose_scanner.html">IComposeScanner</a></b><p><a class="el" href="class_i_compose_scanner.html">IComposeScanner</a> is an interface aggregated on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>. It provides methods that help access character and text-attribute information from the text model. It is the primary iterator for reading a story.<p>The following example shows QueryDataAt, which gets a chunk of data from the text model starting from a given TextIndex. QueryDataAt is a primary method text composition uses to iterate through the text model. QueryDataAt returns a <a class="el" href="class_text_iterator.html">TextIterator</a>, which has its own reference count on the chunk of data in the model, and thus makes the TextModel lifecycle independent of the compose scanner cache. Optionally, QueryDataAt returns the drawing style and number of characters in the returned iterator. We recommend you always ask for the returned number of characters. <div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_text_iterator.html">TextIterator</a> QueryDataAt(TextIndex position, <a class="code" href="class_i_drawing_style.html">IDrawingStyle</a>** newstyle, int32* numChars) = 0;</div></div><p>You also can acquire the drawing style by one of the methods listed in the following example. For more information on the methods in <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a>, refer to the API Reference.<p>Acquiring <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a> from <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a>: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_i_drawing_style.html">IDrawingStyle</a>* GetCompleteStyleAt (TextIndex position, int32* lenleft = nil) = 0;</div><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_i_drawing_style.html">IDrawingStyle</a>* GetParagraphStyleAt (TextIndex position, int32* lenleft = nil, TextIndex* paragraphStart = nil) = 0;</div></div><p>QueryAttributeAt allows callers to query the effective value of one or more particular text attributes at a given position. For more details, refer to the API Reference.<p><b><a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>, <a class="el" href="class_i_composition_style.html">ICompositionStyle</a>, <a class="el" href="class_i_hyphenation_style.html">IHyphenationStyle</a>, and <a class="el" href="class_i_justification_style.html">IJustificationStyle</a></b><p><a class="el" href="class_i_drawing_style.html">IDrawingStyle</a> provides access to text-attribute values like font, point size, and leading. If the text property you want is not in <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>, you will find it in one of the other style interfaces on <a class="el" href="classk_compose_style_boss.html">kComposeStyleBoss</a>.<p>For details, refer to the API Reference for <a class="el" href="classk_compose_style_boss.html">kComposeStyleBoss</a>, <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>, <a class="el" href="class_i_composition_style.html">ICompositionStyle</a>, <a class="el" href="class_i_hyphenation_style.html">IHyphenationStyle</a>, and <a class="el" href="class_i_justification_style.html">IJustificationStyle</a>.<p><b><a class="el" href="class_i_p_m_font.html">IPMFont</a> and <a class="el" href="class_i_font_instance.html">IFontInstance</a></b><p><a class="el" href="class_i_p_m_font.html">IPMFont</a> encapsulates the CoolType font API. It represents a typeface and can generate instances (<a class="el" href="class_i_font_instance.html">IFontInstance</a>) of it at various point sizes. <a class="el" href="class_i_p_m_font.html">IPMFont</a> is not based on <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>, but <a class="el" href="class_i_p_m_font.html">IPMFont</a> is reference counted and can be used with <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. For details, refer to the API Reference.<p><a class="el" href="class_i_font_instance.html">IFontInstance</a> encapsulates the CoolType font-instance API. <a class="el" href="class_i_font_instance.html">IFontInstance</a> represents an instance of a typeface at a given size. <a class="el" href="class_i_font_instance.html">IFontInstance</a> is not based on <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>, but <a class="el" href="class_i_font_instance.html">IFontInstance</a> is reference counted and can be used with <a class="el" href="class_interface_ptr.html">InterfacePtr</a>.<p><a class="el" href="class_i_font_instance.html">IFontInstance</a> controls the mapping from a character code (<a class="el" href="class_u_t_f32_text_char.html">UTF32TextChar</a>) into the identifier of its corresponding glyph (GlyphID). For details, refer to the API Reference.<p><b><a class="el" href="class_i_paragraph_composer_1_1_tiler.html">IParagraphComposer::Tiler</a></b><p><a class="el" href="class_i_paragraph_composer_1_1_tiler.html">IParagraphComposer::Tiler</a> manages the tiles for a parcel list and is used by paragraph composers to determine the areas on a line into which text can flow (see Tiles). It controls the content area bounds of each line.<p>The GetTiles method is used to get the tiles. If GetTiles cannot find large enough tiles in the current parcel that meet all the requirements, it returns kFalse and should be called again to see if the next parcel in the list can meet the request. If no parcel can meet the request, the tiler returns tiles into which overset text can flow.<p>GetTiles is a complex call to set up. To fully understand how to use it, refer to the API Reference and the text-composer samples (SingleLineComposer) provided in the SDK. The &quot;TOP&quot; abbreviation used in many of the parameter names is short for &quot;top of parcel,&quot; because when a line falls at the top of a parcel, special rules apply that govern its height (see &quot;First-baseline offset&quot;).<p>For Roman composers, a tile must be wide enough to receive one glyph plus any left and right line indents that are active. A heuristic often is used that approximates the minimum glyph width to be the same as the leading. The minimum tile height depends on the metric being used to compose the line. Normally this is leading, but the first line in a parcel is a special case in which the metric used may vary depending on the first-baseline offset (ascent, cap height, and leading) associated with the parcel. The pYOffset value indicates the top of the area for text to flow into. The pYOffset value actually is a position rather than an offset from the top of the parcel. The pYOffset value initially is the yPosition stored in RecomposeHelper when the <a class="el" href="class_i_paragraph_composer.html#aa1bd1631f2b0696942d29a1280a49a87">IParagraphComposer::Recompose</a> method is called. For more details, refer to the API Reference.<p><b>Scenarios</b><p>This section illustrates how text gets recomposed. The scenarios presented here demonstrate basic situations you may come across in developing a paragraph composer. To reduce complexity for these examples, assume the paragraph composer being called generates only one line for each call (a single-line composer).<p><b>Simple text composition</b><p>The following figure shows a simple composed text frame 200 points wide and 30 points deep, with its baseline grid shown. The text is 8-point Times Regular with 10-point leading, and the first-baseline offset for the frame is set to leading.<div class="image"><img alt="plugin-programming-guide-vol1-176.gif" src="plugin-programming-guide-vol1-176.gif" /></div><p>When text of the same appearance is flowed into the frame, the distance between the baselines of succeeding lines of text is set to the leading.<p>The wax strand examines the paragraph attribute that specifies which paragraph composer to use and locates it through the service registry. The paragraph composer is then asked to recompose the story from the beginning, causing text to flow into the frame starting from the top by calling IParagraphComposer::Recompose(helper).<p>The yPosition stored in the helper indicates the top of the area into which glyphs can flow. This is the baseline of the preceding line or the top of the parcel.<p>The composer examines the drawing style and its associated font and calculates the depth and width of the tiles it needs. The example uses 8-point text with 10-point leading and no line indents, so the minimum height and width is 10 points. The tiler is then requested for tiles of the required depth and minimum width at the given yPosition, and it returns the tile shown in the following figure.<p>Tiles for the first line:<div class="image"><img alt="plugin-programming-guide-vol1-177.gif" src="plugin-programming-guide-vol1-177.gif" /></div><p>The following sequence of actions then occurs:<ol type="1"><li>The paragraph composer scans the text using <a class="el" href="class_i_compose_scanner.html">IComposeScanner</a>. Text flows into the tile until the tile is full or an end-of-line character is encountered.<li>The composer chooses where the line is to be broken and creates a wax line for the range of text the line will display.<li>The wax line is applied to the <a class="el" href="class_i_wax_strand.html">IWaxStrand</a> and, as a side effect, the composer&#39;s <a class="el" href="class_i_paragraph_composer.html#ae6f84857e92bb62d84be9ce4287ac903">IParagraphComposer::RebuildLineToFit</a> method is called to generate wax runs for the line.<li>The <a class="el" href="class_i_paragraph_composer.html#aa1bd1631f2b0696942d29a1280a49a87">IParagraphComposer::Recompose</a> method is finished with its work and returns control to its caller.<li>The wax strand successively asks the paragraph composer to recompose the second and third lines with yPositions of -5 and 5, respectively, until the text is fully composed.</ol><p>The result is shown in the following figure. For more details, see the SDK sample code SingleLineComposer.<p>Tiles for the second and third lines:<div class="image"><img alt="plugin-programming-guide-vol1-178.gif" src="plugin-programming-guide-vol1-178.gif" /></div><p><b>Change in text height on line</b><p>As a line is composed, attributes that control the height of the line, like point size and leading, may change. The baseline of the text must be set to reflect the largest value of the metric, such as leading or ascent, that is being used to compose the text. To achieve this, the composer asks the tiler for tiles deep enough to take text of a given height. If an increase in text height is encountered as composition proceeds along a line, the tiler needs to be asked for deeper tiles to accommodate the text. It is the composer&#39;s responsibility to ensure the parcel can receive the deeper text.<p>For example, if the point size for the word &quot;Ask&quot; is changed to 16 points and its leading to 20 points, the text suffers change damage. The resulting sequence of recomposition is shown in the following figure.<p>Changing point size and leading of selected text:<div class="image"><img alt="plugin-programming-guide-vol1-179.gif" src="plugin-programming-guide-vol1-179.gif" /></div><p>Initially, the composer encounters 8-point text on 10-point leading, and it requests tiles of an appropriate depth. When the composer hits the style change to 16-point text and 20-point leading, it goes back to the tiler and gets a deeper tile. When the style changes back to the smaller point size, the composer already has a tile deep enough to take this text, so it fills the tile with glyphs and breaks the line. Note how the baseline is set to reflect the largest leading value encountered in the line.<p><b>Text wrap</b><p>Depending on the yPosition and depth of the tiles needed, the text-wrap settings on other page items or a change to the shape of the frame may become significant during recomposition. To illustrate this, in the following figure, a graphic with text wrap is added to the simple text-frame arrangement.<div class="image"><img alt="plugin-programming-guide-vol1-180.gif" src="plugin-programming-guide-vol1-180.gif" /></div><p>The preceding figure shows the text frame and the tiles the 8-point text flows into with 10-point leading. Note that the third line in the frame is affected by the text wrap and flows around the bounding box of the graphic.<p>The following sequence illustrates what happens when the point size for &quot;Ask&quot; is changed to 12 points and its leading is changed to 14 points. The initial case is shown in the following figure.<p>Changing the selection to 12-point text, 14-point leading: <div class="image"><img alt="plugin-programming-guide-vol1-181.gif" src="plugin-programming-guide-vol1-181.gif" /></div><p>The wax strand picks up the change damage and asks the paragraph composer to recompose the first line of the second paragraph. The baseline of the first line of text in the frame, -5 points, is at the yPosition stored in the RecomposeHelper.<p>The paragraph composer gets tiles deep enough to take the initial leading value (10 points) it encounters on the line, as shown in the following figure.<p>Composer begins to recompose:<div class="image"><img alt="plugin-programming-guide-vol1-182.gif" src="plugin-programming-guide-vol1-182.gif" /></div><p>The paragraph composer then encounters the run of text with the changed point size and leading. Because the text is deeper than the tiles the paragraph composer obtained, the composer goes back to the tiler and asks for a new set of tiles to receive the deeper text. This is shown in the following figure.<p>Composer asks for deeper tiles:<div class="image"><img alt="plugin-programming-guide-vol1-183.gif" src="plugin-programming-guide-vol1-183.gif" /></div><p>Because of the request for deeper tiles and the text-wrap setting on the graphic, the tiler returns the two tiles shown in the following figure, causing text to tightly wrap to the bounding box of the graphic.<div class="image"><img alt="plugin-programming-guide-vol1-184.gif" src="plugin-programming-guide-vol1-184.gif" /></div><p>The paragraph composer flows glyphs into the deeper tiles, generating a wax line with four wax runs: one for the tile to the left of the graphic and three in the tile to the right of the graphic. After this change, all text for the story cannot be displayed in the frame, so the story is overset, as shown in the following figure.<p>Fully recomposed frame:<div class="image"><img alt="plugin-programming-guide-vol1-185.gif" src="plugin-programming-guide-vol1-185.gif" /></div><p>It is important to note that the tiles returned by the tiler depend on the yPosition within the frame for which they are requested and the depth asked for by the caller.<p><b>Frame too narrow or not deep enough</b><p><a class="el" href="class_i_paragraph_composer.html#aa1bd1631f2b0696942d29a1280a49a87">IParagraphComposer::Recompose</a> must return a wax line each time it is called; however, it is possible that a frame is too narrow to accommodate text, when either the indent settings for a paragraph are large or the text has a large point size. The result is overset text. Call the tiler (<a class="el" href="class_i_paragraph_composer_1_1_tiler.html">IParagraphComposer::Tiler</a>&#39;s GetTiles()) repeatedly until it returns kTrue. The tiler iterates over all parcels; if none can accommodate the text, the tiler returns a tile into which overset text can flow.<h2><a class="anchor" id="id_fonts"></a> Fonts</h2><p>This section explains how fonts fit into the InDesign text architecture. Fonts provide the basic information required to render glyphs. A font is identified by a font name (for example, &quot;Minion Pro&quot;) and a face or style name (for example, &quot;Bold&quot; or &quot;Heavy&quot;). A rendered font also has a size; for example, this text is 11 points. A font of a specific point size is an instance of the font.<p>All rendered text in the application has an associated font.<p>Fonts have rights, which determine what can be done with a particular font. For example, a font can indicate that it should not be embedded in a PDF document or it should not be printed. The font subsystem provides access to these rights and implements the policies required to adhere to these rights.<h3><a class="anchor" id="id_available_fonts"></a> Available fonts</h3><p>Several factors affect which fonts are available within a document.<p><b>Font sources</b><p>Fonts become available for use in InDesign from the following managed locations monitored by CoolType:<ul><li>Fonts provided by the operating system.<li>The common Adobe fonts folder.<li>The application fonts folder.</ul><p>Fonts also can become available from the following document-specific location:<ul><li>The document-installed fonts folder.</ul><p>The font manager provides these fonts to the user while the document is being edited.<p><b>System-wide fonts</b><p>When InDesign starts, it loads the system-wide fonts from the locations defined by the operating system. These fonts are located:<ul><li>On Macintosh OS X, in /System/Library/Fonts (install and uninstall are prohibited) and /Library/Fonts (user installable).<li>On Windows, in WINDOWS\Fonts.</ul><p><b>Adobe fonts</b><p>In prior releases, Adobe installed its own fonts in a common location for use in Adobe applications. Although Adobe now installs its fonts into the user-modifiable system-wide font folders, InDesign still loads fonts from these locations when it starts:<ul><li>On Macintosh OS X, in /Library/Application Support/Adobe/Fonts.<li>On Windows, in Program Files\Common Files\Adobe\Fonts.</ul><p><b>Application fonts</b><p>In prior releases, when InDesign started, it loaded any fonts in the folder named &quot;Fonts&quot; located in the same folder as the InDesign executable binary. Use of this folder is deprecated and might not be supported in future releases; however, InDesign currently still loads these fonts when it starts.<p><b>Document-installed fonts</b><p>When a document is opened, InDesign loads up to 100 fonts from the folder named &quot;Document fonts&quot; within the same folder as the document. These document-installed fonts are associated with that specific document, are available only to that document, and become unavailable when the document is closed.<p><b>Changes to font folders</b><p>For document-installed fonts, InDesign installs an internal copy of the fonts; after that, the document-installed font folder becomes irrelevant while the document remains open. InDesign then manages these fonts internally and will not be aware of any changes to the content of that folder until the document is closed and reopened.<p>This is different from the other three managed font locations. In those locations, Adobe&#39;s internal libraries watch the managed folders and communicate changes to InDesign. InDesign then dynamically changes its list of available fonts.<p><b>Missing fonts</b><p>There are times when the font manager gets a request for a font that is not available; for example, the font was removed from the system or the document was produced on a system with a different set of available fonts. The font manager resolves this situation by replacing the font with one that is available. The font manager warns the user when such a replacement occurs.<p><b>Duplicate fonts</b><p>It is possible for the same font to occur in more than one of the locations to which InDesign and the document have access. Identical fonts are fonts whose PostScript names and technology (OpenType, Type1, and so on) are identical. If one of the duplicate fonts occurs in the document-installed fonts folder, InDesign uses that font. If the duplicates occur elsewhere, InDesign resolves the situation by choosing one of the fonts to make available.<h3><a class="anchor" id="id_font-subsystem_architecture"></a> Font-subsystem architecture</h3><p>Font management within InDesign relies on a core piece of Adobe technology, CoolType. CoolType wraps the operating-system font services to provide a cross-platform abstraction and provides further services to clients.<p>The application wraps the CoolType representation of fonts, font groups, and font instances with application-specific types. This is shown in the following figure.<p>Accessing CoolType fonts in the application:<div class="image"><img alt="plugin-programming-guide-vol1-186.gif" src="plugin-programming-guide-vol1-186.gif" /></div><p><b>Session font manager</b><p>The session font manager, <a class="el" href="class_i_font_mgr.html">IFontMgr</a> on <a class="el" href="classk_session_boss.html">kSessionBoss</a>, provides access to the CoolType font wrappers. <a class="el" href="class_i_p_m_font.html">IPMFont</a> is the representation of a font, <a class="el" href="class_i_font_group.html">IFontGroup</a> represents a group of fonts that are in the same font family, and <a class="el" href="class_i_font_instance.html">IFontInstance</a> represents a particular font at a particular point size.<p>The session font manager provides access to all fonts and font groups that are available to the application and to all open documents in the InDesign session. Each font group also allows you to access each font in the group. The <a class="el" href="class_i_font_mgr.html">IFontMgr</a> interface is aggregated on <a class="el" href="classk_session_boss.html">kSessionBoss</a>.<p><b>CoolType</b><p>CoolType is the core technology through which InDesign accesses fonts.<dl class="section note"><dt>Note<dd>CoolType font-abstraction technology is not related to Adobe&#39;s subpixel font-rendering technology with the same name.</dl><p>The API provides the <a class="el" href="class_i_font_group.html">IFontGroup</a>, <a class="el" href="class_i_p_m_font.html">IPMFont</a>, and <a class="el" href="class_i_font_instance.html">IFontInstance</a> interfaces as shells through which InDesign calls CoolType. These are not standard interfaces; that is, they do not derive from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. You cannot create them using CreateObject or query them for other interfaces; however, these interfaces are reference counted, and you can manage their lifetime using <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. See the following table and figure.<p>Interfaces that use CoolType:<table class="doxtable"><tr><th>Interface </th><th>Description </th><th>How to get the interface </th><th>Code snippet with example of use </th></tr><tr><td><a class="el" href="class_i_font_group.html">IFontGroup</a></td><td>Represents all font groups available to the application </td><td><a class="el" href="class_i_font_mgr.html#aedc19088ab95621a95d6b5d3d5ffd40a">IFontMgr::QueryFontGroup</a>, <a class="el" href="class_font_group_iterator_call_back.html">FontGroupIteratorCallBack</a></td><td><a class="el" href="class_snp_perform_font_group_iterator.html">SnpPerformFontGroupIterator</a></td></tr><tr><td><a class="el" href="class_i_p_m_font.html">IPMFont</a></td><td>Provides extensive data related to a particular font. <a class="el" href="class_i_p_m_font.html">IPMFont</a> provides font-name mapping calls and access to font metrics at a given point size. </td><td><a class="el" href="class_i_font_mgr.html#af81331b3adbdb7dce7f56cbf82d0ab43">IFontMgr::QueryFont</a>, <a class="el" href="class_i_font_mgr.html#a3fa3ba768670c4a239deb157556ae862">IFontMgr::QueryFontPlatform</a>, <a class="el" href="class_i_font_family.html">IFontFamily</a>, text attributes <a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a> and <a class="el" href="classk_text_attr_font_style_boss.html">kTextAttrFontStyleBoss</a>, <a class="el" href="class_i_story_service.html">IStoryService</a>, <a class="el" href="class_i_wax_render_data.html">IWaxRenderData</a></td><td><a class="el" href="class_snp_inspect_font_mgr.html">SnpInspectFontMgr</a></td></tr><tr><td><a class="el" href="class_i_font_instance.html">IFontInstance</a></td><td>Represents an instance of a font of a given point size. Of interest if you need to write a paragraph composer or map character codes to GlyphIDs. </td><td><a class="el" href="class_i_font_mgr.html">IFontMgr</a>, <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a>, <a class="el" href="class_i_story_service.html">IStoryService</a></td><td><a class="el" href="class_snp_insert_glyph.html">SnpInsertGlyph</a></td></tr></table><p>Accessing a font: <div class="image"><img alt="plugin-programming-guide-vol1-187.gif" src="plugin-programming-guide-vol1-187.gif" /></div><p>Fonts are used when composing text, because fonts define the characteristics of individual glyphs. <a class="el" href="classk_compose_style_boss.html">kComposeStyleBoss</a> is used by the composition engine. The <a class="el" href="class_i_drawing_style.html">IDrawingStyle</a> interface provides access to the font (<a class="el" href="class_i_p_m_font.html">IPMFont</a>) and the particular font instance (<a class="el" href="class_i_font_instance.html">IFontInstance</a>) being used.<p><b>Local font manager</b><p>Each open document has its own local font manager, <a class="el" href="class_i_local_font_manager.html">ILocalFontManager</a>, which inherits from <a class="el" href="class_i_font_mgr.html">IFontMgr</a>. To ask the <a class="el" href="class_i_document.html">IDocument</a> for its <a class="el" href="class_i_font_mgr.html">IFontMgr</a>, make a request similar to the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFontMgr&gt;</a> fontMgr(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>You can cast the <a class="el" href="class_i_font_mgr.html">IFontMgr</a> for a document to an <a class="el" href="class_i_local_font_manager.html">ILocalFontManager</a>. Getting the interface looks like this: <div class="fragment"><div class="line"><a class="code" href="class_i_local_font_manager.html">ILocalFontManager</a>* lFontMgr = <span class="keyword">static_cast&lt;</span><a class="code" href="class_i_local_font_manager.html">ILocalFontManager</a>*<span class="keyword">&gt;</span> (fontMgr.get());</div></div><p>If there are document-installed fonts, the local font manager ensures that those fonts are used before any session managed fonts. If there are no document-installed fonts, <a class="el" href="class_i_local_font_manager.html">ILocalFontManager</a> provides essentially the same services as the document&#39;s <a class="el" href="class_i_font_mgr.html">IFontMgr</a>. You can query whether a font was installed specifically for the document using IsDocumentInstalledFont.<p>Code snippet SnpInspectFontMgr.cpp has an example of how to use <a class="el" href="class_i_local_font_manager.html">ILocalFontManager</a>.<h3><a class="anchor" id="id_fonts_within_the_document"></a> Fonts within the document</h3><p>Within a document, fonts are represented by the font name (plus information on font style and point size). When the actual font is required, the font manager resolves the name-to-font (<a class="el" href="class_i_p_m_font.html">IPMFont</a> or <a class="el" href="class_i_font_instance.html">IFontInstance</a>) mapping.<p><b>The document-font manager</b><p>The document-font manager (<a class="el" href="class_i_doc_font_mgr.html">IDocFontMgr</a>) provides access to all fonts that persist in a session or document workspace. The fonts that exist in a document include a set of default fonts, fonts used in visible stories, and fonts used for features that are modeled using the application text subsystem but not intended to be viewed or printed as part of a story (for example, text that exists in notes).<p><b>Fonts in the persistent document</b><p>Fonts are represented in the object model by kFontGroupBoss (signature interface <a class="el" href="class_i_font_family.html">IFontFamily</a>). Each font used in a story results in an instance of this boss object. A font family along with a font style identifies a particular font in the font subsystem. The font family represents the name of the font (more correctly, the set of names that identify each font within a particular group). This decoupling between font and name in the document allows the font manager to resolve the font when required and take appropriate measures if the font is not available to the application. The relationship between font manager and fonts is shown in the following figure<p>How fonts persist in a document:<div class="image"><img alt="plugin-programming-guide-vol1-188.gif" src="plugin-programming-guide-vol1-188.gif" /></div><p>A font persists as a name, contained within a persistent implementation of <a class="el" href="class_i_font_family.html">IFontFamily</a>. Access to these persistent objects is provided through the (session or document) workspace. <a class="el" href="class_i_font_family.html#ad9676d9ea6ff6a7265a0a83000057750">IFontFamily::QueryFace</a> requests the font from the font manager. If the returned <a class="el" href="class_i_p_m_font.html">IPMFont</a> is non-nil, <a class="el" href="class_i_p_m_font.html#a1a82eb12f352d8a693567a320a16b00b">IPMFont::FontStatus</a> can be used to determine the validity of the font.<p>A set of text within a story is associated with a particular font using standard text attributes.<p>The text attributes that refer to the font in which text appears are as follows:<ul><li><a class="el" href="classk_text_attr_font_u_i_d_boss.html">kTextAttrFontUIDBoss</a> - <a class="el" href="class_i_text_attr_u_i_d.html">ITextAttrUID</a> gives the UID of the font family.<li><a class="el" href="classk_text_attr_font_style_boss.html">kTextAttrFontStyleBoss</a> - <a class="el" href="class_i_text_attr_font.html">ITextAttrFont</a> gives the name of the stylistic variant.<li><a class="el" href="classk_text_attr_point_size_boss.html">kTextAttrPointSizeBoss</a> - <a class="el" href="class_i_text_attr_real_number.html">ITextAttrRealNumber</a> gives the point size used.</ul><p>The font family, along with the style of the font, identifies a particular font (<a class="el" href="class_i_p_m_font.html">IPMFont</a>). The point size of the text is used to provide an instance of the font (<a class="el" href="class_i_font_instance.html">IFontInstance</a>).<p>Text attributes are introduced and described fully in <a class="el" href="id_solutions.html#id_text_formatting">Text formatting</a>.<p><b>The used-font list</b><p>The used-font list (<a class="el" href="class_i_used_font_list.html">IUsedFontList</a>) on a document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) details the fonts associated with story text. The used-font list does not include the fonts used in features that are not intended to be viewed or printed as part of a story (for example, text that exists in notes).<p><b>Fonts in placed assets</b><p>Placed (EPS or PDF) assets support the <a class="el" href="class_i_font_names.html">IFontNames</a> interface. This interface reports the fonts used for the particular asset, including whether the asset depends on the presence of fonts on the system. Placed assets are maintained in the native asset&#39;s format (PDF or EPS), with the <a class="el" href="class_i_font_names.html">IFontNames</a> interface providing access to information within the asset.<p><b>Document font use</b><p>A utility interface (<a class="el" href="class_i_document_font_usage.html">IDocumentFontUsage</a>) on the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) provides a facade over the two interfaces introduced above (<a class="el" href="class_i_used_font_list.html">IUsedFontList</a> and <a class="el" href="class_i_font_names.html">IFontNames</a>).<p><b>Font naming</b><p>Internally, application code uses PostScript font names. For example, <a class="el" href="class_i_p_m_font.html#a1b0888b749112f0808642712b99bb7c4">IPMFont::AppendFontName</a> returns the PostScript font name. If you know the PostScript name of the font you want, you can get the associated <a class="el" href="class_i_p_m_font.html">IPMFont</a> using <a class="el" href="class_i_font_mgr.html#af81331b3adbdb7dce7f56cbf82d0ab43">IFontMgr::QueryFont</a>. Several other names are available on <a class="el" href="class_i_p_m_font.html">IPMFont</a> and <a class="el" href="class_i_font_family.html">IFontFamily</a>. For example, if you use <a class="el" href="class_i_font_mgr.html#af81331b3adbdb7dce7f56cbf82d0ab43">IFontMgr::QueryFont</a> to instantiate the PostScript font AGaramond-Italic, <a class="el" href="class_i_p_m_font.html">IPMFont</a> gives you the names shown in the table in the following figure.<div class="image"><img alt="plugin-programming-guide-vol1-189.gif" src="plugin-programming-guide-vol1-189.gif" /></div><p>Notice the typeface name Adobe Garamond Pro in the panel in the preceding figure does not match the family name in the table. This is because <a class="el" href="class_i_text_utils.html#add895082a3058e3c462a213dc9804395">ITextUtils::GetDisplayFontNames</a> supplies the platform-specific name in the Character panel. If you do not have the PostScript font name but know the name of the typeface on a given platform (the typeface name in Windows or the family name in Mac OS), <a class="el" href="class_i_font_mgr.html#a3fa3ba768670c4a239deb157556ae862">IFontMgr::QueryFontPlatform</a> returns the corresponding <a class="el" href="class_i_p_m_font.html">IPMFont</a>.<p><b>Font warnings</b><p>The <a class="el" href="class_i_document_font_usage.html">IDocumentFontUsage</a> interface (on <a class="el" href="classk_doc_boss.html">kDocBoss</a>) manages used-font and missing-font information for text in stories of a document. The <a class="el" href="class_i_document_font_usage.html">IDocumentFontUsage</a> interface does not detail fonts used by features that rely on the application text model but are not rendered as part of the document (for example, notes).<p>The <a class="el" href="class_i_missing_font_signal_data.html">IMissingFontSignalData</a> interface provides data sent with the missing-font signal (of which responders of type kMissingFontSignalResponderService are notified).<p>The <a class="el" href="class_i_font_use_warning_manager.html">IFontUseWarningManager</a> interface can be called to check a particular font and possibly warn the user about restrictions. Examples are restrictions based on user preferences or because a font is a bitmap.<h3><a class="anchor" id="id_composite_fonts_and_international-font_issues"></a> Composite fonts and international-font issues</h3><p>Some languages too many glyphs to be contained in a font; for example, Japanese contains about 50,000. To accommodate this, font developers create fonts with subsets of glyphs. Also, there is a desire within typography to replace some glyphs with others to achieve a certain visual effect. And users might want to shift the position of Roman glyphs relative to the baseline or enlarge or reduce the size of glyphs. See the following figure.<p>Japanese and Roman typography metrics:<div class="image"><img alt="plugin-programming-guide-vol1-190.gif" src="plugin-programming-guide-vol1-190.gif" /></div><p>The <a class="el" href="class_i_composite_font.html">ICompositeFont</a> interface creates a new font composed of base fonts and provides for size and positioning adjustments. Font switching is based on Unicode values. The base font must be a Chinese, Japanese, or Korean font. For examples of using <a class="el" href="class_i_composite_font.html">ICompositeFont</a>, see the <a class="el" href="class_snp_perform_comp_font.html">SnpPerformCompFont</a> code snippet. An application can get this interface using any of the following:<ul><li><a class="el" href="class_i_style_name_table.html">IStyleNameTable</a> (from the active workspace or document workspace)<li><a class="el" href="class_interface_ptr.html">InterfacePtr</a> &lt;IStyleNameTable&gt;compFontList(workspace, IID_ICOMPOSITEFONTLIST)<li><a class="el" href="class_interface_ptr.html">InterfacePtr</a> &lt;ICompositeFont&gt;rootTable(docDatabase, compFontList-&gt;GetRootStyleUID(), IID_ICOMPOSITEFONT)</ul><p>Use the <a class="el" href="class_i_composite_font_mgr.html">ICompositeFontMgr</a> interface to manage composite fonts. For examples of its use, see the SDK code snippet <a class="el" href="class_snp_perform_comp_font.html">SnpPerformCompFont</a>.<p>The <a class="el" href="class_i_font_metrics_table.html">IFontMetricsTable</a> interface obtains the correct tsume values (similar to side bearings on glyphs) around either the top and bottom or left and right of glyphs from the document originator and caches them. Later users (who might have only bitmaps of the fonts used to create the document) can use the tsume metrics saved in the document through this interface.<h1><a class="anchor" id="id_scriptable_plug_in_fundamentals"></a> Scriptable Plug-in Fundamentals</h1><p>This chapter describes how to extend your plug-in so that its features can be automated by a script, can be accessed in InDesign Server, and can participate in technologies based on IDML.<p>You can add scripting support to a plug-in for InDesign, InCopy, or InDesign Server. This chapter is the C++ programming counterpart to Adobe InDesign Scripting Guide and Adobe InCopy Scripting Guide, which document how to write scripts that automate InDesign and InCopy. Both the scripting guides and this chapter are recommended reading if you are adding scripting support to your plug-in. This chapter also describes the relationship between scripting and the InDesign Markup Language (IDML) file format.<h2><a class="anchor" id="id_terminology"></a> Terminology</h2><p>This following list contains terms used throughout this chapter. For other terms used in this chapter that are not in the following list, see the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_glossary">Glossary</a>.<ul><li>Apple Event Terminology extension (AETE) - A resource that defines Apple Events and objects which your application understands, both for scripts and for applications that send you events. Developed by Apple.<li>Apple Events - High-level, semantic messages designed to allow for collaboration between programs.<li>Boss DOM - The model of a document as a set of boss objects; that is, the boss objects found under <a class="el" href="classk_doc_boss.html">kDocBoss</a>, like <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>, <a class="el" href="classk_page_boss.html">kPageBoss</a>, and <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>. See Scripting plug-in.<li>Component Object Model (COM) - An object-oriented system developed by Microsoft for creating binary software components that can interact with each other. See Scripting DOM below.<li>Dictionary - A set of definitions for words that are understood by a particular application under AppleScript. A dictionary tells you which objects are available in a particular application and which AppleScript commands you can use to control it. See Scripting DOM below.<li>Element - Script element.<li>Enum - Enumerates the list of potential values a property or parameter can have. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Enum element&quot;.<li>ICML - InCopy Markup Language. An ICML file is a snippet file containing an InCopy story.<li>IDML - InDesign Markup Language. IDML is based on serializing objects defined in a scripting DOM tree to an XML-based format.<li>Method - A method call on a script object; for example, open or close. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_method_element">Method element</a>.<li>Non-UID-based script object - A script object that represents a scriptable boss with no UID. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_boss_classes">Scriptable boss classes</a> and Script-object inheritance.<li>Plural form - A script object that can exist in a collection is said to have a plural form. For example, the plural form of document is documents, a collection of document script objects. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Object element&quot;.<li>Preferences script object - A script object that represents preferences. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_script_providers">Script providers</a> and &quot;Script-object inheritance&quot;.<li>Property - An attribute of a script object; for example, color or width. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Property element&quot;.<li>Provider - Associates a script provider with the script object(s), method(s), or property(ies) it handles. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Provider element&quot;.<li>Script element - A script object, property, method, or enum. The elements from which the scripting DOM is made. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Scripting resources&quot;.<li>Script language - The language in which you write your scripts. AppleScript, Visual Basic, and JavaScript are supported in InDesign scripting.<li>Script manager - Manages a scripting DOM for a particular client of the scripting architecture. For example, each scripting language has a script manager, <a class="el" href="classk_apple_script_mgr_boss.html">kAppleScriptMgrBoss</a> for AppleScript, <a class="el" href="classk_o_l_e_automation_mgr_boss.html">kOLEAutomationMgrBoss</a> for Visual Basic, and <a class="el" href="classk_java_script_mgr_boss.html">kJavaScriptMgrBoss</a> for JavaScript. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_script_managers">Script managers</a>.<li>Script object - An object in the scripting DOM. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Object element&quot;.<li>Script provider - A boss class that provides an implementation of <a class="el" href="class_i_script_provider.html">IScriptProvider</a>. This manipulates a scriptable boss in response to requests made on a script object in the scripting DOM. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_script_providers">Script providers</a>.<li>Scriptable boss - A boss class exposed in the scripting DOM. Scriptable boss classes have the signature interface <a class="el" href="class_i_script.html">IScript</a>. Each scriptable boss has a corresponding script object. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_boss_classes">Scriptable boss classes</a>.<li>ScriptElementID - An identifier defined in kScriptInfoIDSpace; for example, kDocumentObjectScriptElement. This is akin to kClassIDSpace, where a boss ClassID is defined. See ScriptElementIDs.<li>ScriptID - A four-character identifier for a script element; for example, docu. See &quot;ScriptIDs&quot;.<li>Scripting DOM - A model of a document as a set of script objects with properties and methods that represent the end user&#39;s view. This is a high-level abstraction of the boss DOM. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a> and &quot;Scripting plug-in&quot;.<li>Singleton - A script object that cannot exist in a collection. See plural form above, <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom">Scripting DOM</a>, and &quot;Script-object inheritance&quot;. The term &quot;singleton&quot; does not imply that there is only one instance of the object (the common understanding of singleton in C++ programming and design patterns). It is common to find several instances of a singleton in the scripting DOM; for example, the singleton kTextFramePreferencesObjectScriptElement can have many instances, default text frame preference on the application, default text frame preferences on the document, and text frame preferences on each text frame.<li>Surrogate - A concept that distinguishes an ownership relationship from a referential relationship. A surrogate is a referential relationship between parent and child; no ownership is implied. See Surrogate.<li>Type library - Binary files (.tlb files) that include information about types and objects exposed by a COM application.<li>UID-based script object - A script object that represents a scriptable boss with a UID. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_boss_classes">Scriptable boss classes</a> and Script-object inheritance.</ul><h2><a class="anchor" id="id_overview"></a> Overview</h2><h3><a class="anchor" id="id_scripting"></a> Scripting</h3><p>Scripting allows users to exert virtually the same control of the application from a script as is available from the user interface. This functionality can be used for purposes as simple as automating repetitive tasks, or as involved as controlling the application from a database. Scripts can be written in AppleScript, Visual Basic, or JavaScript. For instructions on writing and running scripts, see Adobe InDesign Scripting Guide.<p>The extensibility of this scripting architecture allows you to provide scripting support for functions added by your own plug-in. The architecture provides a platform-independent and scripting-language-independent foundation on which you can build. It abstracts and provides implementations for the common elements of scripting. Your task is adding implementations for the functionality you are exposing.<h3><a class="anchor" id="id_benefits_of_making_a_plug-in_scriptable"></a> Benefits of making a plug-in scriptable</h3><p>For the plug-in developer, making a plug-in scriptable has several benefits:<ul><li>InDesign/InCopy users can automate the features added by your plug-in, by writing and executing scripts. The potential for new solutions using automation means added productivity for you and your customers.<li>Clients of InDesign Server can use your plug-in&#39;s features. A plug-in must be scriptable to interact with InDesign Server. See Getting Started With Adobe InDesign Server Plug-in Development.<li>Persistent data added to a document by your plug-in via boss objects and add-in interfaces is expressed in the IDML file format and its derivative file formats and technologies.</ul><h3><a class="anchor" id="id_scripting_and_idml"></a> Scripting and IDML</h3><p>IDML is an XML-based format used to serialize and deserialize a scripting DOM. For an overview of IDML and guidance on working with it, see IDML File Format Specification and Adobe InDesign Markup Language Cookbook.<p>By exposing functionality through scripting, plug-ins can participate in technologies like Save Backwards. You should make your plug-in scriptable if your plug-in adds persistent data to a document or to the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) and your plug-in uses features that depend on IDML, such as the following:<ul><li>Save backwards.<li>Asset libraries.<li>Assignments.<li>InCopy stories.<li>Application preference import/export. Preferences on the session workspace can be round-tripped as INDML. To participate, a plug-in&#39;s preferences must be exposed on the application script object (kApplicationObjectScriptElement). For guidance, see Chapter 10, Shared Application Resources. Also see &quot;Adding a new script object to make preferences scriptable&quot;, ISnippetExport::ExportAppPrefs, and <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream</a>.</ul><h3><a class="anchor" id="id_making_a_plug-in_scriptable"></a> Making a plug-in scriptable</h3><p>These are the principal tasks involved in adding scripting support to your plug-in:<ul><li>Design and implement script objects, properties, and methods. The features of your plug-in dictate the script objects, methods, and properties that you need to add to the scripting DOM. Use How to make your plug-in scriptable as a guide.<li>Refactor your code to fit into the scripting architecture. This chapter does not make suggestions about how to refactor your own plug-in code; however, a common refactoring task is decoupling the user interface and model-related source code in your plug-ins. Your user interface is a client of your plug-in&#39;s model; the scripting architecture also is a client. The time required for refactoring depends on the complexity of your plug-in and how well separated your user interface is from your model.<li>Document scriptability. Users writing scripts need documentation on the objects, properties, and methods that your plug-in makes available. The Adobe InDesign Scripting Guide documents the scripting supported by the application for AppleScript, Visual Basic, and JavaScript. You need to document the additions provided by your plug-in.<li>Test. There are three categories of testing:</ul><ol type="1"><li>Testing scriptability - This involves writing scripts in AppleScript (Mac OS), Visual Basic (Windows), and/or JavaScript (cross-platform). For instructions on writing scripts, see Adobe InDesign Scripting Guide. To learn how to verify that your plug-in exposes the script objects you intend, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_reviewing_scripting_resources">Reviewing scripting resources</a>.<li>Testing scriptability for backwards compatibility - The application supports the ability to execute scripts written for earlier versions of the product. For example, suppose you released a scriptable plug-in for InDesign CS6 and you are releasing a new version for InDesign CC. You should test that scripts written for InDesign CS6 run successfully under InDesign CC when targeted correctly. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_running_versioned_scripts">Running versioned scripts</a>.<li>Testing IDML support in the IDML-based technologies that your plug-in requires - Basic IDML support can be tested by exporting and importing documents containing your plug-in&#39;s data as an IDML file.</ol><h3><a class="anchor" id="id_tools_for_making_a_plug-in_scriptable"></a> Tools for making a plug-in scriptable</h3><p>To make your plug-in scriptable, you need the following tools:<ul><li>The current SDK plug-in development environment. For details, see Adobe InDesign Porting Guide.<li>For AppleScript, you need the AppleScript Script Editor (Mac OS) or another tool used to write and run AppleScript scripts.<li>For Visual Basic, you need Microsoft Visual Basic or Windows Script Host (Windows), the tools used to write and run Visual Basic scripts. Alternatively, you can use any COM development environment, including Microsoft Visual C++ and C#.<li>For JavaScript, you need a text editor. JavaScript can be run using the Scripts panel in InDesign and InCopy. To debug JavaScript you must install the ExtendScript Toolkit (included in the InDesign installer).</ul><p>For more information on writing and debugging scripts, see Adobe InDesign Scripting Guide.<h2><a class="anchor" id="id_scripting_architecture"></a> Scripting architecture</h2><p>This section provides an architectural description of the framework that supports scripting. Instructions on making your plug-in scriptable are in How to make your plug-in scriptable.<h3><a class="anchor" id="id_scripting_dom"></a> Scripting DOM</h3><p>The scripting DOM is the end-user representation of an application and document as a set of script objects. Each script object has properties and/or methods. The closest analogies for these concepts in an object-oriented programming language are class (script object), attribute (property), and method (method).<p>The scripting DOM describes a document as a tree structure of script objects, rooted at a document script object. For example, a document may have several children that are color script objects, several that are spreads, and so on. Besides having children, each script object can have a set of properties and methods. A color has properties that describe its name, color model, and color value, among other things. At this level of abstraction, we have the objects that are part of the end-user&#39;s experience of an InDesign document (spreads, pages, frames, stories, and so on), but the representation is less closely tied to the boss objects you manipulate with the C++ API.<dl class="section note"><dt>Note<dd>For a description of the script objects provided by the application, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom_reference">Scripting DOM reference</a>. C++ programmers add new script objects, properties, and methods to expose their plug-in&#39;s functionality.</dl><p>The following figure shows a portion of the scripting DOM for an application that has a document containing a page with a text frame. The scripting DOM is a hierarchy of script objects with methods and properties. Four script objects are shown in the figure: Application, Document, Page, and TextFrame. The script property that stores the bounds of a text frame object is shown.<div class="image"><img alt="plugin-programming-guide-vol1-191.gif" src="plugin-programming-guide-vol1-191.gif" /></div><p>Scripts get or set properties and execute methods. To do this, a script must find the right object and then perform an operation. The following example shows a script written in JavaScript that creates an instance of the scripting DOM shown in the preceding figure and sets a property of the text frame.<div class="fragment"><div class="line">app.documents.add(); </div><div class="line"><span class="comment">// method creates a document</span></div><div class="line">app.documents[0].pages[0].textFrames.add(); </div><div class="line"><span class="comment">//method creates text frame</span></div><div class="line">app.documents[0].pages[0].textFrames[0].geometricBounds = [<span class="stringliteral">&quot;0p0&quot;</span>, <span class="stringliteral">&quot;0p0&quot;</span>, <span class="stringliteral">&quot;36p0&quot;</span>, <span class="stringliteral">&quot;36p0&quot;</span>]; <span class="comment">// sets a property</span></div></div><p>A script object is said to be a child of the script object on which it is exposed. The script object that exposes another script object is said to be that object&#39;s parent. For example, in the figure, the document script object is a child of the application, and the application script object is the parent of the document.<p>A script object that can exist in a collection is said to have a plural form. The document, page, and text frame script objects in the figure have a plural form. A script object that has a plural form must support the special script methods used to manage collections (see Special methods).<p>A script objects that does not have a plural form often is called a singleton. Examples are the application script object in the figure and script objects that expose preferences.<p>Each script object, method, and property has a name, description, ScriptID, and ScriptElementID defined, as described in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_resources">Scripting resources</a>. The script objects provided by InDesign are identified in the table in &quot;Scripting DOM reference&quot;, later in this chapter.<p>Each script object, method, and property has an associated script provider (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_script_providers">Script providers</a>) that handles it.<h3><a class="anchor" id="id_versioning_the_scripting_dom"></a> Versioning the scripting DOM</h3><p>The scripting DOM covers the entire boss DOM. As the boss DOM changes, the scripting DOM evolves in response. The scripting DOM is versioned to maintain compatibility with past and future versions.<p>Adobe maintains at least one version of backward compatibility of the scripting DOM. This ensures that clients of the scripting DOM (for example, scripts, IDML, and INX) work seamlessly in new versions of the product.<p>Clients of the scripting DOM can specify which version of the scripting DOM should be used by the application to interpret requests (see RequestContext in the API documentation). Requests involving scripting elements (script objects, properties, and methods) that are added in a particular product version (for example, InDesign CC) work only if the client specifies that version (or later) of the scripting DOM. Similarly, objects, properties, and methods removed from the scripting DOM in InDesign CC will not work if the client specifies the InDesign CC version of the scripting DOM; however, they must still work if the client specifies the InDesign CS5 version of the scripting DOM.<p>Compatibility is maintained not just for the elements in the scripting DOM, but for the functionality they expose. This means that any underlying function that changes in InDesign CC is still exposed as it was in InDesign CS5 for clients of the scripting DOM. In some cases, this requirement may constrain the ability to significantly rearchitect the code. How to handle exceptions to this requirement, such as for functionality that no longer exists, is determined on a case-by-case basis. At the very least, script providers must degrade gracefully by implementing support as a no-op. For details of working with versioning, see Versioning of scripting resources.<p>Special considerations and rules regarding versioning and IDML are in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_maintaining_idml_forward_and_backward_compatibility">Maintaining IDML forward and backward compatibility</a>.<h3><a class="anchor" id="id_scripting_plugin"></a> Scripting plug-in</h3><p>The core architecture is implemented in the scripting plug-in, which manages the scripting DOM. The scripting DOM is described by plug-ins using ODFRC resources (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_resources">Scripting resources</a>). These resources define script objects, their properties, methods, and the script provider (<a class="el" href="class_i_script_provider.html">IScriptProvider</a>) that handles them. The architecture is extensible. Plug-ins can add new script objects or add new properties and methods to existing script objects by defining ODFRC resources and implementing a script provider.<p>See the following figure, showing scripting architecture. The scripting DOM represents a document as a set of script objects with properties and methods. The boss DOM represents a document as a set of boss objects and interfaces. Plug-ins expose their boss DOM data as objects and properties in the scripting DOM, by defining ODFRez resources. Plug-ins expose other functionality as scripting methods in a similar way. Plug-ins implement a script provider to manipulate data in the boss DOM when their script objects, properties, and methods are used. The scripting plug-in manages the scripting DOM. When script managers access the scripting DOM, the scripting plug-in maps script object properties and methods to their associated script provider.<div class="image"><img alt="plugin-programming-guide-vol1-192.gif" src="plugin-programming-guide-vol1-192.gif" /></div><p>Clients of the Scripting DOM are called script managers (see the <a class="el" href="class_i_script_manager.html">IScriptManager</a> interface in the API documentation). Scripting language support for AppleScript, Visual Basic, and JavaScript is provided by optional plug-ins that implement a script manager. The scripting DOM was conceived to make the scripting architecture easier to use and more extensible; in addition, it has enabled other technologies to be built. The IDML file format is founded on the scripting DOM.<h3><a class="anchor" id="id_script_interaction_with_the_scripting_dom"></a> Script interaction with the scripting DOM</h3><p>Scripts interact with their associated script manager, which interacts with the scripting DOM, which interacts with the application&#39;s C++ API. The interaction varies somewhat depending on the scripting language, as shown in the following figure. AppleScript and Visual Basic communicate with the application through their respective interapplication communication processes, AppleEvents and COM/OLE automation.<div class="image"><img alt="plugin-programming-guide-vol1-193.gif" src="plugin-programming-guide-vol1-193.gif" /></div><h3><a class="anchor" id="id_scripting_process_overview"></a> Scripting process overview</h3><ol type="1"><li>After the application launches, scripting system architecture support is available to the user through scripts; however, nothing is activated until a scripting request is received.<li>When a scripting request is received, the script manager determines what to do with it. After doing set-up, checks, and so on, the script manager populates the <a class="el" href="class_i_script_request_data.html">IScriptRequestData</a> interface with the data that was passed in.<li>The script manager invokes the <a class="el" href="class_i_script_request_handler.html">IScriptRequestHandler</a>, which invokes the appropriate script provider (<a class="el" href="class_i_script_provider.html">IScriptProvider</a>).<ul><li>If a property comes in, the script provider gets or sets the property, based on the parameters passed in through the <a class="el" href="class_i_script_request_data.html">IScriptRequestData</a> interface. For a get operation, the script provider simply returns the requested data from the model. For a set operation, the script provider extracts the input and either executes its code successfully (modifying the model) or returns an error.<li>Methods work similarly. Some methods do not require any data, but most methods take a set of parameters. The script provider uses the <a class="el" href="class_i_script_request_data.html">IScriptRequestData</a> interface to get that input, executes any necessary model modification via commands, and returns data or an error code.</ul><li>Control returns to the script manager, which does clean-up and conversion. The script manager takes the data in the <a class="el" href="class_i_script_request_data.html">IScriptRequestData</a> interface and converts it back to something the scripting language understands.<li>The script manager returns, and control is passed back to the script.</ol><h3><a class="anchor" id="id_script_managers"></a> Script managers</h3><p>The application supplies script managers that handle the interaction between the scripting client and your plug-in. The following tables lists major script manager boss casses<table class="doxtable"><tr><th>Script Manager ClassID </th><th>Used with </th></tr><tr><td><a class="el" href="classk_apple_script_mgr_boss.html">kAppleScriptMgrBoss</a></td><td>AppleScript </td></tr><tr><td>kINXScriptManagerBoss </td><td>Base class for INX and IDML script -manager bosses </td></tr><tr><td><a class="el" href="classk_java_script_mgr_boss.html">kJavaScriptMgrBoss</a></td><td>JavaScript </td></tr><tr><td><a class="el" href="classk_o_l_e_automation_mgr_boss.html">kOLEAutomationMgrBoss</a></td><td>Visual Basic </td></tr><tr><td>kINXTraditionalImportScriptManagerBoss </td><td>INX </td></tr><tr><td>kINXTraditionalExportScriptManagerBoss </td><td>INX </td></tr><tr><td>kINXExpandedImportScriptManagerBoss </td><td>IDML </td></tr><tr><td>kINXExpandedExportScriptManagerBoss </td><td>IDML </td></tr></table><h3><a class="anchor" id="id_scriptable_plug-ins"></a> Scriptable plug-ins</h3><p>This section describes the parts that enable a plug-in to receive a scripting request from a script manager and report data back to the script manager. As with other client interfaces that you would give a plug-in, scripting is intended to query and change the boss DOM. To accomplish this, we must be able to identify objects in the boss DOM via <a class="el" href="class_i_script.html">IScript</a> and get and/or set values.<p>For instructions on making your plug-in scriptable, see How to make your plug-in scriptable.<h3><a class="anchor" id="id_scripting_resources"></a> Scripting resources</h3><p>Every scriptable plug-in needs to supply a VersionedScriptElementInfo ODFRez resource that specifies the plug-in&#39;s additions to the scripting DOM in the form of script objects, properties, methods, and the providers that handle these additions. In this resource, you identify details about the script objects and their relationships with other script objects, and give them IDs so that your additions to the scripting DOM can be identified.<p>See Scripting resources.<h3><a class="anchor" id="id_script_providers"></a> Script providers</h3><p><a class="el" href="class_i_script_provider.html">IScriptProvider</a> is the signature interface of a script-provider boss class. This interface allows the script manager to access a script object, get and set its properties, and execute its methods. Script providers know how to handle script objects, properties, and methods in an abstract sense. They map a request from the scripting DOM onto the boss DOM. For example, in response to being called to get a property, a script provider might call an accessor method on an interface on a scriptable boss. To set a property, it might process a command that changes a scriptable boss.<p>When you implement a script provider boss, you normally extend <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>. To see its interfaces, refer to the API documentation.<p>Partial implementations are as follows:<ul><li><a class="el" href="class_c_script_provider.html">CScriptProvider</a> - Subclass this to add properties or methods to existing objects in the Scripting DOM.<li><a class="el" href="class_prefs_script_provider.html">PrefsScriptProvider</a> - Subclass this to add a singleton script object and its properties to the scripting DOM<li><a class="el" href="class_represent_script_provider.html">RepresentScriptProvider</a> - Subclass this to expose a new script object to the scripting DOM.</ul><h3><a class="anchor" id="id_scriptable_boss_classes"></a> Scriptable boss classes</h3><p><a class="el" href="class_i_script.html">IScript</a> is the signature interface of a scriptable boss; that is, a boss class exposed in the scripting DOM. A scriptable boss object is the ultimate target of a method or property request made on a script object. The need to implement an <a class="el" href="class_i_script.html">IScript</a> interface depends on whether you want to add a function to an existing script object or are implementing a new script object of your own. To add a function to an existing script object, such as the document, you do not implement the <a class="el" href="class_i_script.html">IScript</a> interface. To create a new script object, you must define a boss class that implements the <a class="el" href="class_i_script.html">IScript</a> interface, which maps your scriptable boss to its associated script object.<p>Partial implementations are as follows:<ul><li><a class="el" href="class_c_script.html">CScript</a> - Subclass this to expose a UID-based script object.<li><a class="el" href="class_c_proxy_script.html">CProxyScript</a> - Subclass this to expose a non-UID based script object.</ul><dl class="section note"><dt>Note<dd>If you are adding a property or method to an object that already exists in the scripting DOM, you do not need to implement <a class="el" href="class_i_script.html">IScript</a>.</dl><h2><a class="anchor" id="id_how_to_make_your_plug-in_scriptable"></a> How to make your plug-in scriptable</h2><h3><a class="anchor" id="id_prerequisites"></a> Prerequisites</h3><ol type="1"><li>Examine the scripting samples provided by the SDK.<li>Determine how to represent your plug-in&#39;s features in the scripting DOM:</ol><ul><li>Examine the scripting DOM and choose the objects on which your plug-in&#39;s features should be exposed. See the scripting references in &lt;SDK&gt;/docs/references, or create your own reference file as explained in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom_reference">Scripting DOM reference</a>.<li>Decide how to expose your plug-in&#39;s data and functionality in the form of objects, properties, and methods. Data is exposed by adding new script objects (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_object_element">Object element</a>) that encapsulate properties or adding properties to existing script objects (see &quot;Property element&quot; on page 386). Function is exposed by adding methods to new or existing script objects (see &quot;Method element&quot;).</ul><ol type="1"><li>Refactor your code so it is easy to call from a script provider:<ul><li>Your plug-in will have its own model implemented by some combination of data interfaces and boss objects, together with commands that change this model.<li>We recommend that you encapsulate the model manipulation code in a helper class, so this code can be easily shared between your user interface and script provider.<li>A facade interface added into <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> is a good implementation solution. Another possibility is a regular C++ class.<li>If you already refactored your plug-in for the selection architecture, you may be able to use your selection suite interface from your script provider and your user interface code. The recommended approach, however, is to factor code so your CSB suite and script provider delegate to a facade that contains the shared code.</ul><li>Examine the procedures in this section, and identify those that are relevant to your needs. Making your plug-in scriptable always includes the following steps, at a minimum:<ul><li>Add VersionedScriptElementInfo statement to your plug-in&#39;s .fr file, to add script objects, properties, methods, and providers to the scripting DOM. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_resources">Scripting resources</a>.<li>Add a script provider (<a class="el" href="class_i_script_provider.html">IScriptProvider</a>) to handle your plug-in&#39;s scripting elements.<li>Add an error string service (see <a class="el" href="class_c_error_string_service.html">CErrorStringService</a>), so your script provider can return meaningful ErrorCode values.<li>Additional required steps depend on your plug-in&#39;s features.</ul></ol><h3><a class="anchor" id="id_defining_ids"></a> Defining IDs</h3><p>You must define IDs that identify your plug-in&#39;s additions to the Scripting DOM. See ScriptElementIDs, ScriptIDs, names, descriptions, and GUIDs.<h3><a class="anchor" id="id_adding_a_new_property_to_an_existing_script_object"></a> Adding a new property to an existing script object</h3><ol type="1"><li>Define a ScriptID/Name pair and a ScriptElementID for the new property.<li>Create VersionedScriptElementInfo resource statement and do the following:<ul><li>Add a Property statement that defines the property.<li>Add a Provider statement to identify the existing script object(s) on which the property should be exposed and define the script provider that will handle the property.</ul><li>Create a script-provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>.<li>Implement <a class="el" href="class_i_script_provider.html">IScriptProvider</a> by subclassing and completing <a class="el" href="class_c_script_provider.html">CScriptProvider</a>.</ol><p>Related sample code:<table class="doxtable"><tr><th>Sample </th><th>Scripting DOM </th><th>Notes </th></tr><tr><td>BasicPersistInterface </td><td>Adds a string property to script objects kPageItemObjectScriptElement and kGraphicObjectScriptElement in the scripting DOM. </td><td>Exposes data stored in an add-in data interface on <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>. </td></tr><tr><td>BasicTextAdornment </td><td>Adds a boolean property to script objects kTextStyleRangeObjectScriptElement and kTextObjectScriptElement in the scripting DOM. </td><td>Exposes data stored in a custom text attribute. </td></tr></table><h3><a class="anchor" id="id_adding_a_new_method_to_an_existing_script_object"></a> Adding a new method to an existing script object</h3><ol type="1"><li>Define a ScriptID/Name pair and a ScriptElementID for the new method.<li>Create VersionedScriptElementInfo resource statement and do the following:<ul><li>Add a Method statement to define the method.<li>Add a Provider statement to identify the existing script object(s) on which the method should be exposed and define the script provider that will handle the method.</ul><li>Create a script-provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>.<li>Implement <a class="el" href="class_i_script_provider.html">IScriptProvider</a> by subclassing and completing <a class="el" href="class_c_script_provider.html">CScriptProvider</a>.</ol><p>Related sample code:<table class="doxtable"><tr><th>Sample </th><th>Scripting DOM </th><th>Notes </th></tr><tr><td>CandleChart </td><td>Adds methods to script object kDocumentObjectScriptElement in the scripting DOM. </td><td>Exposes processes that manage this sample&#39;s function. </td></tr><tr><td>SnippetRunner </td><td>Adds methods and properties to script object kApplicationObjectScriptElement in the scripting DOM. </td><td>Exposes methods and properties that manage code snippets and the framework that hosts them. </td></tr></table><h3><a class="anchor" id="id_adding_a_new_script_object_to_make_preferences_scriptable"></a> Adding a new script object to make preferences scriptable</h3><p>A preference object contains preference settings and exists in the scripting DOM as a singleton property. Normally, preferences reside in the kApplicationObjectScriptElement and kDocumentObjectScriptElement objects in the scripting DOM. In the boss DOM, these generally correspond to preference data interfaces on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, respectively.<p>To add a new script object to make preferences scriptable:<ol type="1"><li>Define a ScriptID/Name pair and a ScriptElementID for the preferences script object. Define a ScriptID/Name pair and a ScriptElementID for the property, that will allow the new preference object to be accessed on its parent.<li>Create a VersionedScriptElementInfo resource and define the preferences script object, as follows:<ul><li>Add an Object statement to encapsulate the preferences in a script object. Normally, the script object you add is based on kPreferencesObjectScriptElement.<li>Add a Property statement for each exposed preference in the script object.<li>Add a Property statement to allow the Object to be accessed on its parent.<li>Add a Provider statement to define the script provider that handles these preferences, the parent object(s) in the scripting DOM (kApplicationObjectScriptElement for preferences on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, and kDocumentObjectScriptElement for preferences on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), the object itself, and its properties.</ul><li>You do not have to define a new boss or provide an <a class="el" href="class_i_script.html">IScript</a> implementation to make your preferences scriptable. Normally, you can reuse <a class="el" href="classk_base_prefs_script_object_boss.html">kBasePrefsScriptObjectBoss</a>.<li>Create a script provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>, as follows: <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourPrefsScriptProviderBoss,</div><div class="line"><a class="code" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> IID_ISCRIPTPROVIDER, kYourPrefsScriptProviderImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Implement <a class="el" href="class_i_script_provider.html">IScriptProvider</a> by subclassing and completing <a class="el" href="class_prefs_script_provider.html">PrefsScriptProvider</a>. In the constructor, call <a class="el" href="class_prefs_script_provider.html#a91d357c605fb5073e46e2b76b5620667">PrefsScriptProvider::DefinePreference</a> (for details, see the API documentation). This connects your preferences script object to the scriptable boss that handles preferences.</ol><p>Preference-related sample code:<table class="doxtable"><tr><th>Sample </th><th>Scripting DOM </th><th>Notes </th></tr><tr><td>BasicPersistInterface </td><td>Adds script object kBPIPrefObjectScriptElement to kApplicationObjectScriptElement and kDocumentObjectScriptElement in the scripting DOM. </td><td>Exposes preferences stored in an add-in interface on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>. </td></tr><tr><td>PrintSelection </td><td>Adds script object kPrintSelectionObjectScriptElement to kDocumentObjectScriptElement in the scripting DOM. </td><td>Exposes data stored in an add-in interface on <a class="el" href="classk_doc_boss.html">kDocBoss</a>. </td></tr><tr><td>SnippetRunner </td><td>Adds script object kSnipRunObjectScriptElement to kApplicationObjectScriptElement in the scripting DOM. </td><td>Exposes the Snippet Runner object as a singleton object under kApplicationObjectScriptElement, which does not have any counterpart interface on any workspace boss. </td></tr></table><h3><a class="anchor" id="id_adding_a_new_singleton_script_object"></a> Adding a new singleton script object</h3><p>If the object you are exposing is a singleton, follow the procedure for preferences (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_adding_a_new_script_object_to_make_preferences_scriptable">Adding a new script object to make preferences scriptable</a> and the example in &quot;Object element&quot;).<h3><a class="anchor" id="id_adding_a_new_script_object_to_make_a_boss_with_a_uid_scriptable"></a> Adding a new script object to make a boss with a UID scriptable</h3><ol type="1"><li>Define the required ScriptID/Name pairs and ScriptElementIDs.<li>Create VersionedScriptElementInfo resources for the script object, methods, properties, and provider (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_resources">Scripting resources</a>). Normally, the script objects you add are based on kUniqueIDBasedObjectScriptElement and must be accessible from another script object in the scripting DOM.<li>Add an <a class="el" href="class_i_script.html">IScript</a> implementation to the object&#39;s boss, as shown here: <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourBoss,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> ... <span class="comment">//Other interfaces on your boss</span></div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html#a6e31c93cd49a3b7b585bc0490a6cb635">IID_ISCRIPT</a>, kYourScriptImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Implement <a class="el" href="class_i_script.html">IScript</a> by subclassing and completing <a class="el" href="class_c_script.html">CScript</a>.<li>Create a script-provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>, as shown here: <div class="fragment"><div class="line">Class {</div><div class="line"></div><div class="line"> kYourScriptProviderBoss,</div><div class="line"><a class="code" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"></div><div class="line"> IID_ISCRIPTPROVIDER, kYourScriptProviderImpl,</div><div class="line"> } }</div></div><li>Implement <a class="el" href="class_i_script_provider.html">IScriptProvider</a> by subclassing and completing <a class="el" href="class_represent_script_provider.html">RepresentScriptProvider</a>.</ol><p>Related sample code:<table class="doxtable"><tr><th>Sample </th><th>Scripting DOM </th><th>Notes </th></tr><tr><td>PersistentList </td><td>Adds script object kPstLstDataObjectScriptElement to kGraphicObjectScriptElement, kPageItemObjectScriptElement and other page item related objects in the scripting DOM. (For the complete list, see the Provider statement in PstLst.fr). </td><td>Exposes the UID-based object <a class="el" href="classk_pst_lst_data_boss.html">kPstLstDataBoss</a>. </td></tr></table><h3><a class="anchor" id="id_adding_a_new_script_object_to_make_a_boss_with_no_uid_scriptable"></a> Adding a new script object to make a boss with no UID scriptable</h3><ol type="1"><li>Define the required ScriptID/Name pairs and ScriptElementIDs.<li>Create VersionedScriptElementInfo resources for the object, methods, properties, and provider. Normally, the script objects you add are based on kNonUniqueIDBasedObjectScriptElement and must be accessible from another script object in the scripting DOM.<li>Make your scriptable boss a subclass of <a class="el" href="classk_base_proxy_script_object_boss.html">kBaseProxyScriptObjectBoss</a>, as shown here. (If you cannot do this, proceed as in Adding a new script object to make a C++ object with no boss scriptable.) <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourBoss,</div><div class="line"><a class="code" href="classk_base_proxy_script_object_boss.html">kBaseProxyScriptObjectBoss</a>,</div><div class="line"> {</div><div class="line"> ... <span class="comment">//Other interfaces on your boss</span></div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html#a6e31c93cd49a3b7b585bc0490a6cb635">IID_ISCRIPT</a>, kYourScriptImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Implement <a class="el" href="class_i_script.html">IScript</a> by subclassing and completing <a class="el" href="class_c_proxy_script.html">CProxyScript</a>.<li>Create a script-provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>, as shown here: <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourScriptProviderBoss,</div><div class="line"><a class="code" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> IID_ISCRIPTPROVIDER, kYourScriptProviderImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Implement <a class="el" href="class_i_script_provider.html">IScriptProvider</a> by subclassing and completing <a class="el" href="class_represent_script_provider.html">RepresentScriptProvider</a>.<li>By default, proxy objects are specified by index. To specify by another property (for example, name), override <a class="el" href="class_c_proxy_script.html#ad08818fc2001fadf0fd06cf4518b3e31">CProxyScript::GetScriptObject</a> and substitute code to build your custom script object.</ol><p>For sample code, see the SnippetRunner sample. For related APIs, see <a class="el" href="class_i_script.html">IScript</a>, <a class="el" href="class_i_script_provider.html">IScriptProvider</a>, and <a class="el" href="class_c_proxy_script.html">CProxyScript</a>.<h3><a class="anchor" id="id_adding_a_new_script_object_to_make_a_cpp_object_with_no_boss_scriptable"></a> Adding a new script object to make a C++ object with no boss scriptable</h3><ol type="1"><li>Define the required ScriptID/Name pairs and ScriptElementIDs.<li>Create VersionedScriptElementInfo resources for the object, methods, properties, and provider. Normally, the script objects you add are based on kNonIDBasedObjectScriptElement and must be accessible from another script object in the Scripting DOM<li>Create a script object boss that subclasses <a class="el" href="classk_base_proxy_script_object_boss.html">kBaseProxyScriptObjectBoss</a>, as shown here: <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourScriptObjectBoss,</div><div class="line"><a class="code" href="classk_base_proxy_script_object_boss.html">kBaseProxyScriptObjectBoss</a>,</div><div class="line"> {</div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html#a6e31c93cd49a3b7b585bc0490a6cb635">IID_ISCRIPT</a>, kYourScriptImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Implement <a class="el" href="class_i_script.html">IScript</a> by subclassing and completing <a class="el" href="class_c_proxy_script.html">CProxyScript</a>.<li>Create a script-provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>, as shown here: <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourScriptProviderBoss,</div><div class="line"><a class="code" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> IID_ISCRIPTPROVIDER, kYourScriptProviderImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Implement <a class="el" href="class_i_script_provider.html">IScriptProvider</a> by subclassing and completing <a class="el" href="class_represent_script_provider.html">RepresentScriptProvider</a>.<li>In your implementation of <a class="el" href="class_represent_script_provider.html#ab9cd1d56478d5861142e2fecfbf420aa">RepresentScriptProvider::AppendNthObject</a>, call <a class="el" href="class_i_script_utils.html#afbf96dcd542bc4d738937aecd10980d1">IScriptUtils::CreateProxyScriptObject</a> to create your scriptable boss, kYourScriptObjectBoss.<li>By default, proxy objects are specified by index. To specify by another property (for example, name):<ul><li>Aggregate an appropriate data interface to your proxy script object&#39;s boss (for example, IID_ISTRINGDATA).<li>In your implementation of <a class="el" href="class_represent_script_provider.html">RepresentScriptProvider</a>, set the specifier data after the call to <a class="el" href="class_i_script_utils.html#afbf96dcd542bc4d738937aecd10980d1">IScriptUtils::CreateProxyScriptObject</a>.<li>In your implementation of <a class="el" href="class_i_script.html">IScript</a>, override <a class="el" href="class_i_script.html#a9e04e8d331051850e4f54fe1ffce6bf6">IScript::GetScriptObject</a> and substitute code to build your custom script object.</ul></ol><p>Related sample code:<table class="doxtable"><tr><th>Sample </th><th>Scripting DOM </th><th>Notes </th></tr><tr><td>SnippetRunner </td><td>Adds script object kSnpRunnableObjectScriptElement to represent a code snippet that can be run by SnippetRunner. </td><td>Code snippets are C++ objects that have no associated boss. </td></tr></table><h3><a class="anchor" id="id_adding_a_new_script_object_to_make_a_panel_scriptable"></a> Adding a new script object to make a panel scriptable</h3><ol type="1"><li>Define the required ScriptID/Name pairs and ScriptElementIDs.<li>Create VersionedScriptElementInfo resources for the object, methods, properties, and provider. Normally, the script objects that you add are based on kNonIDBasedObjectScriptElement and must be accessible from another script object in the scripting DOM.<li>In the KitList resource for the panel, use the panel object&#39;s own ScriptID rather than the default ID.<li>If your panel is created via an API call to <a class="el" href="class_i_panel_mgr.html#ad235a9baeeacbd247e5342623fc8dcda">IPanelMgr::RegisterPanel</a>, pass the panel object&#39;s own ScriptID to that method (instead of the default value for the parameter).<li>Specific panels are singleton objects (even if there can be multiple instances of a particular panel type), so follow the procedure in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_adding_a_new_singleton_script_object">Adding a new singleton script object</a> for defining script elements. Unlike other singleton objects, do not expose a ParentProperty for access; access is by name via the application&#39;s Panels collection.<li>Create a script-provider boss that subclasses <a class="el" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>. Implement support for the new panel object in a script provider that subclasses <a class="el" href="class_prefs_script_provider.html">PrefsScriptProvider</a>. Override QueryPrefScript to call IPalettePanelScriptUtils::CreatePanelScriptObject, and pass the ScriptID of the new panel object. See the following example. <div class="fragment"><div class="line">Class</div><div class="line">{</div><div class="line"> kYourScriptProviderBoss,</div><div class="line"><a class="code" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> IID_ISCRIPTPROVIDER, kYourScriptProviderImpl,</div><div class="line"> }</div><div class="line">}</div></div></ol><p>For related APIs, see IPalettePanelScriptUtils, <a class="el" href="class_i_panel_mgr.html">IPanelMgr</a>, and <a class="el" href="class_i_script_provider.html">IScriptProvider</a>.<h3><a class="anchor" id="id_adding_an_error-string_service"></a> Adding an error-string service</h3><p>Your plug-in&#39;s script provider (<a class="el" href="class_i_script_provider.html">IScriptProvider</a>) should return a meaningful ErrorCode. If it returns kFailure, you will get an assert. To provide error information that is useful to clients, you must add an error-string service to your plug-in. To do so:<ol type="1"><li>Define a ClassID and ImplementationID in your plug-in&#39;s ID.h file for your error-string service.<li>Define an error-string service boss in your plug-in&#39;s .fr file.<li>Define a UserErrorTable resource in your plug-in&#39;s .fr file.<li>Define string keys and translations in your plug-in&#39;s StringTable resources.<li>Implement <a class="el" href="class_i_error_string_service.html">IErrorStringService</a> by subclassing and completing <a class="el" href="class_c_error_string_service.html">CErrorStringService</a>. See BasicPersistInterface for sample code and <a class="el" href="class_i_error_string_service.html">IErrorStringService</a> for related APIs.</ol><h3><a class="anchor" id="id_handling_multiple_concurrent_requests"></a> Handling multiple concurrent requests</h3><p>The scripting architecture can handle multiple requests concurrently in two ways: across multiple target objects and across multiple properties.<p><b>Handling multiple objects concurrently</b><p>Many methods of <a class="el" href="class_i_script_request_handler.html">IScriptRequestHandler</a>, like DoHandleMethod, DoHandleCollectionMethod, DoSetProperty, and DoGetProperty, can take either one IScript* or a const ScriptList &amp;. The request handler segregates the target objects according to which script provider handles them, then hands each script provider its own list of targets (by calling <a class="el" href="class_i_script_provider.html#a6fafc858ef08dfa528599db2c5a13094">IScriptProvider::HandleMethodOnObjects</a> or <a class="el" href="class_i_script_provider.html#a9ba917d08ef84024bb7b4e0b0b0a6c1e">IScriptProvider::AccessPropertyOnObjects</a>).<p>The default implementations of these methods (in <a class="el" href="class_c_script_provider.html">CScriptProvider</a>) simply iterate through the individual objects and call HandleMethod or AccessProperty for each one separately. A script provider, however, may override the overloaded version of <a class="el" href="class_c_script_provider.html#a5d015ea9208b93ad68c3359b73f508b6">CScriptProvider::HandleMethodOnObjects</a> or <a class="el" href="class_c_script_provider.html#a16d3126bb288f9e8cef112889377eacd">CScriptProvider::AccessPropertyOnObjects</a> that takes a const ScriptList &amp;, to handle the request on all objects at once (for example, by executing a single command on all targets).<p>This approach is most useful for script providers that handle methods for which there is a command that takes (or may take) multiple objects.<p><b>Handling multiple properties concurrently</b><p>Use <a class="el" href="class_i_script_request_handler.html#aca337b82cfa8eb6af4da17e3f65918c1">IScriptRequestHandler::SetProperties</a> and <a class="el" href="class_i_script_request_handler.html#a5cb322994229bf46718eafc1e43a6b1f">IScriptRequestHandler::GetProperties</a> to set and get multiple properties at a time. The request handler segregates the properties according to which script provider handles them, then hands each script provider its own list of properties (by calling <a class="el" href="class_i_script_provider.html#a23c5102e6cb4dfcccf7b7e1556e70e51">IScriptProvider::AccessProperties</a>).<p>The default implementation of AccessProperties (in <a class="el" href="class_c_script_provider.html">CScriptProvider</a>) simply iterates through the individual properties and calls AccessProperty to set each one separately. If you have a property-heavy script provider, however, you can override this behavior as follows:<ol type="1"><li>Override <a class="el" href="class_c_script_provider.html#a2314f7b820a1ab2821baeb608bc819a8">CScriptProvider::PreAccessProperty</a>, to create a command (or other cache) on set or acquire access to all the properties on get.<li>In the implementation of AccessProperty, cache the property information.<li>Override <a class="el" href="class_c_script_provider.html#ad144c2d9e2e2c7ba5054fc470381eaa0">CScriptProvider::PostAccessProperty</a> to execute the command (that is, set all the properties at once), or release access to the cache.</ol><p>The prerequisite for the preceding approach is a script provider that uses the same command to set all or most of the properties it supports, since the time to execute the command repeatedly is most expensive. Preferences script providers are a good candidate, because a variety of preferences often are grouped together in one command.<p>For related APIs, see <a class="el" href="class_i_script_request_handler.html">IScriptRequestHandler</a> and <a class="el" href="class_i_script_provider.html">IScriptProvider</a>.<h3><a class="anchor" id="id_reviewing_scripting_resources"></a> Reviewing scripting resources</h3><p><b>Windows: COM Type library location</b><p>The COM type library is stored under the user&#39;s defaults folder for the application on Windows; for example:<div class="fragment"><div class="line">C:\Users\&lt;username&gt;\AppData\Local\Adobe\&lt;InDesign or InCopy or InDesign Server&gt;\Version 9.0\en_US\Caches\ScriptingSupport\9.0\</div></div><p>See the &quot;Resources for Visual Basic.tlb&quot; file.<p>This folder also contains a &quot;Scripting SavedData&quot; file that holds a list of scriptable plug-ins, together with information that allows the application to detect changes that require the COM type library to be updated. When the application launches, it creates the COM type library (Windows only) if the files mentioned above do not exist or the &quot;Scripting SavedData&quot; file indicates these files need to be regenerated.<p>Another copy of the COM type library is stored under the &quot;All Users&quot; defaults folder on Windows; for example:<div class="fragment"><div class="line">C:\Users\Default\AppData\Local\Adobe\&lt;InDesign or InCopy or InDesign Server&gt;\Version 9.0\en_US\Caches\ScriptingSupport\9.0\</div></div><p>See the &quot;Resources for Visual Basic.tlb&quot; file. This is set up by the product installer and regenerated only if the application launches and finds the file does not exist. It is not regenerated when the set of scriptable plug-ins changes.<p><b>Mac OS: AppleScript dictionary location</b><p>The AppleScript dictionary is stored under the user&#39;s defaults folder for the application on the Mac; for example:<div class="fragment"><div class="line">/Users/&lt;username&gt;/Library/Caches/Adobe &lt;InDesign or InCopy or InDesign Server&gt;/Version 9.0/en_US/Scripting Support/9.0/</div></div><p>See the &quot;Resources for AppleScript.aete&quot; file.<p>This folder also contains a &quot;Scripting SavedData&quot; file that holds a list of scriptable plug-ins, together with information that allows the application to detect changes that require the dictionary to be updated. When the application launches, it creates the AppleScript dictionary (Mac OS only), if the files mentioned above do not exist or the &quot;Scripting SavedData&quot; file indicates that these files need to be regenerated.<p><b>Reviewing the scripting DOM</b><p>To verify that your new script elements were incorporated into the scripting DOM:<ol type="1"><li>Create a dump of the scripting DOM, as described in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_dumping_the_scripting_dom">Dumping the scripting DOM</a>.<li>Open the dump in a text editor, and search for your script elements by either ScriptID or ScriptElementID.<li>Verify that each of your properties, methods, and enums is in the dump, and that they were added to the script objects you expected.</ol><p><b>Reviewing the AppleScript dictionary</b><p>To verify that your new script objects were incorporated into the AppleScript dictionary:<ol type="1"><li>Launch the AppleScript Script Editor on your system.<li>Choose File &gt; Open Dictionary...<li>Select the application you want (for example, Adobe InDesign CC 2014), and browse the dictionary.</ol><p><b>Reviewing the COM type library</b><p>To verify that your new script objects were incorporated into the COM type library, choose one of the following approaches:<p>Using Microsoft Visual Studio:<ol type="1"><li>Launch Visual Studio and create a new project.<li>Select View &gt; Object Browser.<li>From the Browse List, select Edit Custom Component Set... and find &quot;Adobe InDesign \&lt;version\&gt; Type Library&quot; or &quot;Adobe InCopy \&lt;version\&gt; Type Library&quot;. If it does not appear in the list, click Browse... and find &quot;Resources for Visual Basic.tlb&quot; (see &quot;Windows: COM Type library location&quot;).<li>Click OK on the References dialog.<li>If it does not appear in the list, select Edit Custom Component Set and then click Add.</ol><div class="image"><img alt="VBObjBrowser.GIF" src="VBObjBrowser.GIF" /></div><p>Using Microsoft Word or Excel&#39;s Macro Editor:<ol type="1"><li>Launch Microsoft Word or Excel.<li>Select Tools &gt; Macro &gt; Visual Basic Editor.<li>Select Tools &gt; References.<li>From the Available References list, check &quot;Adobe InDesign \&lt;version\&gt; Type Library&quot; or &quot;Adobe InCopy \&lt;version\&gt; Type Library&quot; and click OK. If it does not appear in the list, click Browse and find &quot;Resources for Visual Basic.tlb&quot; (see &quot;Windows: COM Type library location&quot;).<li>Select View &gt; Object Browser (or hit the F2 key). Pick &quot;InDesign&quot; or &quot;InCopy&quot; from the first drop-down list to view the type library.</ol><h3><a class="anchor" id="id_running_versioned_scripts"></a> Running versioned scripts</h3><p>Three steps must be properly versioned to run an older script in a newer version of the product:<ol type="1"><li>Targeting - Scripts must be targeted to the version application in which they are being run (that is, the current version). The mechanics of targeting are language specific.<li>Compilation - This involves mapping the names in the script to the underlying identifiers, which are what the application understands. The mechanics of compilation are language specific.<li>Interpretation - This involves matching the identifiers to the appropriate request handler within the application. The current version of the application correctly interprets a script written to an earlier version of the scripting DOM, if you run it from a folder in the Scripts panel named, for example, &quot;Version 6.0 Scripts,&quot; or explicitly set the application&#39;s script preferences to the old DOM within the script.</ol><p><b>Targeting</b><p><b>Targeting for AppleScript applications</b><p>Targeting for AppleScript applications is done using the &quot;tell&quot; statement. You do not need a tell statement if you run the script from the Scripts panel, because there is an implicit tell statement for the application launching the script.<div class="fragment"><div class="line">tell application <span class="stringliteral">&quot;Adobe InDesign CC 2014&quot;</span> --target CC</div></div><p><b>Targeting for Visual Basic applications</b><p>Targeting for Visual Basic applications and VBScripts is done using the &quot;CreateObject&quot; method:<div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesign.Application.CC&quot;</span>) <span class="stringliteral">&#39;Target CC</span></div><div class="line"><span class="stringliteral">Set myApp = CreateObject(&quot;InDesign.Application&quot;) &#39;</span>Target the last version of InDesign that was launched</div></div><p><b>Targeting for JavaScript applications</b><p>Targeting for JavaScripts is implicit when launched using the Scripts panel. If launched from elsewhere, use the &quot;target&quot; directive:<div class="fragment"><div class="line"><span class="preprocessor">#target &quot;InDesign-9.0&quot; //target CC</span></div><div class="line"><span class="preprocessor">#target &quot;InDesign&quot; //target the latest version of InDesign</span></div></div><p><b>Compilation</b><p><b>Compilation of AppleScript applications</b><p>Typically, AppleScripts are compiled using the targeted application&#39;s dictionary. You can override this behavior with the &quot;using terms from&quot; statement, which substitutes another application&#39;s dictionary for compilation purposes.<div class="fragment"><div class="line">tell application <span class="stringliteral">&quot;Adobe InDesign CC 2014&quot;</span> --target CC </div><div class="line"><span class="keyword">using</span> terms from application <span class="stringliteral">&quot;Adobe InDesign CS6&quot;</span> --compile <span class="keyword">using</span> CS6 </div><div class="line"> ... </div><div class="line"> end <span class="keyword">using</span> terms from</div><div class="line">end tell</div></div><p>To generate a CS6 version of the AppleScript dictionary, use the publish terminology method, which is exposed on the application object (see below). The dictionary is published into a folder (named with the version of the DOM) under the &quot;Scripting Support&quot; folder. For example: /Users/&lt;username&gt;/Library/Caches/Adobe &lt;InDesign or=&quot;&quot; incopy=&quot;&quot; or=&quot;&quot; indesign=&quot;&quot; server&gt;=&quot;&quot;&gt;/Version 9.0/en_US/Scripting Support/8.0.<div class="fragment"><div class="line">tell application <span class="stringliteral">&quot;Adobe InDesign CC 2014&quot;</span></div><div class="line"> --publish the Adobe InDesign CS6 dictionary (version 8.0 DOM)</div><div class="line"> publish terminology version 8.0 </div><div class="line">end tell</div></div><p><b>Compilation of Visual Basic applications</b><p>Compilation of Visual Basic applications may be versioned by referencing the type library. To generate a CS6 version of the type library, use the PublishTerminology method, which is exposed on the Application object. The type library is published into a folder (named with the version of the DOM) that is under the &quot;Scripting Support&quot; folder in your application&#39;s preferences folder, which is located:<p>Windows 7:<div class="fragment"><div class="line">C:\Users\&lt;username&gt;\AppData\Local\Adobe\InDesign\Version 9.0\en_US\Caches\Scripting Support\8.0\</div></div><p>For example:<div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesign.Application.CS6&quot;</span>)</div><div class="line"><span class="stringliteral">&#39;publish the InDesign CS6 type library (version 8.0 DOM)</span></div><div class="line"><span class="stringliteral">myApp.PublishTerminology(8.0) </span></div></div><p>VBScripts are not precompiled. The application generates and references the appropriate type library automatically, based on the version of the DOM set for interpretation.<p><b>Compilation of JavaScript applications</b><p>JavaScripts are not precompiled. For compilation, the application uses the same version of the DOM that is set for interpretation.<p><b>Interpretation</b><p>The Application object contains a Script Preferences object, which allows a script to get/set the version of the scripting DOM to use for interpreting requests. The version will remain as set until explicitly changed again, even across scripts. The version defaults to the current version of the application and persists. See the following examples.<p><b>AppleScript interpretation</b><div class="fragment"><div class="line"><span class="keyword">set</span> version of script preferences to 8.0 --Set to 8.00 DOM</div></div><p><b>Visual Basic interpretation</b><div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesign.Application.CC&quot;</span>)</div><div class="line">myApp.ScriptPreferences.Version = 8.0 &#39;Set to 8.0 DOM</div></div><p><b>JavaScript interpretation</b><div class="fragment"><div class="line">app.scriptPreferences.version = 8.0 ; <span class="comment">//Set to 8.0 DOM</span></div></div><h3><a class="anchor" id="id_supporting_idml"></a> Supporting IDML</h3><p>For the most part, you support the IDML file format simply by exposing your persistent data in the scripting DOM.<p>If you are making a custom page item scriptable, make sure you do not rely on &quot;with properties&quot; (parameters) during the create method (e_Create). This is because the application component that generates the IDML file format may not have all the data to create the IDML tag attributes on your custom objects. Also, it may not set properties on your custom object in any specific order. So, in your script provider where you support the create method (e_Create), you should be able to support instantiation without properties while using reasonable defaults, and tolerate setting properties in random order.<p>If you have read-only properties that are set automatically by the application or your plug-in (for example, file modification date/time), you may need a separate read/write version of the property for use by the kINXScriptManagerBoss, so the IDML subsystem can update it while writing. For example, kPageCountPropertyScriptElement is a read-only element that needs the following:<p>Page count, a read-only property to which IDML requires write access <div class="fragment"><div class="line">{</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kInitialScriptVersion, kINXScriptManagerBoss, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_spread_script_provider_boss.html">kSpreadScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kMasterSpreadObjectScriptElement },</div><div class="line"> Property{ kPageCountPropertyScriptElement, kReadWrite },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">};</div></div><p>IDML writes object and property data to XML using their long name identifiers. To allow long names to be written within a list of values, define your property using a StructType containing StructFields that define key/value pairs for each value in the list. For example, here is a definition of key/value pairs to define list elements:<div class="fragment"><div class="line">Property {kBNRestartPolicyPropertyScriptElement,<span class="stringliteral">&quot;numbering restart policies&quot;</span>,<span class="stringliteral">&quot;Numbering restart policies.&quot;</span>,StructType {</div><div class="line"> StructField(<span class="stringliteral">&quot;restart policy&quot;</span>, EnumType( kBNRestartPolicyEnumScriptElement )),</div><div class="line"> StructField(<span class="stringliteral">&quot;lower level&quot;</span>, Int32Type ),</div><div class="line"> StructField(<span class="stringliteral">&quot;upper level&quot;</span>, Int32Type ) }{PermitTypeChange}<a class="code" href="classk_b_n_restart_policy_boss.html">kBNRestartPolicyBoss</a>,} </div></div><h3><a class="anchor" id="id_maintaining_idml_forward_and_backward_compatibility"></a> Maintaining IDML forward and backward compatibility</h3><p>This section describes the versioning goals and rules for InDesign and the IDML file format. The same versioning goals and rules apply to InCopy and its ICML file format.<p>Consider three InDesign versions, A, B and C, with A being the oldest. The scripting DOM version is changed at the beginning of each product development cycle, so we also can speak of scripting DOM versions A, B and C. Each product version has its own IDML file format version, IDML-A, IDML-B, IDML-C, based on its associated scripting DOM.<p>Users do not want to specify which flavor of IDML they want to export or open. As a result, Adobe and third-party developers must preserve the illusion that there is one version of IDML.<p><b>Goals</b><ol type="1"><li>Each version of InDesign writes IDML in its own format. InDesign-C uses scripting DOM version C to produce IDML-C, and similarly for earlier product versions.<li>Each version of InDesign can read its own IDML version and all previous versions. This is a natural consequence of having a versioned scripting DOM. InDesign simply sets the scripting DOM to the correct version when the file is opened. Everything else falls into place. InDesign-C can read IDML-A, IDML-B, and IDML-C, because it knows about all three versions of the scripting DOM. Likewise, InDesign-A knows about only its own scripting DOM version.<li>Each version of InDesign can read IDML versions newer than itself. A given InDesign version should ignore information it does not understand and provide reasonable defaults for missing information. This means InDesign-A should make a best effort to read files written in IDML-B and IDML-C.</ol><p>Whether goal 3 is met depends on how carefully people write script providers. For most script objects, which are simple, just a small set of rules need to be followed.<p><b>Rules</b><p><b>Adding script objects or properties</b><p>If you add new script objects or add new properties to existing objects, there is no problem; older versions of InDesign simply ignore the information.<p><b>Removing script objects and properties</b><p>If you remove an object or property, there is no problem. Suppose a property called weasel is no longer needed in InDesign-B. Mark the weasel property Obsolete as of scripting DOM version B. Leave support for the property intact, since it will be needed when version A of the scripting DOM is active.<p><b>Changing the type of a property</b><p>We do not recommend changing the type of a property, and experience has shown that changes to a property&#39;s type should be rare. Choose carefully when adding a new property and specifying its type.<h3><a class="anchor" id="id_verifying_that_your_plug-ins_data_is_round-tripped_through_idml"></a> Verifying that your plug-in&#39;s data is round-tripped through IDML</h3><p>To make sure your new script objects are exported in IDML:<ol type="1"><li>Start the application with your scriptable plug-in present.<li>Create a new document, and create objects that have your plug-in&#39;s data applied.<li>Choose File &gt; Export, and select the &quot;InDesign Markup (IDML)&quot; format. Save your file with an .idml extension.<li>The IDML file is an archive package that contains XML files and other related files. To open the IDML package, first extract it using WinZip or a similar tool. Search in the appropriate XML files for your scripting object&#39;s name, specified in your plug-in&#39;s .fr file. For details about the contents of the IDML package, see IDML File Format Specification.<li>Open the .idml file in InDesign, and verify there is no assert or data loss.</ol><p>For example, the Watermark sample plug-in adds a preference object to the document. Follow the instructions above, and use the Plug-ins &gt; SDK &gt; Watermark menu to define a watermark for the document. Export an IDML file, uncompress it, open designmap.xml, and search for &quot;WatermarkPreference.&quot;<h3><a class="anchor" id="id_tips_for_debugging_the_scripting_architecture"></a> Tips for debugging the scripting architecture</h3><p>To help debug your scriptable plug-in, use the following debug-build-only menu items:<ul><li>To trace BridgeTalk messages, turn on Test &gt; TRACE &gt; Script &gt; BridgeTalk.<li>To trace the loading of scripts into the scripts panel, turn on Test &gt; TRACE &gt; Script &gt; ScriptPanelFile.<li>To trace requests and see which script providers are invoked, turn on Test &gt; TRACE &gt; Script &gt; ScriptRequestHandler.<li>To trace the instantiation of scripting DOMs, turn on Test &gt; TRACE &gt; Script &gt; ScriptTimer.<li>To trace the loading of script information resources, turn on Test &gt; TRACE &gt; Script &gt; ScriptInfoManager &gt; Registration.<li>To enable asserts when a dependent resource is missing, turn on Test &gt; TRACE &gt; Script &gt; ScriptInfoManager &gt; Resource Dependencies.<li>To trace the specification and resolution of objects used by a JavaScript, turn on Test &gt; TRACE &gt; Script &gt; CoreObjectSpecifier.<li>To trace Apple events processed, turn on Test &gt; TRACE &gt; AppleScript &gt; EventHandlers.<li>To trace operations on InDesign COM objects used by a Visual Basic script, turn on Test &gt; TRACE &gt; GenericCOMObject.<li>From the Test &gt; Scripting menu, you can dump the contents of the ScriptInfoManager for various clients to a text file in the QA Logs folder. This makes it easy to diff changes you are making or between builds.</ul><h2><a class="anchor" id="id_scripting_resources"></a> Scripting resources</h2><p>The scripting DOM is made up of script objects, properties, methods, and providers that are defined by plug-ins using the ODFRez resource statements described in this section.<dl class="section note"><dt>Note<dd>The scripting DOM provided by the application is described in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom_reference">Scripting DOM reference</a>. The script objects to which C++ programmers can add script objects, methods, and properties are identified there.</dl><p>The scripting resources in a plug-in:<ul><li>Describe the objects, properties, and methods exposed through the scripting DOM.<li>Determine how objects are related to each other in the scripting DOM object hierarchy.<li>Specify which script providers can handle which properties and methods on which objects.<li>Are stored in the plug-in&#39;s .fr file and are compiled like all ODFRC resources.<li>Are loaded and validated on first launch, then persisted in the application&#39;s SavedData.<li>Are used to generate reference documentation required by specific clients (for example, AppleScript Dictionary, Visual Basic TypeLibrary, and IDML DTD).<li>Are versioned to maintain backward and forward compatibility between releases of the product (see Versioning of scripting resources).</ul><p>The scripting plug-in manages the scripting DOM via the <a class="el" href="class_i_script_info_manager.html">IScriptInfoManager</a> interface. <a class="el" href="class_i_script_info_manager.html">IScriptInfoManager</a>:<ul><li>Caches data from the resources and makes it available programmatically.<li>Matches requests to handle methods and properties on particular objects with the appropriate script provider.</ul><dl class="section note"><dt>Note<dd>See &lt;SDK&gt;/source/public/includes/ScriptInfoTypes.fh for the script element type definitions for Object, Method, Property, and so on.</dl><h3><a class="anchor" id="id_versionedscriptelementinfo_resource"></a> VersionedScriptElementInfo resource</h3><p>A VersionedScriptElementInfo statement adds script objects, properties, methods, and providers to the scripting DOM. Example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo(1) <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kCCScriptVersion, <span class="comment">// See Note 2</span></div><div class="line"><a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, <span class="comment">// See Note 3</span></div><div class="line"> kWildFS, <span class="comment">// See Note 4</span></div><div class="line"> k_Wild, <span class="comment">// See Note 5</span></div><div class="line"><span class="comment">// See Note 6</span></div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"><span class="comment">// See Note 7</span></div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>There may be more than one VersionedScriptElementInfo resource in a plug-in&#39;s .fr file. Each must have its own distinct resource identifier. The statement shown has a resource identifier of 1.<li>This is the version of the product the statement targets; kCCScriptVersion for CC. See ScriptInfoTypes.fh for other versions. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_versioning_of_scripting_resources">Versioning of scripting resources</a>.<li>Use <a class="el" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a> if the statement contains resources that should be in all scripting DOMs. If the statement applies only to a specific client, use its ClassID here. For example, if the statement is specific to AppleScript, use <a class="el" href="classk_apple_script_mgr_boss.html">kAppleScriptMgrBoss</a>. See Client-specific scripting resources.<li>This is the feature set identifier. kWildFS indicates this statement applies to all products and feature sets.<li>This is the locale identifier. k_Wild indicates that this statement applies to all user interface locales.))<li>If the statement targets other contexts, repeat 1 through 4 to define the additional contexts.<li>Object, method, property, enum, and provider elements go here.</ol><p>See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_versioning_of_scripting_resources">Versioning of scripting resources</a>.<h3><a class="anchor" id="id_object_element"></a> Object element</h3><p>An object element defines a new script object that can be added to the scripting DOM using a Provider statement (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_provider_element">Provider element</a>). The following is an example of a statement for a script object with a plural form:<div class="fragment"><div class="line">Object <span class="comment">// See Note 1{</span></div><div class="line"> kSpreadObjectScriptElement, <span class="comment">// See Note 2</span></div><div class="line"> c_Spread, <span class="comment">// See Note 3</span></div><div class="line"><span class="stringliteral">&quot;spread&quot;</span>, <span class="comment">// See Note 4</span></div><div class="line"><span class="stringliteral">&quot;A spread&quot;</span>, <span class="comment">// See Note 5</span></div><div class="line"> kSpread_CLSID, <span class="comment">// See Note 6</span></div><div class="line"> c_Spreads, <span class="comment">// See Note 7</span></div><div class="line"><span class="stringliteral">&quot;spreads&quot;</span>, <span class="comment">// See Note 8</span></div><div class="line"><span class="stringliteral">&quot;Every spread&quot;</span>, <span class="comment">// See Note 9</span></div><div class="line"> kSpreads_CLSID, <span class="comment">// See Note 10</span></div><div class="line"> kUniqueIDBasedObjectScriptElement, <span class="comment">// See Note 11</span></div><div class="line"> kLayoutSuiteScriptElement <span class="comment">// See Note 12</span></div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The object is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>Objects&#39; ScriptElementID (see ScriptElementIDs).<li>Objects&#39; ScriptID (see ScriptIDs).<li>Objects&#39; name (see Names).<li>Objects&#39; description (see Descriptions).<li>Objects&#39; GUID (see GUIDs).<li>ScriptID of the object&#39;s plural form (see ScriptIDs).<li>Name of the object&#39;s plural form (see Names)<li>Description of the object&#39;s plural form (see Descriptions)<li>GUID of the object&#39;s plural form (see GUIDs).<li>Script object on which this object is based (see Script-object inheritance and <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom_reference">Scripting DOM reference</a>.<li>AppleScript suite to which the object belongs (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_suite_element">Suite element</a>).</ol><p>The following is an example of a statement for a singleton script object (for example, preferences):<div class="fragment"><div class="line">Object{</div><div class="line"> kMarginPrefsObjectScriptElement,</div><div class="line"> c_MarginPref,</div><div class="line"><span class="stringliteral">&quot;margin preference&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Margin preferences&quot;</span>,</div><div class="line"> kMarginPref_CLSID,</div><div class="line"> NoPluralInfo, <span class="comment">// A preferences object has no plural form</span></div><div class="line"> kPreferencesObjectScriptElement, <span class="comment">// Preferences are based on this script object.</span></div><div class="line"> kPreferencesSuiteScriptElement,</div><div class="line">}</div></div><p>We recommend that any singleton script object be implemented using the pattern for preferences, for backward compatibility. A singleton is based on kPreferencesObjectScriptElement, as shown in the example, and it follows the implementation pattern outlined in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_adding_a_new_script_object_to_make_preferences_scriptable">Adding a new script object to make preferences scriptable</a>.<p>Earlier product versions (Creative Suite 1) required this, so the scripting DOM for JavaScript is set up correctly. If you add script elements to the scripting DOM for Creative Suite 1, make your singleton a preference script object).<p>Follow the preceding approach for any singleton, even if it exposes data to scripting that is not stored in the normal locations for preference data (that is, <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> and <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). For sample code, see SnippetRunner&#39;s kSnipRunObjectScriptElement object and <a class="el" href="class_snip_run_script_provider.html">SnipRunScriptProvider</a>.<h3><a class="anchor" id="id_method_element"></a> Method element</h3><p>A method element defines a new method that can be added to the scripting DOM using a Provider statement (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_provider_element">Provider element</a>). Example:<div class="fragment"><div class="line">Method <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"> kQuitMethodScriptElement, <span class="comment">// See Note 2</span></div><div class="line"> e_Quit, <span class="comment">// See Note 3</span></div><div class="line"><span class="stringliteral">&quot;quit&quot;</span>, <span class="comment">// See Note 4</span></div><div class="line"><span class="stringliteral">&quot;Quit the application&quot;</span>, <span class="comment">// See Note 5</span></div><div class="line"> VoidType, <span class="comment">// See Note 6</span></div><div class="line"> { <span class="comment">// See Note 7</span></div><div class="line"> en_SaveOptions, <span class="comment">// See Note 8</span></div><div class="line"><span class="stringliteral">&quot;saving&quot;</span>, <span class="comment">// See Note 9</span></div><div class="line"><span class="stringliteral">&quot;Whether to save changes before closing open documents&quot;</span>, <span class="comment">// See Note 10</span></div><div class="line"> EnumDefaultType( kSaveOptionsEnumScriptElement, en_No ), <span class="comment">// See Note 11</span></div><div class="line"> kOptional, <span class="comment">// See Note 12</span></div><div class="line"><span class="comment">// See Note 13</span></div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The method is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>Method&#39;s ScriptElementID (see ScriptElementIDs).<li>Method&#39;s ScriptID (see ScriptElementIDs, ScriptIDs, names, descriptions, and GUIDs).<li>Method &#39;s name (see Names).<li>Method&#39;s description (see Descriptions).<li>Data type of the method&#39;s return value (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_data_types">Scripting data types</a>).<li>A list of method parameters (Notes 8-12)<li>Parameter&#39;s ScriptID (see ScriptIDs).<li>Parameter&#39;s name (see Names).<li>Parameter&#39;s description (see Descriptions).<li>Parameter&#39;s type, including a default value for optional parameters (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_data_types">Scripting data types</a>).<li>kOptional or kRequired.<li>The definition of other parameters goes here.</ol><p><b>Default parameter values</b><p>You may specify a default value for optional parameters, using a default type (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_data_types">Scripting data types</a>). There are no default declarations for date, file, object, record, or array types. (See the ScriptInfoTypes.fh file.)<dl class="section note"><dt>Note<dd>A default value is not available for parameters of these types: Date, File, Object, Record, or Array. For some of these types, you can use one of the permitted default value types. For example, a Unit typically can be specified as a real or a string; and a variable type that includes object and string types could be specified using a string. However, there is no supported way to specify an array of default values for an array type. You can try the following workaround, but there is no guarantee it will be compatible in the future. <div class="fragment"><div class="line"><span class="comment">//Specify as the default a list of two unit values equal to 0.0 pointskScriptInfoUnitType, 2, NoValue, NoValue, {</span></div><div class="line">s_list{{ UnitValue(0.0), UnitValue(0.0) }}}, {}</div></div></dl><p><b>Special methods</b><p><b>Create</b><p>The create method instantiates a script object.<p>Most script objects can reuse the predefined method kCreateMethodScriptElement, unless they have required parameters for the create method, which is strongly discouraged. To define your own create method, use e_Create as the ScriptID and &quot;add&quot; as the name in your Method statement.<p>The create method is expected to use the WITHPROPERTIESPARAM macro to add a &quot;with properties&quot; parameter for AppleScript and JavaScript.<p>The create method is added to the scripting DOM using a CollectionMethod field within a Provider statement; for example: CollectionMethod{ kCreateMethodScriptElement }. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_provider_element">Provider element</a>. This associates the method with the collection object (or container of, in AppleScript).<p><b>Count</b><p>The count method indicates how many script objects are instantiated. It is considered a property in Visual Basic and appears on collections (the plural form of an object; for example &quot;Books&quot;) in the type library.<p>Most script objects can reuse the predefined method kCountMethodScriptElement.<p>The count method is added to the scripting DOM using a CollectionMethod field within a Provider statement; for example: CollectionMethod{ kCountMethodScriptElement }. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_provider_element">Provider element</a>.<p><b>Predefined methods</b><p>The following table lists common predefined methods. They are useful if you are adding a new script object that has a plural form to the scripting DOM.<table class="doxtable"><tr><th>ScriptElementID </th><th>ScriptID </th><th>Name </th><th>Notes </th></tr><tr><td>kCreateMethodScriptElement </td><td>e_Create </td><td>add </td><td>Instantiate a script object (&quot;make&quot; in Apple Script, &quot;Add&quot; in Visual Basic, and &quot;add&quot; in JavaScript). </td></tr><tr><td>kCountMethodScriptElement </td><td>e_Count </td><td>count </td><td>Count how many script objects are instantiated. </td></tr><tr><td>kDeleteMethodScriptElement </td><td>e_Delete </td><td>delete </td><td>Delete a script object. (&quot;delete&quot; in Apple Script, &quot;Delete&quot; in Visual Basic, and &quot;remove&quot; in JavaScript). </td></tr><tr><td>kDuplicateMethodScriptElement </td><td>e_Duplicate </td><td>duplicate </td><td>Duplicate a script object. </td></tr><tr><td>kMoveMethodScriptElement </td><td>e_Move </td><td>move </td><td>Move a script object. </td></tr></table><h3><a class="anchor" id="id_property_element"></a> Property element</h3><p>A property element defines a new property that can be added to the scripting DOM using a Provider statement (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_provider_element">Provider element</a>). Example:<div class="fragment"><div class="line">Property <span class="comment">//See Note 1</span></div><div class="line">{</div><div class="line"> kNamePropertyScriptElement, <span class="comment">// See Note 2</span></div><div class="line"> p_Name, <span class="comment">// See Note 3</span></div><div class="line"><span class="stringliteral">&quot;name&quot;</span>, <span class="comment">// See Note 4</span></div><div class="line"><span class="stringliteral">&quot;The name of the ^Object&quot;</span>, <span class="comment">// See Note 5</span></div><div class="line"> StringType, <span class="comment">// See Note 6</span></div><div class="line"> {} <span class="comment">// See Note 7</span></div><div class="line"> kNoAttributeClass, <span class="comment">// See Note 8</span></div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The property is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>Property&#39;s ScriptElementID (see ScriptElementIDs).<li>Property&#39;s ScriptID (see ScriptIDs).<li>Property&#39;s name (see Names).<li>Property&#39;s description (see Descriptions).<li>Property&#39;s data type (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_data_types">Scripting data types</a>).<li>A list of additional data types acceptable to use when setting the value of the property (in this case, none).<li>ClassID of the text, graphic, or table attribute boss class associated with this property. Use kNoAttributeClass if the property is not associated with an attribute.</ol><p>Other examples of Property statements are in the following example:<div class="fragment"><div class="line"><span class="comment">// Property that can be set using the name of a swatch or a swatch object.</span></div><div class="line">Property{</div><div class="line"> kPrefsFillColorPropertyScriptElement,</div><div class="line"> p_FillColor,</div><div class="line"><span class="stringliteral">&quot;fill color&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;The fill color&quot;</span>,</div><div class="line"> StringType,</div><div class="line"> { ObjectType( kSwatchObjectScriptElement ) }</div><div class="line"> kNoAttributeClass,</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Accessor property for a new script object.</span></div><div class="line"><span class="comment">// Added to parent object in Scripting DOM using a </span></div><div class="line"><span class="comment">// ParentProperty field in a Provider statement.</span></div><div class="line">Property { </div><div class="line"> kMarginPrefsPropertyScriptElement,</div><div class="line"> p_MarginPref,</div><div class="line"><span class="stringliteral">&quot;margin preferences&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Margin preferences&quot;</span>,</div><div class="line"><span class="comment">// This property refers to another object by ScriptElementID</span></div><div class="line"> ObjectType( kMarginPrefsObjectScriptElement ), </div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line">}</div></div><p><b>TypeDefType</b><p>A TypeDef resource defines a synonym for another type. You can use a TypeDef type wherever a type is required, by using a TypeDefType declaration; see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_typedef_element">TypeDef element</a>.<p><b>Settable types</b><p>If a property takes a particular type on &quot;set&quot; but will never return that type on &quot;get,&quot; that type should be in the list of additional settable types, rather than in a variable type.<p>For a property with settable types, instead of using this:<div class="fragment"><div class="line">Property{</div><div class="line"> kActiveLayerPropertyScriptElement,</div><div class="line"> p_ActiveLayer,</div><div class="line"><span class="stringliteral">&quot;active layer&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;The active layer&quot;</span>,</div><div class="line"> VariableType{ ObjectType( kLayerObjectScriptElement ), StringType },</div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line">}</div></div><p>Use this:<div class="fragment"><div class="line">Property{</div><div class="line"> kActiveLayerPropertyScriptElement,</div><div class="line"> p_ActiveLayer,</div><div class="line"><span class="stringliteral">&quot;active layer&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;The active layer&quot;</span>,</div><div class="line"> ObjectType( kLayerObjectScriptElement ),</div><div class="line"> { StringType }, kNoAttributeClass,</div><div class="line">}</div></div><p><b>Special properties</b><p><b>Special properties added via inheritance</b><p>The special properties in the following table are added when appropriate via inheritance and do not need to be added to any Provider statement. For documentation on the inheritance of properties from base script objects, see Script-object inheritance.<table class="doxtable"><tr><th>ScriptElementID </th><th>Name </th><th>Description </th><th>Note </th></tr><tr><td>kClassPropertyScriptElement </td><td>class </td><td>Class descriptor type </td><td>Provided under AppleScript by kAnyObjectScriptElement </td></tr><tr><td>kIDPropertyScriptElement </td><td>id </td><td>The object&#39;s identifier </td><td>Provided by kUniqueIDBasedObjectScriptElement and kNonUniqueIDBasedObjectScriptElement </td></tr><tr><td>kIndexPropertyScriptElement </td><td>index </td><td>Index of the object within its parent </td><td>Provided by kAnyObjectScriptElement </td></tr><tr><td>kLabelPropertyScriptElement </td><td>label </td><td>A label that can be set to any string </td><td>Provided by kUniqueIDBasedObjectScriptElement and kNonUniqueIDBasedObjectScriptElement </td></tr><tr><td>kObjectReferencePropertyScriptElement </td><td>object reference </td><td>An object reference for this object </td><td>Provided under AppleScript by kAnyObjectScriptElement </td></tr><tr><td>kParentPropertyScriptElement </td><td>parent </td><td>The object&#39;s parent </td><td>Provided by kAnyObjectScriptElement </td></tr><tr><td>kPropertiesPropertyScriptElement </td><td>properties </td><td>Property that allows setting of several properties at the same time </td><td>Provided by kAnyObjectScriptElement </td></tr></table><p><b>Name</b><p>This must be added into the Provider statement that supports the Name property; for example: Property{ kNamePropertyScriptElement, kReadWrite }.<p><b>Predefined properties</b><p>The properties in the following table are predefined by the application and can be added to script objects via a Provider statement:<table class="doxtable"><tr><th>ScriptElementID </th><th>ScriptID </th><th>Name </th><th>Description </th><th>Data type </th></tr><tr><td>kBottomPropertyScriptElement </td><td>p_Bottom </td><td>bottom </td><td>Bottom edge of the object. </td><td>UnitType </td></tr><tr><td>kBoundsPropertyScriptElement </td><td>p_Bounds </td><td>bounds </td><td>Bounds of the object, in the format (top, left, bottom, right). </td><td>UnitArrayType(4) </td></tr><tr><td>kDatePropertyScriptElement </td><td>p_Date </td><td>date </td><td>Date and time. </td><td>DateType </td></tr><tr><td>kDescriptionPropertyScriptElement </td><td>p_Description </td><td>description </td><td>Description. </td><td>StringType </td></tr><tr><td>kFullNamePropertyScriptElement </td><td>p_FullName </td><td>full name </td><td>Full path including the name. </td><td>FileType </td></tr><tr><td>kHeightPropertyScriptElement </td><td>p_Height </td><td>height </td><td>Height of the object. </td><td>UnitType </td></tr><tr><td>kLeftPropertyScriptElement </td><td>p_Left </td><td>left </td><td>Left edge of the object. </td><td>UnitType </td></tr><tr><td>kLockedPropertyScriptElement </td><td>p_Locked </td><td>locked </td><td>Whether the object is locked. </td><td>BoolType </td></tr><tr><td>kNamePropertyScriptElement </td><td>p_Name </td><td>name </td><td>Name of the object. </td><td>StringType </td></tr><tr><td>kPathPropertyScriptElement </td><td>p_Path </td><td>file path </td><td>File path. </td><td>FileType </td></tr><tr><td>kPropertiesPropertyScriptElement </td><td>p_Properties </td><td>properties </td><td>Property that allows setting of several properties at the same time. </td><td>RecordType( kContainerObjectScriptElement ) </td></tr><tr><td>kRightPropertyScriptElement </td><td>p_Right </td><td>right </td><td>Right edge of the object. </td><td>UnitType </td></tr><tr><td>kTopPropertyScriptElement </td><td>p_Top </td><td>top </td><td>Top edge of the object. </td><td>UnitType </td></tr><tr><td>kVisiblePropertyScriptElement </td><td>p_Visible </td><td>visible </td><td>Whether the object is visible. </td><td>BoolType </td></tr><tr><td>kWidthPropertyScriptElement </td><td>p_Width </td><td>width </td><td>Width of the object. </td><td>UnitType </td></tr></table><h3><a class="anchor" id="id_struct_element"></a> Struct element</h3><p>The StructType allows you to assign long scripting names to data within a group in your resource. This is especially useful for data that will be written to IDML.<div class="fragment"><div class="line">TypeDef </div><div class="line">{</div><div class="line"> kEmployeeTypeDefScriptElement,</div><div class="line"> t_EmployeeType,</div><div class="line"><span class="stringliteral">&quot;An Adobe employee&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Information about our most valuable asset.&quot;</span>,</div><div class="line"> StructType {</div><div class="line"> StructField( <span class="stringliteral">&quot;name&quot;</span>, StringType ),</div><div class="line"> StructField( <span class="stringliteral">&quot;id&quot;</span>, Int32Type )</div><div class="line"> }</div><div class="line">} </div></div><h3><a class="anchor" id="id_typedef_element"></a> TypeDef element</h3><p>A TypeDef resource defines a synonym for another type. A TypeDef type may be used wherever a type is required, by using a TypeDefType declaration; for example, the storage type of a property resource or the return type or parameter types of a method resource.<p>Two TypeDefs in the core DOM corresponding to user-interface colors in InDesign and InCopy were reimplemented using this technique. The new TypeDefs are shown here:<div class="fragment"><div class="line">TypeDef</div><div class="line">{</div><div class="line"> kInDesignUIcolortypeDefScriptElement,</div><div class="line"> t_IDUIColorType,</div><div class="line"><span class="stringliteral">&quot;InDesign UI color type&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Properties or parameters using the InDesign UI Colors enumeration use this to</span></div><div class="line"><span class="stringliteral"> specify the type as either one of the enumerated UI colors or a list of</span></div><div class="line"><span class="stringliteral"> RGB values for a custom color.&quot;</span>,</div><div class="line"> VariableType </div><div class="line"> { </div><div class="line"> RealMinMaxArrayType(3, 0, 255), </div><div class="line"> EnumType( kUIColorsEnumScriptElement ) </div><div class="line"> }</div><div class="line">}</div><div class="line">TypeDef</div><div class="line">{</div><div class="line"> kInCopyUIColorTypeDefScriptElement,</div><div class="line"> t_ICUIColorType,</div><div class="line"><span class="stringliteral">&quot;InCopy UI color type&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Properties or parameters using the InCopy UI Colors enumeration use this to</span></div><div class="line"><span class="stringliteral"> specify the type as either one of the enumerated UI colors or a list of</span></div><div class="line"><span class="stringliteral"> RGB values for a custom color.&quot;</span></div><div class="line"> VariableType </div><div class="line"> { </div><div class="line"> RealMinMaxArrayType(3, 0, 255), </div><div class="line"> EnumType( kInCopyUIColorsEnumScriptElement ) </div><div class="line"> }</div><div class="line">}</div></div><p>To use a TypeDef in a property definition, use TypeDefType to specify which TypeDef to use:<div class="fragment"><div class="line">Property</div><div class="line">{</div><div class="line"> kWatermarkFontColorPropertyScriptElement,</div><div class="line"> p_WatermarkFontColor,</div><div class="line"><span class="stringliteral">&quot;watermark font color&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Watermark font color for a document&quot;</span>,</div><div class="line"> TypeDefType(kInDesignUIColorTypeDefScriptElement),</div><div class="line"> {},</div><div class="line"> kNoAttributeClass,</div><div class="line">}</div></div><h3><a class="anchor" id="id_enum_element"></a> Enum element</h3><p>An enum element defines the list of enumerated values that a property or parameter can take. Example:<div class="fragment"><div class="line">Enum <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"> kSaveOptionsEnumScriptElement, <span class="comment">// See Note 2</span></div><div class="line"> en_SaveOptions, <span class="comment">// See Note 3</span></div><div class="line"><span class="stringliteral">&quot;save options&quot;</span>, <span class="comment">// See Note 4</span></div><div class="line"><span class="stringliteral">&quot;Options for saving before closing a document&quot;</span>, <span class="comment">// See Note 5</span></div><div class="line"> { <span class="comment">// See Note 6</span></div><div class="line"> en_No, <span class="comment">// See Note 7</span></div><div class="line"><span class="stringliteral">&quot;no&quot;</span>, <span class="comment">// See Note 8</span></div><div class="line"><span class="stringliteral">&quot;Don&#39;t save changes&quot;</span>, <span class="comment">// See Note 9</span></div><div class="line"> en_AskUserSaveFile, <span class="comment">// See Note 10</span></div><div class="line"><span class="stringliteral">&quot;ask&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;Ask user whether to save changes&quot;</span>,</div><div class="line"> en_Yes, </div><div class="line"><span class="stringliteral">&quot;yes&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;Save changes&quot;</span>,</div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The enum is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>Enum&#39;s ScriptElementID (see ScriptElementIDs).<li>Enum&#39;s ScriptID (see ScriptIDs).<li>Enum&#39;s name (see Names).<li>Enum&#39;s description (see Descriptions).<li>A list of possible enum values (see Notes 7-9).<li>ScriptID of the first enum value (see ScriptIDs).<li>Name of the first enum value (see Names).<li>Description of the first enum value (see Descriptions).<li>ScriptIDs, names, and descriptions of other possible enum values would go here.</ol><p>An enum is referred to by a ScriptElementID from a Property statement or from parameters within a Method statement. See the example in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_method_element">Method element</a> for an example of a Method statement that uses kSaveOptionsEnumScriptElement as a parameter.<h3><a class="anchor" id="id_enumerator_element"></a> Enumerator element</h3><p>An enumerator element adds additional enumerators to an existing enum (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_enum_element">Enum element</a>). This is handy when adding a new value for an existing enumerated property. It also can be used when the available values of an enum are different in the Roman and Japanese feature sets. Example:<div class="fragment"><div class="line">Enumerator <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"> kExportFormatEnumScriptElement, <span class="comment">// See Note 2</span></div><div class="line"> { <span class="comment">// See Note 3</span></div><div class="line"> en_InCopyInterchange, <span class="stringliteral">&quot;InCopy interchange&quot;</span>, <span class="stringliteral">&quot;InCopy Interchange&quot;</span></div><div class="line"> en_InDesignInterchange, <span class="stringliteral">&quot;InDesign interchange&quot;</span>, <span class="stringliteral">&quot;InDesign Interchange&quot;</span>,</div><div class="line"> en_Snippet, <span class="stringliteral">&quot;InDesign snippet&quot;</span>, <span class="stringliteral">&quot;InDesign Snippet&quot;</span>,</div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The enumerator is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>This is the ScriptElementID of the enum being added to (see ScriptElementIDs).<li>This is a list of additional enum values. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_enum_element">Enum element</a> for the syntax of an enumerator value.</ol><dl class="section note"><dt>Note<dd>To alter the existing enumerators of an enum or remove enumerators from an Enum, you must obsolete the existing enum and define a new one (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_versioning_of_scripting_resources">Versioning of scripting resources</a>).</dl><h3><a class="anchor" id="id_metadata_element"></a> Metadata element</h3><p>The metadata element allows you to add metadata to one or more existing Suite, Object, Method, Property, Enum, and TypeDef elements. The target elements are listed by ScriptElementID; the metadata takes the form of a ScriptID/ScriptData key/value pair. Metadata on an element can be accessed at run time via the ScriptElement base class&#39;s GetMetadata() and HasMetadata() methods. The CustomDataLink sample in the SDK provides an example of metadata element, which is shown in this example:<div class="fragment"><div class="line">Metadata </div><div class="line">{</div><div class="line"> kTranFxSettingsINXPoliciesMetadataScriptElement, <span class="comment">// see note 1</span></div><div class="line"> {</div><div class="line"><span class="comment">// see note 2</span></div><div class="line"><span class="comment">// Elements</span></div><div class="line"> kTranFxSettingsObjectScriptElement,</div><div class="line"> }</div><div class="line"> {</div><div class="line"><span class="comment">// see note 3</span></div><div class="line"> m_NoDefaultsCache, NoValue,</div><div class="line"><span class="comment">// How to handle these elements during import.</span></div><div class="line"> m_INXSnippetAttrImportState, Int32Value(e_SetElementAttributes), </div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The ScriptElementID makes it possible to version the metadata resources included in a DOM based on the client.<li>The first group of braces identifies the target element onto which the metadata is to be added. Multiple elements can be added, and they can be different kind of element mixes, such as suite, object, and method.<li>The second group of braces is where you put the key/values pair for the data.</ol><p><b>Value types</b><p>The following metadata value types are supported:<ul><li>EnumValue( enumerator )<li>BoolValue( kTrue or kFalse )<li>Int16Value( short int )<li>Int32Value( long int )<li>NoValue()<li>RealValue( real )<li>StringValue(&quot;string&quot; )<li>UnitValue( real ) //value in points</ul><h3><a class="anchor" id="id_provider_element"></a> Provider element</h3><p>A provider element adds the script objects, methods, and properties you defined into the scripting DOM. It can be defined (used) in multiple places to represent different parent-child hierarchy client types. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_object_element">Object element</a>, &quot;Method element&quot; on page 384, and &quot;Property element&quot; for a description of how objects, methods, and properties are defined. The provider statement:<ul><li>Indicates which methods and properties are available on which objects.<li>Defines the script object hierarchy.<li>Specifies the script provider boss that handles the referenced object(s), method(s), and property(s).</ul><p>The following is an example of a Provider statement that adds a property and a method to an existing object in the scripting DOM, kPageItemObjectScriptElement:<div class="fragment"><div class="line">Provider <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"> kYourScriptProviderBoss, <span class="comment">// See Note 2</span></div><div class="line"> {</div><div class="line"> Object{ kPageItemObjectScriptElement }, <span class="comment">// See Note 3</span></div><div class="line"> Method{ kYourMethodScriptElement }, <span class="comment">// See Note 4</span></div><div class="line"> Property{ kYourPropertyScriptElement, kReadOnly }, <span class="comment">// See Note 5</span></div><div class="line"><span class="comment">// See Note 6</span></div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The provider is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>This is the ClassID of the script provider boss that handles the referenced method(s) and property(s).<li>The script object referenced by this field is the object in the scripting DOM to which properties and methods referenced by subsequent fields are added. See Scripting DOM reference for documentation on the script objects provided by the application.<li>The method referenced by this field is added to the script object referenced by the preceding Object field. See Method element.<li>The property referenced by this field is added to the script object referenced by the preceding Object field. See Property element. This also indicates whether the property is read-write or read-only.<li>References to other methods and/or properties handled by this script provider go here.</ol><p>The following is an example of a Provider statement that adds a new script object into the scripting DOM: <div class="fragment"><div class="line">Provider <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"><a class="code" href="classk_document_script_provider_boss.html">kDocumentScriptProviderBoss</a>, <span class="comment">// See Note 2</span></div><div class="line"> {</div><div class="line"> Parent{ kApplicationObjectScriptElement }, <span class="comment">// See Note 3</span></div><div class="line"> RepresentObject{ kDocumentObjectScriptElement }, <span class="comment">// See Note 4</span></div><div class="line"> CollectionMethod{ kCountMethodScriptElement }, <span class="comment">// See Note 5</span></div><div class="line"> CollectionMethod{ kCreateDocumentMethodScriptElement }, <span class="comment">// See Note 6</span></div><div class="line"> Method{ kCloseDocumentMethodScriptElement }, <span class="comment">// See Note 7</span></div><div class="line"> Property{ kNamePropertyScriptElement, kReadOnly }, <span class="comment">// See Note 8</span></div><div class="line"><span class="comment">// See Note 9</span></div><div class="line"> }</div><div class="line">}</div></div><p>Notes:<ol type="1"><li>The provider is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>This is the ClassID of the script provider boss that handles the referenced script object(s), method(s), and property(s).<li>The script object referenced by this field is the parent in the scripting DOM for the new script object referred to by the subsequent RepresentObject field. For documentation on the script objects provided by the application, see Scripting DOM reference.<li>The script object referenced by this field is added to the scripting DOM. Its parent object is defined by a preceding Parent field.<li>The count method referenced by this field is added to the script object referenced by the preceding RepresentObject field. See Special methods.<li>The create method referenced by this field is added to the script object referenced by the proceeding RepresentObject field. See Special methods.<li>The method referenced by this field is added to the script object referenced by the preceding RepresentObject field.<li>The property referenced by this field is added to the script object referenced by the preceding RepresentObject field. This also indicates whether the property is read-write or read-only.<li>Other references to parents, objects, methods, and/or properties handled by this script provider go here.</ol><p><b>Fields in a provider statement</b><p>The types of field that can appear in a Provider statement are listed in the following table. Each field refers to an associated script element (a script object, method, property, or enum) using its ScriptElementID.<table class="doxtable"><tr><th>Field type </th><th>Purpose </th><th>Use </th></tr><tr><td>Object </td><td>The script object referenced by this field is the object in the scripting DOM to which properties and methods referenced by subsequent fields are added. </td><td>Add new properties and methods to an existing script object. </td></tr><tr><td>Method </td><td>The script method referenced by this field is added to the script object referenced by the preceding Object or RepresentObject field. </td><td>Add method to a new or existing script object. </td></tr><tr><td>Property </td><td>The script property referenced by this field is added to the script object referenced by the preceding Object or RepresentObject field. This identifies access rights as kReadOnly, kReadWrite, or kReadOnlyButReadWriteForINX. </td><td>Add property to a new or existing script object. </td></tr><tr><td>Parent </td><td>The script object referenced by this field is a parent in the scripting DOM for the new script object referred to by a subsequent RepresentObject field. </td><td>Add a new script object to the scripting DOM. </td></tr><tr><td>RepresentObject </td><td>The script object referenced by this field is added to the scripting DOM. Its parent object is defined by a presiding Parent field. </td><td>Add a new script object to the scripting DOM. </td></tr><tr><td>ParentProperty </td><td>The script property referenced by this field is added to the script object referred to by a preceding Parent field. </td><td>Provide an accessor in the scripting DOM for a singleton script object. </td></tr><tr><td>CollectionMethod </td><td>A Create script method referenced by this field creates an instance of a script object in a collection. A Count script method referenced by this field counts how many instances exist in the collection. See Special methods. </td><td>Provide access in the scripting DOM for a collection of script objects. Script objects that can exist in a collection are said to have a plural form. For example, the plural form of spread is spreads. </td></tr><tr><td>SurrogateParent </td><td>See Surrogate. </td><td>Deprecated. SurrogateParent is an old mechanism used to avoid INX getting confused about ownership relationships. The preferred approach is to create an INX-specific scripting resource (see &quot;Client-specific scripting resources&quot;) with a Provider statement that uses the kNotSupported script provider. Parent fields added to this Provider statement indicate the parent-child relationship that simply reference an object without any ownership. These parents are ignored by INX, and confusion about owner versus reference relationships is avoided. </td></tr></table><p><b>Surrogate</b><p>A surrogate is a concept that helps INX identify a parent object that does not have an ownership relationship with a child object.<p>In the native InDesign model, a document is stored as a tree of boss objects, each of which is bound to and stored persistently in a database. Each boss object (except the root object) has one boss object (a parent boss object) that refers to it and &quot;owns&quot; it and zero or more boss objects that simply reference it without any ownership.<p>In the scripting DOM, a surrogate indicates a parent-child relationship that does not have an ownership relationship with the underlying boss object. A surrogate simply refers to a child object. If you ask a child in the scripting DOM for its parent, the object you get back is the parent that has the ownership relationship; you do not get a surrogate. For example, a Page object has both a primary parent (a Spread object) and a surrogate parent (the Document object). You can access all pages in a document via the surrogate Document/Page relationship, but if you ask a Page which object is its parent, you always get back a Spread object.<h3><a class="anchor" id="id_suite_element"></a> Suite element</h3><p>A suite element adds a suite script element, which is used by AppleScript to group related script objects together. Each Object statement refers to its associated suite (see Object element). Example: <div class="fragment"><div class="line">Suite <span class="comment">// See Note 1</span></div><div class="line">{</div><div class="line"> kBasicSuiteScriptElement, <span class="comment">// See Note 2</span></div><div class="line"> s_InDesignBasicSuite, <span class="comment">// See Note 3</span></div><div class="line"><span class="stringliteral">&quot;InDesign basics&quot;</span>, <span class="comment">// See Note 4</span></div><div class="line"><span class="stringliteral">&quot;Terms applicable to many InDesign operations&quot;</span>, <span class="comment">// See Note 5</span></div><div class="line">}</div></div><ol type="1"><li>The suite is defined within a VersionedScriptElementInfo resource (see VersionedScriptElementInfo resource).<li>Suite&#39;s ScriptElementID (see ScriptElementIDs).<li>Suite&#39;s ScriptID (see ScriptIDs).<li>Suite&#39;s name (see Names).<li>Suite&#39;s description (see Descriptions).</ol><p>The ScriptElementIDs for common suites are defined in <a class="el" href="_scripting_i_d_8h_source.html">ScriptingID.h</a> (for example, see kBasicSuiteScriptElement).<h3><a class="anchor" id="id_scriptelementids_scriptids_names_descriptions_and_guids"></a> ScriptElementIDs, ScriptIDs, names, descriptions, and GUIDs</h3><p>The scripting DOM is made up of script elements. A script element is a script object, script method, script property, script enum, or script suite. Each script element has two identifiers, a ScriptElementID and a ScriptID, together with a name and a description. Script objects also require one or more GUIDs.<p><b>ScriptElementIDs</b><p>A ScriptElementID is a kScriptInfoIDSpace ID, an object model identifier based on a plug-in prefix in the same way as the IDs for boss classes, interfaces, and implementations. These IDs are defined in the ID.h file of the plug-in that adds the script element to the scripting DOM. For example, kSpreadObjectScriptElement, the ID for the spread script object, is defined in <a class="el" href="_spread_i_d_8h_source.html">SpreadID.h</a>.<p><b>ScriptIDs</b><p>A ScriptID is a four-character identifier for a script element. For example, &quot;sprd&quot; is the ScriptID for a spread. Most ScriptIDs in the scripting DOM supplied by the application are defined in the &lt;SDK&gt;/source/public/includes/ScriptingDefs.h header file.<dl class="section note"><dt>Note<dd>New ScriptIDs introduced by your plug-in must be registered with Adobe to prevent clashes with other plugins. See ScriptID/name registration.</dl><p><b>Names</b><p>The name field(s) in an Object, Method, Property, or Enum statement should contain a lowercase string, using a space to delimit the parts of the name (for example, &quot;graphic layer&quot; or &quot;text frame&quot;). Optionally, you can force uppercase for an acronym (for example, &quot;URL&quot;) or product name (for example, &quot;InDesign basics&quot;).<dl class="section note"><dt>Note<dd>New names introduced by your plug-in must be registered with Adobe to prevent clashes with other plugins. See ScriptID/name registration.</dl><p><b>Descriptions</b><p>The string in the description field(s) of an Object, Method, Property, or Enum statement should be sentence case (that is, initial word capitalized), with no closing punctuation, unless the description is more than one sentence long, in which case all sentences except the last should have closing punctuation.<p><b>Object-sensitive descriptions</b><p>This option is particularly useful for methods and properties that appear on multiple script objects.<p>Often, it makes sense for the description field(s) of a method or property element to contain the name of the script object on which the method or property is exposed. For example, consider an object named &quot;swatch&quot;:<ul><li>Description of the name property: &quot;The name of the swatch&quot;.<li>Description of the count method: &quot;The number of swatches&quot;.<li>Description of the return value for the create method: &quot;The new swatch&quot;.</ul><p>By using ^Object for the singular form and ^Objects for the plural form, the name of the relevant object is substituted at run time. For example:<ul><li>Description of the name property: &quot;The name of the ^Object&quot;.<li>Description of the count method: &quot;The number of ^Objects&quot;.<li>Description of the return value for the create method: &quot;The new ^Object&quot;.</ul><p><b>GUIDs</b><p>A GUID is a Windows ID that allows COM to interact with the script manager. GUIDs are generated on Windows using the Microsoft GUID generator GUIDGEN.EXE.<p>Adding a singleton script object to the scripting DOM requires a GUID. Adding a script object that has a plural form requires two GUIDs (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_object_element">Object element</a>).<dl class="section note"><dt>Note<dd>If your plug-in is scriptable only on Mac OS, you can opt to use kInvalid_CLSID (see header <a class="el" href="_g_u_i_d_8h_source.html">Guid.h</a>); however, we recommend that you generate GUIDs for your script objects.<dd> For more information about UUID, see <a href="http://en.wikipedia.org/wiki/Universally_unique_identifier">http://en.wikipedia.org/wiki/Universally_unique_identifier</a> .</dl><p>The following is a sample GUID declaration:<div class="fragment"><div class="line"><span class="preprocessor">#define kDocument_CLSID { 0x1a5e8db4, 0x3443, 0x11d1, { 0x80, 0x3c, 0x0, 0x60, 0xb0, 0x3c, 0x2, 0xe4 } } </span></div></div><p>If you need to access the GUID from C++ code in your plug-in, you must declare the GUID, as shown in the following example. Normally this is not necessary in the course of making a plug-in scriptable.<div class="fragment"><div class="line">DECLARE_GUID( Document_CLSID, kDocument_CLSID );</div></div><p><b>Scripting ID naming idioms</b><p>The following table lists the ScriptID and ScriptElementID naming idioms:<table class="doxtable"><tr><th>Script element </th><th>ScriptID prefix </th><th>ScriptElementID </th><th>Examples </th></tr><tr><td>Object </td><td>c_ </td><td>kXxxObjectScriptElement </td><td>c_Spread, kSpreadObjectScriptElement </td></tr><tr><td>Method </td><td>e_ </td><td>kXxxMethodScriptElement </td><td>e_Open, kOpenMethodScriptElement </td></tr><tr><td>Method parameter </td><td>p_ </td><td>not required </td><td>p_ShowInWindow </td></tr><tr><td>Property </td><td>p_ </td><td>kXxxPropertyScriptElement </td><td>p_LineWeight, kStrokeWeightPropertyScriptElement </td></tr><tr><td>Enum </td><td>en_ </td><td>kXxxEnumScriptElement </td><td>en_FitContentOptions, kFitContentOptionEnumScriptElement </td></tr><tr><td>Suite </td><td>s_ </td><td>kXxxSuiteScriptElement </td><td>s_TableSuite, kTableSuiteScriptElement </td></tr></table><p><b>Source-file organization</b><p>The current SDK sample organization of source files for scripting IDs is as follows. For the referenced sample files, see &lt;SDK&gt;/source/sdksamples/basicpersistinterface:<ul><li>Define ScriptElementIDs for your script elements in your plug-in&#39;s ID.h file (for example, kBPIPrefObjectScriptElement in <a class="el" href="_b_p_i_i_d_8h_source.html">BPIID.h</a>). The recommended style is to group identifiers by element type (objects, methods, properties, and so on). See the following example for a template that you can use in your ID.h file.<li>Define ScriptIDs in your plug-in&#39;s <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a> file (for example, <a class="el" href="_b_p_i_scripting_defs_8h_source.html">BPIScriptingDefs.h</a>).<li>If you are adding new objects to the scripting DOM, define Windows GUIDs in your plug-in&#39;s <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a> file (for example, kBPIPref_CLSID in <a class="el" href="_b_p_i_scripting_defs_8h_source.html">BPIScriptingDefs.h</a>). See GUIDs.</ul><dl class="section note"><dt>Note<dd>In a future SDK release, it is likely that ScriptIDs and GUIDs will be consolidated in the plug-in&#39;s ID.h file.</dl><div class="fragment"><div class="line"><span class="comment">//Script Element IDs</span></div><div class="line"><span class="comment">//Suites</span></div><div class="line">DECLARE_PMID(kScriptInfoIDSpace, k???SuiteScriptElement, k???Prefix + 1)</div><div class="line"><span class="comment">//Objects</span></div><div class="line">DECLARE_PMID(kScriptInfoIDSpace, k???ObjectScriptElement, k???Prefix + 40)</div><div class="line"><span class="comment">//Methods</span></div><div class="line">DECLARE_PMID(kScriptInfoIDSpace, k???MethodScriptElement, k???Prefix + 80)</div><div class="line"><span class="comment">//Properties</span></div><div class="line">DECLARE_PMID(kScriptInfoIDSpace, k???PropertyScriptElement,k???Prefix + 140)</div><div class="line"><span class="comment">//Enums</span></div><div class="line">DECLARE_PMID(kScriptInfoIDSpace, k???EnumScriptElement, k???Prefix + 220)</div></div><h3><a class="anchor" id=""></a></h3><p>This section discusses the scenarios in which plug-in developers need to extend the scripting DOM, and how ScriptIDs and names, referred to as ScriptID/name pairs, are managed.<p>When you add a new script element (script object, method, property, or enum) to the scripting DOM, the element has a ScriptID and a name (see ScriptIDs) and &quot;Names&quot;). The ScriptID and name are treated as a pair and must be used together. When you need a new ScriptID/name pair, you must register them with Adobe, to avoid conflicts with other plug-ins.<p>If you are unsure whether you need to register a ScriptID/name pair for the elements you want to add to the scripting DOM, always do the safe thing. Register a new unique ScriptID/name pair.<p>After you register ScriptID/name pairs, use them consistently in your code:<ul><li>If you allocate a pair to identify a script object (for example,&acirc;&#128;&#152;myob&#39;/&quot;my object&quot;), always use this pair to identify this type of script object.<li>If you allocate a pair to identify a method (for example, &acirc;&#128;&#152;myme&#39;/&quot;my method&quot;), always use this pair to identify this method.<li>If you allocate a pair to identify a property (for example, &acirc;&#128;&#152;mypr&#39;/&quot;my property&quot;), always use this pair to identify this type of property.<li>Follow this consistency rule with the ScriptID/name pairs that you register for other kinds of script elements.</ul><p><b>ScriptID/name registration process</b><p>The earlier online ScriptID/name pair system has been decommissioned and a new system is being built. In the interim, developers can still register the ScriptID/name pairs they need by sending the following information to <a href="#" onclick="location.href=&#39;mai&#39;+&#39;lto:&#39;+&#39;wwd&#39;+&#39;s@&#39;+&#39;ado&#39;+&#39;be&#39;+&#39;.co&#39;+&#39;m&#39;; return false;">wwds@<span style="display: none;">.nosp@m.</span>adob<span style="display: none;">.nosp@m.</span>e.com</a>:<ul><li>Your name:<li>Your company:<li>Your Adobe ID:<li>List of scriptID/Name pairs to be registered</ul><p>The following scenarios indicate situations in which a new ScriptID/name pair is needed. Do not use an arbitrarily chosen ScriptID/name pair as a new ScriptID/name pair. If the ScriptID/name pair you want is already registered, you must choose and register an alternative. Follow the procedures outlined in the following scenarios.<p>All plug-in developers must check for ScriptID/name pair conflicts with Adobe plug-ins, by loading their plug-in under the debug build of the application, having deleted the application&#39;s SavedData file before launching. If conflicts are detected, asserts are raised on start-up. Developers must change their scripting resources to fix any conflicts and be able to start the application without asserts.<p>Reserved words in each scripting language (that do not yet have any corresponding IDs) are prepopulated in the ScriptID/name pair database with arbitrarily chosen IDs.<dl class="section note"><dt>Note<dd>Adobe-registered ScriptID/name pairs for InDesign are documented in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom_reference">Scripting DOM reference</a>.</dl><p><b>Adding a new script object</b><ol type="1"><li>Choose the ScriptID/Name pairs for your script object. If your object has a collection, you need two pairs; the second pair is for the collection. If your object is a singleton, you need only one pair for the object; however, you need a second pair for a new property, to expose your new object on its parent or parents.<li>Make your plug-in scriptable, then test against the debug application build and resolve any conflicts with Adobe-registered ScriptID/name pairs.<li>Register the new, unique ScriptID/name pairs as mentioned above. Conflicts with any other third-party developers&#39; objects are mitigated by this registration.</ol><p><b>Adding a new property or method to an Adobe script object</b><p>You can add a new property or method to the application or document script object (kApplicationObjectScriptElement or kDocumentObjectScriptElement). To do so:<ol type="1"><li>Choose the ScriptID/Name pair for your property or method.<li>Make your plug-in scriptable, then test against the debug application build and resolve any conflicts with Adobe-registered ScriptID/name pairs.<li>Register the new, unique ScriptID/name pairs as mentioned above. Conflicts with any other third-party developers&#39; properties/methods are mitigated by this registration.</ol><p><b>Adding a new suite or enum</b><ul><li>Choose the ScriptID/Name pairs for your suite or enum.<li>Make your plug-in scriptable, then test against the debug application build and resolve any conflicts with Adobe-registered ScriptID/Name pairs.<li>Register the new, unique ScriptID/Name pairs as mentioned above. Conflicts with any other third party developers&#39; suites/enums are avoided by this registration.</ul><p><b>Adding a new property or method to an Adobe script object using an Adobe ScriptID/name pair</b><p>Suppose you want to add Adobe&#39;s name property (kNamePropertyScriptElement) to the page-item script object (kPageItemObjectScriptElement). In this example, the ScriptID/name pair is &acirc;&#128;&#152;pnam&#39;/&quot;name&quot; and is registered by Adobe.<dl class="section note"><dt>Note<dd>Do not under any circumstances do this. If you do this, you are creating a potential conflict should the same ScriptID/name pair be added by another developer.</dl><p>Never use Adobe-registered ScriptID/name pairs to add elements to Adobe script objects. Instead, register your own ScriptID/name pair for any new element you add to an Adobe script object. See Adding a new property or method to an Adobe script object.<dl class="section note"><dt>Note<dd>If you ignore this guideline, you risk conflict with other parties, and someone will have to give in. Adobe will not mediate such disputes.</dl><p>You can reuse an Adobe-registered ScriptID/name pair in your own script object. This is required if you are overriding a method or property in any base script object provided by Adobe. When adding your new object, follow the guidelines in Adding a new script object.<p>If you already registered the ScriptID/name pair for your element, this scenario does not apply to you: you are not reusing an Adobe ScriptID/name pair). In this situation, the only party you can clash with is yourself, so the resolution is under your control.<h3><a class="anchor" id="id_scripting_data_types"></a> Scripting data types</h3><p>The data types that can appear in Property and Method statements are listed in the following table. These types are defined as ODFRC macros in &lt;SDK&gt;/source/public/Includes/ScriptInfoTypes.fh. A table key follows:<ul><li>default - A value-type macro of the desired type<li>enum_id - The ScriptElementID of an enum.<li>length - The number of items in the array. If it varies, use kVariableLength.<li>min, max, default - A value of the relevant type<li>object_id - The ScriptElementID of an object.<li>struct_type_list - A list of two or more StructField&#39;s separated by commas. A StructField consists of a field name (string) and (non-Void) type.<li>typedef_id - A valid ScriptElementID of a typedef.<li>variable_type_list - A list of one or more basic types separated by commas.</ul><table class="doxtable"><tr><th>ODFRC type </th><th>Description </th><th>ODL type </th><th>AETE type </th></tr><tr><td>VoidType </td><td>Void </td><td>void </td><td>typeNull </td></tr><tr><td>Int16Type </td><td>Short integer </td><td>short </td><td>typeShortInteger </td></tr><tr><td>Int16DefaultType (default) </td><td>Default short Integer </td><td>short </td><td>typeShortInteger </td></tr><tr><td>Int16MinMaxType (min, max) </td><td>Short integer range </td><td>short </td><td>typeShortInteger </td></tr><tr><td>Int16MinMaxDefaultType (min, max, default) </td><td>Default short integer range </td><td>short </td><td>typeShortInteger </td></tr><tr><td>Int32Type </td><td>Long integer </td><td>long </td><td>typeLongInteger </td></tr><tr><td>Int32DefaultType (default) </td><td>Default long Integer </td><td>long </td><td>typeLongInteger </td></tr><tr><td>Int32MinMaxType (min, max) </td><td>Long integer range </td><td>long </td><td>typeLongInteger </td></tr><tr><td>Int32MinMaxDefaultType (min, max, default) </td><td>Default long integer range </td><td>long </td><td>typeLongInteger </td></tr><tr><td>BoolType </td><td>Boolean </td><td>VARIANT_BOOL </td><td>typeBoolean </td></tr><tr><td>BoolDefaultType (default) </td><td>Default Boolean </td><td>VARIANT_BOOL </td><td>typeBoolean </td></tr><tr><td>StringType </td><td>String </td><td>BSTR </td><td>typeChar </td></tr><tr><td>StringDefaultType (default) </td><td>Default string </td><td>BSTR </td><td>typeChar </td></tr><tr><td>UnitType </td><td>Measurement unit </td><td>VARIANT </td><td>cFixed </td></tr><tr><td>UnitDefaultType (default) </td><td>Default measurement unit </td><td>VARIANT </td><td>cFixed </td></tr><tr><td>UnitMinMaxType (min, max) </td><td>Measurement unit range </td><td>VARIANT </td><td>cFixed </td></tr><tr><td>UnitMinMaxDefaultType (min, max, default) </td><td>Default measurement unit range </td><td>VARIANT </td><td>cFixed </td></tr><tr><td>RealType </td><td>Real number </td><td>double </td><td>cFixed </td></tr><tr><td>RealDefaultType (default) </td><td>Default real number </td><td>double </td><td>cFixed </td></tr><tr><td>RealMinMaxType (min, max) </td><td>Real number range </td><td>double </td><td>cFixed </td></tr><tr><td>RealMinMaxDefaultType (min, max, default) </td><td>Default real number range </td><td>double </td><td>cFixed </td></tr><tr><td>DateType </td><td>Date or Time </td><td>DATE </td><td>typeLongDateTime </td></tr><tr><td>FileType </td><td>File name or path </td><td>BSTR or VARIANT </td><td>typeAlias </td></tr><tr><td>KeyStringDefaultType (default) </td><td>Key string (untranslated version of a translatable string) </td><td>BSTR </td><td>typeChar </td></tr><tr><td>EnumType (enum_id) </td><td>Enum </td><td>enum&#39;s name </td><td>enum&#39;s ScriptID </td></tr><tr><td>EnumDefaultType (enum_id, default) </td><td>Default enum </td><td>enum&#39;s name </td><td>enum&#39;s ScriptID </td></tr><tr><td>ObjectType (object_id) </td><td>Object </td><td>IDispatch* </td><td>cObjectSpecifier </td></tr><tr><td>Int16ArrayType (length) </td><td>Array of short integers </td><td>VARIANT </td><td>typeShortInteger (listOfItems) </td></tr><tr><td>Int16MinMaxArrayType (length, min, max) </td><td>Array of short integer ranges </td><td>VARIANT </td><td>typeShortInteger (listOfItems) </td></tr><tr><td>Int32ArrayType (length) </td><td>Array of long integers </td><td>VARIANT </td><td>typeLongInteger (listOfItems) </td></tr><tr><td>Int32MinMaxArrayType (length, min, max) </td><td>Array of long integer ranges </td><td>VARIANT </td><td>typeLongInteger (listOfItems) </td></tr><tr><td>BoolArrayType (length) </td><td>Array of Booleans </td><td>VARIANT </td><td>typeBoolean (listOfItems) </td></tr><tr><td>StringArrayType (length) </td><td>Array of strings </td><td>VARIANT </td><td>typeChar (listOfItems) </td></tr><tr><td>UnitArrayType (length) </td><td>Array of measurement units </td><td>VARIANT </td><td>cFixed (listOfItems) </td></tr><tr><td>UnitMinMaxArrayType (length, min, max) </td><td>Array of measurement unit ranges </td><td>VARIANT </td><td>cFixed (listOfItems) </td></tr><tr><td>RealArrayType (length) </td><td>Array of real numbers </td><td>VARIANT </td><td>cFixed (listOfItems) </td></tr><tr><td>RealMinMaxArrayType (length, min, max) </td><td>Array of real number ranges </td><td>VARIANT </td><td>cFixed (listOfItems) </td></tr><tr><td>DateArrayType (length) </td><td>Array of dates/times </td><td>VARIANT </td><td>typeLongDateTime (listOfItems) </td></tr><tr><td>FileArrayType (length) </td><td>Array of file names/paths </td><td>VARIANT </td><td>typeAlias (listOfItems) </td></tr><tr><td>EnumArrayType (enum_id), length) </td><td>Array of enum values </td><td>VARIANT </td><td>enum&#39;s ScriptID (listOfItems) </td></tr><tr><td>ObjectArrayType (object_id, length) </td><td>Array of objects </td><td>IDispatch* </td><td>cObjectSpecifier (listOfItems) </td></tr><tr><td>RecordType </td><td>List of key/value pairs </td><td>VARIANT </td><td>typeAERecord </td></tr><tr><td>StructType {struct_type_list} </td><td>Structure </td><td>VARIANT </td><td>typeWildCard </td></tr><tr><td>StructArrayType (length) {struct_type_list} </td><td>Array of structures </td><td>VARIANT </td><td>typeWildCard </td></tr><tr><td>TypeDefType(typedef_id) </td><td>Type definition </td><td>(defined type is substituted) </td><td>(defined type is substituted) </td></tr><tr><td>TypeDefArrayType(typedef_id, length) </td><td>Array of type definitions </td><td>(defined type is substituted) </td><td>(defined type is substituted) </td></tr><tr><td>VariableType {variable_type_list} </td><td>Variable </td><td>VARIANT </td><td>typeWildCard </td></tr><tr><td>VariableDefaultType default, {variable_type_list} </td><td>Variable with default </td><td>VARIANT </td><td>typeWildCard </td></tr><tr><td>VariableArrayType (length) {variable_type_list} </td><td>Array of variable contents </td><td>VARIANT </td><td>typeWildCard (listOfItems) </td></tr></table><p><b>VariableType examples</b><table class="doxtable"><tr><th>Example </th><th>Description </th></tr><tr><td>VariableType{ FileType, FileArrayType( kVariableLength ) } </td><td>A single file or an array of files. </td></tr><tr><td>VariableType{ ObjectType( kPageItemObjectScriptElement ), ObjectArrayType( kPageItemObjectScriptElement, kVariableLength )} </td><td>A single page item or an array of page items. </td></tr><tr><td>VariableType{ StringType, EnumType( kNothingEnumScriptElement ) } </td><td>A string or the enumeration &quot;none.&quot; </td></tr><tr><td>VariableType{ EnumType( kAnchorPointEnumScriptElement ), UnitArrayType(2) } </td><td>An anchor point enumeration or an array of two unit values (that is, a measurement point). </td></tr><tr><td>VariableType{ ObjectType( kSwatchObjectScriptElement ), StringType } </td><td>A swatch object or a string (that is, the name of the swatch). </td></tr><tr><td>VariableDefaultType StringValue( &quot;None&quot; ), { StringType, FileType } </td><td>A string or file (defaults to the string &quot;None&quot;). </td></tr><tr><td>VariableArrayType( kVariableLength ) { ObjectType( kPageItemObjectScriptElement ),ObjectType( kImageObjectScriptElement ), ObjectType( kEPSObjectScriptElement ), ObjectType( kPDFObjectScriptElement ) } </td><td>An array of one or more page items, images, EPS files, and/or PDF files. </td></tr></table><p><b>Object-sensitive types</b><p>Object-sensitive types are useful for methods and properties that appear on multiple script objects. In such cases, it makes sense for the type of a property or the return type of a method to be the type of the script object on which the method or property is exposed. A field containing ObjectType( kContainerObjectScriptElement ) is used to indicate this. For example, the create method that can be reused by new script objects uses it as shown in the following example:<p>Using ObjectType( kContainerObjectScriptElement ) to define a method that returns the type of the script object on which it is exposed:<div class="fragment"><div class="line">Method</div><div class="line">{</div><div class="line"> kCreateMethodScriptElement,</div><div class="line"> e_Create,</div><div class="line"><span class="stringliteral">&quot;add&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Create a new ^Object&quot;</span>,</div><div class="line"> ObjectType( kContainerObjectScriptElement ),</div><div class="line"><span class="stringliteral">&quot;The new ^Object&quot;</span>,</div><div class="line"> {</div><div class="line"> WITHPROPERTIESPARAM,</div><div class="line"> }</div><div class="line">}</div></div><p>The ObjectType( kContainerObjectScriptElement ) is commonly used by:<ul><li>The type of the AppleScript object reference property.<li>The type of the object returned by a create or duplicate method.<li>The type of a parameter to the move method.</ul><p>Less often, a property or method parameter may have the type of the parent script object. For these cases, use ObjectType( kContainerParentScriptElement ) as the type. Example:<div class="fragment"><div class="line">Property</div><div class="line">{</div><div class="line"> kParentPropertyScriptElement,</div><div class="line"> p_Parent,</div><div class="line"><span class="stringliteral">&quot;parent&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;The ^Object&#39;s parent&quot;</span>,</div><div class="line"> ObjectType(kContainerParentScriptElement),</div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line">}</div></div><p>The ObjectType(kContainerParentScriptElement) is used by:<ul><li>The type of the parent property.<li>The type of the reference parameter to a move, duplicate, or create method.</ul><p><b>Record type</b><p>A &quot;record&quot; is a list of key/value pairs, where the key is the ScriptID of a property and the value is any appropriate one for that property. A RecordType declaration takes an object_id, which is the ScriptElementID of the object to which the properties in the record apply. For example:<ul><li>RecordType( kDocumentMethodScriptElement ) indicates that the keys in the record correspond to properties of the document object.<li>Furthermore, you can use an object-sensitive type like RecordType(kContainerObjectScriptElement). In a property resource, this indicates that the keys correspond to properties on the object that contains the property; in a method&#39;s parameter resource, this indicates that they correspond to properties on the object that contains the method.</ul><h3><a class="anchor" id="id_script-object_inheritance"></a> Script-object inheritance</h3><p>Script-object inheritance is what you use to construct specialized script objects from existing ones. If one script object is based on another, it inherits the base object&#39;s methods and properties. It does not inherit its parents, children/collections, or collection methods. The root of the script-object inheritance hierarchy is kAnyObjectScriptElement.<p>A script object is based on another by specifying the base object in its Object statement (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_object_element">Object element</a>). Normally, a new script object is based on one of the base script objects shown in the following table:<table class="doxtable"><tr><th>ScriptElementID </th><th>Description </th><th>Based on </th></tr><tr><td>kNonIDBasedObjectScriptElement </td><td>A non-ID-based script object. A proxy object in scripting. The text script objects that represent character, word, and line, for example. </td><td>kAnyObjectScriptElement </td></tr><tr><td>kNonUniqueIDBasedObjectScriptElement </td><td>A nonunique-ID-based script object. A script object that exposes a scriptable boss that has an ID of some sort but not a UID for example, table cells. </td><td>kAnyObjectScriptElement </td></tr><tr><td>kPreferencesObjectScriptElement </td><td>A script object that exposes preferences. </td><td>kNonIDBasedObjectScriptElement </td></tr><tr><td>kUniqueIDBasedObjectScriptElement </td><td>A unique-ID-based script object. A script object that exposes a scriptable boss that has a UID. </td><td>kAnyObjectScriptElement </td></tr></table><p>A new script object also can be based on an existing script object. The script object that represents page items is kPageItemObjectScriptElement, as shown in the following example.<div class="fragment"><div class="line">Object</div><div class="line">{</div><div class="line"> kPageItemObjectScriptElement,</div><div class="line"> c_PageItem,</div><div class="line"><span class="stringliteral">&quot;page item&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;An item on a page, including rectangles, ellipses...&quot;</span>,</div><div class="line"> kPageItem_CLSID,</div><div class="line"> c_PageItems,</div><div class="line"><span class="stringliteral">&quot;The page items collection ...&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;All page items&quot;</span>,</div><div class="line"> kPageItems_CLSID,</div><div class="line"> kUniqueIDBasedObjectScriptElement,</div><div class="line"> kLayoutSuiteScriptElement,</div><div class="line">}</div></div><p>An oval is a kind of page item, so it is based on kPageItemObjectScriptElement, as shown in the following example:<div class="fragment"><div class="line">Object</div><div class="line">{</div><div class="line"> kOvalObjectScriptElement,</div><div class="line"> c_Oval,</div><div class="line"><span class="stringliteral">&quot;oval&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;An ellipse&quot;</span>,</div><div class="line"> kOval_CLSID,</div><div class="line"> c_Ovals,</div><div class="line"><span class="stringliteral">&quot;ovals&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;A collection of ellipses&quot;</span>,</div><div class="line"> kOvals_CLSID,</div><div class="line"> kPageItemObjectScriptElement, <span class="comment">// Script object inheritance</span></div><div class="line"> kLayoutSuiteScriptElement,</div><div class="line">}</div></div><dl class="section note"><dt>Note<dd>Basing a script object on another implies that a collection of the base objects (for example, a spread&#39;s collection of page items) automatically includes any existing subclass objects (for example, the spread&#39;s ovals). This is a requirement for the IDML file format and programmatically depends on the implementation of the <a class="el" href="class_i_script_provider.html#ad9553d160869f7130093808e5fb219af">IScriptProvider::GetObject</a> methods for the base object&#39;s collection.</dl><h3><a class="anchor" id="id_overloading_an_existing_method_or_property"></a> Overloading an existing method or property</h3><p>Two script objects can have the same property or method, but with a slightly different definition. For example, the descriptions, types of the property, or parameters of the method may differ. In this case, you must define a unique ScriptElementID for each resource. The name and ScriptID must be identical in both resources. Other information (description, type, parameters, etc.) may be identical or different.<h3><a class="anchor" id="id_versioning_of_scripting_resources"></a> Versioning of scripting resources</h3><p>The following sections describe how to work with versioning in the scripting DOM (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_versioning_the_scripting_dom">Versioning the scripting DOM</a>).<p><b>Versioned resources</b><p>Scripting resources include data for the first and last version of each script element. This data may be altered on an element-by-element basis.<p><b>Adding a new resource</b><p>New script elements (objects, properties, methods, etc.) are added to the scripting DOM using a VersionedScriptElementInfo statement. For the version information, specify the first version of InDesign for which the contained elements are applicable. The version information is called the context for the elements. Example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 4010 ){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"><span class="comment">//The contained elements are exposed beginning in InDesign CS2</span></div><div class="line"> kCS2ScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"><span class="comment">// Object, Method, Property, Enum and Provider statements go here</span></div><div class="line"> }</div><div class="line">} ;</div></div><p>VersionedScriptElementInfo resources can accommodate multiple contexts. Example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 4010 ){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"><span class="comment">//The contained elements are only relevant to the Roman feature set in </span></div><div class="line"><span class="comment">//InDesign</span></div><div class="line"> kCCScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kInDesignRomanFS,</div><div class="line"> k_Wild,</div><div class="line"><span class="comment">//but are exposed for all feature sets in the InDesign Server product</span></div><div class="line"> kCCScriptVersion, kCoreScriptManagerBoss,</div><div class="line"> kInDesignServerAllLanguagesFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> ...</div><div class="line"> }</div><div class="line">} ;</div></div><p><b>Specifying an obsolete element</b><p>To designate an existing resource as obsolete (that is, no longer part of the scripting DOM as of the current version), add &quot;Obsolete&quot; to the beginning of the keyword for the type of element (for example, ObsoleteSuite, ObsoleteObject, ObsoleteProperty, etc.) in the existing resource. Also, add version information to specify the first version of InDesign for which the element is no longer applicable. If you are removing a resource (rather than revising it), do not forget to also obsolete the relevant Provider resource.<p>Removing a script element from the scripting DOM:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 20 ) <span class="comment">//An existing resource</span></div><div class="line">{</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"><span class="comment">//The contained elements were exposed by InDesign CS1</span></div><div class="line"> kCS1ScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> ObsoleteProperty</div><div class="line"> {</div><div class="line"> kCCScriptVersion, <span class="comment">//This element is no longer exposed as of CC</span></div><div class="line"> kOldInfoPropertyScriptElement,</div><div class="line"> p_OldInfo,</div><div class="line"><span class="stringliteral">&quot;some old info&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Information no longer relevant after Cobalt&quot;</span>,</div><div class="line"> StringType,</div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line"> }</div><div class="line"> ObsoleteProvider</div><div class="line"> {</div><div class="line"> kCCScriptVersion, <span class="comment">//This element is not exposed as of CC</span></div><div class="line"><a class="code" href="classk_application_script_provider_boss.html">kApplicationScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kApplicationObjectScriptElement },</div><div class="line"> Property{ kOldInfoPropertyScriptElement, kReadWrite },</div><div class="line"> }</div><div class="line"> } ... <span class="comment">//Other, unaffected elements may remain in this resource</span></div><div class="line"> }</div><div class="line">} ;</div></div><p><b>Splitting a provider resource</b><p>If the property is only one of many on an object that is being obsoleted, you must pull it out into a new ObsoleteProvider resource, rather than obsoleting the entire provider. For example, this code shows an existing resource with two properties, Foo and Bar.<div class="fragment"><div class="line">Provider{</div><div class="line"><a class="code" href="classk_application_script_provider_boss.html">kApplicationScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kApplicationObjectScriptElement },</div><div class="line"> Property{ kFooPropertyScriptElement, kReadWrite },</div><div class="line"> Property{ kBarPropertyScriptElement, kReadWrite },</div><div class="line"> }</div><div class="line">}</div></div><p>The following example shows what the resources would look like after making the Foo property obsolete:<div class="fragment"><div class="line">Provider{</div><div class="line"><a class="code" href="classk_application_script_provider_boss.html">kApplicationScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kApplicationObjectScriptElement },</div><div class="line"> Property{ kBarPropertyScriptElement, kReadWrite }, <span class="comment">//This property is NOT obsolete</span></div><div class="line"> }</div><div class="line">}</div><div class="line">ObsoleteProvider{</div><div class="line"> kCCScriptVersion, <span class="comment">//This element is not exposed as of CC</span></div><div class="line"><a class="code" href="classk_application_script_provider_boss.html">kApplicationScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kApplicationObjectScriptElement },</div><div class="line"> Property{ kFooPropertyScriptElement, kReadWrite }, <span class="comment">//This property is obsolete</span></div><div class="line"> }</div><div class="line">}</div></div><p><b>Changing an existing property</b><p>To change an existing property:<ol type="1"><li>Indicate that the existing definition is obsolete.<li>Create a revised definition in a new VersionedScriptElementInfo statement.</ol><p>The following example shows the existing resource before any changes: <div class="fragment"><div class="line">resource VersionedScriptElementInfo( 10 ){</div><div class="line"><span class="comment">//Context</span></div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> Property</div><div class="line"> {</div><div class="line"> kTolerancePropertyScriptElement, </div><div class="line"> p_Tolerance, </div><div class="line"><span class="stringliteral">&quot;tolerance&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;Tolerance&quot;</span>,</div><div class="line"> Int32Type,</div><div class="line"> {} </div><div class="line"> kNoAttributeClass,</div><div class="line"> } </div><div class="line"> ... <span class="comment">//Other elements</span></div><div class="line"> }</div><div class="line">};</div></div><p>The following example shows the existing resource after making it obsolete (in the existing .fr file):<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 10 ){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> ObsoleteProperty <span class="comment">//Change type to RealType for CS2</span></div><div class="line"> {</div><div class="line"> kCS2ScriptVersion,</div><div class="line"> kTolerancePropertyScriptElement, </div><div class="line"> p_Tolerance, </div><div class="line"><span class="stringliteral">&quot;tolerance&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;Tolerance&quot;</span>, </div><div class="line"> Int32Type,</div><div class="line"> {} </div><div class="line"> kNoAttributeClass,</div><div class="line"> } </div><div class="line"> ... <span class="comment">//Other, unchanged elements that remain exposed &quot;as is&quot; in CS2 </span></div><div class="line"> }</div><div class="line">} ;</div></div><p>The following example shows the new, corrected resource (in a new _90.fr file):<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 9010 ){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kCCScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> Property <span class="comment">//Change type to RealType for CS2</span></div><div class="line"> { </div><div class="line"> kTolerancePropertyScriptElement, </div><div class="line"> p_Tolerance, </div><div class="line"><span class="stringliteral">&quot;tolerance&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;Tolerance&quot;</span>, </div><div class="line"> RealType,</div><div class="line"> {} </div><div class="line"> kNoAttributeClass,</div><div class="line"> } </div><div class="line"> }</div><div class="line">} ;</div></div><p><b>Changing an existing method</b><p>To change an existing method:<ol type="1"><li>Indicate that the existing definition is obsolete.<li>Create a revised definition in a new VersionedScriptElementInfo statement.</ol><p>The following example shows the statement that defines the method before any changes:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 200 ){ </div><div class="line"><span class="comment">//Contexts </span></div><div class="line"> { </div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"> Method</div><div class="line"> {</div><div class="line"> kDeleteSwatchMethodScriptElement,</div><div class="line"> e_Delete,</div><div class="line"><span class="stringliteral">&quot;delete&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Delete swatch&quot;</span>,</div><div class="line"> VoidType,</div><div class="line"> {</div><div class="line"> p_Replace, <span class="stringliteral">&quot;replacing with&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;The swatch to apply in place of this one&quot;</span>, </div><div class="line"> ObjectType( kSwatchObjectScriptElement ), kRequired,</div><div class="line"> }</div><div class="line"> }</div><div class="line"> ... <span class="comment">//Other elements</span></div><div class="line"> }</div><div class="line">} ;</div></div><p>The statement is edited in the existing .fr file, to indicate that the existing definition is obsolete (see Specifying an obsolete element). Example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 200 ){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> ObsoleteMethod</div><div class="line"> {</div><div class="line"> kCS2ScriptVersion,</div><div class="line"> kDeleteSwatchMethodScriptElement,</div><div class="line"> e_Delete,</div><div class="line"><span class="stringliteral">&quot;delete&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Delete swatch&quot;</span>,</div><div class="line"> VoidType,</div><div class="line"> {</div><div class="line"> p_Replace, <span class="stringliteral">&quot;replacing with&quot;</span>, <span class="stringliteral">&quot;The swatch to apply in place of this one&quot;</span>, ObjectType( kSwatchObjectScriptElement ), kRequired,</div><div class="line"> }</div><div class="line"> }</div><div class="line"> ... <span class="comment">//Other, unchanged elements that remain exposed &quot;as is&quot; in InDesign CC</span></div><div class="line"> }</div><div class="line">} ;</div></div><p>A new VersionedScriptElementInfo statement (in a new _90.fr file) is used to define the change. Example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 90200 ) { </div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kCCScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> Method </div><div class="line"> {</div><div class="line"> kDeleteSwatchMethodScriptElement,</div><div class="line"> e_Delete,</div><div class="line"><span class="stringliteral">&quot;delete&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Delete swatch&quot;</span>,</div><div class="line"> VoidType,</div><div class="line"> {</div><div class="line"> p_Replace, <span class="stringliteral">&quot;replacing with&quot;</span>, <span class="stringliteral">&quot;The swatch to apply in place of this one&quot;</span>, ObjectType( kSwatchObjectScriptElement ), kOptional,</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">} ;</div></div><p><b>Changing an existing enum</b><p>New enumerators can be added and removed using Enumerator and ObsoleteEnumerator elements. To add an additional enumerator, however, instead of obsoleting the entire enum, you can use an enumerator resource. For example, suppose you want to add a new enumerator to the enum shown in this example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 110 ) {</div><div class="line"> { kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kAllProductsJapaneseFS, k_Wild, }</div><div class="line"> {</div><div class="line"> Enum</div><div class="line"> {</div><div class="line"> kKinsokuTypeEnumScriptElement,</div><div class="line"> en_KinsokuType,</div><div class="line"><span class="stringliteral">&quot;kinsoku type&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Kinsoku type&quot;</span>,</div><div class="line"> {</div><div class="line"> en_KinsokuPushInFirst, <span class="stringliteral">&quot;kinsoku push in first&quot;</span>, <span class="stringliteral">&quot;Kinsoku push in first&quot;</span>,</div><div class="line"> en_KinsokuPushOutFirst, <span class="stringliteral">&quot;kinsoku push out first&quot;</span>, <span class="stringliteral">&quot;Kinsoku push out first&quot;</span>,</div><div class="line"> en_KinsokuPushOutOnly, <span class="stringliteral">&quot;kinsoku push out only&quot;</span>, <span class="stringliteral">&quot;Kinsoku push out only&quot;</span>,</div><div class="line"> }</div><div class="line"> }</div><div class="line"> ... <span class="comment">//Other elements </span></div><div class="line"> }</div><div class="line">} ;</div></div><p>Using an enumerator resource, as shown in the following example, you can add an additional enumerator to the existing enum without obsoleting the existing one:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 90110 ){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kCS2ScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kAllProductsJapaneseFS, k_Wild,</div><div class="line"> }</div><div class="line"><span class="comment">//Elements</span></div><div class="line"> {</div><div class="line"> Enumerator</div><div class="line"> {</div><div class="line"> kKinsokuTypeEnumScriptElement,</div><div class="line"> {</div><div class="line"> en_KinsokuPushInAlways, <span class="stringliteral">&quot;kinsoku push in always&quot;</span>, <span class="stringliteral">&quot;Kinsoku push in always&quot;</span>, <span class="comment">//new enumerator</span></div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">} ;</div></div><p>You also can use this approach for obsoleting one (or more) enumerators without obsoleting the entire enum.<p>This example shows the existing resource:<div class="fragment"><div class="line">Enum{kTextImportCharacterSetEnumScriptElement,en_TextImportCharacterSet,<span class="stringliteral">&quot;text import character set&quot;</span>,<span class="stringliteral">&quot;Character set options for importing text files.&quot;</span>,</div><div class="line"> {</div><div class="line"> en_ANSI, <span class="stringliteral">&quot;ansi&quot;</span>, <span class="stringliteral">&quot;The ANSI character set.&quot;</span>,</div><div class="line"> en_ASCII, <span class="stringliteral">&quot;ASCII&quot;</span>, <span class="stringliteral">&quot;ASCII&quot;</span>,</div><div class="line"> en_DOSLatin2, <span class="stringliteral">&quot;DOS latin 2&quot;</span>, <span class="stringliteral">&quot;DOS Latin 2&quot;</span>,</div><div class="line"> en_CSUnicode, <span class="stringliteral">&quot;unicode&quot;</span>, <span class="stringliteral">&quot;The Unicode character set.&quot;</span>,</div><div class="line"> en_ShiftJIS83pv, <span class="stringliteral">&quot;RecommendShiftJIS83pv&quot;</span>, <span class="stringliteral">&quot;The Recommend:Shift_JIS 83pv character set.&quot;</span>,</div><div class="line"> ... <span class="comment">//Other enumerators</span></div><div class="line"> }</div><div class="line">}</div></div><p>Move the obsolete enumerator(s) into a separate, obsolete enumerator resource:<div class="fragment"><div class="line">Enum{kTextImportCharacterSetEnumScriptElement,en_TextImportCharacterSet,<span class="stringliteral">&quot;text import character set&quot;</span>,<span class="stringliteral">&quot;Character set options for importing text files.&quot;</span>,{</div><div class="line"> en_ANSI, <span class="stringliteral">&quot;ansi&quot;</span>, <span class="stringliteral">&quot;The ANSI character set.&quot;</span>,</div><div class="line"> en_CSUnicode, <span class="stringliteral">&quot;unicode&quot;</span>, <span class="stringliteral">&quot;The Unicode character set.&quot;</span>,</div><div class="line"> en_ShiftJIS83pv, <span class="stringliteral">&quot;RecommendShiftJIS83pv&quot;</span>, <span class="stringliteral">&quot;The Recommend:Shift_JIS 83pv character set.&quot;</span>,</div><div class="line"> ...</div><div class="line">}}</div><div class="line">ObsoleteEnumerator{kCCScriptVersion,kTextImportCharacterSetEnumScriptElement,{</div><div class="line"> en_ASCII, <span class="stringliteral">&quot;ASCII&quot;</span>, <span class="stringliteral">&quot;ASCII&quot;</span>,</div><div class="line"> n_DOSLatin2, <span class="stringliteral">&quot;DOS latin 2&quot;</span>, <span class="stringliteral">&quot;DOS Latin 2&quot;</span>,</div><div class="line">}}</div></div><p><b>Client access to the version</b><p>The scripting architecture requires that all requests specify which version of the scripting DOM to use.<p><b>Via the object model from <a class="el" href="class_i_script_provider.html">IScriptProvider</a> implementations</b><p>Script providers also can check which version of the scripting DOM to use when handling a request:<div class="fragment"><div class="line"><span class="comment">// IScriptProvider methods have an &quot;IScriptRequestData* data&quot; parameter </span></div><div class="line"><span class="keywordflow">if</span> ( data-&gt;GetRequestContext().GetVersion() &gt;= kCS2ScriptVersion ) ...</div></div><p>Major changes to function across versions should be implemented in a separate script provider (see Process for making changes) and directed to the correct script provider via a versioned resource.<p><b>Via the Object Model from <a class="el" href="class_i_script_manager.html">IScriptManager</a> Implementations</b><p>This is implemented via the <a class="el" href="class_i_script_preferences.html">IScriptPreferences</a> interface, which is aggregated by every script manager boss (that is, those with <a class="el" href="class_i_script_manager.html">IScriptManager</a>).<p>The code is as you would expect:<div class="fragment"><div class="line"><span class="comment">//Where &quot;this&quot; is a subclass of IScriptManager* </span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IScriptPreferences&gt;</a> scriptPrefs( <span class="keyword">this</span>, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>() ) ; </div><div class="line"><span class="keywordflow">if</span> ( scriptPrefs-&gt;GetVersion() &gt;= kCS2ScriptVersion ) </div><div class="line"> ...</div></div><p>IScriptManager::GetRequestContext() returns a request context based on the current settings (version and locale) of the aggregated <a class="el" href="class_i_script_preferences.html">IScriptPreferences</a> interface. The default implementation of IScriptManager::CreateScriptRequestData() calls GetRequestContext(). This means you must make sure the version information is set correctly before generating the <a class="el" href="class_i_script_request_data.html">IScriptRequestData</a> for a client&#39;s request.<p><b>Via the scripting DOM</b><p>For information on accessing and setting the DOM version through scripting, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_running_versioned_scripts">Running versioned scripts</a>.<p><b>For testing purposes</b><p>The Test &gt; Scripting &gt; Set Current DOM version menu contains items to set current DOM version to a variety of versions. These reset all active script managers to the selected version.<p><b>Process for making changes</b><p>Most changes to the scripting DOM require creating a new VersionedScriptElementInfo statement (usually in a new .fr file) and, possibly, a new script provider .cpp file.<p><b>Changes that may be made in the existing resource</b><p>You can make nonfunctional/superficial changes; for example, correcting an element&#39;s description.<p><b>Changes that may be made in the existing script provider</b><p>You can fix bugs in the function of the script provider; for example:<ul><li>Returns kSuccess but actually fails (no return value).<li>Returns error when it is expected to succeed.<li>Does something different than promised/expected.</ul><p><b>Changes that must be made by versioning the resource and/or script provider</b><ol type="1"><li>Semantic changes to the function of an element:<ul><li>Script-provider code change.<li>Underlying model code change.</ul><li>Changes to the Context of a Script Resource<ul><li>Script manager boss ID.<li>Feature set ID.<li>Locale ID.</ul><li>Changes to an element&#39;s script resource:<ul><li>Identity: Name, ScriptID, ScriptElementID.<li>Object: Modify GUID, change inheritance, change suite membership.<li>Property: Modify type.<li>Method: Modify type of return value, add/remove return value, add/remove method parameters.<li>Method parameter: Modify type, modify whether optional or required, modify default value.<li>Enum: Add/remove enumerators.</ul><li>Changes to a provider&#39;s script resource:<ul><li>Changes to the implementation of a script-provider boss ClassID.<li>Parent: Add/remove, make surrogate or not.<li>Method: Add/remove.<li>Object: Add/remove, make represent or not<li>Property: Add/remove, change read-only access to/from read-write.</ul><li>Delete/add elements and functions:<ul><li>Suite<li>Object<li>Method<li>Property<li>Enum<li>Provider</ul></ol><p><b>Protocol for changes</b><p><b>New elements</b><ul><li>Resources - Define new elements in a new VersionedScriptElementInfo statement in a new .fr file. We recommend, for example, that the name of the new file be of the form MyScriptInfo90.fr, to indicate that it was added in Basil and contains version 9.0 resources.<li>Code - Implement support for the new elements in a new script provider .cpp file. We recommend that the name of the file be in the form &quot;MyScriptProvider90.cpp,&quot; to indicate that it was added in InDesign CC 2014 and implements version 9.0 support.</ul><p><b>Obsolete elements</b><ul><li>Resources - Edit the existing element definition to designate it as obsolete in the existing script info .fr file.<li>Code - This should require no changes to script provider .cpp files.</ul><p><b>Altered elements</b><ul><li>Resources - Edit the existing element definition to designate it as obsolete. Define the revised elements in a new VersionedScriptElementInfo statement (in a new .fr file).<li>Code - If the function is changing, implement support for the changed function in a new script provider .cpp file. The new script provider needs to contain the code for only the elements that are changing; unchanged elements (properties and methods) can still be handled by the existing script provider.</ul><p><b>Bug fixes</b><ul><li>Resources - Fixes to resources must be treated as a change to the scripting DOM (see &quot;Altered Elements&quot; above).<li>Code - If the functionality is changing radically, implement support for the changed functionality in a new script provider .cpp file. Changes to the semantics of an existing element must be treated as a change to the DOM (see &quot;Altered Elements&quot; above).</ul><h3><a class="anchor" id="id_client-specific_scripting_resources"></a> Client-specific scripting resources</h3><p>Certain script elements are applicable to only one client of the scripting DOM. These script elements are declared in VersionedScriptElementInfo statements, but using the ClassID of the client&#39;s script manager boss instead of <a class="el" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>. These script elements are managed automatically by the same IScriptManagerInfo interface and are visible (or not) depending on the client that requested the information.<p>On first launch, all script elements are loaded into a single &quot;database&quot; managed by the scripting plug-in and stored in SavedData. Each element includes a member datum of the ElementContext class (defined in <a class="el" href="_script_info_8h_source.html">ScriptInfo.h</a>), which specifies the element&#39;s client (core or specific), feature set, locale, and version (first and last).<p>When a client wants access to the script information database, it must specify a RequestContext (defined in <a class="el" href="_script_info_8h_source.html">ScriptInfo.h</a>), which indicates the client, feature set, locale, and version in which the client is interested. The client calls <a class="el" href="class_i_script_utils.html#a9818dcdc186abc8663a0ddf2375f3eb6">IScriptUtils::QueryScriptInfoManager</a> or <a class="el" href="class_i_script_utils.html#a2cd9a7ed7bc00f926371ecffc0362825">IScriptUtils::QueryScriptRequestHandler</a>. If this is the first request using a particular RequestContext, the scripting plug-in creates a new ScriptInfoManager boss containing only the relevant elements. If this RequestContext was received previously, the scripting plug-in returns the appropriate interface on the existing boss.<p>The elements contained in a ScriptInfoManager boss for a particular RequestContext include all core script elements plus all elements specific to the specified client (if any). Script elements are included in the DOM for client X if they are exposed for client X or any parent bosses of X in its boss inheritance hierarchy.<p>For example, suppose the boss inheritance hierarchy looks like this:<div class="fragment"><div class="line"><a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a> &gt; kINXScriptManagerBoss &gt; kINXExpandedExportScriptManagerBoss</div></div><p>Every DOM includes all core elements exposed to the base script manager <a class="el" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>. kINXScriptManagerBoss gets all core elements plus any elements specifically exposed for it. kINXExpandedExportScriptManagerBoss gets everything in the kINXScriptManagerBoss&#39;s DOM, plus any INX Expanded (IDML)-specific elements.<p>If any element is exposed at more than one level, the element exposed to the most derived boss is retained. For example, if an element with the same ScriptElementID is exposed to <a class="el" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a> and kINXScriptManagerBoss, the one for kINXScriptManagerBoss is used. If another element with that ScriptElementID is exposed to kINXExpandedExportScriptManagerBoss, it would be used for the INX-ALT DOM.<p><b>Elements visible to only one client</b><p>All VersionedScriptElementInfo resources specify a client, the ClassID of a script manager boss. For core script elements, this is <a class="el" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>. For client-specific script elements, this is the ClassID of the client&#39;s script manager boss. Example:<div class="fragment"><div class="line">resource VersionedScriptElementInfo(10){</div><div class="line"> kInitialScriptVersion,</div><div class="line"> kMyScriptManagerBoss, <span class="comment">// See Note 1</span></div><div class="line"> kWildFS, k_Wild,</div><div class="line"> {</div><div class="line"><span class="comment">// See Note 2</span></div><div class="line"> }</div><div class="line">};</div></div><p>Notes:<ol type="1"><li>This is the ClassID of the script manager for the client for which these resources are exposed; for example, <a class="el" href="classk_apple_script_mgr_boss.html">kAppleScriptMgrBoss</a>. See the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_script_managers">Script managers</a>.<li>Client-specific suite, object, method, property, and provider resources go here.</ol><p><b>Elements defined differently by different clients</b><p>Attributes of a script element that are intrinsic to its definition (that is, that appear in fields of the script element&#39;s resource) can be changed on a per-client basis. For example, a property might have a different type, or a method might have different parameters.<p>One way to do this is to define a new script element with its own ScriptElementID, name, and ScriptID. In this case, both versions of the element are available. Alternatively, you can use the same ScriptElementID, but change some or all of the other attributes. In this case, only the client-specific version of the element is available for that client. In either case, the alternative script element could be handled by the same or a different script provider as the original one, since that is determined by the provider resource.<p>For example, in the following example, the delete method for the swatch object has one parameter by default but no parameters for my client (which also uses a different script provider to handle the method):<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 20 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"> Method</div><div class="line"> {</div><div class="line"> kDeleteSwatchMethodScriptElement,</div><div class="line"> e_Delete,</div><div class="line"><span class="stringliteral">&quot;delete&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Delete swatch&quot;</span>,</div><div class="line"> VoidType,</div><div class="line"> {</div><div class="line"> p_Replace, <span class="stringliteral">&quot;replacing with&quot;</span>, <span class="stringliteral">&quot;The swatch to apply in place of this one&quot;</span>,</div><div class="line"> VariableType{ ObjectType( kSwatchObjectScriptElement ), StringType }, kRequired,</div><div class="line"> }</div><div class="line"> }</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"> kCoreSwatchScriptProviderBoss,</div><div class="line"> {</div><div class="line"> Object{ kSwatchObjectScriptElement },</div><div class="line"> Property{ kDeleteSwatchMethodScriptElement },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource VersionedScriptElementInfo( 21 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, kMyScriptManagerBoss, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"> Method</div><div class="line"> {</div><div class="line"> kDeleteSwatchMethodScriptElement,</div><div class="line"> e_Delete,</div><div class="line"><span class="stringliteral">&quot;delete&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Delete swatch&quot;</span>,</div><div class="line"> VoidType,</div><div class="line"> {}</div><div class="line"> }</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"> kMySwatchScriptProviderBoss,</div><div class="line"> {</div><div class="line"> Object{ kSwatchObjectScriptElement },</div><div class="line"> Method{ kDeleteSwatchMethodScriptElement},</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">};</div></div><p><b>Relationships between elements that are different for different clients</b><p>In some cases, attributes of a script element that are related to its behavior for a specific object are set in the provider resources; for example, whether an object has a particular parent or whether a property is read-only or read-write. For a particular client to obtain behavior that is different from the core attributes set in the core resources, define a separate provider resource in a context-sensitive VersionedScriptElementInfo resource for that client.<p>In the following example, the name property of the hyphenation exception object is read-only by default but read-write for my client (and still handled by the same script provider implementation):<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 30 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_hyph_exception_script_provider_boss.html">kHyphExceptionScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kHyphenationExceptionObjectScriptElement },</div><div class="line"> Property{ kNamePropertyScriptElement, kReadOnly },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource VersionedScriptElementInfo( 31 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, kMyScriptManagerBoss, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_hyph_exception_script_provider_boss.html">kHyphExceptionScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kHyphenationExceptionObjectScriptElement },</div><div class="line"> Property{ kNamePropertyScriptElement, kReadWrite },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">} ;</div></div><p><b>Relationships between elements that are not applicable to a particular client</b><p>By default, elements specified in a core resource are available in all clients, although sometimes these elements have an alternative, client-specific definition (see above). In most cases, however, whether these elements actually are accessible to a user of the client is determined by whether they appear in a provider resource. That is because the provider resources determine the parent/child relationships of the DOM hierarchy, as well as which methods and properties are supported by which objects. This makes it possible for a client to hide a particular element by hiding relationships between elements. (This is not true of core suite or enum elements, which, therefore, cannot be hidden.)<p>To remove a relationship, define a provider resource that uses kNotSupported as the identifier of the script provider. Doing so means any relationships in that provider resource specifically is not supported for the client in question.<p>In the following example, a client-specific provider resource is used to add additional parents for the link object and to remove a property that these parents use to access links in the default case:<p>Relationships between elements that are not applicable to a particular client<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 40 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kInDesignAllLanguagesFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"><span class="comment">//For core clients, only the Document has a links collection</span></div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_link_script_provider_boss.html">kLinkScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> SurrogateParent{ kDocumentObjectScriptElement },</div><div class="line"> RepresentObject{ kLinkObjectScriptElement },</div><div class="line"> CollectionMethod{ kCountMethodScriptElement },</div><div class="line"> }</div><div class="line"> } </div><div class="line"> Property</div><div class="line"> {</div><div class="line"> kItemLinkPropertyScriptElement,</div><div class="line"> p_Link,</div><div class="line"><span class="stringliteral">&quot;item link&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;Link to a placed file&quot;</span>,</div><div class="line"> ObjectType( kLinkObjectScriptElement ),</div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line"> }</div><div class="line"><span class="comment">//For core clients, there is a item link property on linkable objects</span></div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_link_script_provider_boss.html">kLinkScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Object{ kStoryObjectScriptElement },</div><div class="line"> Object{ kGraphicObjectScriptElement },</div><div class="line"> Property{ kItemLinkPropertyScriptElement, kReadOnly },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource VersionedScriptElementInfo( 41 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, kMyScriptManagerBoss, kInDesignAllLanguagesFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"><span class="comment">//For my client, there is a links collection on linkable objects</span></div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_link_script_provider_boss.html">kLinkScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> Parent{ kStoryObjectScriptElement },</div><div class="line"> Parent{ kImageObjectScriptElement },</div><div class="line"> Parent{ kEPSObjectScriptElement },</div><div class="line"> Parent{ kWMFObjectScriptElement },</div><div class="line"> Parent{ kPICTObjectScriptElement },</div><div class="line"> Parent{ kPDFObjectScriptElement },</div><div class="line"> RepresentObject{ kLinkObjectScriptElement },</div><div class="line"> CollectionMethod{ kCountMethodScriptElement },</div><div class="line"> }</div><div class="line"> }</div><div class="line"><span class="comment">//For my client, there is no item link property on linkable objects</span></div><div class="line"> Provider</div><div class="line"> {</div><div class="line"> kNotSupported,</div><div class="line"> {</div><div class="line"> Object{ kStoryObjectScriptElement },</div><div class="line"> Object{ kGraphicObjectScriptElement },</div><div class="line"> Property{ kItemLinkPropertyScriptElement, kReadOnly },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">} ;</div></div><h3><a class="anchor" id="id_elements_that_are_not_applicable_to_a_particular_object"></a> Elements that are not applicable to a particular object</h3><p>It also is possible to use kNotSupported to remove elements from an object. Typically, this is used for a subclass object that does not want to inherit elements from its parent object type. We discourage this approach, because by definition a subclasses should support the entire DOM of its parent class.<p>In the following example, the name property and delete method are removed from the foo object.<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 40 ){</div><div class="line"> {</div><div class="line"> kInitialScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild,</div><div class="line"> }</div><div class="line"> {</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"> kNotSupported,</div><div class="line"> {</div><div class="line"> Object{ kFooObjectScriptElement },</div><div class="line"> Property{ kNamePropertyScriptElement, kReadOnly },</div><div class="line"> Method{ kDeleteMethodScriptElement }</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">};</div></div><h2><a class="anchor" id="id_key_scripting_apis"></a> Key scripting APIs</h2><p>This section contains lists of commonly used scripting-related APIs. For reference documentation, either search in &lt;SDK&gt;/docs/references/index.chm for the specified class by name or, if you uncompressed the HTML-based API documentation (sdkdocs.tar.gz), view &lt;SDK&gt;/docs/references/api/class{ClassName}.html with your HTML browser.<p>The following tables list common scripting-related interfaces, common partial implementation classes, and other headers. For more information, see the API documentation.<p>Common scripting-related interfaces:<table class="doxtable"><tr><th>Interface </th><th>Location / description </th></tr><tr><td><a class="el" href="class_i_export_provider_signal_data.html">IExportProviderSignalData</a></td><td>Data interface for export providers to use when signaling responders. This is not scripting specific. </td></tr><tr><td><a class="el" href="class_i_script.html">IScript</a></td><td>&lt;SDK&gt;/public/interfaces/architecture/IScript.h </td></tr><tr><td><a class="el" href="class_i_script_args.html">IScriptArgs</a></td><td>For passing arguments into scripts. </td></tr><tr><td><a class="el" href="class_i_script_core_functor.html">IScriptCoreFunctor</a></td><td>Represent a function object in scripting. </td></tr><tr><td><a class="el" href="class_i_script_error.html">IScriptError</a></td><td>Contains error state information for a scripting request. </td></tr><tr><td><a class="el" href="class_i_script_error_utils.html">IScriptErrorUtils</a></td><td>Sets method data for common errors. </td></tr><tr><td><a class="el" href="class_i_script_event.html">IScriptEvent</a></td><td>The interface for an attachable event in scripting. </td></tr><tr><td><a class="el" href="class_i_script_event_target.html">IScriptEventTarget</a></td><td>Any object that can be the target of attachable events in scripting should aggregate this interface to the same boss as its IID_ISCRIPT. </td></tr><tr><td><a class="el" href="class_i_script_info_manager.html">IScriptInfoManager</a></td><td>Manages information about elements in the scripting DOM. </td></tr><tr><td><a class="el" href="class_i_script_label.html">IScriptLabel</a></td><td>Script label. </td></tr><tr><td><a class="el" href="class_i_script_manager.html">IScriptManager</a></td><td>Provides basic information about support for a particular scripting client (including IDML). </td></tr><tr><td><a class="el" href="class_i_script_object_mgr.html">IScriptObjectMgr</a></td><td>Manages nonpersistent (that is, proxy) script objects. </td></tr><tr><td><a class="el" href="class_i_script_object_parent.html">IScriptObjectParent</a></td><td>Allows script objects (usually proxy script objects) to refer to the parent object in the scripting DOM. </td></tr><tr><td><a class="el" href="class_i_script_preferences.html">IScriptPreferences</a></td><td>Preferences for the application environment when executing a script. </td></tr><tr><td><a class="el" href="class_i_script_provider.html">IScriptProvider</a></td><td>&lt;SDK&gt;/public/interfaces/architecture/IScriptProvider.h </td></tr><tr><td><a class="el" href="class_i_script_request_data.html">IScriptRequestData</a></td><td>&lt;SDK&gt;/public/interfaces/architecture/IScriptRequestData.h </td></tr><tr><td><a class="el" href="class_i_script_request_handler.html">IScriptRequestHandler</a></td><td>&lt;SDK&gt;/public/interfaces/architecture/IScriptRequestHandler.h </td></tr><tr><td><a class="el" href="class_i_script_request_handler.html">IScriptRequestHandler</a></td><td>Matches requests from clients to the appropriate script provider. </td></tr><tr><td><a class="el" href="class_i_script_runner.html">IScriptRunner</a></td><td>Runs a script from within the application. </td></tr><tr><td><a class="el" href="class_i_script_utils.html">IScriptUtils</a></td><td>&lt;SDK&gt;/public/interfaces/architecture/IScriptUtils.h </td></tr><tr><td><a class="el" href="class_i_text_object_parent.html">ITextObjectParent</a></td><td>This interface must be implemented for any scripting object that wants to act as a parent of text objects in the scripting DOM. </td></tr></table><p>Common partial implementation classes:<table class="doxtable"><tr><th>Class </th><th>Location </th></tr><tr><td><a class="el" href="class_c_proxy_script.html">CProxyScript</a></td><td>&lt;SDK&gt;/public/includes/CProxyScript.h </td></tr><tr><td><a class="el" href="class_c_script.html">CScript</a></td><td>&lt;SDK&gt;/public/includes/CScript.h </td></tr><tr><td><a class="el" href="class_c_script_request_data.html">CScriptRequestData</a></td><td>&lt;SDK&gt;/public/includes/ <a class="el" href="_c_script_request_data_8h_source.html">CScriptRequestData.h</a></td></tr><tr><td><a class="el" href="class_c_script_provider.html">CScriptProvider</a></td><td>&lt;SDK&gt;/public/includes/CScriptProvider.h </td></tr><tr><td><a class="el" href="class_prefs_script_provider.html">PrefsScriptProvider</a></td><td>&lt;SDK&gt;/public/includes/PrefsScriptProvider.h </td></tr><tr><td><a class="el" href="class_represent_script_provider.html">RepresentScriptProvider</a></td><td>&lt;SDK&gt;/public/includes/CScriptProvider.h </td></tr></table><p>Other headers:<table class="doxtable"><tr><th>Header file </th><th>Location </th></tr><tr><td><a class="el" href="_script_data_8h_source.html">ScriptData.h</a></td><td>&lt;SDK&gt;/public/includes/ScriptData.h </td></tr><tr><td><a class="el" href="_script_info_8h_source.html">ScriptInfo.h</a></td><td>&lt;SDK&gt;/public/includes/ScriptInfo.h </td></tr><tr><td>ScriptInfoTypes.(f)h </td><td>&lt;SDK&gt;/public/includes/ScriptInfoTypes.(f)h </td></tr><tr><td><a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a></td><td>&lt;SDK&gt;/public/includes/ScriptingDefs.h </td></tr><tr><td><a class="el" href="_scripting_i_d_8h_source.html">ScriptingID.h</a></td><td>&lt;SDK&gt;/public/interfaces/architecture/ScriptingID.h. This header is needed in .fr files for base boss class ID declarations. </td></tr></table><h2><a class="anchor" id="id_scripting_dom_reference"></a> Scripting DOM reference</h2><p>The scripting DOM made available for developers to extend is documented by the references listed in the following table . New script objects, properties, and methods are added to the script objects defined in these references. Most of the scripting DOM is common to all client scripting managers; however, separate references for IDML, INX, AppleScript, JavaScript, and Visual Basic are provided for completeness, so you can see the differences. These mainly show how base script objects adapt to meet the needs of each script manager. If you need information on the scripting DOM for another product (for example, InCopy), version (for example, CC), or feature-set locale (for example, Japanese), you can create your own dump containing the desired information (see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_dumping_the_scripting_dom">Dumping the scripting DOM</a>.)<dl class="section note"><dt>Note<dd>Most of the ScriptIDs in the reference are defined as symbols in the header file <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a>.<dd> The below table is out of date and may show incorrect file locations.</dl><p>Scripting DOM references for C++ programmers:<table class="doxtable"><tr><th>Scripting DOM reference </th><th>Location </th></tr><tr><td>Adobe IInDesign CC 2014 </td><td>&lt;SDK&gt;/docs/references/scripting-dom-idml-idr10.html </td></tr><tr><td>Adobe IInDesign CC 2014 </td><td>&lt;SDK&gt;/docs/references/scripting-dom-inx-idr10.html </td></tr><tr><td>Adobe IInDesign CC 2014 </td><td>&lt;SDK&gt;/docs/references/scripting-dom-applescript-idr10.html </td></tr><tr><td>Adobe IInDesign CC 2014 </td><td>&lt;SDK&gt;/docs/references/scripting-dom-javascript-idr10.html </td></tr><tr><td>Adobe IInDesign CC 2014Visual Basic </td><td>&lt;SDK&gt;/docs/references/scripting-dom-visualbasic-idr10.html </td></tr></table><h3><a class="anchor" id="id_scripting_dom_versioning"></a> Scripting DOM versioning</h3><p>The scripting DOM is versioned by product, version, feature-set locale, and scripting client. This means that each product (InDesign, InCopy, and InDesign Server) has several distinct scripting DOMs. For more information, see RequestContext in the API documentation. For example, each row in the following table represents an instance of a scripting DOInDesign CC 2014gn CC. The scripting DOM varies by scripting client, but most of the DOM is core. There can be considerable variation by feature-set locale (Roman or Japanese) and product version (for example, 3.0, 4.0, 5.0, 6.0, 7.0, or 8.0). Similar tables could be created for InCopy and InDesign Server.<table class="doxtable"><tr><th>Product </th><th>Version </th><th>Locale </th><th>Script manager </th></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td><a class="el" href="classk_apple_script_mgr_boss.html">kAppleScriptMgrBoss</a></td></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td><a class="el" href="classk_java_script_mgr_boss.html">kJavaScriptMgrBoss</a></td></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td><a class="el" href="classk_o_l_e_automation_mgr_boss.html">kOLEAutomationMgrBoss</a></td></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td>kINXTraditionalImportScriptManagerBoss </td></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td>kINXTraditionalExportScriptManagerBoss </td></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td>kINXExpandedImportScriptManagerBoss </td></tr><tr><td>InDesign </td><td>9.0 </td><td>Roman </td><td>kINXExpandedExportScriptManagerBoss </td></tr></table><h3><a class="anchor" id="id_dumping_the_scripting_dom"></a> Dumping the scripting DOM</h3><p><b>Via the diagnostics plug-in</b><p>The AInDesign CC 2014gn CC Scripting DOM Reference documents listed in the table in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scripting_dom_reference">Scripting DOM reference</a> are created via the diagnostics plug-in and an XSLT stylesheet. See Chapter 16, &quot;Diagnostics,&quot; for information on dumping the scripting DOM in XML and transforming it to HTML using XSLT.<p><b>Via Test &gt; Scripting &gt; Dump All Script Resources</b><p>The scripting DOM can be dumped to a text file using the debug build. To find the script objects provided by a product and the methods and properties they expose:<ol type="1"><li>Choose Test &gt; Scripting &gt; Dump All Script Resources and wait while the application dumps a text file containing the scripting DOM for each client. Dump files are created in the qa/Logs folder, in the folder that contains the application executable.<li>Choose the dump for the scripting client in which you are interested. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_script_managers">Script managers</a> for a list of scripting clients. For example, uInDesign CC 2014gn CC, the dump file named kJavaScriptMgrBossIDR10.0.txt contains the scripting DOM for JavaScript InDesign CC 2014ign CC.</ol><p>The dump contains separate sections that describe the available suites, enums, methods, properties, and script objects.<h1><a class="anchor" id="id_custom_script_events"></a> Custom Script Events</h1><p>Script events allow scripting-based solutions to respond when something changes in InDesign. This is essentially an observer mechanism for scripting. InDesign contains support for a fixed set of events. This chapter discusses developing plug-ins that dispatch additional custom events.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>Users can execute scripts from the Scripts palette or externally. The ability to attach event listeners provides a away to call scritpts or script methods whenever the user (or a script) triggers certain events or changes in the object model or UI. For example, events are triggered every time a document is opened or closed. You can attach an event listener of your own design to each event for which you need a particular action to occur.<p>Event support has been enabled by default for all objects in the scripting DOM by exposing the Event and EventListener objects as children. Using events in scripting is explained in the &quot;Events&quot; chapter of the Adobe InDesign Scripting Guide.<h3><a class="anchor" id="id_combining_cpp_and_scripting"></a> Combining C++ and scripting</h3><p>If your solution requires the ability to watch for an event that isn&#39;t provided by InDesign, you can write a plug-in that dispatches the event. This is called a hybrid solution because it requires both C++ and scripting.<h2><a class="anchor" id="id_event_types"></a> Event types</h2><p>Event information, including target objects, is defined in scripting resources (.fr file) like all other parts of the scripting DOM. Information about which objects support which events is exposed programmatically in C++ via <a class="el" href="class_i_script_info_manager.html">IScriptInfoManager</a>.<h3><a class="anchor" id="id_extendscript_client"></a> ExtendScript client</h3><p>For the ExtendScript client, you can add the event types as static class properties of their target objects, for example:<div class="fragment"><div class="line">app.eventListeners.add( Application.AFTER_ACTIVATE, myHandler ) ;</div></div><p>as an alternative to this: <div class="fragment"><div class="line">app.eventListeners.add( <span class="stringliteral">&quot;afterActivate&quot;</span>, myHandler ) ;</div></div><p>You can look up these class static properties in the OMV (under an object&#39;s class rather than instance properties) to see which events an object supports.<p>Note that event types are also exposed as static class properties of the Event object that is used to dispatch the event. For example:<div class="fragment"><div class="line">app.eventListeners.add( Event.AFTER_ACTIVATE, myHandler ) ;</div><div class="line">app.eventListeners.add( DocumentEvent.BEFORE_NEW, myHandler ) ;</div></div><h3><a class="anchor" id="id_vbscript_client"></a> VBScript client</h3><p>For the VBScript client, event types are exposed as constants in a separate module of their target objects (named as &lt;object&gt; Events, eg: ApplicationEvents). For example:<div class="fragment"><div class="line">app.AddEventListener( ApplicationEvents.idBeforeNew, myHandler ) ;</div><div class="line">app.AddEventListener( EventEvents.idAfterActivate, myHandler ) ;</div><div class="line">app.AddEventListener( <span class="stringliteral">&quot;beforeNew&quot;</span>, myHandler ) ;</div></div><p>A handler can be specified as a file or a function.<p>For VBScript, file is provided as a string: <div class="fragment"><div class="line"><span class="stringliteral">&quot;&lt;filename&gt;&quot;</span></div></div><p>and function is provided as: <div class="fragment"><div class="line">GetRef(<span class="stringliteral">&quot;&lt;function name&gt;&quot;</span>)</div></div><dl class="section note"><dt>Note<dd>Event handler should take in one argument of event type.</dl><p>Example:<div class="fragment"><div class="line">Function eventHandler(ev)</div><div class="line"> MsgBox &quot;Event Handler: &quot; + ev.EventType</div><div class="line">End Function</div></div><h3><a class="anchor" id="id_applescript_client"></a> AppleScript client</h3><p>For the AppleScript client, each class lists the event types as static properties. For example:<div class="fragment"><div class="line">make <span class="keyword">event</span> listener with properties { <span class="keyword">event</span> type : before <span class="keyword">new</span>, handler: myHandler}</div><div class="line">make <span class="keyword">event</span> listener with properties { <span class="keyword">event</span> type : <span class="stringliteral">&quot;beforeNew&quot;</span>, handler: myHandler}</div></div><p>Here, myHandler is a function defined in the same script. An argument, evt, of type event is implicitly passed to the myHandler function, and the user needs to explicitly define it. So, the handler might look like this:<div class="fragment"><div class="line">on myHandler()</div><div class="line">-- <span class="keywordflow">do</span> something with evt</div><div class="line">end myHandler</div></div><h2><a class="anchor" id="id_scripting_resources"></a> Scripting resources</h2><p>Like all other elements in the scripting DOM, attachable events are defined using ODFRC resources in a ScriptInfo.fr file. A sample resource looks like this:<div class="fragment"><div class="line">resource VersionedScriptElementInfo( 70300 ) { </div><div class="line"><span class="comment">//Contexts </span></div><div class="line"> { </div><div class="line"> kCCScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild, </div><div class="line"> } </div><div class="line"><span class="comment">//Elements </span></div><div class="line"> { </div><div class="line"> Event </div><div class="line"> { </div><div class="line"> kBeforeQuitEventScriptElement, <span class="comment">//ScriptElementID </span></div><div class="line"> e_BeforeQuit, <span class="comment">//ScriptID</span></div><div class="line"><span class="stringliteral">&quot;before quit&quot;</span>, <span class="comment">//Name</span></div><div class="line"><span class="stringliteral">&quot;Dispatched before the ^Object is quit. Allows the quit to be canceled.&quot;</span>, <span class="comment">//Description</span></div><div class="line"> kTrue, <span class="comment">//Bubbles</span></div><div class="line"> kTrue, <span class="comment">//Cancelable</span></div><div class="line"> kBaseScriptEventBoss, <span class="comment">//ClassID of the Event object</span></div><div class="line"> c_Event <span class="comment">//ScriptID of the Event object</span></div><div class="line"> } </div><div class="line"> Event </div><div class="line"> { </div><div class="line"> kAfterQuitEventScriptElement, <span class="comment">//ScriptElementID</span></div><div class="line"> e_AfterQuit, <span class="comment">//ScriptID</span></div><div class="line"><span class="stringliteral">&quot;after quit&quot;</span>, <span class="comment">//Name </span></div><div class="line"><span class="stringliteral">&quot;Dispatched when the ^Object is quitting. Since the quit has been committed, it can not be canceled.&quot;</span>, <span class="comment">//Description </span></div><div class="line"> kTrue, <span class="comment">//Bubbles</span></div><div class="line"> kFalse, <span class="comment">//Cancelable</span></div><div class="line"> kBaseScriptEventBoss, <span class="comment">//ClassID of the Event object</span></div><div class="line"> c_Event <span class="comment">//ScriptID of the Event object</span></div><div class="line"> } </div><div class="line"> Provider </div><div class="line"> { </div><div class="line"><a class="code" href="classk_base_object_script_provider_boss.html">kBaseObjectScriptProviderBoss</a>, <span class="comment">//ClassID of any valid script provider</span></div><div class="line"> { </div><div class="line"> Object{ kApplicationObjectScriptElement }, <span class="comment">//Target object </span></div><div class="line"> Event{ kBeforeQuitEventScriptElement }, </div><div class="line"> Event{ kAfterQuitEventScriptElement }, </div><div class="line"> } </div><div class="line"> } </div><div class="line"> } </div><div class="line">};</div></div><h2><a class="anchor" id=""></a></h2><p>There are three key interfaces related to attachability:<ul><li><a class="el" href="class_i_script_event_target.html">IScriptEventTarget</a> exists on every scriptable object boss. It stores any registered event listeners (bosses that implement <a class="el" href="class_i_script_event_listener.html">IScriptEventListener</a>) and is called to dispatch an event.<li><a class="el" href="class_i_script_event_listener.html">IScriptEventListener</a> is a script event listener boss that represents the code that&#39;s listening. In other words, this is the code that needs to be notified.<li><a class="el" href="class_i_script_event.html">IScriptEvent</a> is a script event boss that represents the actual event. This is what is dispatched through <a class="el" href="class_i_script_event_target.html">IScriptEventTarget</a> to <a class="el" href="class_i_script_event_listener.html">IScriptEventListener</a>.</ul><h3><a class="anchor" id="id_iscriptevent"></a> IScriptEvent</h3><p><a class="el" href="class_i_script_event.html">IScriptEvent</a> is the primary interface for an attachable event. It contains methods for initializing the event, getters and setters for the event&#39;s properties, and utility methods used internally during propagation of the event. When an event is dispatched, it is pushed onto the target&#39;s list of events using the <a class="el" href="class_i_script_event_target.html">IScriptEventTarget</a> interface (see below).<p>IID_ISCRIPTEVENT is aggregated to proxy script objects that represent an event in the scripting DOM. Most events use the the generic kBaseScriptEventBoss, but events that have additional properties may subclass this.<div class="fragment"><div class="line"><span class="comment">// Represents an attachable script event </span></div><div class="line">Class </div><div class="line"> { </div><div class="line"> kBaseScriptEventBoss, </div><div class="line"><a class="code" href="classk_base_proxy_script_object_boss.html">kBaseProxyScriptObjectBoss</a>, </div><div class="line"> { </div><div class="line"><span class="comment">// Implements an attachable script event </span></div><div class="line"> IID_ISCRIPTEVENT, kScriptEventImpl, </div><div class="line"><span class="comment">// Identifies this boss as an object in the scripting DOM </span></div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html#a6e31c93cd49a3b7b585bc0490a6cb635">IID_ISCRIPT</a>, kScriptEventScriptImpl, </div><div class="line"> } </div><div class="line"> } <span class="comment">// Represents an attachable script event for a scriptable idle task </span></div><div class="line">Class </div><div class="line"> { </div><div class="line"> kIdleTaskScriptEventBoss, </div><div class="line"> kBaseScriptEventBoss, </div><div class="line"> { </div><div class="line"><span class="comment">// Provides data specific to idle task script events </span></div><div class="line"> IID_IINTDATA, kIntDataImpl, </div><div class="line"> } </div><div class="line"> }</div></div><h3><a class="anchor" id="id_iscripteventlistener"></a> IScriptEventListener</h3><p><a class="el" href="class_i_script_event_listener.html">IScriptEventListener</a> is the primary interface for the boss that represents attached event handlers. It contains methods for initializing the event listener, getters and setters for the event listener&#39;s properties, and utility methods used internally during propagation of an event. When an event listener is created, it is pushed onto the target&#39;s list of event listeners using the <a class="el" href="class_i_script_event_target.html">IScriptEventTarget</a> interface (see below).<p>IID_ISCRIPTEVENTLISTENER is aggregated to the proxy script object that represents an event listener in the scripting DOM.<div class="fragment"><div class="line">Class { </div><div class="line"> kScriptEventListenerBoss, </div><div class="line"><a class="code" href="classk_base_proxy_script_object_boss.html">kBaseProxyScriptObjectBoss</a>, </div><div class="line"> {</div><div class="line"><span class="comment">// Implements a script event listener </span></div><div class="line"> IID_ISCRIPTEVENTLISTENER, kScriptEventListenerImpl, </div><div class="line"><span class="comment">// Identifies this boss as an object in the scripting DOM </span></div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html#a6e31c93cd49a3b7b585bc0490a6cb635">IID_ISCRIPT</a>, kScriptEventListenerScriptImpl, </div><div class="line"> } </div><div class="line">}</div></div><h3><a class="anchor" id="id_iscripteventtarget"></a> IScriptEventTarget</h3><p><a class="el" href="class_i_script_event_target.html">IScriptEventTarget</a> is the interface for objects that may be the target of attachable events&ndash;which is to say, all objects in the scripting DOM. For that reason, IID_ISCRIPTEVENTTARGET is automatically aggregated to every boss in the object model that has an IID_ISCRIPT interface. This interface includes methods to access events being dispatched on the object and event listeners attached to the object, along with utility methods used internally during propagation of an event.<p>Most clients of this interface will use only the DispatchScriptEvent method.<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> { kPreDispatch, kPostDispatch } </div><div class="line"></div><div class="line">InitCallbackType; </div><div class="line"><span class="keyword">typedef</span> void (*InitEventCallback)( <a class="code" href="class_i_script_event.html">IScriptEvent</a>* e, InitCallbackType t, <span class="keywordtype">void</span>* privateData );</div><div class="line"></div><div class="line"><span class="comment">// Dispatch an attachable event</span></div><div class="line"><span class="comment">// @param eventID - ID of the event </span></div><div class="line"><span class="comment">// @param initCallback - function to call before and after the event is dispatched</span></div><div class="line"><span class="comment">// @param privateData - private data to pass to the InitEventCallback function</span></div><div class="line"><span class="comment">// @return - none, but if default action is canceled by an event handler, </span></div><div class="line"><span class="comment">// sets the global error code to kCancel</span></div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> DispatchScriptEvent( <a class="code" href="class_i_d_type.html">ScriptElementID</a> eventID, InitEventCallback initCallback = nil, <span class="keywordtype">void</span>* privateData = nil ) = 0;</div></div><p>As its name suggests, this method is responsible for:<ul><li>Capturing the event&#39;s propagation chain, which consists of the target object and, for events that bubble, its ancestors in the scripting DOM.<li>Creating the event&#39;s proxy script object.<li>Dispatching the event to all event handlers that are registered for the event on each object in the propagation chain.<li>For cancelable events, detecting whether an event handler canceled the default behavior of the object model action that triggered the event</ul><p>For performance reasons, the process is aborted after the first step if there are no event listeners that will be triggered by the event.<p><b>Valid Targets</b><p>At the time an event is dispatched, the target object must be a valid scripting object, which is to say that it must be accessible via the scripting DOM. This point is particularly relevant when an event is related to the creation or deletion of an object. Before create and after delete events are discouraged because the target does not yet or no longer exists and it&#39;s confusing to dispatch the event on the parent.<p><b>Custom Event Properties</b><p>Some events have additional properties that either must be initialized prior to dispatch or are used to update the object model after the event finishes propagation. In this case, you may pass an InitEventCallback function to DispatchScriptEvent. The <a class="el" href="class_i_script_event.html">IScriptEvent</a> interface on the initialized event is passed to this function before and after propagation.<p>A good example of this is a mutation event. Its callback function is defined as a static method in <a class="el" href="class_i_script_mutation_data.html">IScriptMutationData</a>:<div class="fragment"><div class="line"><span class="keywordtype">void</span> InitMutationEventCallback( <a class="code" href="class_i_script_event.html">IScriptEvent</a>* e,<a class="code" href="class_i_script_event_target.html#a174a734ac34e9da977e4b65a67405ebc">IScriptEventTarget::InitCallbackType</a> t, <span class="keywordtype">void</span>* privateData ){</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_i_d_type.html">ScriptID</a>* propID = (<a class="code" href="class_i_d_type.html">ScriptID</a>*) privateData ;</div><div class="line"> ASSERT( propID ) ;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IScriptMutationData&gt;</a> mutationData( e, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>() ) ;</div><div class="line"> ASSERT( mutationData ) ;</div><div class="line"><span class="keywordflow">if</span> ( t == IScriptEventTarget::kPreDispatch ) {</div><div class="line"> mutationData-&gt;SetAttribute( *propID ) ;</div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> ( t == IScriptEventTarget::kPostDispatch )</div><div class="line"> {</div><div class="line"><span class="comment">//intentionally left empty (no read-write properties on the MutationEvent object)</span></div><div class="line"> }</div><div class="line">}</div></div><p>The code to dispatch the mutation event for a change in the name of an object might look like this:<div class="fragment"><div class="line"><a class="code" href="class_i_d_type.html">ScriptID</a> propID = p_Name ;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IScriptEventTarget&gt;</a> target( iScript, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>() ) ;</div><div class="line">target-&gt;DispatchScriptEvent( kAfterAttributeChangedEventScriptElement, &amp;<a class="code" href="class_i_script_mutation_data.html#a741e076fe7174dc9ecafb7c25e02fc27">IScriptMutationData::InitMutationEventCallback</a>, &amp;propID ) ;</div></div><h2><a class="anchor" id="id_notes"></a> Notes</h2><h3><a class="anchor" id="id_multithreading"></a> Multithreading</h3><p>Some tasks execute against a cloned document database on a thread with its own execution context. However, no supported background tasks trigger attachable events. Events related to document open, import or export, and so on are dispatched against the main execution context.<h3><a class="anchor" id=""></a></h3><p>Event listeners are attached via a scripting method, so you have to run a script to attach a script to be executed when an event occurs. Currently, the INX file format does not include a mechanism to execute a script, so you cannot use an INX file alone to attach a script.<p>INX/IDML import does trigger the dispatch of any events for which scripts have already been attached (by running a script). Export will not trigger any events because it doesn&#39;t change the model or view.<h2><a class="anchor" id="id_example"></a> Example</h2><p>The sample plug-in CustomScriptEvents shows how to create a custom script event. It allows scripts to listen for an event that is dispatched on InDesign when the current paragraph style list changes.<h1><a class="anchor" id="id_glossary"></a> Glossary</h1><p>Text in [brackets] is the chapter where the term is primarily used.<p><b>Absolute command</b><p>A command that modifies the model, specified as an absolute new value that the model is to take.<p><b>Abstract selection</b><p>The layer that allows client code to access and change attributes of selected objects. The abstract selection decouples client code from the need to know where or how these attributes are stored in the underlying model.<p>A class that represents the abstract selection and lets client code use suites to access or change selection attributes. If you add an interface to the abstract-selection boss class (through an add-in to <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a> class), user-interface code can query for this interface on the active selection and call methods to manipulate the selection target; for example, to change the attributes of a table or filter or sort its data.<p><b>ACE</b><p>[&quot;Graphics Fundamentals&quot;] Adobe Color Engine. Responsibilities include conversion between different color spaces.<p><b>Acquirer; acquirer filter</b><p>[&quot;XML Fundamentals&quot;] Responsible for translating an XML source into an XML stream.<p><b>Action</b><p>A piece of functionality that can be called through a menu component or keyboard shortcut. Plug-ins can implement actions that execute in response to an <a class="el" href="class_i_action_component.html#a0b9bf09bca0fa45a1e8ee0fbfa534a8b">IActionComponent::DoAction</a> message from the application framework.<p><b>Active context</b><p>The context the user has chosen to work with. There can be several views open, each with its own selection subsystem; however, only one view is active at a time. The active context is represented by the <a class="el" href="class_i_active_context.html">IActiveContext</a> interface and gives access to the key constructs, like the document, view, workspace, and selection manager.<p><b>Active layer</b><p>[&quot;Layout Fundamentals&quot;] The layer targeted for edit operations. New objects are assigned to the active layer.<p><b>Add-in</b><p>An ODFRez type expression with keyword AddIn that defines one or more interfaces (and their implementations) to be added to an existing boss class. An add-in lets you add functionality to an existing class; it allows you to extend the type system without defining a new class. Add-ins and boss classes are the two primary mechanisms for an extender of the application. Normally, implementing building blocks requires defining new add-ins and/or boss classes.<p><b>Aggregated interfaces; exposed interfaces</b><p>The set of interface/implementation pairs that compose a distinct boss class. A boss class aggregates (exposes) a set of interfaces; the exact behavior depends on the implementations of these interfaces. The API Reference shows the complete set of interfaces each boss class exposes. Some (or all) of the exposed interfaces on a boss class can come from add-ins, whereas others can be declared in the boss-class definition. A boss class aggregates an interface if it provides an implementation of that interface; it exposes an interface of a specific type. InDesign/InCopy interfaces are descendants of the <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> type. There are some abstract classes in the API that do not descend from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>, like <a class="el" href="class_i_event.html">IEvent</a>, and these cannot be reference-counted.<p><b>AGM</b><p>[&quot;Graphics Fundamentals&quot;] Adobe Graphics Manager. This is the core API used to draw vector graphics, perform rasterization, work with device-independent descriptions of graphics, and so on. AGM should be used for drawing anything that is to be printed or exported to a format that may later be printed, like PDF.<p><b>Anchor</b><p>The top-left element of a cell. An anchor is a location in the underlying grid and, therefore, it is represented by a <a class="el" href="class_grid_address.html">GridAddress</a>.<p><b>API</b><p>Application programming interface. Sometimes used as a shorthand for InDesign API.<p><b>Application</b><p>Executable program that loads plug-ins; a plug-in host. The program could be a product in the InDesign family: InDesign, InCopy or InDesign Server.<p><b>Application core</b><p>Software that performs functions like inviting plug-in panels to register, sending <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> messages to registered observers, and sending <a class="el" href="class_i_action_component.html#a0b9bf09bca0fa45a1e8ee0fbfa534a8b">IActionComponent::DoAction</a> messages when a particular action component is activated by a shortcut or menu item.<p><b>Application database, database</b><p>Where InDesign documents are stored. This is a fundamental provider of persistence to the application. It is a lightweight, object-oriented database that stores a tree of persistent boss objects. Each object in the database (except the root object) has another object (a parent object) that refers to it by UID and &quot;owns&quot; it, and has zero or more objects that simply reference it without any ownership. Refer to <a class="el" href="class_i_data_base.html">IDataBase</a> in the API Reference.<p><b>Application object model</b><p>Responsible (among other things) for loading and unloading plug-ins and managing the lifetimes of boss objects.<p><b>Applications</b><p>Executable programs that support the InDesign API.<p><b>ASB</b><p>See Abstract-selection boss (ASB).<p><b>Automatic undo and redo</b><p>The part of the InDesign architecture that takes over responsibility reverting and restoring the state of objects in the model at undo and redo.<p><b>Backdrop</b><p>[&quot;Graphics Fundamentals&quot;] One of the inputs used to calculate resultant colors for transparent objects. The object being blended with the backdrop conventionally is referred to as the source object. By convention, the backdrop is 100% white and 100% opaque.<p><b>Backing store</b><p>[&quot;XML Fundamentals&quot;] Storage for unpolished content and other key objects like the document element and root element. It can contain a DTD element, objects representing processing instructions and comments that are peers of the root element, and unplaced elements.<p><b>Binary plug-in</b><p>The result of compiling and linking the source for a plug-in; a shared library (DLL/framework) that supports a protocol allowing it to be loaded by the application.<p><b>Bitmap image</b><p>[&quot;Graphics Fundamentals&quot;] An image composed of small squares (pixels) on a grid. Each pixel defines its own color and is independent. Paint programs manipulate bitmap images. Same as Raster image.<p><b>Blend</b><p>[&quot;Graphics Fundamentals&quot;] A mixing of colors to produce interesting visual effects. Although blending can produce results similar to physical transparency, blending is not an attempt to model translucent materials directly.<p><b>Blending mode</b><p>[&quot;Graphics Fundamentals&quot;] Specifies how a transparent source object combines with other objects and the backdrop. For example, the normal blend specifies that the resultant backdrop color is simply the color of the corresponding point in the source object.<p><b>Blending space</b><p>[&quot;Graphics Fundamentals&quot;] The color space (user-specified) in which the colors are blended. Document RGB and document CMYK are the available choices.<p><b>Boss class</b><p>A class in the InDesign type system. Boss classes are the fundamental building blocks of the application object model. A boss class is a compound ODFRez type expression consisting of a set of interfaces and their implementations, some or all of which can come from add-ins. Boss classes support inheritance of implementation from a single superclass. Boss classes represent objects in the application domain and provide their behavior; for example, a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) or page (<a class="el" href="classk_page_boss.html">kPageBoss</a>). The term &quot;boss&quot; was coined for an entity that manages, or bosses, a collection of interfaces.<p><b>Boss-class definition</b><p>An ODFRez type expression with the keyword Class. There may be a superclass (or kInvalidClass if none) and a list of interface/implementation (PMIID/ImplementationID) pairs. Some or all of the interface/implementation pairs that compose a boss can come from add-ins. The boss-class definition is a single place where the core interfaces that compose a boss are declared, without considering add-ins.<p><b>Boss class factory, class factory</b><p>A method used by the application core to construct an instance of a boss class. CREATE_PMINTERFACE is where these methods are defined.<p><b>Boss DOM</b><p>Document object model specified in terms of boss classes and associations between them. The boss DOM contrasts with the scripting DOM, which is a somewhat more abstract model of the document.<p><b>Boss leak</b><p>The state in which a boss object&#39;s reference count is nonzero when the application quits. A boss leak usually is caused by mismatched AddRef-with-Release calls and/or unmatched QueryInterface/ Instantiate/ CreateObject-with-Release calls. A boss leak results in a memory leak. See also UID leak.<p><b>Boss-leak tracking</b><p>A debugging aid built into the applications to help find boss leaks.<p><b>Boss object</b><p>An instance of a boss class. At its lowest level, an InDesign document is structured as a graph of persistent boss objects, with relationships between them; for example, spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) and pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>). There also are boss objects that exist only in memory. For more information on how boss objects represent documents, see Chapter 7, &quot;Layout Fundamentals.&quot;<p><b>Boss-object hierarchy; hierarchy</b><p>A tree-structured organization of boss objects in parent-child relationships with one another. The API has several different types of hierarchy; each with its own characteristic interface to allow it to be traversed. The hierarchies commonly encountered the spread hierarchy traversed by <a class="el" href="class_i_hierarchy.html">IHierarchy</a>, the XML-element hierarchy traversed by <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>, and the scripting-DOM hierarchy traversed by <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>.<p><b>Bounding box</b><p>[&quot;Layout Fundamentals&quot;] The smallest rectangle (<a class="el" href="class_p_m_rect.html">PMRect</a>) that encloses a geometric page item.<p><b>Cell</b><p>Visual containers for content that appear to end users as the components of a table. A cell consists of one or more elements; each cell has an anchor. A cell corresponds to a <p>(table data) item in the HTML 4 table model.<p><b>Cell attribute</b><p>A boss class that represents an aspect specific to one or more cells.<p><b>Character-attributes strand</b><p>A strand that maintains formatting information for ranges of characters.<p><b>Child</b><p>[&quot;Layout Fundamentals&quot;] A page item contained within a parent. For example, a graphic page item is contained in a frame and is said to be a child of the frame.<p><b>CIE</b><p>[&quot;Graphics Fundamentals&quot;<p>Commission Internationale de l&#39;Eclairage (International Commission on Illumination). CIE has a technical committee, Vision and Color, which plays a leading role in colorimetry and defining color standards.<p><b>Class factory</b><p>See Boss class factory, class factory.<p><b>Client</b><p>Any code that interacts with the selection; typically, user-interface code. This includes widgets in palettes, menu items, actions, and tools. The interaction can include reflecting the value of a selection attribute, changing the attribute, or both.<p><b>Client code</b><p>Code written by a third-party plug-in developer that uses the InDesign/InCopy API to use the services of the application. Client code typically drives suites, processing commands or wrapper interfaces that in turn process commands, like <a class="el" href="class_i_table_commands.html">ITableCommands</a> and <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a>.<p><b>Code-based converter</b><p>A conversion provider that converts persistent data from one format to another, based on specific coded instructions. Generally, this is implemented as a subclass of <a class="el" href="class_c_conversion_provider.html">CConversionProvider</a>, which inherits from <a class="el" href="class_i_conversion_provider.html">IConversionProvider</a> and provides several housekeeping methods.<p><b>Color component</b><p>[&quot;Graphics Fundamentals&quot;] A coordinate in a given color space. A ColorArray item is used to represent the color components in the implementations of <a class="el" href="class_i_color_data.html">IColorData</a> interface. Colors defined in different color spaces may have different number of components; for example, four components in CMYK and three components in RGB.<p><b>Color model</b><p>[&quot;Graphics Fundamentals&quot;] The dimensional coordinate system used to numerically describe colors. Some models are RGB (red, green, blue), CMYK (cyan, magenta, yellow, black), HLS (hue, lightness, saturation), and L*a*b* (lightness, a, b). Color space also can refer to the range of colors in a particular color model. Also known as gamut.<p><b>Color space</b><p>[&quot;Graphics Fundamentals&quot;] Same as Color model.<p><b><a class="el" href="class_command.html">Command</a></b><p>Transactions that change the data model must be implemented as commands. A command in the API is a boss class with an <a class="el" href="class_i_command.html">ICommand</a> implementation and optional data interfaces. A custom command is an extension pattern you can implement to change aspects of the data model you may have contributed yourself. For example, if you add your own persistent interfaces somewhere in the boss document object model, you would implement custom commands to change these.<p><b>Comment, XML</b><p>[&quot;XML Fundamentals&quot;] A comment valid within an XML document (<a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a>).<p><b>Composite font</b><p>An extension of the basic PostScript font mechanism that enables the encoding of very large character sets and handles nonhorizontal writing modes. You can create a composite font that contains any number of base fonts.<p><b>Compound path</b><p>[&quot;Graphics Fundamentals&quot;] Two or more simple paths that interact with or intercept each other.<p><b>Compound shape</b><p>[&quot;Graphics Fundamentals&quot;] Two or more paths, compound paths, groups, blends, text outlines, text frames, or other shapes that interact with and intercept one another to create new, editable shapes.<p><b>Concrete selection</b><p>The layer underlying abstract selection that knows which objects are selected and how to access and change their attributes in the underlying model. Comprises one or more CSBs. See also CSB (concrete selection boss).<p><b>Container (structural) element</b><p>[&quot;XML Fundamentals&quot;] An XML element that does not itself have an associated content item but is intended to be an ancestor for other content items.<p><b>Container-managed persistent-boss object</b><p>An object stored in an application database, whose storage is managed by another UID-based persistent boss object. Examples are text attributes, graphic attributes, XML elements. None of these is associated with UIDs.<p><b>Content handler</b><p>[&quot;XML Fundamentals&quot;] Responsible for reading XML content from an input stream.<p><b>Content item</b><p>[&quot;XML Fundamentals&quot;] An object in a document that can be tagged. An object in the native document model that can be associated with an element in the logical structure. A content item is represented by boss classes with <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a>. Examples include placeholder items (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>), images (<a class="el" href="classk_image_item.html">kImageItem</a>), and stories (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). A text range within a story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) also is a content item, since it can be tagged.<p><b>Content page item</b><p>[&quot;Layout Fundamentals&quot;] A frame, path, group, or page item that represents another type of content that can be placed on a spread.<p><b>Content manager</b><p>The component that manages plug-ins that add content to documents (that is, any plug-in with persistent data that is saved to a document). The content manager (identified by the <a class="el" href="class_i_content_mgr.html">IContentMgr</a> interface) works with the conversion manager to determine whether data conversion is needed.<p><b>Control-data model</b><p>An aspect of a widget boss class that represents the data associated with a widget&#39;s state. The control-data model typically can be changed by an end user or through the API. The control-data model is associated with an interface named I&lt;data-type&gt;ControlData. For example, there is an <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface associated with text-edit boxes, the internal state of which is represented by a <a class="el" href="class_p_m_string.html">PMString</a>.<p><b>Control view</b><p>An aspect of a widget boss class that represents the appearance of a widget. It is associated with the <a class="el" href="class_i_control_view.html">IControlView</a> interface, which also can be used to change the visual representation of a given widget. For example, use this interface to vary the resources used in representing the states of an iconic button or to show/hide a widget.<p><b>Conversion manager</b><p>The component that manages persistent-data conversions between different versions of plug-ins. By comparing format numbers both in the persistent data and the currently loaded plug-in, the conversion manager finds the appropriate conversion provider, which determines whether conversion is needed and, if necessary, converts the data. This component is identified by the <a class="el" href="class_i_conversion_mgr.html">IConversionMgr</a> interface.<p><b>Conversion provider</b><p>A service provider that determines whether a data conversion needs to be performed and performs the appropriate conversions. This component is identified by the <a class="el" href="class_i_conversion_provider.html">IConversionProvider</a> interface. There are two types of conversion providers: schema-based and code-based.<p><b>CSB (concrete selection boss)</b><p>A class that encapsulates a selection format and supports access, change, and observation of the selected objects in its underlying model.<p><b>CSB suite</b><p>The suite implementation for a selection format that understands how to access and change some attributes of the selected objects in the underlying model.<p><b>Current spread</b><p>[&quot;Layout Fundamentals&quot;] The spread targeted for edit operations. New objects created by the user interface are contained in the current spread.<p><b>Data conversion</b><p>The process of converting persistent data in a database from one format to another.<p><b>Data flavor</b><p>Describes the data involved in data exchange, like cut-and-paste and drag-and-drop operations. Internal types are represented by PMFlavor; external types, ExternalPMFlavor. For a list of built-in types, see source/public/includes/PMFlavorTypes.h.<p><b>Database</b><p>See Application database, database.<p><b>Detail control</b><p>The process of varying the resolution of a user interface by varying the composition of the widget set or the size of elements in the interface. This capability is represented by <a class="el" href="class_i_panel_detail_controller.html">IPanelDetailController</a>.<p><b>Developer prefix; plug-in prefix</b><p>Identifier defining the range of 256 values in which you can define the unique identifiers in any ID space (for example, kClassIDSpace, kInterfaceIDSpace, and kImplementationIDSpace) required for your contributions to the object model. The prefix must be obtained from Adobe Developer Support before you can release your product, to ensure your plug-ins do not conflict with other plug-ins.<p><b>Dialog protocol</b><p>Message sequencing for dialog boss objects (<a class="el" href="classk_dialog_boss.html">kDialogBoss</a> and descendants). This protocol consists of messages delivered in this sequence: IDialogController::InitializeDialogFields, ValidateDialogFields, and ApplyDialogFields. A ResetDialogFields also may be sent, but only if the dialog is enabled to do so.<p><b>Direct model change</b><p>A call to a mutator method on a persistent interface.<p><b>DLL (dynamic-link library)</b><p>A library linked in at run time or load time, not at build time. Normally this is associated with the Windows operating system.<p><b>Document</b><p>[&quot;Layout Fundamentals&quot;] An InDesign document, unless otherwise stated. A publication that stores layout data. The content is organized in a set of spreads. Each spread has one or more pages on which page items are arranged. Page items are assigned to layers, which control whether the content is displayed or editable.<p><b>Document element</b><p>[&quot;XML Fundamentals&quot;] Element in the logical structure associated with the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>), represented by <a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>. A singleton instance of this class is present in the document &#39;s backing store. Be aware this is defined differently than &quot;document element&quot; in the XML 1.0 specification (<a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml </a>, <a href="http://www.w3.org/TR/REC-xml">), which is equivalent to</a><a href="http://www.w3.org/TR/REC-xml">&quot;root element in the InDesign XML API. </a><p><b>Document layer</b><p>[&quot;Layout Fundamentals&quot;] The objects shown in the Layers panel that, together with their corresponding spread layers in each spread, represent the layers in a document.<p><b>Document object model (DOM)</b><p>A specification for how objects in a document are presented. For example, the InDesign scripting DOM refers to sets of objects and properties that make up an InDesign document, including page items in the document hierarchy and various document preferences.<p><b>Document Type Declaration (DTD)</b><p>[&quot;XML Fundamentals&quot;] Defines the grammar for a class of documents. This is represented by <a class="el" href="classk_x_m_l_d_t_d_boss.html">kXMLDTDBoss</a>.<p><b>DollyXs</b><p>A plug-in developer productivity tool, written entirely in Java&amp;#8482;, which uses XSL templates to generate fundamental plug-in projects. Details on its use can be found in &lt;SDK&gt;/devtools/sdktools/dollyxs/Readme.txt.<p><b>DOM</b><p>See Document object model (DOM).<p><b>DTD</b><p>See Document Type Declaration (DTD).<p><b>Element</b><p>A unit item on the underlying grid of a table. An element may or may not have an anchor. Elements always have the unit (trivial) GridSpan(1,1). There is no corresponding entity in the HTML 4 table model.<p><b>Entity</b><p>[&quot;XML Fundamentals&quot;] Container for content in an XML document.<p><b>Event handler</b><p>Handler responsible for processing events and changing the data model of a widget. An event handler is equivalent to a controller. Unlike other APIs, in which you must extend an event handler to receive notification about control changes, there are very few circumstances in the InDesign/InCopy API in which overriding a widget event handler is required. Notifications about changes in control state are sent as <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> messages, because InDesign/InCopy update for every keystroke for edit boxes, if they are configured correctly in the ODFRez data statements.<p><b>Exposed interfaces</b><p>See Aggregated interfaces; exposed interfaces.<p><b>Extending</b><p>Subclassing. Boss classes and ODFRez types can be extended (subclassed).<p><b>Extension pattern</b><p>A software pattern that fits into an extension point for the application. It is associated with a well-defined purpose; for instance, to signal that a document was opened. Every plug-in should implement one or more extension patterns to do something useful. A common extension pattern is the service provider.<p><b>Extension point</b><p>A hook in the application for a plug-in developer, where you can plug an extension pattern so your implementation code gets called. For example, if you implement a specific extension pattern (Open-doc Responder), you can be called when documents are opened. The extension point in this example is in the code that opens documents. Extension points know about the extension patterns that plug into them.<p><b>Facing pages</b><p>[&quot;Layout Fundamentals&quot;] Used for publications like magazines, books, and newspapers that have both left-hand (verso) and right-hand (recto) pages.<p><b>Family name</b><p>The name of a font family; for example, Times, Courier, or Times New Roman. The group name and the family name always are the same.<p><b>Feather (vignette)</b><p>[&quot;Graphics Fundamentals&quot;] A transparency effect that ships with InDesign, that allows designers to create smooth, diffuse edges on frames.<p><b>Fill</b><p>[&quot;Graphics Fundamentals&quot;] Color or gradient applied to area inside a path.<p><b>Flatten</b><p>[&quot;Graphics Fundamentals&quot;] To remove the transparency information from the representation of what is to be drawn, leaving only a representation of the resulting color information at each point once blending is computed. Typically this is implemented by factoring the area to be printed into a set of atomic regions that can be printed with opaque inks.<p><b>Font</b><p>A collection of glyphs designed together and intended to be used together. See the <a class="el" href="class_i_p_m_font.html">IPMFont</a> interface.<p><b>Font family</b><p>A font group used within a document. See the <a class="el" href="class_i_font_family.html">IFontFamily</a> interface.<p><b>Font group</b><p>A collection of fonts designed together and intended to be used together. Font groups describe all fonts available to the application. Within a group, there might be several different stylistic variants. See the <a class="el" href="class_i_font_group.html">IFontGroup</a> interface.<p><b>Font group name</b><p>The name of a font group; for example, Times, Courier, or Times New Roman.<p><b>Format number</b><p>A tuple, defined in the PluginVersion ODFRez resource, that identifies the version of a persistent data format for a particular plug-in. The format number is different from the application version or a plug-in version number. Format numbers are incremented when changes to persistent data formats occur.<p><b>Frame</b><p>[&quot;Layout Fundamentals&quot; and &quot;Graphics Fundamentals&quot;] The page item (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) that acts as a container or placeholder for a graphic page item, text page item, or page item that represents content of another format. This is defined by one or more paths.<p><b>Frame content</b><p>[&quot;Graphics Fundamentals&quot;] Text or graphic object inside a frame. Fill is not frame content.<p><b>Frame list</b><p>Lists the text frames that are displayed.<p><b>Framework</b><p>See Resources; framework.<p><b>Front document</b><p>[&quot;Layout Fundamentals&quot;] The document displayed in the layout presentation the user is using to edit and view a publication.<p><b>Front view</b><p>[&quot;Layout Fundamentals&quot;] The layout view the user is using to edit and view a publication.<p><b>Generic identifier</b><p>[&quot;XML Fundamentals&quot;] Name of an element in an XML document, which corresponds to the tag name.<p><b>Geometric page item</b><p>[&quot;Layout Fundamentals&quot;] A page item with <a class="el" href="class_i_geometry.html">IGeometry</a> and <a class="el" href="class_i_transform.html">ITransform</a> interfaces that define its coordinate space.<p><b>Glyph</b><p>A shape used to represent a character code on screen or in print.<p><b>Gradient</b><p>[&quot;Graphics Fundamentals&quot;] Continuous, smooth, color transitions along a vector from one color (a gradient stop) to another (another gradient stop). The colors are defined only at the stops and interpolated elsewhere. A gradient may have two or more gradient stops.<p><b>Gradient stop</b><p>[&quot;Graphics Fundamentals&quot;] One of the points of a range over which a gradient is defined.<p><b>Graphic frame</b><p>[&quot;Layout Fundamentals&quot; and &quot;Graphics Fundamentals&quot;]- A frame that contains or is designated to contain a graphic page item. A placeholder for graphic content. The spline item wrapping a graphic or image. In the API, boss classes (for example, <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) that represent the behavior of graphic frames have the signature interface IGraphicFrameD ata.<p><b>Graphic page item</b><p>[&quot;Layout Fundamentals&quot; and &quot;Graphics Fundamentals&quot;] A page item that represents a picture of one format or another (for example, <a class="el" href="classk_image_item.html">kImageItem</a>). A page item that contains graphics. A graphic page item is the content of a graphics frame.<p><b>Group</b><p>[&quot;Layout Fundamentals&quot; and &quot;Graphics Fundamentals&quot;] A collection of two or more page items, which can be manipulated as a single entity. A transparency group is a group with at least one transparency-related attribute.<p><b>Group blending mode</b><p>[&quot;Graphics Fundamentals&quot;] The blending mode applied to blend a group of objects. This is independent of the blending modes of the group members.<p><b>Group opacity</b><p>[&quot;Graphics Fundamentals&quot;] An opacity attribute applied to a group of transparent objects. Grouping is performed with the rule that an object can belong to only one immediate group, although groups can contain other groups. The group opacity is independent of individual object opacities.<p><b>Guide</b><p>[&quot;Layout Fundamentals&quot;] An object used to help align and position other objects.<p><b>Headless document</b><p>[&quot;Layout Fundamentals&quot;] A document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) that has no layout presentation. Headless documents can be edited programmatically.<p><b>Heap corruption; memory trampling</b><p>When code illegally accesses memory. InDesign gives you some help in detecting this. All new memory in debug mode allocated with global new is cleared to 0xFBFB. If you see this as a value of a memory block (instance variable, etc.), this is a sign it was not initialized properly. All deallocated memory in debug mode is cleared to 0xEAEA. If you see this value in a memory block, you are using it after it was deleted. When a boss object is destroyed in debug mode, the application object model deletes each interface and sets the pointer to the interface to have the value 0xDEADBEEF. If you see 0xDEADBEEF as the value of a pointer, you have queried for an interface on a boss object that was in the process of being destroyed. When allocating memory with global new in debug mode, the actual memory allocated is bracketed by an extra head and a tail. Look at the ASCII value of memory, and search for &quot;Chck&quot; and &quot;Blck&quot; to see the block header and trailer.<p><b>Helper class</b><p>Partial implementation class; a C++ class in the API that provides most or all of the code required to implement a particular interface, like <a class="el" href="class_i_observer.html">IObserver</a>. A helper class may leave key method implementations to be filled in by the plug-in developer. For example, <a class="el" href="class_c_observer.html">CObserver</a> provides a basic implementation of <a class="el" href="class_i_observer.html">IObserver</a>. CActiveSelectionObserver provides a richer implementation for client code to observe changes in the active context.<p><b>Hierarchy</b><p>See Boss-object hierarchy; hierarchy.<p><b>Host</b><p>Application in which a client plug-in is loaded. Plug-ins can choose the hosts that should load them. For example, a plug-in may specify that it should load within both InDesign and InCopy.<p><b>Hybrid selection</b><p>The ability to select objects of differing selection formats simultaneously. An example of hybrid selection is selecting a frame containing a picture (a layout selection), adding a range of text (a text selection) to that selection, and then changing the color of both the frame and the text with one action. Hybrid selection is not yet supported. but the new selection architecture was implemented to accommodate it in the future by means of integrator suites.<p><b>ICC</b><p>[&quot;Graphics Fundamentals&quot;] International Color Consortium. Most notable for their characterization of the properties of hardware represented in ICC device profiles. For the specification of the ICC file format, see their Web site at <a href="http://www.color.org">http://www.color.org </a> .<p><b>ID space</b><p>A set of numeric values in which an identifier (for example, ClassID or ImplementationID) is defined. For example, kClassIDSpace identifies the set of numbers in which a ClassID can be defined; the values that can be used run from 0x0 to 0xFFFF. Likewise, an ImplementationID is defined in kImplementationIDSpace. The ID spaces are disjoint, so you can have the same number in two or more different spaces without a clash. You do need to ensure that identifiers you define are unique within the given ID space; obtain a developer prefix to achieve this.<p><b>IDE (integrated development environment)</b><p>An application or set of applications used to develop other computer applications. At the minimum, IDEs include a text editor, a compiler, a linker, and a debugger.<p><b>Idle task</b><p>One way to perform a background task within the application. An idle task is a function point that can called when the application is waiting to receive user events. Idle tasks are used to spread the load of CPU-bound tasks. For example, text composition is performed by an idle task, allowing the application to remain responsive to the user as text is being composed. See the <a class="el" href="class_i_idle_task.html">IIdleTask</a> interface.<p><b>Implementation</b><p>A C++ class that implements an interface. An implementation can either extend a partial implementation class or be based on <a class="el" href="class_c_p_m_unknown.html">CPMUnknown</a>.<p><b>IDML</b><p>InDesign Markup Language file format. Based on serializing objects defined in a scripting DOM tree to an XML-based format.<p>Implementation identifier<p>An identifier for a C++ implementation.<p><b>INCX</b><p>InCopy Interchange file format. An INCX file is a snippet file containing an InCopy story.<p><b>InDesign API</b><p>API for the InDesign platform, consisting of InDesign and related products.<p><b>Ink</b><p>[&quot;Graphics Fundamentals&quot;] Foundation colors that can make a color; for example, cyan, magenta, yellow, black, and spot inks.<p><b>Integrator suite</b><p>Suite implementation on an ASB called by client code to access or change attributes of the selection. An integrator suite forwards any member function call to its corresponding CSB suite on one or more CSBs.<p><b>Interface</b><p>An abstract C++ class in the API that extends <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. Interfaces are aggregated by boss classes and represent the capability or services a boss class provides to client code. (Exception: There are a handful of abstract C++ classes named IXXX that do not derive from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>; <a class="el" href="class_i_data_base.html">IDataBase</a> is a frequently encountered example.)<p><b>Invariant data</b><p>A data format that does not vary based on what is contained within. For example, if a data structure contains a field that identifies whether the next field is a string or an integer, that data structure is variant; otherwise, it is invariant.<p><b>INX</b><p>InDesign Interchange file format. Based on serializing objects defined in a scripting DOM tree to an XML-based format.<p><b>Isolated blending</b><p>[&quot;Graphics Fundamentals&quot;] A Boolean property of a group. An isolated group does not blend with the backdrop as individual elements, but rather blends as a group object. This is independent of knockout; a group can have both knockout and isolation-group properties.<p><b>Knockout group</b><p>[&quot;Graphics Fundamentals&quot;] A Boolean property of a group. Objects in a knockout group of transparent objects do not interact transparently with each other in calculating the blend color, but they do interact transparently with the backdrop. This is used in creating effects where the group as a whole is composited onto the background rather than mistakenly compositing elements onto each other.<p><b>Layer</b><p>[&quot;Layout Fundamentals&quot;] Either document (user-interface) layer or spread (content) layer. This is the abstraction that controls whether objects in a document are displayed and printed and whether they can be edited. A layer can be shown or hidden, locked or unlocked, arranged in front-to-back drawing order, etc. A page item is assigned to a layer. If a layer is shown, its associated page items are drawn; if a layer is hidden, its associated page items are not drawn. Layers affect an entire document: if you alter a layer, the change applies across all spreads. See <a class="el" href="class_i_document_layer.html">IDocumentLayer</a> and <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a> in the API Reference.<p><b>Layers panel</b><p>[&quot;Layout Fundamentals&quot;] The user interface for creating, deleting, and arranging layers.<p><b>Layout</b><p>[&quot;Layout Fundamentals&quot;] The spreads in a document that store the page items in a publication.<p><b>Layout hierarchy</b><p>[&quot;Layout Fundamentals&quot;] The hierarchy under each spread in a document, which controls how page items are stored and displayed.<p><b>Layout item; layout object</b><p>Page item.<p><b>Layout view</b><p>[&quot;Layout Fundamentals&quot;] The part of the layout presentation that presents the layout of a document. (This also is known as the layout widget.)<p><b>Layout presentation</b><p>[&quot;Layout Fundamentals&quot;] The user-interface window in which the layout of a document is presented for viewing and editing. The layout presentation contains the layout view and other widgets that control the presentation of the document within the view.<p><b>Lazy notification</b><p>A new notification mechanism. An observer can opt to observe a subject in the model lazily and get notified once per step. The notification is lazy in the sense that the observer gets notified after all commands in the step are processed. See <a class="el" href="class_i_observer.html#a60b1c9b1dcb9bc7d31083d7a7e840e72">IObserver::LazyUpdate</a>.<p><b>Link</b><p>An explicit relationship between a document object or part thereof and another entity (for example, external content, like an image or a hyperlink destination that is a text frame in another document). Links (represented by the type <a class="el" href="class_i_link.html">ILink</a>) can represent the path to a placed image; they also are used by the hyperlink subsystem and the book subsystem.<p><b>Logical structure</b><p>[&quot;XML Fundamentals&quot;] A tree of elements that represents the logical relationships between content items. The elements are represented by boss classes with the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface, which maintains the logical structure and allows it to be traversed. The logical structure also can contain a DTD element, processing instructions, and comments.<p><b>Low-level API</b><p>The API at the level of boss classes, interfaces, and partial-implementation classes.<p><b>Low-level event</b><p>Something like a window system occurrence or low-level input, like one keystroke.<p><b>Mask</b><p>[&quot;Graphics Fundamentals&quot;] A raster version of the outline of an object.<p><b>Master page</b><p>[&quot;Layout Fundamentals&quot;] A page that provides background content for another page. When a page is based on a master page, the page items that lie on the master page also appear on the page. A master page eliminates the need for repetitive page formatting and typically contains page numbers, headers and footers, and background pictures.<p><b>Master spread</b><p>[&quot;Layout Fundamentals&quot;] A special kind of spread that contains a set of master pages.<p><b>Matrix</b><p>See Transformation matrix; matrix.<p><b>Memory trampling</b><p>See Heap corruption; memory trampling.<p><b>Message protocol</b><p>The IID sent with the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message. An observer listens along a particular protocol; it is merely a way of establishing a filter on the semantic events about which an observer might be informed.<p><b>Messaging architecture</b><p>How client code can be written to receive notifications from the application core when widget data models change. The main architecture of interest uses the observer pattern.<p><b>Mixed ink</b><p>[&quot;Graphics Fundamentals&quot;] An ink defined as a mixture of process-color inks and spot-color inks.<p><b>Model</b><p>Persistent boss objects and persistent interfaces that represent a feature and are stored in a database that supports undo. Also, from the perspective of selection, the commands that mutate this data are part of the model. There may be several distinct yet related models in a document. For example, the layout model represents layout and stories, their text models represent text and tables, and their table model represents tables and so on. A selection format sits atop each distinct model that contains selectable objects.<p><b>Model notification</b><p>Indicates to observers that one or more objects in the model have changed.<p><b>Native document model</b><p>Specifies how end-user documents are represented within the InDesign API. It consists of a hierarchy of persistent boss objects, with a root node of class <a class="el" href="classk_doc_boss.html">kDocBoss</a>.<p><b>Nesting</b><p>The containing of one object within another object. Three kinds of nesting are common: paths inside frames, frames inside frames, and groups inside groups. You can also use combinations of paths, frames, and groups to build hierarchies of nested objects.<p><b>Object model</b><p>Model responsible for (among other things) loading and unloading plug-ins and managing the lifetimes of boss objects.<p><b>Observer</b><p>An abstraction (represented by the <a class="el" href="class_i_observer.html">IObserver</a> interface) that listens for changes in a subject. Typically, implementations use <a class="el" href="class_c_observer.html">CObserver</a> or one of its subclasses to implement an <a class="el" href="class_i_observer.html">IObserver</a> interface, which can listen for changes in the control-data model of a subject (<a class="el" href="class_i_subject.html">ISubject</a>) and respond appropriately. The observer pattern is central to the messaging architecture.<p><b>ODF</b><p>OpenDoc Framework, a cross-platform software effort initiated by Apple and IBM that defined an object-oriented extension of the Apple Rez language to specify user-interface resources.<p><b>ODFRC</b><p>OpenDoc Framework Resource Compiler, the SDK-supplied compiler for framework resource (.fr) files.<p><b>ODFRez</b><p>OpenDoc Framework Resource Language, which allows cross-platform resources to be defined for plug-ins. Boss classes and add-ins must be defined in ODFRez, along with data statements defining scripting entities, menu elements, user-interface widgets, and so on. The SDK tool DollyXs can generate ODFRez.<p><b>ODFRez custom-resource type</b><p>The type defined in the top-level framework resource file and typically populated in data statements in the localized framework resource files.<p><b>ODFRez data statement</b><p>An expression in ODFRez other than a type expression. It can define the properties of a given widget or a key/value pair in a string table.<p><b>Opacity</b><p>[&quot;Graphics Fundamentals&quot;] Defined as (1-transparency), in a continuous range [0,1], with 0 being entirely opaque and 1 entirely transparent.<p><b>Owned-item strand</b><p>A strand that maintains information on objects inserted into the text flow, like inline frames.<p><b>Ownership relation</b><p>Parent-child relationship between two classes. For example, spreads (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) own spread layers (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>).<p><b>Page</b><p>[&quot;Layout Fundamentals&quot;] The object in a spread on which page items are arranged.<p><b>Page item</b><p>[&quot;Layout Fundamentals&quot;] An object that can participate in a layout; for example, a graphic frame or text frame. This represents content the user creates and edits on a spread, like a path, a group, or a frame and its content.<p><b>Pages layer</b><p>[&quot;Layout Fundamentals&quot;] The layer to which pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) are assigned.<p><b>Pages panel</b><p>[&quot;Layout Fundamentals&quot;] The user interface for creating, deleting, and arranging pages and masters.<p><b>Palette</b><p>A floating window that is a container for one or more panels. A palette can be dragged around, and its children can be reordered.<p><b>Panel</b><p>A container for widgets. The Layers panel is an example. Panels can reside in tabbed palettes.<p><b>Paragraph-attributes strand</b><p>A strand that stores paragraph boundaries and formatting information for ranges of paragraphs.<p><b>Parcel</b><p>A lightweight container associated with at most one text frame, into which text can be flowed for layout purposes. A parcel can be considered a lightweight text frame; however, a parcel has geometry information, so it is not a page item, nor is it UID-based.<p><b>Parcel list</b><p>A list of the parcels associated with a story thread.<p><b>Parent</b><p>[&quot;Layout Fundamentals&quot;] A page item that contains other page items. For example, a frame that contains a graphic page item is the parent of that graphic page item.<p><b>Parent widget</b><p>A container widget; a widget that contains another widget. The parent widget can determine when the children draw and which of the children receive events.<p><b>Pasteboard</b><p>[&quot;Layout Fundamentals&quot;] The area that surrounds the pages of a spread. Page items can be positioned on the pasteboard for temporary storage.<p><b>Path</b><p>[&quot;Layout Fundamentals&quot; and &quot;Graphics Fundamentals&quot;] A set of straight and/or curved segments. These segments can connect to one another at anchor points (to form closed shapes like rectangles, ellipses, or polygons) or be disconnected. A path comprises one or more segments, each of which may be straight or curved. A path can be open or closed.<p><b>Path page item</b><p>[&quot;Graphics Fundamentals&quot;] A page item that defines its paths. The most common path page item is the spline item, which represents such path types as lines, curves, and polygons.<p><b>Persistence</b><p>This is defined by Wiktionary as: &quot;Property of some data to continue existing after the execution of the program.&quot; See Database.<p><b>Persistent boss object</b><p>A boss object that saves its state between sessions. Persistent boss objects store their state to an application database through persistent interfaces.<p><b>Persistent data</b><p>Data stored in a database and retained between sessions. InDesign publication files are referred to as databases. Types of persistent data include preferences, page item, and text data, as well as user-interface states.<p><b>Persistent interface</b><p>A boss class aggregates interfaces, some of which may be persistent. An interface is persistent to the application object model when CREATE_PERSIST_PMINTERFACE is used in the implementation code when defining it. It must call PreDirty before it changes a persistent member, and it must implement a ReadWrite() method to deserialize and serialize an instance of the class. For example, the <a class="el" href="class_i_control_view.html">IControlView</a> interface on widget boss objects always is persistent. This is why every widget has at least one CControlView field in the ODFRez data-to set up its initial state, such as widget ID, whether it is enabled, or whether it is visible (properties common to all widgets).<p><b>Placed element; placed content</b><p>[&quot;XML Fundamentals&quot;] An element associated with document content; that is, with a content item in the layout. There is a small visual indicator in the Structure view that indicates whether an element is associated with a placed-content item. In terms of the model, this means the <a class="el" href="class_i_i_d_x_m_l_element.html#a4fcb17aaad001b1e82cae3a87d3f440a">IIDXMLElement::GetContentItem</a> returns something other than kInvalidUID. This is contrasted with unplaced element.<p><b>Placeholder</b><p>[&quot;XML Fundamentals&quot;] A target for XML import. It can be a graphic frame that has a tag applied to identify it as a target for content from an XML import. If a text container is marked up, the placeholder is the story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) rather than the containing frame.<p><b>Plug-in</b><p>A library that extends or changes the behavior of the application and follows the rules for extending the application. On Windows, a plug-in is a DLL; on Mac OS, a framework. Plug-ins are loaded and managed by the application object model.<p><b>Plug-in prefix</b><p>See Developer prefix; plug-in prefix.<p><b>PostScript points</b><p>[&quot;Layout Fundamentals&quot;] The standard internal measurement unit, equal to 1/72 inch. All measurements stored in databases are stored using PostScript points as the unit.<p><b>Predirty</b><p>Indicates to the application object model that persistent data is about to change. As of Creative Suite 3, a mutator method on a persistent interface just call PreDirty() before changing any persistent data.<p><b>Primary-story thread</b><p>The main flow of text that is not for table cells or other features that store text in the story.<p><b>Process color</b><p>[&quot;Graphics Fundamentals&quot;] (i) A scheme used to print full-color images, typically with four passes through the printing press, one for each ink color. (ii) A single color within the CMYK system; for example, cyan. The term is used within the user interface as a shorthand for a color intended to be printed with process color as in definition (i).<p><b>Processing instruction (PI)</b><p>[&quot;XML Fundamentals&quot;] Instruction for an application. PIs take the form &lt;?application-name ... ?&gt;.<p><b>Proxy image</b><p>[&quot;Graphics Fundamentals&quot;] A screen-resolution bitmap image with which the end user can view designs on the screen faster than with the original image.<p><b>Pseudo-buttons</b><p>Items that have a button-like facility, like being responsive to mouse clicks, but that are intended as image-based buttons rather than text-labeled buttons.<p><b>Publication</b><p>[&quot;Layout Fundamentals&quot;] A document that stores layout data. The page items are organized in a set of spreads. Each spread has one or more pages on which content is arranged. Page items are assigned to layers that control whether the content is displayed or editable.<p><b>Raster image</b><p>[&quot;Graphics Fundamentals&quot;] See Bitmap image.<p><b>Regular notification</b><p>Notification broadcast immediately after the model is modified by a command. After the command &#39;s Do() method returns, its DoNotify() method is called. This method initiates the broadcast and observers are called. See <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update()</a>.<p><b>Relative command</b><p>A command that modifies data in the model by some delta; for example, a command that increased the point size of text by 1.<p><b>Rendering intent</b><p>[&quot;Graphics Fundamentals&quot;] Methods or rules for converting from one color space to another. Examples of rendering intent include perceptual, saturation, relative colorimetric, and absolute colorimetric.<p><b>Repeating element</b><p>[&quot;XML Fundamentals&quot;] An element with the same tag name as its previous sibling.<p><b>Resources; framework</b><p>Initializes widgets, and are held in files written in ODFRez. These files also contains locale-specific information that allows user interfaces to be localized. Platform-specific resources (defined in an .rc, .r, or .rsrc file) play a very small role in InDesign plug-ins and typically are used only for icons or images in image-based widgets.<p><b>Revision history</b><p>Records the state required for undo and redo of changes made to objects in a database that supports undo. Includes snapshots of the persistent interfaces modified by commands during a step. The database and its revision history are associated but distinct states<p><b>Root element</b><p>[&quot;XML Fundamentals&quot;] Top-level XML element in the logical structure of a document. This is a child of the document element.<p><b>Ruler guide</b><p>[&quot;Layout Fundamentals&quot;] A horizontal or vertical guide line used to align or position objects on a spread.<p><b>Run</b><p>Strands are subdivided into runs. Run lengths differ depending on the strand. For example, a text-data strand uses runs to split character data into manageable chunks, and a character-attribute strand uses runs to indicate formatting changes.<p><b>SBOS (small boss object store)</b><p>[&quot;XML Fundamentals&quot;] Where the objects representing XML elements are held. It is an example of container-managed persistence.<p><b>Schema</b><p>An ODFRez resource that contains metadata about a persistent data format. There are various kinds of resources.<p><b>Schema-based converter</b><p>A conversion provider that converts persistent-data formats from one format to another based on format numbers in a document and plug-ins, along with instructions given in schema resources.<p><b>Script ID value</b><p>A concise identifier for an element from the DOM. This is a four-character value (32-bit integer), like &quot;docu&quot; or &quot;colr.&quot;<p><b>Script ID name</b><p>A verbose identifier for an element from the DOM. This is the full name of the element, like &quot;document&quot; or &quot;color.&quot;<p><b>Scripting DOM</b><p>View of the document-object model seen through the scripting subsystem (<a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>).<p><b>Scripting DOM tree</b><p>An instance of a document, described from the scripting subsystem&#39;s perspective. At its root is the document object (<a class="el" href="classk_doc_boss.html">kDocBoss</a>, with the <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interface), which has element name &quot;docu&quot; in the scripting DOM.<p><b>SDK</b><p>The combined software development kit for InDesign and related products. When stated as &lt;SDK&gt; in a path, it refers to the InDesign SDK installation location.<p><b>Section</b><p>[&quot;Layout Fundamentals&quot;] A range of pages with a defined set of properties that control how the pages within that section are numbered. For example, a section can have its own starting page number and numbering style such as Roman or Arabic.<p><b>Segment</b><p>[&quot;Graphics Fundamentals&quot;] A curve or line connecting two path points.<p><b>Selection attribute</b><p>A property of a selectable object, like stroke color, height, or opacity.<p><b>Selection extension</b><p>An extension that can be made to a suite implementation when advanced features are needed.<p><b>Selection format</b><p>The model format of a selectable object. Examples of selection formats are layout (page items), text, table cells, and XML structure.<p><b>Selection manager</b><p>The abstraction <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> that manages a selection subsystem.<p><b>Selection notification</b><p>Indicates that either the set of objects selected by the user changed (for example, a frame was selected or deselected) or a property of these objects changed (for example the stroke color of selected frames changed). See ActiveSelectionObserver().<p><b>Selection observer</b><p>The abstraction <a class="el" href="class_active_selection_observer.html">ActiveSelectionObserver</a> that allows client code to be notified when the selection changes.<p><b>Selection subsystem</b><p>The abstraction responsible for managing selection in a particular view.<p><b>Selection target</b><p>The means by which a selection format identifies the set of objects that are selected.<p><b>Semantic event</b><p>Directly corresponds to high-level user interactions with a user-interface component. Clicking a button is an example of a semantic event. These events are communicated to client code through <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> messages with various protocols, like IID_IBOOLEANCONTROLDATA for a button click, and other message parameters.<p><b>Service provider</b><p>A class that provides a service identified by a specific ServiceID. It aggregates an implementation of the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface and a second provided interface. For example, an export-provider service provides the <a class="el" href="class_i_export_provider.html">IExportProvider</a> interface.<p><b>Session</b><p>Depending on context, this can mean the period of use of the application between starting up and shutting down or the session boss object (instance of <a class="el" href="classk_session_boss.html">kSessionBoss</a>), referred to through global variable gSession of type ISession*.<p><b>Smart pointer</b><p>A construct that automatically manages the lifetime of the object it encapsulates. At a minimum, it should provide an implementation of the -&gt; operator that can be used as a pointer. It also can provide an implementation of the * (dereference) operator. In the context of the InDesign API, smart pointers, like InterfacePtr&lt;T&gt;, implement the necessary reference-counting behavior to avoid memory leaks and controlled access to memory. There also are other smart pointers in the InDesign API, like <a class="el" href="class_tree_node_ptr.html">TreeNodePtr</a> and <a class="el" href="class_k2_1_1scoped__ptr.html">K2::scoped_ptr</a>.<p><b>Snapshot</b><p>A copy of the state of an interface at a particular time. Snapshots of interfaces are kept in the revision history for the database, to support undo and redo.<p><b>Snippet, XML snippet</b><p>XML-based file containing a definition of one or more objects in an InDesign document. Snippet files are standalone assets that can range from defining a spot-color swatch to a group of page items or an InCopy story (ICML) file. For more information, see Chapter 9,&quot;Snippet Fundamentals.&quot;<p><b>Spot color</b><p>[&quot;Graphics Fundamentals&quot;] A color intended to be printed with its own individual ink.<p><b>Spread</b><p>[&quot;Layout Fundamentals&quot;] The primary container for layout data; a collection of pages that belong together in a document. A spread contains a set of pages on which page items that represent pictures, text, and other content are arranged. The pages can be kept together to form an island spread, a layout that spans multiple pages.<p><b>Spread layer</b><p>[&quot;Layout Fundamentals&quot;] The object (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>) in a spread used to realize layers.<p><b>Standard buttons</b><p>Buttons that descend from <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a>.<p><b>Story</b><p>A piece of textual content.<p><b>Story thread</b><p>A range of text in the text model that represents a flow of text content. There can be multiple flows of text content stored in the text model-the main flow and one flow per table cell for the tables embedded in the story.<p><b>Story-thread strand</b><p>A strand that stores the content boundaries of story threads within a story.<p><b><a class="el" href="class_strand.html">Strand</a></b><p>Parallel sets of information that, when combined, provided a complete description of the text content in a story.<p><b>String table</b><p>A collection consisting of key/value pairs for a specific locale, which contain the strings that may be displayed in the user interface by the plug-in and are candidates for localization. A string table is represented in a plug-in by an instance of the ODFRez custom-resource type StringTable.<p><b>Stroke</b><p>[&quot;Graphics Fundamentals&quot;] The outline of a path, with characteristics like color, weight, and stroke type, that affect the visual presentation of the path.<p><b>Style</b><p>A collection of text attributes. There are paragraph styles and character styles. Styles are defined in a hierarchy. The root style contains a value for all attributes. Leaf styles define differences from their parent.<p><b>Style name</b><p>The name of a stylistic variant. Typically, the Roman-also called Plain or Regular-member of a font group is the base font; the name varies from group to group. The group might include variants like Bold, Semibold, Italic, and Bold Italic.<p><b>Stylistic variant</b><p>A difference in the appearance-other than size-of a font in a font group.<p><b>Subject</b><p>An abstraction that is the target for the attention of observers. In the user-interface API, widget boss objects are the typical subjects.<p><b>Subject identifier</b><p>A means of uniquely identifying the selected objects for a selection format. For example, layout page items have a subject identifier similar to a <a class="el" href="class_u_i_d_list.html">UIDList</a>, and text uses a story UID and a text range. All boss classes, interfaces, and relationships that contribute to the functioning of a selectable object also are part of that selectable object&#39;s selection format. This also includes commands and observers.<p><b>Suite</b><p>A suite interface is an interface that lets you manipulate the properties of an abstract selection. See the interfaces aggregated on <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>. Suite interfaces represent a level of abstraction between the low-level API and the high-level (scripting DOM&acirc;&#128;&#147;based) API. Implement a custom suite if you need to interact with the model behind a selection.<p><b>Suite boss class</b><p>Boss classes to which suite interfaces get added. These extend the set of attributes of selected objects that can be accessed and changed.<p><b>Swatch</b><p>[&quot;Graphics Fundamentals&quot;] A representation of color-related objects that end users manipulate. A swatch can represent a process color, spot color, gradient, tint, or mixed ink.<p><b>Table attribute</b><p>A boss class that represents an attribute for an entire table.<p><b>Table frame</b><p>A composed piece of the table that exists in a parcel or text column. In general, header and footer rows repeat in all table frames with at least one body row.<p><b>Table iterator</b><p>An abstraction that allows sequential access to the cells in a table. Table iterators return references to <a class="el" href="class_grid_address.html">GridAddress</a> objects for anchor cells. There are forward and reverse variants that can be used to traverse a table from beginning to end or from end to beginning, both using the same increment operator (++ ). These are STL-like iterators.<p><b>Table layout</b><p>Represents the composed state of the table. The composer creates layout rows as rows are composed. One model row can map to one or more layout rows.<p><b>Tag</b><p>[&quot;XML Fundamentals&quot;] Stores tag names of elements and the color in which they appear in the user interface (see <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>).<p><b>Tag collection; tag list</b><p>[&quot;XML Fundamentals&quot;] The set of tags that can participate in the logical structure of a document. Represented in the API by <a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>, stored in a workspace (for example, <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).<p><b>Tagged content item</b><p>[&quot;XML Fundamentals&quot;] An instance of a content item that has been subject to tagging. In terms of the model, this means <a class="el" href="class_i_x_m_l_reference_data.html#a56456c882f5bfd468633b7484a33d293">IXMLReferenceData::GetReference</a> would return a valid <a class="el" href="class_x_m_l_reference.html">XMLReference</a>.<p><b>Tagging</b><p>[&quot;XML Fundamentals&quot;] The process of applying mark-up to content items. This has no connection with tagged text, a format not based on XML that the applications use to import and export styled text. Content items that can be tagged aggregate the <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> interface.<p><b>Text attribute</b><p>A property of text, like point size, font, color, or left indent. Identified by a ClassID, such as <a class="el" href="classk_text_attr_point_size_boss.html">kTextAttrPointSizeBoss</a>.<p><b>Text composition</b><p>Flows textual content in story threads into a layout, which is represented by parcels in a parcel list, creating the wax as output.<p><b>Text-data strand</b><p>A strand that stores characters in Unicode encoding.<p><b>Text frame</b><p>[&quot;Layout Fundamentals&quot;] A frame that displays or is designated to display text.<p><b>Text page item</b><p>[&quot;Layout Fundamentals&quot;] The page item that represents a visual container that displays text.<p><b>Text model</b><p>Holds the textual content of a story (character codes, their formatting, and other associated data) as separate but related strands.<p><b>Tint</b><p>[&quot;Graphics Fundamentals&quot;] A percentage of a color. Tint also can be defined over an already-tinted color.<p><b>Tool</b><p>Abstraction an end user experiences in the toolbox window of the user interface; represented in the API by <a class="el" href="class_i_tool.html">ITool</a> For example, the Text tool can be used to create text frames. You can add custom tools to extend the applications that have a user interface. For more information, see Chapter 17,&quot;Tools.&quot;<p><b>Top-level FR file</b><p>The file that is included in the compilation as a custom build element. In SDK samples, these are called &lt;plug-in-short-name&gt;.fr; for example, BscMnu.fr.<p><b>Transform</b><p>For a page item, the <a class="el" href="class_i_transform.html">ITransform</a> interface stores mapping between inner coordinates of the page item and its parent in the spread hierarchy. See Chapter 7, &quot;Layout Fundamentals.&quot; See also <a class="el" href="class_i_transform.html">ITransform</a> and <a class="el" href="class_p_m_matrix.html">PMMatrix</a>.<p><b>Transformation matrix; matrix</b><p>[&quot;Layout Fundamentals&quot;] A matrix that specifies the relationship between two coordinate spaces, giving a linear mapping of one coordinate space to another coordinate space (<a class="el" href="class_p_m_matrix.html">PMMatrix</a>).<p><b>Type binding</b><p>An association between a widget boss class and an ODFRez custom-resource type. Alternately, interfaces can be bound to ODFRez custom-resource types (by the identifier IID_&lt;whatever&gt;) that compose more complex types. This type binding occurs in the context of an ODFRez type expression. For example, the type expression defining the ODFRez type ButtonWidget binds it to <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> (see the API header file Widgets.fh for many examples of this). The ODFRez type delineates how the data is laid out in a binary resource for the widget boss class to deserialize itself. That is, the ButtonWidget type specifies the layout for data that allows an instance of <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> to read its initial state from the binary resource. When an interface is bound to an ODFRez custom-resource type, it is expected that the implementation in the boss class reads its initial state from the fields defined in the ODFRez custom-resource type. When the plug-in resource is being parsed for the first time, the type information represented in the binary resource provides sufficient information for the application core to make an instance of the correct type of widget and give it the intended widget ID. By reading the data in the resource, that is effectively a serialized form of the widget boss object.<p><b>UID</b><p>Unique identifier; an identifier for a persistent boss object that is unique within a given InDesign document, equivalent to a record number within the document&#39;s database. Not all persistent boss objects have a UID-only those that expose <a class="el" href="class_i_p_m_persist.html">IPMPersist</a>. Other persistent boss objects may be managed by a UID-based object; for example, XML elements (see <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>).<p><b>UID leak</b><p>The state in which a boss object has been orphaned from the boss object that owns it, which may have been deleted. A UID leak is a potentially serious condition, because it means the underlying document in which the object is stored can become corrupt. See also Boss leak.<p><b><a class="el" href="class_u_i_d_ref.html">UIDRef</a></b><p>Reference to a persistent boss object, composed of a reference to an application database (<a class="el" href="class_i_data_base.html">IDataBase</a>) and UID. See the API reference documentation for <a class="el" href="class_u_i_d_ref.html">UIDRef</a>. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> works only for UID-based persistent boss objects; how you refer to container-managed persistent boss objects depends on the container.<p><b>Underlying grid</b><p>The coarsest grid that can contain all cell edges for a given table, with the constraint that each cell in the underlying grid has trivial GridSpan(1,1).<p><b>Unplaced element; unplaced content</b><p>[&quot;XML Fundamentals&quot;] An element in the logical structure with no associated content item. These are associated with text or reference images but are not in the document layout and are not linked to items in the native document model.<p><b><a class="el" href="class_utils.html">Utils</a> boss</b><p>The <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> boss class, which exposes utility interfaces that span the application domain. There is a smart pointer class, <a class="el" href="class_utils.html">Utils</a>, that makes it easier to access interfaces on this boss class. Along with the suite interfaces, you should look first at the utility interfaces when looking for a particular capability.<p><b>Value-name look-up table</b><p>A table that takes the Script ID value as input and returns the Script ID name. Specifically, this refers to <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a> or Scripting Reference and the INX-specific script ID names and values.<p><b>Vector graphics</b><p>[&quot;Graphics Fundamentals&quot;] Graphic objects made up of lines and curves defined mathematically. These objects are not converted to pixels until they are displayed or printed. Drawing programs enable you to create and manipulate vector graphics.<p><b>Vignette</b><p>[&quot;Graphics Fundamentals&quot;] See Feather (vignette).<p><b>Wax</b><p>The output of text composition that draws text.<p><b>Wax strand</b><p>A strand that stores the composed representation of text that can be drawn and selected. The wax strand is the result of composition.<p><b>Widget</b><p>This term is particularly prone to confusion and is qualified in this document to make its meaning clear. For example, &quot;static text widget&quot; is highly ambiguous and could refer to one of at least four things: the boss class that provides the behavior (<a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a>), an instance of this boss class, the ODFRez custom-resource type StaticTextWidget, or an instance of this ODFRez type used to specify initial state and properties of a <a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a> object.<p><b>Widget boss class</b><p>Boss classes that derive from the <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>. They are typically, but not invariably, named k&lt;Widgetname&gt;WidgetBoss. The only difference between a widget boss class and a normal boss class is that a widget boss class can be associated with an ODFRez custom-resource type through an associating or type binding. The ODFRez type is concerned with the layout of plug-in resource data, so a widget boss object can be correctly instantiated and initialized by the application framework. The ODFRez type defines the data required to correctly deserialize a particular widget boss object from the plug-in resource.<p><b>Widget boss object</b><p>An instantiated widget boss class. Because it is aggregated on any widget boss object that has a visual representation, the most common way to manipulate widget boss objects from client code is through an <a class="el" href="class_i_control_view.html">IControlView</a> pointer.<p><b>Widget notification</b><p>Indicates that a user-interface object, like a button or check box, has changed state.<p><b>Window-paning</b><p>X-join of stripes where the stripes do not overlap in the intersection; that is, the middle stripes meet in an X, and the outer stripes meet the adjoining outer stripes, so no stripes draw over each other.<p><b>Workflow user model</b><p>Web-based Distributed Authoring and Versioning (WebDAV), which is a set of extensions to the HTTP protocol that allows users to collaboratively edit and manage files on remote web servers.<p><b>XML (Extensible Markup Language)</b><p>[&quot;XML Fundamentals&quot;] A metalanguage for defining mark-up languages. The specification for current version is defined as the W3C Recommendation (see <a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml </a> ).<p><b>XML data</b><p>[&quot;XML Fundamentals&quot;] Content defined in an XML-based language<p><b>XML element</b><p>[&quot;XML Fundamentals&quot;] A node in the logical structure of a document. XML elements are represented by boss classes with the signature interface <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>.<p><b>XML element, existing</b><p>[&quot;XML Fundamentals&quot;] An element in an XML template (an InDesign document), which may receive content as a result of import or be deleted subject to import options.<p><b>XML element, incoming</b><p>[&quot;XML Fundamentals&quot;] An element in the input XML, which may replace content of an existing element in the XML template or be deleted subject to import options.<p><b>XML snippet</b><p>[&quot;XML Fundamentals&quot;] See Snippet, XML snippet.<p><b>XML template</b><p>[&quot;XML Fundamentals&quot;] An InDesign document with tagged placeholders into which XML data can be flowed. Using XML templates avoids end users having to manually place content or mark up content manually once it is imported.<p><b>XMP SDK</b><p>Extensible Metadata Platform software development kit, a facility for software developers to create and store their own metadata.<p><b>XP</b><p>[&quot;Graphics Fundamentals&quot;] Refers to transparency boss classes and interface names. This not be confused with other potential meanings, such as cross-platform or Windows XP.<p><b>XSLT (Extensible Stylesheet Language Transformations)</b><p>[&quot;XML Fundamentals&quot;] The specification for the current version is defined as the W3C Recommendation (see <a href="http://www.w3.org/TR/xslt">http://www.w3.org/TR/xslt </a>).<p><b>Z-order</b><p>[&quot;Layout Fundamentals&quot;] The order in which objects are drawn, which determines which object is in the foreground when objects are stacked. </div></div></div><div class="navpath" id="nav-path"><ul><li class="footer">Generated on Sat Sep 22 2018 10:52:56 for InDesign SDK by <a href="http://www.doxygen.org/index.html"> <img alt="doxygen" class="footer" src="doxygen.png" /></a> 1.8.3.1 </ul></div></body></html>

<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/xhtml;charset=UTF-8" http-equiv="Content-Type" /><meta content="IE=9" http-equiv="X-UA-Compatible" /><meta content="Doxygen 1.8.3.1" name="generator" /><title>id_plug-in_programming_guide_volume_2_advanced_topics</title><link href="tabs.css" rel="stylesheet" type="text/css" /><script src="jquery.js" type="text/javascript"></script><script src="dynsections.js" type="text/javascript"></script><link href="navtree.css" rel="stylesheet" type="text/css" /><script src="resize.js" type="text/javascript"></script><script src="navtree.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(initResizable);

  $(window).load(resizeHeight);

</script><link href="search/search.css" rel="stylesheet" type="text/css" /><script src="search/search.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(function() { searchBox.OnSelectItem(0); });

</script><link href="doxygen.css" rel="stylesheet" type="text/css" /></head><body><div id="top"><div id="titlearea"><table cellpadding="0" cellspacing="0"><tbody><tr style="height: 56px;"><td id="projectlogo"><img alt="Logo" src="adobe_logo.png" /></td><td style="padding-left: 0.5em;"><div id="projectname">InDesign SDK &nbsp;<span id="projectnumber">14.0.0</span></div></td></tr></tbody></table></div><script type="text/javascript">

var searchBox = new SearchBox("searchBox", "search",false,'Search');

</script><div class="tabs" id="navrow1"><ul class="tablist"><li><a href="index.html"><span>InDesign&nbsp;SDK</span></a><li class="current"><a href="pages.html"><span>Documentation</span></a><li><a href="group__bosses__parent.html"><span>Bosses</span></a><li><a href="group__sdk.html"><span>Sample&nbsp;plug-ins</span></a><li><a href="classes.html"><span>Class&nbsp;Index</span></a><li><div class="MSearchBoxInactive" id="MSearchBox"><span class="left"> <img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="search/mag_sel.png" /> <input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search" /> </span><span class="right"> <a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="search/close.png" /></a> </span></div></ul></div></div><div class="ui-resizable side-nav-resizable" id="side-nav"><div id="nav-tree"><div id="nav-tree-contents"><div class="sync" id="nav-sync"></div></div></div><div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;"></div></div><script type="text/javascript">

$(document).ready(function(){initNavTree('id_plug-in_programming_guide_volume_2_advanced_topics.html','');});

</script><div id="doc-content"><div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()"><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Pages</a></div><div id="MSearchResultsWindow"><iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)"></iframe></div><div class="header"><div class="headertitle"><div class="title">Plug-In Programming Guide II </div></div></div><div class="contents"><div class="textblock"><h1><a class="anchor" id="id_introduction"></a> Introduction</h1><p>This guide provide detailed information on the Adobe InDesign plug-in architecture. This C++-based SDK can be used for creating plug-ins compatible with the CC versions of InDesign, InDesign Server, and Adobe InCopy.<p>The two volumes of this guide contain the most detailed information about plug-in development for InDesign products. It is not designed to be a starting point. They pick up where Getting Started With Adobe InDesign Plug-in Development leaves off, and this guide is more commonly used to understand particular subjects deeply.<h1><a class="anchor" id="id_tables"></a> Tables</h1><p>This chapter describes concepts and architecture related to the table feature of InDesign.<p>Table attributes are boss classes with <a class="el" href="class_i_table_attr_report.html">ITableAttrReport</a> implementation; they are discussed in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_table_attributes">Table attributes</a>. Table and cell styles define a collection of table attributes that are appropriate for tables or cells. They can be applied to individual tables and cells. See &quot;Table and cell styles&quot;.<p>For information on how to work with table models and APIs, see <a class="el" href="id_idml_cookbook.html#id_tables">Tables</a>.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><h3><a class="anchor" id="id_table_structure"></a> Table structure</h3><p>Tables in InDesign publications consist of rows, columns, and cells. Cells can span multiple rows or columns, as in the HTML 4 table model, which evolved from the CALS SGML table model.<p>There are helper classes in the InDesign API that are used to specify location, dimension of cells, and areas within tables. The abstractions used to specify these are shown in the following figure. For this example, the resolution of the underlying grid is 4 (rows) by 3 (columns). Cells can consist of merged elements on this underlying grid.<p>Table-structure example: <div class="image"><img alt="plugin-programming-guide-vol2-1.gif" src="plugin-programming-guide-vol2-1.gif" /></div><p><b>Anchor cells versus grid elements</b><p>The top-left of a cell is its anchor.<p>A grid element is a unit on the underlying grid. Grid elements may or may not be anchor cells.<p>A cell can comprise multiple elements on the underlying grid, but there is at most one anchor point per cell.<p>To access the text content of a cell, some API methods require a <a class="el" href="class_grid_address.html">GridAddress</a> that refers to an anchor, whereas other methods can work with a grid element that is not necessarily an anchor.<p><b><a class="el" href="class_grid_address.html">GridAddress</a></b><p>The API helper class <a class="el" href="class_grid_address.html">GridAddress</a> identifies the location of cells within tables. <a class="el" href="class_grid_address.html">GridAddress</a> and the other GridXXX classes are defined in <a class="el" href="_table_types_8h_source.html">TableTypes.h</a>. In InDesign, GridCoord is an alias for the primitive type int32. The nondefault constructor for <a class="el" href="class_grid_address.html">GridAddress</a> is as follows: <div class="fragment"><div class="line"><a class="code" href="class_grid_address.html">GridAddress</a>(GridCoord row, GridCoord column)</div></div><p>where row and column are the row and column, respectively, in which the top-left of the cell is located.<p>Another key concept is the underlying grid on which measurements are made, consisting of grid elements.<p>For example, if a cell is split by a vertical line, this increases the resolution of the grid in the horizontal direction. The resolution of the grid in a given direction is determined by projecting all cell boundaries onto an axis in that direction. Adding another vertical line means an additional projection onto the horizontal axis; that is, an increase in horizontal grid resolution.<p>The grid lines are not uniformly distributed. The grid is rectilinear.<p>Determining what row a particular cell is in can become quite complex in a table with many split and merged cells; that is, tables with many nontrivial <a class="el" href="class_grid_span.html">GridSpan</a> values. The algorithm to determine the <a class="el" href="class_grid_address.html">GridAddress</a> for a particular cell is straightforward:<ol type="1"><li>Determine the resolution of the underlying grid. For the horizontal direction, this can be calculated by projecting all vertical edges to the x-axis (top of the table). Similarly, for the vertical direction, project all horizontal edges to the y-axis (left of the table).<li>Calculate the coordinates on this grid. The process is shown in the following figure. The underlying grid is just fine enough so there are no cell edges that do not lie on an edge in this underlying grid. In the figure, the <a class="el" href="class_grid_address.html">GridAddress</a> of the red cell is (8, 9). The table has an underlying grid 12 rows wide and 11 columns high.</ol><p>Complex table and underlying grid:<div class="image"><img alt="plugin-programming-guide-vol2-2.gif" src="plugin-programming-guide-vol2-2.gif" /></div><p>The <a class="el" href="class_grid_address.html">GridAddress</a> of a cell can change even if its physical location does not change.<p><b><a class="el" href="class_grid_span.html">GridSpan</a></b><p><a class="el" href="class_grid_span.html">GridSpan</a> is a class that represents the dimension of an area within a table, expressed as coverage of elements in the notional underlying grid. <a class="el" href="class_grid_span.html">GridSpan</a> has a constructor with two arguments: <div class="fragment"><div class="line"><a class="code" href="class_grid_span.html">GridSpan</a>(int32 height, int32 width)</div></div><p>where height and columns are the numbers of rows and columns spanned, respectively (on the underlying grid).<p>When a table is created (for example, using the Insert Table menu command), each cell in the table has the trivial GridSpan(1,1). The concept of <a class="el" href="class_grid_span.html">GridSpan</a> is illustrated in the table-structure figure in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_table_structure">Table structure</a>, which shows the <a class="el" href="class_grid_span.html">GridSpan</a> for several cell configurations<p>The <a class="el" href="class_grid_span.html">GridSpan</a> of a given cell can change as more cells are added to a table-for example, by a cell being split vertically in a column that this cell spans-even if the physical dimension of the cell of interest does not vary. <a class="el" href="class_grid_span.html">GridSpan</a> for a cell is affected by changes in the columns spanned by a cell and the rows spanned by a cell.<p>Merging a pair of cells with trivial GridSpan(1,1) gives one cell with a GridSpan(2,1) if the cells are merged vertically and GridSpan(1,2) if the cells are merged horizontally.<p>Cells may be unmerged by selecting any merged cells-even the whole table-and choosing Unmerge Cells.<p>Splitting a cell with GridSpan(2,1) in the vertical direction gives two cells with trivial GridSpan(1,1). Splitting the cell horizontally leads to the <a class="el" href="class_grid_span.html">GridSpan</a> of other cells in the table being recalculated.<p><b><a class="el" href="class_grid_area.html">GridArea</a></b><p>The <a class="el" href="class_grid_area.html">GridArea</a> class is used to specify a region within a table. Like <a class="el" href="class_grid_span.html">GridSpan</a> and <a class="el" href="class_grid_address.html">GridAddress</a>, <a class="el" href="class_grid_area.html">GridArea</a> is calculated on the underlying grid. <a class="el" href="class_grid_area.html">GridArea</a> has a constructor with four arguments: <div class="fragment"><div class="line"><a class="code" href="class_grid_area.html">GridArea</a>(GridCoord topRow, GridCoord leftColumn, GridCoord bottomRow, GridCoord rightColumn)</div></div><p>where:<ul><li>topRow is the row coordinate for the top-left of area.<li>leftColumn is the column coordinate for the top-left of area.<li>bottomRow is one greater than the lowest row contained in the area; that is, the row immediately below the given area and outside it.<li>rightColumn is one greater than the rightmost column contained in this area; that is, the column immediately to the right of the given area and outside it.</ul><p>The choice of using one greater than the last row or column allows for specifying an empty area in a simple way. That is, an empty <a class="el" href="class_grid_area.html">GridArea</a> can be specified by writing GridArea(0,0,0,0), for example.<p>Alternately, given the definition of <a class="el" href="class_grid_area.html">GridArea</a>, it is equivalent to the following: <div class="fragment"><div class="line"><a class="code" href="class_grid_area.html">GridArea</a>(top, left, row-span, column-span)</div></div><p><b>Table and cell selection</b><p>You can select a whole table or cells within a table, allowing the selected cells to be deleted or their properties to be altered as a block. Alternately, you can select text within a table cell, allowing the text properties to be specified for this text run. This is shown in the following figures.<p>Table cells selected:<div class="image"><img alt="plugin-programming-guide-vol2-3.gif" src="plugin-programming-guide-vol2-3.gif" /></div><p>Table text selected:<div class="image"><img alt="plugin-programming-guide-vol2-4.gif" src="plugin-programming-guide-vol2-4.gif" /></div><p>The selection manager hides the detail of the particular selection type involved from client code. The intent is that client code interact with the table model only indirectly, through the integrator suite interfaces, which present a uniform facade to client code. When the cursor is within a table cell, InDesign can perform operations for any of the three selection types: text selection, cell selection, and table selection.<p>Some operations are possible only with table cells selected; for example, the Merge Cells command is enabled only when multiple table cells are selected.<p><b>Table composition</b><p>Typically, a table is associated with a text frame. One text frame can contain multiple tables.<p>The table composer flows the row content of tables between table frames. Once a table becomes too deep for the containing text frame, rows from the table may be flowed to another text frame, if there is one linked to the current table&#39;s text frame. Only whole rows are flowed by the table composer.<p>Text composition within a table cell uses the same text-composition engines that operates over normal text (that is, text outside tables). For more information on text composition, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<p>A text frame that contains one or more table rows that are too deep to display is marked as overset. The overset rows can be flowed to another text frame by linking the frames, exactly as for overset text. The visual indicator for table cell overset is drawn as a text adornment.<p>Tables can be wider than the containing text frame; table rows, on the other hand, flow between linked cells, or the frame is marked as overset.<p><b>Table region</b><p>A table can be viewed as composed of regions: header rows, footer rows, left column, right column, and body rows. When inserting a table, headers and footers can be specified in the Insert Table dialog box. A table style can set different cell styles for each region.<h2><a class="anchor" id="id_design_and_architecture"></a> Design and architecture</h2><h3><a class="anchor" id="id_table_model_versus_text_model"></a> Table model versus text model</h3><p><b>Text-model extensions for tables</b><p>The basic text model API is extended to accommodate tables. <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> aggregates interfaces to support the abstraction of text-story threads, which are spans of characters that represent the text content of one cell. The text-story thread interface (<a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>) is aggregated on the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> class, which is used to represent the main text flow within a story designated as the primary story thread.<p>Many higher-level APIs make it possible to manipulate the content of text cells without having to manipulate the underlying text model directly. The essential API for this is the <a class="el" href="class_i_table_text_content.html">ITableTextContent</a> interface, which is aggregated on the <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> class. This provides a mechanism to get and set table text in chunks.<p><b>How tables are connected to text</b><p>The <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> boss class is the fundamental class that represents the textual content of stories. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<p>A story can contain zero or more tables. Tables can be nested within tables to an arbitrary depth. The text-model interface (<a class="el" href="class_i_text_model.html">ITextModel</a>) is the fundamental API to interact with stories; for every table, there is an embedding story. An <a class="el" href="class_i_text_model.html">ITextModel</a> interface can be used to obtain the text-cell contents. The UML diagram in the following figure is a graphical representation of the relationship between the story and table models. It shows other key abstractions, such as the table-model list and the TextStoryThreadDictHier.<div class="image"><img alt="plugin-programming-guide-vol2-5.gif" src="plugin-programming-guide-vol2-5.gif" /></div><p>Text and tables are connected in two ways:<ul><li>Through the table-model list (<a class="el" href="class_i_table_model_list.html">ITableModelList</a>, aggregated on <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). This is relatively straightforward to understand, but it may be deprecated in future versions of the API.<li>Through <a class="el" href="class_i_text_story_thread_dict_hier.html">ITextStoryThreadDictHier</a>. This is more complex to understand, but it represents the new architecture and will be a more dependable API moving forward.</ul><p>Obtaining a reference to <a class="el" href="class_i_table_model.html">ITableModel</a> through the table model list meant making a series of API calls by client code to navigate the table architecture. The alternative scheme to obtain a reference to an <a class="el" href="class_i_table_model.html">ITableModel</a> has a starting point of an <a class="el" href="class_i_text_model.html">ITextModel</a> interface on a <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> object. The difference is that there is no dependence on <a class="el" href="class_i_table_model_list.html">ITableModelList</a>.<p>Another API that allows connections between tables and text to be explored is <a class="el" href="class_i_table_text_container.html">ITableTextContainer</a>. Given a table, <a class="el" href="class_i_table_text_container.html">ITableTextContainer</a> allows client code to determine the embedding text model. This interface is aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>.<h3><a class="anchor" id="id_table_data_model"></a> Table data model</h3><p>A key abstraction in the table model is the <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> boss class. Among other things, this class encapsulates the data model for a table, allows iteration over the cells in a table, allows access and modification of the attributes of a table, and provides access to the text chunks (or other content) in a table. It provides APIs that enable copy, paste, and deletion of content and access to the geometry of the table. For some of the key interfaces aggregated on the boss class, see the following figure.<div class="image"><img alt="plugin-programming-guide-vol2-6.gif" src="plugin-programming-guide-vol2-6.gif" /></div><dl class="section note"><dt>Note<dd>Plug-in (client) code that uses the API exposed through interfaces aggregated on the <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> class should be written to use the selection suites and facades.</dl><p>The <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> boss class aggregates interfaces like <a class="el" href="class_i_table_model.html">ITableModel</a>. This interface has methods to obtain table iterators; these can be used to navigate a table or iterate through a specific <a class="el" href="class_grid_area.html">GridArea</a> within a table. These are STL-like iterators, supporting both forward and reverse iteration.<p>The <a class="el" href="class_i_table_attr_accessor.html">ITableAttrAccessor</a> and <a class="el" href="class_i_table_attr_modifier.html">ITableAttrModifier</a> interfaces also are aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>. These provide detailed queries over the set of table attributes and allow applying overrides to table and cell attributes. In practice, most of the capability required for client code to query attributes and apply overrides is provided by the more convenient suite interface, <a class="el" href="class_i_table_suite.html">ITableSuite</a>. <a class="el" href="class_i_table_attr_modifier.html">ITableAttrModifier</a> is not likely to be used directly by client code; all the capabilities exposed by this interface are available through methods on <a class="el" href="class_i_table_commands.html">ITableCommands</a>, which wrap changes to the document object model in a command sequence in a clean and convenient way for client code to use. Client code should use <a class="el" href="class_i_table_commands.html">ITableCommands</a> (rather than <a class="el" href="class_i_table_attr_modifier.html">ITableAttrModifier</a>). Refer to the API Reference for details of the interfaces aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>.<p>The <a class="el" href="class_i_table_text_content.html">ITableTextContent</a> interface is aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>; this allows the text contained within cells to be accessed. Do not confuse this interface with <a class="el" href="class_i_table_text_container.html">ITableTextContainer</a>, which is a fundamental API that represents the connection between a table and the story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) within which it is embedded.<p>The <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> class represents the data model for an entire table. A table is composed into a set of table frames (<a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a>) by the table composer.&lt;SDK&gt;/source/sdksamples/tablebasics indicates how to acquire a reference to a table model. This code is in the context of a suite implementation that was added to a concrete-selection boss class.<p><b>Table layout</b><p><a class="el" href="class_i_table_layout.html">ITableLayout</a> on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> provides detailed information about the layout of the table. <a class="el" href="class_i_table_layout.html">ITableLayout</a> centralizes the persistent data into one implementation and contains several subclasses responsible for maintaining table layout information, like Row (representing the composed state of table-model rows), Frame (mapped to one persistent <a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a> object), and Parcel (holding information about <a class="el" href="class_i_parcel.html">IParcel</a>). <a class="el" href="class_i_table_layout.html">ITableLayout</a> also provides iterators to access these layout elements. For example, <a class="el" href="class_i_table_frame.html">ITableFrame</a> can be obtained from <a class="el" href="class_i_table_layout.html">ITableLayout</a> using the following snippet: <div class="fragment"><div class="line"><span class="comment">// Assume that iTableModel is a valid table model interface ptr.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableLayout&gt;</a> tableLayout(iTableModel , <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_table_layout_1_1frame__iterator.html">ITableLayout::frame_iterator</a> frameIter = tableLayout-&gt;begin_frame_iterator();</div><div class="line"><a class="code" href="class_i_table_layout_1_1frame__iterator.html">ITableLayout::frame_iterator</a> endFrameIter = tableLayout-&gt;end_frame_iterator();</div><div class="line"><span class="keywordflow">while</span>(frameIter != endFrameIter){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableFrame&gt;</a> tableFrame(frameIter-&gt;QueryFrame()); </div><div class="line"> ...</div><div class="line">}</div></div><p>The <a class="el" href="class_i_table_layout_1_1_row.html">ITableLayout::Row</a> subclass represents the partial mapping of a model row to a table frame (represented by the <a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a>). For each model row, there is one or more corresponding table layout rows. Each row contains information for each parcel owned by a table cell, like the GridCoord of the model row it maps and the UID of the table frame with which it is associated. Each layout row is associated with one table frame.<p><a class="el" href="class_i_table_layout.html">ITableLayout</a> is responsible for the lifetime management of table frames. Besides containing the layout rows, the table frame also is responsible for maintaining the link back to the containing Parcel and associated ParcelList.<p><b>Table frames</b><p>The rows in a table may not all fit in one text frame. The table composer groups as many rows as will fit into the first text frame, the second text frame, and so on. A table with many rows may be spread across multiple, linked, text frames.<p>These groups of rows are table frames. Each row is part of one and only one table frame.<p>A table is divided into one or more table frames, spread across one or more text frames. A table frame (represented by the <a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a> boss class) is a collection of rows within a text frame. There can be multiple table frames within a text frame (if the text frame contains multiple tables), so there are at least as many table frames as text frames.<p>An occurrence of a table frame leads to its UID for the corresponding <a class="el" href="classk_table_frame_boss.html">kTableFrameBoss</a> object appearing in the owned item strand.<p>Tables can have an arbitrary number of table frames, split between linked text frames. If rows cannot be displayed within the last linked frame in the series, the frame is marked as overset. For each text frame, there is a corresponding table frame that represents the collection of rows being displayed within the given text frame.<p>For each row of a table, there is an occurrence of the kTextChar_Table or kTextChar_TableContinued character in the text data strand. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<h3><a class="anchor" id="id_cell_data_model"></a> Cell data model</h3><p><b>Cell-content managers</b><p>The table architecture supports having different cell-content managers. In practice, InDesign has only text cell-content manager (with behavior provided by <a class="el" href="classk_text_cell_content_mgr_boss.html">kTextCellContentMgrBoss</a>) and a dummy cell-content manager. (Future versions of InDesign may add canonical cell-content managers for content types like images.) You may add your own types of cell-content managers. The main responsibility of a cell-content manager is to implement the <a class="el" href="class_i_cell_content_mgr.html">ICellContentMgr</a> interface.<p>A cell-content manager is created during table creation. You can get the cell-content manager from the table via <a class="el" href="class_i_table_model.html#a9c539c7b143d00bab74c9b3b94f19948">ITableModel::QueryContentMgr()</a>.<p><b>Cell contents</b><p>Text cells (the only kind in InDesign) have behavior provided by the <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a> boss class. Instances of this boss class do not store the content directly but provide a convenient API on top of the table text model to allow its manipulation. It also is possible to quickly and conveniently manipulate the text content of a cell through the text model. In this case, API classes like <a class="el" href="class_text_iterator.html">TextIterator</a> can be used to access a range within the text model.<p>To set cell text, the <a class="el" href="class_i_table_commands.html#a2510547db4b24c5bb35f12767132e58e">ITableCommands::SetCellText</a> API method makes it straightforward to change the cell text at a given <a class="el" href="class_grid_address.html">GridAddress</a>. The <a class="el" href="class_i_table_commands.html">ITableCommands</a> interface is aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>.<p>Code snippets like SnpAccessTableContent.cpp show how to work with the APIs to access cell contents. See also the TableBasics plug-in and the SnpSortTable.cpp code snippet for examples of accessing and manipulating table text content.<p><b>Cell strands</b><p>The <a class="el" href="classk_cell_strand_boss.html">kCellStrandBoss</a> cell strand provides storage for cell attributes and aggregates an ITableStrand interface. This abstraction is likely to be hidden from client code and should be treated as an implementation feature. Higher-level APIs, like <a class="el" href="class_i_table_attr_accessor.html">ITableAttrAccessor</a> and <a class="el" href="class_i_table_commands.html">ITableCommands</a>, provide methods to access and modify attributes without having to work at the lower level of representation of the table strand.<h3><a class="anchor" id="id_table_attributes"></a> Table attributes</h3><p>The table architecture supports extensible attributes with inheritance. Attributes can be applied to an entire table or one or more cells within a table, and there also are a small set of row-specific and column-specific attributes. As with the text subsystem, attributes are represented by boss classes. Table-attribute boss classes have names that follow the pattern k&lt;target-entity&gt;Attr&lt;property&gt;Boss, where &lt;target-entity&gt; is one of Table, Cell, Row, or Column. Some text-cell-specific attributes have TextCell in the attribute name.<p>The <a class="el" href="class_i_table_attr_report.html#ad7253cdb19ff0d6b8bcb36d62e658461">ITableAttrReport::AppendDescription</a> method reports whether an attribute is a cell-specific, row-specific, column-specific, or table-specific attribute. To obtain information about the default value of each attribute, refer to the API Reference.<p><b>Table-specific attributes</b><p>A table attribute describes one property of an entire table. A table attribute is applied to the table itself; the attributes collectively define aspects of how the table should appear.<p>A table attribute is represented by a table attribute boss with a name that conforms to the pattern kTableAttr&lt;property&gt;Boss.<p><b>Row attributes</b><p>There are only a few row-specific attributes, which apply to a row or collection of rows within the table. Row attributes are represented by boss classes. For details, refer to <a class="el" href="classk_row_attr_base_boss.html">kRowAttrBaseBoss</a> in the API Reference. These are named to follow the pattern kRowAttr&lt;property&gt;Boss.<p><b>Column attributes</b><p>There are very few column-specific attributes. For details, see <a class="el" href="classk_col_attr_base_boss.html">kColAttrBaseBoss</a> in the API Reference. These are represented by boss classes, which are named to follow the pattern kColAttr&lt;property&gt;Boss.<p><b>Cell-specific attributes</b><p>There are a wide range of cell-specific attributes that can be overridden. These can be divided into those that apply to an entire cell and those that are specific to one border (bottom, left, right, top) of the cell. See the following figure.<p>Examples of cell-specific attributes:<div class="image"><img alt="plugin-programming-guide-vol2-7.gif" src="plugin-programming-guide-vol2-7.gif" /></div><p><b>Text-cell-specific attributes</b><p>Some cell attributes apply only to text cells. Text cells are the only supported kind of cell in InDesign, but future versions may support other cell-content types, so text cells are not generic-cell attributes.<p>Text-cell attributes are represented by boss classes named to follow the pattern kTextCellAttr&lt;property&gt;Boss.<p><b>Default table attributes</b><p>The <a class="el" href="class_i_table_attributes.html">ITableAttributes</a> interface is aggregated on the workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> class) and the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> class), with interface identifier IID_IDEFAULTTABLEATTRIBUTES.<p>When a new document is created, this root set of table attributes is applied to the document. This attribute list is further enhanced when the swatch list is available for the new document, since some of the attributes reference a swatch (black or none) by UID.<p>When a new table is created (by <a class="el" href="classk_new_table_cmd_boss.html">kNewTableCmdBoss</a> class, an instance of which is created and executed through the <a class="el" href="class_i_table_commands.html">ITableCommands</a> interface on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>), the root table style is applied to the table.<h3><a class="anchor" id="id_table_and_cell_styles"></a> Table and cell styles</h3><p>A style can be considered a collection of attributes. Table and cell styles provide a mechanism to name and persist a particular set of table attributes.<p>Table style and cell style are analogous to paragraph style and character style in the text. Each style has an <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list that maintains the set of attributes that apply to that style. Access to the attributes in a style is achieved through the <a class="el" href="class_i_table_attributes.html">ITableAttributes</a> interface. Cell styles are associated with cell-specific attributes; however, table styles can be associated with both table attributes and cell-specific and other attributes.<p>Styles form a hierarchy rooted at the root style. Each style (except the root style) is based on a style. The <a class="el" href="class_attribute_boss_list.html">AttributeBossList</a> list for a particular style records only the differences from the style on which it is based; that is, the set of attributes the particular style overrides.<p>As with other types of styles, table and cell styles support the Style Group concept. Users can create, edit and delete folders (called Groups), in the table styles and cell styles palettes. Style group is a collection of styles or groups. The user also can nest groups inside groups and drag styles within the palette to edit the contents of a group. Styles do not need to be inside a group and can exist at the root level of the palette.<p><b>Table styles</b><p>A table style is represented by a <a class="el" href="classk_table_style_boss.html">kTableStyleBoss</a>. Its <a class="el" href="class_i_style_info.html">IStyleInfo</a> stores general, style-related information like style name and parent style. Its <a class="el" href="class_i_table_attributes.html">ITableAttributes</a> interface stores a list of table attributes that are different from its parent.<p>The root table style (known in the application user interface as [No Table Style]) contains a complete set of default table attributes. This defines the default look of the table with no further formatting applied.<p>The application also defines a basic table style called [Basic Table]. The basic style cannot be deleted, but you can change it. Initially, the basic style is based on the root style; however, its parent style can be changed.<p>Table styles are accessible through the table-style group manager (signature interface <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> with interface identifier IID_ITABLESTYLEGROUPMANAGER) on the document (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) and session (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) workspace boss classes. When a document is created, its style group manager inherits the existing set of styles from the session workspace.<p>THe <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> of the table styles works exactly the same way as that of paragraph and character styles. For details, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<p><b>Cell styles</b><p>A cell style is represented by a <a class="el" href="classk_cell_style_boss.html">kCellStyleBoss</a>. Its <a class="el" href="class_i_style_info.html">IStyleInfo</a> store general, style-related information like style name and parent style. Its <a class="el" href="class_i_table_attributes.html">ITableAttributes</a> interface (with implementation kCellStyleCellAttributeListImpl) stores a list of cell-specific attributes that are different from its parent cell style.<p>The root cell style (known in the application user interface as [None]) is really nothing; in fact, it defines nothing. It is synonymous with the root character style. The root cell style cannot be deleted.<p>Cell styles are accessible through the cell-style group manager (signature interface <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> with interface identifier IID_ICELLSTYLEGROUPMANAGER) on the document (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) and session (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) workspace boss classes. When a document is created, its style group manager inherits the existing set of styles from the session workspace.<p>As with table styles, the <a class="el" href="class_i_style_group_manager.html">IStyleGroupManager</a> of the cell styles works the same way as that of paragraph and character styles. For details, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.<p><b>Regional cell styles</b><p>Each table style can assign different cell styles for different regions: headers rows, footers rows, first column, last column, and body rows. When a table style is applied to a table, these regional cell styles are applied to the appropriate regions.<p>Regional cell styles are considered as table attributes of a table style. Except for body rows, the values of two related attributes, &quot;cell style&quot; and &quot;use body,&quot; determine a regional style. See the following table.<p>Regions and their controlling attributes:<table class="doxtable"><tr><th>Region </th><th>Cell-style attribute boss </th><th>Use body attribute boss </th></tr><tr><td>Body rows </td><td><a class="el" href="classk_table_attr_body_cell_style_boss.html">kTableAttrBodyCellStyleBoss</a></td><td>kInvalidClass </td></tr><tr><td>Header rows </td><td><a class="el" href="classk_table_attr_header_cell_style_boss.html">kTableAttrHeaderCellStyleBoss</a></td><td><a class="el" href="classk_table_attr_header_use_body_cell_style_boss.html">kTableAttrHeaderUseBodyCellStyleBoss</a></td></tr><tr><td>Footer rows </td><td><a class="el" href="classk_table_attr_footer_cell_style_boss.html">kTableAttrFooterCellStyleBoss</a></td><td><a class="el" href="classk_table_attr_footer_use_body_cell_style_boss.html">kTableAttrFooterUseBodyCellStyleBoss</a></td></tr><tr><td>Left column </td><td><a class="el" href="classk_table_attr_left_col_cell_style_boss.html">kTableAttrLeftColCellStyleBoss</a></td><td><a class="el" href="classk_table_attr_left_col_use_body_cell_style_boss.html">kTableAttrLeftColUseBodyCellStyleBoss</a></td></tr><tr><td>Right column </td><td><a class="el" href="classk_table_attr_right_col_cell_style_boss.html">kTableAttrRightColCellStyleBoss</a></td><td><a class="el" href="classk_table_attr_right_col_use_body_cell_style_boss.html">kTableAttrRightColUseBodyCellStyleBoss</a></td></tr></table><p>To set a regional cell style, you need to create and apply an appropriate &quot;cell style&quot; attribute as well as create and apply an appropriate &quot;use body&quot; attribute (except for body rows). To get a regional cell style, you need to look for these attributes at the complete list of attributes. For more information, see <a class="el" href="id_idml_cookbook.html#id_tables">Tables</a>.<p><b>Table and cell style in the data model</b><p>The following figure illustrates a simplified class diagram of table styles, cell styles, and their relationships to application/document workspaces and the table model. The descriptions of the boss classes give hints to navigate through these related classes.<div class="image"><img alt="plugin-programming-guide-vol2-8.gif" src="plugin-programming-guide-vol2-8.gif" /></div><h3><a class="anchor" id="id_formatting_tables_cells_and_table_text"></a> Formatting tables, cells, and table text</h3><p><b>Formatting a table</b><p>Tables are formatted according to table-specific attributes. Every table is assigned a table style. <a class="el" href="class_i_table_attributes.html">ITableAttributes</a>, aggregated on <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>, provides coarse-grained access to the locally overridden attribute list for a particular table. For a given attribute (such as table stroke), InDesign follows these steps to format a table:<ol type="1"><li>If there is a local override, format the table according to the override.<li>Otherwise, check the attributes in the table style of the table. If the attribute is among those attributes defined in <a class="el" href="class_i_table_attributes.html">ITableAttributes</a> of <a class="el" href="classk_table_style_boss.html">kTableStyleBoss</a>, format the table according to the value of the attribute defined in the table style.<li>Otherwise, check the table style&#39;s parent style, until either the attribute is found or the root table style (which defines all default attributes) is reached. Format the table according the value of the attribute.</ol><p><b>Formatting a cell</b><p>Cells are formatted according to cell-specific attributes, similar to tables. For a given cell attribute, InDesign follows these steps to format a cell:<ol type="1"><li>If there is a local override, format the cell according to the override (which is defined in ITableStrand on <a class="el" href="classk_cell_strand_boss.html">kCellStrandBoss</a>).<li>Otherwise, check the attribute against the attribute list of the cell style applied to the cell. To determine the cell style, check if a cell-style override is applied. If so, use the cell style; otherwise, use the regional cell style defined in the table style of the table.<li>As with table styles, if the attribute is among the attributes defined in <a class="el" href="class_i_table_attributes.html">ITableAttributes</a> of <a class="el" href="classk_cell_style_boss.html">kCellStyleBoss</a>, format the cell according to the value of the attribute defined in the cell style. Otherwise, check the cell style&#39;s parent style, until either the attribute is found or the root cell style (where nothing is defined) is reached. Format the cell according to the value of the attribute or leave it as the default format.</ol><p><b>Formatting text in a cell</b><p>It is helpful to view table attributes as equivalent to paragraph-level attributes for normal text, and cell attributes as equivalent to character-level attributes. The analogy holds insofar as the effective attributes are calculated by applying the following in the order listed below:<ul><li>Table-style attributes<li>Table-level overrides<li>Row or column cell style<li>Cell overrides<li>The paragraph style defined by the cell<li>Paragraph override<li>Character style<li>Character overrides</ul><p>To format a character in a table cell, InDesign looks at the reverse of the order above. An override always takes priority than a style; a smaller range style always takes priority over a coarse one.<p>Text-formatting priorities:<table class="doxtable"><tr><th>Overrides </th><th>Styles </th></tr><tr><td>Character overrides </td><td>Character styles </td></tr><tr><td>Paragraph overrides </td><td>Paragraph styles </td></tr><tr><td>Cell overrides </td><td>Cell style </td></tr><tr><td>Table overrides </td><td>Table style </td></tr></table><p>A cell style can have a paragraph style used in the paragraphs of a cell to which the cell style is applied. If a cell style does not have a paragraph style defined, any cell that has that cell style applied to it will have all paragraph-style formatting removed.<h2><a class="anchor" id="id_essential_apis"></a> Essential APIs</h2><h3><a class="anchor" id="id_table_commands"></a> Table commands</h3><p><a class="el" href="class_i_table_commands.html">ITableCommands</a> is an interface that is aggregated by <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> and provides methods to create and execute table-related commands, instead of having to manipulate the table model at a lower level. You can use <a class="el" href="class_i_table_commands.html">ITableCommands</a> to affect the table model on any specific table area. Some functions in <a class="el" href="class_i_table_commands.html">ITableCommands</a> also are provided by <a class="el" href="class_i_table_suite.html">ITableSuite</a>, which instead operates on the currently selected area of the table. For more details, refer to <a class="el" href="class_i_table_commands.html">ITableCommands</a> in the API Reference.<h3><a class="anchor" id="id_itablesuite"></a> ITableSuite</h3><p><a class="el" href="class_i_table_suite.html">ITableSuite</a> is a key API for manipulating tables in client code. It provides much of the required capability for plug-ins, with the exception of insertion and retrieval of cell content.<p>The <a class="el" href="class_i_table_suite.html">ITableSuite</a> interface is aggregated on the integrator suite boss class (<a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>), which makes it available through the abstract selection. Implementations of this interface are provided on various concrete-selection boss classes, which are hidden from client code through the facade of the abstract selection. To obtain <a class="el" href="class_i_table_suite.html">ITableSuite</a>, client code should query the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for the interface.<p>The integrator suites expose methods that determine whether a capability is present on the current selection; this always should be tested before trying to exercise a capability. For more detail on the integrator suites, see <a class="el" href="id_solutions.html#id_selection">Selection</a>.<p>Suite interfaces typically use this pattern of checking for a service (capability) and, if the abstract selection supports the capability, calling the method called. For details, refer to <a class="el" href="class_i_table_suite.html">ITableSuite</a> in the API Reference.<p>Use is illustrated in the following code: <div class="fragment"><div class="line">bool16 canDeleteTable = iTableSuite-&gt;CanDeleteTable();</div><div class="line"><span class="keywordflow">if</span>(canDeleteTable){ iTableSuite-&gt;DeleteTable();}</div></div><h3><a class="anchor" id="id_itablestylesuite_and_itablestylesfacade"></a> ITableStyleSuite and ITableStylesFacade</h3><p><a class="el" href="class_i_table_style_suite.html">ITableStyleSuite</a> is the selection suite used to manipulate table styles, such as creating and editing table styles of a selected table; applying a table style to the current selection; and getting and setting local overrides of table attributes. As with other selection suites, the interface can be acquired through <a class="el" href="class_i_selection_manager.html">ISelectionManager</a>.<p>Aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>, ITablesStylesFacade is used to manipulate table styles on a table or table style directly. It is the counterpart of <a class="el" href="class_i_table_style_suite.html">ITableStyleSuite</a>.<p>The <a class="el" href="class_i_table_attr_accessor.html">ITableAttrAccessor</a> and <a class="el" href="class_i_table_attr_modifier.html">ITableAttrModifier</a> interfaces aggregated on the <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> provide access to and mutation of table attributes; however, we recommend you use suites and facades whenever possible.<h3><a class="anchor" id="id_icellstylesuite_and_icellstylesfacade"></a> ICellStyleSuite and ICellStylesFacade</h3><p><a class="el" href="class_i_cell_style_suite.html">ICellStyleSuite</a> is the selection suite used to manipulate cell styles, like creating and editing the cell styles of selected cells; applying a cell style to the current cell selection; and getting and setting local overrides of cell attributes.<p>The facade counterpart of <a class="el" href="class_i_cell_style_suite.html">ICellStyleSuite</a> is ICellStylesFacade, aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>.<p>By using suites and facade, implementation details of cell strands and cell styles storage are encapsulated. We recommend you use only suites and facades.<h1><a class="anchor" id="id_track_changes"></a> Track Changes</h1><p>This chapter describes the change-tracking features of InDesign and InCopy for software developers.<p>The chapter has the following objectives:<ul><li>Explain how change tracking fits into the application architecture.<li>Show the relationship between a story and the tracked changes it contains.<li>Describe important APIs for tracking changes.<li>List common commands and the notification protocols associated with them.</ul><p>For use cases, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_working_with_track_changes">Working with Track Changes</a>.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><h3><a class="anchor" id="id_user_interface_for_track_changes_feature"></a> User interface for Track Changes feature</h3><p>Editors and writers need the ability to selectively track, show, hide, accept, and reject changes as a document moves through the writing and editing process. The Track Changes features of InDesign and InCopy address these needs.<p>Changes are tracked in both InDesign and InCopy, and the API is available in both applications. In galley view or story view, the user can choose to see changes; tracked changes are not visible in layout view.<p>The following figure shows the Track Changes panel, which provides most of the relevant user interface.<div class="image"><img alt="plugin-programming-guide-vol2-9.gif" src="plugin-programming-guide-vol2-9.gif" /></div><p>When Track Changes is turned on, changes to text are tracked. When changes are shown, tracked changes in text are highlighted with the color assigned to the user who made the change. An optional change bar may appear to the left of the body of the text, to indicate which lines contain tracked changes. The Track Changes panel displays information about the change at the insertion point, as shown in the following figure. See InDesign/InCopy Help for more information about the user interface.<div class="image"><img alt="plugin-programming-guide-vol2-10.gif" src="plugin-programming-guide-vol2-10.gif" /></div><p>There are three types of tracked changes, each indicated in a manner chosen in the Track Changes Preferences panel:<ul><li>Added text - Text typed in directly; text copied (not cut) and then pasted within the same document; and text pasted from another document.<li>Deleted text - Text that is deleted or cut. Deleted text appears in its original position when tracked changes are shown.<li>Moved text - Text cut (not copied) and then pasted within the same document. Moved text is shown highlighted and boxed, to differentiate it from added text.</ul><p><b>Showing and hiding changes</b><p>You can show or hide changes in story view or galley view.<p><b>Navigating tracked changes</b><p>If the story contains a record of tracked changes, the user can navigate sequentially through tracked changes. Navigating to a change selects the change.<p><b>Accepting and rejecting tracked changes</b><p>The user can accept and reject changes-added, deleted, or moved text-made by any user. For more information, see InDesign/InCopy Help.<p>Partially accepting or rejecting tracked changes often results in replacing one tracked change with multiple tracked changes, and vice versa. When an operation results in multiple tracked changes in contiguous text, any adjacent tracked changes are concatenated into one contiguous tracked change. Conversely, accepting or rejecting part of a tracked change may result in multiple, discontiguous tracked changes with nontracked (normal) text between them.<p><b>Copy, cut, and paste behavior</b><p>When copying, cutting, or pasting text that includes tracked changes, it is the text itself that is copied, cut, or pasted-not the tracked change that was applied to the text in its previous location. In other words, when you copy something out of a tracked change, you copy the text content, not the type of tracked change. Copying or cutting text from a tracked deletion does not affect the tracked deletion; pasting this text is treated the same way as adding new text.<p><b>Track Changes preferences</b><p>The Track Changes panel in the Preferences dialog box contains user settings for tracking changes, like which types of changes to show and the color of the highlight that indicates a change.<h2><a class="anchor" id="id_data_model_for_track_changes"></a> Data model for Track Changes</h2><h3><a class="anchor" id="id_redline_strand"></a> Redline strand</h3><p>Tracked changes are recorded in a story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) on the redline strand (<a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>). They are accessed through an iterator, <a class="el" href="class_redline_iterator.html">RedlineIterator</a>.<p>The following figure illustrates the relationship between a story and its tracked changes:<div class="image"><img alt="plugin-programming-guide-vol2-11.gif" src="plugin-programming-guide-vol2-11.gif" /></div><p>Track Changes implements <a class="el" href="classk_redline_new_story_responder_boss.html">kRedlineNewStoryResponderBoss</a>. When a new story is created-for example, using kNewStoryCmdBoss-the Track Changes plug-in is notified to create and initialize a new text strand, <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>, which is responsible for maintaining the Track Changes information. During the initialization of the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>, the story&#39;s Track Changes state (<a class="el" href="class_i_track_change_story_settings.html">ITrackChangeStorySettings</a> from <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) is set to the state from the session (<a class="el" href="class_i_track_change_app_settings.html">ITrackChangeAppSettings</a>) using the <a class="el" href="classk_set_redline_tracking_cmd_boss.html">kSetRedlineTrackingCmdBoss</a>.<p>During a normal text operation performed by a text command-like Insert or Delete-each strand (including <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>) on the text story gets a chance to react to the operation. This results in the IRedlineStrand methods-like Insert or Cut-being called to manage the corresponding change record before the text is inserted into or cut from the t ext model.<p><a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> uses a virtual object store (VOS) to store and manage the Track Changes records. Each change record is represented by the <a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a> class. In the redline strand, one or more <a class="el" href="class_v_o_s___redline_object.html">VOS_RedlineObject</a> objects manage the <a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a>. We strongly discourage direct access to the VOS object; instead, the <a class="el" href="class_i_redline_data_strand.html">IRedlineDataStrand</a> interface in <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> provides <a class="el" href="class_redline_iterator.html">RedlineIterator</a> to access the strand and let you examine and manipulate the change record. You should view <a class="el" href="class_redline_iterator.html">RedlineIterator</a> as the primary access to tracked changes.<p>Relationship between a story and the tracked changes it contains<h3><a class="anchor" id="id_tracking_text_insertion_and_deletion"></a> Tracking text insertion and deletion</h3><p>When text is inserted, IStrand::Insert from <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> places a change record (<a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a>) on a VOS redline object (<a class="el" href="class_v_o_s___redline_object.html">VOS_RedlineObject</a>); length is the number of characters inserted. When a new story is created, a carriage-return character is inserted at the end of the story. This means IStrand::Insert from <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> is called during the execution of <a class="el" href="classk_new_story_cmd_boss.html">kNewStoryCmdBoss</a>. The following figure shows the activities in <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> when text is inserted into a story.<div class="image"><img alt="plugin-programming-guide-vol2-12.gif" src="plugin-programming-guide-vol2-12.gif" /></div><p>When text is deleted, a change record (<a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a>) is placed on a VOS redline object (<a class="el" href="class_v_o_s___redline_object.html">VOS_RedlineObject</a>), on the character following the deleted text. Also, the text is copied to a story thread, so the deleted text can be retrieved and displayed in story view or galley view.<p>To preserve the deleted text before it is deleted, Track Changes implements a <a class="el" href="classk_redline_preprocessor_boss.html">kRedlinePreprocessorBoss</a> service provider, which enables Track Changes to participate in a preprocessing text event, like deletion, so it can preserve the soon-to-be-deleted text. During deletion, if Track Changes is turned on, and (private) IRedlineUtils&gt;()-&gt;ShouldStoreDelete returns true, RedlinePreProcessor::StoreDeletedText gets called. The deleted text is represented by an owned item accessed through the <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a> on the text story, with an owned-item boss (<a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>) anchored in the deleted position. A new story thread is created to hold the deleted text content, and the owned item&#39;s class ID is set to the <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>.<p>The following figure shows the activities in <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> when text is deleted from a story.<p><a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> Activity on text deletion: <div class="image"><img alt="plugin-programming-guide-vol2-13.gif" src="plugin-programming-guide-vol2-13.gif" /></div><p>In some situations, there can be multiple VOSRedlineChanges for one text position. The most likely scenario is one in which the character following the deleted text is an insertion change; then the insertion change is nested. In this case, it is possible to iterate through changes and have the current text position be the same, even though the iterator was incremented or decremented (through <a class="el" href="class_redline_iterator.html#aaf7eb81ada46a8add568bf67cbeaf1ab">RedlineIterator::Increment</a> or <a class="el" href="class_redline_iterator.html#a418938bb1e7b7f352aa4ae358005ed95">RedlineIterator::Decrement</a>). Calling the accessor methods returns the appropriate change-record information given the state of an internal flag, or the useUI flag if passed when the iterator was constructed with NewRedlineIterator. Accepting a nested insertion does not affect the deletion; however, rejecting a nested insertion rejects the deletion.<h3><a class="anchor" id="id_example_track_changes_in_action"></a> Example: Track Changes in action</h3><p>Consider the example of the story &quot;0123456789,&quot; with &quot;3&quot; and &quot;7&quot; converted to notes, as shown in the InCopy story view in the following figure. This story, with embedded owned items-the notes-demonstrates what happens in a text story when deletion and insertion are performed while Track Changes is turned on. Below the story view in the figure is a table showing the fundamental text model data, with which you can understand the basics of change tracking.<p>Track Changes action 1: Before Track Changes is turned on:<div class="image"><img alt="plugin-programming-guide-vol2-14.gif" src="plugin-programming-guide-vol2-14.gif" /></div><dl class="section note"><dt>Note<dd>The complete text data model is more complex than that depicted in this table. For more information on the text model, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>.</dl><p>In the table, the columns are interpreted as follows:<ul><li>The first column represents the text index in the text model.<li>The second column represents the text data stored in the <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a> object. The visual story representation you see in the InDesign or InCopy document window does not necessarily represent the sequence in which the data is stored in the text model. For example, although the note with content &quot;3&quot; is located between characters &quot;2&quot; and &quot;4,&quot; the real note-text content is stored in a different story thread in text index 11. Between characters &quot;2&quot; and &quot;4,&quot; the text data is inserted with a note anchor.<li>The third column from the left shows the text-story threads. The InDesign text engine uses an owned item strand (<a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>) to figure out where to find the corresponding text when the engine comes to compose the text.<li>The fourth column shows the owned-item strand data.<li>The fifth column shows tracked-change data; the information is obtained from <a class="el" href="class_redline_iterator.html">RedlineIterator</a>.</ul><p>Looking at the text model representation in the preceding figure, see in the <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a> that each note is anchored at the note&#39;s visual location (text index 3 and text index 7) with a special anchor character, 0xfeff. At the same position, the UID of the note&#39;s <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> is stored through the <a class="el" href="class_i_item_strand.html">IItemStrand</a> interface on the <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>. The <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> also aggregates the interfaces to access the story threads that store the note contents. To find the text content of a note, you can go through the <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a> to find its corresponding story thread. Because the story was entered with Track Changes off, the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> does not contain any tracked-change information at this point.<p>Using the SnippetRunner <a class="el" href="class_snp_inspect_text_model.html">SnpInspectTextModel</a> snippet, you can inspect the text model while Track Changes is turned on. Some methods in <a class="el" href="class_snp_inspect_text_model.html">SnpInspectTextModel</a> were used to produce the results you see in the preceding figure. The <a class="el" href="class_snp_inspect_text_model.html#a7951d7ffc84950df3479f717738e0268">SnpInspectTextModel::InspectTrackChange</a> method uses the <a class="el" href="class_redline_iterator.html">RedlineIterator</a> to examine the change record under each text index in the story. The <a class="el" href="class_snp_inspect_text_model.html#a95f5d7fc8ef4903d7fd441b1366d05aa">SnpInspectTextModel::InspectStoryThreads</a> and <a class="el" href="class_snp_inspect_text_model.html#a80f40153654078ad42639cff0e9b4df6">SnpInspectTextModel::CountStoryOwnedItems</a> methods were used to examine the story threads, owned item, and text data.<p>Next, turn on Track Changes, select the text &quot;234,&quot; and delete the selected text. The result is shown in the following figure.<p>Track Changes action 2: Delete one block of text: <div class="image"><img alt="plugin-programming-guide-vol2-15.gif" src="plugin-programming-guide-vol2-15.gif" /></div><p>Unlike the note-which uses a kTextChar_ZeroSpaceNoBreak character to anchor the note-Track Changes does not insert anchor characters for deleted text in text position 2 in the <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a>; that position is occupied by the character &quot;5&quot; after the deletion. The text model uses <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> to maintain tracked-change information. In text index 2 of the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>, there is a change record with the type kDelete stored in that location, which tells the text model that at least one character was deleted at that location. Similar to the inline note, the tracked change stores the deleted text in an owned-item boss, <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>. In text index 2, where the text was deleted, the <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a> stores the UID of the <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>. The <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> aggregates <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a> and <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a>, as shown in the first figure in &quot;Redline strand&quot;, which points back to the text-story thread, represented by the <a class="el" href="classk_story_thread_strand_boss.html">kStoryThreadStrandBoss</a> of the text model. The result of SnpInspectTextModel.cpp can show you the UID stored in the <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a> and the UID of the associated story thread, so you can make the connection. For simplicity, the UIDs are omitted from the table in the preceding figure.<p>Notice how embedded content is being stored in the event, such as deletion, and how it is tracked. The deleted text includes a note. The UID of the <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> in position 2 leads to story thread [1] in the preceding figure. By examining this thread&#39;s corresponding kTextdataStrandBoss and <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>, you can see that all attributes in the predeletion indices 2&acirc;&#128;&#147;4 are preserved in indices 8&acirc;&#128;&#147;9, including the deleted note&#39;s information. The <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> does not keep any change record in the position under the deleted text-story thread, though. In the <a class="el" href="class_snp_inspect_text_model.html#a7951d7ffc84950df3479f717738e0268">SnpInspectTextModel::InspectTrackChange</a>, when in the deleted text thread, the text index is not used to create a <a class="el" href="class_redline_iterator.html">RedlineIterator</a>. Instead, the corresponding deleted text position is found, and that position is used in the primary story thread to check its corresponding change record. To find the deleted note&#39;s text content, go to the story thread [1], which represents the deleted text. From there, find the UID of the deleted note&#39;s <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>, which leads to the thread [2]. Note that the text content of the inline note in text index 7 is now the text thread [3], because a new story thread was created and inserted to hold the deleted text.<p>Next, select and delete the text &quot;67.&quot; The result is shown in the following figure. Since both notes are deleted, you will not see any UIDs of <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> if you examine the <a class="el" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a> in the primary story-thread range; they are all preserved in the deleted text&#39;s threads, which can be reached through the UIDs of the <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> at indices 2 and 3. Also, the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> data shows there are kDelete items at both index 2 and index 3, which is consistent with what you see in story view, in which the deleted text is displayed immediately before the character &quot;5&quot; (at index 2) and immediately before the character &quot;8&quot; (at index 3).<p>Track Changes action 3: Delete two blocks of text:<div class="image"><img alt="plugin-programming-guide-vol2-16.gif" src="plugin-programming-guide-vol2-16.gif" /></div><p>Next, select and delete all text. The result is shown in the following figure. The deleted text contains all original text and notes. Only one <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> is needed to maintain the deleted text.<p>Track Changes action 4: Delete all text:<div class="image"><img alt="plugin-programming-guide-vol2-17.gif" src="plugin-programming-guide-vol2-17.gif" /></div><p>Next, select &quot;01234&quot; and accept the change, then select &quot;678&quot; and reject the change. The result is shown in the following figure. When you accept the deletion, the tracked change no longer tracks that portion of deleted text; therefore, the tracked text &quot;01234&quot; is removed from the story view, and the corresponding <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> is purged. The only way to get the deleted text back is through the undo operation. Because you rejected the change partially (&quot;6[7]8&quot; out of the tracked &quot;56[7]89,&quot; where &quot;[7]&quot; is a note), the tracked text is not in a contiguous block; therefore, two separate <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> objects are needed, one to track &quot;5&quot; and one to track &quot;9.&quot;<p>Track Changes action 5: Partially accept and partially reject a change:<div class="image"><img alt="plugin-programming-guide-vol2-18.gif" src="plugin-programming-guide-vol2-18.gif" /></div><p>Next, insert &quot;1234&quot; before the deleted &quot;5.&quot; Because Track Changes is still turned on, the new insertion is tracked, as shown in the following figure. In this case, the inserted text is simply added into the text model as normal: the data is added into <a class="el" href="classk_text_data_strand_boss.html">kTextDataStrandBoss</a> at a normal text index, and no owned item boss needs to be created. The corresponding position in the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> is marked as kInsert. With this one flag, the text model can hide, show, accept, or reject a tracked change when user chooses to do so.<p>Track Changes action 6: Insert a block of text:<div class="image"><img alt="plugin-programming-guide-vol2-19.gif" src="plugin-programming-guide-vol2-19.gif" /></div><p>Next, select the text &quot;3&quot; and convert it to a note. The result is shown in the following figure. The note is created in text index 2 and tracked as inserted text in that position. The tracked text&#39;s change information in the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> will not change until the user accepts or rejects the change or the text is cut. So, if you highlight the note in index 2 and accept the change, you will see the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> change the change data from kInsert to none.<p>Track Changes action 7: Convert tracked text to a note:<div class="image"><img alt="plugin-programming-guide-vol2-20.gif" src="plugin-programming-guide-vol2-20.gif" /></div><h3><a class="anchor" id="id_track_changes_preferences"></a> Track Changes preferences</h3><p>An <a class="el" href="class_i_track_change_app_settings.html">ITrackChangeAppSettings</a> interface is added to the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. This interface is responsible for maintaining the Track Changes settings in the Preferences panel. To access this interface, you can do the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> workSpace(GetExecutionContextSession()-&gt;QueryWorkspace());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITrackChangeAppSettings&gt;</a> tcAppSettings( (<a class="code" href="class_i_track_change_app_settings.html">ITrackChangeAppSettings</a>*)workSpace-&gt; QueryInterface(IID_ITRACKCHANGEAPPSETTINGS));</div><div class="line"><span class="keywordflow">if</span> (tcAppSettings != nil){ </div><div class="line"><span class="comment">// Do something with the preference.</span></div><div class="line">}</div></div><p>The <a class="el" href="class_i_track_change_story_settings.html">ITrackChangeStorySettings</a> interface (IID_ITRACKCHANGESTORYSETTINGS) is added to the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>. This interface&#39;s responsibility is to maintain story-level settings, like whether Track Changes is turned on for the story. To access this interface, you can do the following: <div class="fragment"><div class="line"><span class="comment">// Assume textModel is a valid ITextModel interface pointer.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITrackChangeStorySettings&gt;</a> trackSetting(textModel, IID_ITRACKCHANGESTORYSETTINGS);</div><div class="line"><span class="keywordflow">if</span> (trackSetting &amp;&amp; trackSetting-&gt;GetIsTracking()){ </div><div class="line"><span class="comment">// Track Changes is on for this story. Do something.</span></div><div class="line">}</div></div><h2><a class="anchor" id="id_key_client_apis"></a> Key client APIs</h2><h3><a class="anchor" id="id_track_changes_utilities"></a> Track Changes utilities</h3><p><a class="el" href="class_i_track_change_utils.html">ITrackChangeUtils</a>, added to the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>, provides convenient methods for a client to access some Track Changes features. For more information, see <a class="el" href="_i_track_change_utils_8h_source.html">ITrackChangeUtils.h</a>.<h3><a class="anchor" id="id_suite_interfaces"></a> Suite interfaces</h3><p>Much of the capability required for client code to work with Track Changes is provided in a high-level suite interface, <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a>, which is available through a reference to a selection. To obtain the interface, query a selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for the <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> interface. For information on obtaining a reference to the selection manager, see <a class="el" href="id_solutions.html#id_selection">Selection</a>. <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> encapsulates the details of interacting with the Track Changes model and hides details about the selection format that is active, providing a capability-driven API that can be used to accept and reject tracked change. Other suites for acce ssing Track Changes are discussed in this section.<p><b><a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a></b><p><a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> is a key API for manipulating Track Changes in client code; most Track Changes user-interface functions are provided through this interface. It provides much of the required capability for plug-ins.<p>The <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> interface is aggregated on the integrator-suite boss class (<a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>), which makes it available through the abstract selection. Implementations of this interface are provided on concrete-selection boss classes <a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a> and <a class="el" href="classk_text_suite_boss.html">kTextSuiteBoss</a>, which are hidden from client code through the facade of the abstract selection. To obtain <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a>, client code should query the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for the interface, as shown below: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITrackChangeSuite&gt;</a> iTCSuite (ac-&gt;GetContextSelection(), IID_ITRACKCHANGESUITE);</div><div class="line"><span class="keywordflow">if</span> (iTCSuite)</div><div class="line"><span class="comment">// Do something with Track Changes through the suite.</span></div></div><p>Generally, <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> is active when the text cursor is active in story view or galley view. Suite interfaces typically use this pattern of checking for a service or capability, and if the abstract selection supports this capability, the method can be called; however, <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> does not follow this pattern. The <a class="el" href="class_i_track_change_suite.html#a1955e5bfd87177f91c5014b507eaa5c7">ITrackChangeSuite::CanAccept</a> and <a class="el" href="class_i_track_change_suite.html#a3db215a2626259f499ea5d2b48d2f715">ITrackChangeSuite::CanReject</a> methods check only whether the workspace preference <a class="el" href="class_i_track_change_app_settings.html#ae105e3dd57ceadbcc1b1fd8a2413b157">ITrackChangeAppSettings::GetUserCanAcceptRejectChanges</a> method returns true. If true-and the story is not locked-the CanAccept and CanReject methods always return true.<p><b><a class="el" href="class_i_changes_review_suite.html">IChangesReviewSuite</a></b><p>Because <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> does not provide meaningful CanDo-types of methods (see <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a>), another suite interface, <a class="el" href="class_i_changes_review_suite.html">IChangesReviewSuite</a>, is provided for determining whether a tracked change is available in the current text position. The application uses this suite to decide whether the user interface related to Track Changes-like the menu and the Track Changes toolbar buttons-should be enabled or disabled when the text selection changes. For example, to determine whether the current cursor position has a change record the user can accept, call <a class="el" href="class_i_changes_review_suite.html#a005c566da3e7ead075ac63be98e084f5">IChangesReviewSuite::IsAcceptChangeEnabled</a>.<p><b><a class="el" href="class_i_track_change_settings_suite.html">ITrackChangeSettingsSuite</a></b><p><a class="el" href="class_i_changes_review_suite.html">IChangesReviewSuite</a> is mainly responsible for getting and setting a story&#39;s change-tracking state. You also can apply the state to multiple stories at the same time with one call.<p><b><a class="el" href="class_i_change_info_suite.html">IChangeInfoSuite</a></b><p><a class="el" href="class_i_change_info_suite.html">IChangeInfoSuite</a> provides one method to get the current tracked-change information, based on the current text selection. <a class="el" href="class_i_change_info_suite.html">IChangeInfoSuite</a> returns the information in a public <a class="el" href="class_change_info.html">ChangeInfo</a> class, which stores three pieces of information: story user, date of change, and change type. This suite is used by the application for the Change Info panel.<h3><a class="anchor" id="id_redlineiterator"></a> RedlineIterator</h3><p><a class="el" href="class_redline_iterator.html">RedlineIterator</a> is the primary access to the tracked change object; it also provides for processing acceptance and rejection of tracked changes. Create a new iterator using <a class="el" href="class_i_redline_data_strand.html#a084513842fb23c983c682001abd98288">IRedlineDataStrand::NewRedlineIterator</a> as shown below; the caller is responsible for destroying the iterator. <div class="fragment"><div class="line"><span class="comment">// Assume textModel is a valid ITextModel interface pointer.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IRedlineDataStrand&gt;</a> redline((<a class="code" href="class_i_redline_data_strand.html">IRedlineDataStrand</a>*)textModel-&gt;QueryStrand(<a class="code" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>, IRedlineDataStrand::kDefaultIID));</div><div class="line"><span class="keywordflow">if</span> (redline){</div><div class="line"><a class="code" href="class_redline_iterator.html">RedlineIterator</a> *redIterator = redline-&gt;NewRedlineIterator(0L);</div><div class="line"><span class="keywordflow">if</span> (redIterator)</div><div class="line"> {</div><div class="line"><span class="comment">// Use the iterator to access the Track Changes. </span></div><div class="line"><span class="comment">// When done with the iterator, delete it!</span></div><div class="line"><span class="keyword">delete</span> redIterator;</div><div class="line"> }</div><div class="line">}</div></div><p>As discussed in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_example_track_changes_in_action">Example: Track Changes in action</a>, there may be more than one change record under each text index. Currently, the only situation that results in multiple change records under one text index is the deletion of text that results in a deleted text record in front of added text, which causes a deletion record and an insertion record at the same text position. The records are managed so the deletion always is at change position 0. The underlying change record can be viewed as being laid out in a two-dimensional map, as shown in the following figure.<p>Conceptual change record structure map: <div class="image"><img alt="plugin-programming-guide-vol2-21.gif" src="plugin-programming-guide-vol2-21.gif" /></div><p>The <a class="el" href="class_redline_iterator.html#a05317288ce5b66697dbd095f8e42b11c">RedlineIterator::MoveToPosition</a> method provides the means to move in this two-dimensional space: <div class="fragment"><div class="line"><span class="keyword">virtual</span> bool16 MoveToPosition(TextIndex t, int32 c = -1) = 0;</div></div><p>The first parameter lets you go horizontally (i.e., navigate by the text), and the second parameter lets you go vertically (i.e., navigate among change records at the same text index).<p>You also can use <a class="el" href="class_redline_iterator.html#aaf7eb81ada46a8add568bf67cbeaf1ab">RedlineIterator::Increment</a> or <a class="el" href="class_redline_iterator.html#a418938bb1e7b7f352aa4ae358005ed95">RedlineIterator::Decrement</a> to access the change record. When you use Increment, it first goes down to the next change record on the same text index, then moves to the next text index that has a change record, and then goes downward from the first record in that index before moving to the next index again. <a class="el" href="class_snp_inspect_text_model.html#a7951d7ffc84950df3479f717738e0268">SnpInspectTextModel::InspectTrackChange</a> uses this method to iterate through all change records in a story.<h3><a class="anchor" id="id_kdeletedtextboss"></a> kDeletedTextBoss</h3><p><a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> is anchored as an owned item in the text story. The following code snippet shows one way to get to the <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> from the story. After you gain access to the owned item, you have access to the whole <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>, and you can use it to find the primary story thread index where the owned item is anchored. <div class="fragment"><div class="line"><span class="comment">// Find deleted text owned item in current storyRef.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextModel&gt;</a> textModel(storyRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IItemStrand&gt;</a> itemStrand((<a class="code" href="class_i_item_strand.html">IItemStrand</a>*)textModel -&gt;QueryStrand(<a class="code" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>, IItemStrand::kDefaultIID));</div><div class="line">int32 mainStoryLength = textModel-&gt;GetPrimaryStoryThreadSpan() - 1;</div><div class="line"><span class="comment">// Collect owned item from the story.</span></div><div class="line">Text::CollectOwnedItems(textModel, 0, mainStoryLength, &amp;ownedItemList);</div><div class="line"><span class="keywordflow">if</span> (ownedItemList.Length() &gt; 0){</div><div class="line"><span class="comment">// Remove non-deleted text items.</span></div><div class="line"><span class="keywordflow">for</span> (i = ownedItemList.Length()-1; i&gt;=0; i--)</div><div class="line"> {</div><div class="line"><span class="keywordflow">if</span> (ownedItemList[i].fClassID != <a class="code" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>)</div><div class="line"> ownedItemList.Remove(i);</div><div class="line"> }</div><div class="line">}</div></div><p>See the following figure for an illustration of <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> and its key interfaces.<div class="image"><img alt="plugin-programming-guide-vol2-22.gif" src="plugin-programming-guide-vol2-22.gif" /></div><h2><a class="anchor" id="id_useful_commands_and_associated_notification_protocols"></a> Useful commands and associated notification protocols</h2><p>This section summarizes some of the most common commands related to Track Changes. Critical data interfaces that users of the command must supply are explained, and the notification protocol associated with the command is listed.<h3><a class="anchor" id="id_ksetredlinetrackingcmdboss"></a> kSetRedlineTrackingCmdBoss</h3><p><b>Description</b><p>Sets the tracking flag for the story or workspace (whichever is specified in the command&#39;s item list) to the specified boolean setting. Changes remain tracked, but no new changes are tracked.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> that contains either the workspace pointer (from GetExecutionContextSession()-&gt;QueryWorspace()) or UIDs of the text stories for the setting change.<p><b>Data interface</b><p><a class="el" href="class_i_bool_data.html">IBoolData</a>, to turn Track Changes on or off for the target.<h3><a class="anchor" id="id_ksettrackchangesprefscmdboss"></a> kSetTrackChangesPrefsCmdBoss</h3><p><b>Description</b><p>Sets the session preference <a class="el" href="class_i_track_change_app_settings.html">ITrackChangeAppSettings</a> to the settings specified in the data interface.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> that contains the workspace pointer (from GetExecutionContextSession()-&gt;QueryWorspace()).<p><b>Data interface</b><p><a class="el" href="class_i_track_changes_prefs_cmd_data.html">ITrackChangesPrefsCmdData</a> can be changed to the user&#39;s preference. The following table shows the default values in <a class="el" href="class_i_track_changes_prefs_cmd_data.html">ITrackChangesPrefsCmdData</a>. A Set method changes all preference data, and individual Get or Set methods modify individual attributes.<table class="doxtable"><tr><th>Attribute </th><th>Default value </th></tr><tr><td>Added Text Background Color Choice </td><td><a class="el" href="class_i_track_change_app_settings.html#ab7f5930fefa481e9fe484bb0a01b0b60ab0ac3857bcff7446f9637e04320e6036">ITrackChangeAppSettings::kUseUserColorBG</a></td></tr><tr><td>Added Text Background Color Index </td><td>2 (InCopyUIColors =&gt; yellow) </td></tr><tr><td>Added Text Color Choice </td><td><a class="el" href="class_i_track_change_app_settings.html#a30c6c7ff67d2b41f87adf9c731ba838ba7aeaa0c9318724dc0aa1208062245ec3">ITrackChangeAppSettings::kUseGalleyColor</a></td></tr><tr><td>Added Text Color Index </td><td>1 (InCopyUIColors =&gt; black) </td></tr><tr><td>Added Text Marking </td><td>0 (<a class="el" href="class_i_track_change_app_settings.html#ad55ae4f4cfb1ffd2943a9b780f9c3507ae6a36b12a0d4db5e024115f979a27179">ITrackChangeAppSettings::kNone</a>) </td></tr><tr><td>Change Bar Color Index </td><td>18 (InCopyUIColors =&gt; cyan) </td></tr><tr><td>Change Bar Location </td><td>0 (<a class="el" href="class_i_track_change_app_settings.html#ac0075c38751898e6b662d17d74315f30ae1bf02f3ac5fad5578e9d91a023396f3">ITrackChangeAppSettings::kLeftMargin</a>) </td></tr><tr><td>Deleted Text Background Color Choice </td><td><a class="el" href="class_i_track_change_app_settings.html#ab7f5930fefa481e9fe484bb0a01b0b60ab0ac3857bcff7446f9637e04320e6036">ITrackChangeAppSettings::kUseUserColorBG</a></td></tr><tr><td>Deleted Text Background Color Index </td><td>2 (InCopyUIColors =&gt; yellow) </td></tr><tr><td>Deleted Text Color Index </td><td>1 (InCopyUIColors =&gt; black) </td></tr><tr><td>Deleted Text Marking </td><td>1 (<a class="el" href="class_i_track_change_app_settings.html#ad55ae4f4cfb1ffd2943a9b780f9c3507a04561c85889d705d544735c489094651">ITrackChangeAppSettings::kStrikethrough</a>) </td></tr><tr><td>Deleted TextColor Choice </td><td><a class="el" href="class_i_track_change_app_settings.html#a30c6c7ff67d2b41f87adf9c731ba838ba7aeaa0c9318724dc0aa1208062245ec3">ITrackChangeAppSettings::kUseGalleyColor</a></td></tr><tr><td>Moved Text Background Color Choice </td><td><a class="el" href="class_i_track_change_app_settings.html#ab7f5930fefa481e9fe484bb0a01b0b60ab0ac3857bcff7446f9637e04320e6036">ITrackChangeAppSettings::kUseUserColorBG</a></td></tr><tr><td>Moved Text Background Color Index </td><td>2 (InCopyUIColors =&gt; yellow) </td></tr><tr><td>Moved Text Color Choice </td><td><a class="el" href="class_i_track_change_app_settings.html#a30c6c7ff67d2b41f87adf9c731ba838ba7aeaa0c9318724dc0aa1208062245ec3">ITrackChangeAppSettings::kUseGalleyColor</a></td></tr><tr><td>Moved Text Color Index </td><td>1 (InCopyUIColors =&gt; black) </td></tr><tr><td>Moved Text Marking </td><td>3 (<a class="el" href="class_i_track_change_app_settings.html#ad55ae4f4cfb1ffd2943a9b780f9c3507a6f4632f079b34051bde2404cdeb5fc6e">ITrackChangeAppSettings::kOutline</a>) </td></tr><tr><td>Show Added Text </td><td>kTrue </td></tr><tr><td>Show Change Bar </td><td>kTrue </td></tr><tr><td>Show Deleted Text </td><td>kTrue </td></tr><tr><td>Show Moved Text </td><td>kTrue </td></tr><tr><td>Spellcheck Deleted Text </td><td>kTrue </td></tr></table><p><b>Notification</b><p>Notify <a class="el" href="classk_session_boss.html">kSessionBoss</a> with <a class="el" href="classk_set_track_changes_prefs_cmd_boss.html">kSetTrackChangesPrefsCmdBoss</a> message along with the IID_ITRACKCHANGEAPPSETTINGS protocol.<h3><a class="anchor" id="id_kactivateredlinecmdboss"></a> kActivateRedlineCmdBoss</h3><p><b>Description</b><p>Create the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>, and attach it to the story. It synchronizes the redline strand to the story to which it is attached. Usually, the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> is created when a new story is created. If the redline strand cannot be found, this command can be processed to get the strand back. The following is one way to check whether a redline strand is available in a story: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IRedlineDataStrand&gt;</a> redlineStrand ((<a class="code" href="class_i_redline_data_strand.html">IRedlineDataStrand</a>*)textModel-&gt;QueryStrand( <a class="code" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a>, IRedlineDataStrand::kDefaultIID));</div></div><p>If QueryStrand returns a valid <a class="el" href="class_i_redline_data_strand.html">IRedlineDataStrand</a> interface pointer, a redline strand is connected to the story.<p><b>Item List</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> that contains the UID of the text story to which the redline is supposed to be connected.<h3><a class="anchor" id="id_kdeactivateredlinecmdboss"></a> kDeactivateRedlineCmdBoss</h3><p><b>Description</b><p>This is the reverse of <a class="el" href="classk_activate_redline_cmd_boss.html">kActivateRedlineCmdBoss</a>. To delete the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> associated with a story, this command purges the strand from the associated VOS disk page, deregisters the redline strand from the text model, and removes the UID of the <a class="el" href="classk_redline_strand_boss.html">kRedlineStrandBoss</a> from the database. This command accepts all changes before it deletes the strand.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> that contains the UID of the text story from which the redline is supposed to be disconnected.<h3><a class="anchor" id="id_krejectallredlinecmdboss"></a> kRejectAllRedlineCmdBoss</h3><p><b>Description</b><p>Rejects all tracked change (redline) data in a story.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> that contains the UID of the text story for which the redline data is supposed to be rejected.<p><b>Data interface</b><p><a class="el" href="class_i_bool_data.html">IBoolData</a> with interface ID IID_IRESTORESELECTIONDATA. This interface defaults to false. Set to true to restore the selection.<p><b>Notification</b><p>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_reject_all_redline_cmd_boss.html">kRejectAllRedlineCmdBoss</a> message and IID_ITEXTMODEL protocol. Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the <a class="el" href="classk_reject_all_redline_cmd_boss.html">kRejectAllRedlineCmdBoss</a> message and IID_REJECTALLREDLINE_DOCUMENT protocol.<h3><a class="anchor" id="id_krejectrangeredlinecmdboss"></a> kRejectRangeRedlineCmdBoss</h3><p><b>Description</b><p>Rejects changes in the specified range. If the range&#39;s start index or end index corresponds to a deletion, this deletion is not rejected; such deletions should be detected and rejected individually if desired.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> containing UID of the text story for which the redline data is supposed to be rejected.<p><b>Data interface</b><ul><li><a class="el" href="class_i_redline_change_data.html">IRedlineChangeData</a> - Not needed. The command finds the change record based on the text index on which it is working. This interface is a placeholder for original change data, so it can be preserved.<li><a class="el" href="class_i_range_data.html">IRangeData</a> with IID_IRANGEDATA - The range of text for which you want to reject the change records.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IBOOLDATA - Not needed.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IRESTORESELECTIONDATA - The default is false; true restores the selection.</ul><p><b>Notification</b><ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_reject_range_redline_cmd_boss.html">kRejectRangeRedlineCmdBoss</a> message and IID_ITEXTMODEL protocol.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the <a class="el" href="classk_reject_range_redline_cmd_boss.html">kRejectRangeRedlineCmdBoss</a> message and IID_REJECTRANGEREDLINE_DOCUMENT protocol.</ul><h3><a class="anchor" id="id_krejectredlinecmdboss"></a> kRejectRedlineCmdBoss</h3><p><b>Description</b><p>Rejects the change record at the text index specified by the user.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> containing the UID of the text story for which the redline data is to be rejected.<p><b>Data interface</b><ul><li><a class="el" href="class_i_redline_change_data.html">IRedlineChangeData</a> with IID_IREDLINECHANGEDATA - Set this data interface to a <a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a> pointer returned from the <a class="el" href="class_redline_iterator.html#a6c315432abca975e76aa5701df8f322e">RedlineIterator::GetCurrentChangeRecord</a>. The GetCurrentChangeRecord takes a TextIndex and returns the current track change record for that index.<li><a class="el" href="class_i_range_data.html">IRangeData</a> with IID_IRANGEDATA - The text index of the change record to be rejected should be used as the range start and range end.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IBOOLDATA - Set to false to prevent notification if rejection is within reject-all context.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IRESTORESELECTIONDATA - This interface defaults to false. Set to true to restore selection.</ul><p><b>Notification</b><p>The command notifies only when the <a class="el" href="class_i_bool_data.html">IBoolData</a> (with IID_IBOOLDATA) is set to false.<ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_reject_redline_cmd_boss.html">kRejectRedlineCmdBoss</a> message and IID_ITEXTMODEL protocol.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the <a class="el" href="classk_reject_redline_cmd_boss.html">kRejectRedlineCmdBoss</a> message and IID_REJECTREDLINE_DOCUMENT protocol.</ul><h3><a class="anchor" id="id_kacceptallredlinecmdboss"></a> kAcceptAllRedlineCmdBoss</h3><p><b>Description</b><p>Accepts all tracked change (redline records) in a story.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> containing the UID of the text story for which the changes are to be accepted.<p><b>Data interface</b><p><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IRESTORESELECTIONDATA<ul><li>The default is false. True restores selection.</ul><p><b>Notification</b><ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_accept_all_redline_cmd_boss.html">kAcceptAllRedlineCmdBoss</a> message and IID_ITEXTMODEL protocol.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the <a class="el" href="classk_accept_all_redline_cmd_boss.html">kAcceptAllRedlineCmdBoss</a> message and IID_ACCEPTREDLINE_DOCUMENT protocol.</ul><h3><a class="anchor" id="id_kacceptrangeredlinecmdboss"></a> kAcceptRangeRedlineCmdBoss</h3><p><b>Description</b><p>Accepts changes in the specified range. If the range start index or end index corresponds to a deletion, it is not accepted. Such deletions should be detected and accepted individually if desired.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> containing the UID of the text story for which the changes are to be accepted.<p><b>Data interface</b><ul><li><a class="el" href="class_i_redline_change_data.html">IRedlineChangeData</a> - Not needed. The command finds the change record based on the text index on which it is working. This interface is a placeholder for the original change data, so it can be preserved.<li><a class="el" href="class_i_range_data.html">IRangeData</a> with IID_IRANGEDATA - This is the range of text for which you want to accept the change record.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IBOOLDATA - Not needed.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IRESTORESELECTIONDATA - The default is false; true restores selection.</ul><p><b>Notification</b><ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_accept_range_redline_cmd_boss.html">kAcceptRangeRedlineCmdBoss</a> message and IID_ITEXTMODEL protocol.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the <a class="el" href="classk_accept_range_redline_cmd_boss.html">kAcceptRangeRedlineCmdBoss</a> message and IID_ACCEPTRANGEREDLINE_DOCUMENT protocol.</ul><h3><a class="anchor" id="id_kacceptredlinecmdboss"></a> kAcceptRedlineCmdBoss</h3><p><b>Description</b><p>Accepts the change record at the text index specified by the user<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> containing the UID of the text story for which the change is to be accepted.<p><b>Data interface</b><ul><li><a class="el" href="class_i_redline_change_data.html">IRedlineChangeData</a> IID_IREDLINECHANGEDATA - Set this data interface to a <a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a> pointer returned from <a class="el" href="class_redline_iterator.html#a6c315432abca975e76aa5701df8f322e">RedlineIterator::GetCurrentChangeRecord</a>, which takes a TextIndex and returns the current track change record for that index.<li><a class="el" href="class_i_range_data.html">IRangeData</a> with IID_IRANGEDATA - The text index of the change record to be accepted should be used to as the range start and range end.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IBOOLDATA - Set to false to prevent notification if acceptance is within accept-all context.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IRESTORESELECTIONDATA - The default is false; true restores the selection.</ul><p><b>Notification</b><p>The command notifies only when the <a class="el" href="class_i_bool_data.html">IBoolData</a> (with IID_IBOOLDATA) is set to false.<p>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_accept_redline_cmd_boss.html">kAcceptRedlineCmdBoss</a> message and IID_ITEXTMODEL protocol.<h3><a class="anchor" id="id_kmoveredlinechangecmdboss"></a> kMoveRedlineChangeCmdBoss</h3><p><b>Description</b><p>Moves a tracked-change (redline) record from one (source) location to another (destination) location within the same story.<p><b>Item list</b><p><a class="el" href="class_u_i_d_list.html">UIDList</a> containing the UID of the text story for which a change is to be moved.<p><b>Data interface</b><ul><li><a class="el" href="class_i_redline_change_data.html">IRedlineChangeData</a> with IID_IREDLINECHANGEDATA - Set this data interface to a <a class="el" href="class_v_o_s_redline_change.html">VOSRedlineChange</a> pointer returned from <a class="el" href="class_redline_iterator.html#a6c315432abca975e76aa5701df8f322e">RedlineIterator::GetCurrentChangeRecord</a>. The <a class="el" href="class_redline_iterator.html">RedlineIterator</a> should be based on the source location.<li><a class="el" href="class_i_range_data.html">IRangeData</a> with IID_IRANGEDATA - The text index of the source change record should be used to as the range start, and the text index of the destination change record should be used to as the range end.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> with IID_IRESTORESELECTIONDATA - The default is false; true restores selection.</ul><p><b>Notification</b><p>The command notifies only when the <a class="el" href="class_i_bool_data.html">IBoolData</a> (with IID_IRESTORESELECTIONDATA) is set to true.<p>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the <a class="el" href="classk_move_redline_change_cmd_boss.html">kMoveRedlineChangeCmdBoss</a> message and IID_ITEXTMODEL protocol.<h3><a class="anchor" id="id_kredlinepreservedeletioncmdboss"></a> kRedlinePreserveDeletionCmdBoss</h3><p><b>Description</b><p>Copies a deletion record from one location to another. This works across stories.<p><b>Item list</b><p>When copying within the same story: a <a class="el" href="class_u_i_d_list.html">UIDList</a> that contains the UID of the text story for which the deletion record is supposed to be copied.<p>When copying across stories: a <a class="el" href="class_u_i_d_list.html">UIDList</a> with the first item (index 0 in the list) the UID of the source text story from which the deletion record is supposed to be copied, and the second item (index 1 in the list) the destination text story to which the deletion record is supposed to be copied.<p><b>Data interface</b><ul><li><a class="el" href="class_i_int_data.html">IIntData</a> with IID_ISRCDELDATA - Set this data interface to the source text index where the deletion record is anchored.<li><a class="el" href="class_i_int_data.html">IIntData</a> with IID_IDESTDELDATA - Set this data interface to the destination text index where the deletion record is to be anchored.</ul><p><b>Commands that should not be called directly</b><p>DeletedTextEditCmds methods provide the function to split deleted text into two deletions, to allow text to be inserted into the main story while the selection is in deleted text. Use these methods. Do not use <a class="el" href="classk_deleted_text_delete_cmd_boss.html">kDeletedTextDeleteCmdBoss</a>, <a class="el" href="classk_deleted_text_type_cmd_boss.html">kDeletedTextTypeCmdBoss</a>, <a class="el" href="classk_deleted_text_paste_cmd_boss.html">kDeletedTextPasteCmdBoss</a>, or <a class="el" href="classk_deleted_text_insert_cmd_boss.html">kDeletedTextInsertCmdBoss</a> directly.<h2><a class="anchor" id="id_working_with_track_changes"></a> Working with Track Changes</h2><h3><a class="anchor" id="id_navigating_tracked_changes"></a> Navigating tracked changes</h3><p>Whenever possible, use <a class="el" href="class_i_track_change_suite.html#a75f1b2918173ac8900b15a2a51cc3857">ITrackChangeSuite::GotoNextChange</a> and <a class="el" href="class_i_track_change_suite.html#a2fcb11bc611e88d6ca1570af35c94584">ITrackChangeSuite::GotoPreviousChange</a>. <a class="el" href="class_i_track_change_suite.html">ITrackChangeSuite</a> should be available as long as Track Changes is turned on. Alternately, you can access each change record using <a class="el" href="class_redline_iterator.html">RedlineIterator</a>.<h3><a class="anchor" id="id_accepting_and_rejecting_tracked_changes"></a> Accepting and rejecting tracked changes</h3><p>Use the <a class="el" href="class_i_track_change_suite.html#ae73984ba3d6b06b2629be6af3fb053c1">ITrackChangeSuite::Accept</a> and <a class="el" href="class_i_track_change_suite.html#a1e94fcfaa4b85ecd1bd763fc8a7b0028">ITrackChangeSuite::Reject</a> methods whenever possible. Alternately, use <a class="el" href="class_redline_iterator.html#a99d0666cce35a112a8e7e7203759c0be">RedlineIterator::ProcessAccept</a> and <a class="el" href="class_redline_iterator.html#a81212cf4786c4dc013f751f48e69e428">RedlineIterator::ProcessReject</a>. In general, low-level commands should be used only when the problem cannot be solved by <a class="el" href="class_redline_iterator.html">RedlineIterator</a> or the suite.<h3><a class="anchor" id="id_understanding_multiple_change_records_in_one_location"></a> Understanding multiple change records in one location</h3><p>When multiple change records in one location occur, the Track Changes subsystem manages them so the deletion record is at index 0 and the insertion record is at index 1. Use this information to get to the desired change record, as illustrated in the InspectTrackChange method in &lt;SDK&gt;/source/sdksamples/codesnippets/SnpInspectTextModel.cpp. This sample shows how to reach the insertion record when there are multiple change records in one location.<h3><a class="anchor" id="id_avoid_insignificant_tracked_changes"></a> Avoid insignificant tracked changes</h3><p>Use the redline phase, documented in the <a class="el" href="_i_redline_data_strand_8h_source.html">IRedlineDataStrand.h</a>, to modify the redline strand decision of whether to track an edit. For example, there probably is no need to track the insertion and deletion of carriage returns during paste operations, or the removal and insertion of XML tag characters.<h3><a class="anchor" id="id_undoing_accepted_deleted_text"></a> Undoing accepted deleted text</h3><p>Redlining can use the auto-undo architecture implemented for InDesign. Since accept and reject actions cause model changes, and the redline strand is on the model, accept and reject actions can be converted to auto-undo commands.<p>Basically, a snapshot is taken of the model during Do, which is restored during Undo. Accepting a deletion removes the change record; but since the redline strand is on the model, it also is part of the snapshot restored on Undo. This is what brings back the change record.<h3><a class="anchor" id="id_determining_whether_a_location_in_a_story_is_in_deleted_text"></a> Determining whether a location in a story is in deleted text</h3><p>Use IRedlineUtils::DetectDeletedText to determine whether a location is in deleted text.<p>Alternately, see the InspectTrackChange method in &lt;SDK&gt;/source/sdksamples/codesnippets/SnpInspectTextModel.cpp, which provides a way to achieve the same result.<h3><a class="anchor" id="id_determining_whether_a_primary_story-thread_location_is_at_a_deleted-text_anchor"></a> Determining whether a primary story-thread location is at a deleted-text anchor</h3><p>Use the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IItemStrand&gt;</a> itemStrand((<a class="code" href="class_i_item_strand.html">IItemStrand</a>*)textModel-&gt; QueryStrand(<a class="code" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>, IID_IITEMSTRAND));</div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> ownedUID = itemStrand-&gt;GetOwnedUID(withinPrimaryIndex, <a class="code" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>);</div><div class="line"><span class="keywordflow">if</span> (ownedUID != kInvalidUID){</div><div class="line"><span class="comment">// if you find a kDeletedTextBoss owned item in this index, </span></div><div class="line"><span class="comment">// it is a deleted text anchor</span></div><div class="line">}</div></div><p>Alternatively, you can use <a class="el" href="class_i_track_change_utils.html#a2376564060ca4e4ea63ab3aa07ce3de6">ITrackChangeUtils::PrimaryIndexToDeletedText</a>, which returns true if deleted text is anchored at a specified primary index. This method also returns the deleted thread start and thread span.<h3><a class="anchor" id="id_getting_kdeletedtextboss_given_a_text_index_having_deleted_text"></a> Getting kDeletedTextBoss, given a text index having deleted text</h3><p>The following snippet shows one way to get <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> if you know the position has deleted text: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IItemStrand&gt;</a> itemStrand((<a class="code" href="class_i_item_strand.html">IItemStrand</a>*)model -&gt;QueryStrand(<a class="code" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>, IID_IITEMSTRAND));</div><div class="line"><span class="keywordflow">if</span> (itemStrand){</div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> deletedTextUID = itemStrand-&gt;GetOwnedUID(position, <a class="code" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>);</div><div class="line"><span class="comment">// deletedTextUID is the UID of the kDeletedTextBoss</span></div><div class="line">}</div></div><p>Even better, use <a class="el" href="class_i_track_change_utils.html#af185f26458f990db4cceb3c7ef5d238c">ITrackChangeUtils::GetDeletedText</a> to get the same UID plus the deleted text stored in a <a class="el" href="class_wide_string.html">WideString</a> or <a class="el" href="class_p_m_string.html">PMString</a> of your choice.<h3><a class="anchor" id="id_removing_deleted_text"></a> Removing deleted text</h3><p>Accepting a deletion removes the associated <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a> from the text model and makes the deletion permanent (unless you undo the accept operation). There are many ways to accept a deletion, as described in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_accepting_and_rejecting_tracked_changes">Accepting and rejecting tracked changes</a>. If you know the UID of the <a class="el" href="classk_deleted_text_boss.html">kDeletedTextBoss</a>, you can use IRedlineUtils::RemoveDeletion, which calls <a class="el" href="class_redline_iterator.html#a99d0666cce35a112a8e7e7203759c0be">RedlineIterator::ProcessAccept</a> to remove the deleted-text owned item.<h3><a class="anchor" id="id_moving_a_change_record_from_one_story_to_another"></a> Moving a change record from one story to another</h3><p>Moving a change record from one story to another is not always straightforward; it depends on what kind of change record you want to move. <a class="el" href="classk_redline_preserve_deletion_cmd_boss.html">kRedlinePreserveDeletionCmdBoss</a> is a command for preserving deletions that works across stories. There are methods on the <a class="el" href="class_i_redline_data_strand.html">IRedlineDataStrand</a> to remove and apply insertions that could be used across stories similar to <a class="el" href="classk_move_redline_change_cmd_boss.html">kMoveRedlineChangeCmdBoss</a>, which does not work across stories.<h3><a class="anchor" id="id_maintaining_kredlinestrandboss_text-run_information"></a> Maintaining kRedlineStrandBoss text-run information</h3><p>Text-run information cannot be maintained. The redline strand has a similar concept to text run, but its objects are divided on change boundaries rather than attributes, and they are not really considered runs but, rather, objects that may or may not have a change record. Use the <a class="el" href="class_redline_iterator.html">RedlineIterator</a> to find the tracked changes.<h1><a class="anchor" id="id_printing"></a> Printing</h1><p>This chapter provides information about the concepts surrounding the process of printing a publication, including the printing data model and commands, the printing user interface, key interfaces, and how plug-ins can participate in the printing process.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><h3><a class="anchor" id="id_printing_is_simply_drawing_to_the_printer"></a> Printing is simply drawing to the printer</h3><p>The implementation and user interface for printing from InDesign and InCopy are similar to those for printing from other Adobe applications, like Photoshop and Illustrator. All these applications use a common component, the Adobe Graphics Manager (AGM), to handle the core printing tasks. Printing from the application entails drawing part or all of a document to a printer rather than to the screen. Adobe applications use Display PostScript, supplied by AGM, to draw graphics primitives to both the screen and the printer.<p>For more information on how document content is drawn to an output device, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>.<h3><a class="anchor" id="id_control_can_be_shared"></a> Control can be shared</h3><p>The tasks of printing from InDesign can be shared among the following:<ul><li>AGM, which is responsible for PostScript generation.<li>The InDesign Print plug-in, which is responsible for the user interface, initialization of print settings, and drawing pages. (See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_the_print_action_sequence">The print action sequence</a>.)<li>Plug-ins that implement various print-related extension patterns, which provide the ability to participate in the printing process carried out by the Print plug-in</ul><p>A plug-in can use printing commands, interfaces, structures, and event-handling mechanisms to print with the C++ API. By understanding the flow of operations in the application&#39;s Print plug-in, you can design a plug-in to participate in the print process and the print user interface by hooking onto the various extensibility points.<p>Third-party plug-in developers do not have direct access to the AGM API. Instead, the application provides the user interface, commands, interfaces, and data structures necessary to drive and participate in the printing process. For details, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_printing_data_model">Printing data model</a>.<h3><a class="anchor" id="id_inks_and_colors"></a> Inks and colors</h3><p>When printing a document to any output device, the colors used in a printable item on each page need to be rendered. Depending on the output device and print settings, each color can be separated into multiple inks. This is done so a system like a four-color (CMYK) printing press can render each printable item. In some cases, printable items can contain spot colors, which generally correspond to a specific ink.<p>Colors, gradients, and spot colors generally are referred to as swatches. A swatch is identified by the <a class="el" href="class_i_rendering_object.html">IRenderingObject</a> interface. Inks are identified by the <a class="el" href="class_i_p_m_ink_boss_data.html">IPMInkBossData</a> interface.<p>For more details on inks and colors, see the chapter entitled &quot;Graphics Fundamentals&quot; in volume 1 of this guide.<h3><a class="anchor" id="id_overprinting"></a> Overprinting</h3><p>You can specify the way in which inks are printed on top of one another. Depending on how you set up overprinting, the colors of overlapping items of different colors may appear differently. For more details on overprinting, see InDesign Help.<h3><a class="anchor" id="id_trapping"></a> Trapping</h3><p>Trapping allows an output device to compensate for printing problems due to paper misregistration. When the print medium (for example, paper) is not registered exactly in a multi-color press system, the output can show unintended gaps between inks. An example of a case in which this is especially important is when a printable item has a thin, dark border around a lighter-colored shape. By specifying how trapping is set up, you can compensate for media-registration errors.<h3><a class="anchor" id="id_color_management_and_proofing"></a> Color management and proofing</h3><p>What you see on the screen may not always be what you see printed on print media. This is due to variances in how each device used in the design and print process renders colors. For example, your computer monitor may show a bright red apple, but when that is printed on paper using a specific set of inks on a specific output device, the apple may appear to be a different color or brightness. Colors also may shift in the input device, such as digital scanners and cameras. It can be hard to make sure the colors appear as you want on the print media. InDesign and InCopy offer features to manage color throughout the design process.<p>For more details on color management and proofing, see &quot;Color Management&quot; in InDesign Help and <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>.<h3><a class="anchor" id="id_preflight_and_packaging"></a> Preflight and packaging</h3><p>Preflight is a way to verify before you send a publication to the output device that you have all associated files, fonts, assets (for example, placed images and PDF files), printer settings, trapping styles, and so on. For example, if you placed an image as a low-resolution proxy but do not have the high-resolution original image accessible on your hard disk (or workgroup server), that may result in an error during the printing process. Preflight checks for this sort of problem.<p>For details, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_implementing_preflight_rules">Implementing Preflight Rules</a>.<h3><a class="anchor" id="id_exporting_to_eps_and_pdf"></a> Exporting to EPS and PDF</h3><p>Although the user interface for exporting a publication to the EPS and PDF file formats is different from that for printing, the output processes incorporate the same types of drawing components (AGM, inks and color swatches, color management, etc.). Some publishing workflows may incorporate exporting to EPS or PDF as part of the proofing and output steps. Though this document does not go into the details of extending the EPS and PDF export capabilities of the application, you can refer to <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_exporting_to_eps_and_pdf">Exporting to EPS and PDF</a> for some highlights of how to drive the EPS and PDF export features.<h2><a class="anchor" id="id_printing_data_model"></a> Printing data model</h2><p>This section describes the printing data model, commands, interfaces, and structures available in the SDK. InDesign and InCopy can print documents and books to a registered output device. The registered output device can be a printer, PostScript file, or external file format like EPS or PDF.<h3><a class="anchor" id="id_print_settings"></a> Print settings</h3><p>This section describes the data interfaces that make up the print-settings data model. For information on bosses that aggregate these interfaces, refer to the API Reference. The print settings generally are set by the user in either the Print or Print Presets dialog box. (For more information on the Print user interface, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_user_interface">Print user interface</a>.)<p><b><a class="el" href="class_i_print_data.html">IPrintData</a></b><p><a class="el" href="class_i_print_data.html">IPrintData</a> is the main data interface that keeps most print-settings data. It also is the interface passed among the print commands during a print operation or in the Print or Print Presets dialog box.<p><b>Other interfaces that store print settings</b><ul><li><a class="el" href="class_i_print_device_info.html">IPrintDeviceInfo</a> stores data about printing devices.<li><a class="el" href="class_i_print_job_data.html">IPrintJobData</a> stores data specific to a print job.<li><a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a> specifies which content (for example, text, page items, Japanese layout grids, or frame grids) should be printed or omitted from printing.<li><a class="el" href="class_i_output_pages.html">IOutputPages</a> stores data about pages or spreads to print.<li><a class="el" href="class_i_trap_style.html">ITrapStyle</a> stores a set of trap settings with a specified name.<li><a class="el" href="class_i_print_glyph_threshold_pref.html">IPrintGlyphThresholdPref</a> specifies whether all glyphs of a font are to be downloaded to the output device completely or subsetted.</ul><h3><a class="anchor" id="id_print_preset_styles"></a> Print preset styles</h3><p>A print preset style is a group of print settings with a specified name. Of the print-settings data model interfaces, the <a class="el" href="class_i_print_data.html">IPrintData</a> and <a class="el" href="class_i_print_device_info.html">IPrintDeviceInfo</a> data interfaces are stored as part of a print-preset style. A print-preset style is represented by <a class="el" href="classk_pr_st_style_boss.html">kPrStStyleBoss</a>, and a list of defined print-preset-style boss instances is managed in the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> using the <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> interface. <a class="el" href="classk_pr_st_style_boss.html">kPrStStyleBoss</a> also aggregates <a class="el" href="class_i_gen_style_lock_info.html">IGenStyleLockInfo</a>, which specifies whether the style is locked or can be deleted.<p>When a list of print-preset settings is exported to a file (database), the root of that database is an instance of <a class="el" href="classk_pr_st_export_root_boss.html">kPrStExportRootBoss</a>, which also aggregates <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a>. Using this <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> interface, you can iterate through the print-preset styles that are stored in the exported file.<h3><a class="anchor" id="id_trap_styles"></a> Trap styles</h3><p>A trap style is a set of trap settings with a specified name. A trap style is represented by <a class="el" href="classk_trap_style_boss.html">kTrapStyleBoss</a> and aggregates the <a class="el" href="class_i_trap_style.html">ITrapStyle</a> interface. <a class="el" href="classk_trap_style_boss.html">kTrapStyleBoss</a> also aggregates <a class="el" href="class_i_gen_style_lock_info.html">IGenStyleLockInfo</a>, which specifies whether the style is locked or can be deleted. A trap style is associated with an individual page in a document.<p>A list of trap styles is accessible from <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> (the trap styles used on a document), <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> (the workspace default trap styles), and <a class="el" href="classk_book_boss.html">kBookBoss</a> (the trap styles used in a book).<dl class="section note"><dt>Note<dd><a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> does not inherit from <a class="el" href="class_i_gen_stl_edt_list_mgr.html">IGenStlEdtListMgr</a> like <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> does; therefore, the behavior of some <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> methods differs from that of any interfaces derived from <a class="el" href="class_i_gen_stl_edt_list_mgr.html">IGenStlEdtListMgr</a>, and the general style-editing family of APIs (commands like <a class="el" href="classk_gen_stl_edt_export_styles_cmd_boss.html">kGenStlEdtExportStylesCmdBoss</a> and interfaces like <a class="el" href="class_i_generic_settings.html">IGenericSettings</a>) do not apply to trap styles managed in <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>.</dl><h2><a class="anchor" id="id_utility_apis"></a> Utility APIs</h2><p>The following utility interfaces are available to facilitate the management and manipulation of print data settings:<ul><li><a class="el" href="class_i_print_utils.html">IPrintUtils</a> (<a class="el" href="classk_utils_boss.html">kUtilsBoss</a>) contains various methods for checking settings on <a class="el" href="class_i_print_data.html">IPrintData</a>. <a class="el" href="class_i_print_utils.html">IPrintUtils</a> also has InitializeOutputPages, a method that fills a list of pages to output, given <a class="el" href="class_i_print_data.html">IPrintData</a> and a document.<li><a class="el" href="class_i_trap_style_utils.html">ITrapStyleUtils</a> (<a class="el" href="classk_utils_boss.html">kUtilsBoss</a>) contains methods to facilitate manipulation of trap styles.</ul><p>For details, refer to the API Reference.<h2><a class="anchor" id="id_the_print_action_sequence"></a> The print action sequence</h2><p>When you print a document or book in InDesign or InCopy, the application processes a hierarchy of commands. This is the core feature provided by the Print plug-in. This section discusses the sequence of events that take place during the print process and explains the various extensibility points for third-party plug-ins.<p>The primary actions taken by the Print plug-in are as follows:<ol type="1"><li>Client code (usually in the form of a menu action or script event) receives two pieces of information: <a class="el" href="class_i_document.html">IDocument</a> for the document to be printed and a user-interface options flag indicating which parts of the print user interface should be displayed. The client code creates and executes a specific print-action command, which is one of the following:<ul><li><a class="el" href="classk_print_action_cmd_boss.html">kPrintActionCmdBoss</a> - for printing a document in InDesign.<li><a class="el" href="classk_book_print_action_cmd_boss.html">kBookPrintActionCmdBoss</a> - for printing a book in InDesign.<li>kInCopyPrintActionCmdBoss - for printing a document in InCopy. <dl class="section note"><dt>Note<dd>For brief descriptions of these commands, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_action_and_supporting_commands">Print-action and supporting commands</a>.</dl></ul><li>From within the print-action command, a series of supporting print commands is processed. All subsequent steps originate from inside this print-action command.<li>A print-command data interface (<a class="el" href="class_i_print_cmd_data.html">IPrintCmdData</a>) used by all print commands gets the <a class="el" href="class_i_document.html">IDocument</a> supplied by the client code, along with the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for the print style (if any), the document&#39;s ink list, and trap-style manager.<li>The print-action command polls print-setup providers (service providers of kPrintSetupService) to determine whether any plug-in wants to participate in the print process by calling <a class="el" href="class_i_print_setup_provider.html#abea21c408d947d4740eb392f9bfdc5fd">IPrintSetupProvider::StartPrintPub</a> (for document printing) or <a class="el" href="class_i_print_setup_provider.html#aac1678dff6762b96d542d62723067eaa">IPrintSetupProvider::StartPrintBook</a> (for book printing). A print-setup provider can either take over the process at this point (including aborting the printing process by means of a flag passed in the parameter list) or perform an action and return control to the Print plug-in.<li>If control returns to the Print plug-in, a nonpersistent instance of a print-settings data boss (generally <a class="el" href="classk_print_data_boss.html">kPrintDataBoss</a>) is created. This is passed around during the rest of the printing process in each supporting print command.<li>The print-action command polls print-setup providers and calls <a class="el" href="class_i_print_setup_provider.html#ab6b3b9c3a75cca8fd931f154350beea1">IPrintSetupProvider::BeforePrintUI</a>. A print-setup provider can determine whether to display the print user interface before returning control. After all print-setup providers are polled, the user-interface options flag is examined. If the print user interface is to be shown, the kPrintDialogCmdBoss is created and processed. If the dialog box is opened, the user can modify the settings for this particular print operation. The settings are stored back in the instance of the print-settings data boss created in the previous step.<li>The print-action command polls print-setup providers and calls <a class="el" href="class_i_print_setup_provider.html#a59d37be4bf117bc160090be79d1484a6">IPrintSetupProvider::AfterPrintUI</a>. A print-setup provider can either take over the process at this point or perform an action (for example, set the flag indicating whether to show the Save dialog box) and return control to the Print plug-in. If the Save dialog box is to be shown, the <a class="el" href="classk_save_file_dialog_boss.html">kSaveFileDialogBoss</a> is processed.<li>If control returns to the Print plug-in, the print settings data (<a class="el" href="class_i_print_data.html">IPrintData</a>) is saved to the document by means of processing <a class="el" href="classk_print_save_print_data_cmd_boss.html">kPrintSavePrintDataCmdBoss</a> (for documents) or <a class="el" href="classk_book_save_print_data_cmd_boss.html">kBookSavePrintDataCmdBoss</a> (for books).<li>Data is gathered for the print job. kPrintGatherDataCmdBoss is created but not yet processed. An instance of <a class="el" href="class_i_output_pages.html">IOutputPages</a> is created.<li>The print-action command polls print-setup providers and calls <a class="el" href="class_i_print_setup_provider.html#ad597542d87f496a3f92dc1d25e7b1b64">IPrintSetupProvider::BeforePrintGatherCmd</a>. A print-setup provider can determine whether to allow processing of the kPrintGatherDataCmdBoss created earlier and whether to return control.<li>If control returns, the print-action command polls print-setup providers and calls <a class="el" href="class_i_print_setup_provider.html#aef186ffb1df72d4a6488b6c3ad29603e">IPrintSetupProvider::AfterPrintGatherCmd</a>. A print-setup provider can determine whether to quit here or return control to the Print plug-in.<li>If control returns, a core print command (kNewPrintCmdBoss if running in InDesign or kInCopyNewPrintCmdBoss if running in InCopy) is created and processed. This is where the document or book data actually is sent to the output device.<li>If an error occurs during the core print command, it polls print-setup providers and calls <a class="el" href="class_i_print_setup_provider.html#a2de1174350ca28802a1944b1b2220cfb">IPrintSetupProvider::PrintErrorEvent</a>. A print-setup provider can handle the print event and determine whether the error message should be displayed to the user. The global error code is set, and the core print command is aborted.<li>If no errors occurred in the core print command, the print-action command saves the print data again (in case it changed during printing).<li>The print process ends. The print-action command polls print-setup providers and calls <a class="el" href="class_i_print_setup_provider.html#abae2934dc73d66b483ae48b2be0ad9e1">IPrintSetupProvider::EndPrint</a>. This is the final opportunity for print-setup providers to participate in the print process.</ol><h3><a class="anchor" id="id_common_print_interfaces"></a> Common print interfaces</h3><p>The following are the data interfaces used during the print-action sequence and supporting commands:<ul><li><a class="el" href="class_i_print_cmd_data.html">IPrintCmdData</a> stores most print settings. <a class="el" href="class_i_print_cmd_data.html">IPrintCmdData</a> is used commonly among the print commands.<li><a class="el" href="class_i_print_data.html">IPrintData</a> stores most print settings data. (See IPrintData.)<li><a class="el" href="class_i_output_pages.html">IOutputPages</a> stores data about pages or spreads to print.<li><a class="el" href="class_i_book_print_data.html">IBookPrintData</a> stores book-printing options for the <a class="el" href="classk_book_save_print_data_cmd_boss.html">kBookSavePrintDataCmdBoss</a>.<li><a class="el" href="class_i_print_job_data.html">IPrintJobData</a> stores data specific to a print job.<li><a class="el" href="class_i_print_dialog_cmd_data.html">IPrintDialogCmdData</a> stores data for the kPrintDialogCmdBoss.<li><a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a> specifies which content (for example, text, page items, Japanese layout grids, and frame grids) should be printed or omitted from printing.<li><a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> stores settings used to construct the Galley panel and contains information about the constructed Galley panel for printing and PDF export in InCopy.</ul><h2><a class="anchor" id="id_print_user_interface"></a> Print user interface</h2><p>The print user interface lets an end user change print settings during a print process or in print preset styles. This section describes the design of the Print and Print Presets dialog boxes and how they are invoked, and it presents an overview of how to extend these dialog boxes.<h3><a class="anchor" id="id_print_dialog_box"></a> Print dialog box</h3><p>The Print dialog box shows the current print settings for the frontmost document. This dialog box opens when the user chooses File &gt; Print in InDesign or chooses one of the print preset styles from the File &gt; Print Presets menu. The Print dialog box also opens when the user chooses Print from the Book panel. This dialog box is invoked programmatically in InDesign by processing the kPrintDialogCmdBoss command.<dl class="section note"><dt>Note<dd>An InCopy version of the Print dialog box is invoked by processessing the <a class="el" href="classk_in_copy_print_dialog_cmd_boss.html">kInCopyPrintDialogCmdBoss</a> box. This section focuses on the InDesign version of the Print dialog box.</dl><p>The Print dialog box is a selectable dialog box, which contains a list of panels that are selectable by a list (located on the left-hand side of the dialog box). The Print dialog box contains the following panels:<ul><li>General<li>Setup<li>Marks And Bleed<li>Output<li>Graphics<li>Color Management<li>Advanced<li>Summary</ul><p>The panels are shown in order in the following sections. Below a screen shot of each panel is a list of methods on the print data-model interfaces (for example, <a class="el" href="class_i_print_data.html">IPrintData</a>) corresponding to each user-interface element on the panel.<p>For details on these settings, see InDesign Help.<p><b>Print dialog box: General panel</b><div class="image"><img alt="plugin-programming-guide-vol2-23.gif" src="plugin-programming-guide-vol2-23.gif" /></div><p>The three user-interface elements above the selectable panel region of the dialog box are common in all Print dialog box screenshots and are mapped to the following API methods:<ul><li>Style Name - <a class="el" href="class_i_print_data.html#af91eba05dc061a64e980d1514bfc6b2a">IPrintData::SetStyleName</a><li>Printer - <a class="el" href="class_i_print_device_info.html#afd0a6bbe7f1ee0ee4a95deb124d3ba60">IPrintDeviceInfo::UpdatePrinterInfo</a> (which calls <a class="el" href="class_i_print_data.html#a979fa8e6df771ae4e318d50a3726c870">IPrintData::SetPrinter</a> internally. Get with <a class="el" href="class_i_print_data.html#a5514b993f5449fce222b0bcd2c02e58e">IPrintData::GetPrinter</a>.)<li>PPD - <a class="el" href="class_i_print_device_info.html#afd0a6bbe7f1ee0ee4a95deb124d3ba60">IPrintDeviceInfo::UpdatePrinterInfo</a> (which calls <a class="el" href="class_i_print_data.html#a93a31edb8aa7b7abbb1b66422f4d8e9e">IPrintData::SetPPDFile</a> and <a class="el" href="class_i_print_data.html#a4142937cfab9e57da67cd62167efadaa">IPrintData::SetPPDName</a> internally. Get with <a class="el" href="class_i_print_data.html#ac0018af7add331a958a9f90091520c81">IPrintData::GetPPDFile</a> and <a class="el" href="class_i_print_data.html#af1715172158df4a8cdab96e7a799e44f">IPrintData::GetPPDName</a>.)</ul><dl class="section note"><dt>Note<dd>Generally, there is a corresponding Get method for each Set method.</dl><p>The user-interface elements on the General panel are mapped to the API methods listed in the following table .<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>Copies </td><td><a class="el" href="class_i_print_data.html#ac899e01db607125717a6917a74bd7f17">IPrintData::SetCopies</a></td></tr><tr><td>Collate </td><td><a class="el" href="class_i_print_data.html#ad06e621d2e5f98cc0312967630d82278">IPrintData::SetCollate</a></td></tr><tr><td>Reverse Order </td><td><a class="el" href="class_i_print_data.html#a2a22ad7ebc260035cac61fa443aca271">IPrintData::SetReverseOrder</a></td></tr><tr><td>Pages: All </td><td>IPrintData::SetWhichPages(IPrintData::kAllPages) </td></tr><tr><td>Pages: Range </td><td>IPrintData::SetWhichPages(IPrintData::kPageRange) (Range text edit box): <a class="el" href="class_i_print_data.html#a4866b63963480dc578cc13b67f58b7d9">IPrintData::SetPageRange</a></td></tr><tr><td>Sequence </td><td><a class="el" href="class_i_print_data.html#a0914480541e1fa8d74845d4d61ddeee1">IPrintData::SetPrintOption</a>, using IPrintData::kBothPages (for All Pages), IPrintData::kEvenPagesOnly, or IPrintData::kOddPagesOnly </td></tr><tr><td>Spreads </td><td><a class="el" href="class_i_print_data.html#a448ce7542066902e64e837ea8fcc0c62">IPrintData::SetSpreads</a></td></tr><tr><td>Print Master Pages </td><td><a class="el" href="class_i_print_data.html#aac5412e3dc383f921080324697330f66">IPrintData::SetScope</a>, using IPrintData::kScopeMaster or IPrintData::kScopeDocument </td></tr><tr><td>Print Non-printing Objects </td><td><a class="el" href="class_i_print_data.html#a03991b1ce39696ba79f0f15f02f62d9f">IPrintData::SetPrintNonPrintingObjects</a></td></tr><tr><td>Print Blank Pages </td><td><a class="el" href="class_i_print_data.html#adeab81352c50709b463a4b648b5ac9d4">IPrintData::SetPrintBlankPages</a></td></tr><tr><td>Print Visible Guides and Baseline Grids </td><td><a class="el" href="class_i_print_data.html#a127967f1c482c6db9b03bfa96a01ff98">IPrintData::SetPrintWYSIWYGGridsGuides</a></td></tr></table><p><b>Print dialog box: Setup panel</b><div class="image"><img alt="plugin-programming-guide-vol2-24.gif" src="plugin-programming-guide-vol2-24.gif" /></div><p>The user-interface elements on the Setup selectable panel are mapped to the API methods listed in the following table.<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>Paper Size </td><td><a class="el" href="class_i_print_data.html#a2dcb797470674c3b4c2ffecc4ef90d43">IPrintData::SetPaperSizeSelection</a> if defined by the user (IPrintData::kPaperSizeDefinedByUser), printer driver (IPrintData::kPaperSizeDefinedByDriver), or <a class="el" href="class_i_print_data.html#a83ad5d7fcbf333ec201c55fd7f8122b1">IPrintData::SetPaperSizeName</a></td></tr><tr><td>Paper Size: Width </td><td><a class="el" href="class_i_print_data.html#a6453f63b141fe86c745f52379ca6efc4">IPrintData::SetCustomPaperWidth</a> only if Paper Size is defined by the user; otherwise (if defined by driver or paper-size name), IPrintData::SetCustomPaperWidth(IPrintData::kCustomPaperSizeAuto) </td></tr><tr><td>Paper Size: Height </td><td><a class="el" href="class_i_print_data.html#af3049aa03cd2daa87111516557c9aefd">IPrintData::SetCustomPaperHeight</a> only if Paper Size is defined by user; otherwise (if defined by driver or paper-size name), IPrintData::SetCustomPaperHeight(IPrintData::kCustomPaperSizeAuto) </td></tr><tr><td>Offset </td><td><a class="el" href="class_i_print_data.html#adaa5a7e46d42a99df8fd56c82da4f47c">IPrintData::SetCustomPaperOffset</a> only if Paper Size is defined by the user </td></tr><tr><td>Gap </td><td><a class="el" href="class_i_print_data.html#aa4d2113e342c3e64593e060e59fcc3b3">IPrintData::SetCustomPaperGap</a> only if Paper Size is defined by the user </td></tr><tr><td>Transverse </td><td><a class="el" href="class_i_print_data.html#a7bfb132167941e6ea47fe85a83f548f2">IPrintData::SetPaperOrientation</a>, using IPrintData::kTransverse or IPrintData::kNormal </td></tr><tr><td>Orientation </td><td><a class="el" href="class_i_print_data.html#ae0687b75fd27849cef2aa9feb4083446">IPrintData::SetPageOrientation</a>, using IPrintData::kPortrait, IPrintData::kLandscape, IPrintData::kReversePortrait, or IPrintData::kReverseLandscape </td></tr><tr><td>Scale (radio button) </td><td><a class="el" href="class_i_print_data.html#a42a7ca38263b509813647517091ff261">IPrintData::SetScaleMode</a> using IPrintData::kScaleXAndY </td></tr><tr><td>Scale: Width </td><td><a class="el" href="class_i_print_data.html#a572951fe071e5f53ec81978b96309169">IPrintData::SetXScale</a></td></tr><tr><td>Scale: Height </td><td><a class="el" href="class_i_print_data.html#aecd5d121af76c3e3db5fbdde8d7fef65">IPrintData::SetYScale</a></td></tr><tr><td>Scale: Constrain Proportions </td><td><a class="el" href="class_i_print_data.html#af59da2fc4724c802f60a6db3001efb12">IPrintData::SetProportional</a></td></tr><tr><td>Scale to Fit (radio button) </td><td><a class="el" href="class_i_print_data.html#a42a7ca38263b509813647517091ff261">IPrintData::SetScaleMode</a> using IPrintData::kScaleToFit </td></tr><tr><td>Page Position </td><td><a class="el" href="class_i_print_data.html#a9da586bec7f003b000b98e7e33e044fc">IPrintData::SetPagePosition</a>, using IPrintData::kPagePositionUpperLeft, IPrintData::kPagePositionCenterHorizontally, IPrintData::kPagePositionCenterVertically, or IPrintData::kPagePositionCentered </td></tr><tr><td>Print Layers </td><td><a class="el" href="class_i_print_data.html#a6097293f30cacf2a76377de4d76f73b8">IPrintData::SetPrintLayers</a> using kPrintAllLayers, kPrintVisibleLayers, or kPrintVisiblePrintableLayers. </td></tr><tr><td>Thumbnails </td><td><a class="el" href="class_i_print_data.html#a5c883c9c89868c835dafbaa16f5f2a36">IPrintData::SetTileThumbMode</a>, using IPrintData::kThumbnails or IPrintData::kTileThumbOff </td></tr><tr><td>Per Page </td><td><a class="el" href="class_i_print_data.html#a01881f74f07e66e78a51488d6b98e335">IPrintData::SetNumberOfThumbsPerPage</a>. Calculate the number of thumbnails on the page (for example, 4x4 = 16). </td></tr><tr><td>Tile </td><td><a class="el" href="class_i_print_data.html#a5c883c9c89868c835dafbaa16f5f2a36">IPrintData::SetTileThumbMode</a>, using IPrintData::kTiling or IPrintData::kTileThumbOff </td></tr><tr><td>Overlap </td><td><a class="el" href="class_i_print_data.html#a8305fc775394568ef5e5b513b09f6018">IPrintData::SetTilingOverlap</a></td></tr></table><p><b>Print dialog box: Marks and Bleed panel</b><p>(Roman feature set) <div class="image"><img alt="print-marksandbleed.gif" src="print-marksandbleed.gif" /></div><p>The user-interface elements on the Marks And Bleed selectable panel are mapped to the API methods listed in the following table.<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>All Printer&#39;s Marks </td><td>Checking this sets the state of the five check boxes below it. </td></tr><tr><td>Crop Marks </td><td><a class="el" href="class_i_print_data.html#ab6460a5ebc9bf3f1fe7f21582c4a7197">IPrintData::SetCropMarks</a></td></tr><tr><td>Bleed Marks </td><td><a class="el" href="class_i_print_data.html#a2aba760a5d360c482fe6ada00fdc1404">IPrintData::SetBleedMarks</a></td></tr><tr><td>Registration Marks </td><td>PrintData::SetRegistrationMarks </td></tr><tr><td>Color Bars </td><td><a class="el" href="class_i_print_data.html#a79da7097ba444ac7bae1cdd5c29ddf4d">IPrintData::SetColorBars</a></td></tr><tr><td>Page Information </td><td>PrintData::SetPageInformation </td></tr><tr><td>Type </td><td><a class="el" href="class_i_print_data.html#ad61a9a67f72efd87aad3147b4a6006f6">IPrintData::SetPageMarkFile</a>. For the Roman and Japanese feature sets, you get the Default setting; in this case, the <a class="el" href="class_p_m_string.html">PMString</a> passed into SetPageMarkFile is blank. There are extra details when using the Japanese feature set; see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_japanese_page_mark_files">Japanese page-mark files</a>. </td></tr><tr><td>Weight </td><td><a class="el" href="class_i_print_data.html#ac5dd8cf6837e82438833f4fb6407db4f">IPrintData::SetMarkLineWeight</a>, using the enumerations ranging from IPrintData::kMarkLineWeight125pt to IPrintData::kMarkLineWeight30mm (see <a class="el" href="_i_print_data_8h_source.html">IPrintData.h</a>.) </td></tr><tr><td>Offset </td><td><a class="el" href="class_i_print_data.html#aca7487b54ff316cc6d314506961414f5">IPrintData::SetPageMarkOffset</a></td></tr><tr><td>Use Document Bleed Settings </td><td><a class="el" href="class_i_print_data.html#aeb6a44fd4aeb83c40f5089dba38dd735">IPrintData::SetUseDocumentBleed</a></td></tr><tr><td>Bleed (chain button) </td><td><a class="el" href="class_i_print_data.html#ad4a70f743782a87705622042f79ecbe4">IPrintData::SetBleedChain</a></td></tr><tr><td>Bleed: Top </td><td><a class="el" href="class_i_print_data.html#aa9922a8a62935a8a09e75ea0bdbeb700">IPrintData::SetBleedTop</a></td></tr><tr><td>Bleed: Bottom </td><td><a class="el" href="class_i_print_data.html#aec56c1a2d5cb6dc8c8a121f4312a3e53">IPrintData::SetBleedBottom</a></td></tr><tr><td>Bleed: Inside </td><td><a class="el" href="class_i_print_data.html#a2d0b1fadad1c7cf98d31a5289395598d">IPrintData::SetBleedInside</a></td></tr><tr><td>Bleed: Outside </td><td><a class="el" href="class_i_print_data.html#a9241d4b508b92d2b160e0319204deadd">IPrintData::SetBleedOutside</a></td></tr><tr><td>Include Slug Area </td><td><a class="el" href="class_i_print_data.html#ae29d36200263f1904d1c8e82beeb35fe">IPrintData::SetIncludeSlug</a></td></tr></table><p><b>Print dialog box: Output panel</b><div class="image"><img alt="print-output.gif" src="print-output.gif" /></div><p>The user-interface elements on the Output selectable panel are mapped to the API methods listed in the following table.<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>Color </td><td><a class="el" href="class_i_print_data.html#a5d99b6f70862278703ebddb6073387b0">IPrintData::SetOutputMode</a>, using IPrintData::kCompositeLeaveUnchanged, IPrintData::kCompositeGray, IPrintData::kCompositeRGB, IPrintData::kCompositeCMYK, IPrintData::kSeparationBuiltIn, or IPrintData::kSeparationInRIP </td></tr><tr><td>Text as Black </td><td><a class="el" href="class_i_print_data.html#a032c02c18c807c04f857064714c063ed">IPrintData::SetPrintColorsInBlack</a></td></tr><tr><td>Trapping </td><td><a class="el" href="class_i_print_data.html#aacb34844e94cab2e35fc9cb0178c2b47">IPrintData::SetTrappingMode</a>, using IPrintData::kTrappingNone, IPrintData::kTrappingBuiltIn, or IPrintData::kTrappingInRIP </td></tr><tr><td>Flip </td><td><a class="el" href="class_i_print_data.html#af8cb50f7e35e686401843e687f787c1f">IPrintData::SetFlipMode</a>, using IPrintData::kFlipOff, IPrintData::kFlipHorizontal, IPrintData::kFlipVertical, or IPrintData::kFlipBoth </td></tr><tr><td>Negative </td><td><a class="el" href="class_i_print_data.html#a08a5b63c6ad1b9e62917a30f14af7928">IPrintData::SetNegative</a></td></tr><tr><td>Screening </td><td>When the <a class="el" href="class_i_print_data.html#a640cac0c2a4b271337dd6da3962dffa4">IPrintData::GetOutputMode</a> is a separation mode, <a class="el" href="class_i_print_data.html#a253881c6fd19e46cb80c0f86c9ac331f">IPrintData::SetSeparationScreenText</a>; when the <a class="el" href="class_i_print_data.html#a640cac0c2a4b271337dd6da3962dffa4">IPrintData::GetOutputMode</a> is a composite mode, <a class="el" href="class_i_print_data.html#a6699e0cae7327086b4c201f95346de69">IPrintData::SetCompositeScreenText</a>. </td></tr><tr><td>Frequency </td><td>If output mode is kCompositeGray and the composite-screen mode is string key &quot;kCustom&quot; (translates differently in each locale), <a class="el" href="class_i_print_data.html#a6538a1cdb765c618cfa89ab3b7cee266">IPrintData::SetCompositeFrequency</a>. </td></tr><tr><td>Angle </td><td>If output mode is kCompositeGray and the composite-screen mode is string key &quot;kCustom&quot; (translates differently in each locale), <a class="el" href="class_i_print_data.html#ae9c7bd3428f43d23f800644a04ca827d">IPrintData::SetCompositeAngle</a>. </td></tr><tr><td>Simulate Overprint </td><td><a class="el" href="class_i_print_data.html#ac9a0681a1483cf2af782905d52a814e9">IPrintData::SetSpotOverPrint</a>, using IPrintData::kSimulatePress (if the radio button is checked) or IPrintData::kLegacy (if the radio button is not checked). </td></tr><tr><td>Inks </td><td>Stored temporarily in IPrintDialogData::SetNthInkScreening. When the user clicks the OK button in the Ind Manager dialog box, the <a class="el" href="classk_change_ink_cmd_boss.html">kChangeInkCmdBoss</a> command is processed for each ink listed. </td></tr></table><p><b>Print dialog box: Graphics panel</b><div class="image"><img alt="print-graphics.gif" src="print-graphics.gif" /></div><p>The user-interface elements on the Graphics selectable panel are mapped to the API methods listed in the following table.<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>Images: Send Data </td><td><a class="el" href="class_i_print_data.html#a035bed24eb01e6f6cba0343e18c66d0c">IPrintData::SetImageData</a>, using IPrintData::kImageDataAll, IPrintData::kImageDataOptimized, IPrintData::kImageDataLoRez, or IPrintData::kImageDataProofPrint </td></tr><tr><td>Fonts: Download </td><td><a class="el" href="class_i_print_data.html#a965d8c73a74fcd1f2fbaaf1e69583571">IPrintData::SetFontDownload</a>, usingIPrintData::kFontDownloadNone, IPrintData::kFontDownloadComplete, IPrintData::kFontDownloadSubset, or IPrintData::kFontDownloadSubsetLrg </td></tr><tr><td>Download PPD Fonts </td><td><a class="el" href="class_i_print_data.html#ace7ad091962b676b2bfce14281dfc630">IPrintData::SetDownloadPPDFonts</a></td></tr><tr><td>PostScript </td><td><a class="el" href="class_i_print_data.html#ae64c1c45573a11c478338c1400e873bf">IPrintData::SetPSLangLevel</a>, using IPrintData::kPSLangLevel_2 or IPrintData::kPSLangLevel_3 </td></tr><tr><td>Data Form at </td><td><a class="el" href="class_i_print_data.html#ac6e938244bf55c2951c7a4e4f50e7a8c">IPrintData::SetImageDataFormat</a>, using IPrintData::kImageDataBinary or IPrintData::kImageDataASCII </td></tr></table><p><b>Print dialog box: Color Management panel</b><div class="image"><img alt="print-colormanagement.gif" src="print-colormanagement.gif" /></div><p>The user-interface elements on the Color Management selectable panel are mapped to the API methods listed in the following table.<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>Print: Document </td><td>IPrintData::SetSourceSpace(IPrintData::kDocumentSourceSpace) </td></tr><tr><td>Print: Proof </td><td>IPrintData::SetSourceSpace(IPrintData::kProofSourceSpace) </td></tr><tr><td>Color Handling </td><td><a class="el" href="class_i_print_data.html#a02029220a4a429ad281a606aedb231c6">IPrintData::SetProfileType</a>, using IPrintData::kUseDocumentProfile, IPrintData::kUsePostScriptCMS, or IPrintData::kUseNoCMS </td></tr><tr><td>Printer Profile </td><td><a class="el" href="class_i_print_data.html#a02029220a4a429ad281a606aedb231c6">IPrintData::SetProfileType</a>, using IPrintData::kUseDocumentProfile or IPrintData::kUseWorkingProfile. If this is not one of the predefined profiles, use IPrintData::kUseSpecificProfile and then call <a class="el" href="class_i_print_data.html#a9cb41e16cabdec4e6e2652bab89132e6">IPrintData::SetProfileName</a>, specifying the name of the profile as displayed in the drop-down list. </td></tr><tr><td>Preserve CMYK Colors </td><td><a class="el" href="class_i_print_data.html#a5ebbf6bc18aba5ac49d32f587e105c06">IPrintData::SetPreserveColorNumbers</a></td></tr><tr><td>Simulate Paper Color </td><td><a class="el" href="class_i_print_data.html#a42833413289c05ee579610c3c3a4b5d3">IPrintData::SetIntent</a>, using IPrintData::kRelativeColorimetric (if the radio button is unselected) or IPrintData::kAbsoluteColorimetric (if the radio button is selected). </td></tr></table><p><b>Print dialog box: Advanced panel</b><div class="image"><img alt="plugin-programming-guide-vol2-25.gif" src="plugin-programming-guide-vol2-25.gif" /></div><p>The user-interface elements on the Advanced selectable panel are mapped to the API methods listed in the following table.<table class="doxtable"><tr><th>User-interface element </th><th>API method </th></tr><tr><td>OPI Image Replacement </td><td><a class="el" href="class_i_print_data.html#af5e8f7e9b2eaa4fbed1810c686fdf839">IPrintData::SetOPIReplacement</a></td></tr><tr><td>Omit for OPI: EPS </td><td><a class="el" href="class_i_print_data.html#abd09221910de7806dff36ad940a97f28">IPrintData::SetOmitEPS</a></td></tr><tr><td>Omit for OPI: PDF </td><td><a class="el" href="class_i_print_data.html#a00f9c5d500af21e11e63cd59541a91b6">IPrintData::SetOmitPDF</a></td></tr><tr><td>Omit for OPI: Images </td><td><a class="el" href="class_i_print_data.html#ac044ed1d9d45addf1d1c74e8c1388af5">IPrintData::SetOmitImages</a></td></tr><tr><td>Transparency Flattener: Preset </td><td><a class="el" href="class_i_print_data.html#aa103d276574781369ce16002bbef3c93">IPrintData::SetFlattenerStyleName</a></td></tr><tr><td>Transparency Flattener: Ignore Spread Overrides </td><td><a class="el" href="class_i_print_data.html#abd716a7442f414f0cf69ace3598c655c">IPrintData::SetIgnoreSpreadOverrides</a></td></tr></table><p><b>Print dialog box: Summary panel</b><div class="image"><img alt="print-summary.gif" src="print-summary.gif" /></div><p>When you click the Save Summary button, the Save File dialog box opens, asking for the path of a text file to which to save the summary. If you call <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a882c9e9cae25dca753cc8f675b5dad0d">IPrStStyleListMgr::GetNthStyleDescription</a> for a selected printer style, you get the same text as shown in the Summary multi-line text widget.<h3><a class="anchor" id="id_print_presets_dialog_box"></a> Print Presets dialog box</h3><p>The main Print Presets dialog box is opened when the user chooses File &gt; Print Presets &gt; Define.<p>In the main Print Presets dialog box, the user can see the currently defined print presets and a text summary of the currently selected preset. The main dialog box also has buttons for creating a new print preset (New), editing an existing print preset (Edit), deleting the selected print preset (Delete), loading from a print presets file (Load), and saving the print presets to a file (Save).<p>When the user clicks the New or Edit button, a selectable dialog box similar to the Print dialog box opens. The design of the Print Presets selectable dialog box is mostly the same as the Print dialog box, with a few minor differences:<ul><li>The title of the dialog box differs based on what the end user is doing.<li>The thumbnail image on the bottom-left corner of the dialog box is shown only in the Print dialog box and is disabled in the Print Presets dialog box.<li>The Print dialog box has a Save Preset button, which allows the user to save the current print settings as a print-preset style in the workspace. The Print Presets dialog box does not have that button, since the Print Presets dialog box is where you edit the print-preset style.</ul><h3><a class="anchor" id="id_extending_the_print_dialog_box_or_the_print_presets_selectable_dialog_box"></a> Extending the Print dialog box or the Print Presets selectable dialog box</h3><p>The Print dialog box and the Print Presets selectable dialog boxes are extensible by third-party plug-ins by means of custom, selectable, dialog panel. By implementing one selectable dialog panel, you can add your own panel into both the Print dialog box and the Print Presets selectable dialog box. For a discussion on SDK sample plug-ins that implement selectable dialog panels, see &quot;Adding your own panel to the Print and Print Presets dialog boxes&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a>.<h2><a class="anchor" id="id_printing_extension_patterns"></a> Printing extension patterns</h2><h3><a class="anchor" id="id_print_setup_provider"></a> Print-setup provider</h3><p>A plug-in can register a print-setup service boss by providing an <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> implementation that supports the kPrintSetupService service ID. The service is called at various points during the print-action sequence (see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_the_print_action_sequence">The print action sequence</a>). The implementation for <a class="el" href="class_i_print_setup_provider.html">IPrintSetupProvider</a> provides methods to set up or change print parameters before and during the printing process. See the following table for implementation details.<table class="doxtable"><tr><th></th><th></th></tr><tr><td>Purpose</td><td>Participate in various phases in the print process. </td></tr><tr><td>ServiceID</td><td>kPrintSetupService </td></tr><tr><td>Required companion interface</td><td><a class="el" href="class_i_print_setup_provider.html">IPrintSetupProvider</a></td></tr><tr><td>Boss class</td><td>IID_IK2SERVICEPROVIDER with implementation ID kPrintSetupServiceImpl (see <a class="el" href="_print_i_d_8h_source.html">PrintID.h</a>) and IID_IPRINTSETUPPROVIDER with your implementation ID </td></tr><tr><td>When called</td><td>Methods of <a class="el" href="class_i_print_setup_provider.html">IPrintSetupProvider</a> are called at various phases of the print action command. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_the_print_action_sequence">The print action sequence</a>. </td></tr><tr><td>How called</td><td>All providers of this ServiceID get called. </td></tr><tr><td>Sample code</td><td>See &quot;Participating in the stages of the print-action sequence&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a>. </td></tr></table><h3><a class="anchor" id="id_print_insert_postscript_proc_provider"></a> Print-insert-PostScript proc provider</h3><p>A plug-in can inject PostScript statements into the print-output stream by registering an <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> implementation supporting the kPrintInsertPSProcService serviceID and providing an implementation for <a class="el" href="class_i_print_insert_p_s_proc_provider.html">IPrintInsertPSProcProvider</a>. See the following table for implementation details.<p>Implementation recipe for a print-insert-PostScript proc provider:<table class="doxtable"><tr><th></th><th></th></tr><tr><td>Purpose</td><td>Inject PostScript comments at predetermined phases of the printing process. </td></tr><tr><td>ServiceID</td><td>kPrintInsertPSProcService </td></tr><tr><td>Required companion interface</td><td><a class="el" href="class_i_print_insert_p_s_proc_provider.html">IPrintInsertPSProcProvider</a></td></tr><tr><td>Boss class</td><td>IID_IK2SERVICEPROVIDER with implementation ID kInsertPSProcServiceImpl (see <a class="el" href="_print_i_d_8h_source.html">PrintID.h</a>) and </td></tr><tr><td>IID_IPRINTINSERTPSPROCPROVIDER with your implementation ID </td></tr><tr><td>When called</td><td>Methods of <a class="el" href="class_i_print_insert_p_s_proc_provider.html">IPrintInsertPSProcProvider</a> are called at various phases of the core print command. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_the_print_action_sequence">The print action sequence</a>. The Setup method is called first, to give the provider a chance to store print settings. Then the GetInsertPSProcName method is called, so the provider can return a name. (The following steps occur only if your GetInsertPSProcName implementation returns a nonempty string.) The GetClientData method gets called to obtain the provider&#39;s custom client data (if any), then the PrintInsertPSProc method is called at various phases of the printing process. (For a list of phases, see the enum <a class="el" href="class_i_print_insert_p_s_proc_provider.html#a1760b7c7c2214de9a83d58c97ae09a6b">IPrintInsertPSProcProvider::DocumentSection</a>.) </td></tr><tr><td>How called</td><td>All providers of this ServiceID get called. </td></tr><tr><td>Sample code</td><td>See &quot;Injecting PostScript comments or extra data into the print stream during the print action sequence&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a>. </td></tr></table><h3><a class="anchor" id="id_print_data_helper_strategy_provider"></a> Print-data helper-strategy provider</h3><p>A plug-in can control whether to override the current locked state and relevant state of print data items in the Print dialog box by registering an implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> supporting the kPrintDataHelperStrategyService serviceID. The <a class="el" href="class_i_print_data_helper_strategy.html">IPrintDataHelperStrategy</a> interface provides two methods: IsLocked and IsRelevant.<p>IsLocked allows a plug-in to lock the Print and Print Presets dialog-box user-interface elements. Although an item&#39;s locked state can be partially controlled using this method, the application print components are still free to change an item&#39;s value as necessary to maintain the print data in a consistent and valid context.<p>IsRelevant allows a plug-in to disable specific Print and Print Presets dialog-box user-interface elements. Although an item&#39;s relevant state can be partially controlled using this interface, the application print components are still free to change an item&#39;s value as necessary to maintain the print data in a consistent and valid context.<p>The most restrictive interface takes precedence. After an ID is set to be locked (the most restrictive setting), other implementations are not called. After an ID&#39;s relevance is set to kFalse (the most restrictive setting), other implementations are not called.<p>See the following table for implementation details.<p>Implementation recipe for a print-data helper-strategy provider:<table class="doxtable"><tr><th></th><th></th></tr><tr><td>Purpose</td><td>Influence the Print and Print Presets dialog boxes through the ability to suppress and lock print user-interface elements. </td></tr><tr><td>ServiceID</td><td>kPrintDataHelperStrategyService </td></tr><tr><td>Required companion interface</td><td><a class="el" href="class_i_print_data_helper_strategy.html">IPrintDataHelperStrategy</a></td></tr><tr><td>Boss class</td><td>IID_IK2SERVICEPROVIDER with implementation ID kDataHelperStrategyServiceImpl(see <a class="el" href="_print_i_d_8h_source.html">PrintID.h</a>) and IID_IPRINTDATAHELPERSTRATEGY with your implementation ID </td></tr><tr><td>When called</td><td>Whenever <a class="el" href="class_i_print_data.html#a8f153fd25d459f686008c7e18c24632e">IPrintData::IsLocked</a> or <a class="el" href="class_i_print_data.html#a3ba1762a2d3fd562c5a08170e1a0ef29">IPrintData::IsRelevant</a> is called. Generally this happens when the Print or Print Presets dialog box is being prepared for display. </td></tr><tr><td>How called</td><td>All providers of this ServiceID get called. </td></tr><tr><td>Related sample code</td><td>See &quot;Specifying which parts of the Print and Print Presets dialog boxes are relevant or locked&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a>. </td></tr></table><h3><a class="anchor" id="id_draw-event_handlers"></a> Draw-event handlers</h3><p>A plug-in can register a draw-event handler (<a class="el" href="class_i_drw_evt_handler.html">IDrwEvtHandler</a>) to participate in various draw events that happen during the printing process. For more details on draw-event handlers, including implementation details, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a>. For samples that implement this extension pattern for printing purposes, see &quot;Adding a custom watermark during the printing process&quot; and &quot;Injecting PostScript comments or extra data into the print stream during the print action sequence&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a>.<h2><a class="anchor" id="id_printing_solutions"></a> Printing solutions</h2><h3><a class="anchor" id="id_getting_started"></a> Getting started</h3><p><b>Printing a document</b><p>Execute (not process) one of the following commands:<ul><li><a class="el" href="classk_print_action_cmd_boss.html">kPrintActionCmdBoss</a>, to print a document in InDesign<li>kInCopyPrintActionCmdBoss, to print a document in InCopy</ul><p>The minimal settings required to print a document with <a class="el" href="classk_print_action_cmd_boss.html">kPrintActionCmdBoss</a> in InDesign are as follows:<ul><li>The document you want to print.<li>The range of pages in the document you want to print.<li>Print user-interface options.</ul><p>The print-action command is executed (not processed), because there is no undo capability provided. For a sample that uses either <a class="el" href="classk_print_action_cmd_boss.html">kPrintActionCmdBoss</a> or kInCopyPrintActionCmdBoss, see the SnpPrintDocument.cpp sample code snippet, in particular <a class="el" href="class_snp_print_document.html#abdba9af25e7bbbf066c861350a8db33c">SnpPrintDocument::DoPrintDocument</a>.<p><b>Printing a Book</b><p>Execute the <a class="el" href="classk_book_print_action_cmd_boss.html">kBookPrintActionCmdBoss</a> command.<h3><a class="anchor" id="id_working_with_print-preset_styles"></a> Working with print-preset styles</h3><p><b>Getting information about print-preset styles</b><p>Query for <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, then call the Get methods to get information about the print-preset styles that are registered. <a class="el" href="class_i_gen_stl_edt_list_mgr.html#ad69cc1e72c6c51d02c04f7b46e5a6fea">IPrStStyleListMgr::GetNumStyles</a> reports the number of print-preset styles registered. <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a9c85d829ac833141ca9b81256019d45f">IPrStStyleListMgr::GetNthStyleName</a> reports the name of the print-preset style at index n. <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a5b8448518ab4a8ce0ae81f6bf8654c7f">IPrStStyleListMgr::GetNthStyleRef</a> returns the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the print-preset style at index n. Using this <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, you can query <a class="el" href="class_i_print_data.html">IPrintData</a>, and get further information about the print-preset style. There are other useful methods on <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a>.<dl class="section note"><dt>Note<dd><a class="el" href="_i_pr_st_style_list_mgr_8h_source.html">IPrStStyleListMgr.h</a> does not declare any methods; however, it inherits <a class="el" href="class_i_gen_stl_edt_list_mgr.html">IGenStlEdtListMgr</a>. See <a class="el" href="_i_gen_stl_edt_list_mgr_8h_source.html">IGenStlEdtListMgr.h</a> for details.</dl><p>For more details, see the SnpManipulatePrintStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_print_styles.html#a6e413962a70fd420a5ace9036f8643de">SnpManipulatePrintStyles::InspectPrintStyle</a>.<p><b>Adding a print-preset style</b><p>Query for <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, then call <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a476a4201db0d43a1989f09edb3a6d39c">IPrStStyleListMgr::AddStyle</a>. When the new style is created, it is appended to the end of the list of print-preset styles.<p>For details, see the SnpManipulatePrintStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_print_styles.html#a4e52cdf20a88370f0791011f7b55b972">SnpManipulatePrintStyles::AddPrintStyle</a>.<p><b>Duplicating a print-preset style</b><p>Query for <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, then call <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a164c9aa72d58f7cde3fc62cb69681704">IPrStStyleListMgr::CopyNthStyle</a>. When the new style is created, it is appended to the end of the list of print-preset styles.<p><b>Modifying the name of a print-preset style</b><p>First, query for <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<p>Then, call <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a88efb2e8010e3f88fef871d5ba03f2ec">IPrStStyleListMgr::SetNthStyleName</a>. When you do this, however, the name of the print-preset style stored in <a class="el" href="class_i_print_data.html">IPrintData</a> is not updated, so you must query for <a class="el" href="class_i_print_data.html">IPrintData</a> and call <a class="el" href="class_i_print_data.html#af91eba05dc061a64e980d1514bfc6b2a">IPrintData::SetStyleName</a>, using the same name. For details, see the SnpManipulatePrintStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_print_styles.html#a840dcf94881197507c8467fb2f035a3e">SnpManipulatePrintStyles::ModifyPrintStyleName</a>.<p><b>Modifying the settings of a print-preset style</b><p>First, query for <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<p>Then, call <a class="el" href="class_i_gen_stl_edt_list_mgr.html#ad92188ceeae3407b4336b41b2098844a">IPrStStyleListMgr::EditNthStyle</a>, which invokes the Print Presets selectable dialog box. This procedure requires a user to use the dialog box to change settings. For details, see the SnpManipulatePrintStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_print_styles.html#a5da7c654fc8fb4366e959d526fe779ec">SnpManipulatePrintStyles::ModifyPrintStyle</a>.<p><b>Deleting a print-preset style</b><p>Query for <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, then call <a class="el" href="class_i_gen_stl_edt_list_mgr.html#a0ae0a471db539efb1fabf95573ef7fff">IPrStStyleListMgr::DeleteNthStyle</a>. For details, see the SnpManipulatePrintStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_print_styles.html#afa97371d8b487593db30fcd418dad1bf">SnpManipulatePrintStyles::DeletePrintStyle</a>.<p><b>Exporting a set of print-preset styles to a file</b><p>Process the <a class="el" href="classk_gen_stl_edt_export_styles_cmd_boss.html">kGenStlEdtExportStylesCmdBoss</a> command. In the <a class="el" href="class_i_gen_stl_edt_cmd_data.html">IGenStlEdtCmdData</a> data interface, call SetListMgrIID to set the type of style list to be the print style list, by specifying the IPrStStyleListMgr::kDefaultIID (IID_IPRSTSTYLELISTMGR), then call SetTargetFile to specify the full path of the file to save. Optionally, specify a set of style indices you want to export from <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. If you do not specify a set of style indices, all styles stored in <a class="el" href="class_i_pr_st_style_list_mgr.html">IPrStStyleListMgr</a> are exported.<p><b>Importing a set of print-preset styles from a file</b><p>Process the <a class="el" href="classk_gen_stl_edt_import_styles_cmd_boss.html">kGenStlEdtImportStylesCmdBoss</a> command. In the <a class="el" href="class_i_gen_stl_edt_cmd_data.html">IGenStlEdtCmdData</a> data interface, call SetListMgrIID to set the type of style list to be the print style list, by specifying the IPrStStyleListMgr::kDefaultIID (IID_IPRSTSTYLELISTMGR), then call SetTargetFile to specify the full path of the file to import.<p><b>Getting notified when a print-preset style is imported to/exported from a file</b><p>Implement a signal-responder extension pattern that responds one or more of the following signals:<ul><li>kBeforeExportStyleSignalResponderService<li>kAfterExportStyleSignalResponderService<li>kBeforeImportStyleSignalResponderService<li>kAfterImportStyleSignalResponderService</ul><p>These IDs are defined in <a class="el" href="_generic_settings_i_d_8h_source.html">GenericSettingsID.h</a>. In your implementation of <a class="el" href="class_i_responder.html#a2d44b72b022abc9d650749c5b5ce463e">IResponder::Respond</a>, you can query for the <a class="el" href="class_i_style_signal_data.html">IStyleSignalData</a> interface using <a class="el" href="class_i_p_m_unknown.html#aaa3b657383c4699900aaec5dc7348864">ISignalMgr::QueryInterface</a> (or <a class="el" href="class_interface_ptr.html">InterfacePtr</a>). <a class="el" href="class_i_style_signal_data.html">IStyleSignalData</a> gives you a reference to the file that is the target of the export or import operation.<p>Any preset style that is managed by the generic-settings framework and can be exported or imported-such as PDF-export styles and document-preset styles-can be monitored in the same way.<h3><a class="anchor" id="id_working_with_trap_styles"></a> Working with trap styles</h3><p><b>Getting information about trap styles</b><p>First, query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> on one of the following bosses:<ul><li><a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, for trap styles registered in the workspace (also used as document defaults when a new document is created)<li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, for trap styles registered in a document<li><a class="el" href="classk_book_boss.html">kBookBoss</a>, for trap styles registered in a book</ul><p>The utility interface <a class="el" href="class_i_trap_style_utils.html">ITrapStyleUtils</a> (on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>) has a QueryTrapStyleListMgr method to simplify this process. There are two overloaded methods:<ul><li>The one that takes IDocument* returns the <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> on <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> (that is, the workspace related to the document).<li>The one that takes a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> returns the <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> on the same boss as the <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, or the <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> if the UID in the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> is kInvalidUID.</ul><p>Next, call the Get methods to get various information about the trap styles that are registered. <a class="el" href="class_i_trap_style_list_mgr.html#a01e9cd3f028c29dcc4a8292b41f8389c">ITrapStyleListMgr::GetNumStyles</a> reports the number of trap styles registered. <a class="el" href="class_i_trap_style_list_mgr.html#a3ed66ee7b7c90b0e32e27be70f5d738d">ITrapStyleListMgr::GetNthStyleName</a> reports the name of the trap style at index n. <a class="el" href="class_i_trap_style_list_mgr.html#a7647340b7e373002dbab57f37b6caab3">ITrapStyleListMgr::GetNthStyleRef</a> returns the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the trap style at index n. Using this <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, you can query <a class="el" href="class_i_trap_style.html">ITrapStyle</a> and get further information about this trap style. There are other useful methods on <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>.<dl class="section note"><dt>Note<dd>For details, see the SnpManipulateTrapStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_trap_styles.html#a3010a435f6358994f980cc4837099c47">SnpManipulateTrapStyles::InspectTrapStyle</a>.</dl><p><b>Adding a trap style</b><p>Query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>, then call <a class="el" href="class_i_trap_style_list_mgr.html#a22663dd0ce30e7085cf2c8fb620652b9">ITrapStyleListMgr::AddStyle</a>. When the new style is created, it is appended to the end of the list of trap styles.<p>For details, see the SnpManipulateTrapStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_trap_styles.html#ae7956c0a1f326b0eda14dc5a9efd33e6">SnpManipulateTrapStyles::AddTrapStyle</a>.<p><b>Duplicating a trap style</b><p>Query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>, then call <a class="el" href="class_i_trap_style_list_mgr.html#a77d19d0169a464c1615fcc5a74489159">ITrapStyleListMgr::CopyNthStyle</a>. When the new style is created, it i appended to the end of the list of trap styles.<p><b>Modifying a trap style</b><p>Query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>, then call <a class="el" href="class_i_trap_style_list_mgr.html#a93982493da91be7bc7cab6eb116872f4">ITrapStyleListMgr::EditNthStyle</a>. You are required to pass in the trap-style data via the parameter list as <a class="el" href="class_i_trap_style.html">ITrapStyle</a>. You can create a nonpersistent instance of <a class="el" href="classk_trap_style_boss.html">kTrapStyleBoss</a> to store the settings.<p>For details, see the SnpManipulateTrapStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_trap_styles.html#a72e8cc3ee3f56d4d22c19c19d4bd0cc0">SnpManipulateTrapStyles::ModifyTrapStyle</a>.<p><b>Deleting a trap style</b><p>Query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>, then call <a class="el" href="class_i_trap_style_list_mgr.html#a10aa61370f9b193ea373670630b9d416">ITrapStyleListMgr::DeleteNthStyle</a>.<p>For details, see the SnpManipulateTrapStyles.cpp code snippet, in particular <a class="el" href="class_snp_manipulate_trap_styles.html#a7365f36a2f32e7b74d453de161bd7c71">SnpManipulateTrapStyles::DeleteTrapStyle</a>.<p><b>Exporting a set of trap styles to another trap-style list</b><p>First, create a command sequence, as the following procedure processes multiple commands. Next, query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>, then call <a class="el" href="class_i_trap_style_list_mgr.html#a3b23eae83c6fef8b86d1dcfe101157e3">ITrapStyleListMgr::ExportStyles</a>. The first parameter is a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for the destination trap style list (note the source trap style list is identified by this particular instance of <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>), and that <a class="el" href="class_u_i_d_ref.html">UIDRef</a> must refer to a boss that aggregates <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>. If you want to export the trap styles to a file, you can create a new database using <a class="el" href="class_d_b_utils.html#a5eefbd8b646d00f8589f93ea5ccfedfc">DBUtils::CreateDataBase</a> and <a class="el" href="class_i_data_base.html#a59cbc3a19ff7cbf8c8acff0d69803be9">IDataBase::New</a>, then put a new root UID by calling <a class="el" href="class_i_data_base.html#a7b9090fdc18c31c3e46310c2aa06be5a">IDataBase::NewUID</a>. The class for the new root should be <a class="el" href="classk_trap_style_export_root_boss.html">kTrapStyleExportRootBoss</a>. Create a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for this new root, and pass it into <a class="el" href="class_i_trap_style_list_mgr.html#a3b23eae83c6fef8b86d1dcfe101157e3">ITrapStyleListMgr::ExportStyles</a>. Once that completes, save the database by calling <a class="el" href="class_i_data_base.html#a104d99974fe66c911b91788918e0cee2">IDataBase::SaveAs</a>, and close the database by deleting the <a class="el" href="class_i_data_base.html">IDataBase</a> pointer.<p><b>Importing a set of trap styles from another trap-style list</b><p>First, create a command sequence, as the following procedure processes multiple commands. Next, query for <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>, then call <a class="el" href="class_i_trap_style_list_mgr.html#ab687465ff70d520e92940e1f44fdb641">ITrapStyleListMgr::ImportStyles</a>. The first parameter is a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for the source trap style list (note the destination trap style list is identified by this particular instance of <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>), and that <a class="el" href="class_u_i_d_ref.html">UIDRef</a> must refer to a boss that aggregates <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a>. If you want to import the trap styles from a file, you can open a database using <a class="el" href="class_d_b_utils.html#a5eefbd8b646d00f8589f93ea5ccfedfc">DBUtils::CreateDataBase</a> and <a class="el" href="class_i_data_base.html#a03040e64d432923e9f73ab016e80b33e">IDataBase::Open</a>, then get the root UID by calling <a class="el" href="class_i_data_base.html#a7fe2aa8e012510c2dfe26c8427ce5b5a">IDataBase::GetRootUID</a>. The class for the new root should be <a class="el" href="classk_trap_style_export_root_boss.html">kTrapStyleExportRootBoss</a>. Create a <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for this root, and pass it into <a class="el" href="class_i_trap_style_list_mgr.html#ab687465ff70d520e92940e1f44fdb641">ITrapStyleListMgr::ImportStyles</a>. Once that completes, close the database by deleting the <a class="el" href="class_i_data_base.html">IDataBase</a> pointer.<p><b>Determining which trap style is associated with a page on a document</b><p>Given a specific page (<a class="el" href="classk_page_boss.html">kPageBoss</a>) on a document (which you can query using <a class="el" href="class_i_page_list.html">IPageList</a> on <a class="el" href="classk_doc_boss.html">kDocBoss</a>), query for <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a> with the specific IID of IID_ITRAPSTYLEUIDDATA. Get the UID from <a class="el" href="class_i_persist_u_i_d_data.html">IPersistUIDData</a>. That UID refers to the trap style registered in <a class="el" href="class_i_trap_style_list_mgr.html">ITrapStyleListMgr</a> on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). To find out the name of this trap style, first call <a class="el" href="class_i_trap_style_list_mgr.html#a36b6ff380c46aae4a375377a9fdf5487">ITrapStyleListMgr::GetStyleIndexByUID</a> and then call <a class="el" href="class_i_trap_style_list_mgr.html#a3ed66ee7b7c90b0e32e27be70f5d738d">ITrapStyleListMgr::GetNthStyleName</a>.<p>Alternately, you can collect a list of pages that use a specific trap style. Call <a class="el" href="class_i_trap_style_utils.html#a3ef4b864e1937e7f16148d56e6c3cc1f">ITrapStyleUtils::GetDocumentTrapStylePageList</a>. For details, see the SnpManipulateTrapStyles.cpp code snippet, specifically <a class="el" href="class_snp_manipulate_trap_styles.html#a3010a435f6358994f980cc4837099c47">SnpManipulateTrapStyles::InspectTrapStyle</a>.<p><b>Associating a trap style with a page on a document</b><p>Create a <a class="el" href="class_u_i_d_list.html">UIDList</a> of pages (<a class="el" href="classk_page_boss.html">kPageBoss</a>) to which you want to associate a trap style, and the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the trap style. Then call <a class="el" href="class_i_trap_style_utils.html#a4341bca4b93cb0838823b2e43c82741d">ITrapStyleUtils::AssignStyleToPageList</a>. For details, see the SnpManipulateTrapStyles.cpp code snippet, specifically <a class="el" href="class_snp_manipulate_trap_styles.html#a822627b9e876e6c4614ab08deea0fe79">SnpManipulateTrapStyles::AssignTrapStyleToPages</a>.<h3><a class="anchor" id="id_participating_in_the_print_process"></a> Participating in the print process</h3><p><b>Participating in the stages of the print-action sequence</b><p>There are various ways to participate in the print-action sequence. The main way is to implement a print-setup provider (see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_setup_provider">Print-setup provider</a>). By implementing <a class="el" href="class_i_print_setup_provider.html">IPrintSetupProvider</a>, your plug-in can be notified at the stages of the print-action sequence described in &quot;The print action sequence&quot;.<p>Other ways to participate in the print-action sequence are noted in the following list. Some of these require extra hook-ups from within a print setup-provider implementation.<ul><li>Implement a print-insert PostScript proc provider to inject PostScript statements into the print-output stream. (See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_insert_postscript_proc_provider">Print-insert-PostScript proc provider</a> and &quot;Injecting PostScript comments or extra data into the print stream during the print action sequence&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a>).<li>Implement a print-data-helper strategy provider to influence the display of the Print and Print Presets dialog boxes. (See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_data_helper_strategy_provider">Print-data helper-strategy provider</a> and &quot;Specifying which parts of the Print and Print Presets dialog boxes are relevant or locked&quot;.)<li>Implement a draw-event handler that handles print-related drawing events. (See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_draw-event_handlers">Draw-event handlers</a>, &quot;Adding a custom watermark during the printing process&quot;, &quot;Specifying which page items should be printed&quot; on page 81, and &quot;Injecting PostScript comments or extra data into the print stream during the print action sequence&quot;).<li>Implement a custom write stream so the print-action sequence writes to it. The custom stream must be specified from one of the methods in your print-setup provider. (See Writing printing data to a custom stream.)</ul><p>The following sample plug-ins contain an implementation of a print-setup provider:<ul><li>PrintMemoryStream prints document content to a custom memory stream.<li>PrintSelection adds a flag to the document to print only selected page items.</ul><p>For details, refer to the API Reference for each sample plug-in.<p><b>Specifying which page items should be printed</b><p>You can implement a print-setup provider (see &quot;Participating in the stages of the print-action sequence&quot; in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_participating_in_the_print_process">Participating in the print process</a> Participating in the print process) and a custom draw-event handler to specify which pages items should be printed. From the print-setup provider (in any method that gets called before the core print command is executed, the last chance being AfterPrintGatherCmd), you register the custom draw-event handler that handles the print event only when it encounters document content you want to print. When the printing is done, you de-register the custom draw-event handler in your print-setup provider&#39;s EndPrint implementation.<p>The PrintSelection sample plug-in shows how this is done. Here are the highlights of what the PrintSelection plug-in does:<ul><li>In <a class="el" href="class_prn_sel_print_setup_provider.html#afb82d454da80b0ec3a42100b5a3915fa">PrnSelPrintSetupProvider::AfterPrintUI</a>, the currently selected page items are gathered and the custom draw-event handler is registered for the draw event message kDrawShapeMessage.<li>In <a class="el" href="class_prn_sel_print_setup_provider.html#a0885def9ae44b76da484c9ce15a4df49">PrnSelPrintSetupProvider::BeforePrintGatherCmd</a>, the set of pages to output is modified based on which pages contain the selected page items.<li>The PrnSelDrawHandler::HandleEvent determines whether the current printable item should be printed. This draw event handler does not do any drawing; the actual drawing of the printable item is delegated to other draw-event handlers.<li>In <a class="el" href="class_prn_sel_print_setup_provider.html#ac78f20031ed2fe6ec2477c38f1b10b1c">PrnSelPrintSetupProvider::EndPrint</a>, the custom draw-event handler is unregistered.</ul><p>For details, refer to the API Reference for the PrintSelection plug-in.<p><b>Specifying which layer(s) of a document should be printed</b><p>In the Setup panel of the Print dialog box, there is a setting called &quot;Print Layers,&quot; which is a drop-down list that allows the user to choose printing with visible and printable layers, visible layers, or all layers. This option can be get/set through the <a class="el" href="class_i_print_data.html#a2c9d48422a0e10e6e7cf9a757b34f928">IPrintData::GetPrintLayers</a>/SetPrintLayers methods. Each layer&#39;s visibility and printability, however, are managed by layer options as described in the &quot;Layer Options&quot; section of <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>.<p>To set the visibility of a layer, use the <a class="el" href="classk_show_layer_cmd_boss.html">kShowLayerCmdBoss</a> command. To set the printability of a layer, use the <a class="el" href="classk_print_layer_cmd_boss.html">kPrintLayerCmdBoss</a> command. The SnpPrintDocument.cpp SDK snippet shows how to use a <a class="el" href="classk_print_layer_cmd_boss.html">kPrintLayerCmdBoss</a>. Before processing a <a class="el" href="classk_print_layer_cmd_boss.html">kPrintLayerCmdBoss</a>, make sure the printability of the layer is different from the new state you are going to set. If the new printability state is the same as the old one, <a class="el" href="classk_print_layer_cmd_boss.html">kPrintLayerCmdBoss</a> asserts, although the assert is benign.<p><b>Adding a custom watermark during the printing process</b><p>You can implement a custom draw-event handler that draws the watermark on a page or a page item. This is done in the BasicDrwEvtHandler sample plug-in, a canonical example of a draw-event handler. For details, refer to the API Reference for the BasicDrwEvtHandler plug-in.<p>Another way to add custom watermarks to page items is to implement a page-item adornment that draws when the draw flag has the <a class="el" href="class_i_shape.html#aa9e07a92fd22dc760e7f04a582c16683a9cbfa5483e347957a83af509d036e39a">IShape::kPrinting</a> bit set. While the FrameLabel sample plug-in does not support printing (that is, if flags contains <a class="el" href="class_i_shape.html#aa9e07a92fd22dc760e7f04a582c16683a9cbfa5483e347957a83af509d036e39a">IShape::kPrinting</a>, the Draw method breaks out), you can use the FrameLabel sample as a basis for implementing custom watermarks and extra persistent data on page items. For details, refer to the API Reference for the FrameLabel plug-in.<p><b>Injecting PostScript comments or extra data into the print stream during the print action sequence</b><p>You can implement a print-insert PostScript proc provider (see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_insert_postscript_proc_provider">Print-insert-PostScript proc provider</a>) to inject PostScript comments during predetermined phases of the print-output process as driven by the core print command. The PrintMemoryStream sample plug-in contains an implementation of a print-insert PostScript proc provider. The print-insert PostScript proc provider implementation in this sample is a canonical example that demonstrates when each method in <a class="el" href="class_i_print_insert_p_s_proc_provider.html">IPrintInsertPSProcProvider</a> gets called by writing a trace message. This plug-in also demonstrates how to manage custom print settings throughout the print-action sequence.<p>There are other ways to inject PostScript comments into the print stream during the print action sequence:<ul><li>Implement a custom draw-event handler that calls the IGraphicsPort::AddComment method. For a sample of a draw-event handler that responds to the kDrawShapeMessage for printing, see PrnSelDrawHandler::HandleEvent in the PrintSelection sample plug-in. To obtain <a class="el" href="class_i_graphics_port.html">IGraphicsPort</a>, you can first get a pointer to the <a class="el" href="class_graphics_data.html">GraphicsData</a> from <a class="el" href="class_draw_event_data.html#a64af674da1604a6e9e8fb43085988c31">DrawEventData::gd</a>, then call <a class="el" href="class_graphics_data.html#ae4a7ceb753817705ac22822752979a39">GraphicsData::GetGraphicsPort</a>.<li>Add custom registration marks on each page, if you are using the Japanese feature set of InDesign or InCopy. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_japanese_page_mark_files">Japanese page-mark files</a>.</ul><p><b>Adding custom print settings so they are managed like other print settings</b><p>Any plug-in that registers for kPrintCopyCustomDataService gets a chance to manage its own print data during the print process. Note the service provider is called after the application&#39;s CopyData is done. You should provide the implementation for <a class="el" href="class_i_print_copy_custom_data_provider.html">IPrintCopyCustomDataProvider</a> and aggregate it on the service-provider boss that registered as kPrintCopyCustomDataService. Then your <a class="el" href="class_i_print_copy_custom_data_provider.html">IPrintCopyCustomDataProvider</a> will be called whenever <a class="el" href="class_i_print_data.html#a8d248ee46eb3bcd33e42473c4a4afa89">IPrintData::CopyData</a> is called.<p><b>Adding your own panel to the Print and Print Presets dialog boxes</b><p>You can implement a panel that adds itself to the dialog box identified by kPrintSelectableDialogService. The panel should be 400 pixels wide and 345 pixels high. The ODFRez widget type should inherit from PrimaryResourcePanelWidget, and the boss class that contains the necessary implementations (see below) should inherit from <a class="el" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a>. The required implementations in this boss class are as follows:<ul><li><a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> (IID_IK2SERVICEPROVIDER), to register the ServiceID values specified in the <a class="el" href="class_i_panel_creator.html#a9ec1bde32aac743b5bf74e56fa00ae26">IPanelCreator::GetServiceIDs</a> method. You do not need to implement this yourself; you can use the implementation ID provided by the application: kDialogPanelServiceImpl (defined in <a class="el" href="widgetid_8h_source.html">WidgetID.h</a>).<li><a class="el" href="class_i_panel_creator.html">IPanelCreator</a> (IID_IPANELCREATOR), to specify the resource IDs in your ODFRez resource file (.fr) that declares the selectable dialog ServiceID and the panel resource IDs provided by the plug-in. Using this implementation, the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> in this boss (kDialogPanelServiceImpl) can get the necessary data to register the panel into the appropriate selectable dialog box. The implementation of this interface must inherit from <a class="el" href="class_c_panel_creator.html">CPanelCreator</a>.<li><a class="el" href="class_i_dialog_controller.html">IDialogController</a> (IID_IDIALOGCONTROLLER), to initialize the panel, validate the settings on the panel when the OK button is clicked, apply the settings on the panel when the OK button is clicked, and perform any clean-up if the user cancels the dialog. The implementation of this interface may inherit from <a class="el" href="class_c_dialog_controller.html">CDialogController</a>.<li><a class="el" href="class_i_observer.html">IObserver</a> (IID_IOBSERVER), to handle user-interface actions for widgets on the panel, as well as widgets on the parent selectable dialog. (To get the widget IDs of the widgets on the parent selectable dialog box, choose QA &gt; Panel Edit Mode in the debug build of the application.) The implementation of this interface must inherit from <a class="el" href="class_abstract_dialog_observer.html">AbstractDialogObserver</a> (as opposed to <a class="el" href="class_c_selectable_dialog_observer.html">CSelectableDialogObserver</a>, which is used in the BasicSelectableDialog sample plug-in). Refer to the API Reference for <a class="el" href="class_abstract_dialog_observer.html">AbstractDialogObserver</a>.</ul><p>In addition to the panel user-interface definition and the supporting boss class, you must include the following resources:<ul><li>IDList - Specifies the selectable-dialog service ID, which in this case is kPrintSelectableDialogService.<li>IDListPair - Specifies the selectable-dialog service ID (again, kPrintSelectableDialogService), the resource ID of the panel you want to add to the selectable dialog box, and the PluginID that owns the panel. You can specify multiple panels in this resource.</ul><p>Both these resources should have the resource ID you specified in your <a class="el" href="class_i_panel_creator.html#aaa632e74d5597f2fbee4d72f6e0c7d26">IPanelCreator::GetPanelRsrcID</a> implementation. For example, if the resource ID you specify in <a class="el" href="class_i_panel_creator.html#aaa632e74d5597f2fbee4d72f6e0c7d26">IPanelCreator::GetPanelRsrcID</a> is kSDKDefIDListPairResourceID, the resource ID of the panel is kSDKDefPanelResourceID, and the ID of the plug-in that provides this panel is kPrtHokUIPluginID, the resources would be written like the following example.<p>An IDList and IDListPair to support the kPrintSelectableDialogService: <div class="fragment"><div class="line">resource IDList (kSDKDefIDListPairResourceID){</div><div class="line"> {</div><div class="line"> kPrintSelectableDialogService,</div><div class="line"> },</div><div class="line">};</div><div class="line">resource IDListPair (kSDKDefIDListPairResourceID){</div><div class="line"> {</div><div class="line"> kPrintSelectableDialogService, kSDKDefPanelResourceID, kPrtHokUIPluginID,</div><div class="line"> },</div><div class="line">};</div></div><p>To find out whether the panel is being opened from the Print or Print Presets dialog box, you can query the <a class="el" href="class_i_print_dialog_data.html">IPrintDialogData</a> interface from the parent selectable dialog (by using the help of <a class="el" href="class_i_widget_parent.html">IWidgetParent</a>), and call IPrintDialogData::GetFlags. See the following example.<p>Getting <a class="el" href="class_i_print_dialog_data.html">IPrintDialogData</a> flags from a print-dialog selectable-panel implementation: <div class="fragment"><div class="line"><span class="comment">// &#39;this&#39; maybe a dialog controller or observer</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWidgetParent&gt;</a> widgetParent(<span class="keyword">this</span>, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPrintDialogData&gt;</a> printDialogData ((<a class="code" href="class_i_print_dialog_data.html">IPrintDialogData</a>*)widgetParent-&gt;QueryParentFor(IID_IPRINTDIALOGDATA));</div><div class="line">printFlags = printDialogData-&gt;GetFlags();</div></div><p>If the returned value has the IPrintDialogData::kWorkingOnStyle bit set (test by doing a logical AND on the value with IPrintDialogData::kWorkingOnStyle), the panel is in the Print Presets dialog box.<p>A canonical implementation of a selectable dialog box (along with children panels) is provided in the BasicSelectableDialog sample plug-in. You can use BasicSelectableDialog to understand the interactions between the parent selectable dialog box and its child panels. For more details, refer to the API Reference associated with the BasicSelectableDialog sample plug-in.<p><b>Specifying which parts of the Print and Print Presets dialog boxes are relevant or locked</b><p>You can implement a print-data helper strategy provider (see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_data_helper_strategy_provider">Print-data helper-strategy provider</a>). Print-data helper strategy provider also are called when the Print or Print Presets dialog box gets its summary text. (That is, if a setting is not relevant, it is not included in the summary text.) For a sample implementation of <a class="el" href="class_i_print_data_helper_strategy.html">IPrintDataHelperStrategy</a>, see the PrintMemoryStream sample plug-in.<p><b>Writing printing data to a custom stream</b><p>You can write a class that implements <a class="el" href="class_i_p_m_stream.html">IPMStream</a> (and inherits <a class="el" href="class_c_stream_write.html">CStreamWrite</a>), along with a class that inherits <a class="el" href="class_i_xfer_bytes.html">IXferBytes</a>, to copy the data to whatever your stream targets. Your stream may target things like a file, a memory buffer, or even a database. This custom stream must be reported to the print-action sequence by calling <a class="el" href="class_i_output_pages.html#a0ea94c33ec490813784c8d4edfec664c">IOutputPages::SetOutputStream</a>. You can do this from one of the methods in your print-setup provider (see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_setup_provider">Print-setup provider</a> and &quot;Participating in the stages of the print-action sequence&quot;), like <a class="el" href="class_i_print_setup_provider.html#ad597542d87f496a3f92dc1d25e7b1b64">IPrintSetupProvider::BeforePrintGatherCmd</a>. For a sample implementation, see the PrintMemoryStream sample plug-in.<h2><a class="anchor" id="id_bosses_that_aggregate_iprintdata"></a> Bosses that aggregate IPrintData</h2><ul><li><a class="el" href="classk_book_boss.html">kBookBoss</a> stores the Custom print settings for a book.<li>kBookPrintDataBoss stores the print settings when printing a book with the print commands.<li><a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a> stores the Custom print settings for a document.<li><a class="el" href="classk_in_copy_temp_print_data_boss.html">kInCopyTempPrintDataBoss</a> stores the print settings for temporary use only (InCopy only).<li><a class="el" href="classk_print_data_boss.html">kPrintDataBoss</a> stores the print settings when printing a document with the print commands. This is the most common boss class for storing print settings during the print process.<li><a class="el" href="classk_print_data_only_boss.html">kPrintDataOnlyBoss</a> stores the print settings for temporary use only.<li><a class="el" href="classk_pr_st_style_boss.html">kPrStStyleBoss</a> stores the print settings for a particular style in the list of defined print preset styles. (See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_print_preset_styles">Print preset styles</a>.)<li>kStylePrintDataBoss stores the print settings for temporary use when generating the human-readable text summary of a print-preset style. This text is displayed in the Print Presets dialog box.</ul><p>For details on these bosses, such as other aggregated interfaces or boss hierarchy, refer to the API Reference.<h2><a class="anchor" id="id_print_action_and_supporting_commands"></a> Print-action and supporting commands</h2><p>The following table lists the main command bosses used in the print process.<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a> boss </th><th>Description </th></tr><tr><td><a class="el" href="classk_book_print_action_cmd_boss.html">kBookPrintActionCmdBoss</a></td><td>Top-level print-action command for printing a book. For most clients, this is the command to execute to print a book in InDesign. It processes the following supporting commands: kPrintDialogCmdBoss, <a class="el" href="classk_book_save_print_data_cmd_boss.html">kBookSavePrintDataCmdBoss</a>, kPrintGatherDataCmdBoss, and kNewPrintCmdBoss. </td></tr><tr><td><a class="el" href="classk_book_save_print_data_cmd_boss.html">kBookSavePrintDataCmdBoss</a></td><td>Saves the print data into a book. </td></tr><tr><td><a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td><td>Creates a galley window view to print. </td></tr><tr><td>kInCopyNewPrintCmdBoss </td><td>Performs the actual output of a document in InCopy. </td></tr><tr><td>kInCopyPrintActionCmdBoss </td><td>Top-level print-action command for printing in InCopy. For most clients, this is the command to execute to print a document in InCopy. It processes the following supporting commands: <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a>, <a class="el" href="classk_in_copy_print_dialog_cmd_boss.html">kInCopyPrintDialogCmdBoss</a>, kInCopyNewPrintCmdBoss, and kPrintGatherDataCmdBoss. </td></tr><tr><td><a class="el" href="classk_in_copy_print_dialog_cmd_boss.html">kInCopyPrintDialogCmdBoss</a></td><td>Displays the print dialog box in InCopy. </td></tr><tr><td>kNewPrintCmdBoss </td><td>Performs the actual output of a document or a book to the output device in InDesign. </td></tr><tr><td><a class="el" href="classk_print_action_cmd_boss.html">kPrintActionCmdBoss</a></td><td>Top-level print-action command for printing a document. For most clients, this is the command to execute to print a document in InDesign. It processes the following supporting commands: kPrintDialogCmdBoss, <a class="el" href="classk_print_save_print_data_cmd_boss.html">kPrintSavePrintDataCmdBoss</a>, kPrintGatherDataCmdBoss, and kNewPrintCmdBoss. </td></tr><tr><td>kPrintDialogCmdBoss </td><td>Displays the print dialog box in InDesign. </td></tr><tr><td>kPrintGatherDataCmdBoss </td><td>Gathers print data. </td></tr><tr><td><a class="el" href="classk_print_save_print_data_cmd_boss.html">kPrintSavePrintDataCmdBoss</a></td><td>Saves the print data into a document. </td></tr></table><h2><a class="anchor" id="id_japanese_page_mark_files"></a> Japanese page-mark files</h2><p>The Japanese feature set provides two extra Type options in the Marks And Bleed panel in the Print dialog box and Print Presets selectable dialog box:<ul><li>Maru-tsuki Sentaa-tombo - The untranslated string key &quot;kJMarksWithCircle&quot; is passed into <a class="el" href="class_i_print_data.html#ad61a9a67f72efd87aad3147b4a6006f6">IPrintData::SetPageMarkFile</a>.<li>Maru-nashi Sentaa-tombo - The untranslated string key &quot;kJMarksWithoutCircle&quot; is passed into <a class="el" href="class_i_print_data.html#ad61a9a67f72efd87aad3147b4a6006f6">IPrintData::SetPageMarkFile</a>.</ul><p>In addition (with either the Roman or Japanese feature set), you can specify a filename (without path or extension) of a file that contains a custom page mark written using PostScript. The contents of this PostScript file are injected during printing. The actual file should have an .mrk extension and be in one of the following locations:<p>(Windows) C:\Program Files\Common Files\Adobe\PrintSpt<p>(Mac OS) /Library/Application Support/Adobe/PrintSpt<h2><a class="anchor" id="id_exporting_to_eps_and_pdf"></a> Exporting to EPS and PDF</h2><p>The process of exporting to EPS and PDF file formats is somewhat similar to the process of printing, in that similar components of the application are employed. The way you drive the export process and the data model behind the EPS and PDF export features are somewhat different. This section provides highlights of how to drive the EPS and PDF export features in the application.<h3><a class="anchor" id="id_exporting_to_eps"></a> Exporting to EPS</h3><p><b>EPS export preferences</b><p>Settings for EPS export are stored in the <a class="el" href="class_i_e_p_s_export_preferences.html">IEPSExportPreferences</a> interface on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. For details, refer to the API Reference.<p>To get the preferences, query for <a class="el" href="class_i_e_p_s_export_preferences.html">IEPSExportPreferences</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and call its Get methods.<p>To modify the preferences, process the <a class="el" href="classk_set_e_p_s_export_prefs_cmd_boss.html">kSetEPSExportPrefsCmdBoss</a> command. This command has a data interface, <a class="el" href="class_i_e_p_s_export_prefs_cmd_data.html">IEPSExportPrefsCmdData</a>, with which you specify the new values of the EPS preferences. Before you call any Set methods, you can call <a class="el" href="class_i_e_p_s_export_prefs_cmd_data.html#a450d029a2c38ba447ced30e680995c7b">IEPSExportPrefsCmdData::CopyPrefs</a> to copy the current preference settings in <a class="el" href="class_i_e_p_s_export_preferences.html">IEPSExportPreferences</a>.<p><b>User interface</b><p>When you choose File &gt; Export and specify the file to export and the export format to be EPS, you will see a selectable dialog box with two panels, General and Advanced. The user-interface elements on these panels are mapped to the methods on <a class="el" href="class_i_e_p_s_export_preferences.html">IEPSExportPreferences</a>, as described below.<p><b>Export EPS dialog box: General panel</b><div class="image"><img alt="epsexport-general.gif" src="epsexport-general.gif" /></div><ul><li>All Pages - <a class="el" href="class_i_e_p_s_export_preferences.html#a02ac1e08f561eacc3c0600fe3d96a825">IEPSExportPreferences::SetEPSExPageOption</a> using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a7c0fb0cf242d69931b36fedce8316076">IEPSExportPreferences::kExportAllPages</a><li>Ranges (radio button) - <a class="el" href="class_i_e_p_s_export_preferences.html#a02ac1e08f561eacc3c0600fe3d96a825">IEPSExportPreferences::SetEPSExPageOption</a> using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a1ed74f79f2b21f35556a329717a0bb6a">IEPSExportPreferences::kExportRanges</a><li>Ranges (text-edit box) - <a class="el" href="class_i_e_p_s_export_preferences.html#af48593efe3aaa06338e42bf0513d31a7">IEPSExportPreferences::SetEPSExPageRange</a><li>Spreads - <a class="el" href="class_i_e_p_s_export_preferences.html#a529b6a972ec6bf1f5faafc91f481e3ae">IEPSExportPreferences::SetEPSExReaderSpread</a> using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a0ce8d7b6fc9c3297ef08685bebe777aa">IEPSExportPreferences::kExportReaderSpreadOFF</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5ab8dd8129637f4548c41f9d73a58fba77">IEPSExportPreferences::kExportReaderSpreadON</a><li>PostScript - <a class="el" href="class_i_e_p_s_export_preferences.html#a19c799a377ae5ea5fe53d8136f2c21c0">IEPSExportPreferences::SetEPSExPSLevel</a> using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a271dacf9c1711392855ded7efad4dacb">IEPSExportPreferences::kExportPSLevel2</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5aab32e71b7464296708c93d77d852a927">IEPSExportPreferences::kExportPSLevel3</a><li>Color - <a class="el" href="class_i_e_p_s_export_preferences.html#a90b1494e46d58e740c50299d5fbd3dd9">IEPSExportPreferences::SetEPSExColorSpace</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5aad7348d59ed6bb4482b88945b2db923a">IEPSExportPreferences::kExportPSColorSpaceLeaveUnchanged</a>, <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a86c50ee903e4ab18d431375e94086c9d">IEPSExportPreferences::kExportPSColorSpaceDIC</a>, <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a81afac45a0fc92783c5664d572b58875">IEPSExportPreferences::kExportPSColorSpaceCMYK</a>, <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5aed4a0d9401fe5e0d9ddde0b881a16872">IEPSExportPreferences::kExportPSColorSpaceGray</a>, or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5ac712172d0f27c43506ab30a96803a011">IEPSExportPreferences::kExportPSColorSpaceRGB</a><li>Preview - <a class="el" href="class_i_e_p_s_export_preferences.html#a73c80ba685e6a06cb843ef4a64742c4c">IEPSExportPreferences::SetEPSExPreview</a> using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a272074b1f6c042559712cd55c220b58b">IEPSExportPreferences::kExportPreviewNone</a>, <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a8f2c0f69df5d5749c318fe32d265cc29">IEPSExportPreferences::kExportPreviewTIFF</a>, or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a63bfed363ebc2b4e48ac1cb06e3b4fbd">IEPSExportPreferences::kExportPreviewPICT</a> (Mac OS only)<li>Embed Fonts - <a class="el" href="class_i_e_p_s_export_preferences.html#abead9a4bf9dbcd7d570c156e141e9733">IEPSExportPreferences::SetEPSExIncludeFonts</a> using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5acdd2643300f9394e1e52ac746320f62f">IEPSExportPreferences::kExportIncludeFontsNone</a>, <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5ade4b0a4f49f043f4c173bd5fdfb692b1">IEPSExportPreferences::kExportIncludeFontsWhole</a>, <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5ae79f207320fd728da1017f9dd2edb328">IEPSExportPreferences::kExportIncludeFontsSubset</a>, or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a9429e28ac469a63920d36dc926f1f96f">IEPSExportPreferences::kExportIncludeFontsSubsetLarge</a><li>Data Format - <a class="el" href="class_i_e_p_s_export_preferences.html#ab4b8dc56dcbd3964583f6f004f9d34e9">IEPSExportPreferences::SetEPSExDataFormat</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a007ff711a0ae4b634fc8b41e39e4834f">IEPSExportPreferences::kExportASCIIData</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a3b73f9427b9272b0bb27f9bc8f3706c2">IEPSExportPreferences::kExportBinaryData</a><li>Bleed: Top - <a class="el" href="class_i_e_p_s_export_preferences.html#a29d44c5db5250be859aa9f02427ca126">IEPSExportPreferences::SetEPSExBleedTop</a><li>Bleed: Bottom - <a class="el" href="class_i_e_p_s_export_preferences.html#ae58cbb1eca4d5e4acb8e846b30588fe8">IEPSExportPreferences::SetEPSExBleedBottom</a><li>Bleed: Inside - <a class="el" href="class_i_e_p_s_export_preferences.html#adf34564bb7205178987438f2fded5d0d">IEPSExportPreferences::SetEPSExBleedInside</a><li>Bleed: Outside - <a class="el" href="class_i_e_p_s_export_preferences.html#aabd736f8569cf454c075026e27223a72">IEPSExportPreferences::SetEPSExBleedOutside</a><li>If any Bleed settings are over 0 - <a class="el" href="class_i_e_p_s_export_preferences.html#a0436ef9547a62f79e931ed8b4848c019">IEPSExportPreferences::SetEPSExBleedOnOff</a> using either <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a43bc61664e47afa72a2e279cd204812c">IEPSExportPreferences::kExportBleedON</a>, or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a66aa00476c885424a3af111bcfa8cc37">IEPSExportPreferences::kExportBleedOFF</a></ul><p><b>Export EPS dialog box: Advanced panel</b><div class="image"><img alt="epsexport-advanced.gif" src="epsexport-advanced.gif" /></div><ul><li>Send Data - <a class="el" href="class_i_e_p_s_export_preferences.html#a2cbda2b64f0fa610b61ef776018f4b5e">IEPSExportPreferences::SetEPSExBitmapSampling</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5aa6b401d880b667b1250a564c0313e73a">IEPSExportPreferences::kExportBMSampleNormal</a> or kExportBMSampleLowRes<li>OPI Image Replacement - <a class="el" href="class_i_e_p_s_export_preferences.html#a60fbd98a4b7f22849e6a33552ccc8e79">IEPSExportPreferences::SetEPSExOPIReplace</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a8a0c0db3f7eb31e9393ae38040c9cac0">IEPSExportPreferences::kExportOPIReplaceON</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a793cf651f240647dbf85359947edb49b">IEPSExportPreferences::kExportOPIReplaceOFF</a><li>Omit for OPI: EPS - <a class="el" href="class_i_e_p_s_export_preferences.html#a4e3c2c4769eb7450b08567a83584661b">IEPSExportPreferences::SetEPSExOmitEPS</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a2ff0b2cb592b3acc9f835579509fb64e">IEPSExportPreferences::kExportOmitEPSON</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5ac0391d037ade816c9b2a89c8b2e24fe9">IEPSExportPreferences::kExportOmitEPSOFF</a><li>Omit for OPI: PDF - <a class="el" href="class_i_e_p_s_export_preferences.html#a28fd5fb920842bb585b3dedff2670427">IEPSExportPreferences::SetEPSExOmitPDF</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a85ca76be09b5546bae377e754474a5bc">IEPSExportPreferences::kExportOmitPDFON</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a0d0ef13052d3d6d9f4b8a98cfe0e73d7">IEPSExportPreferences::kExportOmitPDFOFF</a><li>Omit for OPI: BitMap Images - <a class="el" href="class_i_e_p_s_export_preferences.html#a15d5b126d14e0a04d1bd8a0ad57ea498">IEPSExportPreferences::SetEPSExOmitBitmapImages</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5aeb6ecba4e94d478c168fe37c920d3456">IEPSExportPreferences::kExportOmitBitmapImagesON</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a09c6ffab74b36befa2bc1dd11b0ce6dc">IEPSExportPreferences::kExportOmitBitmapImagesOFF</a><li>Preset - <a class="el" href="class_i_e_p_s_export_preferences.html#a4c0cfc04618a613c1689b36924db39ca">IEPSExportPreferences::SetEPSExFlattenerStyle</a>, using a UID of a <a class="el" href="classk_x_p_flattener_style_boss.html">kXPFlattenerStyleBoss</a> object (use <a class="el" href="class_i_flattener_style_list_mgr.html">IFlattenerStyleListMgr</a> to find one)<li>Ignore Spread Overrides - <a class="el" href="class_i_e_p_s_export_preferences.html#a728824e4b3585d963ca982e4251fdba4">IEPSExportPreferences::SetEPSExIgnoreFlattenerSpreadOverrides</a>, using <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5ab77c00efc7a267b8658ef5d05e995e69">IEPSExportPreferences::kExportIgnoreSpreadOverridesON</a> or <a class="el" href="class_i_e_p_s_export_preferences.html#a1d17a510a181cba581d3228dc3ffdfc5a61d35956becc954355842460b9ab4803">IEPSExportPreferences::kExportIgnoreSpreadOverridesOFF</a></ul><p><b>Exporting</b><p>Using <a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a>, query for service providers supporting kExportProviderService. Find an export provider that can support the format name &quot;EPS,&quot; by iterating over all export providers and calling <a class="el" href="class_i_export_provider.html#a5cbf0f70ce56033b64c1a5702f5f8d53">IExportProvider::CountFormats</a> and <a class="el" href="class_i_export_provider.html#aa20ed4662ca96162a8e3a932ad4ed608">IExportProvider::GetNthFormatName</a>, or <a class="el" href="class_i_export_provider.html#a3b7f0d6e20093c4ed8fabaedca2a50f1">IExportProvider::CanExportThisFormat</a>. Once you find the export provider for EPS, do the following:<ul><li>Call <a class="el" href="class_i_export_provider.html#a30b3b500dd66245edf093abca810565b">IExportProvider::CanExportToFile</a> to check whether the document and current selection target can be exported.<li>Optionally, query for <a class="el" href="class_i_bool_data.html">IBoolData</a>, set it to kTrue to set <a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a>, and query for <a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a> and call its Set methods.<li>Call <a class="el" href="class_i_export_provider.html#a30b3b500dd66245edf093abca810565b">IExportProvider::CanExportToFile</a> or <a class="el" href="class_i_export_provider.html#ad5c85438fde6f014cecf967cba72fb0b">IExportProvider::ExportToStream</a> to do the export.</ul><h3><a class="anchor" id="id_exporting_to_pdf"></a> Exporting to PDF</h3><p>The structure of the PDF-export architecture is very similar to that of EPS export; however, you can specify a greater level of detail when exporting a document to PDF. For details of exporting to PDF, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_import_and_export">Import and Export</a>.<h1><a class="anchor" id="id_import_and_export"></a> Import and Export</h1><h2><a class="anchor" id="id_pdf_import_and_export"></a> PDF import and export</h2><h3><a class="anchor" id="id_pdf_import"></a> PDF import</h3><p>This section focuses on how to control PDF import preferences during the PDF import process.<p>Importing a file into InDesign requires a series of commands to be processed in a certain sequence. Before a PDF file can be imported, a page item needs to be created to hold the PDF content. Also, a proper datalink needs to be set up, so the association between the page item and the external file can be established.<p>The following figure is a high-level illustration of the import process in InDesign for a standalone desktop PDF file (not a workgroup file) to be loaded into the place gun. The details of a complete import process is beyond the scope of this document. We recommend you always try to import (or place) a file using the method illustrated in the SnpPlaceFile.cpp snippet sample, which uses kImportAndPlaceCmdBoss to place the file on the active spread. You also can use kImportAndLoadPlaceGunCmdBoss to load the file into the place gun. Both commands check with all the import providers and pick the appropriate provider for the type of file to import. The PDF import provider (<a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a>) is the default InDesign import provider for PDF files. <a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a> processes <a class="el" href="classk_p_d_f_place_cmd_boss.html">kPDFPlaceCmdBoss</a>, which is the central command that does the real work of importing a PDF file.<div class="image"><img alt="plugin-programming-guide-vol2-26.gif" src="plugin-programming-guide-vol2-26.gif" /></div><p>When you import a PDF file through the InDesign Place dialog box, if you choose Show Import Options, the Place PDF dialog opens:<div class="image"><img alt="plugin-programming-guide-vol2-27.gif" src="plugin-programming-guide-vol2-27.gif" /></div><p>The following options offer flexible PDF import:<ul><li>Placing multipage PDF pages (General tab) - You can place a range of PDF pages from a multipage PDF file. Under Pages, select All or enter a value for Range. The place gun is loaded as before, but the pointer changes to show that multiple pages exist. Each time you click, a PDF page is placed on the page. If you hold down the Alt/Option keys, the pointer changes to the cascade-place pointer, and clicking places all remaining pages on the page, cascading down from the click point.<li>Optional content groups (OCG) layers support (Layers tab) - OCG groups content for selective viewing and printing, supports complex mapping of objects to groups, and allows special use cases like language and zoom factors. By recognizing OCG constructs in placed PDF files, InDesign offers users the ability to selectively include those pieces of content.</ul><p>General PDF import options are stored in the <a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a> interface, and layers options are stored in <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a>; both interfaces are added to the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> workspace. Normally, these options are used unless the PDF import is performed through a link update; in that case, the <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> on the page item (<a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>) is used instead, and some attributes from the <a class="el" href="class_i_p_d_f_attributes.html">IPDFAttributes</a> aggregated on the <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a> are used. The following attributes override the defaults under the condition of a link update:<ul><li>IPDFAttributes::SetPage - Overrides PDF page number of the placed page.<li><a class="el" href="class_i_p_d_f_attributes.html#ad1cd2d875f7f3b671bfa90a554911674">IPDFAttributes::SetTransparentBackground</a> - Overrides Transparency background.<li><a class="el" href="class_i_p_d_f_attributes.html#ab0870ce021de621d07c9df5e171fbc3c">IPDFAttributes::SetPreserveScreens</a> - Overrides Preserve Halftone Screens.<li>IPDFAttributes::SetUserPassword - Overrides Set User Password.<li><a class="el" href="class_i_p_d_f_attributes.html#aaf24a5c4acb92d55d39d0a1e976f8c90">IPDFAttributes::SetCropTo</a> - Overrides Set Crop To.</ul><p>The following figure shows how <a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a> sets up the data interfaces for <a class="el" href="classk_p_d_f_place_cmd_boss.html">kPDFPlaceCmdBoss</a> in different cases. If the import is done with the full user interface, the user can change settings through the Place PDF dialog (see the preceding figure). InDesign uses <a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a> to do its PDF import, so by changing import options you control InDesign&#39;s PDF import behavior.<p>The following figure has a &quot;Minimal UI&quot; decision point. If the user deselects Show Import Options when importing a file, a minimal user interface is used: the user sees only a progress bar, not the Place PDF dialog.<p>The figure also has an &quot;Is the PDF import for link update?&quot; decision point. Link update is performed when the user selects Relink or Update from the Links panel. Doing this triggers a PDF import if the link is a PDF item.<div class="image"><img alt="plugin-programming-guide-vol2-28.gif" src="plugin-programming-guide-vol2-28.gif" /></div><p>The main interfaces to control the PDF import options are <a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a>, <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a>, and <a class="el" href="class_i_p_d_f_attributes.html">IPDFAttributes</a>. To modify the data stored in these interfaces, use the commands shown in the following table. Note there is no command to modify the <a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a> for clipboard import (IID_IPDFCLIPBOARDPLACEPREFS). If you process your own <a class="el" href="classk_p_d_f_place_cmd_boss.html">kPDFPlaceCmdBoss</a>, use the <a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a> aggregated on the command boss to set up the import option. The <a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> on the page item passed to the <a class="el" href="classk_p_d_f_place_cmd_boss.html">kPDFPlaceCmdBoss</a> is used for layer options.<p>Commands to Change PDF Import Options:<table class="doxtable"><tr><th>To change... </th><th>Use </th></tr><tr><td><a class="el" href="class_i_p_d_f_place_prefs.html">IPDFPlacePrefs</a> on the workspace </td><td><a class="el" href="classk_set_p_d_f_place_prefs_cmd_boss.html">kSetPDFPlacePrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> on the workspace </td><td><a class="el" href="classk_set_p_d_f_place_prefs_cmd_boss.html">kSetPDFPlacePrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_p_d_f_attributes.html">IPDFAttributes</a> on the page item </td><td><a class="el" href="classk_set_p_d_f_attributes_cmd_boss.html">kSetPDFAttributesCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_graphic_layer_info.html">IGraphicLayerInfo</a> on the page item </td><td><a class="el" href="classk_set_graphic_layer_info_cmd_boss.html">kSetGraphicLayerInfoCmdBoss</a></td></tr></table><h3><a class="anchor" id="id_pdf_export"></a> PDF export</h3><p><b>InDesign/InCopy document export</b><p>The easiest way to export an InDesign or InCopy document is to use the PDF export service provider. The following example is a snippet showing how to get the PDF export provider and call the export method.<div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> PDFFormat(<span class="stringliteral">&quot;Adobe PDF&quot;</span>);</div><div class="line">PDFFormat.SetTranslatable(kFalse);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISelectionManager&gt;</a> selection(SelectionUtils::QueryActiveSelection());</div><div class="line"><a class="code" href="class_i_document.html">IDocument</a> *frontDoc = ::GetFrontDocument();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IK2ServiceRegistry&gt;</a> k2ServiceRegistry(gSession, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="comment">// Look for all service providers with kExportProviderService.</span></div><div class="line">int32 exportProviderCount = k2ServiceRegistry-&gt;GetServiceProviderCount(kExportProviderService);</div><div class="line"><span class="comment">// Iterate through them. bool found = kFalse;</span></div><div class="line"><span class="keywordflow">for</span> (int32 exportProviderIndex = 0 ; exportProviderIndex &lt; exportProviderCount ; exportProviderIndex++) {</div><div class="line"><span class="comment">// get the service provider boss class</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IK2ServiceProvider&gt;</a> k2ServiceProvider(k2ServiceRegistry-&gt;QueryNthServiceProvider(kExportProviderService, exportProviderIndex));</div><div class="line"><span class="comment">// Get the export provider implementation itself.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IExportProvider&gt;</a> exportProvider(k2ServiceProvider, IID_IEXPORTPROVIDER);</div><div class="line"></div><div class="line"><span class="comment">// Check to see if the current selection specifier can be exported </span></div><div class="line"><span class="comment">// by this provider.</span></div><div class="line"> bool16 canExportByTarget = exportProvider-&gt;CanExportThisFormat(frontDoc, selection, PDFFormat);</div><div class="line"><span class="keywordflow">if</span> (canExportByTarget)</div><div class="line"> {</div><div class="line"></div><div class="line"> found = kTrue;</div><div class="line"></div><div class="line"><span class="comment">// assume idFile is a valid IDFile to hold the soon to be created PDF</span></div><div class="line"></div><div class="line"> exportProvider-&gt;ExportToFile(idFile, frontDoc, selection, PDFFormat, kFullUI);</div><div class="line"> }</div><div class="line"><span class="keywordflow">if</span> (found)</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line">}</div></div><p>In the example:<ul><li>The format name used to get the PDF export provider is Adobe PDF, defined in the beginning of the example.<li>The example tells the PDF export provider to use the full user interface during the export, meaning the PDF export settings dialog is brought up for the user to set export options. The settings dialog box is provided by <a class="el" href="classk_p_d_f_export_dialog_boss.html">kPDFExportDialogBoss</a> in InDesign and by <a class="el" href="classk_in_copy_p_d_f_expt_dialog_boss.html">kInCopyPDFExptDialogBoss</a> in InCopy. They are selectable dialog service providers you can retrieve through the <a class="el" href="class_i_k2_service_registry.html#a1382e083e067c711945c5256eaf963a8">IK2ServiceRegistry::GetServiceProviderIndex</a> method, although it is most practical to specify kFullUI and let the export provider do the work. If kSuppressUI is used instead, no user interface is presented, and you can change the preference as described below.<li>The example omits the steps that produce a valid <a class="el" href="class_i_d_file.html">IDFile</a> to be passed into the <a class="el" href="class_i_export_provider.html#a3e253076d0017a438978a94c64388010">IExportProvider::ExportToFile</a> method. Normally, the <a class="el" href="class_i_d_file.html">IDFile</a> is obtained through a standard Save File dialog box. You also can construct an <a class="el" href="class_i_d_file.html">IDFile</a> from scratch. For more information on <a class="el" href="class_i_d_file.html">IDFile</a>, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_using_adobe_file_library">Using Adobe File Library</a>.<li>The example is for exporting an InDesign/InCopy document. To export an InDesign book, see InDesign book export.</ul><p>The PDF export provider for InDesign/InCopy documents is represented by <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a>. There is an <a class="el" href="class_i_bool_data.html">IBoolData</a> in <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a>, which indicates whether print content preferences (<a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a>) should be considered. When you export from the InDesign menu, the default value for the <a class="el" href="class_i_bool_data.html">IBoolData</a> is set to false, so no print content preference are used during the default PDF export. Also, the PDF export provider allows you to use an export style (<a class="el" href="classk_p_d_f_export_style_boss.html">kPDFExportStyleBoss</a>) instead of dealing with the settings one by one. This is achieved by passing the style UID in the <a class="el" href="class_i_u_i_d_data.html">IUIDData</a> aggregated on the <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a>.<p>The <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a> processes <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>. Before the command is processed, kExportValidationCmdBoss is used to verify that the attributes set for the command will produce a valid output. The following table summarizes the command interfaces <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a> needs to set up before it processes <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>.<p>Critical data interfaces for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>:<table class="doxtable"><tr><th>Interface </th><th>Purpose </th></tr><tr><td><a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a></td><td>Holds most of the PDF export settings as seen in the PDF export options dialog. </td></tr><tr><td><a class="el" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a></td><td>Holds the PDF security preference. </td></tr><tr><td><a class="el" href="class_i_sys_file_data.html">ISysFileData</a></td><td>Holds the destination <a class="el" href="class_i_d_file.html">IDFile</a> for the PDF document. </td></tr><tr><td><a class="el" href="class_i_bool_data.html">IBoolData</a></td><td>Indicates whether the <a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a> should be used. </td></tr><tr><td><a class="el" href="class_i_print_content_prefs.html">IPrintContentPrefs</a></td><td>Allows certain contents to be removed from the output. </td></tr><tr><td><a class="el" href="class_i_bool_data.html">IBoolData</a> (IID_IBOOKEXPORT) </td><td>Indicates whether the command is used to export an InDesign book. </td></tr><tr><td><a class="el" href="class_i_u_i_flag_data.html">IUIFlagData</a></td><td>Tells the command to use kFullUI, kMinimalUI, or kSuppressUI. </td></tr><tr><td><a class="el" href="class_i_output_pages.html">IOutputPages</a></td><td>Holds the UIDs of the pages to output in layout mode. </td></tr><tr><td><a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a></td><td>Holds the data for galley export. </td></tr><tr><td><a class="el" href="class_i_bool_data.html">IBoolData</a> (IID_IINCOPYPDFNOTEANNOTATIONDATA) </td><td>Layout export note annotation flag. </td></tr><tr><td><a class="el" href="class_i_interactive_p_d_f_export_prefs.html">IInteractivePDFExportPrefs</a></td><td>Contains settings for exporting PDF files with interactive content such as multistate objects and media files. The PDF files created are targeted for Acrobat 9.0 and later. </td></tr></table><p><b>Interactive PDF</b><p>The <a class="el" href="class_i_interactive_p_d_f_export_prefs.html">IInteractivePDFExportPrefs</a> interface is used to configure the parameters for an export to the PDF format specifically targeted at Acrobat 9 and later. To export InDesign content to an interactive PDF, an instance of the interactive PDF export command <a class="el" href="classk_interactive_p_d_f_export_cmd_boss.html">kInteractivePDFExportCmdBoss</a> will typically need to be created.<p>You can then use the <a class="el" href="class_i_interactive_p_d_f_export_prefs.html">IInteractivePDFExportPrefs</a> aggregated on the command boss to set up various parameters for the export. The <a class="el" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a> interface off of the command boss can be used to set the security settings for the exported PDF. The <a class="el" href="class_i_interactive_p_d_f_export_prefs.html">IInteractivePDFExportPrefs</a> interface is also aggregated on the application workspace, where it is used to ensure that default export settings are preserved from export to export. Consider using this instance as the base for export settings. Also consider using <a class="el" href="classk_set_interactive_p_d_f_export_prefs_cmd_boss.html">kSetInteractivePDFExportPrefsCmdBoss</a> to update the default export settings for subsequent exports. The IInteractivePDFExportFacade facade can assist in retrieving the application workspace settings.<p><b>From InDesign layout view</b><p>If a style is passed to the export provider, the <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> on the <a class="el" href="classk_p_d_f_export_style_boss.html">kPDFExportStyleBoss</a> is copied to the <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> on the kPDFExportCmdBos; otherwise, the <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> is used. You can query the session&#39;s PDF export preference as follows:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportPrefs&gt;</a> appExportPrefs((<a class="code" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a>*)::QuerySessionPreferences(IID_IPDFEXPORTPREFS));</div></div><p>To change the preferences, process <a class="el" href="classk_set_p_d_f_export_prefs_cmd_boss.html">kSetPDFExportPrefsCmdBoss</a> and use the Set*** methods of <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> on the command boss to change the settings.<p><a class="el" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a> is set up using the preferences saved in the session (that is, <a class="el" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). You can query the preferences as follows:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFSecurityPrefs&gt;</a> appSecurityPrefs((<a class="code" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a>*)::QuerySessionPreferences(IID_IPDFSECURITYPREFS));</div></div><p>To change the security preferences, process <a class="el" href="classk_set_p_d_f_security_prefs_cmd_boss.html">kSetPDFSecurityPrefsCmdBoss</a> and use the Set*** methods of <a class="el" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a> on the command boss to change the settings.<p>Another critical interface in <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> that needs to be set up is <a class="el" href="class_i_output_pages.html">IOutputPages</a>. It holds the UIDs of the pages from the document for export. The PDF export provider uses <a class="el" href="class_i_page_range.html">IPageRange</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> to initialize the <a class="el" href="class_i_output_pages.html">IOutputPages</a> on <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>. <a class="el" href="classk_p_d_f_export_dialog_boss.html">kPDFExportDialogBoss</a> uses the same data to initialize the export settings dialog user interface, and it updates the session data when the user changes it from the dialog box. The following example shows how to set up <a class="el" href="class_i_output_pages.html">IOutputPages</a> from <a class="el" href="class_i_page_range.html">IPageRange</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPageRange&gt;</a> myPageRange((<a class="code" href="class_i_page_range.html">IPageRange</a>*)::QuerySessionPreferences(IID_IPAGERANGE));</div><div class="line"><a class="code" href="class_i_page_range.html#a06275a34abd08053b34a6ea5da10c9f6">IPageRange::RangeFormat</a> pageRangeFormat = myPageRange-&gt;GetPageRangeFormat();</div><div class="line"></div><div class="line"><span class="comment">// Assume theDoc is a valid IDocument* for export.UIDList pageUIDs = UIDList(::GetDataBase(theDoc));</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPageList&gt;</a> iPageList((<a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>*)theDoc, IID_IPAGELIST);</div><div class="line"><span class="keywordflow">if</span> (pageRangeFormat != <a class="code" href="class_i_page_range.html#a06275a34abd08053b34a6ea5da10c9f6a23d8954a8a6ff63afcdfb2ef3756f8e6">IPageRange::kAllPages</a>){</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> pageRange;</div><div class="line"> pageRange = myPageRange-&gt;GetPageRange();</div><div class="line"> pageRange.<a class="code" href="class_p_m_string.html#acdb6160d8d2233331c0f2e43b569706c">SetTranslatable</a>(kFalse);</div><div class="line"> iPageList-&gt;PageRangeStringToUIDList(pageRange, &amp;pageUIDs);}<span class="keywordflow">else</span>{</div><div class="line"> int32 cPages = iPageList-&gt;GetPageCount();</div><div class="line"><span class="keywordflow">for</span> (int32 iPage = 0; iPage &lt; cPages; iPage++ )</div><div class="line"> {</div><div class="line"></div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> uidPage = iPageList-&gt;GetNthPageUID(iPage);</div><div class="line"></div><div class="line"> pageUIDs.Append( uidPage );</div><div class="line"> }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Assume pdfExportCmd is the valid ICommand* from kPDFExportCmdBoss.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IOutputPages&gt;</a> iExportPages(pdfExportCmd, IID_IOUTPUTPAGES);</div><div class="line"></div><div class="line"><span class="comment">// Assume exportPrefs is the previously set IPDFExportPrefs from kPDFExportCmdBoss.</span></div><div class="line">iExportPages-&gt;InitializeFrom(pageUIDs, (exportPrefs-&gt;GetPDFExReaderSpreads() == IPDFExportPrefs::kExportReaderSpreadsON));</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> name;</div><div class="line">theDoc-&gt;<a class="code" href="class_i_document.html#a97d9d37dae4850a7eb0d8814728d2946">GetName</a>(name);</div><div class="line">iExportPages-&gt;SetName(name);</div></div><p><b>From InCopy layout view</b><p>There is an <a class="el" href="class_i_in_copy_p_d_f_expt_layout_data.html">IInCopyPDFExptLayoutData</a> interface on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, which is used to store some InCopy layout export settings. During an InCopy layout export, <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> is set up as described in From InDesign layout view. Then the <a class="el" href="class_i_in_copy_p_d_f_expt_layout_data.html">IInCopyPDFExptLayoutData</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> is used to override some of the data on the command&#39;s <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a>. The following table summarizes the overrides. To change the <a class="el" href="class_i_in_copy_p_d_f_expt_layout_data.html">IInCopyPDFExptLayoutData</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, use <a class="el" href="classk_save_in_copy_p_d_f_expt_layout_data_cmd_boss.html">kSaveInCopyPDFExptLayoutDataCmdBoss</a>.<p>InCopy Layout-specific export settings:<table class="doxtable"><tr><th>Attributes </th><th>Override </th></tr><tr><td>Launch Adobe Acrobat </td><td>Changed by SetPDFExLaunchAcrobat. If IInCopyPDFExptLayoutData::GetPDFExLaunchAcrobat is equal to kTrue, this is set to kExportLaunchAcrobatON; otherwise, kExportLaunchAcrobatOFF. </td></tr><tr><td>Compatibility Level </td><td>Changed by SetPDFExAcrobatCompatibilityLevel. Set to the value returned by IInCopyPDFExptLayoutData::GetPDFExAcrobatCompatibilityLevel. </td></tr><tr><td>Compression Type </td><td>Changed by SetCompressionType. If IInCopyPDFExptLayoutData::GetPDFExAcrobatCompatibilityLevel &gt;= kPDFVersion15, this is set to kCompressObjects; otherwise, kCompressNone. </td></tr><tr><td>Embed Page Thumbnails </td><td>Changed by SetPDFExThumbnails. If IInCopyPDFExptLayoutData::GetPDFExThumbnails is equal to kTrue, this is set to kExportThumbnailsON; otherwise, kExportThumbnailsOFF. </td></tr><tr><td>Optimize for Fast Web View </td><td>Changed by SetPDFExLinearized. If IInCopyPDFExptLayoutData::GetPDFExLinearized is equal to kTrue, this is set to kExportLinearizedON; otherwise, kExportLinearizedOFF. </td></tr><tr><td>Include Page Information </td><td>Changed by SetPDFExPageInfo. If IInCopyPDFExptLayoutData::GetPDFExPageInfo is equal to kTrue, this is set to kExportPageInfoON; otherwise, kExportPageInfoOFF. </td></tr><tr><td>Subset Fonts Threshold </td><td>Changed by SetPDFExSubsetFontsThreshold. Set to the value returned by IInCopyPDFExptLayoutData::GetPDFExSubsetFontsThreshold. </td></tr><tr><td>Export Reader Spreads </td><td>Changed by SetPDFExReaderSpreads. If IInCopyPDFExptLayoutData::GetPDFExReaderSpreads is equal to kTrue, this is set to kExportReaderSpreadsON; otherwise, kExportReaderSpreadsOFF. </td></tr><tr><td>Interactive Elements </td><td>Changed by SetPDFExAddInteractiveElements. Set to the value returned by IInCopyPDFExptLayoutData::GetPDFExAddInteractiveElements. </td></tr><tr><td>Multimedia Content to Embed </td><td>Changed by SetContentToEmbed. Set to the value returned by IInCopyPDFExptLayoutData::GetContentToEmbed. </td></tr></table><p><a class="el" href="class_i_output_pages.html">IOutputPages</a> for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> is set up like <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> <a class="el" href="class_i_output_pages.html">IOutputPages</a> from <a class="el" href="class_i_page_range.html">IPageRange</a>, except IInCopyPDFExptLayoutData::GetPDFExPageRangeFormat is used to check the range format and IInCopyPDFExptLayoutData::GetPDFExPageRange is used to get the range if the range format is not IInCopyPDFExptLayoutData::kAllPages.<p><a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> also aggregates an interface, <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a>. During InCopy layout export, IInCopyGalleySettingData::SetGalleySetting(kFalse) is called, so no <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> is used.<p>The <a class="el" href="class_i_bool_data.html">IBoolData</a> (IID_IINCOPYPDFNOTEANNOTATIONDATA) on the kPDFFxportCmdBoss is set to the value from IInCopyPDFExptLayoutData::GetPDFExAnnotationNotes.<p><b>From InCopy story view or galley view</b><p>Export from galley view is different than export from layout view, because the galley and story view on-screen may not be the export (print) view. Galley export allows the user to output the galley story with multiple columns and a selected range of story lines. When the user selects export, a final view to the document is not yet available. The PDF export provider internally executes <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a> to generate an invisible galley view for PDF port printing based on the user&#39;s preferences.<p><a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> is the default galley-specific setting data used during PDF export. It is used to set up some of the data in <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> and <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a>; both are aggregated on <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>. The PDF export provider does not take the data from <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> as is: if the galley document contains any story and the session&#39;s <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> is default (checked through IInCopyPDFExptGalleyData::GetIsDefaultValues), the data shown in the following table is overridden.<p><a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> overrides when it is the default:<table class="doxtable"><tr><th>Attributes </th><th>Override </th></tr><tr><td>Font Leading </td><td>Changed by SetPDFExFontLeading. Set to the string value returned from <a class="el" href="class_i_galley_settings_overwrite.html#ace822d8240d2e16364559f203718f608">IGalleySettingsOverwrite::GetDisplayFontLeading</a>. </td></tr><tr><td>Font Name </td><td>Changed by SetPDFExFont. Set to the value returned by Utils&lt;IGalleyUtils&gt;()-&gt;GetFontFamilyAndStyle. </td></tr><tr><td>Font Size </td><td>Changed by SetPDFExFontSize. Set to the string value returned from <a class="el" href="class_i_galley_settings_overwrite.html#ad112ebff29d75038f24279ebd56e3183">IGalleySettingsOverwrite::GetDisplayFontSize</a>. </td></tr><tr><td>Font Type </td><td>Changed by SetPDFExFontType. Set to the value returned by Utils&lt;IGalleyUtils&gt;()-&gt;GetFontFamilyAndStyle. </td></tr><tr><td>Include Accurate Line Endings </td><td>Changed by SetPDFExALE. If ITextLine::GetLinesType is equal to ITextLines::kLayoutLineEnds, set to kTrue; otherwise, kFalse. </td></tr><tr><td>Include Inline Notes </td><td>Changed by SetPDFExInlineNotes. If there is at least one note anchor in the document, set to kTrue; otherwise, kFalse. </td></tr><tr><td>Include Line Numbers </td><td>Changed by SetPDFExLineNumber. Set to the value returned by Utils&lt;IGalleyUtils&gt;()-&gt;InGalley(). </td></tr><tr><td>Include Paragraph Styles </td><td>Changed by SetPDFExStyle. Set to the value returned from <a class="el" href="class_i_galley_settings_overwrite.html#ad024cea9927519aeb4c67130a691e108">IGalleySettingsOverwrite::GetShowParagraphStyleNames</a>. </td></tr><tr><td>Include Track Changes </td><td>Changed by SetPDFExTrackChanges. Set to the value returned from <a class="el" href="class_i_galley_settings_overwrite.html#af02ad11885fe8f29bb0ac735f261ceef">IGalleySettingsOverwrite::GetShowTrackChanges</a>. </td></tr><tr><td>Notes Type </td><td>Changed by SetPDFExNotesType. Set to kVisible. </td></tr><tr><td>Show Notes Backgrounds in Color </td><td>Changed by SetPDFExNotesBackground. Set to kFalse. </td></tr><tr><td>Show Track Changes Backgrounds in Color </td><td>Changed by SetPDFExTrackChangesBackground. Set to kFalse. </td></tr><tr><td>Track Changes Type </td><td>Changed by SetPDFExTrackChangesType. Set to kVisible. </td></tr></table><dl class="section note"><dt>Note<dd>ITextLine and <a class="el" href="class_i_galley_settings_overwrite.html">IGalleySettingsOverwrite</a> should be from the galley view (<a class="el" href="classk_writing_mode_widget_boss.html">kWritingModeWidgetBoss</a>) of the exported document.</dl><p>In galley view mode, the PDF export provider initializes <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> and <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> in much the same way as described in From InCopy layout view, but the attributes from <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> shown in the following table are overridden by <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a>, as described above.<p><b>Galley-specific settings for <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a>:</b><table class="doxtable"><tr><th>Attributes </th><th>Values </th></tr><tr><td>Acrobat Compatibility Level </td><td>Set by SetPDFExAcrobatCompatibilityLevel. Set to the value returned from IInCopyPDFExptGalleyData::GetPDFExAcrobatCompatibilityLevel. </td></tr><tr><td>Include Page Information </td><td>Set by SetPDFExPageInfo. If IInCopyPDFExptGalleyData::GetPDFExPageInfo is equal to kTrue, this is set to IPDFExportPrefs::kExportPageInfoON; otherwise, IPDFExportPrefs::kExportPageInfoOFF. </td></tr><tr><td>Subset Fonts Threshold </td><td>Set by SetPDFExSubsetFontsThreshold. Set to the value returned from IInCopyPDFExptGalleyData::GetPDFExSubsetFontsThreshold. </td></tr></table><p>As described in From InCopy layout view, <a class="el" href="class_i_output_pages.html">IOutputPages</a> is a critical interface that holds the UIDs of pages to be exported for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> in layout mode. For InCopy galley and story mode, however, <a class="el" href="class_i_output_pages.html">IOutputPages</a> cannot provide enough data for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> to draw a range of lines from galley view or rearrange the number of columns in the output PDF that are allowed in the galley export options dialog box. Therefore, the interface <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> is aggregated on <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> to hold the data used to create a galley window for PDF export.<p>In addition to settings specific to galley mode, <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> also holds the views (IControlView* of the galley writing widgets, paragraph information panel, etc.) that represent the real output pages based on the user&#39;s galley export settings. <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> passes these views to the PDF drawing port for output instead of using <a class="el" href="class_i_output_pages.html">IOutputPages</a>. The user of <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> is responsible for setting up <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> properly before the command is processed.<p>The PDF export provider executes <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a> to get an invisible output view based on the data from the current galley document and <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a>. It then uses the view and <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> to set up <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>. The PDF export provider sets up <a class="el" href="class_i_output_pages.html">IOutputPages</a> of <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> with <a class="el" href="class_i_output_pages.html">IOutputPages</a> returned from <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a>, which has the values shown in the following table.<p><b>IOutput pages from <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a>:</b><table class="doxtable"><tr><th>Attributes </th><th>Values </th></tr><tr><td>ContiguousPages </td><td>kTrue </td></tr><tr><td>Name </td><td>Name of the galley document </td></tr><tr><td>IsSpreads </td><td>kFalse </td></tr><tr><td>MasterDataBase </td><td>Database for the window created by the <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr><tr><td>UIDs </td><td>Placeholder. UIDs number from 0 to total pages-1. UIDs contained in <a class="el" href="class_i_output_pages.html">IOutputPages</a> are not used by <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> in InCopy galley and story mode. </td></tr></table><p>The following steps summarize how the PDF export provider sets up <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>.<ol type="1"><li>A new <a class="el" href="classk_in_copy_galley_setting_data_boss.html">kInCopyGalleySettingDataBoss</a> is created, with default value.<li><a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> is used to override the <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> of the new <a class="el" href="classk_in_copy_galley_setting_data_boss.html">kInCopyGalleySettingDataBoss</a>.<li><a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> is used to execute the <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a> command.<li>A copy of <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> returned from <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a> in Step 3 is used to set up <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>.</ol><p>The following table shows how attributes from <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> get their values in different stages. In the table, &quot;PEGD&quot; stands for <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> from Step 2 above.<p><b>Setting up <a class="el" href="class_i_in_copy_galley_setting_data.html">IInCopyGalleySettingData</a> for <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>:</b><table class="doxtable"><tr><th>Attribute and description </th><th>Default value </th><th>Overridden value </th><th>Final value after <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></th></tr><tr><td>Galley/story control view </td><td>nil </td><td>nil </td><td>Calculated by <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr><tr><td>Paragraph panel control view (GetInfoColumnView) </td><td>nil </td><td>nil </td><td>Calculated by <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr><tr><td>Line number panel control view (GetLineNumberView) </td><td>N/A, not used </td><td>N/A, not used </td><td>N/A, not used </td></tr><tr><td>Splitter control view (GetInfoSplitterView) </td><td>nil </td><td>nil </td><td>Calculated by <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr><tr><td>Total content height of the galley (GetTotalHeight) </td><td>0 </td><td>0 </td><td>Calculated by <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr><tr><td>Start Line Number (GetStartLineNumber) </td><td>N/A, not used </td><td>N/A, not used </td><td>N/A, not used </td></tr><tr><td>End Line Number (GetEndLineNumber) </td><td>N/A, not used </td><td>N/A, not used </td><td>N/A, not used </td></tr><tr><td>Column width (GetColumnWidth) </td><td>0 </td><td>Calculated based on PEGD and current unit settings </td><td>Calculated by <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr><tr><td>GalleySetting </td><td>kTrue </td><td>kTrue </td><td>kTrue </td></tr><tr><td>Document <a class="el" href="class_u_i_d_ref.html">UIDRef</a> (GetDocUIDRef) </td><td>N/A </td><td><a class="el" href="class_u_i_d_ref.html">UIDRef</a> of galley document </td><td><a class="el" href="class_u_i_d_ref.html">UIDRef</a> of galley document </td></tr><tr><td>To print with paragraph style info (GetParaStyle) </td><td>kFalse </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with line number (GetLineNumber) </td><td>kFalse </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with accurate line ending (GetALE) </td><td>kFalse </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with notes displayed (GetNotes) </td><td>kFalse </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with tracked changes displayed (GetTrackChange) </td><td>kFalse </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Notes displayed type (GetNotesType) </td><td>kVisible </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Track change displayed type (GetTrackChangesType) </td><td>kVisible </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Font name (GetFontName) </td><td>&quot;&quot; </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Font type (GetFontType) </td><td>&quot;&quot; </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Font size (GetFontSize) </td><td>&quot;&quot; </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Font leading (GetFontLeading) </td><td>&quot;&quot; </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with line range scope (GetWhich) </td><td>IIncopyGalleyPrintData::kAll </td><td>If PEGD&#39;s GetPDFExlineRangeFormat is IInCopyPDFExptGalleyData::kAllLine, set to kAllLines; otherwise, kUseRange </td><td>If PEGD&#39;s GetPDFExlineRangeFormat is IInCopyPDFExptGalleyData::kAllLine, set to kAllLines; otherwise kUseRange. </td></tr><tr><td>To print the line range (GetRange) </td><td>&quot;&quot; </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>Galley frame size (GetFrameSize) </td><td>Rect(0, 0, 0, 0) </td><td>Set frame to the page bounds from the first page of the galley document. </td><td>Set frame to the page bounds from the first page of the galley document. </td></tr><tr><td>To print with content filled with the page (GetFill) </td><td>kFalse </td><td>If GetALE returns true, then set to the return value from PEGD&#39;s GetPDFExFill; otherwise, kFalse. </td><td>If GetALE returns true, then set to the return value from PEGD&#39;s GetPDFExFill; otherwise, kFalse. </td></tr><tr><td>Story range (GetScope) </td><td>IInCopyGalleyPrintData::kAll </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with story information (GetStoryInfo) </td><td>kFalse </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with notes background in color (GetNotesBackgroundInColor) </td><td>kTrue </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with track changes background in color (GetTrackChangesBackgroundInColor) </td><td>kTrue </td><td>from PEGD </td><td>from PEGD </td></tr><tr><td>To print with page information (GetPagesInfo) </td><td>kFalse </td><td>kFalse </td><td>kFalse (<a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> takes this info from <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a>) </td></tr><tr><td>To print with number of columns (GetColumns) </td><td>1 </td><td>1 </td><td>Calculated by <a class="el" href="classk_create_print_galley_view_cmd_boss.html">kCreatePrintGalleyViewCmdBoss</a></td></tr></table><p><b>PDF/VT</b><p>PDF/VT (V: variable, T: transactional) enables variable data publishing in a variety of environments, from desktop printing to digital production press, and to accommodate linkages for content, such as TransPromo applications, which combine color promotional content with transaction information.<p>PDF/VT has three levels; InDesign provides API support for creating only PDF/VT-1:<ul><li>PDF/VT-1 is for a complete single file exchange. PDF/VT-1 requires all resources necessary for proper interpretation of the PDF data to be included within the conforming PDF file.<li>PDF/VT-2 is for multiple file exchange, allowing additional content to come from external files.<li>PDF/VT-2s is for streamed delivery, which is a MIME package that contains a sequence of one or more PDF/VT files and supporting resources.</ul><p>With InDesign, the third-party plug-in has the responsibility for setting up the PDF export preferences properly to achieve PDF/X-4 standards compliance (required for PDF/VT-1).<p>The solution for generating a PDF/VT document is built upon the PDFExportSetupService service provider. To create a PDF/VT document, implement this service (IID_IPDFEXPORTSETUPPROVIDER) to start receiving the PDF export events (class PDFExportEvent).<p>The PDF export events are generated by InDesign&#39;s PDF export process and are dispatched to all the PDFExportSetupService providers. A PDF export event contains the following information:<ul><li>Event ID - The identifier for the event, which conveys what stage the PDF export process is in, for example, begin export, draw page, draw spread, or end export.<li>Target port - The PDF doc port to which InDesign is exporting.<li>Database - The database for the page/spread to draw. It may change from one event to another for a single PDF export if multiple InDesign documents are being exported in the same session.<li>UID - The UID for the page/spread to draw.</ul><p>To create a PDF/VT file, the plug-in must provide the PDF/VT DPart hierarchy and metadata information that it will generate to the PDF export process. This information could either be provided page by page (in the draw page/spread event), record by record (in the draw page/spread event but at record boundaries) for a multipage document template, or all at one time (in the end export event).<p>The interface <a class="el" href="class_i_p_d_f_d_part_hierarchy.html">IPDFDPartHierarchy</a> is aggregated on the <a class="el" href="classk_p_d_f_view_port_boss.html">kPDFViewPortBoss</a>. The plug-in code can get this interface from the PDF doc port as follows:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFDPartHierarchy&gt;</a> iHier(pdfExportEvent-&gt;targetPort, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>The <a class="el" href="class_i_p_d_f_d_part_hierarchy.html">IPDFDPartHierarchy</a> interface provides APIs to create the DPart hierarchy for the PDF/VT. These APIs allow the plug-in to set the PDF/VT node name list, set the record level, and create the DPart node tree, starting from the root DPart node. It also provides APIs to create child DPart nodes, add pages to DPart nodes, and set metadata for DPart nodes.<p>Plug-ins create the DPart metadata using the services of another interface, <a class="el" href="class_i_p_d_f_d_part_metadata_utils.html">IPDFDPartMetadataUtils</a>, which is again aggregated on the <a class="el" href="classk_p_d_f_view_port_boss.html">kPDFViewPortBoss</a>. This interface allows plug-ins to create rich DPart metadata. The metadata dictionary created using this interface can then be attached to the DPart node by the plug-ins.<p>For a sample showing how to export PDF/VT file, see PDFVT in the SDK.<p><b>InDesign book export</b><p>You can use the high-level <a class="el" href="classk_book_export_action_cmd_boss.html">kBookExportActionCmdBoss</a> to easily export a book. For details, see SnpExportBookAsPDF.cpp.<p><a class="el" href="classk_book_export_action_cmd_boss.html">kBookExportActionCmdBoss</a> uses <a class="el" href="classk_p_d_f_export_book_boss.html">kPDFExportBookBoss</a> (with service ID kExportBookService), which uses the same PDF export service provider (kPDFExportProviderImpl) as the <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a>; however, <a class="el" href="classk_p_d_f_export_book_boss.html">kPDFExportBookBoss</a> aggregates an <a class="el" href="class_i_output_pages.html">IOutputPages</a> interface that lists document pages in the book to export. The regular document <a class="el" href="classk_p_d_f_export_boss.html">kPDFExportBoss</a> does not aggregate <a class="el" href="class_i_output_pages.html">IOutputPages</a>; it sets up <a class="el" href="class_i_output_pages.html">IOutputPages</a> for the <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> based on the <a class="el" href="class_i_page_range.html">IPageRange</a>, as shown in the example in From InDesign layout view.<p><b>Selected page-items export</b><p>There is no direct user interface to allow export of selected page items in InDesign; however, you can copy selected page items to the pasteboard in PDF format. Then, when you paste into an external application that supports PDF import, the pasted object is in PDF format. This is done through <a class="el" href="classk_p_d_f_export_items_cmd_boss.html">kPDFExportItemsCmdBoss</a>. The snippet in the following example shows how to process the command. <div class="fragment"><div class="line"><span class="comment">// Assume stream is the destination PDF file write stream.</span></div><div class="line"><span class="comment">// Assume realPageItems contains no guide item, which can</span></div><div class="line"><span class="comment">// cause trouble in PDF export.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> command(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_p_d_f_export_items_cmd_boss.html">kPDFExportItemsCmdBoss</a>));</div><div class="line"><span class="keywordflow">if</span> (command){</div><div class="line"> command-&gt;SetItemList(realPageItems);</div><div class="line"><span class="comment">// Initialize the command data from the session.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportPrefs&gt;</a> appExportPrefs((<a class="code" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> *)</div><div class="line"> ::QuerySessionPreferences(IID_IPDFCLIPBOARDEXPORTPREFS));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportPrefs&gt;</a> exportPrefs(command, IID_IPDFEXPORTPREFS);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFSecurityPrefs&gt;</a> appSecurityPrefs((<a class="code" href="class_i_p_d_f_security_prefs.html">IPDFSecurityPrefs</a> *)::QuerySessionPreferences(IID_IPDFSECURITYPREFS));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFSecurityPrefs&gt;</a> exportSecurityPrefs(command,IID_IPDFSECURITYPREFS);</div><div class="line"> exportPrefs-&gt;CopyPrefs(appExportPrefs);</div><div class="line"> exportSecurityPrefs-&gt;CopyPrefs(appSecurityPrefs);</div><div class="line"><span class="comment">// no progress bar</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IBoolData&gt;</a> useProgressBar(command, IID_IUSEPROGRESSINDICATOR);</div><div class="line"> useProgressBar-&gt;Set(kFalse);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IUIFlagData&gt;</a> uiFlagData(command, IID_IUIFLAGDATA);</div><div class="line"> uiFlagData-&gt;Set(kSuppressUI);</div><div class="line"><span class="comment">// Assume no destination color profile (i.e., ignore IUIDData).</span></div><div class="line"><span class="comment">// (IID_IPDFDESTCMSPROFILE)</span></div><div class="line"><span class="comment">// Put the stream pointer in the IIntData.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IIntData&gt;</a> exportCmdStreamData(command, IID_IINTDATA);</div><div class="line"> exportCmdStreamData-&gt;Set((<span class="keywordtype">long</span>) stream);</div><div class="line"><span class="comment">// process the command CmdUtils::ProcessCommand(command);</span></div><div class="line"> success = <a class="code" href="class_error_utils.html#ad32805d9e73399357297c07e60fde65a">ErrorUtils::PMGetGlobalErrorCode</a>();</div><div class="line">}</div></div><h3><a class="anchor" id="id_pdf_export_performance"></a> PDF Export Performance</h3><p>Consider two exports:<ul><li>A 1000-page InDesign document exported to a single PDF file<li>A one-page InDesign document exported to 1000 PDF files</ul><p>The first is much faster because it has a single port to which the 1000 pages are exported, whereas the second has 1000 such ports. Each port has its own cache. For the first case, the cache is initialized only once. For the second, the caches are initialized 1000 times, once in each port.<p>For example, suppose that you have a one-page InDesign document containing variable content as a template and you have a database containing thousands of records for the variable content. You want to merge the template document with each record in the database and export the resulting files to PDF.<p>A bad approach would be to<ol type="1"><li>Replace the variable data in the template document with each record.<li>Export each merged document to PDF.</ol><p>This is same as the second case, which has bad performance.<p>A good approach would be<ol type="1"><li>Trigger the PDF export command on the template document with page range=(1,1,1...,1), where the quantity of 1s is equal to the quantity of records to merge. <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> cmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a>));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPageList&gt;</a> pageList(theDoc, IID_IPAGELIST);</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> uidRef = ::GetUIDRef(theDoc);</div><div class="line"><a class="code" href="class_u_i_d_list.html">UIDList</a> pageUIDs = <a class="code" href="class_u_i_d_list.html">UIDList</a>(uidRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>());</div><div class="line"><span class="comment">// Number of records to mergeint32 N = 1000;</span></div><div class="line"><span class="comment">// Assume the template document has 1 page</span></div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> uidPage = pageList-&gt;GetNthPageUID(0);</div><div class="line"><span class="comment">// Append the uid of page 0 N times</span></div><div class="line"><span class="keywordflow">for</span> (int32 i = 0; i &lt; N; i++){</div><div class="line"> pageUIDs.<a class="code" href="class_u_i_d_list.html#af3e96611e89d18e2a100bd69781d7cef">Append</a>(uidPage);</div><div class="line">}</div><div class="line">cmd-&gt;SetItemList(pageUIDs);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IOutputPages&gt;</a> exportPages(cmd, IID_IOUTPUTPAGES);</div><div class="line">exportPages-&gt;InitializeFrom(pageUIDs, kFalse);</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> name;</div><div class="line">theDoc-&gt;<a class="code" href="class_i_document.html#a97d9d37dae4850a7eb0d8814728d2946">GetName</a>(name);exportPages-&gt;SetName(name);</div></div><li>Provide a PDFExportSetupService service provider. During the PDF export process, the PDF export events are generated by InDesign&#39;s PDF export process and are dispatched to this service provider&#39;s PDFProcessEvent callback for each page. In this callback, merge the record data into the template document.</ol><p>This approach allows all records to be exported into a single PDF file, eliminating the creation of numerous PDF ports.<h3><a class="anchor" id="id_pdf_style_import_and_export"></a> PDF style import and export</h3><p>When the PDF export provider brings up the Export Adobe PDF options dialog box, the dialog box is initialized according to the following rules:<ol type="1"><li>A preset style UID may be passed in. When it is available, use it.<li>Otherwise, if the last preset used is named &quot;[Custom]&quot; or the style name ends with &quot;(modified),&quot; use the application preferences of the workspace.<li>Otherwise, if the last preset used is not empty and is valid, use it.<li>Otherwise, use the default preferences. This is the first time the export dialog is run after deleting Save Data.</ol><p>PDF export style is represented by <a class="el" href="classk_p_d_f_export_style_boss.html">kPDFExportStyleBoss</a>, which aggregates an <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> interface that stores the settings. Usually, the <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> -&gt; CopyPrefs method is used to copy the setting out of the style boss to another <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> you are using. The last preset style&#39;s name is saved in the IPDFExportStyleLastUsed on the kWorkspace. You can use the snippet in the following example to get the name in <a class="el" href="class_p_m_string.html">PMString</a>: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportStyleLastUsed&gt;</a> iStyleLast((IPDFExportStyleLastUsed*)::QuerySessionPreferences (IID_IPDFEXPORTSTYLELASTUSED));</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> lastPreset;</div><div class="line"><span class="keywordflow">if</span> (iStyleLast)</div><div class="line"> lastPreset = iStyleLast-&gt;GetString();</div><div class="line">lastPreset.<a class="code" href="class_p_m_string.html#acdb6160d8d2233331c0f2e43b569706c">SetTranslatable</a>(<span class="keyword">false</span>);</div></div><p>Given a style name, you can use <a class="el" href="class_i_p_d_f_expt_style_list_mgr.html">IPDFExptStyleListMgr</a> (aggregated on kWorkspace) to obtain the UID style object, Continuing from the preceding example, the following example shows how to get to a last used style object from its name: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExptStyleListMgr&gt;</a> styleMgr((<a class="code" href="class_i_p_d_f_expt_style_list_mgr.html">IPDFExptStyleListMgr</a>*)::QuerySessionPreferences(IID_IPDFEXPORTSTYLELISTMGR));</div><div class="line">int32 nStyle = styleMgr-&gt;GetStyleIndexByName(lastPreset);</div><div class="line"><span class="keywordflow">if</span> (nStyle != -1){</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> styleRef = styleMgr-&gt;GetNthStyleRef(nStyle);</div><div class="line"></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportPrefs&gt;</a> pStylePrefs(styleRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span>( pStylePrefs )</div><div class="line"> {</div><div class="line"></div><div class="line"><span class="comment">// assume myExportPrefs is an IPDFExportPrefs I am trying to set up</span></div><div class="line"></div><div class="line"> myExportPrefs-&gt;CopyPrefs(pStylePrefs);</div><div class="line"> };</div><div class="line">}</div></div><p><b>Adding, deleting, and editing styles</b><p>To add a style, use <a class="el" href="classk_p_d_f_export_add_style_cmd_boss.html">kPDFExportAddStyleCmdBoss</a>. The following example shows how to process the command: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> addCmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_p_d_f_export_add_style_cmd_boss.html">kPDFExportAddStyleCmdBoss</a>));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IExportStyleCmdData&gt;</a> cmdData(addCmd, IID_IEXPORTSTYLECMDDATA);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> workspace(gSession-&gt;QueryWorkspace());</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> workspaceUIDRef = ::GetUIDRef(workspace);</div><div class="line">cmdData-&gt;SetSrcList(workspaceUIDRef);</div><div class="line">cmdData-&gt;SetDstList(workspaceUIDRef);</div><div class="line"><span class="comment">// Assume presetName is a PMString containing the new style name.</span></div><div class="line">cmdData-&gt;SetNewName(presetName);cmdData-&gt;SetStyleIndex(-2); </div><div class="line"><span class="comment">// -2 means get the PDF preferences from the command.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportPrefs&gt;</a> commandPrefs(cmdData, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="comment">// Assume pSrcPref is my source IPDFExportPrefs to be made into the new style.</span></div><div class="line">commandPrefs-&gt;CopyPrefs(pSrcPrefs);</div><div class="line">commandPrefs-&gt;SetUIName(presetName);</div><div class="line">ErrorCode rc = <a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(addCmd);</div></div><p>The command boss aggregates an <a class="el" href="class_i_export_style_cmd_data.html">IExportStyleCmdData</a> that has a method, SetStyleIndex, that sets up a style index for the command. The style index tells the command where the source style comes from, according to the following rules:<ol type="1"><li>If there is valid index (index &gt; = 0), that style&#39;s PDF preferences (queried from an <a class="el" href="class_i_p_d_f_expt_style_list_mgr.html">IPDFExptStyleListMgr</a> returned by <a class="el" href="class_i_export_style_cmd_data.html#a30e51f8fda6965df4184c20421e21701">IExportStyleCmdData::GetSrcList</a>) are used.<li>If the index is -2, the PDF preferences come from the command.<li>If the index is -3, the PDF preferences come from the command, but the data is not written to disk.<li>Otherwise, the PDF preferences come from the current application preferences.<li>In all cases except -3, the data is written to disk.</ol><p>To delete a style, use <a class="el" href="classk_p_d_f_export_delete_style_cmd_boss.html">kPDFExportDeleteStyleCmdBoss</a>. The following example shows how to delete a style stored in the application&#39;s workspace: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> workspace(gSession-&gt;QueryWorkspace());</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> workspaceUIDRef = ::GetUIDRef(workspace);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> deleteCmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_p_d_f_export_delete_style_cmd_boss.html">kPDFExportDeleteStyleCmdBoss</a>));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IExportStyleCmdData&gt;</a> commandData(deleteCmd, IID_IEXPORTSTYLECMDDATA);</div><div class="line"><span class="comment">// Assume i is the (to-be-deleted) style index in the style list. </span></div><div class="line">commandData-&gt;SetStyleIndex(i);</div><div class="line">commandData-&gt;SetDstList(workspaceUIDRef);</div><div class="line"><a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(deleteCmd);</div></div><p>To edit a style, use <a class="el" href="classk_p_d_f_edit_style_cmd_boss.html">kPDFEditStyleCmdBoss</a>. The following example shows how to edit a style stored in the application&#39;s workspace: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> editStyleCmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_p_d_f_edit_style_cmd_boss.html">kPDFEditStyleCmdBoss</a>));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IIntData&gt;</a> data(editStyleCmd, IID_IINTDATA);</div><div class="line"><span class="comment">// Assume index is the index of the style to be edited.</span></div><div class="line">data-&gt;Set(index);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPDFExportPrefs&gt;</a> newPrefs(editStyleCmd, IID_IPDFEXPORTPREFS );</div><div class="line"><span class="comment">// Assume myPrefs is the edited copy of IPDFExportPrefs.</span></div><div class="line">newPrefs-&gt;CopyPrefs(myPrefs);</div><div class="line"><a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(editStyleCmd);</div></div><h3><a class="anchor" id="id_frequently_asked_pdf_questions"></a> Frequently asked PDF questions</h3><p><b>How does the PDF export provider determine whether it should start the viewer after the export?</b><p>In InDesign, <a class="el" href="class_i_p_d_f_post_process_prefs.html">IPDFPostProcessPrefs</a> is used to maintain persistent PDF preference data not part of the standard <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a>. <a class="el" href="class_i_p_d_f_post_process_prefs.html">IPDFPostProcessPrefs</a> is aggregated on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and can be queried through QuerySessionPreferences. Use IPDFPostProcessPrefs::GetViewAfterExport to determine whether the viewer should be launched.<p>In InCopy, IInCopyPDFExptGalleyData::GetPDFExLaunchAcrobat (for galley) and IInCopyPDFExptLayoutData::GetPDFExLaunchAcrobat (for layout) are used to determine whether the viewer should be started.<p><b>How do I set the PDF clipboard setting as seen in the File Handling preferences?</b><p>Those settings (for example, Prefer PDF when Pasting) are kept in the <a class="el" href="class_i_p_d_f_clipboard_prefs.html">IPDFClipboardPrefs</a> aggregated on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. To modify the settings, use <a class="el" href="classk_set_p_d_f_c_b_prefs_cmd_boss.html">kSetPDFCBPrefsCmdBoss</a>.<p><b>How do I control which layer of a document should be exported?</b><p><a class="el" href="class_i_p_d_f_export_prefs.html#ad52a3598c65a6fe3191488b5d21582a6">IPDFExportPrefs::SetExportLayers</a> can be used to control the function of layers for visibility and printability. Use the enums kExportAllLayers, kExportVisibleLayers, and kExportVisiblePrintableLayers to set the export layer&#39;s preference. Each layer&#39;s visibility and printability are controlled by each layer&#39;s option, managed by <a class="el" href="class_i_document_layer.html">IDocumentLayer</a>. For more information about how to set each layer&#39;s visibility and printability, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>.<p><b>How do I make the two-page spreads in my document export as two separate PDF pages?</b><p>Set the Boolean control for reader spreads in the <a class="el" href="class_i_p_d_f_export_prefs.html">IPDFExportPrefs</a> to false. The <a class="el" href="class_i_output_pages.html">IOutputPages</a> on the <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> usually is initialized as follows: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IOutputPages&gt;</a> iExportPages(cmd, IID_IOUTPUTPAGES);</div><div class="line">iExportPages-&gt;InitializeFrom(pageUIDs, (exportPrefs-&gt;GetPDFExReaderSpreads() == IPDFExportPrefs::kExportReaderSpreadsON));</div></div><p>If the preference for the reader spreads is set to false and you set up <a class="el" href="class_i_output_pages.html">IOutputPages</a> as above, the two pages spreads are exported as separated pages in the PDF. See the example in From InDesign layout view.<p><b>Why does <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> give me an assert after the command is processed (ASSERT &#39;db != nil&#39; in PDFExportController.cpp)?</b><p>Make sure you put the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the pages in the IOutputPage interface. Also, set the item list with the pages&#39; <a class="el" href="class_u_i_d_ref.html">UIDRef</a> values (in a <a class="el" href="class_u_i_d_list.html">UIDList</a>). <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> is used for exporting both books (multiple .indd files) and multiple pages from a document. <a class="el" href="classk_p_d_f_export_cmd_boss.html">kPDFExportCmdBoss</a> first checks to see whether it has a valid <a class="el" href="class_i_output_pages.html">IOutputPages</a> and uses the database from the first <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the output pages. If the command cannot find a valid database from <a class="el" href="class_i_output_pages.html">IOutputPages</a>, it looks for it from the command item list.<p><b>How do I set up line ranges for output in InCopy Galley or Story mode?</b><p>Use IInCopyPDFExptGalleyData::SetPDFExLineRange. Pass in a <a class="el" href="class_p_m_string.html">PMString</a> with a format like &quot;3-10&quot; (that is, the beginning page number, followed by a dash, followed by the ending page number). <a class="el" href="class_i_in_copy_p_d_f_expt_galley_data.html">IInCopyPDFExptGalleyData</a> is aggregated on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>.<p><b>Is it possible to export only selected text from an InDesign document?</b><p>No. When printing or exporting to PDF, the decision to draw or not draw is made at the page-item level. This is evidenced by the &quot;Nonprinting&quot; attribute, which can be applied to a text frame but not the text itself. Similarly, draw event handlers work on the page-item level, such as the text frame.<h2><a class="anchor" id="id_epub_export"></a> EPub export</h2><p>EPub (electronic publication) is a free and open e-book standard by the International Digital Publishing Forum. EPub files have the extension .epub. EPub is designed for reflowable content, meaning that the text display can be optimized for the particular display device used by the reader of the EPub-formatted book.<p>The easiest way to export an InDesign document as an EPub file is to use the EPub export service provider. The following snippet shows how to get the EPub export provider and call the export method: <div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> EPubFormat(<span class="stringliteral">&quot;EPUB&quot;</span>);</div><div class="line">EPubFormat.SetTranslatable(kFalse);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISelectionManager&gt;</a> selection(<a class="code" href="class_utils.html">Utils&lt;ISelectionUtils&gt;</a>()-&gt;QueryActiveSelection());</div><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* frontDoc = <a class="code" href="class_utils.html">Utils&lt;ILayoutUIUtils&gt;</a>()-&gt;GetFrontDocument();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IK2ServiceRegistry&gt;</a> k2ServiceRegistry(GetExecutionContextSession(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="comment">// Look for all service providers with kExportProviderService.</span></div><div class="line">int32 exportProviderCount = k2ServiceRegistry-&gt;GetServiceProviderCount(kExportProviderService);</div><div class="line"><span class="comment">// Iterate through them.</span></div><div class="line"><span class="keywordtype">bool</span> found = kFalse;</div><div class="line"><span class="keywordflow">for</span> (int32 exportProviderIndex = 0; exportProviderIndex &lt; exportProviderCount; exportProviderIndex++){</div><div class="line"><span class="comment">// get the service provider boss class</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IK2ServiceProvider&gt;</a> k2ServiceProvider (k2ServiceRegistry-&gt;QueryNthServiceProvider(kExportProviderService, exportProviderIndex));</div><div class="line"><span class="comment">// Get the export provider implementation itself.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IExportProvider&gt;</a> exportProvider(k2ServiceProvider, IID_IEXPORTPROVIDER);</div><div class="line"><span class="comment">// Check to see if the current selection specifier can be exported by this provider.</span></div><div class="line"> bool16 canExportByTarget = exportProvider-&gt;CanExportThisFormat(frontDoc, selection, EPubFormat);</div><div class="line"><span class="keywordflow">if</span> (canExportByTarget)</div><div class="line"> {</div><div class="line"><span class="comment">// assume epubFileName is a valid IDFile to hold the soon to be created EPUB file</span></div><div class="line"> exportProvider-&gt;ExportToFile(epubfile, frontDoc, selection, EPubFormat, kFullUI);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line">}</div></div><p>In this example:<ul><li>The format name used to get the EPUB export provider is EPUB, defined at the beginning.<li>The code tells the EPUB export provider to use the full user interface during the export, meaning that the EPUB export settings dialog is opened for the user to set export options.<li>The example omits the steps that produce a valid <a class="el" href="class_i_d_file.html">IDFile</a> to be passed into the <a class="el" href="class_i_export_provider.html#a3e253076d0017a438978a94c64388010">IExportProvider::ExportToFile</a> method. Normally, the <a class="el" href="class_i_d_file.html">IDFile</a> is obtained through a standard Save File dialog box. You also can construct an <a class="el" href="class_i_d_file.html">IDFile</a> from scratch. For more information on <a class="el" href="class_i_d_file.html">IDFile</a>, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_using_adobe_file_library">Using Adobe File Library</a>.<li>The EPUB export provider for InDesign documents is represented by <a class="el" href="classk_e_book_export_provider_boss.html">kEBookExportProviderBoss</a>.</ul><p>For details, see SnpExportEPub.cpp.<h2><a class="anchor" id="id_articles"></a> Articles</h2><p>Articles provide designers and production artists with an easy way to create relationships among page items. These relationships can be used to define which content to export to ePub, HTML, or Accessible PDFs and to define the order of the content. You can create articles from a combination of existing page items within a layout, including images, graphics, or text. After an article has been created, you can add, remove, or reorder page items.<p>To operate on articles, use IArticleFacade. This facade provides methods to create and delete articles and to add articles to a document at the specified position. It also provides several useful utility methods for changing an article&#39;s name, adding page items to an article, removing page items from an article, and reordering page items in an article.<p>The <a class="el" href="class_i_article_list.html">IArticleList</a> interface on the document provides access to any particular article: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IArticleList&gt;</a> articleList(document, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>Through this interface, you can retrieve article counts, access any particular article in the document&#39;s article list, add an existing article at the specified position in the document&#39;s article list, or remove an article from the document&#39;s article list. For a complete list of APIs, refer to the API Reference for <a class="el" href="class_i_article_list.html">IArticleList</a>.<p>Given the UID of an article, you can use <a class="el" href="class_i_article_member_list.html">IArticleMemberList</a> aggregated on <a class="el" href="classk_article_boss.html">kArticleBoss</a> to access any member of the article: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IArticleMemberList&gt;</a> memberList(db, articleUID, IID_IARTICLEMEMBERLIST);</div></div><p>Through this interface, you can retrieve the number of members in the article, add a new member at the specified position in the article, or remove a member from the article. For a complete list of APIs, refer to the API Reference for <a class="el" href="class_i_article_member_list.html">IArticleMemberList</a>.<p>Group items can be added to the article as well. To reorder the group children inside an article independent of their layout hierarchy, use interface <a class="el" href="class_i_article_child_list.html">IArticleChildList</a> aggregated on <a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a>. With this interface, you can retrieve the number of direct children of the group, add a child at the specified position in the group, or remove a child from the group. All the APIs in this interface affect only the order of children inside an article; their layout hierarchy will not be affected. For a complete list of APIs, refer to the API Reference for <a class="el" href="class_i_article_child_list.html">IArticleChildList</a>.<p>The sample code in SnpManipulateArticles.cpp demonstrates the use of article APIs.<h1><a class="anchor" id="id_rich_interactive_documents"></a> Rich Interactive Documents</h1><p>InDesign provides users with tools for developing interactive content, that is, content that users can interact with as well as view. Interactive content includes animated page items, media files, and other objects whose state changes as a result of a document event such as a button click or page load. Interactive content is intended to be exported to interactive file formats such as PDF, SWF, or XFL.<p>The interactive features can be organized into the following categories: animations, timings, buttons, hyperlinks, multistate objects, and media. Each of these features is represented by a separate panel in InDesign. The combinations of these features allow complex and capable interactive documents to be created.<p>This chapter describes these capabilities and how to take advantage of these features with C++ plug-ins. This chapter assumes that you have some familiarity with the interactive features found in the Window &gt; Interactive menu in InDesign.<h2><a class="anchor" id="id_terminology"></a> Terminology</h2><ul><li>Dynamic event - Event triggers such as button click or page load that cause a single page item or a group of page items to perform a behavior.<li>Behavior - Any interactive change to the document resulting from a dynamic event.<li>Action - Behavior changes made as a result of a button event.<li>Dynamic target - The page item whose behavior is triggered as a result of a dynamic event.<li>Preset - A predefined animation.</ul><h2><a class="anchor" id="id_interactive_documents"></a> Interactive documents</h2><p>InDesign provides a feature that allows users to specify whether a document is intended to be a print document or web document when the document is created. Documents are not required to have an interactive intent to use the interactive features. The purpose of specifying the document intent is to change document defaults. Documents intended for interactive use will have their default measurement units set to pixels and their default color space set to RGB.<p>By default, the intent of a new document is for printing. This can be changed when the document is created with the <a class="el" href="class_i_new_doc_cmd_data.html">INewDocCmdData</a> interface by calling the SetIntent function and passing the kWebIntent enum value. The kWebIntent is included in the <a class="el" href="class_i_page_setup_prefs.html">IPageSetupPrefs</a> header file. <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> newDocCmd(<a class="code" href="class_utils.html">Utils&lt;IDocumentCommands&gt;</a>()-&gt;CreateNewCommand(uiflags));</div><div class="line"><span class="keywordflow">if</span> (newDocCmd == nil) {</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line">}</div><div class="line"><span class="comment">// Set the command&#39;s parameterized data.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;INewDocCmdData&gt;</a> newDocCmdData(newDocCmd, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (newDocCmdData == nil) {</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line">}</div><div class="line">newDocCmdData-&gt;SetIntent(kWebIntent);</div></div><h2><a class="anchor" id="id_animations"></a> Animations</h2><p>Page items can have a single animation applied to them, which can be triggered by a variety of events such as page load or button click. (See Timings.) Users may apply preset animations supplied in InDesign or create custom animations. InDesign includes many preset animations. These include options such as fading in page items, rotating page items, or moving page items. The preset animations may be configured with additional options such as duration or loops. If animation presets provided by default are too limited, custom animations can be imported from XML files. There is a one-to-one relationship between page items and animation settings, which means that page items can have only one animation applied to them. While the same page item animation behavior may be triggered by multiple trigger events, it is not possible to apply multiple animations to a page item that are conditionally triggered based on the trigger event.<h3><a class="anchor" id="id_ianimationattributedata"></a> IAnimationAttributeData</h3><p>This interface has been added to the <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a> to give drawable page items animation settings.<h3><a class="anchor" id="id_ianimationfacade"></a> IAnimationFacade</h3><p>This facade provides services for obtaining and modifying the animation setting for the page items, as shown in the following code excerpt from the create animated multistate object snippet: <div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> presetName = <span class="stringliteral">&quot;twirl&quot;</span>;</div><div class="line"><span class="comment">//Get the animation preset index</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IMotionPresetMgr&gt;</a> iPresetMgr (<a class="code" href="class_utils.html">Utils&lt;IMotionPresetUtils&gt;</a>()-&gt;QueryMotionPresetManager (nil));</div><div class="line">int32 presetIndex = iPresetMgr-&gt;FindPreset (presetName, <span class="keyword">false</span>);</div><div class="line"><span class="comment">//Get a UIDRef for the PresetUID </span></div><div class="line">presetUID = iPresetMgr-&gt;GetNthPresetUID (presetIndex); </div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> presetRef = <a class="code" href="class_u_i_d_ref.html">UIDRef</a> (::GetDataBase (iPresetMgr), presetUID);</div><div class="line"><span class="comment">//Set the pageitem animation preset</span></div><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IAnimationFacade &gt;</a> iAnimationFacade;</div><div class="line">result = iAnimationFacade-&gt;<a class="code" href="class_facade_1_1_i_animation_facade.html#ab9544ce1d267e479182216d7d9e6c804">SetPageItemMotionPreset</a>(pageItemRef, presetRef);</div></div><h3><a class="anchor" id="id_imotionfacade_"></a> IMotionFacade</h3><p>This fa&Atilde;&sect;ade provides services for adding, modifying, or removing preset animations. Use this facade to import custom animations defined in an XML file or to export existing animations to an XML file. The name of the preset in the preset list of the animation panel is determined by the name of the XML file. To have the custom animation preview in the animation panel, a separate SWF file must be created with the same name as the XML file defining the animation and placed in the presets/motion presets folder.<p>The following code excerpt from the create custom animation snippet shows importing from and exporting to XML files: <div class="fragment"><div class="line"><span class="comment">//Import Animation Preset from XML file </span></div><div class="line">std::vector&lt;IDFile&gt; files;</div><div class="line">files.push_back(file);<a class="code" href="class_i_d_type.html">UID</a> newPresetUID = kInvalidUID;</div><div class="line">ErrorCode err = <a class="code" href="class_utils.html">Utils&lt;Facade::IMotionFacade&gt;</a>()-&gt;LoadPresetFromFile (files, newPresetUID, <span class="keyword">false</span>); </div><div class="line"><span class="comment">//Export Animation Preset To XML File</span></div><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IMotionFacade &gt;</a> iMotionFacade;</div><div class="line">ErrorCode err = iMotionFacade-&gt;<a class="code" href="class_facade_1_1_i_motion_facade.html#a8dc010de8bd3d49899fd5d0c943a7bfb">SavePresetToFile</a>(presetRef, file);</div></div><h2><a class="anchor" id="id_multistate_objects"></a> Multistate objects</h2><p>Multistate objects provide any easy-to-use tool for toggling the visibility of multiple page items with a single button click. Multistate objects exist on the page hierarchy and act as containers for the groups within them. Both groups and individual page items can be added to them. If an individual page item is added, the multistate object places that page item inside a group. With multistate objects, groups are treated as unique states. There is not a separate state object used for storing page items. Multistate objects are not viewable. Only the page items within the object can be viewed. With multistate objects, only one state is viewable at a time. It helps to think of states as layers where only one layer is visible at one time.<p>The multistate object provides controls for toggling states. States in a multistate object can be toggled only with a button click event. Page clicks and other events do not change the current state. Button click events can be used to go to the next state, the previous state, or a specific state identified by a name or index.<p>Multistate objects require a minimum of two states. When created programmatically with fewer than two states, an empty state is added. Take this into consideration when adding states. Otherwise, these additional empty states may appear unexpectedly.<h3><a class="anchor" id="id_iappearanceitemfacade_"></a> IAppearanceItemFacade</h3><p>This fa&Atilde;&sect;ade is used to create multistate objects and buttons (see Buttons). The fa&Atilde;&sect;ade also provides functions for adding, removing, moving, and altering states contained within a multistate object. Finally, it provides functions for changing the active state. Here is a code excerpt from the CreateAnimatedMultiStateObject snippet: <div class="fragment"><div class="line"><span class="comment">//Creates a new Multi-State object and add the states to it.</span></div><div class="line"><span class="comment">//Note: the stateList is a UIDList of page item UIDRefs </span></div><div class="line"><a class="code" href="class_u_i_d_list.html">UIDList</a> outItems(msoRef);</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IAppearanceItemFacade&gt;</a> iFacade;</div><div class="line">result = iFacade-&gt;<a class="code" href="class_facade_1_1_i_appearance_item_facade.html#a8f91f79485b2bb1189c9ec9070155df5">CreateAppearanceItem</a>(stateList, <a class="code" href="classk_multi_state_object_item_boss.html">kMultiStateObjectItemBoss</a>, &amp;outItems);</div><div class="line">msoRef = outItems.GetRef(0);</div></div><h2><a class="anchor" id="id_timings"></a> Timings</h2><p>Timings are used determine when interactive behaviors assigned to page items are triggered. They can match behaviors such as animations with dynamic events. They can also organize and chain animation dependencies to each other. The following timing settings can be configured:<ul><li>Order &acirc;&#128;&#147; When multiple page items are assigned animations, the order in which animations are triggered can be adjusted. The order is a list of dependencies. Before the next behavior starts, the previous behavior must finish.<li>Groupings &acirc;&#128;&#147; These allow page items to be grouped so their animations are triggered simultaneously.<li>Delays &acirc;&#128;&#147; A period of time may be added as a delay between the trigger event execution and the animation execution.<li>Dynamic Events - Event triggers that cause a single page item or a group of page items to perform a dynamic behavior.</ul><h3><a class="anchor" id="id_dynamic_events"></a> Dynamic events</h3><p>The following dynamic events are available for the associated boss objects. When an event fires, it triggers interactive behaviors assigned to these objects or to active objects within these objects. Buttons are an exception to this rule. Buttons can trigger behaviors on outside target objects such as a multistate object or a page item.<ul><li>Spread:<ul><li>kOnPageLoad (added by default when animations are added to a page item)<li>kOnPageClick</ul><li>Multistate object:<ul><li>kOnPageLoad (the same as on state load)<li>Page items with animations applied:<li>kOnSelfClick<li>kOnSelfRollover</ul><li>Buttons:<ul><li>kOnClick<li>kOnRelease<li>kOnRollover<li>kOnRolloff</ul></ul><h3><a class="anchor" id="id_idynamiceventtimingmgr_"></a> IDynamicEventTimingMgr</h3><p>This interface has been added to the following boss classes:<ul><li><a class="el" href="classk_spread_boss.html">kSpreadBoss</a><li><a class="el" href="classk_multi_state_object_item_boss.html">kMultiStateObjectItemBoss</a><li><a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a><li><a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a><li><a class="el" href="classk_form_field_item_boss.html">kFormFieldItemBoss</a></ul><h3><a class="anchor" id="id_idynamictargetsfacade"></a> IDynamicTargetsFacade</h3><p>This fa&Atilde;&sect;ade provides services for accessing information regarding page items in dynamic documents. Here is a code excerpt from the CreateAnimatedMultiStateObject snippet: <div class="fragment"><div class="line"><span class="comment">//Remove default page load events from the spread</span></div><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IDynamicEventTimingFacade &gt;</a> iDynEvtTimingFacade;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDynamicEventTimingMgr&gt;</a> iDynEvtTimingMgr (spreadRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a> ());</div><div class="line">uint32 numTriggers = iDynEvtTimingMgr-&gt;GetNumDynamicEvents ();</div><div class="line"><span class="keywordflow">for</span>( int32 i = 0; i &lt; numTriggers; i++){</div><div class="line"> EventTriggerType trigger = iDynEvtTimingFacade-&gt;<a class="code" href="class_facade_1_1_i_dynamic_event_timing_facade.html#a7800623d022b15c8373f90b7c25a808d">GetNthDynamicEvent</a> (spreadRef, i); </div><div class="line"><span class="keywordtype">bool</span> successful = iDynEvtTimingFacade-&gt;<a class="code" href="class_facade_1_1_i_dynamic_event_timing_facade.html#a9ed98f3c00a43fe8cf80cdabb6d45a2b">RemoveDynamicEvent</a>(spreadRef, trigger); </div><div class="line"><span class="keywordflow">if</span> (!successful)</div><div class="line"><span class="keywordflow">return</span> kFailure;</div><div class="line">}</div><div class="line"><span class="comment">//Add the Page_Load Event for each state.</span></div><div class="line"><a class="code" href="class_i_animation_utils.html">IAnimationUtils</a>* animationUtils = <a class="code" href="class_utils.html">Utils&lt;IAnimationUtils&gt;</a>(); </div><div class="line"><a class="code" href="class_i_d_type.html">UID</a> parentTimingUID = animationUtils-&gt;<a class="code" href="class_i_animation_utils.html#aa7a49114f1e073b75d4fe4c75b0da077">GetTimingParentUID</a>(msoRef);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDynamicEventTimingMgr&gt;</a> iMsoTimingMgr (msoRef.GetDataBase(), parentTimingUID, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">IDynamicEventTimingMgr::DynamicTargetPtr dynamicTarget = iDynEvtTimingFacade-&gt;<a class="code" href="class_facade_1_1_i_dynamic_event_timing_facade.html#a628d10b5963206dcaa8920933185340e">CreateDynamicTarget</a>(msoRef, kOnPageLoad, kTimingTargetVerbPlay);</div><div class="line"><span class="keywordtype">bool</span> successful = iMsoTimingMgr-&gt;AddTargetInNthGroup(kOnPageLoad, dynamicTarget, -1);</div><div class="line"><span class="keywordflow">if</span> (!successful)</div><div class="line"><span class="keywordflow">return</span> kFailure; </div></div><h2><a class="anchor" id="id_media"></a> Media</h2><p>InDesign can place audio and video files within an interactive document. The following audio and video file formats are supported: MP3, AU, WAV, AIFF, SWF, MP4, F4V, FLV, and H.264-encoded MOV. In addition to playing these formats, InDesign provides the ability to modify poster images, set navigation points to specific times in the video, and customize controller skins.<h3><a class="anchor" id="id_imediautils"></a> IMediaUtils</h3><p>This utility provides tools for changing the poster image, determining whether a media file is encoded in a supported format, working with controller skins, and placing media files.<h3><a class="anchor" id="id_imediasuite"></a> IMediaSuite</h3><p>This suite contains tools for setting navigation points, changing poster images, placing media files, and setting controller skins.<h3><a class="anchor" id="id_iimportexportfacade"></a> IImportExportFacade</h3><p>This fa&Atilde;&sect;ade is not media specific. It is used to create a link to a media file and place it in a document (see the &quot;Architecture&quot; section in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_links">Links</a>). While doing so, the <a class="el" href="class_i_media_utils.html">IMediaUtils</a> functions are called to place media-specific files on the document.<p>Here is a code excerpt from the AddMediaFile snippet: <div class="fragment"><div class="line"><span class="comment">//This fa&Atilde;&sect;ade will create a link to the </span></div><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IImportExportFacade&gt;</a> iFacade; </div><div class="line">ErrorCode err = iFacade-&gt;<a class="code" href="class_facade_1_1_i_import_export_facade.html#a0f5b8350f08d0b2cd800f522317ae0fd">ImportAndLoadPlaceGun</a>(</div><div class="line"> documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>(), </div><div class="line"> uri, </div><div class="line"> kSuppressUI, </div><div class="line"> kTrue <span class="comment">//retainFormat, </span></div><div class="line"> kTrue <span class="comment">//convertQuotes,</span></div><div class="line"> kTrue <span class="comment">//applyCJKGrid, </span></div><div class="line"> kTrue <span class="comment">//useClippingFrame, </span></div><div class="line"><a class="code" href="class_i_place_gun.html#a7c2a4a9029bec52f00a4a6c0f570bc22a05eb9ae6117720506771810013bb69f4">IPlaceGun::kAddToBack</a> <span class="comment">//location</span></div><div class="line">);</div><div class="line"><a class="code" href="class_u_i_d_list.html">UIDList</a> replaceList;</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a> * db = documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPlaceGun&gt;</a> placeGun(documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>(), documentUIDRef.<a class="code" href="class_u_i_d_ref.html#aa035f24fae248a54e7b74ab8b63f18bc">GetDataBase</a>()-&gt;<a class="code" href="class_i_data_base.html#a7fe2aa8e012510c2dfe26c8427ce5b5a">GetRootUID</a>(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">err = iFacade-&gt;<a class="code" href="class_facade_1_1_i_import_export_facade.html#a0bc3fb4f7b838766cf91651771c5b927">ReplacePageItem</a>(db , pageItemUIDRef.GetUID(), placeGun-&gt;GetFirstPlaceGunItemUID(), kFalse, replaceList ) ; </div></div><h2><a class="anchor" id="id_buttons"></a> Buttons</h2><p>Buttons in InDesign are one way to trigger interactive events. Buttons are the only objects that can trigger behaviors on other page items. Behaviors triggered by button events include page transitions, state transitions, playing animations and more. Button events can have multiple actions assigned to them, allowing a single button event to trigger multiple behaviors. Buttons in InDesign do not have a required preset appearance. They are created by converting existing page items to buttons. See <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_import_and_export">Import and Export</a> for more information about exporting interactive PDF files.<p>Here is a code excerpt from the ExportDynamicDocuments snippet: <div class="fragment"><div class="line"><span class="comment">//Convert spline item into a button. </span></div><div class="line"><a class="code" href="class_u_i_d_list.html">UIDList</a> buttonUIDs(splineItemUIDs.GetDataBase());</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IAppearanceItemFacade&gt;</a> iFacade;</div><div class="line">ErrorCode result = iFacade-&gt;CreateAppearanceItem(splineItemUIDs, <a class="code" href="classk_push_button_item_boss.html">kPushButtonItemBoss</a>, &amp;buttonUIDs);</div></div><h2><a class="anchor" id="id_exporting_rich_interactive_documents_to_files"></a> Exporting rich interactive documents to files</h2><p>InDesign documents can store interactive behaviors but they are not intended for displaying these behaviors. Interactive documents can be exported to file formats, such as XFL, SWF, and interactive PDF, that fully utilize these features. The supported export formats each have a unique export preferences interface such as <a class="el" href="class_i_s_w_f_export_preferences.html">ISWFExportPreferences</a> or <a class="el" href="class_i_x_f_l_export_preferences.html">IXFLExportPreferences</a>.<p>An export is shown in the following code excerpt from the export dynamic documents snippet: <div class="fragment"><div class="line"><span class="comment">// Create the SWF export action command</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> swfExportCmd(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_s_w_f_export_command_boss.html">kSWFExportCommandBoss</a>));</div><div class="line"><span class="keywordflow">if</span> (swfExportCmd == nil) { </div><div class="line"><span class="keywordflow">return</span> kFailure; </div><div class="line">}</div><div class="line"><span class="comment">// Set cmd data </span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDynamicDocumentsExportCommandData&gt;</a> dynamicDocsCmdData(swfExportCmd, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">dynamicDocsCmdData-&gt;SetStream(outStream);</div><div class="line">dynamicDocsCmdData-&gt;SetUIFlags(kSuppressUI);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISWFExportPreferences&gt;</a> swfCmdData(swfExportCmd, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> iAppWS(GetExecutionContextSession()-&gt;QueryWorkspace());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISWFExportPreferences&gt;</a> iSWFExportPrefs(iAppWS, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">swfCmdData-&gt;Copy(iSWFExportPrefs);</div><div class="line"><span class="comment">// process the command</span></div><div class="line"><span class="keywordflow">return</span> <a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(swfExportCmd);</div></div><h1><a class="anchor" id="id_links"></a> Links</h1><p>This chapter describes the InDesign link architecture.<h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>A link establishes a relationship between a link object, such as a page item, and a link resource, such as an external graphic file. When you place an image in an InDesign document, a link is created between the image file and the page item that contains the image. The link acts as a bridge between a source (the resource) and a destination InDesign object (the object). A link object is not limited to a page item; it can be an XML element, swatch, style set, chunk of text, and so on.<h2><a class="anchor" id="id_architecture"></a> Architecture</h2><h3><a class="anchor" id="id_types_of_links"></a> Types of links</h3><p>InDesign supports three types of links:<ul><li>Import-only link - Represented by <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>, this maintains an import association between an object and a linked resource. If the linked resource changes, the object can be updated through an import operation.<li>Export-only link - Represented by <a class="el" href="classk_export_link_boss.html">kExportLinkBoss</a>, this maintains an export association between an object and a linked resource. If the object changes, the linked resource asset can be updated through an export operation.<li>Bi-directional link - Represented by <a class="el" href="classk_bidirectional_link_boss.html">kBidirectionalLinkBoss</a>, this maintains a bi-directional association between an object and a linked resource. A bi-directional link requires conflict-resolution when both the object and the linked asset change.</ul><dl class="section note"><dt>Note<dd>One more type, a child link, is represented by <a class="el" href="classk_child_link_boss.html">kChildLinkBoss</a>. This allows an InDesign publication that contains links to be placed in another document. In this case, the links in the placed document become child links. You cannot update a child link directly; you must open the original document to update the links it contains.</dl><p>A link is created and maintained by <a class="el" href="class_i_link_manager.html">ILinkManager</a>. The <a class="el" href="class_i_link_manager.html#ae251d4dff0df5d672cb17e0b729fe6a1">ILinkManager::CreateLink</a> methods create a link between a given link object and linked resource.<h3><a class="anchor" id="id_the_ilink_interface"></a> The ILink interface</h3><p>All three link boss classes aggregate a key interface, <a class="el" href="class_i_link.html">ILink</a>, which establishes a relationship between a link resource and a link object.<ul><li>A link resource is represented by <a class="el" href="classk_link_resource_boss.html">kLinkResourceBoss</a>, which aggregates the <a class="el" href="class_i_link_resource.html">ILinkResource</a> interface. <a class="el" href="class_i_link_resource.html">ILinkResource</a> methods access and maintain a linked resource.<li>A link object can be any boss object that aggregates the <a class="el" href="class_i_link_object.html">ILinkObject</a> interface.<li>There is an <a class="el" href="class_i_link_manager.html">ILinkManager</a> that manages linked resources and links</ul><p>The following figure shows the relationship between a linked resource and linked object.<div class="image"><img alt="plugin-programming-guide-vol2-29.gif" src="plugin-programming-guide-vol2-29.gif" /></div><p>The <a class="el" href="class_i_link.html">ILink</a> interface defines Get/SetResource to access the associated link resource and GetObject/SetObject are used to access the associated link object. In these functions, a UID is used to identify the link resource or link object.<p><a class="el" href="class_i_link.html">ILink</a> defines import and export policies.<p>The ImportPolicy enumeration denotes the policy that specifies when to automatically update the link object via an import when the resource is marked as modified:<ul><li>kNoAutoImport - Never automatically update the object.<li>kImportOnModify - Update the object via an import when the resource is marked as modified.</ul><p>Use Get/SetImportPolicy to access the import policy.<p>The ResourceModificationState enumeration denotes the modification state of the linked resource, and Get/SetResourceModificationState are used to access the state.<p>The ExportPolicy enumeration denotes the policy used to specify when to automatically update the link resource via an export, when the object is marked as modified:<ul><li>kNoAutoExport - Never automatically export to the resource.<li>kExportOnModify - Update the resource via an export when the object is marked as modified.<li>kExportOnClose - Update the resource via an export on close.<li>kExportOnSave - Update the resource via an export on save.</ul><p>Use Get/SetExportPolicy to access the export policy.<p>The ObjectModificationState enumeration denotes the modification state of the linked object, and Get/SetResourceModificationState are used to access the state.<p><a class="el" href="class_i_link.html">ILink</a> has many other settings to customize the link, such as Get/SetCanEmbed, Get/SetCanPackage, and Get/SetShowInUI.<h3><a class="anchor" id="id_linked_resource_and_ilinkresourcehandler"></a> Linked resource and ILinkResourceHandler</h3><p>The most common link resources are desktop files. However, InDesign link architecture supports generalized, abstract links: it allows data to come from a file, URL, database record, or any external or internal source that can be read or written via a stream.<p>A linked resource is referenced by a <a class="el" href="class_u_r_i.html">URI</a>. According to the <a class="el" href="class_u_r_i.html">URI</a> specification, a <a class="el" href="class_u_r_i.html">URI</a> consists of a hierarchical sequence of five components, referred to as the scheme, authority, path, query, and fragment.<p>There is an InDesign class, <a class="el" href="class_u_r_i.html">URI</a>, which can be used to construct and parse a well formed <a class="el" href="class_u_r_i.html">URI</a>. The link architecture classifies link resources based on the link resource&#39;s scheme from its <a class="el" href="class_u_r_i.html">URI</a>. All link resources of the same type must share the same scheme in their URIs. There should be a link-resource handler (represented by <a class="el" href="class_i_link_resource_handler.html">ILinkResourceHandler</a>) for each type of scheme available in InDesign. For example, most traditional InDesign datalinks are file-based links; that is, the link is between a page item and an external file established though a &quot;Place&quot; action. The link resources for these type of links are the external file, and all their URIs have the scheme of &quot;file&quot;; that is, their URIs all look like &quot;file://path_to_file&quot;. During import (through Place), a resource handler that knows how to handle URIs with a &quot;file&quot; scheme is used to create a resource read stream, and the stream is given to an import provider that knows how to handle the particular file format to import the resource.<p>What makes up a resource handler? A resource handler aggregates the <a class="el" href="class_i_link_resource_handler.html">ILinkResourceHandler</a> interface and is implemented by a generic InDesign boss class. The convention to invoke a resource handler is through a service-provider boss that supports the kLinkResourceService service ID. In this service-provider boss, an <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a> should be aggregated. The <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a> indicates what kind of <a class="el" href="class_u_r_i.html">URI</a> scheme the resource handler can handle through its GetSchemes method, and <a class="el" href="class_i_link_resource_factory.html#a669053ea31a6799d1148315a31eace37">ILinkResourceFactory::QueryHandler</a> returns an instance of the handler upon request, based on a <a class="el" href="class_u_r_i.html">URI</a>. For example, the CustomDataLink SDK sample allows you to place assets specified in a CSV file. Since only CustomDataLink knows how data is stored in the CSV file, it must implement a resource handler for assets from the CSV. CustomDataLink defines its own <a class="el" href="class_u_r_i.html">URI</a> that can uniquely identify any asset in the CSV. CustomDataLink&#39;s resource handler knows how to retrieve data from the CSV based on the <a class="el" href="class_u_r_i.html">URI</a>. The <a class="el" href="class_u_r_i.html">URI</a> defined in CustomDataLink has its own scheme, CSVLink, and its <a class="el" href="class_u_r_i.html">URI</a> looks something like this: <div class="fragment"><div class="line">CSVLink:<span class="comment">//csv_fullpath?recordID</span></div></div><p>The resource handler in CustomDataLink declares it knows how to handle resources whose <a class="el" href="class_u_r_i.html">URI</a> scheme is CSVLink. When CustomDataLink&#39;s client asks to place a resource from the CSV, CustomDataLink processes a kImportAndLoadPlaceGunCmdBoss by giving the command a <a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a> that consists of an <a class="el" href="class_u_r_i.html">URI</a> to the resource client specified. kImportAndLoadPlaceGunCmdBoss does all the ground work for an import action; when it comes time to import the real resource, it sends the <a class="el" href="class_u_r_i.html">URI</a> to the link manager. The link manager queries all the service providers that support kLinkResourceService, to see if anyone can handle a <a class="el" href="class_u_r_i.html">URI</a> scheme of CSVLink. Since CustomDataLink implements one, it is chosen to import the data from the <a class="el" href="class_u_r_i.html">URI</a>. The CustomDataLink&#39;s implementation of <a class="el" href="class_i_link_resource_handler.html">ILinkResourceHandler</a> defines methods like CreateResourceReadStream(), which returns an <a class="el" href="class_i_p_m_stream.html">IPMStream</a> to the resource to which the selected CSV record points. Since CustomDataLink knows how to access the CSV, given its own <a class="el" href="class_u_r_i.html">URI</a>, it knows exactly what record its client is requesting and handles the request.<p>The following table lists the <a class="el" href="class_u_r_i.html">URI</a> schemes handled by a default InDesign resource handler.<table class="doxtable"><tr><th>Scheme </th><th>Purpose </th></tr><tr><td>file </td><td>Used when InDesign Place... is used to import file </td></tr><tr><td>adobevc </td><td>For handling assets from Version Cue. </td></tr><tr><td>ADBEapli </td><td>Used in assignment link </td></tr></table><p>If you provide you own resource handler, you should implement your own Place dialog and add it under your own Place menu.<h3><a class="anchor" id="id_the_ilinkresourcefactory_interface"></a> The ILinkResourceFactory Interface</h3><p>This factory class is used to provide a list of schemes supported by a link resource handler, and to create instances of a link resource handler. Include this interface on the link resource provider boss that is registered with the service registry as a kLinkResourceService.<p><a class="el" href="class_i_link_resource_factory.html#a7fabae16faec2165df46203e2fa10386">ILinkResourceFactory::GetSchemes</a> returns the list of <a class="el" href="class_u_r_i.html">URI</a> schemes supported by the handler. <a class="el" href="class_i_link_resource_factory.html#a669053ea31a6799d1148315a31eace37">ILinkResourceFactory::QueryHandler</a> returns the link resource handler that will be used by a link resource object to act on an resource whose <a class="el" href="class_u_r_i.html">URI</a> scheme matches one of the supported schemes. <a class="el" href="class_i_link_resource_factory.html#aa71bc539f9bf4d991edd57e9de92bb51">ILinkResourceFactory::QueryStateUpdater</a> returns the link resource state updater that will be used to obtain and update the state of a link resource whose <a class="el" href="class_u_r_i.html">URI</a> scheme matches one of the supported schemes.<p>Both Custom Data Link and Extended Link SDK samples show usage of <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a>.<h3><a class="anchor" id="id_link_object"></a> Link object</h3><p>A link object is any boss that aggregates the <a class="el" href="class_i_link_object.html">ILinkObject</a> interface. <a class="el" href="class_i_link_object.html">ILinkObject</a> is a proxy used to represent the item in an InDesign publication being linked to; for example, a page item, XML element, or range of text. Depending on the type of link associated with the item, <a class="el" href="class_i_link_object.html">ILinkObject</a> specifies how the item is imported, exported, or resolved. A link (<a class="el" href="class_i_link.html">ILink</a>) stores the UID of the link object with which it is associated, and the link object can be retrieved from the <a class="el" href="class_i_link.html#a828519e341ed632ae52440284aa472e5">ILink::GetObject()</a> method. Normally, if your link object is a regular page item, it has an <a class="el" href="class_i_link_object.html">ILinkObject</a> with kPageItemLinkObjectImpl as its default implementation. kPageItemLinkObjectImpl specifies <a class="el" href="classk_page_item_update_link_service_provider_boss.html">kPageItemUpdateLinkServiceProviderBoss</a> as its import provider. When the link needs an update, <a class="el" href="classk_page_item_update_link_service_provider_boss.html">kPageItemUpdateLinkServiceProviderBoss</a> is used to update the link. Internally, <a class="el" href="classk_page_item_update_link_service_provider_boss.html">kPageItemUpdateLinkServiceProviderBoss</a>&#39;s <a class="el" href="class_i_update_link_service.html">IUpdateLinkService</a> implementation (kPageItemUpdateLinkServiceImpl) processes a kReimportCmdBoss to update the link. Eventually, kReimportCmdBoss uses the link resource&#39;s resource handler to provide a data stream to the resource, just like the initial Place.<p>The following table lists the InDesign bosses that aggregates an <a class="el" href="class_i_link_object.html">ILinkObject</a> by default.<table class="doxtable"><tr><th>Boss name </th><th>Note </th></tr><tr><td><a class="el" href="classk_doc_boss.html">kDocBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_media_page_item_boss.html">kMediaPageItemBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_display_list_page_item_boss.html">kDisplayListPageItemBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_x_m_l_link_object_reference_boss.html">kXMLLinkObjectReferenceBoss</a></td><td>kXMLElementLinkObjectImpl </td></tr><tr><td>kTestSplineItemBoss </td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_s_p_place_holder_page_item_boss.html">kSPPlaceHolderPageItemBoss</a></td><td>kPageItemLinkObjectImpl </td></tr><tr><td><a class="el" href="classk_book_content_boss.html">kBookContentBoss</a></td><td>kBookLinkObjectImpl </td></tr></table><dl class="section note"><dt>Note<dd><a class="el" href="classk_j_b_x_link_object_boss.html">kJBXLinkObjectBoss</a> also has kJBXLinkObjectImpl.</dl><p>If you are trying to create a link on an object not listed in the table, make sure you aggregate <a class="el" href="class_i_link_object.html">ILinkObject</a> to the object&#39;s boss. The SDK sample ExtendedLink illustrates this situation, where a link object is derived from <a class="el" href="classk_x_m_l_link_object_reference_boss.html">kXMLLinkObjectReferenceBoss</a>.<h3><a class="anchor" id="id_link_manager"></a> Link manager</h3><p>There is a link manager, represented by <a class="el" href="class_i_link_manager.html">ILinkManager</a>, in every InDesign document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). <a class="el" href="class_i_link_manager.html">ILinkManager</a> is used to create and delete links and link resources. <a class="el" href="class_i_link_manager.html">ILinkManager</a> also provides many ways to query links and link resources.<p>There should be one, and only one, <a class="el" href="class_i_link_manager.html">ILinkManager</a> per InDesign database. However, different flavors of links can be differentiated by the LinkClientID. For example, InDesign placed links all have a client identifier of kIDLinkClientID, and hyperlinks have a client id of kHyperlinkLinkClientID. Both flavors of links are managed by the same manager, but the manager prevents links and resources with different client ids from interacting with each other. Therefore, a link with a client id of kIDLinkClientID cannot link a resource with a client id of kHyperlinkLinkClientID. The client ids can also be utilized to control where and how the links and resources are displayed to the user. For example, the Links Panel only shows links and resources with a client id of kIDLinkClientID; hyperlinks have their own UI.<p>Most operations provided by the manager, with the exception of queries, should be initiated from the ILinkFacade.<p>To query links through <a class="el" href="class_i_link_manager.html">ILinkManager</a>, first you should construct a <a class="el" href="class_link_query.html">LinkQuery</a> object. <a class="el" href="class_link_query.html">LinkQuery</a> is a class that allows you to easily specify what you want the <a class="el" href="class_i_link_manager.html">ILinkManager</a> to search for and pass the <a class="el" href="class_link_query.html">LinkQuery</a> object to the <a class="el" href="class_i_link_manager.html#ac8091611e1403d28c6c3c645da612d96">ILinkManager::QueryLinks</a> method. <a class="el" href="class_i_link_manager.html">ILinkManager</a> returns the query result in a <a class="el" href="class_i_link_manager.html#a7832797b6029605b68290df734d22969">ILinkManager::QueryResult</a>, which is a std::vector that contains the UID of the links. Once you have the UID of a link, you can query its <a class="el" href="class_i_link.html">ILink</a> interface.<p><a class="el" href="class_i_link_manager.html">ILinkManager</a> also uses the link client ID as a filter when it returns the <a class="el" href="class_link_query.html">LinkQuery</a> result. If you specify a client ID, <a class="el" href="class_i_link_manager.html#ac8091611e1403d28c6c3c645da612d96">ILinkManager::QueryLinks</a> returns the link with the same client ID. This is convenient if you used a unique client ID to identify your link and link resource: you can easily query all your links with an empty <a class="el" href="class_link_query.html">LinkQuery</a> and your client ID.<p>To query a link resource through <a class="el" href="class_i_link_manager.html">ILinkManager</a>, construct a <a class="el" href="class_link_resource_query.html">LinkResourceQuery</a> object. <a class="el" href="class_link_resource_query.html">LinkResourceQuery</a> is similar to <a class="el" href="class_link_query.html">LinkQuery</a>, in that it allows you to specify the criteria (such as resource <a class="el" href="class_u_r_i.html">URI</a> scheme) to look for when <a class="el" href="class_i_link_manager.html">ILinkManager</a> searches for a link resource in a document. Once you construct a <a class="el" href="class_link_resource_query.html">LinkResourceQuery</a>, you then pass it to <a class="el" href="class_i_link_manager.html#a29399cd869d7e88ff62b268a2ea8cdd8">ILinkManager::QueryResources</a> for the query. <a class="el" href="class_i_link_manager.html">ILinkManager</a> also returns the query result in a <a class="el" href="class_i_link_manager.html#a7832797b6029605b68290df734d22969">ILinkManager::QueryResult</a>.<p>For example, to get links from a page item, Use <a class="el" href="class_i_link_manager.html#a24095d19965a3a5411d02d61c46feca1">ILinkManager::QueryLinksByObjectUID</a> to get to <a class="el" href="class_i_link.html">ILink</a>. It returns the result in an <a class="el" href="class_i_link_manager.html#a7832797b6029605b68290df734d22969">ILinkManager::QueryResult</a>, which is a UID vector that holds the <a class="el" href="class_i_link.html">ILink</a> UID. <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> childHierarchy(frameHierarchy-&gt;QueryChild(0));</div><div class="line"><span class="comment">// If we&#39;re on a placed image we should have a data link to source item</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILinkObject&gt;</a> iLinkObject(childHierarchy,<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="comment">// get the link for this object</span></div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* iDataBase = ::GetDataBase(childHierarchy);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILinkManager&gt;</a> iLinkManager(iDataBase,iDataBase-&gt;<a class="code" href="class_i_data_base.html#a7fe2aa8e012510c2dfe26c8427ce5b5a">GetRootUID</a>(),<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_i_link_manager.html#a7832797b6029605b68290df734d22969">ILinkManager::QueryResult</a> linkQueryResult;</div><div class="line"><span class="keywordflow">if</span> (iLinkManager-&gt;QueryLinksByObjectUID(::GetUID(childHierarchy), linkQueryResult)){</div><div class="line"> ASSERT_MSG(linkQueryResult.size()==1,<span class="stringliteral">&quot;Only expecting single link with this object&quot;</span>);</div><div class="line"> ILinkManager::QueryResult::const_iterator iter = linkQueryResult.begin();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILink&gt;</a> iLink (iDataBase, *iter,<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (iLink!=nil) {</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ILinkResource&gt;</a> iLinkResource(iLinkManager-&gt;QueryResourceByUID(iLink-&gt;GetResource()));</div><div class="line"> ASSERT_MSG(iLinkResource,<span class="stringliteral">&quot;CHMLFiltHelper::addGraphicFrameDescription - Link with no associated asset?&quot;</span>);</div><div class="line"><span class="keywordflow">if</span>(iLinkResource!=nil)</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> datalinkPath = iLinkResource-&gt;GetLongName();</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_link_status"></a> Link status</h3><p>For every link resource handler made available in the link architecture through the kLinkResourceService service provider, you should provide an implementation of <a class="el" href="class_i_link_resource_state_updater.html">ILinkResourceStateUpdater</a>, which provides the link manager with link-resource status information. There are times when link manager will ask each link resource to provide a status update; for example, when the application resumes from background to foreground. <a class="el" href="class_i_link_manager.html">ILinkManager</a> calls <a class="el" href="class_i_link_resource_state_updater.html#a50205de8720b3687d31119fa71466da9">ILinkResourceStateUpdater::UpdateResourceStateAsync</a>. <a class="el" href="class_i_link_resource_state_updater.html">ILinkResourceStateUpdater</a> should be aggregated on the boss where <a class="el" href="class_i_link_resource_handler.html">ILinkResourceHandler</a> is aggregated. In Linked resource and ILinkResourceHandler, we discuss how <a class="el" href="class_i_link_resource_handler.html">ILinkResourceHandler</a> normally is instantiated through the <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a>. <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a> has a method called QueryStateUpdater, which is used to instantiate a status updater for the <a class="el" href="class_u_r_i.html">URI</a> scheme supported by the same <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a>.<p><a class="el" href="class_i_link_manager.html">ILinkManager</a> may call for a link-resource status report synchronously or asynchronously, depending on the situation; therefore <a class="el" href="class_i_link_resource_state_updater.html">ILinkResourceStateUpdater</a> declares two update methods: UpdateResourceStateSync and UpdateResourceStateAsync. In UpdateResourceStateSync, the status update should be completed on the return of the function. In UpdateResourceStateAsync, it is expected that status update is done in the background or during idle time.<p>Both <a class="el" href="class_i_link_resource_state_updater.html#ae465e9dacb600be3fb5d1c1dcd04acc9">ILinkResourceStateUpdater::UpdateResourceStateSync</a> and <a class="el" href="class_i_link_resource_state_updater.html#a50205de8720b3687d31119fa71466da9">ILinkResourceStateUpdater::UpdateResourceStateAsync</a> are passed in an <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of a link resource (<a class="el" href="classk_link_resource_boss.html">kLinkResourceBoss</a>). <a class="el" href="class_i_link_resource.html">ILinkResource</a> stores resource-status information like resource state (<a class="el" href="class_i_link_resource.html#a9dc4fd5c1194cc056346e0f6b9869174">ILinkResource::ResourceState</a>), modification time, and size.<p>Also, there is a &quot;stamp&quot; (of type ResourceStamp, which is essentially a <a class="el" href="class_wide_string.html">WideString</a>) stored in <a class="el" href="class_i_link_resource.html">ILinkResource</a>. You can use the ResourceStamp to construct any custom stamp you need for status-update purposes. <a class="el" href="class_i_link_resource.html">ILinkResource</a> has declared get/set methods for maintaining these resource attributes.<p>In UpdateResourceStateSync/UpdateResourceStateAsync, a comparison should be made between the link-resource object passed in and the external link resource (available from the <a class="el" href="class_u_r_i.html">URI</a>, which can be queried through the link-resource object). If you decide the link is out of date, a <a class="el" href="classk_link_resource_state_update_cmd_boss.html">kLinkResourceStateUpdateCmdBoss</a> should be processed. This causes the link resource to be updated with the new status data. The corresponding link (<a class="el" href="class_i_link.html">ILink</a>) also maintains a linked-resource modification state, which is set to <a class="el" href="class_i_link.html#af2d640f13738cef81c168e75252c3336a4ed9cf32032fad8d1972c76a87801d96">ILink::kResourceModified</a>, indicating the link resource was modified since the last update. If the link is displayed in the Links UI panel, the status shows it is out of date, and the Update Link option becomes available; this allows the user to manually update the link on demand.<dl class="section note"><dt>Note<dd>Each <a class="el" href="class_i_link_resource_state_updater.html">ILinkResourceStateUpdater</a> implementation may have its own policy to decide what should be regarded as a status change. For example, InDesign&#39;s <a class="el" href="class_i_link_resource_state_updater.html">ILinkResourceStateUpdater</a> for <a class="el" href="class_u_r_i.html">URI</a> scheme &quot;file&quot; uses the file&#39;s modification date and file size as its criteria.</dl><p>There are several approaches you can take to accomplish link-state updates. For example, Version Cue links are updating via a push approach. Version Cue notifies InDesign whenever the state of a Version Cue link changes. File links use a pull approach to update link states, by getting current information from the file system. The SDK ExtLink sample uses an idle-task-based solution. It is important to consider the case where there are many links in a document. When the link architecture asks for a link-status update, it asks all links to provide updates; therefore, the performance issue is critical and deserves a good implementation strategy.<h3><a class="anchor" id="id_link_update"></a> Link update</h3><p>When a link status is outdated, a link-update action becomes available. If the link information is available on the Links UI panel, a contextual-menu item, Update Link, is enabled when a link is selected in the panel. When the Update Link menu action is selected on an import link, <a class="el" href="classk_link_update_cmd_boss.html">kLinkUpdateCmdBoss</a> is processed; this queries the <a class="el" href="class_i_link.html">ILink</a> on the <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a> and calls its <a class="el" href="class_i_link.html#a5970e5de39b9b27a90638d525eda702c">ILink::Update()</a> method. Inside the <a class="el" href="class_i_link.html#a5970e5de39b9b27a90638d525eda702c">ILink::Update()</a>, it queries its associated link object (<a class="el" href="class_i_link_object.html">ILinkObject</a>) to see if there is an import provider available for the link object through the <a class="el" href="class_i_link_object.html#a1be4b833140d1f256eea0762320ec216">ILinkObject::GetImportProvider()</a>. If there is one, that import provider is used to reimport the link resource; otherwise, <a class="el" href="class_i_link_object.html#af9b3173ede1e294922ab47d32839484d">ILinkObject::Import()</a> is called. In <a class="el" href="class_i_link_object.html#a1be4b833140d1f256eea0762320ec216">ILinkObject::GetImportProvider()</a>, you can specify a update-link service-provider boss that implements <a class="el" href="class_i_update_link_service.html">IUpdateLinkService</a> or kInvalidClass. In the later case, you should then implement <a class="el" href="class_i_link_object.html#af9b3173ede1e294922ab47d32839484d">ILinkObject::Import</a>. For example, if the link object is a kPageItemLinkObjectImpl, it defines an <a class="el" href="classk_page_item_update_link_service_provider_boss.html">kPageItemUpdateLinkServiceProviderBoss</a> in its GetImportProvider, which is used to update the link. <a class="el" href="classk_page_item_update_link_service_provider_boss.html">kPageItemUpdateLinkServiceProviderBoss</a> processes a kReimportCmdBoss, which asks the link-resource handler to create a read stream from the resource for import purposes.<p>What if your link object is not a page-item type, or you do not want to (or cannot) use kReimportCmdBoss to update your link? In these cases, you must implement your own link object that will use your own <a class="el" href="class_i_update_link_service.html">IUpdateLinkService</a> or <a class="el" href="class_i_link_object.html#af9b3173ede1e294922ab47d32839484d">ILinkObject::Import</a>.<h3><a class="anchor" id="id_link_notification"></a> Link Notification</h3><p>When a link or link resource is added, deleted, or changed, a lazy notification is sent on the protocol of IID_ILINK or IID_ILINKRESOURCE (depending on what was changed). The UID of the link or link resource is sent in the notification via the notification cookie, <a class="el" href="class_lazy_notification_data.html">LazyNotificationData</a>. Using <a class="el" href="class_list_lazy_notification_data.html#ad9ed7c1d1b022c6b4dadc866410ae19d">ListLazyNotificationData::BreakoutChanges</a>, you can determine which items (UIDs) were added, deleted, or changed.<p>There is another lazy notification sent via the IID_ILINKDATA_CHANGED protocol. This occurs not only when a link or link resource is added, deleted, or changed, but also when a link&#39;s link resource is changed. The notification cookie is passed in a type called <a class="el" href="class_i_link_manager_1_1_change_data.html">ILinkManager::ChangeData</a>, a wrapper of UID, which tells you what kind of UID is referenced.<p>You need not send any links-related notification from your plug-in-the links manager takes care of that.<h3><a class="anchor" id="id_the_ilinkfacade_interface"></a> The ILinkFacade Interface</h3><p>ILinkFacade is a high-level API for dealing with links, link resources, and link objects. It has methods to create, delete, update, and relink a link. Also, it has methods to create link resources and update resource state. Use ILinkFacade whenever possible.<p>For example, to update links, use ILinkFacade::UpdateLinks, which processes (or schedules) a <a class="el" href="classk_link_update_cmd_boss.html">kLinkUpdateCmdBoss</a>. You need to pass in the UID of a <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>.<h3><a class="anchor" id="id_links_panel_extensibility"></a> Links panel extensibility</h3><p>You can add your own column into the Links panel (through a service-provider boss with kLinkInfoServiceImpl as <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) and provide your own <a class="el" href="class_i_link_info_provider.html">ILinkInfoProvider</a> implementation. The column will be available in the Links panel&#39;s option dialog for the user to turn on or off. Providing an <a class="el" href="class_i_link_info_provider.html">ILinkInfoProvider</a> implementation can be as easy as providing static information, or you can indicate that the information needs to be updated dynamically based on certain protocol&#39;s notification. You can elect to listen to any command-notification protocol in <a class="el" href="class_i_link_info_provider.html">ILinkInfoProvider</a> and update your information when the command notifies your subscribed protocol. For a simple <a class="el" href="class_i_link_info_provider.html">ILinkInfoProvider</a> implementation, see the CustomDataLink sample in the SDK.<h2><a class="anchor" id="id_file-based_links"></a> File-based Links</h2><p>When you place a graphic file in an InDesign publication, InDesign does not include the graphic file in the publication. Instead, it creates a page item to host the graphic object and establishes a link between the page item and the graphic file. What you see on screen is a low-resolution proxy image of the graphic. A link helps InDesign avoid redundantly storing large amounts of data in the publication, and it enables us to automatically update page items when the external file is modified.<p>To see the link information associated with the page item, you need to display the Links UI panel. If the current selected page item has an associated link, its link information is highlighted in the Links UI panel. The link information includes where the linked file comes from and the link&#39;s status.<p>When a user uses the default InDesign menu item File &gt; Place, the InDesign File Chooser dialog appears, and when the user selects a file from the InDesign Place dialog, kImportAndLoadPlaceGunCmdBoss is processed. kImportAndLoadPlaceGunCmdBoss requires its client to set up a command data-interface <a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a>. <a class="el" href="class_i_import_resource_cmd_data.html">IImportResourceCmdData</a> can store the UID of a link resource or a <a class="el" href="class_u_r_i.html">URI</a> (Uniform Resource Identifier) that is a reference to the link resource. The <a class="el" href="class_u_r_i.html">URI</a> is used in a kImportResourceCmdBoss to create a link resource from an <a class="el" href="class_u_r_i.html">URI</a>. Internally, kImportResourceCmdBoss calls ILinkFacade::CreateResource to create the link resource from an <a class="el" href="class_u_r_i.html">URI</a>, which in turn uses <a class="el" href="classk_link_resource_create_cmd_boss.html">kLinkResourceCreateCmdBoss</a>. Finally, <a class="el" href="class_i_link_manager.html#a18785b753a8c17638f38e35dc5f6febc">ILinkManager::CreateResource()</a> is used to create the resource (<a class="el" href="classk_link_resource_boss.html">kLinkResourceBoss</a>) using the InDesign link client ID.<dl class="section note"><dt>Note<dd>A link client ID identifies a link client, You should use the same link client ID when creating the link resource and the link. If you use kIDLinkClientID, the link shows up in the Links UI panel. If you do not want to have your links in the Links UI panel, use an ID other than kIDLinkClientID when you create the link and link resource.</dl><p>The <a class="el" href="class_i_link_manager.html">ILinkManager</a> will query a resource handler based on the <a class="el" href="class_u_r_i.html">URI</a>&#39;s scheme. The first resource handler that knows how to handle (import, export, and resolve) the particular <a class="el" href="class_u_r_i.html">URI</a> scheme is used to import the resource. The resource handler is asked to supply a resource&#39;s read stream, and it is given to an import provider that knows how to import the particular file format. Once the file is imported, a series of checks is performed to determine if a link is wanted before a link is created. For example, by default, a text file always is embedded, not linked, unless it is an Adobe InCopy file. The following figure illustrate the sequence of how the link and link resource are created during the processing of a kImportAndLoadPlaceGunCmdBoss.<div class="image"><img alt="plugin-programming-guide-vol2-30.gif" src="plugin-programming-guide-vol2-30.gif" /></div><h2><a class="anchor" id="id_linked_stories"></a> Linked Stories</h2><p>Linked stories make it easier to manage multiple versions of the same story or text content in the same document; it makes it easier to support emerging digital publishing workflows, where, for example, you need to design for both vertical and horizontal layouts. Linked stories behave similarly to traditional links. You can designate a story as a parent and then place the same story at other places in the document as child stories. Whenever the parent story is updated, the child stories are flagged in the Links panel and can can be updated to synchronize with the parent story.<p>To create link for shared stories, use facade ISharedContentFacade. <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::ISharedContentFacade&gt;</a>()-&gt;CreateSharedContentLink(<a class="code" href="class_u_i_d_list.html">UIDList</a>(sourceTextFrameRef), sourceTextFrameRef.<a class="code" href="class_u_i_d_list.html#ad55cbff9dd30705377412d5e9f9ab8aa">GetDataBase</a>(), kSuppressUI);</div></div><p>ISharedContentFacade provides other functions to operate on shared content links including:<ul><li>Checking whether the given link is a shared content link.<li>Checking whether the given link resouce is a shared content link resource.<li>Checking whether the given link object is a shared content link object.<li>Retrieving the <a class="el" href="class_i_link.html">ILink</a> <a class="el" href="class_u_i_d_ref.html">UIDRef</a> for the given link object.<li>Retrieving the link object and link resource for the given <a class="el" href="class_i_link.html">ILink</a> <a class="el" href="class_u_i_d_ref.html">UIDRef</a>.</ul><p>For the complete APIs, refer to the API Reference for ISharedContentFacade.<p>An ASB class <a class="el" href="class_i_shared_content_suite.html">ISharedContentSuite</a> is also provided for creating shared stories for the selected text frames.<h2><a class="anchor" id="id_support_your_own_links"></a> Support Your Own Links</h2><p>To provide your own type of links support, you should implement a resource-handler boss that aggregates an <a class="el" href="class_i_link_resource_handler.html">ILinkResourceHandler</a> and <a class="el" href="class_i_link_resource_state_updater.html">ILinkResourceStateUpdater</a>, and provide a <a class="el" href="class_i_link_resource_factory.html">ILinkResourceFactory</a> to instantiate the handler on demand, as described in the following procedure.<ol type="1"><li>Define how your resource can be represented by a <a class="el" href="class_u_r_i.html">URI</a>. You will need your own <a class="el" href="class_u_r_i.html">URI</a> scheme to identify the type of resource for which you will provide support. Here are two examples of URIs; &quot;CSVLink&quot; and &quot;odbc&quot; are schemas of each <a class="el" href="class_u_r_i.html">URI</a>: <div class="fragment"><div class="line">CSVLink:<span class="comment">//fullpath_to_alias-database-1.csv?recordID odbc://MySQL/?table%3Dinventory%26sku%3D%27AB-223%27#description</span></div></div><li>Implement a link-resource handler that knows how to import the type of resource you defined in your <a class="el" href="class_u_r_i.html">URI</a>. Link-resource handlers are identified by the <a class="el" href="class_u_r_i.html">URI</a> scheme. Here is a typical link-resource- handler boss: <div class="fragment"><div class="line">Class {</div><div class="line"> kMyLinkResourceHandlerBoss,</div><div class="line"> kInvalidClass, {</div><div class="line"> IID_ILINKRESOURCEHANDLER, kMyLinkResourceHandlerImpl,</div><div class="line"> IID_ILINKRESOURCESTATEUPDATER, kMyLinkResourceStateUpdaterImpl,</div><div class="line"> }</div><div class="line">}</div></div><li>Provide a link-resource state-updater service provider that reports back to the link manager the current state of a link resource.<li>Register the link-resource handler. This requires a service provider. <div class="fragment"><div class="line">Class {</div><div class="line"> kMyResourceProviderBoss,</div><div class="line"> kInvalidClass, {</div><div class="line"> IID_IK2SERVICEPROVIDER, kLinkResourceServiceImpl,</div><div class="line"> IID_ILINKRESOURCEFACTORY, kMyLinkResourceFactoryImpl,</div><div class="line"> }</div><div class="line">}</div></div> Schemes are registered with <a class="el" href="class_i_link_resource_factory.html#a7fabae16faec2165df46203e2fa10386">ILinkResourceFactory::GetSchemes()</a>: <div class="fragment"><div class="line"><span class="keywordtype">void</span> MyLinkResourceFactory::GetSchemes( <a class="code" href="class_k2_vector.html">K2Vector&lt;WideString&gt;</a>&amp; schemes )<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="class_wide_string.html">WideString</a> myScheme1(<span class="stringliteral">&quot;myscheme1&quot;</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="class_wide_string.html">WideString</a> myScheme2(<span class="stringliteral">&quot;myscheme2&quot;</span>);</div><div class="line"> schemes.clear();</div><div class="line"> schemes.push_back(myScheme1);</div><div class="line"> schemes.push_back(myScheme2);</div><div class="line">}</div></div></ol><p>The link-resource handler and state-updater are returned by <a class="el" href="class_i_link_resource_factory.html#a669053ea31a6799d1148315a31eace37">ILinkResourceFactory::QueryHandler</a> and <a class="el" href="class_i_link_resource_factory.html#aa71bc539f9bf4d991edd57e9de92bb51">ILinkResourceFactory::QueryStateUpdater</a>, respectively.<p>Both the Custom Data Link and Extended Link SDK samples show the above procedure.<p>If you want to programmatically define conditional links, here is an suggestion. Suppose you have an image with both low-resolution and high-resolution versions. You want to have the ability to define a link to alternate images, depending on whether the high-resolution image is available. The easiest way to achieve this workflow is to define a custom <a class="el" href="class_u_r_i.html">URI</a> that has paths to both images. The <a class="el" href="class_u_r_i.html">URI</a> is opaque, the links subsystem cares about only the scheme part of the <a class="el" href="class_u_r_i.html">URI</a>, and each scheme is tied to a link-resource handler. In your link resource, you must parse the <a class="el" href="class_u_r_i.html">URI</a> to get the paths to both versions of the image (link resources). Then, you also will build the logic for determining when to use each image in the link resource (and the link-resource state updater). For example, you might have a flag in the database for each high-resolution image, to indicate if it is ready to publish. In your link-resource handler, you would check that flag, to see if you should import the low- or high-resolution image.<h1><a class="anchor" id="id_implementing_preflight_rules"></a> Implementing Preflight Rules</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>This chapter provides high-level information for developers who want to build their own rules or set of rules. It complements the low-level information found in the SDK.<h2><a class="anchor" id="id_about_preflight"></a> About preflight</h2><p>InDesign includes a fully rule-driven, parameterized, continuous preflight that can run in the background as you work.<p>The preflight model comprises several major areas, most of which are fully extensible by external developers. Very little preflight code is written using private interfaces.<ul><li>The preflight object model is a parallel view of the InDesign document and things that do not appear in the document. It has references to both standard InDesign objects like page items and documents and to nonpersistent entities like marking operations. The object model is fully extensible to support new objects.<li>Preflight rule services are where objects are checked for compliance with a set of parameters. A rule provides discovery, visitation, and reporting functions to the preflight engine.<li>Preflight processes are idle-task-driven in-memory objects which coordinate all interactions between the object model and the rule services. Processes also can be driven synchronously if desired, but normally they run in the background. The processes are not extensible, but developers have full access to their status and database.</ul><p>This chapter is concerned only with the rule services, which are the most common type of extension.<h2><a class="anchor" id="id_about_rules"></a> About rules</h2><p>In the preflight model, rules are the entities that check conditions in the document and generate errors. An example of a rule is &quot;Missing and Modified Graphics,&quot; which looks for graphics that are missing or outdated.<p>To write a rule, you need two things:<ul><li>The rule boss encapsulates both the intelligence and data for a rule.<li>The rule service tells InDesign that your rule exists and lets it create a boss for a rule. A rule service can &quot;host&quot; as many rules as desired; the native InDesign rule service hosts dozens of rules.</ul><h2><a class="anchor" id="id_rule_ids"></a> Rule IDs</h2><p>Each unique rule (for example, missing fonts or image resolution) is identified by a rule ID. A rule ID is simply a <a class="el" href="class_wide_string.html">WideString</a> that is never exposed in the user interface but serves to distinguish it from every other rule out there. For each rule you implement, you need to devise a unique rule ID. For example, you could prefix your rule ID with your company name or use a GUID converted to a string. Rule IDs are exposed to scripting.<h2><a class="anchor" id="id_rule_service"></a> Rule service</h2><p>A rule service is implemented as a standard InDesign service with the service ID kPreflightRuleService. On the service boss, you need the IID_IK2SERVICEPROVIDER (you can use kPreflightRuleSPImpl for the implementation) and an <a class="el" href="class_i_preflight_rule_service.html">IPreflightRuleService</a>. The latter interface has two methods, shown in the following table.<table class="doxtable"><tr><th>Method </th><th>Purpose </th></tr><tr><td>GetAllRules </td><td>Returns a vector of rule IDs that your services hosts. </td></tr><tr><td>CreateRule </td><td>Given a rule ID that you host, creates a rule boss and returns it. </td></tr></table><p>In other words, this interface provides a map and boss factory for rule bosses. Most of the complexity is in the rule bosses themselves.<p>CreateRule can be called on when InDesign is creating new preflight profiles or, in some cases, for purely temporary purposes. For example, it might create a rule just to get some information about it, then destroy it. It takes a database pointer to indicate whether it wants the boss to be created in a document (or preferences) or in memory for temporary purposes.<h3><a class="anchor" id="id_ipreflightruleservice_example"></a> IPreflightRuleService example</h3><p>To illustrate a typical rule-service implementation, here are some sample method implementations. In this example, there are two rules, Maximum Text Size and Maximum Rectangle Size.<p><b><a class="el" href="class_i_preflight_rule_service.html#a94bc67bb424555b0309059c586d7b17b">IPreflightRuleService::GetAllRules</a></b><p>The first step is to create rule IDs for these rules; typically, we&#39;ll also need rule bosses. If XYZCo company is developing the rules, we might use the mapping shown in the following table.<table class="doxtable"><tr><th>Rule </th><th>Rule ID </th><th>Boss </th></tr><tr><td>Maximum text size </td><td>XYZCo_MaxTextSize </td><td>kMaxTextSizeRuleBoss </td></tr><tr><td>Maximum rectangle size </td><td>XYZCo_MaxRectSize </td><td>kMaxRectSizeRuleBoss </td></tr></table><p>The GetAllRules method must return a vector of rule IDs. This is not complicated: <div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="class_wide_string.html">PreflightRuleID</a> kMaxTextSizeRuleID(<span class="stringliteral">&quot;XYZCo_MaxTextSize&quot;</span>);</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_wide_string.html">PreflightRuleID</a> kMaxRectSizeRuleID(<span class="stringliteral">&quot;XYZCo_MaxRectSize&quot;</span>);</div><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_k2_vector.html">PreflightRuleIDVector</a> GetAllRules()<span class="keyword"> const</span>{ </div><div class="line"><a class="code" href="class_k2_vector.html">PreflightRuleIDVector</a> rules;</div><div class="line"> rules.push_back(kMaxTextSizeRuleID);</div><div class="line"> rules.push_back(kMaxRectSizeRuleID);</div><div class="line"><span class="keywordflow">return</span> rules;</div><div class="line">}</div></div><p>This method usually will be called only once per session, by the rule manager, which then holds onto the information in its internal maps.<p><b><a class="el" href="class_i_preflight_rule_service.html#abbd2cdc9b44589f22b4fc844eccbad2f">IPreflightRuleService::CreateRule</a></b><p>This method creates the appropriate boss from a passed-in rule ID and fills in defaults. In our example, we would do something like the following. (For ease of reading, most error handling is omitted.) <div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_i_preflight_rule_info.html">IPreflightRuleInfo</a>* CreateRule </div><div class="line">(</div><div class="line"><span class="comment">// Rule to create </span></div><div class="line"><a class="code" href="class_wide_string.html">PreflightRuleID</a> ruleID,</div><div class="line"><span class="comment">// Database in which to create it (nil = in memory) </span></div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* db </div><div class="line"> )<span class="keyword"> const</span>{ </div><div class="line"><a class="code" href="class_i_d_type.html">ClassID</a> bossID = 0; </div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> desc;</div><div class="line"><span class="keywordflow">if</span> (ruleID == kMaxTextSizeRuleID) </div><div class="line"> { </div><div class="line"> bossID = kMaxTextSizeRuleBoss; </div><div class="line"> desc = <a class="code" href="class_p_m_string.html">PMString</a>(<span class="stringliteral">&quot;Maximum text size&quot;</span>); </div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (ruleID == kMaxTextSizeRuleID) </div><div class="line"> { </div><div class="line"> bossID = kMaxRectSizeRuleBoss; </div><div class="line"> desc = <a class="code" href="class_p_m_string.html">PMString</a>(<span class="stringliteral">&quot;Maximum rectangle size&quot;</span>); </div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span></div><div class="line"><span class="keywordflow">return</span> nil;</div><div class="line"><a class="code" href="class_i_preflight_rule_info.html">IPreflightRuleInfo</a>* iRule = (<a class="code" href="class_i_preflight_rule_info.html">IPreflightRuleInfo</a>*)CreateObject (db, bossID, IID_IPREFLIGHTRULEINFO);</div><div class="line"> iRule-&gt;<a class="code" href="class_i_preflight_rule_info.html#a40e52cdd32a62654b162b62be4229956">SetRuleID</a>(ruleID); </div><div class="line"> iRule-&gt;<a class="code" href="class_i_preflight_rule_info.html#a3900df4ef3b7811f40f9e2d036352444">SetRuleDescription</a>(desc); </div><div class="line"> iRule-&gt;<a class="code" href="class_i_preflight_rule_info.html#ac5a02baf33e85ec4b7fd569ab459a6e5">SetPluginDescription</a>(<span class="stringliteral">&quot;XYZCo Rules Plugin&quot;</span>);</div><div class="line"><span class="comment">// Set up default parameter values. </span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightRuleUtilities&gt;</a> iUtils(iRule, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"> iUtils-&gt;UpdateRuleData();</div><div class="line"><span class="keywordflow">return</span> iRule;</div><div class="line">}</div></div><p>It is up to you what strategy to use for initialization, mapping rule IDs to bosses and descriptions, and so on. If you have only a few rules, the method above should suffice.<h2><a class="anchor" id="id_rule_bosses"></a> Rule bosses</h2><p>A rule boss is where all the heavy lifting goes on in the preflight world. A rule boss corresponds to a particular rule and encapsulates all the behaviors of that rule, including the following:<ul><li>Parameter data - For example, if your rule looks for things larger than X, and the user can specify X, X is a rule parameter.<li>User interface - This is the interface used to modify your rule parameters.<li>Evaluation - Your rule is a visitor. The preflight engine &quot;carries it around&quot; to objects it wants to visit, and the rule must determine if the object is alright or has an error.<li>Aggregation - Once your rule finishes gathering errors, it must determine how to present the errors to the user.<li>Utilities - If your rule has any special requirements when copied or deleted, it needs to provide those implementations.</ul><p>As shown in the previous example, each rule your plug-in supports typically has its own boss. Each rule boss must have the interfaces shown in the following table. You can add whatever other interfaces you want on your rule bosses.<table class="doxtable"><tr><th>Interface </th><th>Purpose </th></tr><tr><td><a class="el" href="class_i_preflight_rule_data.html">IPreflightRuleData</a></td><td>Stores the rule parameter data as a dictionary (key-value pairs). Use kPreflightRuleDataImpl unless you have a really good reason not to do so. </td></tr><tr><td><a class="el" href="class_i_preflight_rule_visitor.html">IPreflightRuleVisitor</a></td><td>Provides all the evaluation and aggregation functions. This interface tells InDesign what kinds of objects the rule wants to visit (page items, styles, artwork, etc.), is called back when it is time to visit one of those objects, and is called back when it is time to aggregate (create final report of findings). Also, it provides some parameter initialization and validation methods. </td></tr><tr><td><a class="el" href="class_i_preflight_rule_utilities.html">IPreflightRuleUtilities</a></td><td>Provides rule-specific utilities for your rule, including copying the rule, any special deletion requirements, and determining equality with other rules. In most cases, you can use the default kPreflightRuleUtilitiesImpl implementation. </td></tr></table><p>These interfaces are documented in the headers and doc++ comments, but the <a class="el" href="class_i_preflight_rule_visitor.html">IPreflightRuleVisitor</a> interface is critical, so we expand on it below.<h3><a class="anchor" id="id_ipreflightrulevisitor_interface"></a> IPreflightRuleVisitor interface</h3><p>The <a class="el" href="class_i_preflight_rule_visitor.html">IPreflightRuleVisitor</a> interface has three methods related to rule evaluation, shown in the following table.<table class="doxtable"><tr><th>Method </th><th>Description </th></tr><tr><td>GetClassesToVisit </td><td>Preflight calls this method, generally on start-up, when it builds its maps relating rules to objects. It must return a vector of preflight object class IDs that your rule wants to visit. For example, if you want to visit all images, you would return a vector containing kPreflightOM_Image. </td></tr><tr><td>Visit </td><td>Preflight calls this method when it is time to evaluate a given object, either because it was not visited before or something was changed such that the result might be different. This method is passed an abstract utility class that your method uses to obtain information and report its findings. </td></tr><tr><td>AggregateResults </td><td>Preflight calls this method after the first pass (visitation) is complete and the Visit method found something it might want to report. This method takes the &quot;raw&quot; results found during visitation into final presentation, in the form of nodes in the results tree. This method typically consolidates multiple errors into a single node, builds strings, and so on. </td></tr></table><p>The <a class="el" href="class_i_preflight_rule_visitor.html">IPreflightRuleVisitor</a> interface also has two methods related to rule-parameter initialization and validation, shown in the following table. (These could be on another interface but since every rule needs to implement them, there is less overhead to include them on this interface, since every rule needs its own <a class="el" href="class_i_preflight_rule_visitor.html">IPreflightRuleVisitor</a>.)<table class="doxtable"><tr><th>Method </th><th>Description </th></tr><tr><td>UpdateRuleData </td><td>Preflight calls this method at start-up (for application profiles) and document open time (for document embedded profiles), to give the rule an opportunity to initialize and/or update the rule parameters. </td></tr><tr><td>ValidateRuleData </td><td>Preflight calls this method when a parameter is set via scripting, to ensure it is a legitimate value. </td></tr></table><h2><a class="anchor" id="id_ipreflightrulevisitor_method_examples"></a> IPreflightRuleVisitor method examples</h2><p>The methods in this interface concentrate on the discovery, visitation, and aggregation phases of the preflight process. This is the trickiest interface to write.<h3><a class="anchor" id=""></a></h3><p>This method simply tells InDesign what object classes your rule wants to visit. For example the missing-fonts rule looks at text runs (to see directly which fonts are used and where), as well as placed content that has required-font data, namely placed EPS, EPS, and INDD files. Its implementation looks like the following: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="code" href="class_k2_vector.html">PreflightObjectClassIDVector</a> GetClassesToVisit()<span class="keyword"> const</span>{ </div><div class="line"><a class="code" href="class_k2_vector.html">PreflightObjectClassIDVector</a> classes; </div><div class="line"> classes.push_back(kPreflightOM_WaxRun); </div><div class="line"> classes.push_back(kPreflightOM_EPS); </div><div class="line"> classes.push_back(kPreflightOM_PDF); </div><div class="line"> classes.push_back(kPreflightOM_INDD); </div><div class="line"><span class="keywordflow">return</span> classes;</div><div class="line">}</div></div><p>Do not declare classes in which you are not actually interested. The preflight engine expands only those portions of the model required to satisfy the rules in the profile, If you ask for artwork, for instance, you will take a big hit in processing cycles; do this only if it is needed.<h3><a class="anchor" id=""></a></h3><p>This is the method in which your rule inspects objects it asked to visit. Typically, this method consists of comparing attributes of the object against rule parameters.<p>The argument for this method is a <a class="el" href="class_i_preflight_visit_info.html">IPreflightVisitInfo</a> interface, which provides all the information you should need about the object being visited. It also provides the mechanism for reporting the errors. The following table lists the methods in this interface.<table class="doxtable"><tr><th>Method </th><th>Purpose </th></tr><tr><td>QueryOptions </td><td>Gets the <a class="el" href="class_i_preflight_options.html">IPreflightOptions</a> interface for the current process. Not typically used, but sometimes rules want to know the options. </td></tr><tr><td>GetObjectID </td><td>Gets the <a class="el" href="class_preflight_object_i_d.html">PreflightObjectID</a> of the thing being visited. Typically, this is used to get the ClassID of that object, if your rule looks at multiple object types. </td></tr><tr><td>QueryObject </td><td>Obtains the <a class="el" href="class_i_preflight_object.html">IPreflightObject</a> interface for the object being visited. This is used in nearly every rule, because it lets you ask questions about the object. </td></tr><tr><td>CreateResultRecord </td><td>Creates a result record; that is, records a problem (or potential problem) with this node. Usually, this is an error indication, but not necessarily; you might use this to count instances of something and have an error only if it finds more than a certain number. </td></tr></table><p>Here is an example of a Visit implementation, the page-count rule. (To enhance readability, most error checking, like nil interfaces, is omitted.) <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Visit(<a class="code" href="class_i_preflight_visit_info.html">IPreflightVisitInfo</a>* iVisit)<span class="keyword"> override</span>{</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightObject&gt;</a> iObj(iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#aeb297c3bb6c47af1aaf696fe4c7f9c88">QueryObject</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> iDoc(iObj-&gt;GetModelRef(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPageList&gt;</a> iDocPages(iDoc, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> int32 count = iDocPages-&gt;GetPageCount();</div><div class="line"><a class="code" href="class_preflight_rule_data_helper.html">PreflightRuleDataHelper</a> dh(<span class="keyword">this</span>);</div><div class="line"> ComparisonType comp = (ComparisonType)dh.GetIntParam (kParamCountComparisonType);</div><div class="line"> int32 value = dh.GetIntParam(kParamCountComparisonValue);</div><div class="line"> int32 value2 = dh.GetIntParam(kParamCountComparisonValue2); </div><div class="line"> bool32 fails = kFalse;</div><div class="line"><span class="keywordflow">switch</span>(comp)</div><div class="line"> { </div><div class="line"><span class="keywordflow">case</span> kComparison_EqualTo: </div><div class="line"> fails = (count != value); </div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kComparison_Minimum: </div><div class="line"> fails = (count &lt; value); </div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kComparison_Maximum: </div><div class="line"> fails = (count &gt; value); </div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kComparison_MultipleOf: </div><div class="line"> fails = value &gt; 1 &amp;&amp; (count % value != 0); </div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kComparison_Between: </div><div class="line"> fails = (count &lt; value &acirc;&#148;&#130;&acirc;&#148;&#130; count &gt; value2); </div><div class="line"><span class="keywordflow">break</span>; </div><div class="line"> }</div><div class="line"><span class="keywordflow">if</span> (fails) </div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultRecord&gt;</a> iRec </div><div class="line"> (iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#ae702df30e3ed49b453f7838c03f473c9">CreateResultRecord</a>()); </div><div class="line"> iRec-&gt;SetCriteria(kPreflightRC_Default); </div><div class="line"> iRec-&gt;AddValue(count);</div><div class="line"> }</div><div class="line">}</div></div><p>In this case, the rule is looking only at the document object, so it does not need to check for the class ID of the object that is passed in. The first thing it does is as follows: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightObject&gt;</a> iObj(iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#aeb297c3bb6c47af1aaf696fe4c7f9c88">QueryObject</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> iDoc(iObj-&gt;GetModelRef(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>Since the object in question is the document, it has a model mapping, so iObj-&gt;GetModelRef() produces the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the document. Not all objects have a model mapping. You need to do things that are unique to the kind of object you are looking at, even if in general those things fall into general categories.<p>The rest of the implementation simply compares the number of pages against the rule parameter, using the rule&#39;s comparison type (also a rule parameter). If it fails, then it does the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultRecord&gt;</a> iRec (iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#ae702df30e3ed49b453f7838c03f473c9">CreateResultRecord</a>()); </div><div class="line">iRec-&gt;SetCriteria(kPreflightRC_Default); iRec-&gt;AddValue(count);</div></div><p>This code creates a result record, which is simply a small data structure that records what the rule tells it to, and attaches it in the process database (a nonpersistent database) to the node representing the object (in this case, the document). This record can be produced later (along with all other records the rule created as it inspected objects), in the results-aggregation method. In this example, there is only one object, the document, but in a case where you are inspecting page items or marking operations, there could be dozens or hundreds.<p>After the result record is created, the rule sets the criteria to kPreflightRC_Default. This is the value used by rules that do not need to break down errors into different categories (or at least not at the time it is finding the errors).<p>Finally, consider the case where the rule is adding a value to the record. The meaning of this value and the use of the value vector are completely up to the rule; however, when the rule is inspecting the object, it may make complex decisions or get calculated values that are inconvenient to repeat when results are aggregated. For example, a marking operation that looks at stroke width will record the stroke width it found, because it does not want to have to look it up again later. More examples of this are later in this section.<p>The following table shows the contents of a results record.<table class="doxtable"><tr><th>Field </th><th>Uses </th></tr><tr><td>Object ID </td><td>The <a class="el" href="class_preflight_object_i_d.html">PreflightObjectID</a> of the entity to which the record refers. This always is the object to which the record was attached. </td></tr><tr><td>Subparts </td><td>A vector of subpart IDs. Normally, this is set up by one of the aggregation utilities during the aggregation phase, but a rule also may specify a subpart, if that is useful. </td></tr><tr><td>Values </td><td>A vector of PMReals. Normally, this is a width, height, or other quantity you want to record for this instance. For example, you can record the width of a stroke you found. The aggregation utilities also use this information when combining multiple records together. </td></tr><tr><td>Criteria </td><td>This can be used to differentiate different kinds of failure. This field also is used by the aggregation utilities to simplify the process of generating results. An example is the image-resolution rule, which has different criteria for each image type and min/max failure. This means that the aggregation method does not have to determine what the image type was again. </td></tr><tr><td>Aux String </td><td>This is just string data that the rule can use as it wishes. For example, the font-type rule records the font name here. This allows it to build results easily, because the aggregation utilities can sort by this value. </td></tr><tr><td>Process Node </td><td>If this record was created by <a class="el" href="class_i_preflight_visit_info.html#ae702df30e3ed49b453f7838c03f473c9">IPreflightVisitInfo::CreateResultRecord</a>, it has the process node ID recorded here. This is useful if you want to look at the result relative to other objects in the tree. The aggregation utilities use this to determine the relationship between artwork and containing objects. </td></tr></table><h3><a class="anchor" id=""></a></h3><p>This method is where your rule takes the results (specifically, the result records) found in the Visit phase and produces nodes in the aggregated results tree. In other words, the input is the array of result records; for example:<ul><li>Stroke on object X is 0.1 pt<li>Stroke on object Y is 0.1 pt</ul><p>The output is a hierarchy of preflight aggregated result nodes; for example:<ul><li>Strokes are too small<li>Object X<li>Object Y</ul><p>This example is simple. In the general case, especially with artwork, the raw results can be numerous, with many grouped under the same object (for example, the same PDF).<p>The tree contains several different kinds of nodes:<ul><li>Category nodes are added by the preflight engine and represent the rule categories; for example, Document, Links, and Text. These nodes are created automatically by preflight, based on the categories the rule services declare and place the rules in.<li>Criteria nodes are used to group failing objects together under the common failure type. For example, &quot;Strokes are too small&quot; is a criteria, under which you would put the violations of that rule (Object X and Object Y, in the above example).<li>Violation nodes are individual failures of a rule. In the example above, &quot;Object X&quot; and &quot;Object Y&quot; are violation nodes.<li>Criteria/violation nodes are nodes that are both criteria and violation, because there is only a single object or single failure for that rule. Typically, this means it is a document-level error, like number of pages.</ul><p>Each node has a short string that appears in the tree-view widget in the preflight panel and long-form strings that appear in the Info section. In both cases, these strings also appear in the preflight report.<p>Mapping the raw preflight result records to the tree hierarchy can be complex, because each rule usually has its own strategy for reducing the complexity of the results presentation. The preflight API allows the rules to do this any way they like, but it supports those mechanisms with utilities that reduce the line count. All these utilities are in <a class="el" href="class_i_preflight_aggregated_results_utils.html">IPreflightAggregatedResultsUtils</a>.<p>The recommended sequence of events in the AggregateResults method is as follows. The code assumes a declaration with the following arguments: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> AggregateResults </div><div class="line"> (</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_i_preflight_process.html">IPreflightProcess</a>* iProcess,</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_k2_vector.html">IPreflightProcess::NodeIDVector</a>&amp; resultNodes,</div><div class="line"><a class="code" href="class_i_preflight_aggregated_results.html">IPreflightAggregatedResults</a>* iResults, </div><div class="line"> IPreflightAggregatedResults::NodeID parentID </div><div class="line"> ) <span class="keyword">const</span></div></div><p>The first two parameters can be thought of as the inputs to the aggregation process; that is, the nodes in the process database corresponding to the raw results found during the Visit. The last two parameters can be thought of as the outputs: iResults is the artwork-tree interface you would use to add nodes, and parentID is the node in that tree under which you should add your nodes as children.<p>All utilities in the <a class="el" href="class_i_preflight_aggregated_results_utils.html">IPreflightAggregatedResultsUtils</a> work on preflight result records, collecting them in tables (<a class="el" href="class_i_preflight_result_record_table.html">IPreflightResultRecordTable</a>) for most operations. A <a class="el" href="class_i_preflight_result_record_table.html">IPreflightResultRecordTable</a> is simply a vector of ref-counted record pointers, so dividing a table into subtables is a fairly quick operation; therefore, most of the utilities transform one table of results into another, at which point those results are copied into the aggregated results tree.<p>Typical steps in aggregation are as follows:<ol type="1"><li>Get the raw table of results - All the rule&#39;s result records are extracted from the process database, to get an initial, raw, unprocessed table.<li>Apply standard aggregations - Records are combined in the table using standard combination techniques, such as localizing artwork to the page items that contain it and combining contiguous text runs. Improves the usability of the results and can dramatically reduce the size of the results.<li>Combine records into buckets - Once the record list is reduced by standard aggregations, there are various ways of grouping results together. In some cases, multiple records map to one result node; in others, result nodes are grouped together.<li>Generate result nodes - To make a result node, all required strings are generated and added to the result node; then, the result node is inserted into the tree.</ol><p><b>Get the raw table of results</b><p>The first step in aggregation is getting the initial table of results by collecting them from the process-database result nodes. Unless you have a good reason otherwise, use <a class="el" href="class_i_preflight_aggregated_results_utils.html#a5ef17a81bfe87009fdc7dc474a258f50">IPreflightAggregatedResultsUtils::CreateTableFromNodes</a> for this step: <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;IPreflightAggregatedResultsUtils&gt;</a> iUtils;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;const IPreflightResultRecordTable&gt;</a> iRawTable( iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#a5ef17a81bfe87009fdc7dc474a258f50">CreateTableFromNodes</a>(iProcess, resultNodes));</div></div><p>The raw table now contains all the results added by your iVisit-&gt;CreateResultRecord() calls.<p><b>Apply standard aggregations</b><p>The usual next step is aggregating all results together using &quot;standard&quot; aggregations, using <a class="el" href="class_i_preflight_aggregated_results_utils.html#ac9365c06e0e7b9e1b6a00c3aa95ff14f">IPreflightAggregatedResultsUtils::ApplyAllStandardAggregations</a>: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;const IPreflightResultRecordTable&gt;</a> iTable( iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#ac9365c06e0e7b9e1b6a00c3aa95ff14f">ApplyAllStandardAggregations</a>(iProcess, iRawTable));</div></div><p>The standard aggregations utilities aggregate the following:<ul><li>All records corresponding to marking operations. These are aggregated into the containing object (shape, text run, table cell, etc.) that contains them. The subpart is determined automatically. Only those records with the same subpart and criteria are aggregated together. Thus, you are left with &quot;high level&quot; objects that can be selected, rather than artwork, which cannot.<li>Text runs that share the same criteria, subpart, and value. These are aggregated into a larger text range.<li>Records that share the same criteria and values, but different subparts. These are aggregated together. This is done last.</ul><p>You do not need to call ApplyAllStandardAggregations. You do not need to make this call if your rule looks at only one object or does not look at objects that would ever be aggregated, or you simply do not want to do any standard aggregation. You also can use any of the &quot;lesser&quot; aggregation utilities, which do only one kind of aggregation, not all of them.<p><b>Combine records into buckets</b><p>After standard aggregation, the nodes are more or less ready to go into the tree; however, depending on your rule&#39;s desired presentation, you may want to put them in buckets. The native InDesign rules put records into buckets in two ways<ul><li>Single node represents multiple violation records. For example, the image-resolution rule can fail in multiple ways on the same object; in particular, when the images come from a PDF, EPS, or INDD file. Rather than creating a node for each failure, there is a single node for the PDF/EPS/INDD, and all failures are enumerated within that node&#39;s information text.<li>Nodes grouped under a rule or criteria - If you just add violation nodes under parentID, typically they appear as children of a category, which usually is not desirable. (The exception is nodes that can involve only one object, like the document object; these should share both the criteria and violation in a single node.) Rather, you want a criteria node, which describes the error, with the individual violations of that error added as children of the criteria.</ul><p>Several methods in <a class="el" href="class_i_preflight_aggregated_results_utils.html">IPreflightAggregatedResultsUtils</a> are useful for putting nodes into buckets. Some of these are shown in the following.<table class="doxtable"><tr><th>Method </th><th>Purpose/use </th></tr><tr><td>CreateSubTable </td><td>Use this when you have manually determined how to divide entries and want to create a new table containing just those entries (for example, for passing to your shared node-building subroutine). </td></tr><tr><td>CreateSubTableByCriteria </td><td>Use this to put all records under a common criteria node. This method creates a table with only the matching criteria, so you know all entries share that criteria. </td></tr><tr><td>CreateTablesByCriteriaCreateTablesByAuxString </td><td>Use this to group entries under the same criteria or aux strings, and might have quite a few different criteria (or in the case of strings, you probably don&#39;t know ahead of time how many strings to expect). This method gives you a vector of tables, each sharing entries of the same criteria or string. You can then iterate over the vector and pass each to a common formatting utility. </td></tr><tr><td>CreateTablesByObject </td><td>Use this to ensure that an object appears in only one node. If there are multiple criteria/subparts under that object, you just want to add more information strings. For example, this how the stroke-width rule works. </td></tr></table><p>You can use several of these together. For example, you could create tables by criteria, then for each of those tables, create tables by object. Remember, tables are lightweight and ref counted, so there is no record copying when creating subtables. Thus, you can use these utilities to your advantage, without worrying too much about overhead.<p>As an example, the colorspace rule&#39;s aggregation method looks like this: <div class="fragment"><div class="line"><span class="comment">// We only want one entry per object, so divide the table into multiple tables,</span></div><div class="line"><span class="comment">// one per common object.</span></div><div class="line"><a class="code" href="class_k2_vector.html">IPreflightAggregatedResultsUtils::VectorOfTables</a> byObject;</div><div class="line">iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#aae98b2e7ee4da2061c28d25c04e9a761">CreateTablesByObject</a>(iTable, byObject);</div><div class="line">int32 i, n;</div><div class="line"><span class="keywordflow">for</span>(i = 0; i &lt; byObject.size(); i++){ </div><div class="line"><span class="comment">// Create a violation node for this object; then for each record just </span></div><div class="line"><span class="comment">// add strings corresponding to that record. </span></div><div class="line"><a class="code" href="class_i_preflight_result_record_table.html">IPreflightResultRecordTable</a>* iObjTable = byObject[i];</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;const IPreflightResultRecord&gt;</a> iRec( iObjTable-&gt;<a class="code" href="class_i_preflight_result_record_table.html#a565e0749c9e543e0f03ca146feec3a0d">QueryNthRecord</a>(0));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultNodeInfo&gt;</a> iNode( iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#accf549e1066cc28f030912db8f77d701">CreateViolationNode</a>(iRec-&gt;GetObjectID()));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultNodeData&gt;</a> iData(iNode, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldRequired, sRequirement);</div><div class="line"><span class="comment">// For each subpart create its own Problem line.</span></div><div class="line"><span class="keywordflow">for</span>(n = 0; n &lt; iObjTable-&gt;<a class="code" href="class_i_preflight_result_record_table.html#a9bf84304a18f2011fa4ce581eb050cc4">GetRecordCount</a>(); n++)</div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;const IPreflightResultRecord&gt;</a> iRec( </div><div class="line"> ObjTable-&gt;QueryNthRecord(n)); </div><div class="line"> Data-&gt;AddInfoString(IPreflightResultNodeData::kFieldProblem,</div><div class="line"> MyMakeProblemString(iRec)); </div><div class="line"> }</div><div class="line">}</div></div><p>In the above example, some of the details are omitted. The point of the example is to show how the original, raw table, having been reduced through standard aggregation, is divided and conquered via CreateTablesByObject.<p><b>Generating result nodes</b><p>The final step is generating the nodes that appear in the results tree. There are three substeps:<ul><li>Create the node - You can create four kinds of nodes through the existing utilities: Generic, Criteria, Violation, and Criteria/Violation.<li>Fill in the node&#39;s short-form string (that is, the one that appears in the tree view panel) - Violation nodes are self-describing through the object model, but the others require you to specify the string you want to appear. These strings also appear in the reports.<li>Fill in the node&#39;s Info strings - These are label-value pairs, like &quot;Required:&quot; and &quot;Text must be either blue or green.&quot; These strings appear in the Info pane below the tree view. They also appear in the reports.</ul><p>To create the nodes, the <a class="el" href="class_i_preflight_aggregated_results_utils.html">IPreflightAggregatedResultsUtils</a> methods in the following table are handy.<table class="doxtable"><tr><th>Method </th><th>Purpose </th></tr><tr><td>CreateGenericNode </td><td>Creates a generic node. Typically, this is a child of a criteria node and is used to group together like items by something other than a criteria. The native rules use this when they want to group by font name, for example. </td></tr><tr><td>AddCriteriaNode </td><td>Creates a criteria node and immediately adds it to the tree. You specify the name at the time of creation. Criteria nodes typically have no info text, which is why this does both operations. </td></tr><tr><td>CreateViolationNode </td><td>Creates a violation node; this is a node that describes a particular problem with a particular object. Thus, the name is generated automatically from the passed-in object ID, and all other behaviors are inherited automatically (page number reporting, selection, etc). </td></tr><tr><td>CreateCriteriaAndViolationNode </td><td>Creates a combination criteria and violation node. Typically, this is used for rules that check only the document or other singleton. There is not much point in having a criteria node with a violation child; that is unnecessary hierarchy. </td></tr></table><p>In most cases, you take the result of these methods and start adding info strings. Unless you are going to build your own implementation of <a class="el" href="class_i_preflight_result_node_info.html">IPreflightResultNodeInfo</a>, you do this via code like the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultNodeInfo&gt;</a> iNode( iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#accf549e1066cc28f030912db8f77d701">CreateViolationNode</a>(iRec-&gt;GetObjectID()));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultNodeData&gt;</a> iData(iNode, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldProblem, <span class="stringliteral">&quot;The object has the wrong color.&quot;</span>);</div><div class="line">iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldFix, <span class="stringliteral">&quot;Set the color to something else.&quot;</span>)</div></div><p>How you fill in the strings is up to you, but there are some utility methods that help with the task. Some of them are explained in the following table. Normally, these are used along with StringUtils::ReplaceStringParameters() to handle localization properly.<p><a class="el" href="class_i_preflight_aggregated_results_utils.html">IPreflightAggregatedResultsUtils</a> methods that help with formatting:<table class="doxtable"><tr><th>Method </th><th>Purpose/application </th></tr><tr><td>IsPlacedContent </td><td>Determines whether a given record corresponds to a placed element or a subpart of a placed element. In many cases, the recommended fix string depends on the distinction. </td></tr><tr><td>FormatXMeasureFormatYMeasure FormatLineMeasure FormatTextSizeMeasure FormatResolution FormatAsInteger </td><td>Return pretranslated strings ready for substitution via StringUtils::ReplaceStringParameters(). These take PMReals and return PMStrings. See below for an example. </td></tr><tr><td>GetSubpartsDescription </td><td>Returns a description of the subpart (or subparts) for a record. For example, if the subparts are kPreflightOM_NativeStroke and kPreflightOSP_NativeFill, this returns the string &quot;Stroke, Fill&quot;. This leverages the object model. </td></tr></table><p>Here is an example of how you might use the preceding: <div class="fragment"><div class="line"><span class="comment">// Set up requirement string</span></div><div class="line"><a class="code" href="class_preflight_rule_data_helper.html">PreflightRuleDataHelper</a> dh(<span class="keyword">this</span>);</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> sRequired(<span class="stringliteral">&quot;Min size is ^1&quot;</span>, <a class="code" href="class_p_m_string.html#a420d221adc4f7081bc56b588f90aefaca7f2c6533d14a4582ab18142013d5502e">PMString::kTranslateDuringCall</a>);</div><div class="line">StringUtils::ReplaceStringParameters(&amp;sRequired, iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#abcd41b798ea6fb58e7c9ebbf1c9e0e35">FormatXMeasure</a>(dh.GetRealParam(<span class="stringliteral">&quot;min_size&quot;</span>)));</div><div class="line">iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldRequired, sRequired);</div><div class="line"><span class="comment">// Set up problem string</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> sProblem(<span class="stringliteral">&quot;Actual size is ^1&quot;</span>, <a class="code" href="class_p_m_string.html#a420d221adc4f7081bc56b588f90aefaca7f2c6533d14a4582ab18142013d5502e">PMString::kTranslateDuringCall</a>);</div><div class="line">StringUtils::ReplaceStringParameters(&amp;sProblem, iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#abcd41b798ea6fb58e7c9ebbf1c9e0e35">FormatXMeasure</a>(iRec-&gt;GetMinValue()));</div><div class="line"><span class="keywordflow">if</span> (!iRec-&gt;HasCommonValue()) </div><div class="line"> sProblem += <a class="code" href="class_p_m_string.html">PMString</a>( <span class="stringliteral">&quot; (smallest)&quot;</span>, <a class="code" href="class_p_m_string.html#a420d221adc4f7081bc56b588f90aefaca7f2c6533d14a4582ab18142013d5502e">PMString::kTranslateDuringCall</a>);</div><div class="line">iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldProblem, sProblem);</div><div class="line"><span class="comment">// Set up fix string</span></div><div class="line"><span class="keywordflow">if</span> (iUtils-&gt;<a class="code" href="class_i_preflight_aggregated_results_utils.html#a6696df0962338c5b337f4fc7bd140ef9">IsPlacedContent</a>(iRec)){</div><div class="line"> iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldFix, <span class="stringliteral">&quot;Fix it in the original file.&quot;</span>);</div><div class="line">}<span class="keywordflow">else</span>{</div><div class="line"> iData-&gt;AddInfoString(IPreflightResultNodeData::kFieldFix , <span class="stringliteral">&quot;Use Object &gt; Size to change the size.&quot;</span>);</div><div class="line">}</div></div><p>This example is almost literally the code found in the InDesign native rules. It takes a number of lines of code to write the string generation, but this is unavoidable; the presentation depends entirely on the nature of your rule and how verbose you want the results to be. You do not need to be this fancy, but users expect more in-depth information to be presented where possible.<h3><a class="anchor" id=""></a></h3><p>This method is called when a document is opened, at start-up, or when a new rule is created. It examines the rule parameters, establishes defaults, and removes any parameters that are no longer needed. This is analogous to the class constructor and converters used for stream-based data in other interface implementations.<p>Typically, this method leverages the utilities in <a class="el" href="class_preflight_rule_data_helper.html">PreflightRuleDataHelper</a>, which makes it easier to set defaults.<p>The following example is from the colorspace rule: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> UpdateRuleData()<span class="keyword"> override</span>{ </div><div class="line"><a class="code" href="class_preflight_rule_data_helper.html">PreflightRuleDataHelper</a> dh(<span class="keyword">this</span>); </div><div class="line"> dh.SetBoolParamDefault(kParamNoRGB, kFalse); </div><div class="line"> dh.SetBoolParamDefault(kParamNoCMYK, kFalse); </div><div class="line"> dh.SetBoolParamDefault(kParamNoGray, kFalse); </div><div class="line"> dh.SetBoolParamDefault(kParamNoLAB, kFalse); </div><div class="line"> dh.SetBoolParamDefault(kParamNoSpot, kFalse);</div><div class="line">}</div></div><p>By using SetBoolParamDefault, there will be no change if the parameter was already initialized, so this implementation works for both updating and initializing.<h3><a class="anchor" id=""></a></h3><p>Preflight calls this method whenever a script sets a parameter on a rule. Since there is no range metadata in the rule data, the rule must perform any required checking. If the rule exposes no parameters with range restrictions, it can simply return kSuccess.<p>The following example is from the bleed/trim hazard rule: <div class="fragment"><div class="line"><span class="keyword">virtual</span> ErrorCode ValidateRuleData ( <span class="keyword">const</span> <a class="code" href="class_p_m_string.html">IPreflightRuleData::Key</a>&amp; key, <span class="keyword">const</span> <a class="code" href="class_script_data.html">ScriptData</a>&amp; proposedValue )<span class="keyword"> const</span>{</div><div class="line"><a class="code" href="class_preflight_rule_data_helper.html">PreflightRuleDataHelper</a> dh(<span class="keyword">this</span>);</div><div class="line"><span class="keywordflow">if</span> (!dh.DataExists (key.<a class="code" href="class_p_m_string.html#af9da9d29b084834619137af698fb70ae">GetPlatformString</a> ().c_str ())) </div><div class="line"><span class="keywordflow">return</span> kInvalidParameterError;</div><div class="line"><a class="code" href="class_p_m_real.html">PMReal</a> value = -1; </div><div class="line"><span class="keywordflow">if</span> (key == kParamLiveAreaL &acirc;&#148;&#130;&acirc;&#148;&#130; key == kParamLiveAreaR &acirc;&#148;&#130;&acirc;&#148;&#130; </div><div class="line"> key == kParamLiveAreaT &acirc;&#148;&#130;&acirc;&#148;&#130; key == kParamLiveAreaB) </div><div class="line"> { </div><div class="line"><span class="keywordflow">if</span> (proposedValue.GetType () == ScriptData::s_double) </div><div class="line"> { </div><div class="line"> proposedValue.GetPMReal (&amp;value); </div><div class="line"><span class="keywordflow">if</span> (value &lt; 0 &acirc;&#148;&#130;&acirc;&#148;&#130; value &gt; kMaxValue) </div><div class="line"><span class="keywordflow">return</span> kOutOfRangeError; </div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span></div><div class="line"><span class="keywordflow">return</span> kInvalidParameterError; </div><div class="line"> } </div><div class="line"><span class="keywordflow">return</span> kSuccess;</div><div class="line">}</div></div><h2><a class="anchor" id="id_more_on_specific_objects"></a> More on specific objects</h2><p>This section describes how to work with particular objects in the model in your Visitor.<h3><a class="anchor" id="id_native_uid-based_objects"></a> Native, UID-based objects</h3><p>These are the simplest to work with because their preflight object boss does not have any additional interfaces. You simply use <a class="el" href="class_i_preflight_object.html#ac2cbab95c95368a6a2533968ff27c673">IPreflightObject::GetModelRef</a> to get an interface on a native (persistent) InDesign boss in the document database. There is no point in preflight providing additional interfaces on the preflight object in this case, because you can get this information from the UID and all existing InDesign model interfaces.<p>For example, the Scaled Graphics rule always looks at graphic page items, so its Visit code looks like the following: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Visit(<a class="code" href="class_i_preflight_visit_info.html">IPreflightVisitInfo</a>* iVisit)<span class="keyword"> override</span>{ </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightObject&gt;</a> iObj(iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#aeb297c3bb6c47af1aaf696fe4c7f9c88">QueryObject</a>()); </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IShape&gt;</a> iShape(iObj-&gt;GetModelRef(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITransform&gt;</a> iTransform(iShape, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="comment">// etc</span></div></div><p>This version has error checking removed, for readability. Initially, you may want to put in several asserts in your rules, to satisfy yourself that the visitor is looking at the object it thinks it is.<h3><a class="anchor" id="id_artwork"></a> Artwork</h3><p>A rule can ask to look at marking operations. This is a powerful capability because you can look at exactly what marking is done for a particular page item or graphic element, regardless of whether you &quot;own&quot; the implementation of that object. Preflight renders the spread into a port, then builds a tree data structure based on what it finds. That tree consists of the marking operations, any logical artwork groups (for example, transparency groups), and groups corresponding to native InDesign elements like wax runs and page items.<p>Unlike page items, artwork objects are not UID based, so all the information exists on the preflight object boss in interfaces that you query.<p>The following table shows the artwork preflight object types and their related interfaces.<table class="doxtable"><tr><th>Preflight object class ID </th><th>Description </th></tr><tr><td>kPreflightOM_ArtworkMark </td><td>The most commonly inspected object type for artwork rules. The boss that the service creates for this object type has the following interfaces:<br /> - <a class="el" href="class_i_preflight_artwork_mark_info.html">IPreflightArtworkMarkInfo</a> - Provides information about the marking operation, such as the geometry, colorspace, opacity, and text versus path.<br /> - <a class="el" href="class_i_preflight_artwork_context.html">IPreflightArtworkContext</a> - Relates the marking operation to any context objects of which it is a child. This is useful when you need to know whether the mark is, say, drawn as part of rendering a text run or graphic. </td></tr><tr><td>kPreflightOM_ArtworkGroup </td><td>Placeholder for future implementation. </td></tr><tr><td>kPreflightOM_ArtworkContext </td><td>&quot;Metadata&quot; contexts that enclose artwork. In other words, the marking operation tells you that a stroke of a specified width and color exists; the context tells you what that stroke is associated with.Preflight supports the following contexts: </td></tr></table><ul><li>Shape - The IShape-supporting page item containing the artwork. This also records the &quot;subpart&quot; of the shape: stroke, fill, adornments, and so on. Shape information is obtained via <a class="el" href="class_i_preflight_artwork_shape_context.html">IPreflightArtworkShapeContext</a>.<li>Text - The text with which the artwork is associated, if any. This is defined by the text model, index, and range. Text information is obtained via <a class="el" href="class_i_preflight_artwork_text_context.html">IPreflightArtworkTextContext</a>.<li>Table - The associated table and cells, if any. This information is available from <a class="el" href="class_i_preflight_artwork_table_context.html">IPreflightArtworkTableContext</a>.<li>OPI - If the artwork is being drawn as part of an OPI reference, this context is present. It has no data and only indicates that there is an OPI context.</ul><p>To determine what contexts an artwork mark is associated with, you start with the <a class="el" href="class_i_preflight_artwork_context.html">IPreflightArtworkContext</a> interface on the mark boss; that interface allows you to search for the nearest, or any, context of a given type. You also can walk the context tree manually.You can ask to visit these context types directly, although this would be uncommon. For example, the OPI rule looks at OPI contexts, because it cares about only their existence.<p>Regarding artwork-based rules: if a rule wants to see any of these classes (or any other class that lists these classes as parents), preflight forces artwork expansion, which is fairly expensive compared to looking at the attributes of native objects. This is one reason why the out-of-the-box default profile (Basic) does not have any artwork rules. This is not to say you should not have such rules; many native rules (like colorspace and CMY marking) are artwork rules. If you can get the information you need by inspecting attributes instead of looking at artwork, however, you probably should use attributes, which has much lower overhead.<p>An artwork-rule visitor usually looks something like that shown below. This is actual code from the colorspace rule. <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Visit(<a class="code" href="class_i_preflight_visit_info.html">IPreflightVisitInfo</a>* iVisit)<span class="keyword"> override</span>{ </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightObject&gt;</a> iObj(iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#aeb297c3bb6c47af1aaf696fe4c7f9c88">QueryObject</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightArtworkContext&gt;</a> iContext(iObj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (iContext &amp;&amp; iContext-&gt;GetShapeContextDepth( kPreflightOSP_GraphicProxy) &gt; 0)</div><div class="line"> { </div><div class="line"><span class="comment">// Artwork is part of a graphic proxy (missing graphic); ignore </span></div><div class="line"> }</div><div class="line"><span class="keywordflow">else</span></div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightArtworkMarkInfo&gt;</a> iMark (iObj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightArtworkPaintInfo&gt;</a> iColor (iMark-&gt;QueryColorPaintInfo()); </div><div class="line"><span class="keywordflow">if</span> (!iColor) </div><div class="line"><span class="keywordflow">return</span>; </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightArtworkCSInfo&gt;</a> iCS (iColor-&gt;QueryColorSpace()); <span class="comment">// etc</span></div><div class="line"> }</div><div class="line">}</div></div><p>Note the use of <a class="el" href="class_i_preflight_artwork_context.html">IPreflightArtworkContext</a>, which looks for an enclosing shape context with a subpart of kPreflightOSP_GraphicProxy. This identifies the marking operation as proxy-related. Your rule may or may not want to exclude proxy artwork in this way.<p>Once the rule determines that the artwork is not part of a proxy, it gathers the marking data, including the paint characteristics. All these secondary interfaces (for example, <a class="el" href="class_i_preflight_artwork_paint_info.html">IPreflightArtworkPaintInfo</a>) are obtained via methods in <a class="el" href="class_i_preflight_artwork_mark_info.html">IPreflightArtworkMarkInfo</a>. In the case of the colorspace rule, it simply calls various <a class="el" href="class_i_preflight_artwork_c_s_info.html">IPreflightArtworkCSInfo</a> methods to determine whether the marking operation violates its rule parameters.<h3><a class="anchor" id="id_text_runs_and_ranges"></a> Text runs and ranges</h3><p>Text runs are not persistent objects, so <a class="el" href="class_i_preflight_object.html#ac2cbab95c95368a6a2533968ff27c673">IPreflightObject::GetModelRef</a> will not give you a UID for one of these. Thus, a text run or range object has all its data on the preflight object boss itself.<p>To obtain information about text objects, query for the following interfaces:<ul><li><a class="el" href="class_i_preflight_text_range_info.html">IPreflightTextRangeInfo</a> - This interface is available on all text-range objects (kPreflightOM_TextRange, kPreflightOM_TextCharacter, kPreflightOM_WaxRun, and kPreflightOM_TextParcel). It provides the text model, thread, parcel, index, and span information for the text object. To obtain further information, you use the In<li>Design text model.<li><a class="el" href="class_i_preflight_wax_info.html">IPreflightWaxInfo</a> - This interface is available only on a kPreflightOM_WaxRun object, not the other text types, since they do not necessarily correspond to a wax-run boundary. This provides the number of glyphs in the run, as well as a method that provides an <a class="el" href="class_i_wax_run.html">IWaxRun</a>.</ul><p>An example of the use of text interfaces follows (from the missing-fonts rule): <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Visit(<a class="code" href="class_i_preflight_visit_info.html">IPreflightVisitInfo</a>* iVisit)<span class="keyword"> override</span>{ </div><div class="line"><span class="keyword">const</span> <a class="code" href="class_preflight_object_i_d.html">PreflightObjectID</a>&amp; objID = iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#a8b397aafcba5323b5aebe410bc7dba76">GetObjectID</a>();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightObject&gt;</a> iObj(iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#aeb297c3bb6c47af1aaf696fe4c7f9c88">QueryObject</a>());</div><div class="line"><span class="keywordflow">if</span> (objID.<a class="code" href="class_preflight_object_i_d.html#a73663e48712686d32f99365b10cd2164">GetClassID</a>() == kPreflightOM_WaxRun)</div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightWaxInfo&gt;</a> iWax(iObj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="keywordflow">if</span> (!iWax) <span class="keywordflow">return</span>;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;const IWaxRun&gt;</a> iRun(iWax-&gt;QueryRun()); </div><div class="line"><span class="keywordflow">if</span> (!iRun) <span class="keywordflow">return</span>;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;const IWaxRenderData&gt;</a> iRender(iRun, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="keywordflow">if</span> (!iRender) <span class="keywordflow">return</span>;</div><div class="line"><span class="keywordflow">if</span> (iRender-&gt;FontFaceMissing()) </div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightResultRecord&gt;</a> iRec( iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#ae702df30e3ed49b453f7838c03f473c9">CreateResultRecord</a>()); </div><div class="line"> iRec-&gt;SetCriteria(kPreflightRC_Default);</div><div class="line"></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> fontName = iRender-&gt;GetFontName(); </div><div class="line"> fontName.<a class="code" href="class_p_m_string.html#acdb6160d8d2233331c0f2e43b569706c">SetTranslatable</a>(kFalse);</div><div class="line"></div><div class="line"> iRec-&gt;SetAuxString(fontName); </div><div class="line"> } </div><div class="line"> }</div><div class="line"><span class="comment">// etc</span></div><div class="line">}</div></div><h3><a class="anchor" id="id_tables_rows_columns_and_cells"></a> Tables, rows, columns, and cells</h3><p>Many table elements in a document are composed of elements and may or may not have an associated UID. Thus, some of the table objects are UID based (for example, use GetModelRef) and some are not. Those that are not have additional data on the preflight object boss.<p>For non-UID based elements, the <a class="el" href="class_i_preflight_table_cell_info.html">IPreflightTableCellInfo</a> interface on the preflight object boss provides the necessary data, from which you can navigate to the InDesign model. The objects that support this interface are kPreflightOM_TableCell, kPreflightOM_TableArea, kPreflightOM_TableFrameCell, and kPreflightOM_TableFrameArea.<p>The following is an abbreviated example from the overprint rule, which looks for any overprint attributes that are set. In this case, the rule is interested in page items, text, and tables, all of which have overprint attributes. <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Visit(<a class="code" href="class_i_preflight_visit_info.html">IPreflightVisitInfo</a>* iVisit)<span class="keyword"> override</span>{ </div><div class="line"><a class="code" href="class_preflight_object_i_d.html">PreflightObjectID</a> objID = iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#a8b397aafcba5323b5aebe410bc7dba76">GetObjectID</a>(); </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightObject&gt;</a> iObj(iVisit-&gt;<a class="code" href="class_i_preflight_visit_info.html#aeb297c3bb6c47af1aaf696fe4c7f9c88">QueryObject</a>()); </div><div class="line"><span class="keywordflow">if</span> (objID.<a class="code" href="class_preflight_object_i_d.html#a73663e48712686d32f99365b10cd2164">GetClassID</a>() == kPreflightOM_PageItem) </div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGraphicStyleDescriptor&gt;</a> iStyle(iObj-&gt;GetModelRef(), </div><div class="line"><a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="comment">// Check graphic attributes.. </span></div><div class="line"> }</div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (objID.<a class="code" href="class_preflight_object_i_d.html#a73663e48712686d32f99365b10cd2164">GetClassID</a>() == kPreflightOM_WaxRun) </div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightTextRangeInfo&gt;</a> iRange(iObj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="keywordflow">if</span> (!iRange) <span class="keywordflow">return</span>; </div><div class="line"><span class="comment">// Check text attributes via the text model... </span></div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (objID.<a class="code" href="class_preflight_object_i_d.html#a73663e48712686d32f99365b10cd2164">GetClassID</a>() == kPreflightOM_TableFrame) </div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableFrame&gt;</a> iFrame(iObj-&gt;GetModelRef(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="keywordflow">if</span> (!iFrame) <span class="keywordflow">return</span>; </div><div class="line"><span class="comment">// Check the table attributes... </span></div><div class="line"> } </div><div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (objID.<a class="code" href="class_preflight_object_i_d.html#a73663e48712686d32f99365b10cd2164">GetClassID</a>() == kPreflightOM_TableFrameCell) </div><div class="line"> { </div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPreflightTableCellInfo&gt;</a> iCellInfo(iObj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>()); </div><div class="line"><span class="keywordflow">if</span> (!iCellInfo) <span class="keywordflow">return</span>; </div><div class="line"><span class="comment">// Check the cell attributes.. </span></div><div class="line"> }</div><div class="line">}</div></div><p>Note how the rule must use a different strategy for each object type. For page items and tables there is a UID to work with, so it queries the model directly. For text and cells, which are composed entities, the rule uses the interfaces hosted on the preflight object directly: <a class="el" href="class_i_preflight_text_range_info.html">IPreflightTextRangeInfo</a> for text and <a class="el" href="class_i_preflight_table_cell_info.html">IPreflightTableCellInfo</a> for table cells.<p>For example, the first thing it does when looking for cell attributes is to look up the table attribute&#39;s accessor interface from the table model, using <a class="el" href="class_i_preflight_table_cell_info.html#a9356f89f83b57f45547c56fb3430e779">IPreflightTableCellInfo::GetTableModelRef</a>: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITableAttrAccessor&gt;</a> iTableAttrs( iCellInfo-&gt;GetTableModelRef(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (!iTableAttrs) <span class="keywordflow">return</span>;</div></div><h1><a class="anchor" id="id_xml_fundamentals"></a> XML Fundamentals</h1><p>This chapter describes features of the InDesign XML subsystem relevant to plug-in developers, and the architecture that supports them. It explains how client code can use these features and take advantage of the XML-related extension patterns in the InDesign API.<p>For use cases, see <a class="el" href="id_idml_cookbook.html#id_xml">XML</a>.<h2><a class="anchor" id="id_introduction"></a> Introduction</h2><h3><a class="anchor" id="id_xml-based_workflow"></a> XML-based workflow</h3><p>There are several benefits of using an XML workflow in publishing:<ul><li>Separation of concerns; for example, maintaining content and presentation information independently.<li>Working with standards that are open, relatively stable, and defined by experts in a domain. This avoids being locked into proprietary, unpublished file formats and helps reduce implementation effort. For example, having standards available such as NITF (<a href="http://www.iptc.org/cms/site/index.html?channel=CH0107">http://www.iptc.org/cms/site/index.html?channel=CH0107 </a> ) and NewsML (<a href="http://www.iptc.org/cms/site/single.html?channel=CH0087&amp;#38;document=CMS1206527546450">http://www.iptc.org/cms/site/single.html?channel=CH0087 </a> &amp; document=CMS1206527546450 ) prevents you from having to reinvent a language to store articles, transmit news feeds, and support a newspaper workflow.<li>Relatively easy processing, because you have a textual representation of XML documents.<li>Relatively easy repurposing of content for other media, like HTML and Mobile SVG, in addition to print publishing and PDF delivery. The main advantage is that the content can be single-sourced but published to multiple media with relatively little effort.<li>Relatively easy manipulation of XML documents, thanks to the availability of many XML-aware tools, software developer toolkits, and standardized APIs.<li>Existence of many databases that can produce and consume XML data, some natively.</ul><p>Disadvantages to an XML workflow can include the following:<ul><li>Journalists and graphic designers are unlikely to want to learn about XML. A system designed around XML may need to shield end users from having to create mark-up manually. For example, templates can be pretagged.<li>Some XML technologies are not straightforward to use and may require some effort to understand (for example, XSLT/XPath), even for capable software developers.</ul><h3><a class="anchor" id="id_using_xml_with_indesign"></a> Using XML with InDesign</h3><p>Using XML-based data and XML templates in InDesign has some benefits to a programmer, which include the following:<ul><li>There are mature XML toolkits and technologies to manipulate XML data (see &lt;a href=http://xml.coverpages.org/software.html&gt; <a href="http://xml.coverpages.org/software.html">http://xml.coverpages.org/software.html</a> ), which make it relatively straightforward to manipulate XML data before import or after export. For example, using XSLT to manipulate XML data is particularly convenient in the context of the InDesign import architecture. You can develop and debug your XSL stylesheets independently of InDesign, using existing XSLT-aware tools, but deploy them as part of a workflow involving InDesign if you use its features like the XML transformer. See &quot;XML transformer&quot;.<li>Importing graphics into tagged placeholders is a convenient way to import and place graphics without writing much (if any) code. See Tagged graphic placeholder.<li>The XML API of InDesign is well documented. The command facades and suite interfaces in the XML API make it relatively straightforward to write client code. See Key client API.</ul><h2><a class="anchor" id="id_terminology"></a> Terminology</h2><p>See the &quot;Glossary&quot; for definitions of terms. The following table lists terms used in this chapter and sections that relate to them.<table class="doxtable"><tr><th>Term </th><th>See ... </th></tr><tr><td>Acquirer; acquirer filter </td><td>Extension patterns </td></tr><tr><td>Backing store </td><td>Backing store </td></tr><tr><td>Comment, XML </td><td>Processing instructions and comments </td></tr><tr><td>Content handler </td><td>Extension patterns </td></tr><tr><td>Content item </td><td>Content items </td></tr><tr><td>Document element </td><td>Document element and root element </td></tr><tr><td>Document Type Declaration (DTD) </td><td>DTD </td></tr><tr><td>Entity </td><td>SAX-entity resolver </td></tr><tr><td>Logical structure </td><td>Native document model and logical structure on page 157 and &quot;Elements and content&quot; </td></tr><tr><td>Placed element; placed content </td><td>Unplaced content versus placed content </td></tr><tr><td>Processing instruction (PI) </td><td>Processing instructions and comments </td></tr><tr><td>Repeating element </td><td>Importing repeating elements </td></tr><tr><td>Root element </td><td>Document element and root element </td></tr><tr><td>SBOS (small boss object store) </td><td>Persistence and the backing store </td></tr><tr><td>Tag </td><td>Tags </td></tr><tr><td>Unplaced element; unplaced content </td><td>Unplaced content versus placed content </td></tr><tr><td>XML element </td><td>Elements and content </td></tr></table><h2><a class="anchor" id="id_xml_features_at_a_glance"></a> XML features at a glance</h2><h3><a class="anchor" id="id_xml_extension_patterns"></a> XML extension patterns</h3><p>Several XML extension patterns depend on the refactored XML import architecture. You can implement these extension patterns to customize how XML data is imported and exported and other XML-related features. See Extension patterns.<h3><a class="anchor" id="id_tagging_in_tables_and_inline_graphics"></a> Tagging in tables and inline graphics</h3><p>InDesign supports tagging of tables and table cells. See Tagged tables on page 188. Inline graphics can be tagged, and placeholders for inline graphics can be created in XML templates. See &quot;Tagged inline graphics&quot;.<h3><a class="anchor" id=""></a></h3><p>It may be desirable to filter out elements in your XML template that are not matched by elements in the incoming XML data. When enabled, this features discards unmatched existing elements in an XML template. See Throwing away unmatched existing elements on import (delete unmatched right) on page 169. The feature is implemented by an import-matchmaker service, an extension pattern described in &quot;XMl-import matchmaker&quot;.<h3><a class="anchor" id=""></a></h3><p>It may be desirable to filter out incoming XML elements that have no corresponding match in your XML template. When enabled, this feature discards inbound elements in the XML-based data being imported that have no match in the XML template into which the data is being imported. In API terms, the feature is called throw away unmatched left. See &quot;Throwing away unmatched incoming elements on XML import&quot; on page 170. The feature is implemented by an import-matchmaker service, described in &quot;XMl-import matchmaker&quot;.<h3><a class="anchor" id="id_importing_repeating_elements"></a> Importing repeating elements</h3><p>This feature allows text styling from elements in an XML template to be preserved (within one story) when repeated elements are imported. It is described in Importing repeating elements.<h3><a class="anchor" id="id_importing_cals_table"></a> Importing CALS table</h3><p>This feature allows CALS table to be imported as InDesign table. It is described in Importing a CALS table as an InDesign table.<h3><a class="anchor" id="id_support_for_dom_core_level_2"></a> Support for DOM core level 2</h3><p>This specification is implemented by the features related to matching and transforming on import. Import matchmakers and XML transformers that operate on the DOM (Document Object Model) are described in Extension patterns. For the DOM Level 2 Core specification, see <a href="http://www.w3c.org/TR/2000/REC-DOM-Level-2-Core-20001113">http://www.w3c.org/TR/2000/REC-DOM-Level-2-Core-20001113 </a>.<h3><a class="anchor" id="id_support_table-_and_cell-styles_import"></a> Support table- and cell-styles import</h3><p>This feature allows table and cell styles to be applied to InDesign table when is imported. It is described in Support table and cell styles when importing an InDesign table.<h3><a class="anchor" id="id_support_xml-rules_processing"></a> Support XML-rules processing</h3><p>The scripting-based XML-rules feature allows an XML DOM to be altered after an XML file is imported. XML rules also can be triggered by application events, such as open, place, and close. The feature is described in id_xml_rules.<h3><a class="anchor" id="id_snippets"></a> Snippets</h3><p>The snippet architecture is described in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_snippet_fundamentals">Snippet Fundamentals</a>. The snippet architecture depends on the XML subsystem, as well as on INX (InDesign Interchange) or IDML (InDesign Markup Language) import and export. Snippets are XML-based representations of parts of a document in INX or IDML file format.<h2><a class="anchor" id="id_the_user_interface_for_xml"></a> The user interface for XML</h2><h3><a class="anchor" id="id_structure_view"></a> Structure view</h3><p>The following figure shows the structure view, a representation of the logical structure of a document that lets you view and interact with its logical structure. You can make selections in this view and create new elements as children of the selection, delete elements, create or delete attributes, and so on. The figure shows the structure view with text snippets visible, which provides context to see what content items in the document are associated with the elements in the logical structure.<div class="image"><img alt="img-xml-ui-structure-view.gif" src="img-xml-ui-structure-view.gif" /></div><p>Depending on your workflow, it may be desirable to control the visibility and other properties of the Structure pane. These properties are controlled by preferences. See XML-related preferences.<p>When you tag a graphic frame as a placeholder, the structure view draws a cross through the icon representing the element to indicate its placeholder status. There are also other icons that represent whether an element is associated with text content or image-based content.<h3><a class="anchor" id="id_tags_in_layout_view_and_story_view"></a> Tags in layout view and story view</h3><p>The following figure shows content that has been tagged, rendered in the layout view of the application. In layout view, tags are shown as brackets with a width of zero; that is, they are intended to have no effect on text composition. Start tags are indicated by brackets pointing right ([), and end tags by brackets pointing left (]). The tag name associated with the tag markers is encoded by color, corresponding to the color displayed in the Tags panel. Multiple tags can exist at the same position in layout view.<div class="image"><img alt="plugin-programming-guide-vol2-31.gif" src="plugin-programming-guide-vol2-31.gif" /></div><p>Story view makes it somewhat easier to understand the logical structure of a story and edit its structured content. The following figure shows structured content rendered in story view. In this view, the names of tags are shown explicitly.<div class="image"><img alt="plugin-programming-guide-vol2-32.gif" src="plugin-programming-guide-vol2-32.gif" /></div><h3><a class="anchor" id="id_tags_panel"></a> Tags panel</h3><p>The following figure shows part of the Tags panel, which has a list of tags that can be applied to document content. Each tag has a name and associated color. In this example, some tags were created when a DTD was imported, shown with icons at the right-hand end of the list elements.<div class="image"><img alt="plugin-programming-guide-vol2-33.gif" src="plugin-programming-guide-vol2-33.gif" /></div><p>To open the Tags panel, choose Window &gt; Tags. By default, the list of tags shown is sorted alphabetically by tag name; the list has no inherent logical structure. The complete set of tags in an imported DTD or imported tag list is shown, regardless of what is selected in the structure view. To populate the tag list, end users can load a set of tags with the Load Tags menu command in the Tags-panel menu.<p>You can create a new tag through the Tags panel; this adds an entry to the tag list. Creating a new tag means it is available to mark up content or tag placeholder graphic frames for content. You can delete a tag through the Tags panel. You can export the tag with the Save Tags menu command in the Tags-panel menu.<h3><a class="anchor" id="id_mapping_between_tags_and_styles"></a> Mapping between tags and styles</h3><p>You can choose to apply a mapping between element names and styles (character and paragraph styles). Once the mapping is applied to a document, any marked-up text is styled as specified by the style on the right-hand side of this mapping. See the following figure.<div class="image"><img alt="plugin-programming-guide-vol2-34.gif" src="plugin-programming-guide-vol2-34.gif" /></div><p>An important use case for mapping tags to styles is preparing a document for XML import. Assuming XML-based content does not carry style information, the tag-to-style map is a simple mechanism to apply styling to inbound XML-based content; more complex mechanisms include styling based on XSLT or a proprietary mechanism like an Adobe FrameMaker Element Definition Document (EDD). The FrameMaker EDD effectively is a style sheet containing rules specifying how to map tags to styles, but in a context-dependent way.<p>You can apply structure to an unstructured InDesign document by choosing to map styles to tags. The effect of this is to mark up the text ranges that have the styles on the left-hand side of the style-to-tag mapping. See the following figure, which shows the user interface for mapping styles to tags:<div class="image"><img alt="plugin-programming-guide-vol2-35.gif" src="plugin-programming-guide-vol2-35.gif" /></div><h3><a class="anchor" id="id_validation_window"></a> Validation window</h3><p>The XML-validation-errors pane appears below the Structure pane; see the following figure. The XML-validation-errors pane contains hyperlinks. If the end user clicks on the hyperlinks, InDesign tries to fix the validation errors. This may not always have the desired effect; for example, it may delete content that was tagged incorrectly.<div class="image"><img alt="plugin-programming-guide-vol2-36.gif" src="plugin-programming-guide-vol2-36.gif" /></div><h3><a class="anchor" id="id_other"></a> Other</h3><p>Other components of the user interface for XML-like context-sensitive menus for tagging the selection-are beyond the scope of this chapter.<h2><a class="anchor" id="id_xml_model"></a> XML model</h2><h3><a class="anchor" id="id_native_document_model_and_logical_structure"></a> Native document model and logical structure</h3><p>The InDesign native document model specifies how end-user documents are represented by InDesign. The InDesign native document model consists of both the description of the document in terms of boss classes and the scripting DOM. End users directly manipulate spreads, pages, and the items they contain; these abstractions are represented by boss classes in the native document model or objects in the scripting DOM.<p>For example, a spread is represented by <a class="el" href="classk_spread_boss.html">kSpreadBoss</a> in the low-level model or boss DOM. Spread contents are organized into a hierarchy (<a class="el" href="class_i_hierarchy.html">IHierarchy</a>). In the scripting DOM, a spread is represented by a Spread object, with properties like Pages or PageItems to represent the object hierarchy at a higher level of abstraction.<p>The logical structure of an InDesign document is specified by the user; for example, by tagging content items in the layout or importing their XML data. An XML template, consisting of tagged placeholders for text and graphics, provides the user with a way to define how user-domain data is mapped into the native model.<p>The logical structure of an InDesign document is organized into a hierarchy of XML elements (see <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) representing logical relationships between content. The <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface plays the same role in the logical structure that <a class="el" href="class_i_hierarchy.html">IHierarchy</a> plays in the spread hierarchy. The key operation that modifies logical structure is tagging document objects, like graphic frames, stories, and text ranges. Tagging establishes associations between objects in the native document model and the logical structure. See Elements and content.<p>Importing XML-based data into an InDesign document creates new elements in the logical structure (see Importing XML on page 162). If there are tagged placeholders, content can be flowed into these placeholders. The logical structure of an InDesign document also can be exported as an XML file (see &quot;Exporting XML&quot; on page 173). You also can create new elements by mapping styles to tags (see &quot;Tags&quot;).<h3><a class="anchor" id="id_elements_and_attributes"></a> Elements and attributes</h3><p>Elements represent user-defined logical relationships between content items in a document. Elements are created by InDesign when XML data is imported or content is tagged. The implementation of elements in InDesign is closely related to the XML specification (<a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml </a> ), which defines an element as follows: &quot;Each XML document contains one or more elements, the boundaries of which are either delimited by start-tags and end-tags, or, for empty elements, by an empty-element tag. Each element has a type, identified by name, sometimes called its &quot;generic identifier&quot; (GI), and may have a set of attribute specifications. Each attribute specification has a name and a value.&quot;<p>You can create a new element in the logical structure with the New Element command in the Structure-pane menu. The behavior of this feature depends on whether the element in the structure view already is placed and, if placed, what is the associated content item. You can choose a tag for the element or create a new one. The tag stores the element&#39;s name and color in the user interface.<p>The following figure shows what happens when the root element is selected in the structure view and the user chooses the New Element menu command. The application adds a child element to the logical structure&#39;s root element. By default, the child element is added at the end of the collection of child elements of the root element. In this example, the root element &lt;book&gt; is selected and a new element &lt;article&gt; is added. The new element is inserted into the logical structure as the last child of the root element and is shown as unplaced content, since the top-level element was not placed; only its child elements are placed content.<div class="image"><img alt="plugin-programming-guide-vol2-37.gif" src="plugin-programming-guide-vol2-37.gif" /></div><p>You can add an element to the logical structure in the structure view, in which case the element is not directly associated with document content. You can indirectly add one or more elements in another view, like layout view, by tagging (for example, tagging a text range or graphic placeholder frame).<p>Attributes are properties of elements. Attributes can be added by end users through the structure view, when a node is selected that supports added attributes. Some elements, like comments, processing instructions, and the DTD element, do not support the addition of attributes.<p>Elements are modeled by boss classes that have the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface. Tags are modelled by the <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a> boss class. See Tags. Attributes are modeled as properties of elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>). There are facades that make it relatively easy to change the properties of elements, tags, and attributes (<a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a>, <a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a>, and <a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a>).<h3><a class="anchor" id="id_content_items"></a> Content items</h3><p>Elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) are created when content items are tagged. Elements also may be created on import of XML data. New content items can be created when XML content is flowed into an XML template. The main point is that elements are defined in the user domain and represent logical relationships between content items-or between elements, in the case of structural elements.<p>Content items are objects in the layout or text domain that can be tagged to create an association with an element in the logical structure of an InDesign document. Many content items can be tagged:<ul><li>Placeholders for graphics (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>)<li>Placeholders for inline graphics (<a class="el" href="classk_i_l_place_holder_page_item_boss.html">kILPlaceHolderPageItemBoss</a>)<li>Images (<a class="el" href="classk_image_item.html">kImageItem</a>, any other descendants of <a class="el" href="classk_image_base_item.html">kImageBaseItem</a>)<li>Stories (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>)<li>Text ranges<li>Tables (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) and cells within them<li>Text within table cells</ul><p>There is no easy way to identify a content item. Many but not all the objects that can be tagged have the <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> interface. If you refer to the API Reference for <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> and see the boss classes in the native document model that aggregate this interface, you get some indication of the variety of document objects that can be tagged.<h3><a class="anchor" id="id_references_to_elements_and_content_items"></a> References to elements and content items</h3><p>All elements in the logical structure of an InDesign document expose the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface; therefore, one type of reference to an element is an interface pointer of type <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>. A more convenient type for programmers to work with is <a class="el" href="class_x_m_l_reference.html">XMLReference</a>, an instance of which can be obtained from <a class="el" href="class_i_i_d_x_m_l_element.html#a755bf8972965cd7fa17da29e7de64e9c">IIDXMLElement::GetXMLReference</a>. This <a class="el" href="class_x_m_l_reference.html">XMLReference</a> is just another way to refer to the same element.<p>Conversely, given an <a class="el" href="class_x_m_l_reference.html">XMLReference</a>, you can obtain an <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface pointer by using <a class="el" href="class_x_m_l_reference.html#a3375f2d7050442c2492b1acd23cad2ec">XMLReference::Instantiate</a>. <a class="el" href="class_x_m_l_reference.html">XMLReference</a> is the XML subsystem&#39;s equivalent of <a class="el" href="class_u_i_d_ref.html">UIDRef</a>; note that <a class="el" href="class_u_i_d_ref.html">UIDRef</a> applies only to UID-based objects, and elements in the logical structure are not UID-based.<p><a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> refers to a chunk of content rather than an element. Do not mistake the <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> type for <a class="el" href="class_x_m_l_reference.html">XMLReference</a>: <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> is a reference to a content item, which might be a UID-based like a graphic frame or a non-UID-based object like a table cell. An instance of <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> can be obtained from <a class="el" href="class_i_i_d_x_m_l_element.html#aa68f0629d9816b9d996e743d5c5c5673">IIDXMLElement::GetContentReference</a>. This generalizes and replaces <a class="el" href="class_i_i_d_x_m_l_element.html#a4fcb17aaad001b1e82cae3a87d3f440a">IIDXMLElement::GetContentItem</a>, which is deprecated.<p>An instance of <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> can tell you the type of object with which it is associated, through <a class="el" href="class_x_m_l_content_reference.html#a879616103dc06b7c1261f1013b5d3245">XMLContentReference::GetContentType</a>. For example, kContentType_Normal is used for elements associated with a UID-based object in the layout; this could be something like a tagged graphic placeholder.<p>For more information on methods and use of these key types, refer to the API Reference for <a class="el" href="class_x_m_l_reference.html">XMLReference</a> and <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a>. The main difference between <a class="el" href="class_x_m_l_reference.html">XMLReference</a> and <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> is that <a class="el" href="class_x_m_l_reference.html">XMLReference</a> refers to an element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>), whereas <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> refers to a content item.<h3><a class="anchor" id="id_document_element_and_root_element"></a> Document element and root element</h3><p>The <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> interface on <a class="el" href="classk_doc_boss.html">kDocBoss</a> stores a reference to the document element (instance of <a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>). There also is an interface on the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>), with a different PMIID referring to the DTD element (<a class="el" href="classk_x_m_l_d_t_d_boss.html">kXMLDTDBoss</a>), if one is associated with the document. The document element associates with the root element both through <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> (as shown in the following figure ) and through <a class="el" href="class_i_i_d_x_m_l_element.html#a2b9db48cd661ae38716408435bac53a1">IIDXMLElement::GetNthChild</a>, because the document element is the parent of the root element. The class diagram in this figure shows associations involving the document element (<a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>) and other classes.<p>Document element, root element, and DTD:<div class="image"><img alt="plugin-programming-guide-vol2-38.gif" src="plugin-programming-guide-vol2-38.gif" /></div><p>The document element is responsible for managing document-level information (like the DTD) and comments and processing instructions that are peers of the root element.<p>The root element (<a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a>) appears as the root of the element hierarchy in the structure view, although the root element is a child of the document element, which is not shown in the structure view. By default, the root element for a new InDesign document has the tag Root; you can change this to whatever the content model for your XML vocabulary requires.<p>The document element and root element -along with the DTD element and any top-level comments (<a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a>) and processing instructions (<a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a>)-are held in the backing store.<h3><a class="anchor" id="id_backing_store"></a> Backing store</h3><p>Each InDesign document contains one backing store, which stores XML elements that are unplaced and elements that are siblings of the root element, like the document element, root element, DTD element, comments, and processing instructions. The backing store is a story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) that is not accessible to the user and is present in every InDesign document. The architecture of the backing store is described in Persistence and the backing store.<p>The object diagram in the following figure shows the relationship between the document, backing store, and elements stored in the backing store.<div class="image"><img alt="plugin-programming-guide-vol2-39.gif" src="plugin-programming-guide-vol2-39.gif" /></div><p>The backing store is opaque to client code. Use facade methods like <a class="el" href="class_i_x_m_l_utils.html#af14c5708effd9849971258810d47bc45">IXMLUtils::QueryDocElement</a> and <a class="el" href="class_i_x_m_l_utils.html#aec089e3c7f66ff4dab9712e7a3356063">IXMLUtils::QueryRootElement</a> to acquire objects like the document element (<a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>) or the root element (shown as the article object in the figure). To acquire a reference to the backing store when you need it (for example, for notification), use IXMLUtils::GetBackingStore.<p>For more information, see Backing store and notification of changes in logical structure.<h3><a class="anchor" id="id_persistence_and_the_backing_store"></a> Persistence and the backing store</h3><p>The main persistence mechanism for the native document model is UID-based; that is, each instance of the classes shown in the model, like <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>, has a record number or UID (unique identifier) associated with it in the document&#39;s database. The UID is unique only within the context of a particular database, not globally.<p>UID-based objects also can store persistent boss objects without a UID; for example, this model is used for attributes and widely within the table and XML subsystems. This as an example of container-managed persistence, to distinguish it from the conventional, UID-based persistence mechanism. The implementation of container-managed persistence in InDesign is very efficient compared to UID-based persistence, which played a large part in the decision to use it for both tables and XML. For more information, see the chapter entitled &quot;Persistent Data and Data Conversion&quot; in volume 1 of this guide.<p>This object diagram in the following figure is an elaborated version of the figure in Backing store. The BaseUID shown for each object is the UID of the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> implementing the backing store. The LSID (logical structure ID) starts at 1 for the document element (<a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>). Refer to the API Reference for <a class="el" href="class_x_m_l_reference.html">XMLReference</a>. The root element, with LSID of 2 in this diagram, is an instance of <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a>; it has a reference to a tag (TagUID=126, name=&quot;Root&quot;) but not to a content item. The image element has a reference to a tag (TagUID=159, name= &quot;image&quot;) and to a content item (UID=161, an instance of <a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-40.gif" src="plugin-programming-guide-vol2-40.gif" /></div><p>The backing store is an instance of a small-boss object store (SBOS), a storage container for small boss objects. The container has a UID, but the objects it stores do not have UIDs. The objects managed by the store have logical IDs (LSIDs) as keys. Refer to the API Reference for <a class="el" href="class_x_m_l_reference.html#a56316770ee53be8ede632f04cc4ee2ee">XMLReference::GetLogicalID</a> and related methods.<h2><a class="anchor" id="id_importing_xml"></a> Importing XML</h2><p>The application supports import of XML data encoded as any of the following:<ul><li>UTF-8 (see <a href="http://www.ietf.org/rfc/rfc2279.txt">http://www.ietf.org/rfc/rfc2279.txt </a> )<li>UTF-16 (see <a href="http://www.ietf.org/rfc/rfc2781.txt">http://www.ietf.org/rfc/rfc2781.txt </a> )<li>Shift-JIS, a two-byte format for Japanese (see <a href="http://www.w3.org/TR/2000/NOTE-japanese-xml-20000414">http://www.w3.org/TR/2000/NOTE-japanese-xml-20000414 </a> )</ul><p>There are two main workflows for importing XML data:<ul><li>Importing XML data into the backing store (see Backing store), then manually placing it onto the layout to set up the associations between elements in the logical structure and document object.<li>Creating an InDesign document as an XML template that contains placeholders, which are tagged with names of the elements in the XML data to import. When the XML data is imported, the contents of the XML file are flowed into the placeholders. The order in which the elements appear in the logical structure determines how the content is flowed into the tagged placeholders.</ul><h3><a class="anchor" id="id_import_architecture"></a> Import architecture</h3><p>The import process is controlled by the XML importer (<a class="el" href="classk_x_m_l_importer_boss.html">kXMLImporterBoss</a>), which is the main delegate for the low-level command that performs the import (<a class="el" href="classk_import_x_m_l_file_cmd_boss.html">kImportXMLFileCmdBoss</a>). Unlike other forms of import-like EPS (import provider <a class="el" href="classk_e_p_s_place_provider_boss.html">kEPSPlaceProviderBoss</a>) and PDF (import provider <a class="el" href="classk_p_d_f_place_provider_boss.html">kPDFPlaceProviderBoss</a>) import-importing XML data does not use the standard import provider (<a class="el" href="class_i_import_provider.html">IImportProvider</a>) architecture. The importer controls the import process by dispatching messages to extension patterns responsible for different parts of the import sequence, as shown in the following figure.<p>The sequence diagram shows some of the messages sent during XML import. The importer object shown consists of the low-level import XML command (<a class="el" href="classk_import_x_m_l_file_cmd_boss.html">kImportXMLFileCmdBoss</a>) and its delegate (<a class="el" href="classk_x_m_l_importer_boss.html">kXMLImporterBoss</a>). The main points to note are the order in which the different extension patterns are sent messages and, for the transformer (<a class="el" href="class_i_x_m_l_transformer.html">IXMLTransformer</a>), how the stream transform precedes the DOM transform message.<div class="image"><img alt="plugin-programming-guide-vol2-41.gif" src="plugin-programming-guide-vol2-41.gif" /></div><p>A low-level command (<a class="el" href="classk_import_x_m_l_file_cmd_boss.html">kImportXMLFileCmdBoss</a>) is processed to import an XML file. Much of the work is done by this command&#39;s delegate, an instance of the <a class="el" href="classk_x_m_l_importer_boss.html">kXMLImporterBoss</a> boss class, in its implementation of <a class="el" href="class_i_x_m_l_importer.html#a8d4e6bc06a8dbedec03d597b733e5bf1">IXMLImporter::DoImport</a>. The following operations are performed while importing an XML file:<ol type="1"><li>The import parameters are specified through an instance of <a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a>. In particular, see <a class="el" href="class_i_import_x_m_l_data.html">IImportXMLData</a>. This specifies either an <a class="el" href="class_i_d_file.html">IDFile</a> (based on a path, which may be a file path or an arbitrary URL-like string).<li>An acquirer service (<a class="el" href="class_i_x_m_l_acquirer_filter.html">IXMLAcquirerFilter</a>) is located, which knows how to turn the import specification (in <a class="el" href="class_i_import_x_m_l_data.html">IImportXMLData</a>) into an XML stream, perhaps with a SAX entity resolver. See XML acquirer on page 198 and &quot;SAX-entity resolver&quot;.<li>The SAX parser service (<a class="el" href="classk_x_m_l_parser_service_boss.html">kXMLParserServiceBoss</a>, <a class="el" href="class_i_s_a_x_services.html">ISAXServices</a>) parses the inbound XML from the stream.<li>XML transformer services (kXMLImporterTransformerService) are called to transform the stream. See XML transformer.<li>At this point, the stream has been turned into an XML DOM. XML transformer services are called to transform the DOM. See XML transformer.<li>The XML-import match driver calls XML-import matchmaker services (kXMLImportMatchMakerSignalService) to participate in matching the input XML data against the XML template (the logical structure of the document into which content is being imported). See XMl-import matchmaker.<li>Matches are registered by the XML match recorder (<a class="el" href="class_i_x_m_l_import_match_recorder.html">IXMLImportMatchRecorder</a>) of the importer (<a class="el" href="classk_x_m_l_importer_boss.html">kXMLImporterBoss</a>).<li>SAX DOM serializer handlers (<a class="el" href="class_i_s_a_x_d_o_m_serializer_handler.html">ISAXDOMSerializerHandler</a>) are called to create content based on the DOM. See SAX DOM serializer handler. The parsing of the final input XML data is controlled by a top-level SAX DOM serializer handler (<a class="el" href="classk_s_a_x_document_handler_boss.html">kSAXDocumentHandlerBoss</a>). Dependent SAX DOM serializer handlers turn parts of the DOM into InDesign content.<li>Post-import responders are called to iterate the DOM and take appropriate action. See <a class="el" href="class_i_x_m_l_post_import_iteration.html">IXMLPostImportIteration</a> and Post-import responder.</ol><p>When XML data is imported, the XML subsystem creates elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) in the logical structure. See Elements and content on page 180. Import of XML data results in content items (<a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a>) being populated with the imported content, if the content items are tagged before import. After import, unplaced elements are held in the document&#39;s backing store. See &quot;Backing store&quot;.<p>The UML diagrams in the following figure show some interfaces involved in storing options for import and export of XML data at the session level (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) or document level (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). There are other interfaces specific to individual components in the XML import architecture (for example, <a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>, which can be found on service boss classes), which are not shown here.<div class="image"><img alt="plugin-programming-guide-vol2-42.gif" src="plugin-programming-guide-vol2-42.gif" /></div><h3><a class="anchor" id="id_importing_a_minimal_xml_file"></a> Importing a minimal XML file</h3><p>A new, empty document has a logical structure consisting of one Root element. To construct a slightly less trivial example, you can create a new document and import a minimal XML file into the backing store. The content is as shown in the following example.<p>Minimal XML data to be imported: <div class="fragment"><div class="line">&lt;article&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/article&gt;</div></div><p>To perform the import:<ol type="1"><li>Save the XML data above to a text file, hello-world.xml.<li>Create a new InDesign document.<li>Show the structure view. Rename the Root tag to be &quot;article.&quot;<li>Create a new tag named &quot;title.&quot;<li>Import the XML data from the hello-world.xml file. The structure view should look like the following figure.</ol><p>The objects created and instances of associations between them are shown in the following figure. The UML object diagram shows the objects involved in representing the logical structure when minimal XML content is imported into the backing store of a new InDesign document. The logical structure of the InDesign document represents the tree structure of the original XML document, which has one title element as a child of the root-article element. Instances of the associations with the objects that represent tags are shown (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-43.gif" src="plugin-programming-guide-vol2-43.gif" /></div><p>Given a reference to the document (<a class="el" href="class_i_document.html">IDocument</a>) or a document database (<a class="el" href="class_i_data_base.html">IDataBase</a>), you can acquire a reference to the document element or root element in the logical structure, using the <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a> facade.<p>The document element has no tag, but the root element always has a tag; in this example, it is named &quot;article.&quot; The <a class="el" href="class_i_i_d_x_m_l_element.html#a7e270fd2019aa304dd0e4b8a692dacf8">IIDXMLElement::GetTagString</a> method discovers the tag name of an element.<p>The root element is one starting point for traversing the logical structure. For the minimal example, you can start from the root element and look at its children.<p>XML elements have the signature interface <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>. Given an <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface, you can obtain an <a class="el" href="class_x_m_l_reference.html">XMLReference</a>, another way to refer to an XML element. See <a class="el" href="class_i_i_d_x_m_l_element.html#a755bf8972965cd7fa17da29e7de64e9c">IIDXMLElement::GetXMLReference</a>. Conversely, given an <a class="el" href="class_x_m_l_reference.html">XMLReference</a>, you can get an <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface through <a class="el" href="class_x_m_l_reference.html#a3375f2d7050442c2492b1acd23cad2ec">XMLReference::Instantiate</a>. XML elements are described in more detail in Elements and content.<p>The UML object diagram in the following figure shows instances of associations between a document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>), document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), and objects representing tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) and their colors within the Tags panel (<a class="el" href="classk_u_i_color_data_boss.html">kUIColorDataBoss</a>).<p>Objects representing tags and colors:<div class="image"><img alt="plugin-programming-guide-vol2-44.gif" src="plugin-programming-guide-vol2-44.gif" /></div><h3><a class="anchor" id="id_unplaced_content_versus_placed_content"></a> Unplaced content versus placed content</h3><p>When XML content is imported with default options and there are no tagged placeholders for the incoming content, the content is held in the backing store. See Backing store.<h3><a class="anchor" id="id_xml_template"></a> XML template</h3><p>An XML template is an InDesign document with tagged placeholders. These can be any of the following:<ul><li>Stories<li>Text ranges<li>Graphic frames<li>Tables and table cells</ul><p>In addition, for the template to be useful, it is likely to already have some styles established and a mapping from tags to styles. See Tag-to-style mapping.<h3><a class="anchor" id="id_matching_against_an_xml_template"></a> Matching against an XML template</h3><p>When XML data is imported into an XML template that matches elements in the imported XML data, some or all of the content becomes placed. Determining what constitutes a match is not a straightforward process.<p><b>Architecture</b><p>Matching against an XML template is performed by XML-import matchmaker services (<a class="el" href="class_i_x_m_l_import_match_maker.html">IXMLImportMatchMaker</a>), which implement the matching logic. For a description of this extension pattern, see XMl-import matchmaker. There are several existing import matchmaker services that support the import features; for example, for importing structured tables or repeating elements. For a more complete listing, refer to the API Reference for <a class="el" href="class_i_x_m_l_import_match_maker.html">IXMLImportMatchMaker</a> and the boss classes that aggregate this interface.<p>If you implement your own import matchmaker, you can customize how the matching against the template is done. For example, you might want to add new pages to the document when you encounter certain repeating elements in the incoming XML data or perform some other operation not provided by the application. For details, see XMl-import matchmaker.<h3><a class="anchor" id="id_importing_repeating_elements"></a> Importing repeating elements</h3><p>Suppose you have XML-based content that consists of many very similar elements, like classified advertisements for used automobiles. You want an XML template that can handle repeating elements in the incoming XML data, rather than having to specify up front how many advertisements could be flowed into the template. In designing an XML template, it often is desirable to design only one instance of a repeating substructure and, during import, have all incoming instances of the substructure pick up the design of that instance.<p>Often, the number of instances in the incoming XML data is either unknown or variable, so having the ability to handle repeating elements adds flexibility. During XML import, InDesign examines the incoming XML data&#39;s structure, compares it to the existing structure in the XML template, and makes duplicates of the existing template element as necessary when it detects the incoming elements are repetitions of the existing template element.<p>Suppose you are going to import this hypothetical XML data related to classified advertisements for motor vehicles. The fields in the XML template tagged with the names of the different elements may be styled differently. The number of items in the incoming XML data is unknown. You may set up a template structure like that in the following example. <div class="fragment"><div class="line">&lt;classifieds&gt;</div><div class="line"> &lt;advert&gt;</div><div class="line"> &lt;vehicle&gt;</div><div class="line"> &lt;year&gt;&lt;/year&gt;</div><div class="line"> &lt;make&gt;&lt;/make&gt;</div><div class="line"> &lt;model&gt;&lt;/model&gt;</div><div class="line"> &lt;mileage&gt;&lt;/mileage&gt; </div><div class="line"> &lt;price&gt;&lt;/price&gt; </div><div class="line"> ... </div><div class="line"> &lt;/vehicle&gt;</div><div class="line"> &lt;contact&gt; </div><div class="line"> &lt;name&gt;&lt;/name&gt;</div><div class="line"> &lt;phone&gt;&lt;/phone&gt;</div><div class="line"> &lt;/contact&gt;</div><div class="line"> &lt;/advert&gt;</div><div class="line">&lt;/classifieds&gt;</div></div><p>In this case, the &quot;advert&quot; element is the repeating element. You would set up styling for the fields in each advert element. During XML import, InDesign duplicates the repeatable advert element as many times as there are elements in the incoming XML.<p>When the data is imported into the XML template, the fields under advert retain the original styling throughout the duplication process, so the final outcome is that there are as many advert elements as there advert elements in the incoming XML.<p><b>Architecture</b><p>The feature is implemented by an import matchmaker service (<a class="el" href="class_i_x_m_l_import_match_maker.html">IXMLImportMatchMaker</a>) whose ClassID is <a class="el" href="classk_x_m_l_repeat_text_elements_match_maker_service_boss.html">kXMLRepeatTextElementsMatchMakerServiceBoss</a>, which is responsible for duplicating elements in the XML template to accommodate the incoming XML elements.<p>The feature is turned on or off by an XML import preference (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>); see Service-level XML preferences.<h3><a class="anchor" id=""></a></h3><p>You can choose to throw away (delete) unmatched existing elements on import, to filter out XML template elements that do not have a match in the incoming XML data. This might occur if, for example, your XML template contains placeholders for all possible elements in the incoming XML, including optional elements, and the incoming XML does not contain some of the optional elements. If an element (like a byline element) in your XML template is not matched in the actual content, you would not want to leave this unnecessary element in the logical structure of the document. This feature removes any unmatched optional elements (and their content) in the document after XML import. The user sets this import option in the XML Import Options dialog box.<p>Suppose you have an XML template with the logical structure and existing mark-up shown in the following figure. If the feature to throw away unmatched existing elements is enabled before importing XML, and the inbound XML does not have elements that match a copyright element in the template, the copyright element in the template is deleted on import. <div class="image"><img alt="img-xml-template-prior-to-i.gif" src="img-xml-template-prior-to-i.gif" /></div><p>For example, suppose the incoming XML contains only the elements shown in the following example, rather than the full set of elements in the XML template document in the preceding figure.<div class="fragment"><div class="line">&lt;article&gt;</div><div class="line"> &lt;headline&gt;Another Disastrous Night <span class="keywordflow">for</span> Scotland&lt;/headline&gt;</div><div class="line"> &lt;byline&gt;Chick O<span class="stringliteral">&#39;Young&lt;/byline&gt;</span></div><div class="line"><span class="stringliteral"> &lt;dateline&gt;22 July 2004&lt;/dateline&gt;</span></div><div class="line"><span class="stringliteral"> &lt;body&gt;</span></div><div class="line"><span class="stringliteral"> &lt;para&gt;Scotland&#39;</span>s World Cup qualification hopes were dampened by the news that no-one in the current squad is fit to play <span class="keywordflow">for</span> Scotland.&lt;/para&gt;</div><div class="line"> &lt;/body&gt;</div><div class="line">&lt;/article&gt;</div></div><p>The net result of importing the sample XML with the option to throw away unmatched existing elements is that only the elements in the incoming XML data explicitly matched in the template are retained, and the template elements and associated content are deleted from the document on import. The result for this sample XML is shown in the following figure.<div class="image"><img alt="img-xml-template-after-thro.gif" src="img-xml-template-after-thro.gif" /></div><p><b>Architecture</b><p>This feature is implemented by a matchmaking service (<a class="el" href="classk_x_m_l_throw_away_unmatched_right_match_maker_service_boss.html">kXMLThrowAwayUnmatchedRightMatchMakerServiceBoss</a>); see XMl-import matchmaker on page 199. The feature is turned on or off by a service-specific import preference (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>); see &quot;Service-level XML preferences&quot;. For more information on controlling the feature, see the &quot;XML&quot; chapter of Adobe InDesign SDK Solutions.<h3><a class="anchor" id="id_throwing_away_unmatched_incoming_elements_on_xml_import"></a> Throwing away unmatched incoming elements on XML import</h3><p>You can choose to throw away (delete) unmatched incoming elements, to filter out elements in the incoming XML data that do not have a match in the XML template into which they are being imported. You can use this feature when you know there are optional elements in the incoming XML that you do not want to display, and you do not want to use XSLT to explicitly filter them out.<p><b>Architecture</b><p>This feature is implemented by a matchmaking service (<a class="el" href="classk_x_m_l_throw_away_unmatched_right_match_maker_service_boss.html">kXMLThrowAwayUnmatchedRightMatchMakerServiceBoss</a>); see XMl-import matchmaker on page 199. This feature is turned on or off by a service-specific import preference (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>); see &quot;Service-level XML preferences&quot;. For more information on controlling the feature, see the &quot;XML&quot; chapter of Adobe InDesign SDK Solutions.<h3><a class="anchor" id="id_attribute-style_mapping"></a> Attribute-style mapping</h3><p>Suppose you want to import XML that has (or is transformed to have) attributes that specify the character or paragraph style to apply to text content in the inbound XML. You can use the attribute-style mapping feature, which looks for attributes pstyle and cstyle in the inbound XML, then tries to match these to paragraph and character styles in the document.<p><b>Architecture</b><p>This feature is implemented by a post-import responder (<a class="el" href="classk_x_m_l_importer_post_import_mapping_boss.html">kXMLImporterPostImportMappingBoss</a>); see Post-import responder on page 199. This responder also implements tag-to-style mapping on import; see &quot;Tag-to-style mapping&quot; on page 178. For information on how this feature is turned on or off, see &quot;Service-level XML preferences&quot;.<h3><a class="anchor" id="id_creating_links_on_xml_import"></a> Creating links on XML import</h3><p>When XML is imported into an XML template, the default behavior is not to create a link to the imported XML file; however, it is possible to turn on a feature that supports creating a link to the imported XML file.<p>XML linking is a feature that enables InDesign to keep track of imported XML files. Each imported XML file has a corresponding link, which is shown in the Links panel along with status. Operations that can be performed on XML links include the following:<ul><li>Create - When an XML file is imported, a link (<a class="el" href="classk_x_m_l_import_link_boss.html">kXMLImportLinkBoss</a>) is created and associated with the root element of the imported content. Only one link can be associated with one element. Importing into an element that already has a link replaces the old link with the new one.<li>Delete - Deleting an element deletes its associated link, if it has one.<li>Copy, paste, duplicate - When an XML element associated with a link is copied, pasted, or duplicated, a copy of the link is created and associated with the new element.<li>Place - Placing an element into the layout or unplacing it does not affect its XML link. Both placed and unplaced elements can be associated with XML links.<li>Check status - An XML link&#39;s status (for example, up-to-date, modified, or missing) is shown as an icon in the Links panel.</ul><p><b>Architecture</b><p>This feature is controlled by an XML-related preference. For details on how this feature is turned on or off, see Service-level XML preferences.<h3><a class="anchor" id="id_sparse_import"></a> Sparse import</h3><p>If this feature is turned on during XML import, incoming elements that have no content (or only whitespace for content) do not replace content in the matching existing XML element in the XML template. By default, this feature is turned off.<p><b>Architecture</b><p>The feature is controlled by an XML-related preference (<a class="el" href="classk_x_m_l_sparse_import_options_service_boss.html">kXMLSparseImportOptionsServiceBoss</a>). The top-level SAX handler (<a class="el" href="classk_s_a_x_document_handler_boss.html">kSAXDocumentHandlerBoss</a>) acts on this preference, rather than the service (<a class="el" href="classk_x_m_l_sparse_import_options_service_boss.html">kXMLSparseImportOptionsServiceBoss</a>) being responsible for providing the behavior. This explains why <a class="el" href="classk_x_m_l_sparse_import_options_service_boss.html">kXMLSparseImportOptionsServiceBoss</a> has no service interface: it is not implementing a particular extension pattern other than for XML import preferences. For details on how to turn sparse import on and off, see Service-level XML preferences.<h3><a class="anchor" id="id_importing_a_cals_table_as_an_indesign_table"></a> Importing a CALS table as an indesign table</h3><p>You can choose whether to import a CALS table as an InDesign table. You can use this feature when you have a table specified in CALS table format and you want to manipulate it the same way as InDesign native tables.<p><b>Architecture</b><p>This feature is implemented by a matchmaking service (<a class="el" href="classk_x_m_l_table_match_maker_service_boss.html">kXMLTableMatchMakerServiceBoss</a>) and DOM serializer handler service; see XMl-import matchmaker on page 199 and &quot;SAX DOM serializer handler&quot; on page 201. During the matchmaker phase, a special attribute, kTableFormatAttr (&quot;tformat&quot;), with value kAttrValueCALS (&quot;CALS&quot;), is inserted into the table element. During the DOM serializer phase, contents in the CALS table are altered to fit the InDesign table format. This feature can be turned on or off by a service-specific import preference (<a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a>); see &quot;Service-level XML preferences&quot;. For more information on controlling the feature, see <a class="el" href="id_idml_cookbook.html#id_xml">XML</a>.<h3><a class="anchor" id="id_support_table_and_cell_styles_when_importing_an_indesign_table"></a> Support table and cell styles when importing an InDesign table</h3><p>You can specify table and cell styles when importing an InDesign table. A table-style attribute applies only to a table element. Cell-style attributes apply to either a table element or a cell element; they are ignored for other types of elements. If the style name specified in the attribute value does not exist, a new style with that name is created and then applied to the table or cell.<p><b>Architecture</b><p>This feature is implemented by a post-import responder (<a class="el" href="classk_x_m_l_importer_post_import_mapping_boss.html">kXMLImporterPostImportMappingBoss</a>), the same way as character style and paragraph style; see Attribute-style mapping. The only difference is that the attribute names are tablestyle and cellstyle.<h2><a class="anchor" id="id_exporting_xml"></a> Exporting XML</h2><p>Exporting XML data from InDesign is considerably more straightforward than importing XML data into InDesign. The downside to this is that there are fewer opportunities for your plug-in to customize the export side.<p>You can export the logical structure of an InDesign document as an XML document. The export takes place in document order, meaning the logical structures of the InDesign document and exported XML data are the same.<p>An XML file can be exported from any element in the logical structure. For example, if exported from the root element, the exported XML data represents the logical structure of the entire document. If another element -for example, E-is chosen, the exported XML data represents the logical structure of the subtree with E at its root.<p>Even an empty InDesign document has some (albeit trivial) logical structure: it has one root element with no dependents. If exported as XML data, one element (&lt;Root&gt;&lt;/Root&gt;) is written to the output file. The following figure shows the logical structure of a new, empty document and the XML data exported from InDesign with the default settings. Note the default encoding (UTF-8).<div class="image"><img alt="plugin-programming-guide-vol2-45.gif" src="plugin-programming-guide-vol2-45.gif" /></div><p>There are two points to note about the relationship between XML data exported from InDesign and the logical structure:<ul><li>XML content can be exported from a document even if it is not associated with placed content in the document. Exported XML data is based on the logical structure, irrespective of whether the elements are associated with content in the document.<li>The order in which the elements appear in the XML output is based on the logical structure and has no direct relation with the hierarchy of the native document model. The exception to this is a story with mark-up, in which case the order of the elements in the logical structure within the subtree corresponding to the story corresponds to the story-reading order.</ul><h3><a class="anchor" id="id_export_architecture"></a> Export architecture</h3><p>An XML generator (<a class="el" href="class_i_x_m_l_generator.html">IXMLGenerator</a>) is an abstraction responsible for generating the XML content during export. The <a class="el" href="class_i_x_m_l_generator.html">IXMLGenerator</a> interface is aggregated by classes representing XML elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) in the logical structure.<p>The mechanism that supports XML export is a standard export provider (<a class="el" href="classk_x_m_l_export_provider_boss.html">kXMLExportProviderBoss</a>, <a class="el" href="class_i_export_provider.html">IExportProvider</a>). This delegates to an instance of <a class="el" href="classk_x_m_l_export_handler_boss.html">kXMLExportHandlerBoss</a> to perform the actual export. The implementation of <a class="el" href="class_i_x_m_l_handler.html">IXMLHandler</a> iterates elements in the logical structure, calling methods through the <a class="el" href="class_i_x_m_l_generator.html">IXMLGenerator</a> interface of the elements.<p>This sequence diagram in the following figure shows some of the messages sent during a typical XML export.<div class="image"><img alt="plugin-programming-guide-vol2-46.gif" src="plugin-programming-guide-vol2-46.gif" /></div><p>The export provider (<a class="el" href="classk_x_m_l_export_provider_boss.html">kXMLExportProviderBoss</a>), shown as export-provider in this figure, starts the export. The parser service (<a class="el" href="classk_x_m_l_parser_service_boss.html">kXMLParserServiceBoss</a>) has an <a class="el" href="class_i_x_m_l_access.html">IXMLAccess</a> interface, shown as the xmlAccess object. An instance of <a class="el" href="classk_x_m_l_export_handler_boss.html">kXMLExportHandlerBoss</a>, shown as xmlHandler, with signature interface <a class="el" href="class_i_x_m_l_handler.html">IXMLHandler</a>, iterates elements in the logical structure. The implementation of the <a class="el" href="class_i_x_m_l_generator.html">IXMLGenerator</a> interface on these elements generates XML content to the output stream. There are several implementations of this interface, generating different content types on export.<p>Contributions to XML export come from instances of boss classes that expose the <a class="el" href="class_i_x_m_l_generator.html">IXMLGenerator</a> interface. These classes represent elements in the logical structure; for example, <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a> (tagged stories, tagged text ranges, and tagged graphics) and <a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a> (XML comments).<p>You can participate in the export process by providing a custom kXMLExportHandlerSignalService. The providers are called when the XML handler iterates elements. For more information, see the extension pattern in XML-export handler.<h3><a class="anchor" id="id_document_order"></a> Document order</h3><p>The logical structure of an InDesign document is exported as XML in document order, as defined in the XPath specification (<a href="http://www.w3.org/TR/xpath#dt-document-order">http://www.w3.org/TR/xpath#dt-document-order </a> ). For convenience, part of the definition is repeated here: &quot;There is an ordering, document order, defined on all the nodes in the document corresponding to the order in which the first character of the XML representation of each node occurs in the XML representation of the document after expansion of general entities. Thus, the root node will be the first node. Element nodes occur before their children. Thus, document order orders element nodes in order of the occurrence of their start-tag in the XML (after expansion of entities). The attribute nodes and namespace nodes of an element occur before the children of the element. ... Reverse document order is the reverse of document order.&quot;<p>Document order has no direct relationship with the order in which a document would be read or other ordering schemes you might devise (for example, based on page numbering).<h3><a class="anchor" id="id_tagged_graphic_placeholder_exported"></a> Tagged graphic placeholder, exported</h3><p>Consider the case, shown in the following figure , of a simple but nontrivial logical structure in which a tagged placeholder is intended as the destination for an image.<div class="image"><img alt="img-xml-tagged-graphic-plac.gif" src="img-xml-tagged-graphic-plac.gif" /></div><p>Exporting the logical structure with default export options results in the XML data shown in the following figure. To vary the options, like the encoding, see XML-related preferences.<div class="image"><img alt="plugin-programming-guide-vol2-47.gif" src="plugin-programming-guide-vol2-47.gif" /></div><p>The abstraction responsible for generating the XML data related to the tagged graphic is the element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) that represents the graphic. It exposes the <a class="el" href="class_i_x_m_l_generator.html">IXMLGenerator</a> interface, which is used during the export process.<h3><a class="anchor" id="id_tagged_text_range_exported"></a> Tagged text range, exported</h3><p>Consider the example in which you create a text frame, tag the story running through it with a tag named &quot;story,&quot; then tag a range within that story with a different tag named &quot;emphasis.&quot; The XML story element represents the instance of the tagged story. The XML emphasis element represents the tagged content item with value &quot;Hello.&quot; This is shown in the following figure. The screenshot shows logical structure, tags, and layout view for a document with one text frame, with a tagged text range. The story is tagged &quot;story&quot; and represented by the story element in the logical structure. The text range is tagged &quot;emphasis&quot; and represented by the emphasis element.<div class="image"><img alt="img-xml-some-tgd-text.gif" src="img-xml-some-tgd-text.gif" /></div><p>If you export the logical structure as XML data from the root element, you get the XML data shown in the following figure. This time, the export option to export with UTF-16 encoding is set, to make it easier to inspect the Unicode character that represents the hard carriage return in the story. This XML data was exported by InDesign from the document shown in the preceding figure.<div class="image"><img alt="plugin-programming-guide-vol2-48.gif" src="plugin-programming-guide-vol2-48.gif" /></div><p>The XML content of the exported story requires some study. The intent of the InDesign function is that stories should be represented in exported XML data as closely as possible to how InDesign represents them internally. The end-of-line character corresponding to the hard carriage return after the word &quot;world&quot; is represented by the Unicode character 0x2029. If you open the XML file in a binary editor on Windows-which is little-endian-the Unicode character 0x2029 is represented as the octet 29 and then the octet 20. Soft carriage returns are represented by 0x2028. See <a class="el" href="class_i_x_m_l_out_stream.html">IXMLOutStream</a>. This is shown in the following figure; the 0x2029 (hard carriage return) is highlighted.<div class="image"><img alt="img-xml-binary-text-range.gif" src="img-xml-binary-text-range.gif" /></div><h2><a class="anchor" id="id_tags"></a> Tags</h2><p>Tags can be loaded from several different sources, including the following:<ul><li>An InDesign tag file, an XML document containing only tag-specific information.<li>Any XML document that is an instance of the document type being worked with.<li>By associating a DTD with the document. Doing this means the DTD is parsed for element tag names, and tags are created correspondingly. Elements defined within entities are ignored.</ul><p>The following example is a sample tag list. <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-16&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;article colorindex=<span class="stringliteral">&quot;4&quot;</span>&gt;</div><div class="line"> &lt;articleinfo colorindex=<span class="stringliteral">&quot;6&quot;</span>/&gt;</div><div class="line"> ... (other elements omitted)</div><div class="line"> &lt;ulink colorindex=<span class="stringliteral">&quot;19&quot;</span>/&gt;</div><div class="line">&lt;/article&gt;</div></div><p>It also is possible to specify the color of the tag using RGB coordinates, which are used for any tags defined with a custom color. The coordinates are hex-encoded; for example, one tag with a custom color (0,0,255) in decimal RGB coordinates appears below: <div class="fragment"><div class="line">&lt;link rgb=<span class="stringliteral">&quot;0 0,0 0,3ff00000 0&quot;</span>/&gt;</div></div><p>In addition, the custom-tag service-extension pattern lets you customize what tags are created when an XML document is being parsed. See Custom-tag service.<h3><a class="anchor" id="id_architecture"></a> Architecture</h3><p>The <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a> boss class represents an individual entry in a tag list. The signature interface of this boss class is <a class="el" href="class_i_x_m_l_tag.html">IXMLTag</a>; this stores properties like the name and color in the user interface. The tag list is represented by <a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>.<p><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a> is aggregated on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>), representing a default set of tags for any new document.<p><a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a> is aggregated on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), representing tags in a given document.<p>The session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores zero or more tags. A document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) stores one or more tags; the minimal tag set for a new document consists of the Root tag.<p>Tagging relationships are represented by associations between classes representing elements in the logical structure and those representing tags. For example, if a graphic frame is tagged for use as a placeholder, an association is created between the placeholder boss object (an instance of the <a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a> class) and an instance of the <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a> class. An association is created between an element in the logical structure (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) and an instance of <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>, to represent the tagging.<p>Tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) that can be used to mark up content items in the native document model are held in the tag list (<a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) of a workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). Tags are rendered in the Tags panel (see Tags panel on page 155) and shown in views like layout view or story view (see &quot;Tags in layout view and story view&quot;). XML elements that have tag names are associated with tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) that store the tag names.<p>Given a reference to an XML element, you can find the tag string through a method on <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>. You also can use <a class="el" href="class_i_i_d_x_m_l_element.html#ae385c1284d3155bfd7e09b170ad93b31">IIDXMLElement::GetTagUID</a> to acquire a reference to an instance of <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a> representing the tag.<p>You can acquire a reference to a tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) in a document through the tag list (<a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) on the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). The tagUIDRef variable refers to an instance of <a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>.<p>The class diagram in the following figure shows associations between tags and workspaces and the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-49.gif" src="plugin-programming-guide-vol2-49.gif" /></div><h3><a class="anchor" id="id_tag-to-style_mapping"></a> Tag-to-style mapping</h3><p>Suppose you have XML content with a headline tag and a p-head-1 paragraph style in your XML template. You can create an association between tags and styles in the document, to enable incoming XML to be styled automatically.<p>When a tag-to-style mapping is applied during the XML import, inbound XML content has the styles applied when elements with tag names matching the tags in the tag-to-style map are encountered. For example, if you create a mapping from the headline tag to the p-head-1 paragraph style, textual content in a headline element has the p-head-1 style applied.<p>The user interface for this feature is shown in Mapping between tags and styles on page 155. This establishes a one-to-one mapping from tag names to character or paragraph styles, which is sufficient when context-sensitive styling is not required. If context-sensitive styling for incoming XML is required, you can use a combination of a stream-based XML transformer and attribute-style mapping to achieve this. See &quot;XML transformer&quot; on page 199 and &quot;Attribute-style mapping&quot;.<p><b>Architecture</b><p>The following figure is a class diagram for tag-to-style mappings (<a class="el" href="class_i_x_m_l_tag_to_style_map.html">IXMLTagToStyleMap</a>). The session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores the default mapping inherited by new documents. The document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) stores the mapping applied to a particular document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-50.gif" src="plugin-programming-guide-vol2-50.gif" /></div><h3><a class="anchor" id="id_style-to-tag_mapping"></a> Style-to-tag mapping</h3><p>The following figure is a screenshot of an unstructured but systematically styled document, which as an associated DTD.<p>Before mapping styles to tags:<div class="image"><img alt="plugin-programming-guide-vol2-51.gif" src="plugin-programming-guide-vol2-51.gif" /></div><p>The following figure shows the result of applying a style-to-tag mapping.<div class="image"><img alt="plugin-programming-guide-vol2-52.gif" src="plugin-programming-guide-vol2-52.gif" /></div><p>Once a style-to-tag mapping is defined and applied, ranges of styled text with the styles mapped to given tags end up tagged, creating new elements in the logical structure. There are some default commitments in terms of the tags applied; for example, the Story tag is used for a story, even if it is not in the tag list of the document when the style-to-tag mapping is applied.<p><b>Architecture</b><p>The class diagram in the following figure shows the associations between workspaces (<a class="el" href="class_i_workspace.html">IWorkspace</a>), tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>), and styles (<a class="el" href="classk_style_boss.html">kStyleBoss</a>), mediated by the style-to-tag map (<a class="el" href="class_i_x_m_l_style_to_tag_map.html">IXMLStyleToTagMap</a>). The session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores the default style-to-tag map for new documents. The document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) stores the style-to-tag map for a given document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>). <div class="image"><img alt="plugin-programming-guide-vol2-53.gif" src="plugin-programming-guide-vol2-53.gif" /></div><p>Text styles are represented by <a class="el" href="classk_style_boss.html">kStyleBoss</a>. Collections of styles are held in the style-name table (<a class="el" href="class_i_style_name_table.html">IStyleNameTable</a>) and stored in a workspace (<a class="el" href="class_i_workspace.html">IWorkspace</a>). The session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores text styles that are defaults for new documents. The document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>) stores text styles that can be used in the associated document. For more information on text styles, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a> as well as the API Reference for <a class="el" href="classk_style_boss.html">kStyleBoss</a>.<p>The workspace (<a class="el" href="class_i_workspace.html">IWorkspace</a>) maintains an associative map between text styles (<a class="el" href="classk_style_boss.html">kStyleBoss</a>) and tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>). This map is stored in the persistent interface <a class="el" href="class_i_x_m_l_style_to_tag_map.html">IXMLStyleToTagMap</a>. The workspace style list (<a class="el" href="class_i_style_name_table.html">IStyleNameTable</a>) may contain styles that are not referenced in the style-to-tag map. Similarly, there may be tags in the tag list (<a class="el" href="class_i_x_m_l_tag_list.html">IXMLTagList</a>) of the workspace that are not involved in the style-to-tag map.<h2><a class="anchor" id="id_elements_and_content"></a> Elements and content</h2><h3><a class="anchor" id="id_tagged_graphic_placeholder"></a> Tagged graphic placeholder</h3><p>Suppose you are building an XML template and you want to create placeholders into which images will be placed when an XML data file is imported. To create a placeholder graphic for an image:<ol type="1"><li>Create a new document.<li>Create a tag named &quot;image&quot; through the Tags panel (Window &gt; Tags).<li>Create a rectangle page item with the Rectangle tool.<li>Leave the page item selected, and click on the image tag in the Tags panel.<li>Show the structure view. It should look like the figure in Architecture.</ol><p><b>Architecture</b><p>The UML object diagram in the following figure shows the boss objects representing a tagged graphic placeholder and some of the relationships between them. The placeholder object (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>) is a child of a graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>); the latter is omitted from this diagram, in the interest of simplicity. Content items like <a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a> have an <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> interface, which lets them refer to an element in the logical structure.<div class="image"><img alt="plugin-programming-guide-vol2-54.gif" src="plugin-programming-guide-vol2-54.gif" /></div><p>When document content is tagged, XML elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) are created within the logical structure. Tagging content creates associations between content items (see <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a>) and elements in the logical structure. Tagging also creates associations between elements and tags (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>).<p>The following figure shows a class diagram for some of the classes representing a tagged placeholder graphic. A graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) acquires a placeholder item child (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>), when the frame is tagged to use as a placeholder. If a graphic frame is not tagged, it has no dependent placeholder (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-55.gif" src="plugin-programming-guide-vol2-55.gif" /></div><p>There are several key associations related to tagging of content items shown in the two preceding figures:<ul><li>Content items in the native document model associate with elements in the logical structure. The association is maintained by the <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> interface and the <a class="el" href="class_x_m_l_reference.html">XMLReference</a> helper class.<li>Elements in the logical structure associate with content items in the native document model. The association is maintained by the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface. See GetContentItem and GetContentReference.<li>Elements in the logical structure associate with tags. The association is maintained by the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface. See GetTagUID and GetTagString.</ul><h3><a class="anchor" id="id_tagged_images"></a> Tagged images</h3><p>The following figure is an example of a minimal XML file that can be used to place an image. The path shown is a relative one; the image would have to be in the same folder as the XML file that referenced it.<div class="image"><img alt="plugin-programming-guide-vol2-56.gif" src="plugin-programming-guide-vol2-56.gif" /></div><p>See <a class="el" href="id_idml_cookbook.html#id_xml">XML</a> for an example of XML for importing an image by reference. On importing the XML file, if we do not have a preexisting placeholder graphic frame tagged with the Image tag, the image is not placed.<p>The following figure shows the result of importing the minimal XML file.<div class="image"><img alt="plugin-programming-guide-vol2-57.gif" src="plugin-programming-guide-vol2-57.gif" /></div><p>If there is a preexisting graphic frame tagged with the Image tag, the image is placed on import. One constraint is that if you intend an image to be placed in the graphic frame, the Image element (for this example) must support the href attribute that on import should specify the system path with which to locate the image to be placed, or you will have to place the image yourself.<p><b>Architecture</b><p>Elements can be associated with a tagged placeholder (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>) or a tagged graphic content item, such as an image (<a class="el" href="classk_image_item.html">kImageItem</a>, <a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a>, <a class="el" href="classk_e_p_s_item.html">kEPSItem</a>, etc.).<p>When an XML tag is applied to a graphic frame with placeholder content (for example, <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> containing a <a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>), a new instance of the <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a> class is created, and a link is created between this object and the boss object representing the placeholder item (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>).<h3><a class="anchor" id="id_tagged_stories"></a> Tagged stories</h3><p><b>Architecture</b><p>Elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) can be associated with a content item that is either a story or a range of text within a story. The story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) in which the text range is contained must be tagged before a range of text can be tagged. Tagging a story is useful when you want to create a tagged placeholder for incoming, text-based content. The end-user action to tag a story is to tag the text frame through which the story flows; this creates an association between the story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) and an XML element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>).<p>The following figure shows associations for some of the classes representing a tagged story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). If a story is tagged, the <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> of the story boss object (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) refers to a valid instance of an element (<a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-58.gif" src="plugin-programming-guide-vol2-58.gif" /></div><p>You can iterate over the children of the element tagging the story, using <a class="el" href="class_x_m_l_content_iterator.html">XMLContentIterator</a>, to find out text ranges marked up by the child elements. For an example, see the section on &quot;Finding Text associated with Tagged Text Ranges&quot; in the &quot;XML&quot; chapter of Adobe InDesign SDK Solutions.<h3><a class="anchor" id="id_tagged_text_ranges"></a> Tagged text ranges</h3><p>A tag is applied to a text range by making a text selection and either clicking a particular tag in the Tags panel or selecting an item from a context-sensitive menu containing tag names. Once the range is tagged, tag markers are placed before and after the tagged range. The &quot;[&quot; and &quot;]&quot; adornment characters are nonprinting, zero-width spaces inserted into the text; these characters can be shown or hidden.<p>Text ranges within a tagged story can themselves be tagged. Text within table cells also can be tagged. There are some constraints on what text can be tagged. The following text ranges cannot be tagged:<ul><li>Some owned items, including notes (<a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>), tracked changes, and hyperlinks.<li>Ruby text annotations in Japanese.<li>Text in locked stories (see <a class="el" href="class_i_item_lock_data.html">IItemLockData</a>).</ul><p>The following figure shows a tagged range of text. In this example, the article tag is applied to the story, and the emphasis tag is applied to the text range containing the characters &quot;tagged.&quot;<div class="image"><img alt="plugin-programming-guide-vol2-59.gif" src="plugin-programming-guide-vol2-59.gif" /></div><p><b>Architecture</b><p>When tagging a text range in an untagged story, the following steps take place:<ol type="1"><li>The story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>) in which the text range lies is tagged, and an element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) is created in the logical structure.<li>An element (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) is created to represent the tagged-text range. This element refers to a tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) with a tag name (&quot;emphasis&quot; in the example in the preceding figure).<li>Characters are inserted into the text model to represent the start and end of the tagged-text range (kTextChar_ZeroSpaceNoBreak).<li>Optionally, adornments (<a class="el" href="class_i_global_text_adornment.html">IGlobalTextAdornment</a>, <a class="el" href="classk_x_m_l_marker_adornment_boss.html">kXMLMarkerAdornmentBoss</a>) are drawn in layout view, as shown in the preceding figure, if the preference to show tag markers is enabled (see <a class="el" href="class_i_x_m_l_preferences.html">IXMLPreferences</a>).</ol><p>The following figure shows the classes involved in this minimal example of tagging a text range.<div class="image"><img alt="plugin-programming-guide-vol2-60.gif" src="plugin-programming-guide-vol2-60.gif" /></div><p>Consider the example of one tagged text range, as shown in the following figure, which shows objects involved in representing a tagged text range. The result of tagging this text range is to create a new element that is a child of the element associated with the tagged story. See Tagged stories. In the following figure, an emphasis element is created on tagging the text range. This is a child of an article element for this example. The information about the range of text is encapsulated in the <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a>, but it can be accessed through using <a class="el" href="class_x_m_l_content_iterator.html">XMLContentIterator</a>.<div class="image"><img alt="plugin-programming-guide-vol2-61.gif" src="plugin-programming-guide-vol2-61.gif" /></div><h3><a class="anchor" id="id_tagged_inline_graphics"></a> Tagged inline graphics</h3><p>You can create a tagged inline graphic by either selecting an existing inline graphic and tagging it or placing an image into a tagged inline placeholder.<p>The following figure shows a tagged story, with two tagged paragraphs and a tagged inline graphic.<div class="image"><img alt="plugin-programming-guide-vol2-62.gif" src="plugin-programming-guide-vol2-62.gif" /></div><p><b>Architecture</b><p>From an XML perspective, tagged inline graphics are like tagged images, described in Tagged images. The main differences are on the native-document-model side; the image (for example, <a class="el" href="classk_image_item.html">kImageItem</a>) is owned by a frame that itself is owned by an inline object (<a class="el" href="classk_inline_boss.html">kInlineBoss</a>). The object diagram in the preceding figure shows some objects that model a tagged inline graphic.<div class="image"><img alt="plugin-programming-guide-vol2-63.gif" src="plugin-programming-guide-vol2-63.gif" /></div><h3><a class="anchor" id="id_tagged_tables"></a> Tagged tables</h3><p>You can tag a table and cells within a table. A table that is not explicitly tagged will not get exported during XML export. If a table is tagged, all its cells must be tagged. In other words, a tagged table cannot contain untagged cells, and a tagged table cell cannot be inside an untagged table.<p>Tagged tables and table cells also can be untagged; that is, the mark-up associated with them can be removed. Untagging a table or its cells untags the entire table, including the cells.<p>The model for tagging tables is restricted: you can tag either at the whole-table level or the cell level, but you cannot tag rows or create other container elements within the logical structure of a table.<p><b>Architecture</b><p>If you refer to the API Reference for <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> and see the boss classes that aggregate this interface, you will notice table-related classes like <a class="el" href="classk_table_model_boss.html">kTableModelBoss</a> and <a class="el" href="classk_text_cell_content_boss.html">kTextCellContentBoss</a>. The operation of tagging a table (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) has the following constraints:<ul><li>A tagged table must reside in a tagged story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), so the act of tagging a table also tags the story in which it resides, if the story is not already tagged. The story is auto-tagged with the Story tag, if no other tag is specified.<li>The cells within the table also must be tagged when the table itself is tagged. The cells are auto-tagged with the Cell tag, if no other tag is specified.</ul><p>It also is possible to tag text within a table cell, which is not much different than the situation described in Tagged text ranges. For example, if you create an element that is a child of a Cell element, the new element becomes a placeholder for tagged text within a table cell.<p>For more details on implementing tagging of tables, see the section on &quot;Tagging a Table&quot; in <a class="el" href="id_idml_cookbook.html#id_xml">XML</a>.<p>The object diagram in the following figure shows some of the objects that represent a tagged table. Note how the table (<a class="el" href="classk_table_model_boss.html">kTableModelBoss</a>) associates with an XML table element. The key to understanding the model is the <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a> type, an instance of which can be obtained from <a class="el" href="class_i_i_d_x_m_l_element.html#aa68f0629d9816b9d996e743d5c5c5673">IIDXMLElement::GetContentReference</a>. In the case of XML elements associated with table cells, the properties of the cells can be discovered through <a class="el" href="class_x_m_l_content_reference.html">XMLContentReference</a>.<div class="image"><img alt="plugin-programming-guide-vol2-64.gif" src="plugin-programming-guide-vol2-64.gif" /></div><h3><a class="anchor" id="id_dtd"></a> DTD</h3><p>A document type declaration (DTD) is a grammar defined in an extended Backus-Naur format that can be read by XML processors. The main point of associating a DTD with an InDesign document is to allow the logical structure of the InDesign document to be checked or validated against the grammar. The XML 1.0 specification (<a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml </a>) defines a DTD as follows: &quot;The XML document type declaration contains or points to markup declarations that provide a grammar for a class of documents. This grammar is known as a document type definition, or DTD. The document type declaration can point to an external subset (a special kind of external entity) containing markup declarations, or can contain the markup declarations directly in an internal subset, or can do both. The DTD for a document consists of both subsets taken together.&quot;<p>You can import a DTD to create an association between the DTD and the document&#39;s logical structure, using the Load DTD menu command in the Structure pane. This associates the DTD with the logical structure of the document. New tags are created (see Tags) from an element type declaration, if they are not already in the tag list.<p>After associating a DTD with the document, you can validate the logical structure of a document against the DTD. The user interface for this is shown in the figure in Validation window.<p>Once you load a DTD, you can validate the logical structure against the DTD, to determine the extent to which the document&#39;s structure violates the constraints expressed in the grammar represented by the DTD. See Section &quot;5.1 Validating and Non-Validating Processors&quot; in the XML 1.0 specification.<p>The API does not support validating the logical structure of an InDesign document against an XML schema (<a href="http://www.w3.org/TR/xmlschema-0">http://www.w3.org/TR/xmlschema-0 </a>).<p>If you import a DTD, a new element is created in the logical structure, and new tags are created as needed. A sample DTD is shown in the following example. This was associated with the logical structure of a document after importing the minimal XML from Importing a minimal XML file. <div class="fragment"><div class="line">&lt;!ELEMENT article (title, body?)&gt;</div><div class="line">&lt;!ELEMENT body (subhead &acirc;&#148;&#130; para)+&gt;</div><div class="line">&lt;!ELEMENT title (#PCDATA)&gt;</div><div class="line">&lt;!ELEMENT subhead (#PCDATA)&gt;</div><div class="line">&lt;!ELEMENT para (#PCDATA)&gt;</div></div><p><b>Architecture</b><p>The DTD associated with the logical structure of an InDesign document is represented by an instance of <a class="el" href="classk_x_m_l_d_t_d_boss.html">kXMLDTDBoss</a>. When present, this instance is a child of the document element (<a class="el" href="classk_x_m_l_document_boss.html">kXMLDocumentBoss</a>) and a peer of the root element. See the following figure for an object diagram showing relationships between objects representing the logical structure of a minimal InDesign document. The UML diagram in the following figure shows objects representing the logical structure when a DTD is imported into the document. <a class="el" href="classk_x_m_l_d_t_d_boss.html">kXMLDTDBoss</a>, as a participant in the logical structure, has the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface; however, it does not have children and has no associated tag.<div class="image"><img alt="plugin-programming-guide-vol2-65.gif" src="plugin-programming-guide-vol2-65.gif" /></div><h3><a class="anchor" id="id_processing_instructions_and_comments"></a> Processing instructions and comments</h3><p>An XML comment stores text that is not considered part of the document content, but that may be relevant when authoring. XML comments are defined in the XML 1.0 specification (<a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml </a>) as follows: &quot;Comments may appear anywhere in a document outside other markup; in addition, they may appear within the document type declaration at places allowed by the grammar. They are not part of the document&#39;s character data ....&quot;<p>XML comments can occur anywhere in the logical structure that is legal within the XML specification. An XML comment appears in the XML data like this: <div class="fragment"><div class="line">&lt;!-- This is a comment --&gt;</div></div><p>Processing instructions (PIs) also store text that is not considered part of the document content, but the content may be relevant to an XML processor. Processing instructions are defined in the XML specification as follows:&quot;PIs are not part of the document&#39;s character data, but must be passed through to the application. The PI begins with a target (PITarget) used to identify the application to which the instruction is directed.&quot;<p>Processing instructions allow XML-based documents to contain instructions for applications that know how to process them. It is possible to create new processing instructions anywhere in the logical structure. A processing instruction appears in the XML data like this: <div class="fragment"><div class="line">&lt;?xml-stylesheet href=<span class="stringliteral">&quot;copy-with-contxt-sens-styling.xsl&quot;</span> type=<span class="stringliteral">&quot;text/xsl&quot;</span>?&gt;</div></div><p>This processing instruction directs an XML application to choose a particular XSL stylesheet if applying an XSL transform to the XML content.<p>The following figure shows how an XML comment and processing instruction are rendered in the structure view. <div class="image"><img alt="img-xml-comment-and-pi.gif" src="img-xml-comment-and-pi.gif" /></div><p><b>Architecture</b><p>An XML comment is associated with one string. Comments are represented by <a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a>, with the text stored by an implementation of <a class="el" href="class_i_string_data.html">IStringData</a>. On the other hand, a processing instruction appears to the user as a pair of strings, one specifying the target for the processing instruction and the other specifying the data. Processing instructions are represented by <a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a>; there are two <a class="el" href="class_i_string_data.html">IStringData</a> interfaces implemented by this class, (IID_IXMLPITARGET, IID_IXMLPIDATA) storing strings representing the key (target) and value (data).<p>The <a class="el" href="classk_x_m_l_comment_boss.html">kXMLCommentBoss</a> and <a class="el" href="classk_x_m_l_p_i_boss.html">kXMLPIBoss</a> boss classes have implementations of the <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a> interface (through inheritance) and are part of the logical-structure tree. Comment and processing-instruction elements support some but not all properties of other XML elements. For example, you cannot add attributes to a comment or processing instruction, and there is neither a valid content-item reference nor a valid tag reference for a comment or processing instruction.<h3><a class="anchor" id="id_structural_container_elements"></a> Structural (container) elements</h3><p>You can add new elements to the logical structure of a document using the structure view and its associated menu. Elements created in this way are not immediately associated with content items and are, therefore, unplaced.<p>Unplaced elements can be placed from the logical structure onto the layout manually or programmatically, but sometimes it is useful to retain unplaced elements as structural or container elements.<p>For example, suppose a publication is a collection of sections (for example, &quot;Arts&quot; and &quot;Motoring&quot;), each comprising one or more articles. You could model this with a Section element that consists of a set of Article elements; the Section element might never itself have any content but instead be used to structure the collection of Article elements. The Section element is a logical element of the publication, rather than a content-related element.<p>The XML template for this publication might be set up as shown in the following figure. The Article elements appear as placed content, because we tagged some stories with Article tags; these stories are placeholders into which the XML-based data would be imported.<div class="image"><img alt="plugin-programming-guide-vol2-66.gif" src="plugin-programming-guide-vol2-66.gif" /></div><p><b>Architecture</b><p>Structural elements differ from elements representing placed content only insofar as structural elements do not have a valid content-item reference (<a class="el" href="class_i_i_d_x_m_l_element.html#aa68f0629d9816b9d996e743d5c5c5673">IIDXMLElement::GetContentReference</a>). However, structural elements should have a valid tag reference (<a class="el" href="class_i_i_d_x_m_l_element.html#ae385c1284d3155bfd7e09b170ad93b31">IIDXMLElement::GetTagUID</a>).<h2><a class="anchor" id="id_xml-related_preferences"></a> XML-related preferences</h2><p>The XML subsystem is relatively complex, and there are several interfaces that store XML preferences. These can be grouped into workspace-level preferences and service-level preferences.<h3><a class="anchor" id="id_workspace-level_xml_preferences"></a> Workspace-level XML preferences</h3><p>There are some XML-related preferences (options) interfaces stored in workspaces (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). These are shown in the following table, along with low-level commands that enable them to be changed.<table class="doxtable"><tr><th>Interface </th><th>Responsibility </th><th><a class="el" href="class_command.html">Command</a> to process to change preference </th></tr><tr><td><a class="el" href="class_i_doc_structure_prefs.html">IDocStructurePrefs</a></td><td>Stores preferences like whether structure view is visible when the document is opened. </td><td><a class="el" href="classk_change_doc_structure_prefs_cmd_boss.html">kChangeDocStructurePrefsCmdBoss</a> to change the data, but you need to execute an action to change the structure-view state. </td></tr><tr><td><a class="el" href="class_i_general_x_m_l_preferences.html">IGeneralXMLPreferences</a></td><td>Stores tagging preferences in the session workspace, like default tag name for story, table, and cell. </td><td><a class="el" href="classk_set_general_x_m_l_preferences_cmd_boss.html">kSetGeneralXMLPreferencesCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_structure_view_prefs.html">IStructureViewPrefs</a></td><td>Stores information related to the appearance of the structure view, like whether comments are visible. </td><td><a class="el" href="classk_change_structure_view_prefs_cmd_boss.html">kChangeStructureViewPrefsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_x_m_l_export_options.html">IXMLExportOptions</a></td><td>Stores XML export options in the workspace that control what gets written to the XML data. </td><td><a class="el" href="classk_change_x_m_l_export_options_cmd_boss.html">kChangeXMLExportOptionsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_x_m_l_export_session_options.html">IXMLExportSessionOptions</a></td><td>Stores XML export options in the session workspace related to viewing XML data after export. </td><td><a class="el" href="classk_change_x_m_l_export_s_options_cmd_boss.html">kChangeXMLExportSOptionsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_x_m_l_import_options.html">IXMLImportOptions</a></td><td>Stores XML import options in the workspace. </td><td><a class="el" href="classk_change_x_m_l_import_options_cmd_boss.html">kChangeXMLImportOptionsCmdBoss</a></td></tr><tr><td><a class="el" href="class_i_x_m_l_preferences.html">IXMLPreferences</a></td><td>Stores user-interface preferences related to XML. </td><td><a class="el" href="classk_show_tagged_frames_cmd_boss.html">kShowTaggedFramesCmdBoss</a>, <a class="el" href="classk_show_tag_markers_cmd_boss.html">kShowTagMarkersCmdBoss</a>, and <a class="el" href="classk_show_tag_options_cmd_boss.html">kShowTagOptionsCmdBoss</a></td></tr></table><p>In most cases, the command required to change a data interface is specified in the API Reference or can be deduced when inspecting the boss classes that aggregate a given interface.<p>The UML diagrams in the following figure show some of the interfaces involved in storing options for import and export of XML at the session level (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) or document level (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>).<div class="image"><img alt="plugin-programming-guide-vol2-67.gif" src="plugin-programming-guide-vol2-67.gif" /></div><p><b>Preferences related to structure view and other user-interface components</b><p>The <a class="el" href="class_i_doc_structure_prefs.html">IDocStructurePrefs</a> interface controls some properties of the structure view. <a class="el" href="class_i_doc_structure_prefs.html">IDocStructurePrefs</a> is present on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) and document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>). <a class="el" href="class_i_doc_structure_prefs.html">IDocStructurePrefs</a> stores preferences related to whether to show the structure pane and how wide it should be.<p>The <a class="el" href="class_i_structure_view_prefs.html">IStructureViewPrefs</a> interface (only on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores other properties of the structure view, like whether text snippets are to be shown. The <a class="el" href="class_i_x_m_l_preferences.html">IXMLPreferences</a> interface on the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) stores the visibility of tag markers, etc.<h3><a class="anchor" id="id_service-level_xml_preferences"></a> Service-level XML preferences</h3><p>Some services that aggregate the <a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a> interface are shown in the following table.<p>Object-specific preference interfaces related to XML:<table class="doxtable"><tr><th>Service and its responsibility </th><th>Semantics of its <a class="el" href="class_i_x_m_l_import_preferences.html">IXMLImportPreferences</a> interface </th></tr><tr><td><a class="el" href="classk_x_m_l_repeat_text_elements_match_maker_service_boss.html">kXMLRepeatTextElementsMatchMakerServiceBoss</a>, responsible for preserving story text styling when handling repeating elements. </td><td>0th preference is bool16, whether to turn on, kTrue by default. </td></tr><tr><td><a class="el" href="classk_x_m_l_throw_away_unmatched_right_match_maker_service_boss.html">kXMLThrowAwayUnmatchedRightMatchMakerServiceBoss</a>, responsible for discarding unmatched elements in the XML template. </td><td>0th preference is bool16, whether to turn on feature, kFalse by default. </td></tr><tr><td><a class="el" href="classk_x_m_l_throw_away_unmatched_left_match_maker_service_boss.html">kXMLThrowAwayUnmatchedLeftMatchMakerServiceBoss</a>, responsible for discarding incoming elements that have no match in the XML template. </td><td>0th preference is bool16, whether to turn on feature, kFalse by default. </td></tr><tr><td><a class="el" href="classk_x_m_l_importer_post_import_mapping_boss.html">kXMLImporterPostImportMappingBoss</a>, responsible for attribute-style mapping. </td><td>0th preference, bool16, kTrue by default. Specifies whether to delete namespace attribute (aid: for example) and the namespace attribute (xmlns:). </td></tr><tr><td><a class="el" href="classk_x_m_l_sparse_import_options_service_boss.html">kXMLSparseImportOptionsServiceBoss</a>, just stores a preference relating to sparse import. </td><td>0th preference, bool16, whether to use sparse import, kFalse by default. </td></tr><tr><td><a class="el" href="classk_x_m_l_linking_post_import_responder_boss.html">kXMLLinkingPostImportResponderBoss</a>, responsible for creating a link (<a class="el" href="classk_x_m_l_import_link_boss.html">kXMLImportLinkBoss</a>) to imported XML files. </td><td>0th preference, bool16, whether to create link, kFalse by default. </td></tr></table><h2><a class="anchor" id="id_key_client_api"></a> Key client API</h2><h3><a class="anchor" id="id_xml_suites"></a> XML suites</h3><p>Some suite interfaces that represent a fairly high level of abstraction over the XML subsystem can be used to program the XML features. We recommend you use these suites when possible when programming using the XML features:<ul><li><a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a> can be used to make a programmatic selection in the Structure pane. See also the extension pattern described in Custom suite for the structure view.<li><a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> can be used when there is a selection in the Structure pane. <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> lets you change the logical structure of a document at the node selected in the structure-view tree. If you are writing client code that involves the end user making active selections, this is one mechanism to modify the logical-structure tree. The methods on this suite interface delegate to the command facades (for example, <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a> and <a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a>).<li><a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a> can be used to apply tags to a selection, like a text range or graphic frames. <a class="el" href="class_i_x_m_l_tag_suite.html">IXMLTagSuite</a> also can be used for other purposes, like adding a processing comment to the document&#39;s logical structure. See Elements and content on page 180 and &quot;Processing instructions and comments&quot;.</ul><p>You can extend the application by writing a custom suite that is available when there is a selection in the Structure pane. See Extension patterns.<h3><a class="anchor" id="id_command_facades_and_utilities"></a> Command facades and utilities</h3><p>There are many command-related boss classes named kXML&lt;whatever&gt;CmdBoss, but in most cases, you do not need to process these low-level commands, as there are command facades in the XML API that encapsulate parameterizing and processing these commands.<p>Interfaces like <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a>, <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a>, <a class="el" href="class_i_x_m_l_mapping_commands.html">IXMLMappingCommands</a>, <a class="el" href="class_i_x_m_l_tag_commands.html">IXMLTagCommands</a>, and <a class="el" href="class_i_x_m_l_attribute_commands.html">IXMLAttributeCommands</a> are examples of command facades. These encapsulate processing of almost all the commands required by plug-in code. These interfaces are aggregated on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>; the smart pointer class <a class="el" href="class_utils.html">Utils</a> makes it straightforward to acquire and call methods on these interface. You can call their methods by writing code that follows this pattern: <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;IXMLElementCommands&gt;</a>()-&gt;MethodName(...)</div></div><p>When writing code that does not involve selection, always look first at the <a class="el" href="class_i_x_m_l_utils.html">IXMLUtils</a> or IXML&lt;whatever&gt; Commands interfaces, to see if there is a method that serves your purpose on one of these interfaces. By doing so, you can avoid the increased chance of confusion and error that comes with processing low-level commands. Of course, your use case may require you to process some low-level commands, if the facades do not provide all the functionality you require.<h2><a class="anchor" id="id_extension_patterns"></a> Extension patterns</h2><h3><a class="anchor" id="id_xml_acquirer"></a> XML acquirer</h3><p>Suppose you want to customize how InDesign obtains the XML data to be read by the standard import-XML file operation. For example, you might query your database to get XML-based data, and you want to allow InDesign to parse the XML data directly from a stream you open.<p><b>Architecture</b><p>An XML acquirer (<a class="el" href="class_i_x_m_l_acquirer_filter.html">IXMLAcquirerFilter</a>) lets you take control to create a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>) from which InDesign reads XML data, and optionally provide an entity resolver (<a class="el" href="class_i_s_a_x_entity_resolver.html">ISAXEntityResolver</a>) for InDesign to use when importing the XML data in your stream. An XML acquirer allows you to take control early in the XML-import sequence, to determine where the XML data comes from. An XML acquirer is a service provider, characterized by the <a class="el" href="class_i_x_m_l_acquirer_filter.html">IXMLAcquirerFilter</a> service interface. The ServiceID must be of type kAcquireXMLService; you can reuse the API implementation kXMLFilterServiceProviderImpl (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) for this.<p>XML import begins with a URL-style string that describes the XML source. This stage of the import process (see Import architecture) has the task of converting the XML source description into a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>). In the simplest case, the URL-style string is a path to a local file. In more complex cases, it could be an XQuery, any kind of URL, or a comma-separated values (CSV) file.<p>These different identifiers for the XML source are handled uniformly by the XML importer (<a class="el" href="classk_x_m_l_importer_boss.html">kXMLImporterBoss</a>). The XML importer takes the source string and sends it to each of the XML acquirer filters (<a class="el" href="class_i_x_m_l_acquirer_filter.html">IXMLAcquirerFilter</a>) in turn, until it finds one that can handle the string. Each filter examines the string and determines whether it can return a stream given the string.<p>The order in which the filters are called is undefined. The XML import mechanism of InDesign includes a file-based, XML-acquirer filter (<a class="el" href="classk_x_m_l_acquirer_text_filter_service_provider_boss.html">kXMLAcquirerTextFilterServiceProviderBoss</a>), and other filters can be added by third parties.<p>In theory, it should be possible to write a database connectivity acquirer to get XML data directly out of a database (or content-management system) into InDesign. The URL string has to be something that can be recognized by the target acquirer (and, hopefully, no one else). The URL can even be an instruction that points to another file with more instructions (for example, a binding file). The only thing the acquirer must do is return an XML stream in the end; the acquirer can process instructions, get some XML data, process it further, and finally return manipulated XML data if desired by the acquirer.<p>The import source is specified through data stored in the <a class="el" href="class_i_import_x_m_l_data.html">IImportXMLData</a> of the data object (<a class="el" href="classk_import_x_m_l_data_boss.html">kImportXMLDataBoss</a>), which encapsulates an <a class="el" href="class_i_d_file.html">IDFile</a>. To implement a custom acquirer, you can construct an <a class="el" href="class_i_d_file.html">IDFile</a> with an arbitrary path, then you can implement the <a class="el" href="class_i_x_m_l_acquirer_filter.html">IXMLAcquirerFilter</a> to interpret the path specified by the <a class="el" href="class_i_d_file.html">IDFile</a> to take whatever action you want. For example, you might plan to make a query on a server-based repository of some kind, then open a stream to a local file that you copied onto the machine from the server. The query could be specified or parameterized by information in the string you got back from IDFile::GetString, once you get inside your acquirer code (see <a class="el" href="class_i_import_x_m_l_data.html#a32e736bf721cc9a3056e6003e26d0880">IImportXMLData::GetImportSource</a>).<h3><a class="anchor" id="id_xml_transformer"></a> XML transformer</h3><p>Suppose you want to transform the incoming XML data using something like the InDesign built-in XSLT engine or a transformation engine of your own. The XML transformer is an extension pattern you can implement if you want to transform the XML data being imported. You have the choice of transforming the data when it is still a stream or when it has been turned into a DOM.<p><b>Architecture</b><p>The XML transformer (<a class="el" href="class_i_x_m_l_transformer.html">IXMLTransformer</a>) is an extension pattern for manipulating the incoming XML DOM. It is an opportunity for a third-party software developer to add elements, throw away others, and change the rest before the incoming XML data is matched against the existing XML template. An import transformer is a service provider characterized by the service interface <a class="el" href="class_i_x_m_l_transformer.html">IXMLTransformer</a> and signature interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The ServiceID must be of type kXMLImporterTransformerService; you can reuse the API implementation kXMLImportTransformerSignalServiceImpl (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) for this.<p>You can transform the inbound XML data in one or both of two phases:<ul><li>The first phase is while there is a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>); you can apply an XSLT transform to the inbound stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>) of XML-based data and turn it into another stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>). See <a class="el" href="class_i_x_m_l_transformer.html#a0944003e027c7bd28fca2dc84d5470b5">IXMLTransformer::TransformStream</a>.<li>The second phase occurs immediately after the DOM is created. During this phase, you can manually manipulate the DOM by inserting, removing, and changing elements. See <a class="el" href="class_i_x_m_l_transformer.html#afd6669ce1801aeb340c7692a2afad88d">IXMLTransformer::TransformDOM</a> and <a class="el" href="class_i_i_d_x_m_l_d_o_m_document.html">IIDXMLDOMDocument</a>.</ul><h3><a class="anchor" id="id_xml-import_matchmaker"></a> XMl-import matchmaker</h3><p>Suppose you want to customize how the XML template is matched against the incoming XML data.<p><b>Architecture</b><p>This is a service that participates in XML import, to determine how the incoming XML is matched against the XML template (document) into which the XML is imported. An import matchmaker is a service provider characterized by the service interface <a class="el" href="class_i_x_m_l_import_match_maker.html">IXMLImportMatchMaker</a> and signature interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The ServiceID must be of type kXMLImportMatchMakerSignalService; you can reuse the API implementation kXMLImportMatchMakerSignalServiceImpl (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) for this.<p>An XML-import matchmaker service (<a class="el" href="class_i_x_m_l_import_match_maker.html">IXMLImportMatchMaker</a>) is responsible for determining the behavior of InDesign when importing XML-based data into an XML template that has structure which provides a partial match for the inbound XML data. For example, the features to throw away unmatched existing or inbound are implemented by matchmaker services. In theory, you can implement a custom XML-import matchmaker to specialize how matching against an XML template is performed.<h3><a class="anchor" id="id_post-import_responder"></a> Post-import responder</h3><p>Suppose you want to perform an operation just after the XML data is imported and the logical structure created, like placing images based on information in the logical structure. Rather than having to write your own code to traverse the logical structure after import, there is an extension pattern that lets you be called when the logical structure of the document is being traversed, just after the DOM is completed.<p><b>Architecture</b><p>A post-import iterator (<a class="el" href="class_i_x_m_l_post_import_iteration.html">IXMLPostImportIteration</a>) is a type of responder (<a class="el" href="class_i_responder.html">IResponder</a>) that is signalled during XML import. An post-import iterator is a service provider; specifically, it is a responder service, characterized by the service interface <a class="el" href="class_i_x_m_l_post_import_iteration.html">IXMLPostImportIteration</a> and signature interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The ServiceID must be of type kXMLPostImportIterationService; you can reuse the API implementation kXMLPostImportIterationServiceProviderImpl (<a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) for this.<p>A lot of post-processing tasks are of the form &quot;go through the logical structure. and if you see &lt;something&gt;, do &lt;whatever&gt;.&quot; The iterator allows you to do this without writing the iteration itself, while taking as little penalty in performance as possible. Essentially, InDesign iterates over the structure one time and calls all the clients when every node is visited. If your task is simple and localized, this is a good choice, because all you would write is your specialized code. If you require, you can still write a full post-import processor of your own design and iterate over the whole structure yourself.<p>Features of the application like tag-to-style mapping are implemented using a post-import iterator.<h3><a class="anchor" id="id_custom_suite_for_the_structure_view"></a> Custom suite for the structure view</h3><p>Suppose you want to allow some operations to be performed whenever there is a selection of one or more nodes in the logical structure. For example, suppose you want to let an end user verify the image references in the nodes selected in the structure view, perhaps through a context-sensitive menu item that is present or enabled only when nodes are selected.<p><b>Architecture</b><p>A custom suite for the structure view lets your code be called only when there is a node-selection target (<a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a>) in the structure view. You can follow the pattern of <a class="el" href="class_i_x_m_l_structure_suite.html">IXMLStructureSuite</a> (refer to the API Reference for that interface). To implement a custom suite for the structure view:<ol type="1"><li>Add an appropriate implementation of your custom suite to <a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a> (ASB, abstract-selection boss class).<li>Add an appropriate implementation of your custom suite in to <a class="el" href="classk_x_m_l_structure_suite_boss.html">kXMLStructureSuiteBoss</a> (CSB, concrete-selection boss class).</ol><p>When you implement a custom suite, it gives you access to the nodes selected in the structure view through <a class="el" href="class_i_x_m_l_node_target.html">IXMLNodeTarget</a>, through your add-in to the concrete-selection boss class <a class="el" href="classk_x_m_l_structure_suite_boss.html">kXMLStructureSuiteBoss</a>.<h3><a class="anchor" id="id_sax-content_handler"></a> SAX-content handler</h3><p>Suppose you want to load a configuration from an XML file that contains information relevant only to your plug-ins and does not specify document content.<p><b>Architecture</b><p>A custom SAX-content handler (<a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a>) lets you take control when XML is being parsed by the XML-parser service early in the XML-import service. This extension pattern can be used to read configuration data from an XML file, for example.<p>A SAX-content handler is not (any longer) a service. Your main requirement is to register with the SAX services (<a class="el" href="class_i_s_a_x_services.html">ISAXServices</a>) of the SAX parser (<a class="el" href="classk_x_m_l_parser_service_boss.html">kXMLParserServiceBoss</a>).<p>There are several instances of SAX-content handlers (for example, parsing the tag list, itself an XML file). Refer to <a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a> in the API Reference and note the boss classes that expose this interface.<p>See <a href="http://sax.sourceforge.net">http://sax.sourceforge.net </a> for information about the Simple API for XML (SAX).<h3><a class="anchor" id="id_sax_dom_serializer_handler"></a> SAX DOM serializer handler</h3><p>Suppose you want to take control when XML is being imported and the XML DOM is being serialized into the document, and you want to handle the parsing of XML content for some custom elements, to let you create some document content.<p><b>Architecture</b><p>A custom, SAX DOM serializer handler lets you take control when the XML DOM is imported and is being serialized (written) into the document. If you implement this extension pattern, you can choose how particular elements in the DOM are written into the document; for example, you can create custom content. This is done for tables and Ruby annotations.<p>A SAX DOM serializer handler is a service provider characterized by the service interface <a class="el" href="class_i_s_a_x_d_o_m_serializer_handler.html">ISAXDOMSerializerHandler</a> and signature interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The ServiceID must be of type kXMLContentHandlerService; you can reuse the API implementation kXMLContentServiceProviderImpl (implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>) to do this.<h3><a class="anchor" id="id_custom-tag_service"></a> Custom-tag service</h3><p>Suppose you have custom content in the XML file that is created programmatically on export, and you do not want end users to be able to apply the tags based on the element names in your custom content.<p><b>Architecture</b><p>A tag service is given the opportunity to handle elements in an XML stream that has been opened for reading element names to be used as tags.<p>A tag service is a service provider that is closely related to the SAX-content-handler service. A tag service is characterized by the service interface <a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a> and interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>, which should yield a ServiceID of kXMLTagHandlerService. You can reuse the API implementation kXMLTagServiceProviderImpl to achieve this.<p>For example, you may be using a tag service to filter out names of custom elements you do not want to appear in the tag list. In this case, you would provide a minimal implementation of <a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a> that registers your handler for the elements you want to filter out and claims to handle a subtree. You then do not need to do anything when sent the other <a class="el" href="class_i_s_a_x_content_handler.html">ISAXContentHandler</a> messages for elements for which you do not want tags to be created.<h3><a class="anchor" id="id_sax-entity_resolver"></a> SAX-entity resolver</h3><p>Suppose you want to customize how external entities are resolved by the InDesign SAX parser. An external entity needs to have an associated PUBLIC or SYSTEM identifier, which can be translated to something like a <a class="el" href="class_u_r_i.html">URI</a>, which should point at the input source where the entity is defined: &quot;Attempts to retrieve the resource identified by a URI MAY be redirected at the parser level (for example, in an entity resolver)&quot;<p>See the XML specification (<a href="http://www.w3.org/TR/REC-xml">http://www.w3.org/TR/REC-xml </a>, section 4.2.2) for a definition of &quot;external entity.&quot;<p><b>Architecture</b><p>If you implement a custom entity resolver for external entities, it is your responsibility to create a stream (<a class="el" href="class_i_p_m_stream.html">IPMStream</a>) to the input source where the entity is defined, when passed a PUBLIC or SYSTEM identifier for the entity. An entity resolver is characterized by the <a class="el" href="class_i_s_a_x_entity_resolver.html">ISAXEntityResolver</a> interface.<p>You create an instance of the boss class you defined with your own implementation of <a class="el" href="class_i_s_a_x_entity_resolver.html">ISAXEntityResolver</a> when needed; for example, when implementing an XML acquirer (<a class="el" href="class_i_x_m_l_acquirer_filter.html#a544fd598d179d9ce9cbe421e90fb3437">IXMLAcquirerFilter::CreateStreamAndResolver</a> or CreateResolver).<h3><a class="anchor" id="id_xml-export_handler"></a> XML-export handler</h3><p>Suppose you want to control the output of some XML elements when they are being exported; for example, you want to alter the structure of XML file for some custom elements, to better fit your needs.<p><b>Architecture</b><p>A custom, XML-export handler lets you control the output. If you implement this extension pattern, you can choose how particular elements in the document are written into the XML file.<p>An XML-export handler is a service provider characterized by the service interface <a class="el" href="class_i_x_m_l_export_handler.html">IXMLExportHandler</a> and signature interface <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>. The ServiceID must be of type kXMLExportHandlerSignalService; you can reuse the API implementation kXMLExportServiceImpl (implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a>).<p>To customize the output of an element or elements, override the CanHandleElement method to return true for the element, and override other methods to write custom content to the output.<h2><a class="anchor" id="id_commands_and_notification"></a> Commands and notification</h2><h3><a class="anchor" id="id_backing_store_and_notification_of_changes_in_logical_structure"></a> Backing store and notification of changes in logical structure</h3><p>When the logical structure of a document changes, the commands that change the logical structure send notification about changes in the backing store. The subject for notifications about change in the logical structure is a UID-based object (instance of <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>).<p>You can acquire the backing store with IXMLUtils::GetBackingStore and query for its <a class="el" href="class_i_subject.html">ISubject</a> interface. Once you have the <a class="el" href="class_i_subject.html">ISubject</a> interface, you can attach an observer and listen for changes of interest in the usual pattern.<p><a class="el" href="class_command.html">Command</a> output can be stored in the item list of a command boss object on output, which is sent as the changedBy parameter in the <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message. When implementing an observer, you can cast the changedBy parameter of the Update method to an interface pointer of type ICommand*, as shown below: <div class="fragment"><div class="line"><a class="code" href="class_i_command.html">ICommand</a>* iCommand = (<a class="code" href="class_i_command.html">ICommand</a>*)changedBy;</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_u_i_d_list.html">UIDList</a> itemList = iCommand-&gt;<a class="code" href="class_i_command.html#ae79d72983e213d0c7acb0d6757a08fec">GetItemListReference</a>();</div></div><p>When the command output shows the output is stored in an interface on the command (for example as an <a class="el" href="class_x_m_l_reference.html">XMLReference</a>), you might write code like this: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IXMLReferenceData&gt;</a> cmdData(iCommand, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span>(cmdData) {</div><div class="line"><a class="code" href="class_x_m_l_reference.html">XMLReference</a> xmlRef = cmdData-&gt;GetReference();</div><div class="line"> ...</div><div class="line">}</div></div><h2><a class="anchor" id="id_entities_supported"></a> Entities supported</h2><p>Standard entities supported by default by the XML subsystem are shown in the following table. If you need to support a wider set - like the entire ISO-LATIN 1 set of character entities (for example, &amp;174; for &amp;#8482;) - you can use them with the applications if they are defined in the DTD. For example, Simplified DocBook (<a href="http://www.oasis-open.org/docbook/xml/simple/sdocbook">http://www.oasis-open.org/docbook/xml/simple/sdocbook </a>) contains additional entity definitions within its DTD to support ISO-LATIN 1.<table class="doxtable"><tr><th>Entity </th><th>Meaning </th><th>Description </th></tr><tr><td>&amp;amp; </td><td>&amp; </td><td>Ampersand </td></tr><tr><td>&amp;lt; </td><td>&lt; </td><td>Less than </td></tr><tr><td>&amp;gt; </td><td>&gt; </td><td>Greater than </td></tr><tr><td>&amp;apos; </td><td>&#39; </td><td>Apostrophe </td></tr><tr><td>&amp;quot; </td><td>&quot; </td><td>Quote </td></tr><tr><td>&amp;#xa; </td><td>CR </td><td>Character replacement entity for carriage return </td></tr><tr><td>&amp;#xd; </td><td>LF </td><td>Character replacement entity for line feed </td></tr></table><h2><a class="anchor" id="id_assets_from_xslt_example"></a> Assets from XSLT example</h2><p>Basic grammar for article-based publications <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line">&lt;!ELEMENT publication (article)+&gt;</div><div class="line">&lt;!ELEMENT article (article-title, body)&gt;</div><div class="line">&lt;!ELEMENT body (title &acirc;&#148;&#130; subhead &acirc;&#148;&#130; para)+&gt;</div><div class="line">&lt;!ELEMENT article-title (#PCDATA)&gt;</div><div class="line">&lt;!ELEMENT title (#PCDATA)&gt;</div><div class="line">&lt;!ELEMENT subhead (#PCDATA)&gt;</div><div class="line">&lt;!ELEMENT emphasis (#PCDATA)&gt;</div><div class="line">&lt;!ENTITY % pub.content <span class="stringliteral">&quot;#PCDATA&quot;</span>&gt;</div><div class="line">&lt;!ELEMENT para (%pub.content; &acirc;&#148;&#130; emphasis)*&gt;</div></div><p>Fragment of XSL Stylesheet to Convert NITF to Basic Pub <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div><div class="line">&lt;xsl:stylesheet version=<span class="stringliteral">&quot;1.0&quot;</span> xmlns:xsl=<span class="stringliteral">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>&gt;</div><div class="line"> &lt;xsl:strip-space elements=<span class="stringliteral">&quot;*&quot;</span>&gt;&lt;/xsl:strip-space&gt;</div><div class="line"> &lt;xsl:output method=<span class="stringliteral">&quot;xml&quot;</span> omit-xml-declaration=<span class="stringliteral">&quot;yes&quot;</span>/&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;text()&quot;</span>&gt;</div><div class="line"> &lt;xsl:value-of select=<span class="stringliteral">&quot;normalize-space(.)&quot;</span>/&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;/&quot;</span></div><div class="line"> &gt;&lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;!-- include content from these elements --&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;nitf&acirc;&#148;&#130;block&acirc;&#148;&#130;body.head&acirc;&#148;&#130;ul&quot;</span>&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;!-- exclude content we are not interested in with <span class="keyword">this</span> empty <span class="keyword">template</span> --&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;*&quot;</span>/&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;body&quot;</span>&gt;</div><div class="line"> &lt;article&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/article&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;body.content&quot;</span>&gt;</div><div class="line"> &lt;body&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/body&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;p&quot;</span>&gt;</div><div class="line"> &lt;para&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/para&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;hedline&quot;</span>&gt;</div><div class="line"> &lt;article-title&gt;</div><div class="line"> &lt;xsl:value-of select=<span class="stringliteral">&quot;hl1&quot;</span>/&gt;</div><div class="line"> &lt;/article-title&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;hl1&quot;</span>&gt;</div><div class="line"> &lt;title&gt;</div><div class="line"> &lt;xsl:value-of select=<span class="stringliteral">&quot;.&quot;</span>/&gt;</div><div class="line"> &lt;/title&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;nitf-table&quot;</span>&gt;</div><div class="line"> &lt;para&gt;</div><div class="line"> &lt;emphasis&gt;Table omitted on <span class="keyword">import</span>&lt;/emphasis&gt;</div><div class="line"> &lt;/para&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;hl2&quot;</span>&gt;</div><div class="line"> &lt;subhead&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/subhead&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;em&quot;</span>&gt;</div><div class="line"> &lt;emphasis&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt; </div><div class="line"> &lt;/emphasis&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;org&quot;</span>&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;emphasis&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/emphasis&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line"> &lt;xsl:<span class="keyword">template</span> match=<span class="stringliteral">&quot;li&quot;</span>&gt;</div><div class="line"> &lt;para&gt;</div><div class="line"> &lt;xsl:apply-templates&gt;&lt;/xsl:apply-templates&gt;</div><div class="line"> &lt;/para&gt;</div><div class="line"> &lt;xsl:text&gt;&lt;/xsl:text&gt;</div><div class="line"> &lt;/xsl:<span class="keyword">template</span>&gt;</div><div class="line">&lt;/xsl:stylesheet&gt;</div></div><h2><a class="anchor" id="id_limitations_of_the_indesign_xml_architecture"></a> Limitations of the InDesign XML architecture</h2><p>The architecture is detailed and has a broad client API and many extension patterns, but there are known limitations you should be aware of, which could make implementing particular XML-based workflows tricky or impossible.<p>Specifically, XML elements associated with graphics cannot have dependents. The model for representing logical structure does not allow you to have a subtree of elements that depend on the element linked to a graphic item.<h1><a class="anchor" id="id_snippet_fundamentals"></a> Snippet Fundamentals</h1><p>A snippet is a logically complete fragment of an InDesign document, expressed in one of two XML formats, INX (.inds or .incx file extensions) or IDML (.idms or .icml file extensions). INX-based snippets were introduced in InDesign CS, but because of the complexity of the format, we did not recommend using them to generate and manipulate content outside of InDesign. IDML- and IDML-based snippets were designed for these purposes. This chapter describes the snippet architecture and the organization of snippets for different asset types, and it relates this to the low-level (boss) document object model (DOM). The snippet architecture is the basis for the asset library in InDesign, which is a collection of snippets in a binary container. The chapter discusses implications of the change to this snippet architecture if you store your own persistent data in documents.<p>In addition to explaining what snippets are, the chapter describes the organization of some snippets, identifies use cases involving snippet, and provides implementation hints.<h2><a class="anchor" id="id_conceptual_overview"></a> Conceptual overview</h2><h3><a class="anchor" id="id_snippets_as_self-contained_assets"></a> Snippets as self-contained assets</h3><p>Snippets are a feature added to InDesign to support factoring a document into components that become self-contained assets. One special application of this is an InCopy story. A snippet is a logically complete fragment of an InDesign document, saved in either InDesign Interchange format (INX) or InDesign Markup Language (IDML). Both are XML-based formats. INX-based snippet files have the extension .inds (or .incx for InCopy stories). IDML-based snippet files have the extension .idms, (or .icml for InCopy stories).<p>The snippet architecture allows a subset of the objects in a document (and their dependencies) to be imported into a snippet file, which can be exported to another document. Features like assignments depend on snippets to factor document content into XML documents, each of which represents a subset of the information in the original InDesign document.<p>The asset-library subsystem takes advantage of the snippet architecture, reinforcing the notion of a snippet as an asset. An InDesign library is a collection of snippets in a binary container. If you store persistent data in InDesign documents (for example, through adding your own persistent interfaces to page items), you must make sure this content roundtrips through snippets, by adding scripting support to your plug-in. See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a>.<p>Snippets can contain page items, swatches, styles, XML tags, XML elements, and application preferences. If you understand how to export and import snippets, you can assemble most of the contents in an InDesign document from snippets. To make the process more straightforward, see the procedures in <a class="el" href="id_solutions.html#id_snippets">Snippets</a>.<h3><a class="anchor" id="id_snippet_types"></a> Snippet types</h3><p>Snippets can-in one format-represent information previously exported from InDesign in several quite different (and often opaque binary) formats. The object types that can be exported from InDesign include the following:<ul><li>Page items, like text frames, group items, and placed images<li>XML elements<li>Preferences<li>InCopy stories</ul><p>These reduces to a handful of basic snippet types, described in Snippet types and policies.<h3><a class="anchor" id="id_features_that_depend_on_snippets"></a> Features that depend on snippets</h3><p>Several subsystems and features depend on the snippet architecture:<ul><li>Assets are stored as snippets in a library database file (.indl file). The database is a binary file; however, within a database, assets are snippets.<li>Assignments depend on the ability to factor out document content into distinct assets as snippet files.<li>InCopy Interchange (INCX) and InCopy Document (ICML) files are both snippet files.<li>Object styles are stored in a snippet file. Load Object Styles reads in styles defined in a snippet file.</ul><h2><a class="anchor" id="id_user_interface_for_snippets"></a> User interface for snippets</h2><p>The snippet architecture is more a foundation technology than a feature, so there is relatively little user interface to let you interact directly with snippets; however, there are a few places where snippets show up in the user interface, directly or indirectly.<h3><a class="anchor" id="id_drag_and_drop"></a> Drag and drop</h3><p>You can drag a snippet file onto the InDesign layout view, and the application takes appropriate action. For example, if the snippet file contains a text style, a new text style may be created if one matching the specification does not already exist. If you drag a snippet file defining a group item with many page-item dependents, a new group item with dependents is created in the InDesign document.<p>An end user can create a new snippet file on the desktop, by dragging a layout object from an InDesign document onto the desktop. An end user also can drag an XML element from the structure view to the desktop, to create a snippet on the desktop.<p>The snippet format is the primary representation for chunks of InDesign content for data exchange. The user interface now strictly uses IDML-based (IDMS) snippets. You can still generate INX-based (INDS) snippets using the API.<h3><a class="anchor" id="id_asset_library"></a> Asset library</h3><p>The asset library depends on page items being represented as snippets. An InDesign library (INDL) file is a binary file containing a collection of snippets, and the Library panel can be considered a view onto the snippets it contains.<p>When an asset is dragged from the library onto a document, the snippet is imported into the document, and the new content is created. When an asset is dragged from a document into a library or added through a menu item in the Library panel menu, the content is written to the library file in a block of XML contained within the (binary) library.<h3><a class="anchor" id="id_export_snippet_from_selection"></a> Export snippet from selection</h3><p>You can export snippets under certain selection conditions, including the existence of a layout selection (page items) or structure-view selection (XML elements). You can export an InCopy story (ICML or INCX) when there is a text selection. The snippet-export provider is responsible for serializing page items to snippet files after drag and drop. This export provider depends on the suite <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>. (See Client API.) For more information about the selection architecture, see <a class="el" href="id_solutions.html#id_selection">Selection</a>.<h2><a class="anchor" id="id_snippet_model"></a> Snippet model</h2><p>Snippets contain collections of XML fragments that represent document content. What makes snippet files interesting is that they are standalone representations of document assets (for example, a styled page item) that can be imported into another document. The precise collection of XML fragments that compose a snippet depends on the objects you want to export into the snippet and the objects on which it depends.<p>The objects represented in the snippet file are instances of classes in the scripting-level DOM. Deciding what goes into a snippet file and understanding what is represented there requires knowledge of the low-level boss DOM. Understanding what happens when a snippet file is imported requires knowledge of the low-level boss DOM.<h3><a class="anchor" id="id_inx_idml_and_snippets"></a> INX, IDML, and snippets</h3><p>INX and IDML are XML-based formats that represent InDesign content at a higher level of abstraction than the low-level binary InDesign document (INDD) files. These higher level files contain a collection of XML elements that represent an entire InDesign document, created by serializing the scripting DOM for a document instance.<p>A major benefit of this representation is that the scripting DOM is stable relative to the low-level (boss) document model. A price to be paid for this higher level of abstraction (and XML-based format) is that it takes longer to read and write an INX- or IDML-based file than a binary InDesign (INDD) document. InDesign binary documents load data on demand, whereas the entire INX file must be loaded before it can be used.<p>A snippet file represents one or more root objects and their dependents in the document from which they came. A root object in this context does not mean the root of the entire document, but the root of a subtree within the scripting-DOM tree.<p>A root object must expose the <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interface. Parent-child relationships in a snippet come from ownership relations in the scripting DOM; however, as we will see in the examples, the elements in a snippet file have information that comes from the boss DOM (about UIDs, for example), and the relationship between the boss DOM and scripting DOM is predictable.<p>Although INCX, the INX-based InCopy story format, is still supported, the default file format for InCopy is ICML. The main difference between an INX or IDML file and a snippet file is that INX and IDML files represent complete InDesign documents, whereas a snippet file represents only a subset of the information in an InDesign document.<p>There are two things you need to know to work with snippets:<ul><li>How to acquire references to the objects you want to export as a snippet. Minimally, you need an <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interface on each root object you want to export in a given snippet and an export policy. For information on acquiring references to objects in the layout, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>.<li>Where to target the snippet import; that is, what DOM element (<a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>) you should use as the parent for the objects in the snippet to import. To understand how to do this, you need to understand the connection between the scripting DOM and the boss DOM, because you target a node in the scripting DOM on import.</ul><p>Generating a snippet from scratch is not easy. Snippets for even simple content page items are complex, owing to the need to serialize the graph of dependencies. We do not recommend generating INX-based snippets. If you need to generate snippets outside of InDesign, create IDML-based snippets. You still will have to be concerned with fulfilling all dependencies.<h3><a class="anchor" id="id_boss_dom_overview"></a> Boss DOM overview</h3><p>The InDesign DOM is relatively complex on the surface, but it is fundamentally simple. An InDesign (binary) document consists of the following:<ul><li>A set of persistent boss objects.<li>Relationships between the boss objects.<li>References to external content (images, fonts, etc.).</ul><p>You can consider an InDesign (binary) document as a serialized graph of boss objects. The boss DOM specifies InDesign documents at the level of boss classes and relationships between them. Sometimes the relationships are hard to express purely in terms of classes, and we visualize them in object diagrams to understand them better. See the chapter entitled <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_xml_fundamentals">XML Fundamentals</a>.<p>A boss object can represent a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), guide (<a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a>), frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>), etc. The binary document stores the persistent state of these boss objects, consisting of a hierarchy of objects on each spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) and a set of relationships between the boss objects.<p>One kind of relationship that can exist between boss objects is ownership, which is the same as the concept of composition in object-oriented literature: coincident lifetime of part and whole, composite object responsible for creation and destruction of parts. Boss objects can either own other objects (and manage their lifetimes) or refer to them.<p>Boss objects expose interfaces which provide their behavior, and if they have persistent implementations, store their state across instantiations of InDesign. The persistent interfaces determine exactly what data a given boss object stores in the document; for example, it may store references to other objects it depends on in some way or references to objects it owns.<p>Persistent implementations of interfaces on each boss class that participates in the boss DOM read and write the data in an InDesign binary document. The interfaces themselves are part of the low-level API for InDesign, which is fine-grained and extensive. This means an InDesign (binary) document is very tightly coupled to the low-level API.<h3><a class="anchor" id="id_scripting_dom_overview"></a> Scripting DOM overview</h3><p>Compared to the boss DOM, there is a more abstract way to represent an InDesign document, based on the notion of scriptable objects (<a class="el" href="class_i_script.html">IScript</a>). This level of abstraction is the scripting-DOM view of an InDesign document. This level of abstraction still involves the objects that are part of the end user&#39;s experience of an InDesign document (spreads, pages, frames, stories, etc.), but the representation is less closely tied to the boss objects you manipulate with the low-level API. There are several advantages of working at this level of abstraction:<ul><li>The classes in the scripting DOM have names with meaning within the application domain, rather than being associated with the implementation domain.<li>The weak coupling to the low-level API means you are somewhat shielded from changes in the low-level API. This made it easier to stabilize the format and insulate it from changes in the low-level API. Versioning also was built into the scripting DOM from its inception.<li>There are fewer entities in the scripting DOM than in the boss DOM.</ul><p>The concepts of ownership relationships between classes versus referential associations also exists in the scripting DOM and, therefore in snippets. These two types of associations are important when it comes to understanding what is in a snippet file.<h3><a class="anchor" id="id_from_boss_dom_to_scripting_dom"></a> From boss DOM to scripting DOM</h3><p>The low-level boss DOM is the ultimate truth as far as inDesign document is concerned, and the scripting DOM is an abstraction over that very fine-grained, low-level model. When you inspect snippet files, you will find information that comes directly from the boss DOM, like UIDs.<p>Information can appear in a snippet file only if some boss object with an <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interface generates it. As a C++ programmer, you inevitably work at the level of how scripting was implemented within the InDesign API, rather than at the consumer level. This means scripting appears as an additional complexity, but it provides a stable abstraction over the low-level boss document model.<p>Each script class has an identifier (ScriptElementID) defined in kScriptInfoIDSpace; this space is parallel with kClassIDSpace, where a boss ClassID is defined. If you consider the scripting DOM and boss DOM as distinct graphs, they have points of contact, where a node in the boss DOM also participates in the scripting DOM (for example, <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>), and there are points of difference (sometimes there is a proxy boss class, sometimes no boss class at all).<p>The <a class="el" href="class_i_script.html">IScript</a> and <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interfaces are exposed by any boss class that participates in the scripting DOM. The signature interface of a scriptable object, <a class="el" href="class_i_script.html">IScript</a>, provides the low-level API programmer with a bridge into the scripting object world. <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> can be used to traverse the scripting DOM for a given document instance.<h3><a class="anchor" id="id_snippet_types_and_policies"></a> Snippet types and policies</h3><p>The supported snippet types are listed in the following table.<table class="doxtable"><tr><th>Snippet type </th><th>Boss DOM source </th></tr><tr><td>ApplicationPreferences </td><td>Session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) preferences. </td></tr><tr><td>InCopyInterchange </td><td>From story (<a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>). InCopy default story format. </td></tr><tr><td>PageItem </td><td>A page item in the spread hierarchy (kSpreadBoss/ISpread). </td></tr><tr><td>XMLElement </td><td>XML elements (see <a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) and associated content, if elements are placed. </td></tr></table><h3><a class="anchor" id="id_export"></a> Export</h3><p><b>Application-preferences export</b><p>Exporting application preferences means serializing the state of preference objects that are dependents of the application-script object (kApplicationObjectScriptElement). See <a class="el" href="class_i_script_utils.html#add003dac01259319b653b5bea9f09000">IScriptUtils::QueryApplicationScript</a> and <a class="el" href="class_i_i_n_x_info.html#a43abd27b680287a05717847244647575">IINXInfo::IsPreferenceObject</a>. In terms of where these preferences are stored in the boss DOM, these are preferences stored in the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) as persistent interfaces.<p>The export policy for application preferences (<a class="el" href="classk_app_prefs_export_boss.html">kAppPrefsExportBoss</a>) would be specified explicitly only if you were trying to export a subset of application preferences, which is beyond the scope of this document. If you use methods like ISnippetExport::ExportAppPrefs, the policy is implicit. The exact behavior of the policy is beyond the scope of this document.<p>Application-preference export supports only INX-based snippets.<p><b>Document-element export</b><p>Exporting a document element means exporting something that is a fairly direct dependent of the document (<a class="el" href="class_i_document.html">IDocument</a>). For example, swatches are stored in the document workspace (<a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>), and these are exported as DocumentElement snippets.<p><b>Page-item export</b><p>Exporting a page-item snippet means exporting one or more root objects and dependents. For example, if you placed images or text frames containing content, exporting a page item gives you a self-contained representation of the page item that you can import into another document.<p>The page-item export policy contains rules including the following:<ul><li>If all frames of a story are chosen for export, the entire story is exported as a story element. The text contents for the entire story-including notes, tables, and tracked changes-is exported as children of the story element.<li>If some frames of a story are not chosen for export, a story element is not exported. The text contents for the frames chosen-including editorial notes, table, and tracked changes-that lie within the span of the text frames are exported as children of the text-frame elements.<li>Hyperlink sources are exported if the source exists in/on an exported page item. Hyperlink destinations are exported if the destination exists in/on an exported page item. Hyperlink page destinations are not exported. Hyperlinks are exported if the associated hyperlink source is exported, and destination references are set to nil if the destination is not exported.<li>Bookmarks are exported if the associated hyperlink destination is exported.</ul><p>A page-item snippet is exported from a layout selection (see <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>), or you can choose one or more page items by UID and export them using <a class="el" href="class_i_snippet_export.html">ISnippetExport</a>.<p><b>InCopy stories</b><p>Exporting in InCopy stories can be done either through the export provider for this format or by exporting a snippet with type InCopyInterchange and export policy <a class="el" href="classk_in_copy_interchange_export_boss.html">kInCopyInterchangeExportBoss</a>.<p>The export policy is very much the same as for a page item, with respect to how story content is handled, as described in Page-item export.<p>There is a high-level suite responsible for exporting snippets (<a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>). It exports an InCopyInterchange snippet if there is a text selection on export. If you used a lower-level API like <a class="el" href="class_i_snippet_export.html">ISnippetExport</a>, in which you must choose the document object from which to export, you would export from a story (rather than text frame); you would export a story by calling <a class="el" href="class_i_snippet_export.html#a8ab32a64ed46c6536ca787b36ebbcbdb">ISnippetExport::ExportInCopyInterchange()</a>.<p><b>XML-element export</b><p>The high-level suite responsible for exporting snippets (<a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>) can export XML elements selected in the structure view. If you use a lower-level API like <a class="el" href="class_i_snippet_export.html">ISnippetExport</a> to perform the export, you need to explicitly identify the objects to export by <a class="el" href="class_x_m_l_reference.html">XMLReference</a>. For more information on acquiring references to objects in the logical structure, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_xml_fundamentals">XML Fundamentals</a>. Use the XML-element export policy (<a class="el" href="classk_x_m_l_element_export_boss.html">kXMLElementExportBoss</a>) when exporting XML elements.<h3><a class="anchor" id="id_import"></a> Import</h3><p>Snippets are imported mostly as if they were standard INX or IDML files. Snippet-import policies are applied when importing a snippet, depending on the type of content in the snippet file. As a programmer, you need to decide what object in the boss DOM should parent the objects you are importing from the snippet. For example, if you import a page-item snippet and want the page items in it to be top-level items on a spread, you specify a particular spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) to parent the content. For most other snippet types, the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) is sufficient.<p>The snippet type is carried by processing instructions at the start of a snippet file. These are of the form &lt;?aid ... ?&gt;. See the table in Snippet types and policies for list of types that can occur. For example, if the snippet is a page item, the following processing instruction occurs: <div class="fragment"><div class="line">&lt;?aid SnippetType=<span class="stringliteral">&quot;PageItem&quot;</span>?&gt;</div></div><p>Importing snippets can be tricky for some snippet types, like XML elements, because you must decide the node in the scripting DOM that will parent the incoming content, and sometimes this is nontrivial to discover. When you import a snippet, you must choose a boss object to parent the snippet content that has <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> and <a class="el" href="class_i_script.html">IScript</a> interfaces that characterize participants in the scripting DOM. Some snippet types are easy, and the choice is the document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) or session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). Others require more work and a detailed understanding of how the scripting DOM works in terms of boss classes.<p><b>Application-preferences import</b><p>When you import application preferences, you need to identify an object that can parent the import. This is the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>). Suppose you opened a stream onto a snippet file containing &quot;ApplicationPreferences.&quot; You might import it by writing code like the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IScript&gt;</a> appScript(<a class="code" href="class_utils.html">Utils&lt;IScriptUtils&gt;</a>()-&gt;QueryApplicationScript());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDOMElement&gt;</a> rootElement( appScript, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;ISnippetImport&gt;</a>()-&gt;ImportFromStream(stream, rootElement);</div></div><p>The <a class="el" href="class_i_script_utils.html#add003dac01259319b653b5bea9f09000">IScriptUtils::QueryApplicationScript</a> method returns a reference to the session workspace (<a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>) in the boss DOM through its <a class="el" href="class_i_script.html">IScript</a> interface. The session workspace associates with the application script object (kApplicationObjectScriptElement) in the scripting DOM.<p>The import policy is complicated and beyond the scope of this document.<p><b>Page-item import</b><p>When importing a page item-like a placed image or text frame-you can target a Spread element in the scripting DOM. This supposes you want the page item to be a top-level page item.<p>In boss terms, this means targeting a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>) rather than the spread-layer boss (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>), the parent of top-level page items in the boss DOM.<p>A boolean interface, IID_ISNIPPETIMPORTUSESORIGINALLOCATIONPREF, was aggregated on both <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> and <a class="el" href="classk_doc_boss.html">kDocBoss</a> to determine whether the coordinates of the page item imported should be same as where it was exported from or a new location. The behavior also can be altered temporarily based on modifier key ALT/Option when the page item is imported via the user interface, such as via drag-and-drop and use-place-gun.<dl class="section note"><dt>Note<dd>If the snippet contains guides, all page items, together with the guides, are placed at the same location when they are exported.</dl><p>The import policy does very little, because most of the work is done by the page-item export policy during export.<p><b>InCopy-story import</b><p>When importing a story from an InCopy story snippet, you can go through the import provider, rather than trying to import the snippet directly. Importing InCopy stories directly using the low-level snippet API (<a class="el" href="class_i_snippet_import.html">ISnippetImport</a>) is not supported.<p><b>XML-element import</b><p>Deciding where in the scripting DOM an XML-element snippet should be parented is not straightforward. This is because XML elements are represented by proxy objects in the scripting DOM. That is, boss classes like <a class="el" href="classk_text_x_m_l_element_boss.html">kTextXMLElementBoss</a> that represent XML elements in the boss DOM do not have <a class="el" href="class_i_script.html">IScript</a> and <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interfaces. There are proxy boss classes that participate in the scripting DOM, and you need to specify one of these as the parent for incoming XML-element snippet content.<p>If you want to import an XML element into a specified location within the logical structure of an InDesign document, you must construct a proxy boss object (<a class="el" href="classk_x_m_l_item_proxy_script_object_boss.html">kXMLItemProxyScriptObjectBoss</a>), configure it correctly, and set this as the target for <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream</a>.<p>When you import a snippet containing XML elements, what happens depends on whether the exported XML elements were placed or all unplaced content. If the XML elements in the snippet were exported from placed elements, layout content is created on import.<p>The behavior of the import policy is beyond the scope of this document.<h2><a class="anchor" id="id_snippet_examples"></a> Snippet examples</h2><h3><a class="anchor" id="id_filled-rectangle_snippet"></a> Filled-rectangle snippet</h3><p>In this scenario, a new document was created, a document layer (red-layer) added, and a single page item created (with the Rectangle tool) on this layer. The rectangle had a swatch applied (C=15, M=100, Y=0, K=0). For information on exporting a page item programmatically, see <a class="el" href="id_solutions.html#id_snippets">Snippets</a>. Through the InDesign user interface, you can drag a page item to the desktop to create a PageItem snippet.<p><b>Boss-level model</b><p>We consider the key boss objects that represent this page item, then examine the organization of the snippet that results from exporting the asset. The objects referred to by a page item depend on what the page item is and what relationships it has with other objects in the document at the time of its export.<p>The object diagram in the following figure shows some of the objects that represent a rectangle page item. The page item is a top-level item that is a child of a spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>, with signature <a class="el" href="class_i_spread_layer.html">ISpreadLayer</a>). The spread layer is a child of a spread (<a class="el" href="classk_spread_boss.html">kSpreadBoss</a>). The spread layer class associates with a document layer (<a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a>, with signature <a class="el" href="class_i_document_layer.html">IDocumentLayer</a>). The document (<a class="el" href="classk_doc_boss.html">kDocBoss</a>, signature <a class="el" href="class_i_document.html">IDocument</a>) manages the spreads via <a class="el" href="class_i_spread_list.html">ISpreadList</a> and manages the document layers via <a class="el" href="class_i_layer_list.html">ILayerList</a>. The UID of the document layer and spline-item boss objects are shown, as these will appear in the snippet as object references.<p>Boss-object diagram for a rectangle page item:<div class="image"><img alt="plugin-programming-guide-vol2-68.gif" src="plugin-programming-guide-vol2-68.gif" /></div><p>The UML object diagram in the following figure shows relationships between objects that represent the fill color and object style (Basic Graphic Frame) of a rectangle page item.<p>Boss-object diagram for page-item style:<div class="image"><img alt="plugin-programming-guide-vol2-69.gif" src="plugin-programming-guide-vol2-69.gif" /></div><p><b>Snippet organization</b><p>When the filled-rectangle page item is exported as a snippet, a somewhat large XML file is generated. The contents depend on whether it is an IDML or INX snippet. Though this may seem to be a lot of data to specify a red rectangle, consider that the intent of a snippet is to provide a complete, standalone description of a collection of objects that can be imported into any other InDesign document. The first few and last few characters are shown in the following examples. This small percentage of the text shows some differences between the two formats. The IDML-based snippet has a document element called Document, while the INX-based example has a document element of SnippetRoot.<p>Example 1: IDML-based (IDMS) extraction: <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;?aid style=<span class="stringliteral">&quot;50&quot;</span> type=<span class="stringliteral">&quot;snippet&quot;</span>...?&gt;</div><div class="line">&lt;?aid SnippetType=<span class="stringliteral">&quot;PageItem&quot;</span>?&gt;</div><div class="line">&lt;Document DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span> Self=<span class="stringliteral">&quot;d&quot;</span>&gt;</div><div class="line">&lt;Color ...&lt;/Document&gt;</div></div><p>Example 2: Snippet-file extract: <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;?aid style=<span class="stringliteral">&quot;33&quot;</span> type=<span class="stringliteral">&quot;snippet&quot;</span>... ?&gt;</div><div class="line">&lt;?aid SnippetType=<span class="stringliteral">&quot;PageItem&quot;</span>?&gt;</div><div class="line">&lt;SnippetRoot&gt;</div><div class="line">&lt;color ... (other x,000 characters omitted)&lt;/SnippetRoot&gt;</div></div><p>Inspecting the raw XML data contained in an INX snippet file is not immediately illuminating (see the XML in the following figure, for example), so some XSLT transformations have been applied to render the data in a form that is easier to understand. The snippet file creating by exporting a rectangle page item was transformed with XSLT, using information from the <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a> file in the SDK as a translation table, to turn short names like &quot;crec&quot; into long names (Rectangle). The amount of information was reduced by filtering out all but the names of elements and some key attributes. The relationships between elements were represented as a graph of nodes (the elements) and edges (the links between them).<p>Subset of XML from filled-rectangle snippet: <div class="image"><img alt="plugin-programming-guide-vol2-70.gif" src="plugin-programming-guide-vol2-70.gif" /></div><p>The newer, IDML-based format is more readable. The example in the following figure is a similar subset, in actual IDML. <div class="image"><img alt="plugin-programming-guide-vol2-71.gif" src="plugin-programming-guide-vol2-71.gif" /></div><p>If we visualize the XML from the preceding figures as a graph showing a subset of the elements, we arrive at the following figure. The Rectangle object (kRectangleObjectScriptElement) from the scripting DOM corresponds to <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> in the boss DOM. The Color object (kColorObjectScriptElement) corresponds to <a class="el" href="classk_p_m_color_boss.html">kPMColorBoss</a> in the boss DOM. The Layer object (kLayerObjectScriptElement) corresponds to <a class="el" href="classk_document_layer_boss.html">kDocumentLayerBoss</a> (<a class="el" href="class_i_document_layer.html">IDocumentLayer</a>) in the boss DOM.<p>The following figure shows a subset of the elements in the snippet file exported from this document asset. The long names for the elements are shown. The Self attribute (shown as, for example, 0xaa rather than rc_uaa or u_123) corresponds to the UIDs for the boss objects shown in Filled-rectangle snippet. The snippet (scripting DOM) model is simplified relative to the boss model; there is no graphics-attribute object interposed between the page item and the object representing its color.<p>Relationships between elements in snippet representing a rectangle:<div class="image"><img alt="plugin-programming-guide-vol2-72.gif" src="plugin-programming-guide-vol2-72.gif" /></div><dl class="section note"><dt>Note<dd>In this figure, &quot;Root&quot; can be either Document (for IDML) or SnippetRoot (for INX).</dl><p>Two different views are shown of the elements and associations in a snippet file. This figure shows the key objects that were explicitly identified by UID in the figures in Filled-rectangle snippet.<h3><a class="anchor" id="id_image-item_snippet"></a> Image-item snippet</h3><p>A new document was created, and an image was placed in it. A page-item snippet was exported, based on the graphic frame containing the image. We examine both the low-level boss model for this and the organization of the snippet file. To create this through the InDesign user interface, you can select the frame containing the image and just drag the page item from the layout to the desktop. To do this programmatically, see <a class="el" href="id_solutions.html#id_snippets">Snippets</a>.<p><b>Boss-level model</b><p>The following figure contains an object diagram showing key boss objects that represent a placed (TIFF) image (<a class="el" href="classk_image_item.html">kImageItem</a>) in a graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>), and links between them (instances of associations between the boss classes). A low-resolution embedded proxy (<a class="el" href="classk_image_in_d_b.html">kImageInDB</a>) is stored in the document. The actual high-resolution image is referenced from a link (<a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>). In the interest of clarity, associations with objects of class <a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a> (which would own the <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> if it were a top-level page item) and so on are omitted.<div class="image"><img alt="plugin-programming-guide-vol2-73.gif" src="plugin-programming-guide-vol2-73.gif" /></div><p>A placed image is represented by the boss class (<a class="el" href="classk_image_item.html">kImageItem</a>), which can be found as a child of a graphic frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>). The image item (<a class="el" href="classk_image_item.html">kImageItem</a>) refers to both a link (through <a class="el" href="class_i_link_object.html">ILinkObject</a>) and an object that may store a proxy (through <a class="el" href="class_i_image_data_access.html">IImageDataAccess</a> or <a class="el" href="class_i_store_internal.html">IStoreInternal</a>).<p>The original high-resolution image placed is referenced by a link (<a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>), and the low-resolution image proxy may be stored by a boss object (<a class="el" href="classk_image_in_d_b.html">kImageInDB</a>). The embedded proxy is referenced either through <a class="el" href="class_i_store_internal.html">IStoreInternal</a> interface of the <a class="el" href="classk_image_item.html">kImageItem</a> object (for example, for PDF, EPS, and PICT) or by <a class="el" href="class_i_image_data_access.html">IImageDataAccess</a> (as in the TIFF example here and for other formats like JPEG).<p><b>Snippet organization</b><p>The complete snippet is quite complicated, but we can make sense of the picture by focusing on the objects in the scripting model and considering the relationships to the boss objects we saw in the preceding figure.<p>The frame is represented in the scripting DOM by a Rectangle object (kRectangleObjectScriptElement), and the image placed by an Image object (kImageObjectScriptElement). The scripting classes associate to <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> and <a class="el" href="classk_image_item.html">kImageItem</a> in the boss DOM. Consequently, when we inspect the snippet, we see a Rectangle, with child element Image. The link to a high-resolution image external to the InDesign file is maintained in the scripting DOM by a Link object (kLinkObjectScriptElement), which associates with <a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a> (in the case of a placed image file).<p>The object diagram in the following figure represents elements in the snippet file for a placed image. The Rectangle element has a Self attribute matching the UID of the <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> in the figure on page 219. The Image element has a Self attribute equal to the UID of the kImageItemBoss object in that figure. The Link object has a Self attribute corresponding to the UID of the link boss object (<a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>) in that figure. The ClippingPath and TextWrap elements correspond (approximately) to the <a class="el" href="class_i_clip_settings.html">IClipSettings</a> and <a class="el" href="class_i_stand_off_data.html">IStandOffData</a> interfaces on <a class="el" href="classk_image_item.html">kImageItem</a>, respectively.<p>Relationships between elements in snippet for a placed image:<div class="image"><img alt="plugin-programming-guide-vol2-74.gif" src="plugin-programming-guide-vol2-74.gif" /></div><dl class="section note"><dt>Note<dd>In the preceding figure, &quot;Root&quot; can be either Document (for IDML) or SnippetRoot (for INX).</dl><p>The Image element shown on page 220 has a dependent Link element, which maintains a link to the high-resolution image that was placed. This Link element stores approximately the data stored in or obtainable from a link boss object (<a class="el" href="classk_import_link_boss.html">kImportLinkBoss</a>); it stores a path to the file and other information, like link-import stamp and link-stored state. The snippet also maintains a low-resolution thumbnail of the image, but in the xap:Thumbnail metadata element, intended for consumers of the XMP format.<h3><a class="anchor" id="id_xml_element_snippet_tagged_placeholder"></a> XML element snippet, tagged placeholder</h3><p>Consider the scenario of creating one element in the logical structure as a tagged placeholder for an image to be placed later. We can examine the organization of a snippet obtained by exporting a placed element from the logical structure.<p><b>Boss-level model</b><p>This is described in some detail in <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_xml_fundamentals">XML Fundamentals</a>. Briefly, a tagged graphic placeholder is represented by a <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>, with a <a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a> child. Associations with XML elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) are maintained by the <a class="el" href="class_i_x_m_l_reference_data.html">IXMLReferenceData</a> on the placeholder (<a class="el" href="classk_place_holder_item_boss.html">kPlaceHolderItemBoss</a>). See the following figure.<p>Boss-object diagram for XML-tagged placeholder:<div class="image"><img alt="plugin-programming-guide-vol2-75.gif" src="plugin-programming-guide-vol2-75.gif" /></div><p><b>Snippet organization</b><p>An XML-element snippet is the serialized form of an XML element, its tree of elements (<a class="el" href="class_i_i_d_x_m_l_element.html">IIDXMLElement</a>) it owns, and any placed content that it or any of its dependents refer to, along with dependencies. Because we only one tagged object, there is only one element (XMLElement) in the snippet. Only the tags required for the exported XML elements are contained in the snippet; in this case, we have only one XMLTag element in the snippet. The UIDs of the frame (<a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) and tag (<a class="el" href="classk_x_m_l_tag_boss.html">kXMLTagBoss</a>) propagated to the snippet. XML elements are not UID-based, and the Self attributes for the XMLElement elements in the snippet are less easy to relate to the original InDesign document. See the following figure.<p>Key elements in a snippet for a tagged placeholder:<div class="image"><img alt="plugin-programming-guide-vol2-76.gif" src="plugin-programming-guide-vol2-76.gif" /></div><dl class="section note"><dt>Note<dd>In this figure, &quot;Root&quot; can be either Document (for IDML) or SnippetRoot (for INX).</dl><h2><a class="anchor" id="id_client_api"></a> Client API</h2><h3><a class="anchor" id="id_suites"></a> Suites</h3><p>To create a snippet based on the current selection, use <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>. <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a> lets you export the layout selection or a selection in the structure view as a snippet, and a text selection as an InCopyInterchange snippet (INCX or ICML). For more details, see <a class="el" href="id_solutions.html#id_snippets">Snippets</a>.<h3><a class="anchor" id="id_utilities"></a> Utilities</h3><p>The following utilities are available:<ul><li><a class="el" href="class_i_snippet_export.html">ISnippetExport</a> - A utility interface on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a> that exposes the snippet types that can be exported by the application. There are several snippet types you can export with this interface, including text styles, XML tags, swatches, preferences, and InCopy stories. You also can export a collection of objects with <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interfaces and specify the export policy. Several methods take an <a class="el" href="class_i_n_x_options.html">INXOptions</a> argument, allowing you to specify whether you want to export INX- or IDML-based snippets. For more detail, refer to the API Reference.<li><a class="el" href="class_i_snippet_import.html">ISnippetImport</a> - A utility interface on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>, with a simpler API than the export equivalent. The only requirement on import is that you know where you want to import in the scripting DOM tree. You need an <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interface on a scriptable object. For more detail, refer to the API Reference.</ul><p>The <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a> suite can be used if you create a selection programmatically and are not worried about trampling the user selection. For example, the <a class="el" href="class_i_text_selection_suite.html">ITextSelectionSuite</a>, <a class="el" href="class_i_x_m_l_node_selection_suite.html">IXMLNodeSelectionSuite</a> (structure view), and <a class="el" href="class_i_layout_selection_suite.html">ILayoutSelectionSuite</a> interfaces each create selections that can be exported as snippets through <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a>. For more information on creating selections programmatically, see <a class="el" href="id_solutions.html#id_selection">Selection</a>.<p>If you have a nonselectable object you want to export as a snippet, you can use one of two methods on the <a class="el" href="class_i_snippet_export.html">ISnippetExport</a> interface (on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>). ISnippetExport::ExportAppPrefs can be used to export various application preferences; for examples, see the <a class="el" href="class_snp_share_app_resources.html">SnpShareAppResources</a> code snippet. You also can use ISnippetExport::ExportDocumentResource to export resources of the document; for examples, see the <a class="el" href="class_snp_import_export_snippet.html">SnpImportExportSnippet</a> code snippet.<p>For more information, see <a class="el" href="id_solutions.html#id_snippets">Snippets</a>.<p><b>Importing</b><p>On import, the main thing the client must specify is where on the scripting DOM tree the incoming snippet will go. The incoming snippet will have one or more root objects (for example, page items), and the client needs to specify where on the DOM tree they will go. For page items, this typically means specifying the spread. For XML elements, it means specifying an element on the structure tree that will be the parent of the imported element. For many other snippet types (styles, swatches, etc.) the document is the parent. For more information, see <a class="el" href="id_solutions.html#id_snippets">Snippets</a>.<h2><a class="anchor" id="id_extension_patterns"></a> Extension patterns</h2><p>There are no specific extension patterns you can implement relating to snippets; however, if you add persistent data to the low-level document model (for example, through add-ins of interfaces that have persistent implementations), your plug-in must expose this data to scripting.<h3><a class="anchor" id="id_adding_persistent_data_to_snippet_files"></a> Adding persistent data to snippet files</h3><p>If you add persistent data to the boss DOM-for example, through an add-in to one of the page-item boss classes-then for this data to be round-tripped through snippets, you need to expose your data as properties in the scripting DOM. This also may require you to define new object (classes) in the scripting DOM. For more information, see <a class="el" href="id_solutions.html#id_selection">Selection</a>.<p>For example, if your custom data on page items needs to be round-tripped through asset libraries (which depend on the snippet architecture), you need to ensure your persistent data is scriptable. See, for example, the SDK sample CandleChart, which was updated to support round-tripping persistent data through snippets by exposing the persistent data as properties added to the scripting DOM.<h2><a class="anchor" id="id_frequently_asked_questions"></a> Frequently asked questions</h2><h3><a class="anchor" id="id_what_is_a_snippet_and_how_do_i_create_one"></a> What is a snippet, and how do I create one?</h3><p>A snippet is a logically complete fragment of an InDesign document, saved in the XML-based InDesign Markup (IDMS) or InDesign Interchange (INX) formats. A snippet is created by acquiring references to document objects you want to export (for example, by UID or <a class="el" href="class_x_m_l_reference.html">XMLReference</a>), then using one of the client APIs like <a class="el" href="class_i_snippet_export.html">ISnippetExport</a>. Alternately, there is a <a class="el" href="class_i_snippet_export_suite.html">ISnippetExportSuite</a> suite interface that lets you export based on a selection in the layout or structure view (XML elements) or a text selection, as InCopy Interchange format.<h3><a class="anchor" id="id_what_happens_if_i_export_a_snippet_of_a_placed_image"></a> What happens if I export a snippet of a placed image?</h3><p>See Image-item snippet. A snippet for a placed image maintains a link to the asset within the XML representation. When the snippet is imported into a new document, a link appears in the Links panel as if you had placed the image.<h3><a class="anchor" id="id_what_features_are_based_on_snippets"></a> What features are based on snippets?</h3><p>See Features that depend on snippets.<h3><a class="anchor" id="id_how_accurately_is_data_round-tripped_through_snippets"></a> How accurately is data round-tripped through snippets?</h3><p>Maintaining a high-fidelity representation of a document asset was one of the design goals for snippets. However, some limitations were designed in. For example, snippets do not carry document-level preferences with them. If they did, they would create overrides of the existing document-level preferences when imported into a new document, which is desirable.<p>When importing a new asset, it is reasonable for it to bring new document objects, like swatches on which it depends, but it could have unintended global effects on the target document if it starts to redefine document-level preferences that control typography, for example. Importing a snippet should not alter the properties of other document objects in the document into which you import the snippet.<h3><a class="anchor" id="id_when_do_i_have_to_care_about_snippets"></a> When do I have to care about snippets?</h3><p>If you are adding custom data to the document-for example, to page items in some way-and you want this data to be round-tripped through asset libraries, you must be sure you can get your persistent data into snippet files. This is because asset libraries store their assets as snippets internally, meaning your persistent data must be exported into a snippet. See Adding persistent data to snippet files for more discussion.<h3><a class="anchor" id="id_can_i_export_spreads_or_pages_as_snippets"></a> Can I export spreads or pages as snippets?</h3><p>Suppose you have a multipage document, and you want to decompose it into independent pages by exporting each page as individual snippets containing all objects on each page and dependencies. Alternately, you may want to export each spread as a snippet.<p>This is not possible, as pages are not recreated on snippet import, so you cannot factor a document into individual spreads or pages using the snippet architecture alone.<h3><a class="anchor" id="id_should_we_generate_snippet_files_from_scratch"></a> Should we generate snippet files from scratch?</h3><p>No. The INX-based snippet format should be regarded as a read-only format. We do not recommend using it to generate snippets from scratch.<p>We designed IDML-based snippets to facilitate programmatic assembly and disassembly of snippets. You can validate your snippets using a RELAX NG-based schema. The SDK also includes a sample plug-in that logs errors on import and export. Both schema validation and the error-logging plug-in are covered in Adobe InDesign Markup Language (IDML) Cookbook.<h3><a class="anchor" id="id_can_i_import_a_snippet_directly_into_a_library"></a> Can I import a snippet directly into a library?</h3><p>Although asset libraries (kSnippetBasedCatalogBoss) depend heavily on snippets for their representation of assets, there is no public API to let you import a snippet directly into a library. You must import the snippet into a document, then use the library APIs to add the item to an existing library. See <a class="el" href="id_solutions.html#id_snippets">Snippets</a>.<h3><a class="anchor" id="id_can_i_import_a_snippet_into_the_scrap_database"></a> Can I import a snippet into the scrap database?</h3><p>The scrap database (<a class="el" href="classk_scrap_doc_boss.html">kScrapDocBoss</a>) does not support importing snippets; there is no DOM element hierarchy (<a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>) on the scrap, which is required to import snippets.<h3><a class="anchor" id="id_can_we_add_our_own_new_snippet_types"></a> Can we add our own new snippet types?</h3><p>You cannot add new snippet types or policies; you are restricted to those identified in the table in Snippet types and policies. The existing snippet types, however, cover the range of document content it makes sense to export as self-contained assets. Since you can export an arbitrary collection of root objects (those with <a class="el" href="class_i_d_o_m_element.html">IDOMElement</a> interfaces) to a snippet file, you can select what goes into a snippet, at least in terms of root objects. What you cannot do is decide what dependents of those objects to include or leave out when export is taking place. You might have to do some additional work before export, to ensure those dependents were exported as if they were root objects in determining what goes on in the snippet.<h1><a class="anchor" id="id_shared_application_resources"></a> Shared Application Resources</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>With InDesign and a small amount of your own code, you can manage application resources like preferences, text styles, XML tags, and swatches. This chapter describes how to read and write these resources to or from a stream, using InDesign Interchange (INX) snippets.<p>This chapter does not require a full understanding of XML, INX, snippets, or scripting, nor does it try to teach you those technologies. For background, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a> and <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_snippet_fundamentals">Snippet Fundamentals</a>. Also see Adobe InDesign Scripting Guide and Adobe InCopy Scripting Guide.<dl class="section note"><dt>Note<dd>The shared-application-resources APIs support only INX snippets. IDML-based snippets are not supported.</dl><h2><a class="anchor" id="id_terminology"></a> Terminology</h2><ul><li>Application preferences are the preferences in the InDesign or InCopy preference panel with no documents open. These are the preferences used when InDesign creates a new document.<li>INX (InDesign Interchange) is an XML-based format InDesign uses to serialize and deserialize native content. It is based on InDesign&#39;s robust scripting support. An INX file is a script expressed in XML that allows for the recreation of InDesign content and properties.<li>Shared application resources amounts to saving and refreshing resources like application preferences, defaults, text styles, swatches, and XML tags, while the application is running.<li>An INX snippet is a logically complete INX fragment that represents pieces of an InDesign document or other native application content such as application preferences. This chapter focuses on using snippets to write out application resources like preferences and styles.</ul><h2><a class="anchor" id="id_architecture"></a> Architecture</h2><p>InDesign and InCopy provide robust scripting support. It is very simple to change an application preference via scripting. One approach to managing application preferences is to write a script that sets these properties to some predefined state. Due to the large number of preferences in InDesign and InCopy, however, this would be fairly involved.<p>You could continue along this path, and manage character and paragraph styles, object styles, swatches, and XML tags. This would become very involved, with a great deal of code to maintain. Fortunately, you do not have to write these scripts. Snippets achieve the same result, and most of the work is done for you. You must write only the code that exports and imports the snippet.<h3><a class="anchor" id="id_how_it_works"></a> How it works</h3><p>INX is an XML-based equivalent to a script, which recreates native InDesign content. Snippets are INX fragments, which are complete enough to recreate part of an InDesign document or workspace. For example, a snippet may recreate a page item and all the resources on which it depends. This probably is the most common use of snippets to date. <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_snippet_fundamentals">Snippet Fundamentals</a> provides details about exporting document content. Although beyond the scope of what is covered in that chapter, snippets can be used to recreate most of the items saved in the application workspace.<p>Instead of building elaborate scripts that set and reset your application workspace, you can use the application&#39;s user interface to set your application preferences and styles as required, then export all or part of the workspace using INX snippets. The snippet then contains all the data needed to recreate all or part of your application workspace via the scripting model.<p>From an API standpoint, special support was added to the snippet architecture for exporting and importing application preferences and resources. The one caveat to using snippets is that you cannot control which individual properties are exported. The API does not provide this level of granularity; instead, it is based on classes of scriptable objects (for example c_GeneralPrefs). All such objects that are marked as preference objects in the scripting model and are children of the Application object can be exported. By default, several other classes also are exported. These classes amount to elements of some style list. For instance, for Paragraph Styles, the c_ParaStyle list element is exported. For your reference and use in code, the scripting IDs for these types are in <a class="el" href="_app_prefs_list_element_types_8h_source.html">AppPrefsListElementTypes.h</a>.<p>A brief description of all relevant interfaces follows.<h3><a class="anchor" id="id_isnippetexport"></a> ISnippetExport</h3><p><a class="el" href="class_i_snippet_export.html">ISnippetExport</a> is the interface used to write snippets to a stream. Most the methods have a specific application (like ExportInCopyInterchange, ExportXMLTags, and ExportTextStyles). There also are generic Export methods. It is important to note that these methods can be called only with a predefined snippet export policy. You cannot create your own snippet export policy using the publicly available SDK. Certain interfaces intentionally were left out; calling these items with an invalid policy (kInvalidClass) exports invalid XML.<p>The method used to export application resources is ExportAppPrefs(). By default, this method exports all application preference types and all other types specified in <a class="el" href="_app_prefs_list_element_types_8h_source.html">AppPrefsListElementTypes.h</a>. For the exact content, see the method. It contains a collection of list element types, such as text and object styles.<p>ExportAppPrefs also takes three optional arguments, which allow you to control exactly what is exported:<ul><li>An operation - You can specify one of two values (kInclude or kExclude) from the <a class="el" href="class_i_snippet_export.html#a376e2d677c322e247d37e7d6c25b43ff">ISnippetExport::PreferenceOperation</a> enumeration. Passing in kExclude causes everything to be exported except the items listed in the <a class="el" href="class_k2_vector.html">K2Vector</a>. Passing in kInclude causes only what is in the vector to be exported.<li>A reference to a <a class="el" href="class_k2_vector.html">K2Vector</a> &lt;ScriptID&gt;.<li>A pointer to an instance of <a class="el" href="class_i_app_prefs_export_delegate.html">IAppPrefsExportDelegate</a>, described in the following section.</ul><h3><a class="anchor" id="id_iappprefsexportdelegate"></a> IAppPrefsExportDelegate</h3><p>While you cannot create your own INX export policy, <a class="el" href="class_i_app_prefs_export_delegate.html">IAppPrefsExportDelegate</a> allows for finer control of the application preference export process. It gives the caller final say on exactly what is exported and in what order. This may be important if your plug-in adds scripting support to an object you want to be exported by ExportAppPrefs(). You may need a way to reorder the export, putting your item after objects on which it depends.<p>To add an IAppPresExportDelegate, create your own instance and pass in a pointer when you call ExportAppPrefs().<h3><a class="anchor" id="id_isnippetimport"></a> ISnippetImport</h3><p><a class="el" href="class_i_snippet_import.html">ISnippetImport</a> is the interface used to import snippets from a stream. You can access an instance through Utils&lt;&gt; helper.<p>The methods in this interface are generic. They are not specific to importing application resources, but rather any type of snippets. The difference in the two ImportFromStream methods is that one allows you to import a snippet containing multiple root objects. For our purposes, we use the ImportFromStream method that specifies a single root object (the application).<p>Like the generic export methods, ImportFromStream also takes an INX import policy. Again, you cannot create this on your own. The argument itself is optional and defaults to kInvalidClass. The correct policy to use is <a class="el" href="classk_app_prefs_import_boss.html">kAppPrefsImportBoss</a>; if you leave it as kInvalidClass (the default value), the method will figure this out from the snippet.<h3><a class="anchor" id="id_iappprefsimportoptions"></a> IAppPrefsImportOptions</h3><p>Two options must be defined when importing. These options are provided by an instance of <a class="el" href="class_i_app_prefs_import_options.html">IAppPrefsImportOptions</a> on the application workspace. To set these options, query for that instance of <a class="el" href="class_i_app_prefs_import_options.html">IAppPrefsImportOptions</a> and call the appropriate set method. That implementation in turn creates and processes a command to change its own state.<p>The first option is what to do when list items already in the application match those being imported. For example, suppose you import Paragraph Styles A, B, and C into an application workspace that already has Paragraph Style A. Should the import keep or replace Paragraph Style A? To set the option for this, call SetHandleListItemsWithMatchingNames with either IAppPrefsImportOptions::kUseExistingListItems or IAppPrefsImportOptions::kReplaceListItems. The default value is kReplaceListItems.<p>The second option is what to do with list items that are not being imported. You can either delete everything not in the imported list or leave existing items alone. For example, suppose you import Paragraph Styles A, B, and C into an application workspace that contains Paragraph Style D. Should the import keep or delete Paragraph Style D? To set this option, call SetDeleteNonImportedListItems with kTrue or kFalse. When called with kTrue, items not in the imported list are deleted, which is the default behavior. To retain existing items, return kFalse.<p>To completely restore lists like paragraph styles to exported snippets, set the above two properties to kReplaceListItems and kTrue, respectively. This replaces any existing list items and deletes list items not in the import. This is the default behavior, but it is up to you to know whether <a class="el" href="class_i_app_prefs_import_options.html">IAppPrefsImportOptions</a> was changed.<h3><a class="anchor" id="id_iappprefsimportdelegate"></a> IAppPrefsImportDelegate</h3><p>While you cannot create your own INX import policy, <a class="el" href="class_i_app_prefs_import_delegate.html">IAppPrefsImportDelegate</a> allows for finer control of the application preference import process. It gives the plug-in developer final say on exactly what is imported, what is kept and/or deleted, and which property is used to compare list elements. You may never need to use a delegate; however, if you need finer control over the import, you need to provide an instance of <a class="el" href="class_i_app_prefs_import_delegate.html">IAppPrefsImportDelegate</a>. To do this, add your <a class="el" href="class_i_app_prefs_import_delegate.html">IAppPrefsImportDelegate</a> instance to <a class="el" href="classk_app_prefs_import_boss.html">kAppPrefsImportBoss</a>. This delegate is a way to influence the import policy even though you cannot create your own policies.<h2><a class="anchor" id="id_working_with_snippet_apis_frequently_asked_questions"></a> Working with snippet APIs: frequently asked questions</h2><p>See the &quot;Share App Resources&quot; snippet in &lt;SDK&gt;/source/sdksamples/codesnippets/SnpShareAppResources.cpp. This contains the sample code that demonstrates everything covered above except the use of delegates (<a class="el" href="class_i_app_prefs_import_delegate.html">IAppPrefsImportDelegate</a> and <a class="el" href="class_i_app_prefs_export_delegate.html">IAppPrefsExportDelegate</a>).<h3><a class="anchor" id="id_how_do_i_create_streams_for_reading_and_writing_snippets"></a> How do I create streams for reading and writing snippets?</h3><p>SnpShareAppResources::CreateStream() shows how to create file streams. It uses StreamUtils, which has other useful methods for reading and writing different kind of streams.<h3><a class="anchor" id="id_how_do_i_limit_my_export_to_those_items_in_the_preference_panel"></a> How do I limit my export to those items in the preference panel?</h3><p>You cannot be that precise, but you can come close. <a class="el" href="class_snp_share_app_resources.html#a0e458b79ed6f9902475f50ad6de34a84">SnpShareAppResources::ExportPrefsPanel</a> contains all ScriptIDs for the objects that control the preference panels. Some of these objects control other settings, like items in the View menu.<h3><a class="anchor" id="id_how_do_i_export_all_text_styles_object_styles_xml_tags_or_swatches_in_the_application_workspace"></a> How do I export all text styles, object styles, XML tags, or swatches in the application workspace?</h3><p>Specify the correct list of ScriptIDs to include. See ExportTextStyles(), ExportObjectStyles(), ExportXMLTagsAndPrefs(), and ExportSwatches() in SnpShareAppResources.cpp.<h3><a class="anchor" id="id_how_do_i_import_a_snippet_into_the_application"></a> How do I import a snippet into the application?</h3><p>Call <a class="el" href="class_i_snippet_import.html#adfac9b84dcd602b954d6df96d595c96d">ISnippetImport::ImportFromStream()</a> with a pointer to the appropriate root object (<a class="el" href="class_i_d_o_m_element.html">IDOMElement</a>) instance. <a class="el" href="class_snp_share_app_resources.html#ae9b1307bbda55a760c49819920eb897a">SnpShareAppResources::ImportToApp()</a> shows how to query for the application root and call ImportFromStream().<h3><a class="anchor" id="id_how_do_i_control_whether_existing_objects_like_paragraph_styles_are_replaced_or_deleted_on_import"></a> How do I control whether existing objects like paragraph styles are replaced or deleted on import.</h3><p><a class="el" href="class_snp_share_app_resources.html#ae5871be0a560607d9a1a7759e942c05e">SnpShareAppResources::ImportToAppWithOptions()</a> shows how to set the application workspace&#39;s <a class="el" href="class_i_app_prefs_import_options.html">IAppPrefsImportOptions</a> before importing.<h3><a class="anchor" id="id_how_do_i_determine_the_correct_scriptid_to_use_for_a_preference_im_trying_to_include_or_exclude"></a> How do I determine the correct ScriptID to use for a preference I&#39;m trying to include or exclude?</h3><p>This may involve trial and error. While all the native IDs are available in <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a>, sometimes it is difficult to find the ID corresponding to a particular user interface feature. Most of the ScriptIDs have meaningful names that map to the user interface or how they appear in the scripting object model. To start, look at ScriptingDefs. If you cannot figure it out, an understanding of the scripting object model will help. If you cannot identify the right ID, open a developer support case.<h3><a class="anchor" id="id_how_do_i_know_which_list_element_types_will_be_exported_by_default"></a> How do I know which list element types will be exported by default?</h3><p>The list of all such types is in <a class="el" href="_app_prefs_list_element_types_8h_source.html">AppPrefsListElementTypes.h</a>. In <a class="el" href="_scripting_defs_8h_source.html">ScriptingDefs.h</a>, most list element types have both a singular and plural ID; for example, c_ObjectStyle and c_ObjectStyles. <a class="el" href="_app_prefs_list_element_types_8h_source.html">AppPrefsListElementTypes.h</a> uses all singular IDs. In all cases, use the singular ID. The internal snippet code considers these elements on a case-by-case basis. It does not export all object styles if you pass in c_ObjectStyles.<h1><a class="anchor" id="id_user-interface_fundamentals"></a> User-Interface Fundamentals</h1><p>This chapter introduces the key concepts in the user-interface architecture, such as type bindings between widget boss classes or interfaces and ODFRez custom resource types. This chapter also describes how the user-interface model is factored, discusses relevant design patterns like the Observer pattern, and provides an overview of common plug-in resources.<p>The chapter has the following objectives:<ul><li>Explain user-interface programming for InDesign.<li>Help you create responsive user interfaces for InDesign plug-ins.<li>Illustrate key concepts with a concrete example of a user interface.<li>Describe the factoring of the user-interface model.<li>Discuss design patterns relevant to user-interface programming.<li>Describe the role played by persistence in the user-interface model.<li>Outline how resources are used in defining user interfaces.</ul><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>Plug-in developers often need to implement a user interface early in their plug-in programming experience. To program user interfaces, a plug-in developer needs to understand concepts like boss classes and interface aggregation, as much of the user interface is specified in resources.<p>The initial state and properties of a plug-in user interface are specified in a cross-platform resource language, ODFRez (OpenDoc Framework Resource language). Developing responsive user interfaces for InDesign plug-ins requires understanding type binding between boss classes (and persistent API interfaces) and types defined in ODFRez, and how persistent interfaces on widget boss classes read their initial state from the plug-in resources.<p>One benefit of the ODFRez data format is that it is a cross-platform resource definition language. The initial geometry of widgets can be defined in ODFRez data, as well as other data needed to define the initial state of widgets, like the labels on buttons. It is rare that a platform-specific resource is required; in the SDK samples, this occurs only for image-based buttons.Sample user interface on page 237 introduces a concrete example of a user interface to explain abstract topics like type binding. &quot;Factorization of the user-interface model&quot; describes the user-interface programming model.<h2><a class="anchor" id="id_key_concepts"></a> Key concepts</h2><h3><a class="anchor" id="id_design_objectives_for_user-interface_api"></a> Design objectives for user-interface API</h3><p>The following are some of the design objectives for the user-interface programming model:<ul><li>Enable cross-platform user-interface development.<li>Create reusable user-interface components with rich behaviors.<li>Provide a well factored design that separates data and presentation.</ul><p>To meet these objectives, the design supports reuse, with the possibility of customizing widget behavior and appearance, and it encapsulates of platform dependencies. Support for reuse is established through the use of widget boss classes. Platform independence is achieved by using a cross-platform resource format; widgets are defined in the ODFRez language.<p>The following are the key responsibilities of a plug-in developer:<ul><li>Identify and use existing widgets where possible.<li>Define new boss classes, typically subclasses of existing widget boss classes.<li>Define ODFRez custom resource types. If widget boss classes are subclassed, the associated ODFRez types also must be subclassed. These also go in the top-level framework resource file.<li>Define ODFRez data statements, to specify the geometry and properties of the widgets, as well as for localization.</ul><p>Client code also may be responsible for the following:<ul><li>Navigation between boss objects. An example is finding the panel to which a pop-up menu is attached, then locating a widget belonging to the panel.<li>Processing actions when menu items are executed or keyboard shortcuts are executed.<li>Handling notifications about changes in widget state sent to interested observers. InDesign client code rarely requires writing event-handling code. Instead, observers process update messages that specify how the state of the subject has changed.</ul><h3><a class="anchor" id="id_idioms_and_naming_conventions"></a> Idioms and naming conventions</h3><p>This section describes some programming idioms and naming conventions that are strongly recommended when writing plug-in user-interface code. There are two types of conventions:<ul><li>Conventions used within the public API.<li>Naming conventions used to minimize confusion and uncertainty about code intent.</ul><p>Control-data interfaces on widget boss classes are predictably named. When working with controls, there are many interfaces named I&lt;Data-type&gt;ControlData. Notifications of changes in the data model of a control are performed by the implementations of these interfaces.<p>It is helpful to be disciplined in defining symbolic constants for identifiers. We strongly recommend you observe the following conventions:<ul><li>Ensure constants like boss, implementation, and widget IDs begin with &quot;k.&quot;<li>Ensure new interface identifier names begin with &quot;IID_,&quot; are in all uppercase, and are declared in the interface ID namespace.<li>Use &quot;k&lt;Name&gt;Boss&quot; to define a new ID in the boss namespace, where ideally &lt;Name&gt; is related to the boss-class intent; for example, kMyCustomButtonWidgetBoss.<li>Use &quot;k&lt;Name&gt;Impl&quot; to define a new ID in the implementation ID namespace.<li>Use &quot;k&lt;Name&gt;WidgetID&quot; to define a new ID in the widget ID namespace.<li>Use &quot;k&lt;Name&gt;Key&quot; to define a new string key in the global string table.<li>Strive for regular relationships between implementation class names and identifiers. For example, kMyPluginObserverImpl is associated with a C++ class MyPluginObserver.<li>Make ODFRez custom-resource type names indicative of the boss class they bind to, in as regular a fashion as possible. For example, kMyCustomButtonWidgetBoss is bound to the ODFRez type MyCustomButtonWidget.</ul><p>Along with following the appropriate naming conventions for the domain, it is essential to define symbolic constants in the correct namespace and make sure there are no constants defined that clash numerically. In addition to the boss class IDs and implementation IDs used throughout the API, there are widget identifiers and string tables consisting of key/value pairs for each locale of interest.<p>In some cases, the namespaces are global; each plug-in must ensure any identifiers and strings it creates are unique within the application. This applies to string keys; for example. However, widget identifiers need be unique only within the list of descendants of a given widget, so in some circumstances you can reuse a widget identifier (for example, across different dialog boxes or panels you own), as long as you observe this constraint.<h3><a class="anchor" id="id_abstractions_and_reuse"></a> Abstractions and reuse</h3><p>This section highlights the major abstractions in the InDesign API and the main strategy for code reuse within the user-interface API: extending widget boss classes. This section also reviews some of the fundamental material required for InDesign programming.<p>There is a very high degree of code reuse within the user-interface domain, and the boss class hierarchies are particularly deep in this area compared to other application domains. Reuse within the widget API typically takes the form of reuse of boss classes by inheritance. In some circumstances, implementations from the API of particular interfaces can be reused.<p>In general, it is not possible to predict whether an implementation of an interface on an existing boss class can be safely reused. There might be implementation dependencies, like expecting the container-widget boss object to expose an <a class="el" href="class_i_bool_data.html">IBoolData</a> interface. In general, it is not safe to try to reuse just one implementation from a given widget boss class. The recommended reuse policy is to extend an existing widget boss class and override an interface, if required, by extending the implementation present on the parent boss class.<p>Widget boss classes and the user-interface API can be confusing, because there are widgets defined in ODFRez and widgets in the boss-class space with very similar names. For example, <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> is a boss class that provides implementations responsible for the behavior of a given widget, and ButtonWidget is an ODFRez custom-resource type that specifies data for the initial state and properties of a control.<p>Another source of confusion is that occasionally there are C++ helper classes and ODFRez custom-resource types with identical names (like CControlView) but different responsibilities. To avoid confusing these types, it always is necessary to consider whether entities are from the code domain (C++) or data domain (ODFRez).<h3><a class="anchor" id="id_widgets_versus_platform_controls"></a> Widgets versus platform controls</h3><p>This section describes the relationship between InDesign widget classes and platform controls. Widget boss classes provide a layer of abstraction over platform-specific controls and provide additional capability beyond what is delivered by the platform controls. The user-interface model extends widgets to the platform-specific control set, providing controls like measure-edit boxes specialized for the domain of print publishing.<p>A widget boss class potentially encapsulates a platform control and provides additional capabilities like entry validation-a cross-platform API to query and set data values and change notification. This is the principal benefit of the user-interface model: the same code can be written to develop a plug-in user interface for Mac OS and Windows, with little or no attention to platform differences.<p>A widget boss class can be associated with a platform control, as in the case of an edit box. Some classes, however, have no direct platform equivalent or platform peers; for example, the iconic push buttons are not bound to a platform control. When writing client code, typically it is not necessary to be aware of whether there is a platform peer control for an API widget, and we recommend you manipulate the state of InDesign widgets through the InDesign API and not through platform-specific APIs. In addition, use InDesign API-specific patterns to receive notification about changes in control state (subject/observer).<p>Widget boss classes provide more capability than platform controls. For example, there is a mechanism for controls to persist their state across instances of the application; this is not default behavior for platform controls. The integer edit-box widget (<a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a>) provides additional validation capability not typically provided by platform controls. Another key point about widget boss classes is that they expose a cross-platform API and a uniform programming model on both Mac OS and Windows. This provides true cross-platform development of user interfaces, although at the cost of some complexity in the architecture.<h3><a class="anchor" id="id_commands"></a> Commands</h3><p>This section introduces a common factoring in the InDesign plug-ins, which are decomposed into model plug-ins and user-interface plug-ins. The core capabilities of the InDesign API are delivered by required plug-ins, most of which are model plug-ins. A model plug-in delivers required pieces of architecture every client plug-in needs, or it implements the document-object model at the core of InDesign. Much of the application user interface is delivered by plug-ins that named &lt;whatever&gt;UI.apln, indicating they are user-interface&acirc;&#128;&#147;specific and not required plug-ins, which end in .rpln.<p>A plug-in&#39;s user interface can be thought of as a means of parameterizing command sequences that perform functions benefitting an end user, like changing the document object model to be consistent with user intent. For example, the XML required plug-in provides the core cross-media API (for example, <a class="el" href="class_i_x_m_l_element_commands.html">IXMLElementCommands</a>, a key wrapper interface), and the XMedia user-interface plug-in creates the user interface and drives the commands delivered through the XML required plug-in. Behind most plug-in user interfaces, a command or command sequence is executed when a widget receives the appropriate end-user event.<p>Commands provide a means to encapsulate change, provide support for undoing commands, and support notification of changes. The command pattern is a well-known design pattern, described in depth in Gamma, Helm, Johnson, and Vlissides, Design Patterns: Elements of Reusable Object-Oriented Software, Addison-Wesley, 1995.<p>Commands also use the messaging framework, which allows observers (<a class="el" href="class_i_observer.html">IObserver</a>) to attach to subjects and receive notification of change to the underlying model. Frequently, notifications about commands are received by observers associated with plug-in user-interface components. For example, the Layers panel receives notifications about documents being opened and closed through the command architecture and updates its views accordingly. It is particularly convenient that the same design pattern (subject/observer) is used within the user-interface programming model, since all widget boss classes expose an <a class="el" href="class_i_subject.html">ISubject</a> interface that can be observed by another boss object that implements <a class="el" href="class_i_observer.html">IObserver</a>.<p>Previewable dialogs are closely connected with commands. Commands used in previewable dialogs should be absolute; that is, do not try to increase or decrease the value of data. With preview off, the dialog is operating in collect mode, queuing up the set of commands that will execute. If preview is turned on, these commands are executed, and further updates are executed immediately. If the user cancels the action or turns preview back off, the database rolls back to the original state. Providing preview capability is an essential requirement in some client code.<h3><a class="anchor" id="id_suites_and_the_user_interface"></a> Suites and the user interface</h3><p>Selection suites are a convenient way to package model-manipulation code that makes it almost trivial to write a user interface to drive the code. As described above, you should factor the code such that the suite is delivered by one plug-in, and the client code for your user interface that exercises the methods on the suite is in another plug-in. For a more detailed discussion of suites, see <a class="el" href="id_solutions.html#id_selection">Selection</a>.<p>Suites are particularly appropriate to writing user-interface code because they simplify the process. Whenever an end user is required to manipulate document objects by making active selections, make maximum use of suites.<h3><a class="anchor" id="id_finding_widgets_in_the_api"></a> Finding widgets in the API</h3><p>There are two main ways to inspect the widget set delivered by the API:<ul><li>Look at the boss classes delivered by the Widgets plug-in (refer to the API Reference for WidgetBinClass).<li>Look at the ODFRez counterparts for many of these boss classes, which can be found in the API header file Widgets.fh.</ul><p>For information on why there are widget boss classes and ODFRez types with similar names, see Type binding.<p>Each widget in the API is best understood in terms of the boss class that provides its behavior. Although there is an ODFRez type ButtonWidget, it really is the boss class <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> that provides all the significant behavior. For simple widgets, however, you can use just the ODFRez type without worrying about the boss class behind it; a static text widget is an example of this.<p>For example, a button in the InDesign API can be understood mainly by the interfaces aggregated on the button-widget boss classes and the semantics of those interfaces. For example, <a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a> exposes the following key interfaces, among others:<ul><li><a class="el" href="class_i_text_control_data.html">ITextControlData</a> represents the label on the button.<li><a class="el" href="class_i_control_view.html">IControlView</a> is responsible for the button appearance.<li><a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a> stores its state, pressed in or not.<li><a class="el" href="class_i_subject.html">ISubject</a> lets client code attach an observer (<a class="el" href="class_i_observer.html">IObserver</a>) to receive notification about changes in the button state.</ul><p>Observers (<a class="el" href="class_i_observer.html">IObserver</a>) are notified of changes to an abstract subject (<a class="el" href="class_i_subject.html">ISubject</a>). When a button is pressed by an end user, the button-widget boss object (<a class="el" href="classk_button_widget_boss.html">kButtonWidgetBoss</a>) notifies any attached observers about the state change, by sending them a message along IID_IBOOLEANCONTROLDATA protocol. The message contains additional information to say whether the button is being pressed in.<h3><a class="anchor" id="id_notifications_about_control_events_or_changes"></a> Notifications about control events or changes</h3><p>A change in control state can be caused by many events, such as a button click, a keystroke entered in an edit box, or a selection in a list box. Within the InDesign API, you get notification of changes by providing your own implementation of an observer (<a class="el" href="class_i_observer.html">IObserver</a>) that listens for changes in the state of a subject (<a class="el" href="class_i_subject.html">ISubject</a>). Since all widget boss classes extend <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>, which aggregates <a class="el" href="class_i_subject.html">ISubject</a>, all widgets are observable by default. The simplest way to get notification about changes in state is to add an <a class="el" href="class_i_observer.html">IObserver</a> interface to the widget boss class in which you are interested, and subclass the corresponding ODFRez type. While this pattern has the advantage of simplicity, if you have any elaboration in your user interface, we recommend you have one observer listen for changes in multiple widgets and be aggregated on the parent of all widgets in whose state changes you are interested.<p>If you are accustomed to programming other user-interface APIs, you may expect to need to extend the event-handler interface. Usually, however, this is not required for the InDesign API, where typically writing an observer (<a class="el" href="class_i_observer.html">IObserver</a>) implementation is sufficient to be notified about the semantic events associated (for example, check-box state changed) with the widgets, rather than about the low-level events (left-mouse-button-click) transmitted through the event handler (<a class="el" href="class_i_event_handler.html">IEventHandler</a>).<p>If you use model-view observers to update the user interface, and they update data that does not always need to be synchronized with the model state, you can use lazy notification to improve performance. For more information, see <a class="el" href="id_solutions.html#id_notification">Notification</a>.<h2><a class="anchor" id="id_sample_user_interface"></a> Sample user interface</h2><p>The Stroke panel has an assembly of widgets to let an end user vary the miter limit associated with a line (the following figure). There is a text-edit box (<a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a>), a pair of labels (<a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a>), and a nudge-control widget (<a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a>), which increments or decrements values in the edit control by a specified amount.<div class="image"><img alt="plugin-programming-guide-vol2-77.gif" src="plugin-programming-guide-vol2-77.gif" /></div><p>The edit-box widget (<a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a>) shown in this figure is specialized for the input of integers; for example, a warning message is generated for any input that is not a valid integer. A widget boss object of type <a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a> encapsulates a standard platform native edit box and adds behavior, like validation logic when accepting updates; for example, when the end user presses Enter with focus in the edit box.<p>The nudge-control widget (<a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a>) collaborates with the integer edit box, allowing increments or decrements of the value in the edit box. A nudge-control widget boss object (<a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a>) is not based on any specific platform control. Instead, it consists of two API iconic button-like widgets, although this detail is hidden from developers of client code. This is an instance of the facade design pattern.<p>The initial state of widget boss objects must be specified through resources, and for each widget boss class, there is an associated ODFRez custom-resource type used to specify initial state for the widget. The following table shows the widget boss classes for the example in the preceding figure and associated ODFRez resource types.<table class="doxtable"><tr><th>API Widget boss class </th><th>ODFRez custom-resource type </th><th>Displaying </th></tr><tr><td><a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a></td><td>IntEditBoxWidget </td><td>4 </td></tr><tr><td><a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a></td><td>NudgeControlWidget </td><td>(Nothing) </td></tr><tr><td><a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a></td><td>StaticTextWidget </td><td>Miter limit </td></tr><tr><td><a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a></td><td>StaticTextWidget </td><td>x </td></tr></table><p>The key behavior of each control comes from the boss classes shown in the first column. The nudge control and edit box interact in a different way; the nudge control is coupled to the edit box in ODFRez data statements, and you do not need to write any additional C++ code to have an edit box with nudge capability. The code behind the nudge control is delivered by the application&#39;s required Widgets plug-in, and it can be safely reused through the user-interface architecture.<h3><a class="anchor" id="id_type_binding"></a> Type binding</h3><p>This section describes the type bindings that exist between widget boss classes or interfaces and ODFRez custom-resource types, using the example shown in the figure in Sample user interface. A key aspect of working with plug-in user interfaces is being able to interpret the binding between a widget boss class and an ODFRez custom-resource type or the significance of the binding between an API interface and an ODFRez custom-resource type.<p>Widget boss classes provide the behavior behind widgets, including the capability to draw and manage internal state and mediate interactions with the end user. Boss classes implement sets of interfaces. The example in the figure in Sample user interface uses an integer edit box (<a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a>), which is a control specialized for the input of integers. The implementation of the <a class="el" href="class_i_control_view.html">IControlView</a> interface on the <a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a> boss class is responsible for drawing the edit box. The implementation of the <a class="el" href="class_i_text_data_validation.html">ITextDataValidation</a> interface on this boss class validates that the input is an integer.<p>ODFRez custom-resource types define data to initialize widgets and other elements needed for the interface. For example, the CControlView field in the example later in this section specifies the initial location and dimensions of each widget, along with other properties like its widget ID and visibility.<p>When a panel is shown for the first time, a set of widget boss objects is created by the application framework, and the lifetime of these boss objects is managed by the framework. Each widget boss object is invited to draw itself to the display. A widget boss class provides the capability behind the user-interface element drawn to the screen and implements the user-interface model.<p>For example, the <a class="el" href="classk_static_text_widget_boss.html">kStaticTextWidgetBoss</a> boss class is bound to the ODFRez custom-resource type StaticTextWidget. The ODFRez data defines the initial state of a widget the first time it instantiates; thereafter, the state of the widget is restored from a saved data database. This enables widgets to persist their state across instances of the application, which is how end users can save the state of their working areas in terms of the visible panels, their geometries, etc.<p>A frequently encountered type expression is an ODFRez custom-resource type definition that refers to an interface ID or boss class IDs. An ODFRez expression like ClassID = xxx (or IID = xxx) establishes a binding between a widget boss class (or interface in the API) and an ODFRez custom-resource type.<p>For the following example, some of the type bindings are illustrated in the following figure, which shows one of the widget boss classes involved, the <a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a> class which provides an API to an integer-specific edit control. Note how the ODFRez is made up of fields, like CControlView, that map onto interfaces on the widget boss class. There also are other interfaces on the widget boss class that do not map to fields in ODFRez, like <a class="el" href="class_i_event_handler.html">IEventHandler</a>. The ODFRez fields specify the appearance of the control; they do not address its behavior, which is done by the widget boss class.<p>The following figure shows the type binding between the <a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a> boss class and the associated ODFRez custom-resource type IntEditBoxWidget. It also shows the type bindings for each interface with persistent data exposed by <a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a>. Each persistent interface is bound to an ODFRez custom-resource type that is used to define the initial state stored in the interface by a widget boss object.<div class="image"><img alt="plugin-programming-guide-vol2-78.gif" src="plugin-programming-guide-vol2-78.gif" /></div><p>The ODFRez fields in IntEditBoxWidget define the initial state for the integer edit-box widget, whose behavior is provided by <a class="el" href="classk_int_edit_box_widget_boss.html">kIntEditBoxWidgetBoss</a>. The following example shows the ODFRez data statements for the widgets in the figure in Sample user interface. <div class="fragment"><div class="line"><span class="comment">// Miter Limit </span></div><div class="line">StaticTextWidget ( </div><div class="line"><span class="comment">// CControlView fields below </span></div><div class="line"> kMiterStaticTextWidgetId, kPMRsrcID_None, <span class="comment">// WidgetId, RsrcId </span></div><div class="line"> kBindNone, <span class="comment">// Frame binding </span></div><div class="line"> Frame(0,30,58,47) <span class="comment">// Frame </span></div><div class="line"> kTrue, kTrue, <span class="comment">// Visible, Enabled, </span></div><div class="line"><span class="comment">// StaticTextAttributes fields below </span></div><div class="line"> kAlignRight, <span class="comment">// Alignment </span></div><div class="line"> kDontEllipsize, <span class="comment">// Ellipsize style </span></div><div class="line"><span class="comment">// CTextControlData field below </span></div><div class="line"><span class="stringliteral">&quot;Miter Limit:&quot;</span>, </div><div class="line"><span class="comment">// AssociatedWidgetAttributes field below </span></div><div class="line"> kMiterTextWidgetId ), IntEditBoxWidget ( </div><div class="line"><span class="comment">// CControlView fields below </span></div><div class="line"> kMiterTextWidgetId, <span class="comment">// WidgetId, </span></div><div class="line"> kSysEditBoxRsrcId, kStrokePanelPluginID, <span class="comment">// RsrcId </span></div><div class="line"> kBindNone, <span class="comment">// Frame binding </span></div><div class="line"> Frame(73,30,111,47) <span class="comment">// Frame </span></div><div class="line"> kTrue, kTrue, <span class="comment">// Visible, Enabled </span></div><div class="line"><span class="comment">// CEditBoxAttributes fields below </span></div><div class="line"> kMiterNudgeWidgetId, <span class="comment">// widget id of nudge button </span></div><div class="line"> 1, 10, <span class="comment">// small/large nudge amount </span></div><div class="line"> 3, <span class="comment">// max num chars( 0 = no limit) </span></div><div class="line"> kFalse, <span class="comment">// is read only </span></div><div class="line"> kFalse, <span class="comment">// should notify each key stroke </span></div><div class="line"><span class="comment">// TextDataValidation fields below </span></div><div class="line"> kTrue, <span class="comment">// range checking enabled </span></div><div class="line"> kFalse, <span class="comment">// blank entry allowed </span></div><div class="line"> 500, 1, <span class="comment">// upper/lower bounds </span></div><div class="line"><span class="stringliteral">&quot;4&quot;</span> <span class="comment">// initial value </span></div><div class="line">), </div><div class="line"></div><div class="line">NudgeControlWidget ( </div><div class="line"> kMiterNudgeWidgetId, kPMRsrcID_None, <span class="comment">// WidgetId, RsrcId </span></div><div class="line"> kBindNone, <span class="comment">// Frame binding </span></div><div class="line"> Frame(59,30,73,47) <span class="comment">// Frame </span></div><div class="line"> kTrue, kTrue, <span class="comment">// Visible, Enabled </span></div><div class="line">), </div><div class="line"></div><div class="line">StaticTextWidget ( </div><div class="line"> kXTextWidgetId, kPMRsrcID_None, <span class="comment">// WidgetId, RsrcId </span></div><div class="line"> kBindNone, <span class="comment">// Frame binding </span></div><div class="line"> Frame(115,30,125,47) <span class="comment">// Frame </span></div><div class="line"> kTrue, kTrue, kAlignLeft, <span class="comment">// Visible, Enabled, Alignment </span></div><div class="line"> kDontEllipsize, <span class="comment">// Ellipsize style</span></div><div class="line"><span class="stringliteral">&quot;x&quot;</span>, </div><div class="line"> kMiterTextWidgetId </div><div class="line">),</div></div><dl class="section note"><dt>Note<dd>Although there are strings like &quot;Miter Limit:&quot; in the ODFRez data, these always are translated for display in the user interface. The strings should be regarded as keys rather than values to be displayed. The SDK string keys are defined with particular care, using a scheme to avoid string-key clashes between plug-ins from different third-party software developers. The approach taken within the application is less structured and not recommended for third-party development.</dl><p>The main point to note about the ODFRez data statements is that each comprises fields of simpler types. For example, CTextControlData has one field, containing a string key. The contents of this CTextControlData field are used to initialize the contents of the <a class="el" href="class_i_text_control_data.html">ITextControlData</a> when the widget boss object is created.<p>Widget boss objects read their initial state from the compiled version of the ODFRez data. They persist their state to a saved-data database and read it back from this if the application starts up with saved data.<h2><a class="anchor" id="id_factorization_of_the_user-interface_model"></a> Factorization of the user-interface model</h2><h3><a class="anchor" id="id_architecture"></a> Architecture</h3><p>Often it is tedious and difficult to write a responsive user interface. Also, there are well known differences in the user-interface APIs on Mac OS and Windows. A key design objective for the InDesign user-interface architecture was to provide a cross-platform API and interface-definition format. The result is that the architecture is relatively elaborate; however, it is based on simple and familiar concepts. The user-interface architecture consists of views, data models, event handlers, and observers on the models. There also are attributes associated with the widget boss classes. See the following table.<table class="doxtable"><tr><th>Aspect </th><th>Description </th></tr><tr><td>Attributes </td><td>Represent properties (rather than user data), like the point size a text widget uses to displays its label. These are properties that can be defined in ODFRez data statements, although typically they also can be set through interfaces aggregated on the widget boss class providing the widget behavior. See Attributes. </td></tr><tr><td>Control data models </td><td>Encapsulate the widget state. Typically, the control-data-model implementation notifies when it changes, so observers on its state can get notified about the changes. See Control data models. </td></tr><tr><td>Control views </td><td>Specify the presentation of a widget, like whether it is visible, its widget ID, or whether it is enabled. The particular implementation on a widget boss class determines how the control draws. See Control views. </td></tr><tr><td>Event handlers </td><td>Convert events into changes to the data model. See Event handlers. </td></tr></table><p>The event handlers have code that changes the data models. When the widget data models change, the change manager is notified through the default <a class="el" href="class_i_subject.html">ISubject</a> implementation. It is the change manager that notifies observers of changes to the data model of interest. This abstraction is described elsewhere, in connection with commands and the notification framework.<p>Views are connected with the visual appearance of a widget. They can be manipulated to change the visual representation of widgets, like the dimension of the bounding box or the visibility. They also encapsulate the process of rendering a view of the data model.<p>The only occurrence of an explicit controller abstraction is in the context of dialog boxes. Widget boss classes have no externally visible controller abstraction; code with an equivalent responsibility is encapsulated in the widget event handlers. The MVC pattern is not a complete description of the user-interface architecture.<p>There also can be other interfaces aggregated on boss classes, often related to details about an implementation of a particular widget.<p>At its simplest, a widget consists of at least a control view (<a class="el" href="class_i_control_view.html">IControlView</a>). If a widget has a state that can be changed, it also has a control data model, like <a class="el" href="class_i_boolean_control_data.html">IBooleanControlData</a>, <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a>, or <a class="el" href="class_i_text_control_data.html">ITextControlData</a>. If the widget is responsive to end-user events, it aggregates an event handler (<a class="el" href="class_i_event_handler.html">IEventHandler</a>). It also may have other property-related interfaces.<p>Depending on the widget type, there can be additional interfaces to manipulate the control or perform operations on data. For example, the combo-box widget boss class <a class="el" href="classk_int_combo_box_widget_boss.html">kIntComboBoxWidgetBoss</a> has additional interfaces, like <a class="el" href="class_i_drop_down_list_controller.html">IDropDownListController</a> (to manipulate the list component of the combo box) and <a class="el" href="class_i_text_data_validation.html">ITextDataValidation</a> (for performing validation on data entered in the edit-box component of the combo box).<h3><a class="anchor" id="id_control_views"></a> Control views</h3><p>Control views are responsible for creating the visual representation of a widget boss class. For example, the control-view implementation associated with a palette-panel widget draws a drop shadow. The interface that allows control views to be manipulated is <a class="el" href="class_i_control_view.html">IControlView</a>. This interface, for example, can be used to show or hide a widget or to vary other visual properties.<p>The key method for widget drawing is <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a>. A widget boss class implements this method to provide its default visual appearance. This method is called in response to system paint events or explicit requests to redraw. Any owner draw widgets should override this method to provide a specialized appearance.<p>Views also can control their own size in response to end-user events. Overriding the ConstrainDimensions method on the <a class="el" href="class_i_control_view.html">IControlView</a> interface allows a panel to resize to its container palette. For more information, see the API documentation for this interface and the table in Key abstractions in the API.<h3><a class="anchor" id="id_control_data_models"></a> Control data models</h3><p>A control data model represents the state of a widget and is responsible for notifying the application core of changes in its state. For example, an edit box has a data model represented by a <a class="el" href="class_p_m_string.html">PMString</a>. Changes in this state are likely to be of interest to client code in a plug-in.<p>The widget boss classes that control the behavior of radio buttons (<a class="el" href="classk_radio_button_widget_boss.html">kRadioButtonWidgetBoss</a>) and check boxes (<a class="el" href="classk_check_box_widget_boss.html">kCheckBoxWidgetBoss</a>) aggregate an <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a> interface. This interface queries and modifies the state of the check box. The possible states are checked, unchecked, or indeterminate (mixed). The event handler interacts with the control data to set the state. Client code also may have to set and query the control-data-model state and register for notification about changes to the state of the control data model. Typically, observers associated with widgets request notification about changes along a protocol, IID_I&lt;name&gt;CONTROLDATA. This is the standard mechanism for client code to receive messages about changes in the state of a control.<p>Other APIs require that explicit event handlers be written to process messages from controls. Coding event handlers are used relatively infrequently when programming with the user interface API; the requirement to implement observers is far more common.<h3><a class="anchor" id="id_event_handlers"></a> Event handlers</h3><p>The main pattern for processing end-user events is the observer pattern; events are transformed into semantic events by the widget boss class&#39;s event-handler code. These semantic events are then transmitted to the observer, as <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> messages with informative parameters. An end user clicking the left mouse button when the pointer is over a button is a low-level event; it becomes a semantic event when interpreted as a button press that takes the control into a button-down state. The semantic event is of more interest to client code than the low-level event, because it provides a useful level of abstraction over the details of how the end user manipulates the state of different types of controls.<p>Event handlers are responsible for transforming end-user events into changes in the data model. The event handler, therefore, mediates between the end user and the control&#39;s internal state.<p>It is important to be clear about the difference between an event handler and an observer. Event handlers generally are of little interest to client code, except in highly specialized circumstances, when the standard behavior of the control needs to be overridden. There is no need to code an event handler to be notified of events within a widget, like mouse clicks on a button, if the semantic event of interest is the button press.<p>When an end user clicks in a widget, events are transformed by the application core into cross-platform messages. For example, if an end user clicks on a button, the button-event handler receives an <a class="el" href="class_i_event.html#a5da3f680556754a421faa207a9d46b30">IEvent::LButtonDn</a> message. The responsibility of the event handler is to map these events into changes to the state of the control, which it does through interaction with the control&#39;s data model. For example, if a check box is selected, the state is represented by the control data interface <a class="el" href="class_i_tri_state_control_data.html">ITriStateControlData</a>. The event handler determines this state and calls <a class="el" href="class_i_tri_state_control_data.html#ac6387974308f2eeed0bf07ae68b5b261">ITriStateControlData::Deselect</a> when the check box is clicked in the selected state. For more information, see the API documentation for <a class="el" href="class_i_event_handler.html">IEventHandler</a> and the table in Key abstractions in the API.<h3><a class="anchor" id="id_attributes"></a> Attributes</h3><p>An attribute is a property of a control that is not an aspect of the data model but can be used in defining its visual representation, as well as other nonvisual properties. For example, the following are some of the attributes of a multiline text widget:<ul><li>The font ID used in rendering text.<li>The widget ID of the associated scrollbar.<li>Leading between the lines, expressed in pixels.<li>An instance of a <a class="el" href="class_p_m_point.html">PMPoint</a>, specifying the inset of the text from its frame.</ul><p>These attributes are defined in ODFRez data statements. The dimensions of a widget (for example) also can be defined in data statements, but this is a property directly associated with the view. The data model represents the widget state likely to be varied by an end user, like the contents of an edit box.<h2><a class="anchor" id="id_relevant_design_patterns"></a> Relevant design patterns</h2><p>Design patterns are &quot;simple and elegant solutions to specific problems in object-oriented software design&quot; (Gamma, et al.). The objective of such patterns is to write code with the following characteristics:<ul><li>Flexible - The code can be reused from many different contexts.<li>Well factored - Responsibilities of classes are not confused or confounded.<li>Easily comprehensible - There is a low barrier to understanding by new software developers.<li>Easy to extend and maintain.</ul><p>To understand design patterns, you must be aware of how objects in the pattern interact and how responsibilities are distributed between the classes involved. This section introduces some of the design patterns in the API related to the user interface.<p>These patterns are introduced here to provide a clear outline of the design commitments made in the API. Some of the abstractions may be unfamiliar, but they will be encountered repeatedly in developing plug-ins, so it is important to understand these patterns. Some patterns of relevance and their applicable domain are as follows:<ul><li>Observer - Event-notification framework. For example, observers are notified of changes in the control data model (the subject). See Observer pattern.<li>Chain of responsibility - Applicable to the event-handling architecture. The application event handler maintains a stack of event handlers, which are invited in turn to process the current event. If one does not handle the event, the next one down on the stack is invited to handle the event. This is not identical with the pattern described in Gamma et al., but the intent is the same. See Chain of responsibility.<li><a class="el" href="class_command.html">Command</a> pattern - <a class="el" href="class_command.html">Command</a> processing by the application core is an elaborated implementation of this pattern.</ul><h3><a class="anchor" id="id_observer_pattern"></a> Observer pattern</h3><p>The observer pattern also is referred to with the term &quot;publish-subscribe.&quot; This pattern is fundamental to the user-interface model. Every widget boss class aggregates an <a class="el" href="class_i_subject.html">ISubject</a> interface and, therefore, it can be observed.<p>The observer pattern is appropriate in the following situations:<ul><li>When the situation being modeled has two aspects-one dependent on the other-and you want to represent these in separate, lightly-coupled abstractions.<li>When change to one object requires change to another, but it is not known beforehand how many other objects need to be changed.<li>When one object needs to broadcast a state change to other objects registering an interest.</ul><p>The abstractions in the pattern are the observer and the subject. The subject abstraction encapsulates state of potential interest to client code, like the state of a check-box widget.<p>The observer is interested in changes to the subject. The observing abstraction determines when to register with a particular subject and when to deregister.<p>The observer registers an interest in being informed when the subject changes. For completeness, the pattern also specifies the ability of the observer to send a message to the subject to state it is no longer interested in being told about changes in the subject.<p>The observer pattern defines simple abstractions and a straightforward protocol for communication between the subject and observer. The sequence is as follows:<ol type="1"><li>The observer sends an attach message to the subject (similar to registering for a mailing list by sending one&#39;s e-mail address).<li>A client or owner of the subject sends it a notify message to indicate that any registered observers should be informed of a change.<li>When a change occurs, the subject sends an update message to the observer.<li>The observer queries the subject for details of the subject state in which it is interested.</ol><p>Changes in the state (data model) of widgets are observed by objects derived from a helper C++ class (<a class="el" href="class_c_observer.html">CObserver</a>). This allows creation of a listener object that is notified when the data model associated with a widget changes.<p>Observers are discussed in more detail in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>.<h3><a class="anchor" id="id_how_event_handlers_implement_controllers"></a> How event handlers implement controllers</h3><p>Events do not lead directly to observer notifications; there is an intermediate step in the user-interface model. <a class="el" href="class_i_event.html">IEvent</a> types, for example, do not convey the appropriate semantics to allow a listener to determine the meaning of an event; a mouse click on a radio button does not tell a listener enough about the action (selection or deselection). The listener would be aware only that a particular mouse event occurred. The missing data is the state of the widget.<p>The correct process is to attach to the data model of the widget and register for notification on changes in the data model. Rather than each individual observer having to maintain information about the state of the widget, this state is held in the control&#39;s data model, and many observers can listen for changes in this model.<p>For example, if a radio button is selected or deselected, the widget boss object&#39;s event handler changes the control data model. This, in turn, generates a call to the Update method in the observer. At this point, the implementation-specific code determines what operation to perform, based on the current state and the type of event. The parameters of the Update message specify to an observer the new state of the control.<p>Model-view controller (MVC) is a well-known mutation of the observer pattern. The model plays the role of subject in the observer pattern. The view is equivalent to the observer. The only new abstraction is the controller, which is implicit in the observer pattern; it is the entity that mediates between the end user (an event source) and the data model. The controller causes views to update after the data model is changed. The responsibilities of the elements of the MVC pattern are as follows:<ul><li>The controller receives end-user input events, queries or updates the model, and forces the views to refresh with new data.<li>The model is a data container. It is protected from the end user by the controller and encapsulates the state of interest to the end user.<li>The view consists of renderings of data supplied to it by the controller. Typically, the view cannot actively query the model but passively renders data.</ul><p>The controller separates the responsibility of dealing with user interaction from the entities responsible for displaying a view of the model or maintaining model state. It becomes particularly useful when not all end users have equal rights to change or query the model, and it mediates between the users and the data (state).<p>This pattern is especially useful when an application is involved in creating multiple renderings of the same data and keeping these synchronized across updates of the data.<h3><a class="anchor" id="id_the_role_of_mvc_in_the_user-interface_model"></a> The role of MVC in the user-interface model</h3><p>Strictly speaking, the application does not implement the pattern from the SmallTalk MVC. There are few explicitly named abstractions in the codebase named &lt;name&gt;Controller; for example, the <a class="el" href="class_i_dialog_controller.html">IDialogController</a> interface. In SmallTalk, there are classes in the class library named Model, View, and Controller, that are subclassed to build a user interface. There is no direct equivalent in the InDesign API. MVC is an approximation to the architecture and is a reasonable conceptual (high-level) description of the architecture; however, it is not accurate at a more detailed level.<p>Event handlers are related to controllers, because they act upon and change a model (the widget data model). The code that implements the widget data model in turn sends out notifications via the change manager, when the model is changed.<p>A widget&#39;s event handler changes the data model of a widget boss object directly, without using commands. A command sequence always is needed to change the native document model, which does not involve user-interface widget boss objects. The event handler is in the same role as the controller abstraction in the MVC pattern, because it sits between the data model and the end user, mediates changes in the model initiated by the end user, and indirectly triggers notifications about changes in the data model. In other words, within the InDesign user-interface architecture, the data model actively notifies the change manager about its change in state, rather than being a passive abstraction.<p>The data model of a widget boss object sends a change message to the change manager through the default <a class="el" href="class_i_subject.html">ISubject</a> implementation, and attached listeners receive an <a class="el" href="class_i_observer.html#aa0c8392d926684cf1000b2e902aa7a6e">IObserver::Update</a> message.<p>This pattern is encountered in the context of creating dialog interfaces by subclassing the partial implementation classes <a class="el" href="class_c_dialog_controller.html">CDialogController</a> and <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>. In the behavior of most widget boss classes, the notion of an explicit controller is not encountered directly, and you can largely forget about MVC when it comes to writing user-interface plug-ins. Think in terms of the observer pattern, and consider that changes to the control data model (subject, represented by <a class="el" href="class_i_subject.html">ISubject</a>) of a widget result in change notifications being sent to any registered observers (<a class="el" href="class_i_observer.html">IObserver</a>) on the abstract subject.<h3><a class="anchor" id="id_chain_of_responsibility"></a> Chain of responsibility</h3><p>The chain-of-responsibility pattern also is referred to with the term &quot;responder&quot; (see <a class="el" href="class_i_responder.html">IResponder</a> in the API) or &quot;event handler&quot; (see <a class="el" href="class_i_event_handler.html">IEventHandler</a> in the API). Use it in the following situations:<ul><li>When multiple objects might be able to handle a single request or event.<li>When it is not known beforehand which event handler will be used for a specific event.</ul><p>The key intent of this pattern is to give multiple objects a chance to handle a request or event. This pattern is useful when writing event handlers for plug-ins, as event handlers are stacked by the application core, and events are chained between the event handlers. If one handler does not signify that an event was handled, the next event handler receives notification of the event. The chaining stops if one handler claims responsibility for having handled the event and no further event propagation would occur.<p>The user-interface model does not implement the pattern exactly as specified in Gamma et al. In the API, there is an event dispatcher that takes responsibility for propagating the events instead of having each event handler explicitly be aware of the next handler in the chain.<h3><a class="anchor" id="id_facade"></a> Facade</h3><p>The intent of the facade pattern (Gamma et al.) is to provide a simplified interface to a complex subsystem. The abstractions in a facade pattern are the facade itself and subsystem classes. The facade knows the subsystem classes to which particular requests should be delegated. The suite architecture uses the facade pattern; suites provide a simplified API for potentially complicated selection format-specific code that has detailed knowledge of model structure.<p>Within the context of the InDesign selection architecture, the facade is the abstract interface of the suite itself (for example, <a class="el" href="class_i_table_suite.html">ITableSuite</a>), and the subsystem classes are those such as &lt;name&gt;ASB and &lt;name&gt;CSB, which add implementations of the suite interface to the abstraction and concrete-selection boss classes, respectively.<p>In the facade pattern, a client sends requests to the facade, which forwards them to the appropriate object in the subsystem. In the case of suites and the selection architecture, the client is the client code that handled (for example) a menu item. The integrator suite is responsible for choosing the correct implementation given the selection format and delegating the request to the correct implementation.<p>There are other examples of the facade pattern in the API, like the nudge-control widget (<a class="el" href="classk_nudge_control_widget_boss.html">kNudgeControlWidgetBoss</a>) and combo-box widgets (<a class="el" href="classk_combo_box_widget_boss.html">kComboBoxWidgetBoss</a>). These are relatively complex widgets that expose a more restricted API to client code, to allow it to manipulate their state and properties.<h3><a class="anchor" id="id_command"></a> Command</h3><p>The intent of the command pattern (Gamma et al.) is to encapsulate a request as an object, allowing clients to parameterize requests, enabling requests to be queued and executed at different times, and supporting an undo protocol. A major benefit of this pattern is that it decouples the object that calls an operation from the object that knows how to perform it.<p>The key abstraction in the command pattern is the client, which creates a command, a specification of a parameterized operation. The caller executes the command subject to its scheduling preferences. A receiver abstraction knows how to perform the command; for example, an abstraction that can perform a copy on a document page item. The receiver is referenced from the command, to allow the caller to indirectly execute the required operations.<p>Within the application, client code (often user-interface code) takes on the role of the client; the caller is the command-execution framework of the application core. Client code also may provide the receiver (or delegate to another abstraction within the API). At its most basic, the command abstraction should support an execute method; ideally, it also should support an undo protocol.<h3><a class="anchor" id="id_widget-observer_pattern"></a> Widget-observer pattern</h3><p>The widget-observer pattern is a specialization of the observer pattern that applies in the following circumstances:<ul><li>You have many controls on a panel, and you want to get notifications about changes in their state.<li>You do not want to subclass every widget boss class involved, just to aggregate an <a class="el" href="class_i_observer.html">IObserver</a> on each.</ul><p>Rather than having to subclass all the controls you use on a panel, use one widget observer aggregated on the parent panel boss class. Use the observer implementation to attach to and detach from the <a class="el" href="class_i_subject.html">ISubject</a> interface on the widgets of interest, when this widget observer is sent <a class="el" href="class_i_observer.html#a12bc459ed90506d5db2f65eba174cbb5">IObserver::AutoAttach</a> and <a class="el" href="class_i_observer.html#a445bcbf0de3bc0ba9b07eae6ff5a8206">IObserver::AutoDetach</a> messages.<p>There is an extension of this pattern that you can use when you also want to observe changes in the active context. Observing changes in the active context is very common when writing panels that may be constantly present and provide some form of read-out about the application state. This extended pattern for receiving notification about changes in control state on a panel and notification about changes in the active context can be called the &quot;active-selection and widget-observer pattern&quot;; it requires you to aggregate a standard API implementation of <a class="el" href="class_i_control_view_observers.html">IControlViewObservers</a> on the panel-widget boss class. The corresponding ODFRez data statements are sufficient to create all wiring for the observer implementations to be auto-attached and detached. In the old InDesign 1.x architecture, there was no way to do this, and it would have been necessary to create a dummy observer that simply called AutoAttach on other observers on a given boss object.<p><b>IControlViewObserver</b><p>Adding a widget observer and active-selection observers to a single-panel boss class and using the <a class="el" href="class_i_control_view_observers.html">IControlViewObservers</a> mechanism to wire these in ODFRez data is a very common pattern in the InDesign application codebase. For example, panels-like the Character panel-observe changes in the active context and update states of the widgets, while simultaneously monitoring for changes in the state of many combo-box widgets and so on, using a widget observer and an active-selection observer that are hooked up by <a class="el" href="class_i_control_view_observers.html">IControlViewObservers</a>.<p>For an example of adding a widget observer, an active-context observer, and control-view observers, see the boss-class definition for <a class="el" href="classk_tbl_att_panel_widget_boss.html">kTblAttPanelWidgetBoss</a> in &lt;SDK&gt;/source/sdksamples/tableattributes/TblAttr.fr.<p>See the TblAttPanelWidget type definition, which adds the field to the type statement for the ODFRez panel widget.<h2><a class="anchor" id="id_persistence_and_widgets"></a> Persistence and widgets</h2><p>Widget boss classes descend from <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>, which exposes the <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> interface. This means a widget boss object can read its initial or stored state for any persistent interfaces exposed by the widget boss class. An interface is persistent if and only if its implementation is declared with the CREATE_PERSIST_PMINTERFACE macro, in which case it must implement a ReadWrite method.<p>The initial state of a widget is created by reading data from the plug-in resource in the very first instance. The persistent interfaces on a widget boss class, like <a class="el" href="class_i_control_view.html">IControlView</a>, read their initial state from the plug-in resource.<p>There is a simple rule for understanding which interfaces should be persistent in a widget boss class: at least the interfaces that are bound to ODFRez types should be persistent. If not, there is no way for them to read their initial state from the binary data in the plug-in resource.<p>Consider the example with the integer edit box and nudge control shown in the figure in Sample user interface on page 237. There are four interfaces bound to ODFRez types (see the figure in &quot;Type binding&quot;), and other interfaces on this boss class that are not bound to ODFRez types. The following table shows some of the interfaces on the boss class, whether they are persistent, and whether they are bound to an ODFRez type.<p>Interfaces, with persistence and binding information:<table class="doxtable"><tr><th>Interface </th><th>Implementation ID </th><th>Persistent? </th><th>Bound to ODFREz type? </th></tr><tr><td><a class="el" href="class_i_control_view.html">IControlView</a></td><td>kNudgeEditBoxViewImpl </td><td>Yes </td><td>Yes </td></tr><tr><td><a class="el" href="class_i_edit_box_attributes.html">IEditBoxAttributes</a></td><td>kEditBoxAttributesImpl </td><td>Yes </td><td>Yes </td></tr><tr><td><a class="el" href="class_i_event_handler.html">IEventHandler</a></td><td>kEditBoxEventHandlerImpl </td><td>No </td><td>No </td></tr><tr><td><a class="el" href="class_i_observer.html">IObserver</a></td><td>kCNudgeObserverImpl </td><td>No </td><td>No </td></tr><tr><td><a class="el" href="class_i_text_control_data.html">ITextControlData</a></td><td>kEditBoxTextControlDataImpl </td><td>Yes </td><td>Yes </td></tr><tr><td><a class="el" href="class_i_text_data_validation.html">ITextDataValidation</a></td><td>kIntTextValidationImpl </td><td>Yes </td><td>Yes </td></tr><tr><td><a class="el" href="class_i_text_value.html">ITextValue</a></td><td>kIntTextValueImpl </td><td>Yes * (see note below table) </td><td>No </td></tr></table><dl class="section note"><dt>Note<dd><a class="el" href="class_i_text_value.html">ITextValue</a> is specified as persistent in the implementation code but is not bound to any specific ODFRez type. This interface provides an API to read and write formatted values, and it cannot be initialized by ODFRez data statements.</dl><p>In theory, a third-party software developer can create an entirely new widget boss class, deriving from <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a> and providing the implementation of required interfaces like <a class="el" href="class_i_control_view.html">IControlView</a> and <a class="el" href="class_i_event_handler.html">IEventHandler</a>. Extreme care must be taken to ensure that the specification of the fields in the xxx.fh file matches the order in which the data is read or written in the ReadWrite method of any persistent interfaces on the new widget boss class. The key point to remember is that a binding between an ODFRez type and an interface ID means the (implementation of) the interface must be persistent.<p>All widgets have an initial state defined by ODFRez data statements. The ReadWrite method of the persistent interface implementation is called during the initialization of widget boss objects, when an object is created by reading its initial state from a plug-in resource or saved-data database. If there is no saved data, the widget boss object is initialized from the plug-in resource. If there is saved data, any persistent data associated with the widget is read back from the saved data, including parameters like position and size (for resizable elements such as resizable panels).<h2><a class="anchor" id="id_resource_roadmap"></a> Resource roadmap</h2><h3><a class="anchor" id="id_architecture"></a> Architecture</h3><p>A typical plug-in comprises the following:<ul><li>Top-level framework resource files (.fr) that contain boss-class definitions, new ODFRez custom-resource type definitions, and other resources, like view definitions and nontranslated string tables.<li>Localized framework resource files (the names of which end in something like &quot;_enUS.fr&quot;) that contain the ODFRez data statements required to define the plug-in user interface on a per-locale basis.<li>C++ code that implements the interfaces in the boss-class definitions.</ul><p>The framework resources are compiled using the ODF resource compiler (ODFRC). The C++ code is compiled by the appropriate compiler for the platform. The boss-class definitions are the starting point to understand a new code base; they specify the subclasses for the new boss classes that the plug-in adds to the API, and promise implementations of interfaces.<h3><a class="anchor" id=""></a></h3><p>The ODF resource language (ODFRez) is a cross-platform solution for defining user-interface resources. ODFRez is based on Rez, the Apple resource utility available with Apple MPW. ODFRez differs from Rez in minor respects; it is intended as an object-oriented, cross-platform, resource-definition format, and it is case-sensitive.<p>The ODF resource compiler, ODFRC, compiles files written in the ODFRez language. The ODFRez language has a very simple grammar and provides a comprehensive way to define resources, not write programs. There is support for code in other languages that can be embedded, but this capability is limited; only constant C expressions can be embedded in ODFRez files.<p>ODFRez files contain both type statements (defining new types, or the equivalent of resource classes) and resource-data statements (instances of types). The following example shows a separator widget type being defined; that is, definition of the ODFRez custom-resource type SeparatorWidget, which extends the ODFRez custom-resource type, Widget. A ClassID field is initialized to the value of <a class="el" href="classk_separator_widget_boss.html">kSeparatorWidgetBoss</a>, specifying the class that provides the behavior behind this widget. <div class="fragment"><div class="line"><span class="comment">// The ODFRez type expression defining that the SeparatorWidget extends the </span></div><div class="line"><span class="comment">// base type, Widget, and has a field of type CControlView. </span></div><div class="line">type SeparatorWidget (kViewRsrcType) : </div><div class="line"><span class="comment">// note that this is a view-resource type Widget </span></div><div class="line"><span class="comment">// superclass for this type - the base ODFRez Widget </span></div><div class="line">(<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_separator_widget_boss.html">kSeparatorWidgetBoss</a>) </div><div class="line"><span class="comment">// ClassID is a field of Widget, bound here to a boss class kSeparatorWidgetBoss </span></div><div class="line">{</div><div class="line"> CControlView; <span class="comment">// field belonging to the SeparatorWidget type </span></div><div class="line">};</div></div><p>ODF resources are created in one or more ODF resource-definition files. These files are text files with .fr extensions. There also may be platform-specific resources associated with a plug-in, like icons, PICT, or Windows bitmap resources, though plug-ins should be using PNG-based resources wherever possible, because it is a cross-platform format.<h3><a class="anchor" id="id_top-level_framework_resources"></a> Top-level framework resources</h3><p><b>PanelList resource</b><p>Panels are containers for widgets housed in palettes. They enable panels to be ordered, dragged around, shown, and hidden. An example of a panel contained in a palette is the Stroke panel.<p>The root panel for a plug-in is defined in a PanelList resource. The ODFRez custom-resource type PanelList specifies what plug-in ID the panels are associated with, a resource ID to use in loading the panels, and how each panel interacts with the menu subsystem.<p>To understand the PanelList, it is important to be able to distinguish between the ODFRez PanelList type (the template, just like a C++ class declaration) and an ODFRez data statement defining an instance of a PanelList:<ul><li>The template for PanelList is prefaced by type; for example: &quot;type PanelList (kPanelListRsrcType).&quot;<li>An instance of a PanelList is prefaced by resource; for example: &quot;resource PanelList (kSDKDefPanelResourceID).&quot;</ul><p><b>Nontranslated StringTable resource</b><p>There is a StringTable resource where the plug-in developer can place strings that are not to be translated. To minimize the amount of unnecessary duplication of strings across the locale-specific string tables, pay careful attention to localization. For examples of localization, refer to the SDK sample plug-ins.<h3><a class="anchor" id="id_localizing_framework_resources"></a> Localizing framework resources</h3><p>Strings displayed in the user-interface elements, except the layout widget (the document view), are likely to require localization. From a programming perspective, consider the following entities when localizing:<ul><li>View resources - The geometry of a panel may change in a language like German, in which, on average, strings are longer than in English.<li>Strings - The display of strings may change on dialog boxes and panels (as labels), and on menus as the names for menu items.</ul><p>For each of these entities, there should be an ODFRez <a class="el" href="class_locale_index.html">LocaleIndex</a> custom resource, which provides the offsets the application framework needs to switch to the localized data for a particular locale. There also should be an appropriate ODFRez StringTable or view resource in the localized framework resource files, to match those promised in the ODFRez <a class="el" href="class_locale_index.html">LocaleIndex</a> statements.<p>For most purposes, the recommended string class to use in the API is <a class="el" href="class_p_m_string.html">PMString</a>. The application architecture tries to translate all PMStrings for display in the user interface, unless they are explicitly marked as nontranslatable, either by being included in the nontranslate string table (which, in general, should be very small) or by calling a SetTranslatable(kFalse) on a <a class="el" href="class_p_m_string.html">PMString</a> before it is used. You should provide a translation for every string likely to be displayed in the user interface, in locale-specific string tables.<p><b>Localization and <a class="el" href="class_locale_index.html">LocaleIndex</a> resources</b><p>The mechanism of localization is extremely straightforward using the application architecture. The key is to manipulate string keys (keys into the StringTable for a locale) rather than thinking in terms of strings as values.<p>The <a class="el" href="class_locale_index.html">LocaleIndex</a> resource is a look-up table that specifies how to locate a particular resource given the locale. A <a class="el" href="class_locale_index.html">LocaleIndex</a> resource should be declared for each of the following:<ul><li>Each view that is to be localized.<li>The localized string table.<li>The nontranslated string table.</ul><p>When adding new resource statements for views, a common mistake is to forget the <a class="el" href="class_locale_index.html">LocaleIndex</a> associated with the view. The type expressions and the data statements for the view may be perfectly formed, but without the <a class="el" href="class_locale_index.html">LocaleIndex</a> resource telling the localization subsystem which view to choose for which locale, the widgets corresponding to the view resource do not appear. The <a class="el" href="class_locale_index.html">LocaleIndex</a> type is defined in the SDK header file <a class="el" href="_locale_index_8h_source.html">LocaleIndex.h</a>. The ODFRez <a class="el" href="class_locale_index.html">LocaleIndex</a> type is a template for defining resources that enables the application core to choose the correct views and strings, given the current locale setting.<h3><a class="anchor" id="id_resource_compilers"></a> Resource compilers</h3><p>It is important to understand how the files that make up a plug-in project are compiled. The following table lists the tools used for compiling resources.<table class="doxtable"><tr><th>Platform </th><th>Tool </th><th>Description </th></tr><tr><td>Mac OS </td><td>ODFRC </td><td>Plug-in for Metrowerks CodeWarrior. </td></tr><tr><td>Mac OS </td><td>Rez </td><td>Platform-native compiler which compiles any platform-specific resources, like icons or .rsrs or .r files. </td></tr><tr><td>Windows </td><td>ODFRC.exe </td><td>Windows executable version of the ODF resource compiler that produces Windows binary resources. </td></tr><tr><td>Windows </td><td>RC.exe </td><td>Platform-native resource compiler which compiles the RC file present in a plug-in and any other platform-specific resources, like icon definitions. </td></tr></table><p>The same (header) file may be compiled with the C++ compiler, ODFRC compiler, and platform-native resource compiler; this is achieved by using macros. Some of the key macros can be found in <a class="el" href="_cross_platform_types_8h_source.html">CrossPlatformTypes.h</a>, with core data types defined in <a class="el" href="_core_res_types_8h_source.html">CoreResTypes.h</a>.<h2><a class="anchor" id="id_customizing_a_widget"></a> Customizing a widget</h2><p>A common reason to add a new interface to an existing widget boss class is to create a new widget boss class that exposes an <a class="el" href="class_i_observer.html">IObserver</a> interface. This is the pattern for obtaining notification about changes to the data model of a particular widget boss object. If you have many widgets on a panel, use the pattern described in Widget-observer pattern. Otherwise, you risk the unnecessary proliferation of entities that may lead to problems later.<p>For example, suppose a software developer wrote a new type of panel with a single list box on it. When an end user makes a new selection in the list box, client code receives an update message on the <a class="el" href="class_i_observer.html">IObserver</a> interface. The parameters of the update message specify the type of change that occurred. In this instance, the software developer would subclass the <a class="el" href="classk_widget_list_box_widget_new_boss.html">kWidgetListBoxWidgetNewBoss</a> boss class and extend the ODFRez custom-resource type WidgetListBoxWidgetN, binding it to the new boss type.<p>For controls on dialog boxes, generally there is no need to subclass a widget boss class for each of the controls to get notification about events. There can be one observer for all controls on the dialog box, which can choose to attach to particular controls on the dialog box if notifications about changes in data are required before the dialog box is closed. The helper class <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> (partial implementation of <a class="el" href="class_i_observer.html">IObserver</a>) provides an API that is extremely useful for attaching to and detaching from controls on a dialog box. It also should be used as the basis for an override of the <a class="el" href="class_i_observer.html">IObserver</a> interface on the <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> class. If you use DollyXs to generate the boilerplate for a dialog box, by default you already have an implementation of an observer that gets notification about all controls. This actually is an implementation of the widget-observer pattern, which merely generalizes the notion to an arbitrary parent-widget type.<h2><a class="anchor" id="id_advanced_event_handling"></a> Advanced event handling</h2><h3><a class="anchor" id="id_writing_a_proxy_event_handler"></a> Writing a proxy event handler</h3><p>The way in which the observer design pattern is implemented in the user-interface model means client code can be notified about widget events without an event handler having to be implemented in your plug-in. In general, this is sufficient for client code to be responsive to end-user events. This pattern simplifies client code and avoids client code having to turn low-level events (like a mouse move or button press) into semantic events (like a check-box widget becoming checked). Even notification of single keystrokes can be sent to an observer of a text widget, so the granularity of notification is potentially quite fine.<p>The event-handler implementations in the InDesign/InCopy user interface can have an inheritance hierarchy several levels deep. In most cases, it is not possible to subclass the implementation by straightforward C++ techniques, because most event-handler implementation headers are not exposed to plug-in developers.<p>There are specialized cases in which some knowledge of the event-handling model is useful and the ability to override the default event handling for a control is essential. An example is when there is a requirement to specialize the event-handling behavior of a particular control, such as to perform a special function in response to a double click. The challenge is that most of the event-handler implementation classes are not exposed to plug-in developers, because these may involve deep hierarchies of implementation classes that also are not public. It breaks the encapsulation in the user-interface API if client code comes to depend on this code. Fortunately, there is a convenient workaround for this, by using a proxy or delegate pattern.<h3><a class="anchor" id="id_watching_events"></a> Watching events</h3><p>The concept of overriding the default event handler for a control using the proxy technique, which is often all that is appropriate, implies handling many messages. Often, only a few messages are of interest, and you want a technique with more precision. The event-watcher (<a class="el" href="class_i_event_watcher.html">IEventWatcher</a>) abstraction can target specific events, and a particularly useful partial implementation class (<a class="el" href="class_c_idle_mouse_watcher.html">CIdleMouseWatcher</a>) can provide a convenient source of information about MouseMove events, without the need to register every MouseMove event associated with a control.<p>For example, the JPEG Export dialog box has a feature that allows a description of the widget over which the mouse pointer is hovering, based on the <a class="el" href="class_c_idle_mouse_watcher.html">CIdleMouseWatcher</a> partial implementation. This implementation class can be used to create a mouse event watcher without having to use a proxy event-handler pattern.<h2><a class="anchor" id="id_key_abstractions_in_the_api"></a> Key abstractions in the API</h2><p>The following table shows some of the key interfaces and summarizes their responsibilities. The <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a> boss class is the ancestor for all API widget boss classes. Some of these are found on <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>. For a complete list of interfaces on <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>, refer to the API Reference.<table class="doxtable"><tr><th>Name </th><th>Key responsibilities </th></tr><tr><td><a class="el" href="class_i_control_view.html">IControlView</a></td><td>Implements the widget view (the visual representation of a widget) and stores properties like its dimensions or visibility. Every widget boss class provides an implementation of the <a class="el" href="class_i_control_view.html">IControlView</a> interface, and the <a class="el" href="class_i_control_view.html#aec14fd20f70d44b1b43df9c47458ce24">IControlView::Draw</a> method determines how it renders its appearance. For more detail on owner-draw controls, refer to the API Reference for <a class="el" href="class_i_control_view.html">IControlView</a> and the CustomDataLink and PanelTreeView SDK samples. </td></tr><tr><td><a class="el" href="class_i_subject.html">ISubject</a></td><td>Makes a widget observable by observers. Exposed by <a class="el" href="classk_base_widget_boss.html">kBaseWidgetBoss</a>, so every widget also is a subject. </td></tr><tr><td><a class="el" href="class_i_observer.html">IObserver</a></td><td>Provides notification when widgets change. Implements the observer component of the observer design pattern. You add an implementation of <a class="el" href="class_i_observer.html">IObserver</a> in to a widget boss class to let your code be called when a widget or one of its dependents is changed. </td></tr><tr><td><a class="el" href="class_i_panel_control_data.html">IPanelControlData</a></td><td>Used to traverse the widget tree in the direction of the leaves. Found on container widget boss classes (like panels or dialog boxes). </td></tr><tr><td><a class="el" href="class_i_widget_parent.html">IWidgetParent</a></td><td>Allows the widget tree to be traversed in the direction of the root. At the root of a typical widget hierarchy (associated with a panel or dialog box) is a window boss object. Given an interface pointer referring to one widget boss object, it is possible to walk up the widget hierarchy, querying for a particular interface, until reaching the root. </td></tr><tr><td><a class="el" href="class_i_event_handler.html">IEventHandler</a></td><td>An event-handling API. The event dispatcher in the application core dispatches events to a widget&#39;s event handler, according to its own logic. Your client code typically uses the observer pattern only to receive notification about changes in control state and does not need to implement event handlers. </td></tr><tr><td><a class="el" href="class_i_tip.html">ITip</a></td><td>Allows a tip to be defined in ODFRez data statements. </td></tr><tr><td><a class="el" href="class_i_p_m_persist.html">IPMPersist</a></td><td>Allows the widget to read its state from the plug-in resource&#39;s saved data and to write its state back to saved data. </td></tr></table><h1><a class="anchor" id="id_suppressed_user_interface"></a> Suppressed User Interface</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>This chapter describes the suppressed user interface feature and how plug-in developers can use it to hide or disable pieces of the InDesign or InCopy user interfaces.<p>Sometimes it is valuable to remove or disable some functions. For example, system integrators may want to disable particular features or controls. The easiest way to do this is to remove nonrequired user-interface plug-ins that provide access to the undesirable features. While this works in the simplest of cases, it does not provide the granularity necessary in most cases. Most often, it is desirable to disable parts of a plug-in. Suppressed user interface allows plug-in developers to disable or hide menus, actions, and widgets; and disable drop operations for specific widgets.<p>In this chapter, suppress means hide or disable.<h2><a class="anchor" id="id_architecture"></a> Architecture</h2><p>The suppressed user-interface architecture is straightforward. An implementation of <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> was added to <a class="el" href="classk_session_boss.html">kSessionBoss</a>. The menu, action, widget and drag-and-drop code calls methods on this interface to determine whether a user-interface element is suppressed. The implementation of <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> does not track suppressed widgets; instead, it forwards the method calls to the <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementations on kSuppressedUIService service provider bosses. These service provider bosses are the extension point for third-party developers.<p>The minimum requirement for a plug-in to become part of the decision-making process is to provide a service provider like the following: <div class="fragment"><div class="line">Class{</div><div class="line"> kMySuppressedUIServiceBoss, kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IK2SERVICEPROVIDER, kSuppressedUIServiceProviderImpl,</div><div class="line"> IID_ISUPPRESSEDUI, kMySuppressedUIImpl</div><div class="line"> }</div><div class="line">}</div></div><p>In the above, kSuppressedUIServiceProviderImpl is provided by InDesign. It is a premade implementation of <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> that identifies this service provider as type kSuppressedUIService. The other implementation, kMySuppressedUIImpl, is where the interesting work would occur.<p>For an illustration of how the method calls are forwarded to service providers, consider what happens when an otherwise enabled widget is added to a panel. The widget code calls IsWidgetDisabled() on the <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementation aggregated on <a class="el" href="classk_session_boss.html">kSessionBoss</a>. This implementation forwards the call to the service providers, by looping through calling IsWidgetDisabled () on the <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementation. If one service provider returns kTrue, it breaks out of the loop by immediately returning kTrue. If all service providers return kFalse, the forwarding method also returns kFalse. The widget is then enabled or disabled, based on the results of this call.<dl class="section note"><dt>Note<dd>Supresssed user interface is architected for static solutions; that is, the user-interface configuration does not change during an application instantiation. To show the new state, the user interface that is supressed needs to be redrawn. If a suppressed control is on a panel, the control&#39;s new state is not drawn until the next update event on the control, which does not happen until events occur like the panel being closed and reopened. The SDK sample &quot;suppui&quot; uses some of the user interfaces that always are redrawn before they are displayed, such as menu items; this may lead to confusion about dynamic support for supressed user interface.</dl><h2><a class="anchor" id="id_xml-based_implementation"></a> XML-based implementation</h2><p>Depending on your requirements, you may not need to write your own <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementation. InDesign provides an <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementation (kSuppressedUIWithXMLFileImpl) that suppresses user-interface items (menus, actions, widgets, and drop targets) based on the content of a specified XML file. To use this implementation in your service provider boss, use kSuppressedUIWithXMLFileImpl as the <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementation. You also will need to provide an <a class="el" href="class_i_sys_file_data.html">ISysFileData</a> implementation, which is used to specify the XML file. Your boss will look something like the following: <div class="fragment"><div class="line">Class{</div><div class="line"> kMySuppressedWithXMLUIServiceBoss,</div><div class="line"> kInvalidClass, {</div><div class="line"> IID_IK2SERVICEPROVIDER, kSuppressedUIServiceProviderImpl,</div><div class="line"> IID_ISUPPRESSEDUI, kSuppressedUIWithXMLFileImpl,</div><div class="line"> IID_ISYSFILEDATA, kMySuppressedUISysFileImpl,</div><div class="line"> }</div><div class="line">}</div></div><p>When providing an ISysFile Implementation, you may provide your own <a class="el" href="class_i_sys_file_data.html">ISysFileData</a> implementation, as shown above. Alternately, you can reuse kSysFileDataImpl which is provided by InDesign. The difference lies in how the data is initialized. If you provide your own implementation, you can initialize your class to point to a file of your liking. If you reuse kSysFileDataImpl, you must set its data before it is used. One way to do that is to provide a start-up service (<a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a>) that sets the SysFileData at start-up. Then, at any other time, you could set <a class="el" href="class_i_sys_file_data.html">ISysFileData</a> and call <a class="el" href="class_i_suppressed_u_i.html#a41c3df494e36838898650cad4708a2e5">ISuppressedUI::Reset()</a> to force the kSuppressedUIWithXMLFileImpl to read the XML file. To get to the <a class="el" href="class_i_sys_file_data.html">ISysFileData</a> interface from your service boss, you can call IK2ServiceRegistry::QueryServiceProviderByClassID(kSuppressedUIService,kMySuppressedUIWithXMLUIServiceBoss). For an example of how to add your own XML based service, see the SuppUI sample project.<h2><a class="anchor" id="id_xml_file_format"></a> XML file format</h2><p>The XML file should be well formed, with a single root element of type SuppressedUI; for example: <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-16&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;SuppressedUI&gt;</div><div class="line"> &lt;SuppressedWidget widgetID=<span class="stringliteral">&quot;8457&quot;</span> ancestorWidgetID=<span class="stringliteral">&quot;0&quot;</span> restrictionType=<span class="stringliteral">&quot;disable&quot;</span>&gt;&lt;/SuppressedWidget&gt;</div><div class="line"> &lt;SuppressedWidget widgetID=<span class="stringliteral">&quot;1538&quot;</span> ancestorWidgetID=<span class="stringliteral">&quot;23506&quot;</span> restrictionType=<span class="stringliteral">&quot;disable&quot;</span>&gt;&lt;/SuppressedWidget&gt;</div><div class="line"> &lt;SuppressedAction actionID=<span class="stringliteral">&quot;263&quot;</span> restrictionType=<span class="stringliteral">&quot;disable&quot;</span>&gt;&lt;/SuppressedAction&gt;</div><div class="line"> &lt;SuppressedMenu menuName=<span class="stringliteral">&quot;Main:&amp;amp;Type:&amp;amp;Font&quot;</span> restrictionType=<span class="stringliteral">&quot;hide&quot;</span>&gt;&lt;/SuppressedMenu&gt;</div><div class="line"> &lt;SuppressedDragDrop widgetID=<span class="stringliteral">&quot;8455&quot;</span> ancestorWidgetID=<span class="stringliteral">&quot;0&quot;</span>&gt;&lt;/SuppressedDragDrop&gt;</div><div class="line"> &lt;SuppressedPlatformDialogControl PlatformDialogControlIdentifier=<span class="stringliteral">&quot;AllOpenDocDialogCustomControls&quot;</span>&gt;&lt;/SuppressedPlatfrmDialogControl&gt;</div><div class="line"> &lt;SuppressedPlatformDialogControl PlatformDialogControlIdentifier=<span class="stringliteral">&quot;PlaceFileImportOptionsCheckbox&quot;</span>&gt;&lt;/SuppressedPlatfrmDialogControl&gt;</div><div class="line">&lt;/SuppressedUI&gt;</div></div><p>Any of the following five elements and their attributes can be used:<ul><li>SuppressedWidget<li>SuppressedAction<li>SuppressedMenu<li>SuppressedDragDrop<li>SuppressPlatformDialogControl</ul><p>They are all described below.<h3><a class="anchor" id="id_suppressedwidget"></a> SuppressedWidget</h3><p>The SuppressedWidget element is used to suppress widgets. It should contain the attributes shown in the following table.<table class="doxtable"><tr><th>Attribute name </th><th>Type </th><th>Summary </th></tr><tr><td>widgetID </td><td>CDATA </td><td>This specifies which widget is being disabled or hidden. Provide a WidgetID in decimal format. </td></tr><tr><td>ancestorWidgetID </td><td>CDATA </td><td>In some cases, you may need to qualify a widgetID. For example, suppose you want to disable the OK button in the Style Options dialog. The Widget ID (kOKButtonWidgetID) is shared by many dialogs. Without qualifying it with an ancestorWidgetID, the OK button would be suppressed on all dialogs. To prevent this, you need to specify (in decimal format) the WidgetID of the Style Options dialog, using the ancestorWidgetID attribute. A value of &quot;0&quot; means no ancestor. </td></tr><tr><td>restrictionType </td><td>CDATA </td><td>This specifies how the widget is suppressed. The choices are disable or hide. </td></tr></table><h3><a class="anchor" id="id_suppressedaction"></a> SuppressedAction</h3><p>The SuppressedAction element is used to suppress actions. It should contain the attributes shown in the following table.<table class="doxtable"><tr><th>Attribute name </th><th>Type </th><th>Summary </th></tr><tr><td>actionID </td><td>CDATA </td><td>This specifies which action is being disabled or hidden. Provide a ActionID in decimal format. </td></tr><tr><td>restrictionType </td><td>CDATA </td><td>This specifies how the action is suppressed. The choices are disable or hide. </td></tr></table><h3><a class="anchor" id="id_suppressedmenu"></a> SuppressedMenu</h3><p>The SuppressedMenu element is used to suppress menus. It should contain the attributes shown in the following table.<table class="doxtable"><tr><th>Attribute name </th><th>Type </th><th>Summary </th></tr><tr><td>menuName </td><td>CDATA </td><td>This specifies a menu name; for example, &quot;Main: \&amp;amp;Type:\&amp;amp;Font.&quot; </td></tr><tr><td>restrictionType </td><td>CDATA </td><td>This specifies how the action is suppressed. The choices are disable or hide. </td></tr></table><h3><a class="anchor" id="id_suppresseddragdrop"></a> SuppressedDragDrop</h3><p><b>Description</b><p>The SuppressedDragDrop element is used to disable drag and drop operations for particular widgets. It should contain the attributes shown in the following table.<table class="doxtable"><tr><th>Attribute name </th><th>Type </th><th>Summary </th></tr><tr><td>widgetID </td><td>CDATA </td><td>This specifies a widget. Provide a WidgetID in decimal format. </td></tr><tr><td>ancestorWidgetID </td><td>CDATA </td><td>In some cases, you may need to qualify a widgetID. For example, suppose you want to disable the OK button in the Style Options dialog. The Widget ID (kOKButtonWidgetID) is shared by many dialogs. Without qualifying it with an ancestorWidgetID, the OK button would be suppressed on all dialogs. To prevent this, you must specify (in decimal format) the WidgetID of the Style Options dialog, using the ancestorWidgetID attribute. A value of &quot;0&quot; means no ancestor. </td></tr></table><h3><a class="anchor" id="id_suppressplatformdialogcontrol"></a> SuppressPlatformDialogControl</h3><p><b>Description</b><p>Platform dialogs like Place, Open, and Save are provided by the operating system. InDesign uses such dialogs but adds its own custom controls. This element is used to suppress these custom controls on platform dialogs. It should contain the attributes shown in the following table.<table class="doxtable"><tr><th>Attribute name </th><th>Type </th><th>Summary </th></tr><tr><td>PlatformDialogControlIdentifier </td><td>CDATA </td><td>This specifies which custom controls to suppress. </td></tr></table><h2><a class="anchor" id="id_suppressedui_tool"></a> SuppressedUI tool</h2><p>The SuppressedUIPanel plug-in (also known as the SuppressedUI tool) can be used in conjunction with the debug build to discover widget IDs and generate XML files as described above. It is included with the debug builds of InDesign and InCopy (in the &quot;tools&quot; folder), but due to start-up costs and potential confusion, it is not loaded by default. To load the plug-in, you need to manually copy it to the &quot;plug-ins&quot; folder in your debug build. When installed, it is available under the SuppressedUI Tool menu item in the Windows menu.<p>Although the SuppressedUI Tool can be very useful, it has several significant limitations. Before using the tool, be sure to read and understand SuppressedUI tool limitations.<p>The SuppressedUIPanel plug-in provides a kSuppressedUIService service provider boss that uses the XML-based implementation (kSuppressedUIWithXMLFileImpl). This means when the plug-in is loaded, the specified widgets are suppressed. This is only for debug purposes. When your plug-in is deployed, you need to provide your own such service provider.<p>When the SuppressedUIPanel is loaded, it looks for the SuppressedUI.xml file in the user&#39;s application preferences folder. If the XML file is present, it is parsed, and its data is used to suppress the user interface. If no file is present, it is created with no elements.<p>The SuppressedUIPanel contains two subpanels.<ul><li>&quot;Configure Menus &amp; Actions&quot; can be used to suppress menu items and actions. It contains a Tree control that has a hierarchical list of menus and actions not contained in menus. An icon button on each element toggles the state of the menu/action among three values: unsuppressed, disabled, and hidden. A black eyeball icon indicates the is unsuppressed; a grey eyeball, is disabled; and an eyeball with a red X, hidden. Top-level menus, like File, Edit, and Object, cannot be suppressed. Palette menus (shown under Popups) may have strange names; because these names normally are not displayed in the user interface, they use names from the code. <div class="image"><img alt="plugin-programming-guide-vol2-79.gif" src="plugin-programming-guide-vol2-79.gif" /></div><li>&quot;Configure Widgets and DragDrop&quot; can be used to suppress widgets and disable them from accepting drop operations. You start by targeting the widget on which you want to operate. In this pane, there is a button with a target icon. To target a widget, click and drag from the button to the widget you want targeted. When you release the mouse, the first drop-down list, &quot;WidgetID to suppress,&quot; contains the ID name of the targeted widget. Next, suppress the item by clicking one of three buttons, Hide, Disable, or Disable Drop. The widget should then appear in the list at the bottom of the panel, which shows suppressed widgets. To unsuppress a widget, select it from the list and click the trash button at the bottom of the panel. <div class="image"><img alt="plugin-programming-guide-vol2-80.gif" src="plugin-programming-guide-vol2-80.gif" /></div></ul><p>If you open the &quot;WidgetID to suppress&quot; drop-down, you will see the targeted widget at the top of the list. For your convenience, all its ancestors also are added to the list. This is important because it is easy to target the wrong widget. For example, if you try to target the stroke styles drop-down, it may target the widget inside the drop-down that draws the line. This widget contains sub-widgets, which can be targeted. If you disable the sub-widget instead of the drop-down, the drop-down will still function. Instead, you need to select the appropriate ancestor, in this case the kStrokTypePopupWidgetId.<p>There is another drop-down, &quot;Qualifying WidgetID.&quot; Its purpose is to provide more context when WidgetIDs are shared. For example, many dialogs share the kOKButtonWidgetID. To disable the OK button in a specific dialog, you must specify the button&#39;s parent WidgetID in the &quot;Qualifying WidgetID&quot; drop-down. Doing so prevents the OK button from being disabled in all dialogs that share the kOKButtonWidgetID. To do this using the tool, you target a widget, then select the ancestor widget you want as your qualifier from the &quot;Qualifying WidgetID&quot; drop-down. Click one of the buttons to add this widget/qualifier combination to the suppressed list.<p>This tool does not handle platform dialog controls; these must be put in the XML file by hand. For more information, see XML file format.<h3><a class="anchor" id="id_suppressedui_tool_limitations"></a> SuppressedUI tool limitations</h3><p>Using the SuppressedUI tool on modal dialogs requires special care. For the SuppressedUI tool to work on modal dialogs, it must already be open when the dialog is opened. Furthermore, it must be opened before the dialog is opened for the first time. If you open the dialog before the SuppressedUI tool, you need to quit and delete the SavedData file in your preferences folder, to reset the dialog and allow you to use the tool for that dialog.<p>On Windows, if you have a modal dialog open, you can target a widget with the tool, but you will not be able to click the Hide, Disable, or Disable Drop buttons. Instead, target the widget and then dismiss the dialog. Once the dialog is dismissed, you can click the Hide (or other) button to suppress the widget.<p>Do not disable the top level widget in a dialog. If you disable the dialog widget, when you dismiss the dialog, the menus remain disabled as they were when the dialog was open.<p>When browsing the available actions in the SuppressedUI tool, you may see strange actions like &quot;dynamic&quot; or &quot;doesn&#39;t matter.&quot; These actions are present because the tool makes no effort to filter out special-case actions; it simply lists all actions defined. These particular actions exist but are not useful to the user; ignore them.<h2><a class="anchor" id="id_working_with_the_isuppressedui_api"></a> Working with the ISuppressedUI API</h2><p>The <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> interface is documented in the SDK API documentation. For a sample implementation, see the SuppUI sample project. The interface itself is not complex, but it is challenging to determine the appropriate IDs and menu paths. The best way to get around this is to use the SuppressedUI tool to discover IDs and menu paths, even if ultimately you will not use the XML-based implementation.<p>Before implementing this interface yourself, read and understand the following additional points:<ul><li>The methods of your implementation will be called very often. Performance is an important consideration. Poor implementations can slow down the entire application.<li>You can use the Reset() method to improve performance. For instance, if your implementation reads data from a file, you should build a cache when Reset() is called. Then, anytime the data file changes, you will need to query for <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> on your service provider, and call Reset() to rebuild the cache.<li>Calling Reset() on the gSession <a class="el" href="class_i_suppressed_u_i.html">ISuppressedUI</a> implementation forwards the Reset() call to all kSuppressedUIService service providers. In most cases, this probably is not what you want to do. If you just want to call your service providers <a class="el" href="class_i_suppressed_u_i.html#a41c3df494e36838898650cad4708a2e5">ISuppressedUI::Reset()</a>, query for it yourself using <a class="el" href="class_i_k2_service_registry.html#af48ecf78a979c8531bba066e3aa2bde4">IK2ServiceRegistry::QueryServiceProviderByClassID()</a>.<li>IsWidgetDisabled and IsWidgetHidden take an IControlView*. See the SuppUI sample for an example of how to extract a WidgetID or a parent WidgetID from the IControlView*.<li>When suppressing widgets, the hardest part may be determining the widget&#39;s WidgetID. You can learn a lot by opening the ID.h file for the feature you care about. This assumes you can identify the ID.h file in which the widget is defined. You may run into cases that are not obvious. It is easiest to use the SuppressedUI tool to discover WidgetIDs.<li>IsDragDropDisabled() is called with a lot of context. IDragDropTarget* and IDragDropSource* allow you to extract information on the target and source. DataObjectIterator* lets you peak at the flavors on the clipboard.<li>To suppress menu items with a corresponding action, implement IsActionDisabled() or IsActionHidden(). The IsSubMenuDisabled() and IsSubMenuHidden() methods are used to disable submenus. These are strictly menus and not items with a corresponding action. For example, to disable the entire Edit menu, you could use IsSubMenuDisabled().<li>Determining a menu path may involve thought or investigation. The path needs to be specified as an untranslated string. Furthermore, each menu has a name, and you may not know the name of the menu you are disabling. It is easiest to use the SuppressedUI tool.<li>Determining the names of platform dialog custom controls is more straightforward. The available dialogs and controls are listed in <a class="el" href="_suppressed_u_i_x_m_l_defs_8h_source.html">SuppressedUIXMLDefs.h</a>. For example, IsPlatformDialogControlSuppressed specifies all custom controls on the Place dialog.</ul><h2><a class="anchor" id="id_other_user-interface_suppression_mechanisms"></a> Other user-interface &quot;suppression&quot; mechanisms</h2><p>The application API supports other mechanisms that allow for customization and suppression of the user interface behavior:<ul><li>See <a class="el" href="class_i_menu_filter.html">IMenuFilter</a> in the API documentation. This abstraction allows for configuration of menu items as they are added.<li>See <a class="el" href="class_i_action_filter.html">IActionFilter</a> in the API documentation (and the CustomActionFilter SDK sample),. This abstraction allows for configuration of actions as they are added.<li>See the section on &quot;Working with the Quick Apply Dialog&quot; in <a class="el" href="id_solutions.html#id_user_interfaces">User Interfaces</a> for examples of using the <a class="el" href="class_i_quick_apply_service.html">IQuickApplyService</a> and <a class="el" href="class_i_quick_apply_filter_service.html">IQuickApplyFilterService</a> extension patterns to control the function available through the quick apply dialog.</ul><h1><a class="anchor" id="id_using_adobe_file_library"></a> Using Adobe File Library</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>This chapter describes the Adobe File Library (AFL) as it applies to developers of plug-ins for InDesign. This library provides utilities for manipulating files, paths, and directories on Windows and Mac OS. The chapter defines terms and explains key concepts related to the Adobe file library, provides detailed descriptions of the design and class hierarchy of the Adobe file library, and answers common questions.<p>The Adobe file library was designed with two goals in mind:<ul><li>Provide a unified collection of classes and utilities that can be used to perform all file and directory manipulation.<li>Provide a core architecture that can be used by other Adobe applications.</ul><p>To this end, the design includes a core set of classes and utilities that are independent of InDesign (that is, they do not rely on the InDesign model). In addition to the core architecture, there are classes and utilities that provide functions specific to InDesign, as well as model-dependent features.<p>Plug-in developers should use the <a class="el" href="class_i_d_file.html">IDFile</a>. <a class="el" href="class_i_d_file.html">IDFile</a> is an InDesign API class used to manipulate a file or directory specified by a path. <a class="el" href="class_i_d_file.html">IDFile</a> has a rich cross-platform method set including, for example, persistence of file and directory paths.<h2><a class="anchor" id="id_terminology"></a> Terminology</h2><p>The following terms are used throughout this chapter. They are illustrated in the following figure.<ul><li>Adobe file library (AFL) - A file library with APIs for file and directory manipulation.<li>Base name - The portion of a filename or directory name before the last period.<li>Directory - A construct provided by the operating system, which contains the names of files, other directories, or both. Directories are identified by directory paths.<li>Directory name - The last path component of a directory path.<li>Directory path - A path whose last component is a directory name.<li>Filename - The last path component of a file path.<li>File path - A path whose last component is a filename.<li>Extension - The portion of a filename or directory name after the last period.<li>Hierarchical File System (HFS) - The Mac OS standard file system format. It is used to represent a collection of files as a hierarchy of directories (folders), each of which may contain files or folders themselves.<li>Path - A sequence of path components. Each element except the last names a directory that contains the next element. The last element may name a directory or a file. The first element is closest to the root of the directory tree; the last element, farthest from the root.<li>Path component - A name of a volume, directory, or file that is an element of a path, separated by a path separator character (such as \, /, or :).</ul><div class="image"><img alt="plugin-programming-guide-vol2-81.gif" src="plugin-programming-guide-vol2-81.gif" /></div><h2><a class="anchor" id="id_adobe_file_library_architecture"></a> Adobe File Library architecture</h2><p>Adobe File Library is a dynamic library. It is in the Windows SDK at &lt;SDK&gt;\external\afl\libs\win\&lt;release_debug&gt;\AFL.lib. On Windows, if you have a plug-in project that uses Adobe file library, you need to explicitly link to AFL.lib. On Mac OS, AdobeAFL.framework is included in InDesignModel.framework), a universal binary that can be used on both PPC and i386 systems.<p>Adobe file library is not based on the InDesign object model and does not use concepts specific to InDesign, like bosses and interface IDs.<h3><a class="anchor" id="id_adobe_file_library_classes_and_utilities"></a> Adobe File Library classes and utilities</h3><p>The following figure provides an overview of file library classes and utilities provided by Adobe File Library. <div class="image"><img alt="plugin-programming-guide-vol2-82.gif" src="plugin-programming-guide-vol2-82.gif" /></div><p>AFile, APath, APathComponent, and AString form a composition chain. An AFile object represents a file or directory; it holds an APath object pointing to the full path of the file or directory. An APath object consists of one or more APathComponent objects; a sequence of path components forms a path. An APathComponent object consists of two AString objects, representing base and extension parts, respectively.<p>AFile and APath are not pure virtual classes: they have their own implementations that may be used by other Adobe products. <a class="el" href="class_i_d_file.html">IDFile</a> is the InDesign implementation of AFile. <a class="el" href="class_i_d_path.html">IDPath</a> is the InDesign implementation of APath. They extend their parent classes by providing additional methods specific to InDesign and InCopy.<p>CorePathUtils and CoreFileUtils provide core utilities that apply to both Windows and Mac OS. WinFileUtils provides utilities specific to Windows. MacFileUtils provides utilities specific to Mac OS. <a class="el" href="class_file_utils.html">FileUtils</a> provides file-manipulation utilities specific to InDesign and InCopy. See FileUtils class.<h3><a class="anchor" id="id_common_file_api"></a> Common file API</h3><p>The common file API comprises classes and utilities that can be used in InDesign and InCopy, as well as other Adobe products. For detailed methods and definitions, refer to the API Reference.<p><b>AString class</b><p>AString is a class used to hold and manipulate a UTF-16 string. AString has general string-manipulation methods, such as Append, Insert, and Length. AString has methods for converting to and from other string types. The common file implementation does not know InDesign types, so AString cannot be constructed from <a class="el" href="class_p_m_string.html">PMString</a> directly.<p><b>APathComponent class</b><p>APathComponent is a container class used to hold the name of a single component of a path. A path component can be a volume name, directory name, or filename. APathComponent has methods for getting and setting the base, extension, or full name of an APathComponent object as an AString.<p><b>APath class</b><p>APath is a container class used to hold an absolute or relative path. The individual path elements are stored in a vector of APathComponent objects. Storing the path in a vector allows for quick retrieval, manipulation, and iteration of the path components. APath does not require that the contained path exist on the file system. It has methods for getting path information, setting and changing the path, and begin(), end(), rbegin(), and rend() methods for use with its iterator class APathIterator and APathReverseIterator.<p><b>APathIterator class</b><p>The APathIterator random access iterator class provides the ability to iterate over the path components contained in an APath object. The class mimics the function provided by STL random access iterators.<p><b>APathReverseIterator class</b><p>The APathReverseIterator random access reverse iterator class provides the ability to iterate over the path components contained in an APath object in reverse order. The class mimics the function provided by STL random access reverse iterators.<p><b>AFile class</b><p>The AFile class is used to create and delete files and directories, and to get and set file and directory status and access properties. A file or directory referred to by the class does not need to exist. Methods that require the existence of a file or directory are ignored and fail appropriately when the file does not exist.<p><b>CorePathUtils class</b><p>CorePathUtils is a utility class that provides additional path function beyond the scope of APathComponent and APath. CorePathUtils includes methods for converting UTF-8 to and from an APathComponent object, getting and setting current working directory, and checking the path type of an APath object.<p><b>CoreFileUtils class</b><p>CoreFileUtils is a utility class that provides additional file and file system function. CoreFileUtils includes methods for creating temporary files, copying and moving a file, renaming a file, and testing whether a file is on a server.<p><b>MacFileUtils class</b><p>MacFileUtils is a utility class that provides additional file and file system functions specific to Mac OS. Methods are included for getting and setting VolumeRefNum, getting and setting the creator and type of a file, converting AFile to and from FSRef, SpecInfo, FSSpec, and CFURLRef.<p><b>WinFileUtils class</b><p>WinFileUtils is a utility class that provides additional file and file system functions specific to Windows. Methods are included for getting UNC path, local path, and POSIX path.<h3><a class="anchor" id="id_file_api_specific_to_indesign"></a> File API specific to InDesign</h3><p><b><a class="el" href="class_i_d_path.html">IDPath</a> class</b><p><a class="el" href="class_i_d_path.html">IDPath</a> is an InDesign class used to manipulate a file or directory specified by a path. <a class="el" href="class_i_d_path.html">IDPath</a> is a child of APath; therefore, it inherits all APath methods. <a class="el" href="class_i_d_path.html">IDPath</a> can be constructed from an APathComponent, an AString, or an InDesign <a class="el" href="class_wide_string.html">WideString</a> object.<p><b><a class="el" href="class_i_d_file.html">IDFile</a> class</b><p><a class="el" href="class_i_d_file.html">IDFile</a> is an InDesign class used to manipulate a file or directory. <a class="el" href="class_i_d_file.html">IDFile</a> is a child of AFile; therefore, it inherits all AFile methods. Like <a class="el" href="class_i_d_path.html">IDPath</a>, <a class="el" href="class_i_d_file.html">IDFile</a> can be constructed from an APath, AString, or InDesign <a class="el" href="class_wide_string.html">WideString</a>. In addition, <a class="el" href="class_i_d_file.html">IDFile</a> defines several methods specific to Windows and Mac OS.<p><b><a class="el" href="class_file_utils.html">FileUtils</a> class</b><p>The <a class="el" href="class_file_utils.html">FileUtils</a> class has been in existence since InDesign CS. The following table briefly describes some methods.<table class="doxtable"><tr><th>Method </th><th>Description </th></tr><tr><td>static FILE* OpenFile(const IDFile &amp; file, const char* mode) </td><td>Opens the file. This method uses FSpfopen, FSRefParentAndFilenamefopen, or FSReffopen to open the file, depending upon the current state of the file. </td></tr><tr><td>static OSErr FSSpecToIDFile(const FSSpec &amp; fsSpec, IDFile &amp; file) </td><td>Converts an FSSpec to an <a class="el" href="class_i_d_file.html">IDFile</a> object. </td></tr><tr><td>static OSErr SpecInfoToIDFile(FSVolumeRefNum vRefNum, uint32 parId, const PMString &amp; name, IDFile &amp; file) </td><td>Converts Mac OS file system specification information to an <a class="el" href="class_i_d_file.html">IDFile</a> object. </td></tr><tr><td>static OSErr IDFileToFSSpec(const <a class="el" href="class_i_d_file.html">IDFile</a> &amp; file, FSSpec &amp; fsSpec, PMString* unicodeName = nil, bool16 bCreateLong = kFalse) </td><td>Converts an <a class="el" href="class_i_d_file.html">IDFile</a> object to an FSSpec. </td></tr><tr><td>static OSErr UnicodeNameToHFSName(const <a class="el" href="class_p_m_string.html">PMString</a> &amp; unicodeName, <a class="el" href="class_p_m_string.html">PMString</a> &amp; hfsName, TextEncoding textEncodingHint = kTextEncodingUnknown); </td><td>Converts a Unicode name to an HFS Pascal name. </td></tr><tr><td>static OSErr HFSNameToUnicodeName(const <a class="el" href="class_p_m_string.html">PMString</a> &amp; hfsName, <a class="el" href="class_p_m_string.html">PMString</a> &amp; unicodeName, TextEncoding textEncodingHint = kTextEncodingUnknown) </td><td>Converts an HFS Pascal name to a Unicode name. </td></tr></table><p><b><a class="el" href="class_s_d_k_file_helper.html">SDKFileHelper</a></b><p><a class="el" href="class_s_d_k_file_helper.html">SDKFileHelper</a> is not part of Adobe file library. This class is listed here because it is used as a utility class in SDK sample code and, presumably, it is used commonly in code written by third-party plug-in developers.<h3><a class="anchor" id="id_debugging_idfile"></a> Debugging IDFile</h3><p>To help you debug your code containing <a class="el" href="class_i_d_file.html">IDFile</a> objects, the <a class="el" href="class_i_d_file.html">IDFile</a> class has a debug-only data member, fDebugPath, that always contains the current path. The path contained by fDebugPath matches the path contained by the AFile implementation class, but it is much easier to get from the debugger.<p>On Windows, fDebugPath is defined as a wchar_t string that contains a UTF-16 UNC or mapped drive path. On Mac OS, fDebugPath is defined as a character string that contains a UTF-8 POSIX path. On both platforms, if the current path is empty, fDebugPath is null.<dl class="section note"><dt>Note<dd>On Windows, do not use the fTmpPathStr data member contained by <a class="el" href="class_i_d_file.html">IDFile</a> objects to obtain the current path. The fTmpPathStr member is a temporary path string used as a buffer to return the path as a <a class="el" href="class_p_m_string.html">PMString</a>, CString, ConstCString, TCHAR buffer, WString, or UTF16TextChar. The path contained by fTmpPathStr is neither guaranteed nor expected to always match the <a class="el" href="class_i_d_file.html">IDFile</a> object&#39;s current path.</dl><h2><a class="anchor" id="id_frequently_asked_questions"></a> Frequently asked questions</h2><h3><a class="anchor" id="id_why_should_i_use_adobe_file_library"></a> Why should I use Adobe file library?</h3><p>Adobe file library provides unified file-manipulation methods, so you do not need to write platform-specific code for Windows and Mac OS, or even UNIX.<p>Adobe file library provides classes and utilities that meet most file-manipulation needs, so your code will be shorter, more robust, and easier to maintain.<p>Adobe file library will evolve with the operating systems, so your code will be easier to port.<p>Most importantly, InDesign code uses Adobe file library. Future interfaces will continue to be based on Adobe file library.<p>We highly recommend using Adobe file library classes.<h3><a class="anchor" id="id_does_adobe_file_library_support_cross-platform_path_conversion"></a> Does Adobe file library support cross-platform path conversion?</h3><p>No.<p>However, Adobe file library directly supports POSIX paths on Mac OS. You can use <a class="el" href="class_file_utils.html#ade8d8700a108c873353c7c4d470bba8b">FileUtils::PMStringToSysFile</a> to create an <a class="el" href="class_i_d_file.html">IDFile</a> object from an HFS path (like Macintosh HD:macfolder:myfile) or Windows file path (like C:\Program Files\Adobe\InDesign)<h3><a class="anchor" id="id_should_i_still_use_the_icorefilename_interface"></a> Should I still use the ICoreFileName interface?</h3><p>Adobe file library does not replace ICoreFileName; however, we do not recommend using ICoreFileName unless you absolutely have to (for example, when dealing with data links). On Mac OS, the class still depends heavily on FSSpec and is not very efficient. Most of the function is provided more efficiently in Adobe file library classes like CoreFileUtils, CorePathUtils, MacFileUtils, WinFileUtils, AFile, and <a class="el" href="class_file_utils.html">FileUtils</a>.<h3><a class="anchor" id="id_how_do_i_navigate_between_idfile_and_idpath"></a> How do I navigate between IDFile and IDPath?</h3><p>You can round-trip between <a class="el" href="class_i_d_file.html">IDFile</a> and <a class="el" href="class_i_d_path.html">IDPath</a> as shown in the following sample code: <div class="fragment"><div class="line"><a class="code" href="class_i_d_file.html">IDFile</a> idFile (existingFile); <span class="comment">//assume existingFile already initialized</span></div><div class="line"><a class="code" href="class_i_d_path.html">IDPath</a> idPath = idFile.GetPath();</div><div class="line"><a class="code" href="class_i_d_file.html">IDFile</a> newFile(idPath);</div></div><h3><a class="anchor" id="id_what_are_the_differences_between_a_file_and_a_directory"></a> What are the differences between a file and a directory?</h3><p>There is no difference between a file and a directory in terms of how they are represented as <a class="el" href="class_i_d_file.html">IDFile</a> objects. The differences are at the operating-system level: A directory has other files or directories as its children, and a file does not.<h3><a class="anchor" id="id_what_are_the_relationships_between_idpath_and_idfile"></a> What are the relationships between IDPath and IDFile?</h3><p><a class="el" href="class_i_d_path.html">IDPath</a> and <a class="el" href="class_i_d_file.html">IDFile</a> objects can point to the same file or directory. They differ mainly in concepts: <a class="el" href="class_i_d_path.html">IDPath</a> has methods that apply to a file path, and <a class="el" href="class_i_d_file.html">IDFile</a> has methods that apply to file operations.<h3><a class="anchor" id="id_why_should_idfile_not_be_treated_as_pmstring"></a> Why should IDFile not be treated as PMString?</h3><p>They are different conceptually. <a class="el" href="class_p_m_string.html">PMString</a> represents a string, used primarily in the user interface. <a class="el" href="class_i_d_file.html">IDFile</a> deals primarily with file manipulation.<p>Also, not all <a class="el" href="class_i_d_file.html">IDFile</a> objects are represented by a <a class="el" href="class_p_m_string.html">PMString</a>, so treating an <a class="el" href="class_i_d_file.html">IDFile</a> as a string makes your code prone to errors. Mac OS has several ways to represent a file. Windows, UNIX, and file URLs also have different formats.<p><a class="el" href="class_i_d_file.html">IDFile</a> does not allow an invalid path, so you may encounter runtime errors or asserts if you assign a <a class="el" href="class_p_m_string.html">PMString</a> to an <a class="el" href="class_i_d_file.html">IDFile</a> with an invalid path. <a class="el" href="class_p_m_string.html">PMString</a> does not validate paths at run time.<h3><a class="anchor" id="id_how_do_an_invalid_path_and_a_nonexistent_path_differ"></a> How do an invalid path and a nonexistent path differ?</h3><p>An invalid path is a path with one or more invalid path components in its respective platform. For example, the wildcard *.* does not refer to a file, so any path containing *.* is an invalid path.<p>A nonexistent path is a path that points to a file that does not exist. <a class="el" href="class_i_d_file.html">IDFile</a> and <a class="el" href="class_i_d_path.html">IDPath</a> fully support nonexistent paths. You can create or delete a file using <a class="el" href="class_i_d_file.html">IDFile</a> methods.<h3><a class="anchor" id="id_can_i_construct_an_astring_from_pmstring"></a> Can I construct an AString from PMString?</h3><p>Yes and no.<p>You cannot construct an AString from a <a class="el" href="class_p_m_string.html">PMString</a>, because Adobe file library is not aware of the InDesign type <a class="el" href="class_p_m_string.html">PMString</a>. Since they both use UTF-16, however, you can construct an AString with the following code: <div class="fragment"><div class="line">String aString(pmString.GrabUTF16Buffer(nil));</div></div><h3><a class="anchor" id="id_how_can_i_convert_a_relative_path_to_an_absolute_path"></a> How can I convert a relative path to an absolute path?</h3><p>Use APath::MakeAbsolute.<p>Make sure you are converting paths on the same platform. You cannot convert a Windows relative path on Mac OS, or vice versa. Instead, you must manipulate the relative path as a <a class="el" href="class_p_m_string.html">PMString</a>, convert it to the platform-specific format, and then convert to an absolute path.<h1><a class="anchor" id="id_performance_tuning"></a> Performance Tuning</h1><p>The InDesign plug-in architecture and object model make it possible for software developers to add powerful features to InDesign; however, the architecture also allows developers to accidentally create very inefficient code.<p>This chapter describes how to optimize InDesign plug-ins for peak performance.<h2><a class="anchor" id="id_use_profiling_tools"></a> Use profiling tools</h2><p>Often, software developers believe they know the cause of a performance problem in their code, only to be surprised by the results of a profile of that code. There are several very good tools for identifying performance problems, and you always should use them before trying to optimize your code manually. This section describe some of these tools.<h3><a class="anchor" id="id_windows"></a> Windows</h3><p>There are several tools that can be used to profile your code and identify performance problems on Windows. For example, the InDesign engineering team has had success with GlowCode. GlowCode is a set of analysis tools to profile code and identify memory use problems. GlowCode instruments a user-selected list of plug-ins, allows the user to define a trigger function, and provides accurate timings and function call counts. For more information about GlowCode, including a trial version, see <a href="http://www.glowcode.com">http://www.glowcode.com </a>.<h3><a class="anchor" id="id_mac_os"></a> Mac OS</h3><p>Xcode comes bundled with various tools for performance and behavior analysis. This includes a tool called Instruments, which analyzes memory usage, among other things.<h2><a class="anchor" id="id_commands"></a> Commands</h2><p>Commands are responsible for encapsulating compound modifications to the object model, supporting the undo/redo protocol, and indicating to the object model when it should notify its state to observers. If not used properly, commands can seriously reduce performance.<h3><a class="anchor" id="id_commands_should_operate_on_lists_of_inputs"></a> Commands should operate on lists of inputs</h3><p>You can improve performance by reducing the number of commands processed, partly because undo information for each command must be stored on the command history, and partly because each command sends out a notification on completion. One good way to reduce the number of commands processed is to write commands such that each accepts a list of inputs.<p>For example, a MovePageItem command should either call GetItemList to obtain the command&#39;s list of inputs or include a separate data interface in the command&#39;s boss. This makes it possible to execute one command for an entire list of page items, instead of executing a separate command for each page item.<h3><a class="anchor" id="id_notify_on_the_document_subject_instead_of_the_page_item_object"></a> Notify on the document subject instead of the page item object</h3><p>Notifications can decrease performance because observers tend to do some work each time they are notified; therefore, it is desirable to find ways to reduce the total number of notifications. One way, as mentioned above, is to reduce the number of commands executed. Another, is to send one notification on the document subject instead of a separate notification for each page item. This approach requires observers to attach at the document level instead of at the page item level. See the following code: <div class="fragment"><div class="line"><span class="keywordtype">void</span> MyCommand::DoNotify(){</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_u_i_d_list.html">UIDList</a>* itemList = GetItemList();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDataBase&gt;</a> iDatabase(itemList-&gt;<a class="code" href="class_u_i_d_list.html#ad55cbff9dd30705377412d5e9f9ab8aa">GetDataBase</a>(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;PageItemUtils&gt;</a>() -&gt; NotifyDocumentObservers(iDatabase, kMyCmdBoss, IID_MYIID_IDOCUMENT, <span class="keyword">this</span>);</div><div class="line">}</div></div><h3><a class="anchor" id="id_mark_commands_that_do_not_require_undo_support"></a> Mark commands that do not require undo support</h3><p>Some commands do not require undo support. For example, a command to print a document is not undoable. In such cases, the constructor of the command should call SetUndoability(kUndoNotRequired).<h2><a class="anchor" id="id_observers"></a> Observers</h2><p>Observers can be attached to and detached from any subject, but be careful to attach observers only to subjects in which you are interested, since each attachment impairs performance. Performance is affected by the level of the subject to which the observer is attached.<h3><a class="anchor" id="id_attach_to_documents_not_page_items"></a> Attach to documents, not page items</h3><p>It is inefficient for an observer to attach and observe at the page-item level. Instead, observers should attach and observe at the document level.<h3><a class="anchor" id="id_do_work_only_when_the_command_is_done"></a> Do work only when the command is done</h3><p>Many commands notify several times. For example, when a page item moves, a prenotify and post-notify must occur, so the old and new locations can be invalidated on the screen. Often, an observer can ignore all but the last notification, as follows: <div class="fragment"><div class="line"><span class="keywordtype">void</span> MyObserver::Update(<span class="keyword">const</span> <a class="code" href="class_i_d_type.html">ClassID</a>&amp; theChange, <a class="code" href="class_i_subject.html">ISubject</a>* theSubject, <span class="keyword">const</span> <a class="code" href="class_i_d_type.html">PMIID</a>&amp; protocol, <span class="keywordtype">void</span>* changeBy){</div><div class="line"><span class="keywordflow">if</span> (protocol == IID_MYIID)</div><div class="line"> { </div><div class="line"><span class="keywordflow">if</span> (theChange == kMyCmdBoss)</div><div class="line"> { </div><div class="line"><a class="code" href="class_i_command.html">ICommand</a>* cmd = (<a class="code" href="class_i_command.html">ICommand</a>*) changeBy;</div><div class="line"><a class="code" href="class_i_command.html#a36b4bf920fdb480718932b3d28453f49">ICommand::CommandState</a> cmdState = cmd-&gt;<a class="code" href="class_i_command.html#a56b1786de7da26177ca0622b4ad1def6">GetCommandState</a>();</div><div class="line"><span class="keywordflow">if</span>(cmdState == <a class="code" href="class_i_command.html#a36b4bf920fdb480718932b3d28453f49a28003fa77f37cb085f2df252bacf0838">ICommand::kDone</a>)</div><div class="line"> {</div><div class="line"><span class="keyword">const</span> <a class="code" href="class_u_i_d_list.html">UIDList</a>* contentList = cmd-&gt;<a class="code" href="class_i_command.html#af77616b39cea19b0de97c3fc4844fe04">GetItemList</a>();</div><div class="line"><span class="comment">// do some work here</span></div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_do_not_update_the_user_interface_from_an_observer"></a> Do not update the user interface from an observer</h3><p>Many panels display information about the current selection, like graphic attributes, character attributes, or information about the selection&#39;s geometry. These panels must have an observer, and it is tempting to update the panel from the Update method of the observer; however, in general, updating a panel from an observer is a bad idea. Instead, it is much better to mark the data in the panel as dirty or invalid, generate a screen invalidation for the panel, then update the user interface in the Draw code for the panel.<h3><a class="anchor" id="id_watch_for_lazy_notification_whenever_possible"></a> Watch for lazy notification whenever possible</h3><p>The application supports two types of notification, regular and lazy. If an observer needs to be called as soon as a subject broadcasts the change message, it should request regular notification. If the observer can afford to wait until idle time before being notified of a change of interest, it can register for lazy notification.<p>Lazy notification is used when observers do not need to be in tight synchronization with changes being made to the subject objects they observe. Rather than participating in each change that occurs on a subject object, observers using lazy notification are notified after all updates are made and the application is idle.<h2><a class="anchor" id=""></a></h2><p>Each operation to access a local disk or server can greatly reduce performance. For this reason, it is very important to reduce the number of disk access operations as much as possible. For example, if you need to parse a file using many very small read operations, consider reading a large block into a memory buffer using one read operation, then operating on the buffer. This kind of optimization is very important when working over a network.<h2><a class="anchor" id="id_memory"></a> Memory</h2><h3><a class="anchor" id="id_use_memory_caches_for_items_accessed_often"></a> Use memory caches for items accessed often</h3><p>If a profile shows that your code is spending a lot of time recomputing the same value or repeatedly searching a list for the same element, consider caching the result or element. It is very important to use profiling tools to identify where caches are needed. Unnecessary caches can decrease performance, by forcing the software to keep the cache up to date even when it is not needed.<h3><a class="anchor" id="id_avoid_allocating_too_much_memory"></a> Avoid allocating too much memory</h3><p>Allocating memory beyond what is physically available causes InDesign to try to purge its caches and may cause a page fault in the operating system. Purging memory and page faults are very slow; avoid them when possible.<h2><a class="anchor" id="id_idle_tasks"></a> Idle tasks</h2><p>The InDesign object model is not thread-safe, so it does not use true threads; however, you can use cooperative threads, in the form of idle tasks (<a class="el" href="class_i_idle_task.html">IIdleTask</a>). Idle tasks are given a chance to execute when there are no events in the EventQueue for the application to process. Idle tasks are a great way to defer expensive operations and allow the user to continue using the application.<p>The remainder of this section presents guidelines that should be followed when implementing an idle task.<h3><a class="anchor" id="id_honor_the_runtask_flags"></a> Honor the RunTask flags</h3><p>Each idle task has a RunTask method, which is passed a set of flags. These flags can be very important to the application&#39;s performance. For example, normally you will not want an idle task to execute when the user is dragging a page item around the layout, and you may not want the idle task to execute when a dialog box is open, because it slows the application&#39;s responsiveness. So, a typical idle task starts with the following lines of code: <div class="fragment"><div class="line"><span class="keywordflow">if</span> (flags &amp; IIdleTaskMgr::kMouseTracking &acirc;&#148;&#130;&acirc;&#148;&#130; flags &amp; IIdleTaskMgr::kModelDialogUp) </div><div class="line"><span class="keywordflow">return</span> (kOnFlagChange);</div></div><h3><a class="anchor" id="id_do_a_small_amount_of_work_during_each_runtask_call"></a> Do a small amount of work during each RunTask call</h3><p>Idle tasks allow the software to perform computationally expensive operations when the user is idle. The goal is to make the application as responsive as possible, so the user does not have to wait for an expensive operation to complete. For this reason, you do not want one call to RunTask to take a long time. It is better for each call to RunTask to perform some work, then ask for RunTask to be called again. For example, your RunTask method may look like the following: <div class="fragment"><div class="line">uint32 MyIdleTask::RunTask(uint32 schedulerFlags, uint32 (*timeCheck)()){</div><div class="line"><span class="keywordflow">if</span> (InappropriateState(schedulerFlags))</div><div class="line"><span class="keywordflow">return</span> kOnFlagChange;</div><div class="line"> DoPeriodicThing();</div><div class="line"><span class="keywordflow">return</span> 1000; <span class="comment">// Call this task again in 1 second.</span></div><div class="line">}</div></div><h1><a class="anchor" id="id_performance_metrics_api"></a> Performance Metrics API</h1><p>A performance metric allows you to quantify the performance of your software. Adobe &reg; InDesign&reg; contains a scriptable performance-metrics API. This API allows you to add performance counters to your components, giving you the ability to monitor aspects of your code or of InDesign code.<p>Performance metrics are implemented as counters. These counters can track any numerical value associated with your software; for example, time spent in an algorithm, memory usage, and number of objects created.<p>Several metrics already are implemented within the InDesign architecture, and the API allows you to add metrics to your own plug-in. An important aspect of the performance-metrics API is that it exposes the counters to PerfMon on Windows &reg; and DTrace on Mac OS&reg;, allowing you to track your counters over time.<h2><a class="anchor" id="id_indesign_metrics"></a> InDesign metrics</h2><p>The performance-metrics API contains many built-in counters. These counters track information about CPU time, number of threads, memory size, handle count, memory-purge count, PDF allocations, image cache, database file, drop shadow, snapshot, composition, draw manager, and so on.<p>These counters are available through scripting; therefore, you can find a complete list of the built-in counters by using the Object Model Viewer in the ExtendScript Toolkit, as described in Accessing metrics from scripting.<p>The performance-metrics architecture is an application startup/shutdown service (<a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a>) consisting of a metrics service provider, script provider, idle task, and performance-counters implementation.<h2><a class="anchor" id="id_adding_a_metric"></a> Adding a metric</h2><p>First, determine what performance data to expose for your plug-in. Then, find where that data is updated; this is, where you will update your performance counter. Your counter can represent any numeric data, as long as it fits in a uint64.<h3><a class="anchor" id="id_performance-metric_service_provider"></a> Performance-metric service provider</h3><p>Start with implementing a performance-metric service provider. Edit your Class resource to define your service provider, as in this example from the hyphenator sample: <div class="fragment"><div class="line">Class{</div><div class="line"><a class="code" href="classk_hyp_service_provider_boss.html">kHypServiceProviderBoss</a>,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IK2SERVICEPROVIDER, kPerformanceMetricProviderImpl,</div><div class="line"> IID_IPERFORMANCEMETRIC, kHypPerformanceMetricImpl,</div><div class="line"> }</div><div class="line">},</div></div><p>Next, create IDs for your counters in your ID.h file: <div class="fragment"><div class="line">DECLARE_PMID(kPerformanceMetricIDSpace, kHypMetricMaxID, kHypPrefix + 1)</div><div class="line">DECLARE_PMID(kPerformanceMetricIDSpace, kHypMetricTotalID, kHypPrefix + 2)</div></div><p>Then, implement your performance metric (<a class="el" href="class_i_performance_metric.html">IPerformanceMetric</a>). The first step is to define your counters. To keep the new counters independent of the object model, add a C++ class <a class="el" href="class_hyp_performance_data.html">HypPerformanceData</a> and define static data members in it: <div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="class_hyp_performance_data.html">HypPerformanceData</a>{</div><div class="line"> ...</div><div class="line">private:</div><div class="line"><span class="keyword">static</span> boost::mutex fMutex;</div><div class="line"><span class="keyword">static</span> uint64 fHypMax;</div><div class="line"><span class="keyword">static</span> uint64 fHypTotal;</div><div class="line">};</div></div><p>fHypMax and fHypTotal are for keeping the performance counters; fMutex is for synchronization.<p>In GetMetricInfo(), add your metrics to the global list of metrics by appending your metric IDs to the PerformanceMetricIDList argument: <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="class_hyp_performance_metric.html#a9a4d3d55b7eea672854a67575b5eee50">HypPerformanceMetric::GetMetricInfo</a>(PerformanceMetricIDList &amp;metricIDs){</div><div class="line"> metricIDs.push_back(kHypMetricMaxID);</div><div class="line"> metricIDs.push_back(kHypMetricTotalID);</div><div class="line">}</div></div><p>Return your metric&#39;s short name in GetMetricShortName(). The string you return defines the accessor for your metric in both PerfMon and DTrace. <div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> <a class="code" href="class_hyp_performance_metric.html#ab4d8fb8e167c7354e1f3552e9fa4b81f">HypPerformanceMetric::GetMetricShortName</a>(<a class="code" href="class_i_d_type.html">PerformanceMetricID</a> metricID){</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> returnValue(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><span class="keywordflow">switch</span> (metricID.Get()) {</div><div class="line"><span class="keywordflow">case</span> kHypMetricMaxID: </div><div class="line"> returnValue = <a class="code" href="class_p_m_string.html">PMString</a>(<span class="stringliteral">&quot;Hyphenation Max&quot;</span>);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kHypMetricTotalID: </div><div class="line"> returnValue = <a class="code" href="class_p_m_string.html">PMString</a>(<span class="stringliteral">&quot;Hyphenation Total&quot;</span>);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> returnValue;</div><div class="line">}</div></div><p>Return your metric&#39;s description in GetMetricLongName(). <div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> <a class="code" href="class_hyp_performance_metric.html#a3f0837063fb48be20313c9dfea1c8fc8">HypPerformanceMetric::GetMetricLongName</a>(<a class="code" href="class_i_d_type.html">PerformanceMetricID</a> metricID){</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> returnValue(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><span class="keywordflow">switch</span> (metricID.Get()) {</div><div class="line"><span class="keywordflow">case</span> kHypMetricMaxID: </div><div class="line"> returnValue = <a class="code" href="class_p_m_string.html">PMString</a>(<span class="stringliteral">&quot;The maximum number of hyphenations in any word&quot;</span>);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kHypMetricTotalID: </div><div class="line"> returnValue = <a class="code" href="class_p_m_string.html">PMString</a>(<span class="stringliteral">&quot;The total number of hyphenation calls&quot;</span>);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> returnValue;</div><div class="line">}</div></div><p>If you are allocating memory or have other clean-up to do, add that code in DeRegisterMetric().<p>In GetMetricValue(), return the value of your global counter. The return value must be a uint64 value. If the data you are tracking is a floating or real value (<a class="el" href="class_p_m_real.html">PMReal</a>), you need to convert the value accordingly. <div class="fragment"><div class="line">uint64 <a class="code" href="class_hyp_performance_metric.html#a0d3e1bdd22c77881fdb7ed95ae17a577">HypPerformanceMetric::GetMetricValue</a>(<a class="code" href="class_i_d_type.html">PerformanceMetricID</a> metricID){</div><div class="line"> uint64 returnValue = 0;</div><div class="line"><span class="keywordflow">switch</span> (metricID.Get()) {</div><div class="line"><span class="keywordflow">case</span> kHypMetricMaxID: </div><div class="line"> returnValue = <a class="code" href="class_hyp_performance_data.html#a346501eaead485f2e0bc9d316c32efc7">HypPerformanceData::GetHypMax</a>();;</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kHypMetricTotalID: </div><div class="line"> returnValue = <a class="code" href="class_hyp_performance_data.html#a7ece5a4a862015b701753d6f45b7188d">HypPerformanceData::GetHypTotal</a>();</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> returnValue; </div><div class="line">}</div></div><p>Reset your global counters back to their initial values in ResetMetric(): <div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="class_hyp_performance_metric.html#a2d60a0639f42a88092f9051077c18493">HypPerformanceMetric::ResetMetric</a>(<a class="code" href="class_i_d_type.html">PerformanceMetricID</a> metricID) {</div><div class="line"><span class="keywordflow">switch</span> (metricID.Get()) {</div><div class="line"><span class="keywordflow">case</span> kHypMetricMaxID: </div><div class="line"><a class="code" href="class_hyp_performance_data.html#a00e9811876e597d287e95bb915735c87">HypPerformanceData::SetHypMax</a>(0);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> kHypMetricTotalID: </div><div class="line"><a class="code" href="class_hyp_performance_data.html#a2636a71299f5216db5123a5fb891da59">HypPerformanceData::SetHypTotal</a>(0);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_performance-metric_script_provider"></a> Performance-metric script provider</h3><p>Performance metrics are accessed in scripting by their registered metric ID. You register these IDs in your service provider&#39;s GetMetricInfo() method. To make this ID accessible from scripting, you need to implement a simple script provider.<p>First, edit your Class resource in your .fr file: <div class="fragment"><div class="line">Class{</div><div class="line"><a class="code" href="classk_hyp_script_provider_boss.html">kHypScriptProviderBoss</a>, <a class="code" href="classk_base_script_provider_boss.html">kBaseScriptProviderBoss</a>,</div><div class="line"> {</div><div class="line"> IID_ISCRIPTPROVIDER, kHypScriptProviderImpl,</div><div class="line"> }</div><div class="line">},</div></div><p>Also, define one scripting property for each counter, and a provider element: <div class="fragment"><div class="line">resource VersionedScriptElementInfo (1){ </div><div class="line"><span class="comment">//Contexts </span></div><div class="line"> {</div><div class="line"> kBasilScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, kWildFS, k_Wild, </div><div class="line"> }</div><div class="line"><span class="comment">//Elements </span></div><div class="line"> {</div><div class="line"> Property</div><div class="line"> {</div><div class="line"> kHypMaxPropertyScriptElement,</div><div class="line"> p_HypMax,</div><div class="line"><span class="stringliteral">&quot;hyphenation max&quot;</span>,</div><div class="line"><span class="stringliteral">&quot;The maximum number of hyphenations in any word&quot;</span>,</div><div class="line"> Int32Type,</div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line"> }</div><div class="line"> Property</div><div class="line"> {</div><div class="line"> kHypTotalPropertyScriptElement,</div><div class="line"> p_HypTotal, </div><div class="line"><span class="stringliteral">&quot;hyphenation total&quot;</span>, </div><div class="line"><span class="stringliteral">&quot;The total number of hyphenation calls&quot;</span>,</div><div class="line"> Int32Type,</div><div class="line"> {}</div><div class="line"> kNoAttributeClass,</div><div class="line"> }</div><div class="line"> Provider</div><div class="line"> {</div><div class="line"><a class="code" href="classk_hyp_script_provider_boss.html">kHypScriptProviderBoss</a></div><div class="line"> {</div><div class="line"> Object{ kApplicationObjectScriptElement },</div><div class="line"> Property{ kHypMaxPropertyScriptElement, kReadOnly },</div><div class="line"> Property{ kHypTotalPropertyScriptElement, kReadOnly },</div><div class="line"> }</div><div class="line"> }</div><div class="line"> }</div><div class="line">}</div></div><p>Next, define your scripting identifiers in your ID.h file: <div class="fragment"><div class="line">DECLARE_PMID(kScriptInfoIDSpace, kHypMaxPropertyScriptElement, kHypPrefix + 1)</div><div class="line">DECLARE_PMID(kScriptInfoIDSpace, kHypTotalPropertyScriptElement, kHypPrefix + 2)</div><div class="line"><span class="comment">// scripting defs</span></div><div class="line">enum HypScriptIDs{p_HypMax = <span class="stringliteral">&#39;hpmx&#39;</span>,p_HypTotal = <span class="stringliteral">&#39;hptt&#39;</span>,};</div></div><p>Then, implement your scripting provider: <div class="fragment"><div class="line">ErrorCode HypScriptProvider::HandleEvent(<a class="code" href="class_i_d_type.html">ScriptID</a> eventID, IScriptEventData* data, <a class="code" href="class_i_script.html">IScript</a>* parent){</div><div class="line"><span class="keywordflow">return</span> CScriptProvider::HandleEvent(eventID, data, parent);</div><div class="line">}</div><div class="line">ErrorCode <a class="code" href="class_hyp_script_provider.html#a06287ec2fd319784e6dd2da4595b7ab1">HypScriptProvider::AccessProperty</a>(<a class="code" href="class_i_d_type.html">ScriptID</a> propID, IScriptEventData* data, <a class="code" href="class_i_script.html">IScript</a>* parent){</div><div class="line"> ErrorCode status = kFailure;</div><div class="line"><span class="keywordflow">switch</span> (propID.Get())</div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> p_HypMax:</div><div class="line"><span class="keywordflow">case</span> p_HypTotal:</div><div class="line"> status = GetHyphPerformanceConstant(propID, data, parent);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">default</span>:</div><div class="line"> status = <a class="code" href="class_c_script_provider.html#a7061d5c5aa55e128bb77b4bf6b85abff">CScriptProvider::AccessProperty</a>(propID, data, parent);</div><div class="line"><span class="keywordflow">break</span>; </div><div class="line"> } <span class="keywordflow">return</span> status;</div><div class="line">}</div><div class="line">ErrorCode HypScriptProvider::GetHyphPerformanceConstant(<a class="code" href="class_i_d_type.html">ScriptID</a> propID, IScriptEventData* data, <a class="code" href="class_i_script.html">IScript</a>* parent){</div><div class="line"> ErrorCode result = kSuccess;</div><div class="line"><span class="keywordflow">if</span> (data &amp;&amp; data-&gt;IsPropertyGet()) {</div><div class="line"><a class="code" href="class_script_data.html">ScriptData</a> scriptData;</div><div class="line"><span class="keywordflow">switch</span> (propID.Get()) </div><div class="line"> {</div><div class="line"><span class="keywordflow">case</span> p_HypMax:</div><div class="line"> scriptData.SetInt32(kHypMetricMaxID);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"><span class="keywordflow">case</span> p_HypTotal:</div><div class="line"> scriptData.SetInt32(kHypMetricTotalID);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line"> data-&gt;AppendReturnData( parent, propID, scriptData );</div><div class="line"> }</div><div class="line"><span class="keywordflow">return</span> result;</div><div class="line">}</div></div><h2><a class="anchor" id="id_accessing_metrics_from_scripting"></a> Accessing metrics from scripting</h2><p>The InDesign scripting DOM contains several accessors for the built-in performance metrics. You can learn more about the metrics implemented in the DOM by using the Object Model viewer in ExtendScript Toolkit.<ol type="1"><li>Run ExtendScript Toolkit.<li>Choose Help &gt; Object Model Viewer.<li>From the Browser menu, choose Adobe InDesign Server Object Model.<li>From the Classes menu, choose PerformanceMetric.<li>To view the implemented metrics types and descriptions, choose items in the Properties and Methods drop-down list.</ol><h3><a class="anchor" id="id_indesign_built-in_metrics"></a> InDesign built-in metrics</h3><p>You can use InDesign&#39;s built-in metrics to track what is going on in InDesign. Here is an example that calculates the CPU time required to create and close 50 documents: <div class="fragment"><div class="line">var startTime = app.performanceMetric(PerformanceMetricOptions.CPU_TIME);</div><div class="line"><span class="keywordflow">for</span> (var i = 0; i &lt; 50; i++){</div><div class="line"> var myDoc = app.documents.add();</div><div class="line"> myDoc.close();</div><div class="line">}</div><div class="line">var endTime = app.performanceMetric(PerformanceMetricOptions.CPU_TIME);</div><div class="line">var message = <span class="stringliteral">&quot;CPU time: &quot;</span> + (endTime - startTime);</div><div class="line"><span class="keywordflow">if</span>(app.name == <span class="stringliteral">&quot;Adobe InDesign Server&quot;</span>)</div><div class="line"> app.consoleout(message);</div><div class="line"><span class="keywordflow">else</span></div><div class="line"> alert(message);</div></div><h3><a class="anchor" id="id_user-defined_metrics"></a> User-defined metrics</h3><p>If you created a performance script provider for your plug-in, you can access your counter from scripting using the appropriate property: <div class="fragment"><div class="line">var hypMax = app.performanceMetric(app.hyphenationMax);</div><div class="line">var hypMaxShortName = app.performanceMetricShortName(app.hyphenationTotal);</div><div class="line">var hypMaxLongName = app.performanceMetricLongName(app.hyphenationTotal);</div></div><p>If you did not create a script provider, you can still access your counter by running through the entire list of counters and locating yours. The following code compares to the short name value, but you also could compare to the ID or long name. The name values are defined by your service provider&#39;s GetShortName and GetLongName methods: <div class="fragment"><div class="line">var metricList = app.performanceMetrics;var nMetrics = metricList.length;</div><div class="line"><span class="keywordflow">for</span> (var i = 0; i &lt; nMetrics; i++) {</div><div class="line"> var myMetricID = metricList[i];</div><div class="line"> var myMetricShortName = app.performanceMetricShortName(myMetricID);</div><div class="line"><span class="keywordflow">if</span> (myMetricShortName == <span class="stringliteral">&quot;Hyphenation Max&quot;</span>) {</div><div class="line"> var myMetricValue = app.performanceMetric(myMetricID);</div><div class="line"> var myMetricLongName = app.performanceMetricLongName(myMetricID);</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_memory_tracker"></a> Memory tracker</h3><p>If you have access to the Debug install of InDesign or InDesign Server, you will have installed a special memory-tracker version of PMRuntime. This version of PMRuntime contains memory-tracking metrics not available to the regular installed version. Look in your debug installation&#39;s MemoryTracker folder for the DLL file (dylib).<p><b>Memory-growth example</b><p>By using the memory tracker PMRuntime, you can determine where memory is being allocated by using the performanceMetric scripting calls. Here is a sample script you could use to find InDesign memory-growth problems: <div class="fragment"><div class="line"><span class="comment">//... execute a test a few dozen times ...</span></div><div class="line">gStartMarker = app.performanceMetric(PerformanceMetricOptions.currentMemoryMark);</div><div class="line"><span class="comment">//... execute the test a few dozen more times ...</span></div><div class="line">gEndMarker = app.performanceMetric(PerformanceMetricOptions.currentMemoryMark);</div><div class="line"><span class="comment">//... execute the test a few dozen more times ...</span></div><div class="line">app.dumpBetweenMemoryMarks(gStartMarker, gEndMarker);</div></div><p>The purpose of the first set of test executions is to build up caches and allow the system to load any code that needs to be loaded. The third set allows any delayed memory deallocation to occur. The dumpBetweenMemoryMarks call creates a file named Memory Usage Dump.txt that is similar to a leaks file, with any allocations made between the currentMemoryMark calls that are still active.<p>Usually, a real memory-growth problem shows up in the output file as a repeated call stack (for example, if you run the test 20 times, there are 20 identical call stacks). Stack crawls that appear only once or twice generally are not a real problem but are caches being built up. Obviously, this list contains only those memory allocations that go through InDesign&#39;s memory allocator.<h2><a class="anchor" id="id_accessing_metrics_in_perfmon"></a> Accessing metrics in perfmon</h2><p>All counters with the performance-monitoring code are made available to the Windows perfmon system tool through a helper application named PerformanceMonitor.exe. This application is run when InDesign Server is started up. It adds the InDesign performance counters to perfmon. To see the InDesign counters from within PerfMon:<ol type="1"><li>Shut down InDesign Server.<li>From your InDesign Server folder (C:\Program Files\Adobe\Adobe InDesign CC 2014 Server), copy PerformanceMonitor.exe from the performancemonitor subfolder to the InDesign Server folder.<li>Start InDesign Server.<li>Start perfmon: choose Start &gt; Run, enter perfmon.exe, and click OK.<li>Right-click in the graph area and choose &quot;Add Counters.&quot;<li>In the dialog that appears, select InDesign from the Performance Object menu.<li>In the counters list, choose the counters that are of interest and click Add, or choose &quot;All counters.&quot; You must have InDesign Server running, or the Add button is disabled.<li>Choose a specific instance of InDesign Server (listed as &quot;indesign&quot;) or &quot;All Instances.&quot; The dialog should look like this: <div class="image"><img alt="plugin-programming-guide-vol2-83.gif" src="plugin-programming-guide-vol2-83.gif" /></div></ol><p>After you chose counters and dismiss the Add Counters dialog, the graph updates with InDesign&#39;s data: <div class="image"><img alt="plugin-programming-guide-vol2-84.gif" src="plugin-programming-guide-vol2-84.gif" /></div><h2><a class="anchor" id="id_accessing_metrics_in_dtrace"></a> Accessing metrics in DTrace</h2><p>On OS X 10.5, InDesign&#39;s performance counters can be accessed from DTrace. DTrace is a command-line tool with its own scripting language, D. To examine an InDesign performance metric in DTrace, you first write a D script, then run that script using DTrace.<p>This sample script echoes all InDesign performance counters to the console: <div class="fragment"><div class="line">indesign$1:DTraceSupport.dylib:UpdatePerformanceCounter:{</div><div class="line"> printf(<span class="stringliteral">&quot;counter: %s&quot;</span>, stringof(copyinstr(arg0)));</div><div class="line"> printf(<span class="stringliteral">&quot;\tvalue(hi):%d&quot;</span>, arg1);</div><div class="line"> printf(<span class="stringliteral">&quot;\tvalue(low)%d&quot;</span>, arg2);}</div></div><p>If this script is saved to a file named test.d, it can be invoked using the following command line. Replace 15534 with the correct process ID for your running instance of InDesign or InDesign Server. (You can use Activity Monitor to find the process ID.) <div class="fragment"><div class="line">sudo dtrace -p 15534 -s test.d 15534</div></div><p>We use the required sudo command to run DTrace as superuser. This command line executes the test.d script, which outputs information for every InDesign performance counter. The script runs continuously, ouputting the data every time the InDesign performance counters are updated (currently once per second).<p>If you are interested in a particular counter, for example, &quot;DB new UID count,&quot; you can narrow the scope of the probe with a conditional: <div class="fragment"><div class="line">indesign$1:DTraceSupport.dylib:UpdatePerformanceCounter:/copyinstr(arg0) == <span class="stringliteral">&quot;DB new UID count&quot;</span>/{ </div><div class="line"> printf(<span class="stringliteral">&quot;counter: %s&quot;</span>, stringof(copyinstr(arg0))); </div><div class="line"> printf(<span class="stringliteral">&quot;\tvalue(hi):%d&quot;</span>, arg1); </div><div class="line"> printf(<span class="stringliteral">&quot;\tvalue(low)%d&quot;</span>, arg2);</div><div class="line">}</div></div><p>This script executes the printf code only if arg0 (the name of the counter) matches the specified constant string. This script writes out one line for the &quot;DB new UID count&quot; once per second. If you have added your own metric to InDesign, you can use your metric&#39;s short name to compare to arg0.<p>For more information on DTrace, read its manual page using the command &quot;man dtrace&quot;, or go to <a href="http://hub.opensolaris.org/bin/view/Community+Group+dtrace/">http://hub.opensolaris.org/bin/view/Community+Group+dtrace/ </a>.<h2><a class="anchor" id="id_accessing_metrics_in_instruments"></a> Accessing metrics in Instruments</h2><p>On OS X 10.5, Apple&#39;s Developer tool, Instruments (formerly Xray), supports DTrace. You can view InDesign metrics using instruments, giving you an experience like that of PerfMon on Windows.<p>To set up a custom instrument to track all InDesign metrics:<ol type="1"><li>Start InDesign or InDesign Server, then note the process ID by finding the instance in Activity Monitor (/Applications/Utilities).<li>Open Instruments (/Developer/Applications).<li>In the Choose template dialog, choose Blank for Mac OS X, and click Choose.<li>From the Instrument menu, choose Build new instrument.<li>Enter a name and description for your instrument. Leave Category as &quot;Custom Instruments.&quot;<li>Enter a name for your probe.<li>Set the probe type to custom.<li>Set Provider to indesignXXXXX, replacing XXXXX with your process ID.<li>Set Module to DTraceSupport.dylib.<li>Set Function to UpdatePerformanceCounter.<li>Leave Name empty.<li>Set up the values that you want to track in the &quot;Record the following data&quot; section:<ul><li>Choose &quot;arg0&quot; (represents the metric&#39;s name) from the drop-down list, enter a label for the output, and choose String for the data type.<li>Choose &quot;arg1&quot; (represents the metric&#39;s high 32-bits of its value) from the drop-down list, enter a label for the output, and choose Integer for the data type.<li>Choose &quot;arg2&quot; (represents the metric&#39;s low 32-bits of its value) from the drop-down list, enter a label for the output, and choose Integer for the data type.</ul><li>Click Save Copy. <div class="image"><img alt="plugin-programming-guide-vol2-85.gif" src="plugin-programming-guide-vol2-85.gif" /></div></ol><p>To create a custom instrument that tracks individual InDesign metrics, perform the steps above, except also create a predicate to narrow the probe. First, open the Instrument you created above by double-clicking it. Then, to add a predicate:<ol type="1"><li>Click the + sign to the right of your probe.<li>Choose Custom from the leftmost menu.<li>Set Expression to copyinstr(arg0).<li>Choose the == comparison.<li>Set Value to the short name of the metric you want to monitor.<li>To add multiple expressions, click the + sign to the right of your expression and choose the appropriate boolean expression. <div class="image"><img alt="plugin-programming-guide-vol2-86.gif" src="plugin-programming-guide-vol2-86.gif" /></div></ol><p>After you have set up your Instrument, you can begin a Record session and watch live data output to the Instruments user interface. Start by choosing Attach to Process &gt; (PID) InDesign from the Launch Executable menu. Make sure to choose the instance that has the same PID that you used in your instrument. Next, click Record, and you should see output like the following: <div class="image"><img alt="plugin-programming-guide-vol2-87.gif" src="plugin-programming-guide-vol2-87.gif" /></div><h1><a class="anchor" id="id_diagnostics"></a> Diagnostics</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>This chapter describes how you can use the diagnostics plug-in when developing plug-ins for InDesign, InCopy, and InDesign Server. The Diagnostics plug-in provides a detailed look at the internal operations of command processing; the organization of document content inside spreads, layers and page items; INX DTD generation; and object model IDs and UIDs. Note, the newer IDML file format supports schema generation and validation. For information on IDML and RelaxNG schema validation see Adobe InDesign Markup Language (IDML) Cookbook.<p>The diagnostics plug-in can help you find answers to questions like the following:<ul><li>Which commands is the application using to manipulate content?<li>What is exposed in the scripting Document Object Model (DOM)?<li>What types of page items are used to store content?<li>How are page items organized inside spreads and layers?<li>What is the symbolic name (for example, <a class="el" href="classk_session_boss.html">kSessionBoss</a>) that corresponds to a numeric object model ID (for example, 0x101)?<li>What type of boss class does a given UID refer to?</ul><h2><a class="anchor" id="id_using_the_diagnostics_plug-in"></a> Using the diagnostics plug-in</h2><p>The diagnostics plug-ins (Diagnostics.apln and DiagnosticsUI.apln) are found on:<ul><li>Windows in &lt;SDK&gt;\build\win\debug\testing<li>Mac OS in &lt;SDK&gt;/build/mac/debug/packagefolder/contents/macos/testing</ul><p>This chapter describes the use of the Diagnostics plug-in through the application user interface and scripting.<p>To use the plug-in with the debug build of InDesign or InCopy, select one of the Test &gt; Diagnostics menu items. To use the plug-in with the release build of InDesign or InCopy or with InDesign Server, you must use a script. See Diagnostics &gt; Scripting DOM menu.<p>You can use the diagnostics plug-in to generate traces, which provide an equivalent of printf debug messages to a log. You can filter messages by category. To see the trace, use the Test &gt; TRACE menu to enable the logs you want use. If you do not see any traces when you use the plug-in&#39;s menus, make sure the Diagnostics category is checked on the Test &gt; TRACE menu. Unchecking these categories filters the trace produced by the plug-in. If you do not see a Test &gt; TRACE &gt; Diagnostics menu, select Test &gt; Diagnostics &gt; ObjectModel &gt; TraceID. Some trace output must be written before the Test &gt; TRACE menu shows the category.<h3><a class="anchor" id="id_diagnostics_menu"></a> Diagnostics menu</h3><p>Plug-in options are not persistent; that is, settings you make to control the level of reporting must be applied for each session.<h3><a class="anchor" id="id_diagnostics_command_menu"></a> Diagnostics &gt; Command menu</h3><p>This menu contains items to trace one or more commands: <div class="image"><img alt="diag-command.gif" src="diag-command.gif" /></div><p>The three commands in the menu are described below.<ul><li>Trace All Commands - This traces all commands being processed by the application. Use this to discover the command being used to manipulate content in response to a user action. For example, this trace is created in response to grouping a set of page items: <div class="fragment"><div class="line"><a class="code" href="classk_move_reference_point_cmd_boss.html">kMoveReferencePointCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_set_default_ref_point_position_cmd_boss.html">kSetDefaultRefPointPositionCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_set_attribute_target_command_boss.html">kSetAttributeTargetCommandBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_group_cmd_boss.html">kGroupCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_apply_object_style_cmd_boss.html">kApplyObjectStyleCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_b_p_i_set_data_cmd_boss.html">kBPISetDataCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_move_reference_point_cmd_boss.html">kMoveReferencePointCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_set_default_ref_point_position_cmd_boss.html">kSetDefaultRefPointPositionCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_set_attribute_target_command_boss.html">kSetAttributeTargetCommandBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_check_export_settings_cmd_boss.html">kCheckExportSettingsCmdBoss</a> Diagnostics::ScheduleCommand()</div><div class="line"><a class="code" href="classk_check_color_settings_cmd_boss.html">kCheckColorSettingsCmdBoss</a> Diagnostics::ScheduleCommand()</div><div class="line"><a class="code" href="classk_check_export_settings_cmd_boss.html">kCheckExportSettingsCmdBoss</a> Diagnostics::ProcessCommand()</div><div class="line"><a class="code" href="classk_check_color_settings_cmd_boss.html">kCheckColorSettingsCmdBoss</a> Diagnostics::ProcessCommand()</div></div><li>Trace All Commands Options - Several options are available to control the detail of the information reported by Trace All Commands:<li>Data Interfaces - Turn this on to trace the data interfaces (for example, IID_BOOLDATA) aggregated by each command for parameter passing.<li>ItemList UIDs - Turn this on to trace the UIDs of objects in each command&#39;s item list.<li>ItemList ClassIDs - Turn this on to trace the ClassID values of objects in each command&#39;s item list. Use this to find the type of object (for example, <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a>) a command manipulates.<li>Dynamic Commands - Turn this on to trace dynamic command processing (for example, the commands processed by a tracker when a page item is moved using the mouse).<li>Trace Single <a class="el" href="class_command.html">Command</a> - Once you know the command of interest (for example, <a class="el" href="classk_group_cmd_boss.html">kGroupCmdBoss</a>), you can use Trace Single <a class="el" href="class_command.html">Command</a> to examine its processing in more detail. Use this when you know the ClassID of the command about which you want to know more. The trace is indented to show the commands used by the command of interest. For example: <div class="fragment"><div class="line">Begin cmd no. 0 <span class="stringliteral">&#39;kGroupCmdBoss&#39;</span> (<span class="keyword">class </span>id 0x405)</div><div class="line"> Begin cmd no. 1 &#39;<a class="code" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a>&#39; (class id 0x2c01)</div><div class="line"> ## Begin Sequence</div><div class="line"> Begin cmd no. 2 &#39;<a class="code" href="classk_gfx_apply_mult_attributes_cmd_boss.html">kGfxApplyMultAttributesCmdBoss</a>&#39;</div><div class="line"> ## Begin Sequence</div><div class="line"> ## End Sequence</div><div class="line"> End cmd &#39;<a class="code" href="classk_gfx_apply_mult_attributes_cmd_boss.html">kGfxApplyMultAttributesCmdBoss</a>&#39; (class id 0x6e4d)</div><div class="line"> ## End Sequence</div><div class="line"> End cmd &#39;<a class="code" href="classk_new_page_item_cmd_boss.html">kNewPageItemCmdBoss</a>&#39; (class id 0x2c01)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 125)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 136)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 136)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 140)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 136)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 136)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 125)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 137)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 137)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 140)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 137)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 137)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 125)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 140)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 140)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 137)</div><div class="line"> &gt;&gt; Direct Change: SetDirty (id: 136)</div><div class="line"><span class="comment">// Direct Changes are Done</span></div><div class="line"><span class="comment">// Root Command is Done</span></div><div class="line"> End cmd &#39;<a class="code" href="classk_group_cmd_boss.html">kGroupCmdBoss</a>&#39; (class id 0x405)</div></div></ul><h3><a class="anchor" id="id_diagnostics_document_structure_menu"></a> Diagnostics &gt; Document Structure menu</h3><p>The menu contains items to report information on the spreads, pages, and page items in the front document: <div class="image"><img alt="diag-documentstructure.gif" src="diag-documentstructure.gif" /></div><p>The four commands in the menu are described below.<ul><li>Create Square At Page Origin - This creates a 100pt-by-100pt square spline at the origin of the current page in the front-most document and traces the geometry of the object and its parent spread as it does so.<li>Trace Content Geometry - This traces the geometry of spreads and page items in their inner coordinates, relative to their parent object and the pasteboard.<li>Trace Content Hierarchy - This traces the content of each spread, by the spread layer by which the content is owned. For example: <div class="fragment"><div class="line">TraceContentHierarchy() ********Begin</div><div class="line"><a class="code" href="classk_doc_boss.html">kDocBoss</a>, uid 0x1</div><div class="line">Untitled-2</div><div class="line"><a class="code" href="classk_spread_boss.html">kSpreadBoss</a>, uid 0x7a</div><div class="line"> Spread 1 content by hierarchy...</div><div class="line"><a class="code" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>, uid 0x7b</div><div class="line"><a class="code" href="classk_page_boss.html">kPageBoss</a>, uid 0x7f</div><div class="line"><a class="code" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>, uid 0x7c</div><div class="line"> kSpreadLayerBoss, uid 0x7d</div><div class="line"><a class="code" href="classk_spline_item_boss.html">kSplineItemBoss</a>, uid 0x8c</div><div class="line"><a class="code" href="classk_image_item.html">kImageItem</a>, uid 0x88</div><div class="line"> kSpreadLayerBoss, uid 0x7e</div><div class="line"><a class="code" href="classk_master_pages_boss.html">kMasterPagesBoss</a>, uid 0x81</div><div class="line"> A-Master master spread content by hierarchy...</div><div class="line"> kSpreadLayerBoss, uid 0x82</div><div class="line"> kPageBoss, uid 0x86</div><div class="line"> kPageBoss, uid 0x87</div><div class="line"> kSpreadLayerBoss, uid 0x83</div><div class="line"> kSpreadLayerBoss, uid 0x84</div><div class="line"> kSpreadLayerBoss, uid 0x85</div><div class="line">TraceContentHierarchy() ********End</div></div><li>Trace Content Layers - This traces the content of each spread, by the document layer on which the content is displayed.</ul><h3><a class="anchor" id="id_diagnostics_inx_dtd_menu"></a> Diagnostics &gt; INX DTD menu</h3><p>This menu contains items related to INX DTD generation. InDesign Interchange (INX) format is an XML-based format used to serialize and deserialize the InDesign scripting DOM. The API supports several options for export to INX file format, and this menu item demonstrates generating DTDs that correspond to these options.<dl class="section note"><dt>Note<dd>The application itself does not provide these options during export. <div class="image"><img alt="diag-inxdtd.gif" src="diag-inxdtd.gif" /></div></dl><p>The five commands in the menu are described below.<ul><li>Generate - This generates a DTD according to the current scripting model at run time. This means if your newly developed plug-in supports scripting, the generated DTD covers that. The menu command is disabled if no document is open. The generated DTD is saved to the same directory as InDesign recovery and<li>named INXFile.DTD.<li>Toggle Use DTD - This toggles use of the DTD. The default setting for INX export is false.<li>Toggle Use Namespace - This toggles use of the namespace. The default setting for INX export is false.<li>Toggle Use Readable Numbers - This toggles use of readable numbers. The default setting for INX export is true. When true, the real number in exported INX is represented as human-readable text; otherwise, binary.<li>Toggle Use Verbose Name - This toggles use of verbose names. The default setting for INX export is false. When true, the verbose name is used to represent element and attribute name instead of the four-character value (for example, &quot;document&quot; instead of &quot;docu&quot;).</ul><dl class="section note"><dt>Note<dd>InDesign supports RelaxNG schema validation of IDML. It does not, and will not, support DTD validation of INX files. We recommend IDML to assemble and disassemble content outside of InDesign. For details about schema validation with IDML, see Adobe InDesign Markup Language (IDML) Cookbook.</dl><h3><a class="anchor" id="id_diagnostics_object_model_menu"></a> Diagnostics &gt; Object Model menu</h3><div class="image"><img alt="diag-objectmodel.gif" src="diag-objectmodel.gif" /></div><p>The four commands in the menu are described below.<ul><li>Dump Object Model To File - This exports the object model to a tab-separated file in the folder where the application is installed. A record is produced for each interface on each boss class. The output file is IObjectModel_RomanFS.txt if the application is running with the Roman feature set and IObjectModel_JapaneseFS.txt<li>if the application is running with the Japanese feature set. These reports are suitable for import into a spreadsheet or database application. You can then do filtered searches to get answers to question like &quot;Which boss classes aggregate IID_IATTRREPORT?&quot;<li>Trace Boss Class Interfaces - This traces the interfaces aggregated by a given boss class.<li>Trace ID - This traces the symbolic name of a given numeric ID in each ID space.<li>Trace UID - This traces the ClassID of a given UID, by instantiating an object of that UID in the front document and examining its associated boss class. If no documents are open, the InDesign Defaults database is used.</ul><h3><a class="anchor" id="id_diagnostics_scripting_dom_menu"></a> Diagnostics &gt; Scripting DOM menu</h3><div class="image"><img alt="diag-scriptingdom.gif" src="diag-scriptingdom.gif" /></div><p>The Scripting DOM menu can be used to dump a language-specific scripting DOM to an XML file. It contains submenus that allow you to specify the product version, followed by the language to dump. IDML, INX, and JavaScript DOMs are available on both Windows and Mac OS. Also, Visual Basic is available on Windows, and AppleScript is available on Mac OS.<p>These XML files can be transformed into two useful HTML representations, using an XSLT processor and the style sheets included at &lt;SDK&gt;/docs/references/. The scripting-dom-to-html.xsl file produces an HTML representation of the entire DOM. The scripting-dom-idname-table.xsl file produces a simple table that maps scriptIDs to names. See the comments at the top of the style sheets for detailed use instructions.<h3><a class="anchor" id="id_running_the_diagnostics_plug-in_in_indesign_incopy_with_a_script"></a> Running the Diagnostics plug-in in indesign/incopy with a script</h3><p>You may run the Diagnostics plug-in with a script. The following examples demonstrate how to do so using JavaScript.<p>The following Windows example dumps the object model to c:\dump.txt: <div class="fragment"><div class="line">var myDiagnostics = app.diagnostics;</div><div class="line">myDiagnostics.dumpObjectModel(<span class="stringliteral">&quot;c:\\dump.txt&quot;</span>);</div><div class="line"><span class="comment">// Note: the path separator is \\ and not a single \.</span></div></div><p>The following Windows example produces c:\vbDOM-5.xml, a Visual Basic DOM for InDesign 5.0 or InCopy 5.0: <div class="fragment"><div class="line">var myDiagnostics = app.diagnostics;</div><div class="line">myDiagnostics.dumpScriptingDOM(ScriptingDOMLanguage.visualBasic, <span class="stringliteral">&quot;5.0&quot;</span>, <span class="stringliteral">&quot;c:\\vbDOM-5.xml&quot;</span>);</div></div><p>The following Mac OS example dumps the object model to dump.txt on the disk gokkyo: <div class="fragment"><div class="line">var myDiagnostics = app.diagnostics;</div><div class="line">myDiagnostics.dumpObjectModel(<span class="stringliteral">&quot;gokkyu:dump.txt&quot;</span>);</div><div class="line"><span class="comment">// Note: posix paths are not supported, use old style for now.</span></div></div><p>The following Mac OS example produces appleScriptDOM-5.xml, an AppleScript DOM for InDesign 5.0 or InCopy 5.0: <div class="fragment"><div class="line">var myDiagnostics = app.diagnostics;</div><div class="line">myDiagnostics.dumpScriptingDOM(ScriptingDOMLanguage.applescriptLanguage, <span class="stringliteral">&quot;5.0&quot;</span>, <span class="stringliteral">&quot;gokkyu:appleScriptDOM-5.xml&quot;</span>);</div></div><p>Once you save a script on your hard drive, you can run it using the Scripts panel. To open the Scripts panel, select Window &gt; Automation &gt; Scripts. Open the scripts folder, add a shortcut to your script, and run the script.<h3><a class="anchor" id="id_running_the_diagnostics_plug-in_in_indesign_server_on_windows_with_a_script"></a> Running the Diagnostics plug-in in InDesign Server on Windows with a script</h3><p>To run the above scripts with InDesign Server on Windows, open a command window, locate InDesign Server through Windows Explorer, drag it to the command prompt, and append the port on which you want it to listen. For example: <div class="fragment"><div class="line">&lt;path&gt;\InDesignServer.com -port 12345</div></div><p>Open another command window. Locate sampleclient through Windows Explorer, drag it to the command prompt, and append the host to which you want it to send. For example: <div class="fragment"><div class="line">&lt;path&gt;\sampleclient.exe &lt;path&gt;\MyScript.js -host localhost:12345</div></div><p>Before running InDesign Server, make sure the TCP/IP port (from which InDesign Server is listening for SOAP messages) is open (especially if you have a firewall set up).<h3><a class="anchor" id="id_running_the_diagnostics_plug-in_in_indesign_server_on_mac_os_with_a_script"></a> Running the Diagnostics plug-in in InDesign Server on Mac OS with a script</h3><p>To run the above scripts with InDesign Server on Mac OS, open a terminal window, locate InDesign Server through the Finder, drag it to the terminal window, and append the port on which you want it to listen. For example: <div class="fragment"><div class="line">&lt;path&gt;/InDesignServer -port 12345</div></div><p>Open another terminal window. Locate sampleclient using the Finder and drag it to the terminal window. Append the host to which you want it to send. For example: <div class="fragment"><div class="line">&lt;path&gt;/sampleclient &lt;path&gt;/MyScript.js -host localhost:12345</div></div><p>Before running InDesign Server, make sure the TCP/IP port (from which InDesign Server is listening for SOAP messages) is open (especially if you have a firewall set up).<h2><a class="anchor" id="id_frequently_asked_questions"></a> Frequently asked questions</h2><h3><a class="anchor" id="id_where_is_the_diagnostics_panel"></a> Where is the Diagnostics panel?</h3><p>The user interface for the features provided by the Diagnostics plug-in is in the Test &gt; Diagnostics menu. The panel used by previous versions of this plug-in is no longer needed.<h3><a class="anchor" id="id_what_is_trace"></a> What is trace?</h3><p>The easiest way to gather debug information is to use the debug facility&#39;s trace command, which is available in InDesign Build. A trace provides a printf style of debug log. Traces are available only with the debug build of InDesign Build; trace output under the release build is not supported.<p>When a trace statement is executed, the output goes to one or more trace logs. Use the Test &gt; TRACE menu to enable the logs that you want use. The choices are:<ul><li>Windows: <div class="image"><img alt="plugin-programming-guide-vol2-88.gif" src="plugin-programming-guide-vol2-88.gif" /></div></ul><ul><li>Debug Log file: The Trace output is exported into a text file named like Debug Logxxxx.txt.<li>MSVC&#39;s debug window: If you are running InDesign Debug with the plug-in under Visual Studio, trace outputs are exported to Visual Studio&#39;s output window.<li>Notepad: The Notepad application is launched and the trace output is exported into a Notepad file.<li>Console: cmd.exe is launched and trace output is displayed on the Console.<li>Macintosh: <div class="image"><img alt="plugin-programming-guide-vol2-89.gif" src="plugin-programming-guide-vol2-89.gif" /></div><li>Debug Log file: The Trace output is exported into a text file named like Debug Logxxxx.txt.<li>DebugWindow: This is a Macintosh-only utility for viewing Trace output. To use it, manually launch the utility, which resides in the &lt;SDK&gt;/devtools/bin folder, before starting InDesign Debug. The Trace output is exported to the DebugWindow as if it were a console window. The following is a screen shot of DebugWindow. <div class="image"><img alt="plugin-programming-guide-vol2-90.gif" src="plugin-programming-guide-vol2-90.gif" /></div></ul><h3><a class="anchor" id="id_why_dont_i_get_trace_messages"></a> Why don&#39;t I get trace messages?</h3><p>Make sure you checked one of the available logs presented on the Test &gt; TRACE menu and Test &gt; TRACE &gt; Diagnostics is selected. If you do not see a Test &gt; TRACE &gt; Diagnostics menu, use Test &gt; Diagnostics &gt; ObjectModel &gt; TraceID first. (Some trace output must be written to the category before the Test &gt; TRACE menu shows it.)<h1><a class="anchor" id="id_tools"></a> Tools</h1><p>This chapter describes how tools work and how to implement your own custom tools and add them to the toolbox.<p>The chapter has the following objectives:<ul><li>Define terms related to tools, trackers, and the toolbox.<li>Introduce the layout view.<li>Explain how tools work.<li>Explain how to track the user&#39;s mouse actions.<li>Explain how to implement a custom tool.<li>Describe the extension patterns provided by the API that relate to tools.</ul><h2><a class="anchor" id="id_key_concepts"></a> Key concepts</h2><h3><a class="anchor" id="id_the_toolbox_and_the_layout_view"></a> The toolbox and the layout view</h3><p>Tools are presented using the toolbox palette. Document content is presented in the layout view. Tools create and manipulate document objects using keyboard and mouse events in the layout view. This is illustrated in the following figure. <div class="image"><img alt="plugin-programming-guide-vol2-91.gif" src="plugin-programming-guide-vol2-91.gif" /></div><p>The layout view is a widget in which a document is presented and edited by the user. The layout view is the <a class="el" href="class_i_control_view.html">IControlView</a> interface on the <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> boss object. For more information on the layout widget, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>.<p>Tools commonly use interfaces on <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a> to discover the context in which they are working. For example, the spread being manipulated is found using <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a>, and hit testing can be done using <a class="el" href="class_i_layout_control_view_helper.html">ILayoutControlViewHelper</a>. The toolbox contains a tool button icon for each tool and, optionally, a hidden-tools panel containing other tools (see the following figure). <div class="image"><img alt="plugin-programming-guide-vol2-92.gif" src="plugin-programming-guide-vol2-92.gif" /></div><h3><a class="anchor" id="id_tools"></a> Tools</h3><p>A tool (<a class="el" href="class_i_tool.html">ITool</a> interface) has a button icon in the toolbox and, optionally, a keyboard shortcut. A tool also may provide a cursor (pointer) as a visual cue to the user of the active tool and a tool tip to help the user understand the purpose of the tool. To track mouse actions when the tool is being used, the tool provides a tracker (<a class="el" href="class_i_tracker.html">ITracker</a> interface).<h3><a class="anchor" id="id_cursors"></a> Cursors</h3><p>A cursor (<a class="el" href="class_i_cursor_provider.html">ICursorProvider</a> interface) provides a visual cue to the user of the active tool. Tools that provide their own cursors must implement cursor providers. Cursor providers set the mouse cursor and provide context-sensitive cursors for different areas of the screen. See the following figure. <div class="image"><img alt="plugin-programming-guide-vol2-93.gif" src="plugin-programming-guide-vol2-93.gif" /></div><h3><a class="anchor" id="id_tool_tips"></a> Tool tips</h3><p>A tool tip (<a class="el" href="class_i_tip.html">ITip</a> interface) displays a string with the name of the tool and its keyboard shortcut, when the pointer is positioned over the tool icon in the toolbox. See the following figure. The strings displayed are declared as ODFRez string resources in the plug-in&#39;s .fr file. The application automatically handles display of tool tips. <div class="image"><img alt="plugin-programming-guide-vol2-94.gif" src="plugin-programming-guide-vol2-94.gif" /></div><h3><a class="anchor" id="id_trackers"></a> Trackers</h3><p>Trackers (<a class="el" href="class_i_tracker.html">ITracker</a> interface) monitor mouse movement while an object is being manipulated by a tool. Trackers can provide visual feedback to the user. Trackers make changes to the objects being manipulated using commands. A tool may have one or more trackers, though only one tracker is active at a time.<h3><a class="anchor" id="id_tracker_factory_tracking_and_event_handling"></a> Tracker factory, tracking, and event handling</h3><p>The tracker factory (<a class="el" href="class_i_tracker_factory.html">ITrackerFactory</a> interface) allows you to introduce new trackers by manufacturing the tracker required for a particular context. The <a class="el" href="class_i_tracker_factory.html">ITrackerFactory</a> interface is aggregated on the <a class="el" href="classk_session_boss.html">kSessionBoss</a> boss class. The tracker factory maintains a table associating a tracker with a given widget and tool by ClassID. When the tool is used in the context of the widget, the associated tracker is created and receives control. Trackers for tools that appear in the toolbox register themselves as being associated with the layout widget, <a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>. The code in the following example adds an entry to the tracker factory. <div class="fragment"><div class="line"><span class="keywordtype">void</span> LineTrackerRegister::Register(<a class="code" href="class_i_tracker_factory.html">ITrackerFactory</a> *factory){</div><div class="line"> factory-&gt;<a class="code" href="class_i_tracker_factory.html#a92e31635253a7d1ed93358b59922c69a">InstallTracker</a>(<a class="code" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>, <a class="code" href="classk_line_tool_boss.html">kLineToolBoss</a>, <a class="code" href="classk_line_tracker_boss.html">kLineTrackerBoss</a>);</div><div class="line">}</div></div><p>The framework maintains an event-handler stack that it uses to dispatch events (mouse, keyboard, and system events). Many event handlers (<a class="el" href="class_i_event_handler.html">IEventHandler</a> interface) are associated with a widget. The widget that has the user-interface focus is on top of the stack and receives and processes events.<p>When a mouse-down event occurs in layout view and the active tool is <a class="el" href="classk_line_tool_boss.html">kLineToolBoss</a>, the layout view&#39;s event handler asks the tracker factory to manufacture the tracker for this context. It does this by making the following call to create <a class="el" href="classk_line_tracker_boss.html">kLineTrackerBoss</a> and return its <a class="el" href="class_i_tracker.html">ITracker</a> interface: <div class="fragment"><div class="line"><a class="code" href="class_i_tracker_factory.html#a77480b078f9074d71079e4c22ffb1ff4">ITrackerFactory::QueryTracker</a>(<a class="code" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a>, <a class="code" href="classk_line_tool_boss.html">kLineToolBoss</a>)</div></div><p>The tracker is then focused on the layout view and begins tracking.<p>To follow mouse movement, a tracker must handle events for the duration of the tracking process. To do this, the tracker pushes its event-handler interface onto the stack when tracking begins and pops it off the stack when tracking ends. For example, when the Line tool is used to drag the end points of a line, its tracker pushes and pops its event handler as shown in the following figure. <div class="image"><img alt="plugin-programming-guide-vol2-95.gif" src="plugin-programming-guide-vol2-95.gif" /></div><p>All tracker boss classes that want to follow the mouse as it is dragged aggregate an <a class="el" href="class_i_event_handler.html">IEventHandler</a> interface. When the LayoutEventHandler receives a mouse-down event, it calls the tracker&#39;s <a class="el" href="class_i_tracker.html#a3fc316eb01850beb1453c348602e37cf">ITracker::BeginTracking</a> method, which normally is implemented by <a class="el" href="class_c_tracker.html#a81cb0149fee42af5ee1d524276403e65">CTracker::BeginTracking</a>. If the mouse is to be tracked, this method calls <a class="el" href="class_c_tracker.html#a095a6e4e9e34c9055f75a454bbbfcd03">CTracker::EnableTracking</a>, which calls <a class="el" href="class_c_tracker.html#a49aae10c04bcc4324a9f54b19a63e869">CTracker::PushEventHandler</a> to push the tracker&#39;s event handler (interface <a class="el" href="class_i_event_handler.html">IEventHandler</a>) onto the event-handler stack using <a class="el" href="class_i_event_dispatcher.html#aa2280a6f0f0240400b325723879efa44">IEventDispatcher::Push</a>. For more implementation details, see CTracker.cpp in the SDK.<h3><a class="anchor" id="id_beyond_the_toolbox"></a> Beyond the toolbox</h3><p>Tools do not have to appear in the toolbox. For example, the Place tool is activated after selecting a file using the File &gt; Place menu command. Trackers also are used extensively in mouse-dragging features, like setting the layout zero point and dragging guides from rulers.<h3><a class="anchor" id="id_drawing_and_sprites"></a> Drawing and sprites</h3><p>To provide visual feedback while an object is undergoing manipulation, a tracker can draw to the screen.<p>Page items can be hard to draw when they are being changed dynamically. To ensure objects are drawn on the screen smoothly and efficiently without flickering, the application provides a sprite API. A sprite (<a class="el" href="class_i_sprite.html">ISprite</a> interface) is a graphic object that can be moved around on screen without causing any disturbance to the background.<h3><a class="anchor" id="id_documents_page_items_and_commands"></a> Documents, page items, and commands</h3><p>Tools allow the manipulation of documents and page items by the user. For more information on how documents are organized and page items are arranged, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_layout_fundamentals">Layout Fundamentals</a>. Tools use commands to make changes to a document.<h3><a class="anchor" id="id_line-tool_use_scenario"></a> Line-tool use scenario</h3><p>The following scenario describing the Line tool shows how the objects in a tool collaborate.<p>The scenario is divided into three sections:<ul><li>Control is concerned with the registration of the tool with the application and the mechanism allowing the user to select the tool<li>Dispatch is concerned with how the application begins active use of the tool.<li>Behavior is concerned with what the tool does to create a line.</ul><p>The following figure shows how the Line tool registers with the application and is used to create a line between two points in a document. The table following the figure defines the abbreviations used in the figure. <div class="image"><img alt="plugin-programming-guide-vol2-96.gif" src="plugin-programming-guide-vol2-96.gif" /></div><table class="doxtable"><tr><th>Figure area </th><th>Abbreviation </th><th>Description </th></tr><tr><td colspan="1" rowspan="3">Control</td><td>C1</td><td>The tool&#39;s tracker is registered with the application&#39;s tracker factory. </td></tr><tr><td>C2</td><td>The tool is registered with the application, and its tool-button icon in the toolbox is initialized. </td></tr><tr><td>C3</td><td>The user clicks the tool&#39;s button icon (<a class="el" href="classk_line_tool_boss.html">kLineToolBoss</a> becomes the active tool). </td></tr><tr><td colspan="1" rowspan="4">Dispatch</td><td>D1</td><td>The user clicks in the layout view (a mouse-down event is passed to the LayoutEventHandler). </td></tr><tr><td>D2</td><td>The LayoutEventHandler looks at the active tool (<a class="el" href="classk_line_tool_boss.html">kLineToolBoss</a>) and the context of the event (mouse-down over an empty page area). The association identifies the tracker that should be created for the context (<a class="el" href="classk_line_tracker_boss.html">kLineTrackerBoss</a>). </td></tr><tr><td>D3</td><td>The appropriate tracker is manufactured by the tracker factory. </td></tr><tr><td>D4</td><td>The tracker is asked to begin tracking the mouse from the original mouse-down event. </td></tr><tr><td colspan="1" rowspan="6">Behavior</td><td>B1</td><td>The tracker pushes its own event handler onto the application&#39;s event handler stack, so it can receive events and track the mouse. </td></tr><tr><td>B2</td><td>The user drags the mouse (events are passed into the tracker). </td></tr><tr><td>B3</td><td>The tracker provides appropriate dynamic visual feedback to the user of the tool behavior: a line is drawn between the location of the original mouse-down event and the current mouse position. </td></tr><tr><td>B4</td><td>The user releases the mouse (a mouse-up event is passed into the tracker). </td></tr><tr><td>B5</td><td>The tracker implements an appropriate action (creation of a page item describing the line between start and end points), using a command. </td></tr><tr><td>B6</td><td>The tracker pops its event handler from the application&#39;s event-handler stack, and tracking is complete. </td></tr></table><p>The scenario shown in the figure is typical of a tool that creates items. The item itself is created by the tracker, using a command after the user releases the mouse button; however, other categories of tools may execute commands dynamically, while tracking the mouse. For example, the Selection tool dynamically executes commands when moving or resizing items.<h3><a class="anchor" id="id_trackers_with_multiple_behaviors"></a> Trackers with multiple behaviors</h3><p>If a tracker needs to exhibit multiple behaviors, it can create another tracker that depends on the context. For example, the Selection tool exhibits multiple behaviors. When it is active and a mouse-down event occurs in a layout view, the pointer tracker (<a class="el" href="classk_pointer_tracker_boss.html">kPointerTrackerBoss</a>) is created. The pointer tracker considers the context of the click, then creates and dispatches control to another tracker. Once the pointer tracker examines the context and creates an appropriate tracker, its job is done. The trackers used by <a class="el" href="classk_pointer_tracker_boss.html">kPointerTrackerBoss</a> to move and resize page items are shown in the following figure.<p>Pointer tracker move and resize behavior: <div class="image"><img alt="plugin-programming-guide-vol2-97.gif" src="plugin-programming-guide-vol2-97.gif" /></div><p>This figure does not show all <a class="el" href="classk_pointer_tracker_boss.html">kPointerTrackerBoss</a> behaviors. For example, the following are not shown in the figure:<ul><li>The threading of text frames via in and out port handles by <a class="el" href="classk_pre_place_tracker_boss.html">kPrePlaceTrackerBoss</a>.<li>The tracking of when the layer on which the item lies is locked (<a class="el" href="classk_lock_tracker_boss.html">kLockTrackerBoss</a>).<li>The tracking of text on a path-handle manipulation (<a class="el" href="classk_t_o_p_resize_tracker_boss.html">kTOPResizeTrackerBoss</a> and <a class="el" href="classk_t_o_p_move_tracker_boss.html">kTOPMoveTrackerBoss</a>).</ul><p>Each page item can register its own resize tracker, although they all use the same one for resizing.<h3><a class="anchor" id="id_tool_manager"></a> Tool manager</h3><p>Tools are managed by the tool manager, <a class="el" href="classk_tool_manager_boss.html">kToolManagerBoss</a>. You can navigate to the <a class="el" href="class_i_tool_manager.html">IToolManager</a> interface as shown in the following code: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IApplication&gt;</a> app(GetExecutionContextSession()-&gt;QueryApplication());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IToolManager&gt;</a> toolMgr(app-&gt;QueryToolManager());</div></div><h3><a class="anchor" id="id_toolbox_utilities"></a> Toolbox utilities</h3><p>The <a class="el" href="class_i_tool_box_utils.html">IToolBoxUtils</a> interface provides a facade that should, in most situations, save you from having to program to the <a class="el" href="class_i_tool_manager.html">IToolManager</a> interface. <a class="el" href="class_i_tool_box_utils.html">IToolBoxUtils</a> is a utility interface on <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>, accessed in the standard way. For example, the following code queries the active tool of type <a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a>. The tool type in this context identifies a group of tools, of which only one can be active: <div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="class_i_d_type.html">ClassID</a> toolType = <a class="code" href="classk_pointer_tool_boss.html">kPointerToolBoss</a>;</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITool&gt;</a> currentTool( <a class="code" href="class_utils.html">Utils&lt;IToolBoxUtils&gt;</a>()-&gt;QueryActiveTool(toolType));</div></div><h3><a class="anchor" id="id_tool_type"></a> Tool type</h3><p>Tools are categorized as belonging to one or more of the categories given by <a class="el" href="class_i_tool.html#a6862f034b24daf048079468897048094">ITool::ToolType</a>. This identifies what the tool does and how the selection in the layout view reacts when that tool becomes active (<a class="el" href="class_i_tool_change_suite.html">IToolChangeSuite</a> interface). Tools identify this type in their <a class="el" href="class_c_tool.html">CTool</a> constructor by the toolInfo parameter.<p><a class="el" href="class_i_tool.html#a6862f034b24daf048079468897048094">ITool::ToolType</a> easily can be confused with the ClassID parameter toolType defined by the tool&#39;s ToolDef statement (see ToolDef ODFRez type) and used by <a class="el" href="class_i_tool.html#a2fffbd16cf08c819225ec502c9bd43e7">ITool::GetToolType</a> and other APIs. This ClassID is used to identify a group of mutually exclusive tools-tools for which only one tool of a given tool type can be selected in the toolbox at any time.<p>The table in Tool-category information illustrates the distinction between these two different tool types and their values.<h2><a class="anchor" id="id_custom_tools"></a> Custom tools</h2><h3><a class="anchor" id="id_architecture"></a> Architecture</h3><p>This section describes the boss classes, interfaces, and resources you must implement to add a new tool. The section also describes the APIs you use to build and catalogue custom tools.<p>Plug-ins that implement tools typically provide the following:<ul><li>A tool-register boss class.<li>A tracker-register boss class.<li>A tool boss class per tool.<li>A tracker boss class per tracker.<li>Resources controlling how the tool is displayed.</ul><h3><a class="anchor" id="id_class_diagram"></a> Class diagram</h3><p>The classes typically found in a custom tool are shown in the following figure. <div class="image"><img alt="plugin-programming-guide-vol2-98.gif" src="plugin-programming-guide-vol2-98.gif" /></div><p>kYourTrackerRegisterBoss registers the plug-in&#39;s trackers with the tracker factory using the <a class="el" href="class_i_tracker_register.html">ITrackerRegister</a> interface.<p>kYourToolBoss allows the tool manager to control the tool using the <a class="el" href="class_i_tool.html">ITool</a> interface. kYourToolBoss specifies information about the tool and gets called when the tool is selected or deselected by the user and when a tool options dialog box should be displayed. <a class="el" href="class_i_cursor_provider.html">ICursorProvider</a> allows the tool to customize the cursor when the tool is active. <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> allows information like the tool&#39;s name and icon to be saved persistently.<p><a class="el" href="classk_generic_tool_boss.html">kGenericToolBoss</a> is the parent boss class for toolbox tools. The control view it provides displays the tool&#39;s buttons, and its event handler handles clicks on the tool&#39;s buttons in the toolbox.<p>kYourTrackerBoss responds to mouse actions in the layout view when your tool is being used. There is at least one tracker boss for each tool in your plug-in. The interfaces on a tracker boss class collaborate to provide the active behavior of the tool. Control is passed to the <a class="el" href="class_i_tracker.html">ITracker</a> interface, so the mouse can be tracked. This interface manages and controls the other interfaces on the boss object.<p>The tracker pushes its event handler to the top of the event handler stack when tracking begins. During tracking, <a class="el" href="class_i_event_handler.html">IEventHandler</a> forwards events into the <a class="el" href="class_i_tracker.html">ITracker</a> interface. When tracking ends, the event handler is popped from the stack, and the tracker is finished. Standard tracker event-handler implementations are provided by the API. It is common for tracker boss classes to have other interfaces particular to their needs. For example, trackers that create splines aggregate <a class="el" href="class_i_sprite.html">ISprite</a> and <a class="el" href="class_i_path_geometry.html">IPathGeometry</a>. If a tracker needs to handle only one mouse click, however, it does not require an <a class="el" href="class_i_event_handler.html">IEventHandler</a>.<h3><a class="anchor" id="id_partial_implementation_classes"></a> Partial implementation classes</h3><p>The API provides helper classes that partially implement interfaces relevant to building tools. Some relevant classes are shown in the following table. For more information, refer to the API Reference for each class.<table class="doxtable"><tr><th>Interface </th><th>Class </th></tr><tr><td><a class="el" href="class_i_cursor_provider.html">ICursorProvider</a></td><td><a class="el" href="class_c_tool_cursor_provider.html">CToolCursorProvider</a></td></tr><tr><td><a class="el" href="class_i_event_handler.html">IEventHandler</a></td><td><a class="el" href="class_c_tracker_event_handler.html">CTrackerEventHandler</a> (the C++ source code for this implementation is provided on the SDK) </td></tr><tr><td><a class="el" href="class_i_tool.html">ITool</a></td><td><a class="el" href="class_c_tool.html">CTool</a></td></tr><tr><td><a class="el" href="class_i_tracker.html">ITracker</a></td><td><a class="el" href="class_c_tracker.html">CTracker</a> (the C++ source code for this implementation is provided on the SDK) </td></tr><tr><td><a class="el" href="class_i_tracker.html">ITracker</a></td><td><a class="el" href="class_c_path_creation_tracker.html">CPathCreationTracker</a> (the C++ source code for this implementation is provided on the SDK) </td></tr><tr><td><a class="el" href="class_i_tracker.html">ITracker</a></td><td><a class="el" href="class_c_layout_tracker.html">CLayoutTracker</a> (the C++ source code for this implementation is provided on the SDK) </td></tr><tr><td><a class="el" href="class_i_tracker.html">ITracker</a></td><td><a class="el" href="class_c_slider_tracker.html">CSliderTracker</a></td></tr><tr><td><a class="el" href="class_i_tracker_register.html">ITrackerRegister</a></td><td>None </td></tr></table><h3><a class="anchor" id="id_default_implementations"></a> Default implementations</h3><p>The API provides default implementations that completely implement some of the interfaces involved in building tools. If these meet your needs, you can reuse them in your boss class definition and avoid writing the C++ code. See the table in Default implementations of tool-related interfaces for a list of reusable implementations in the API.<h3><a class="anchor" id="id_tooldef_odfrez_type"></a> ToolDef ODFRez type</h3><p>ODFRez provides a type, ToolDef, that controls how a tool is displayed within the toolbox. This type controls the order in which tools are displayed, the way in which they are grouped, and other properties, as shown in the following figure. <div class="image"><img alt="plugin-programming-guide-vol2-99.gif" src="plugin-programming-guide-vol2-99.gif" /></div><p>ToolDef resources are localizable, so you can define different resources for different locales and have a tool show up in a different place or with a different icon. For example, for a currency stamp tool, a tool icon could be provided for each locale (for example, dollar and yen) and the icon for the current locale would be shown in the toolbox. To localize your ToolDef resources, add a locale index to your plug-in&#39;s .fr file and define a ToolDef resource in the .fr file for each locale.<h3><a class="anchor" id="id_icons_and_cursors"></a> Icons and cursors</h3><p>Icons and cursors can be created in their native-platform resource form. InDesign also supports PNG platform-independent files for icons, which is the preferred resource type to use in icon-based widgets. All the application tools&#39; icons use PNG files, so they all have rollover effect.<p>To create a PNG-based icon:<ol type="1"><li>In your .fr file, where you have the ToolDef, declare the PNG resources. There should be two states for each each icon, normal and rollover. For example, the SDK Info button seen in several SDK dialog uses the following PNG resources <div class="fragment"><div class="line">resource PNGA(kSDKDefIconInfoResourceID) <span class="stringliteral">&quot;SDKInfoButton.png&quot;</span></div><div class="line">resource PNGR(kSDKDefIconInfoRolloverResourceID) <span class="stringliteral">&quot;SDKInfoButtonRollover.png&quot;</span></div></div><li>Two PNG resources are defined in Step 1. The normal state, PNGA, has an ID of kSDKDefIconInfoResourceID and uses the SDKInfoButton.png file. The rollover state, PNGR, has an ID of kSDKDefIconInfoRolloverResourceID and uses the SDKInfoButtonRollover.png file. Both IDs should be defined as the same number; in this case, both are defined as 180 in the <a class="el" href="_s_d_k_def_8h_source.html">SDKDef.h</a> file.<li>Use the normal-state resource ID in your ToolDef definition, where you specify the icon ID for the tool.</ol><p>Mac OS icons need resources of type icl4, icl8, and ICN#. Cursors need resources of type CURS.<p>Windows icons need an icon bitmap .ico file and an ICON resource declaration in your plug-in project&#39;s .rc file. Cursors need a cursor bitmap .cur file and a CURSOR resource declaration in your plug-in project&#39;s .rc file.<p>Tool-button icons come in two sizes: standard and mini. Normally, you use the standard size, kStandardToolRect. <a class="el" href="class_c_tool.html">CTool</a> specifies the widget rects involved. In your <a class="el" href="class_c_tool.html#a3d6a788d4b8f09e0bef40b75e4dcb4ca">CTool::Init</a> implementing, you control the size to be used by calling <a class="el" href="class_c_tool.html#a45ed7e50ce1501c630684534e27c477d">CTool::InitWidget</a> and passing in the tool rects.<h3><a class="anchor" id="id_indesign_trackers"></a> InDesign trackers</h3><p>The API provides many trackers, and you may want to dispatch control to one of them. Generally, these can be divided into trackers used by tools to manipulate document content (see Tool-related trackers) and trackers used by user-interface widgets to manipulate controls (see User-interface widget-related trackers). The ClassID needed by <a class="el" href="class_i_tracker_factory.html">ITrackerFactory</a> to make one of these trackers are listed in these tables.<p>Since no iterator generates all registered trackers the application supports at run time, two distinct tables are shown: one for tool-related trackers (Tool-related trackers) and another for user-interface widget&acirc;&#128;&#147;related trackers (User-interface widget-related trackers).<p>Often, the application&#39;s existing trackers can be reused for your custom tools. For example, suppose you implemented a custom tracker, and the application already provides another tracker to which, under certain circumstances, you want to pass control. Suppose you want to pass control to the pointer tracker, kPointerTr ackerBoss. You look up the tracker ClassID in the Tracker ClassID column of the following tables and find the relevant widget ClassID and tool ClassID. You then pass these into <a class="el" href="class_i_tracker_factory.html#a77480b078f9074d71079e4c22ffb1ff4">ITrackerFactory::QueryTracker</a>.<p>If desired, you can suppress or replace one of the application&#39;s trackers. See Tool-related trackers for a list of tool-related trackers.<h2><a class="anchor" id="id_working_with_tools"></a> Working with tools</h2><h3><a class="anchor" id="id_catching_a_mouse_click_or_mouse_drag_on_a_document"></a> Catching a mouse click or mouse drag on a document</h3><p>If you want users to recognize that your tool will handle the event, you want a custom cursor. In this case, you need to implement a custom tool, set your tool as the active tool, and handle the mouse event in your tracker (see The toolbox and the layout view).<p>If you do not want users to recognize that your tool will handle the event, you probably want to handle the event without the user receiving any visual cue. In this case, use another stimulus, like a change in selection, to push an event handler onto the event-handler stack. If you are in doubt about what stimulus to choose, use a tool and tracker. This is the recommended way to catch mouse events in a layout view on a document.<h3><a class="anchor" id="id_implementing_a_custom_tool"></a> Implementing a custom tool</h3><p>See Custom tools, or refer to one of the sample tool plug-ins and adapt it to your needs.<h3><a class="anchor" id="id_displaying_a_tool_options_dialog_box"></a> Displaying a Tool Options dialog box</h3><p>Specialize the DisplayOptions and/or DisplayAltOptions methods in your <a class="el" href="class_i_tool.html">ITool</a> implementation. For an example, see SnapTool::displayOptions in the Snapshot sample.<h3><a class="anchor" id="id_finding_the_spread_nearest_the_mouse_position"></a> Finding the spread nearest the mouse position</h3><p>When implementing a tracker, you need to handle the fact that the user can click on any spread in a layout view. Your tracker must identify the spread on which the user has clicked. To do this, transform the position from the system-coordinate system to the pasteboard-coordinate system, then use one of the methods in <a class="el" href="class_i_pasteboard_utils.html">IPasteboardUtils</a>.<h3><a class="anchor" id="id_changing_spreads"></a> Changing spreads</h3><p>When implementing a tracker, you need to handle the fact that the user can click on any spread in a layout view. A layout view caches the current spread in the <a class="el" href="class_i_layout_control_data.html">ILayoutControlData</a> interface. Your tracker may need to change this if the spread that was clicked on is different. Process <a class="el" href="classk_set_spread_cmd_boss.html">kSetSpreadCmdBoss</a> to change to another spread.<h3><a class="anchor" id="id_performing_a_page-item_hit_test"></a> Performing a page-item hit test</h3><p><a class="el" href="class_i_layout_control_view_helper.html">ILayoutControlViewHelper</a> provides page-item hit-testing methods that can be used. For an example of using <a class="el" href="class_i_layout_control_view_helper.html">ILayoutControlViewHelper</a>, see &lt;SDK&gt;/source/sdksamples/codesnippets/SnpHitTestFrame.cpp.<h3><a class="anchor" id="id_setting_or_getting_the_active_tool"></a> Setting or getting the active tool</h3><p><a class="el" href="class_i_tool_box_utils.html">IToolBoxUtils</a> provides methods you can use to set or get the active tool. For an example of activating the Text tool, see &lt;SDK&gt;/source/sdksamples/codesnippets/SnpManipulateTextFrame.<h3><a class="anchor" id="id_observing_when_the_active_tool_changes"></a> Observing when the active tool changes</h3><p>Attach an observer (<a class="el" href="class_i_observer.html">IObserver</a> interface) to <a class="el" href="classk_tool_manager_boss.html">kToolManagerBoss</a>. In your Update method, detect the IID_ITOOLMANAGER protocol for the change <a class="el" href="classk_set_tool_cmd_boss.html">kSetToolCmdBoss</a>.<h3><a class="anchor" id="id_changing_the_toolbox_appearance_from_normal_to_skinny"></a> Changing the toolbox appearance from normal to skinny</h3><p>Use <a class="el" href="classk_set_user_interface_prefs_toolbox_cmd_boss.html">kSetUserInterfacePrefsToolboxCmdBoss</a> or IUserInterfacePreferencesFacade to change the <a class="el" href="class_i_user_interface_preferences.html">IUserInterfacePreferences</a>.<h3><a class="anchor" id="id_using_default_implementations_for_trackers"></a> Using default implementations for trackers</h3><p>Your tracker can create and dispatch control to a tracker supplied by the application. For example, to perform a marquee selection, you can create and dispatch control to a <a class="el" href="classk_layout_selection_tracker_boss.html">kLayoutSelectionTrackerBoss</a>. For a complete list of all trackers provided by the API, see Tool-related trackers.<h3><a class="anchor" id="id_suppressing_the_applications_default_tracker_for_a_custom_toolbox"></a> Suppressing the application&#39;s default tracker for a custom toolbox</h3><p>Suppose you implemented a special text tool on your custom toolbox that is to replace the Adobe standard toolbox. You do not want your text tool to create a text frame and only allow editing of text.<p>In this case, the frame creation you want to suppress is registered in the tracker factory under <a class="el" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a> and kFrameToolBoss. The tracker ClassID installed is <a class="el" href="classk_frame_tracker_boss.html">kFrameTrackerBoss</a>. When your custom toolbox is activated, you could save this registered tracker and replace it with your own, using the code in the following example. <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITrackerFactory&gt;</a> factory(GetExecutionContextSession(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (factory){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITracker&gt;</a> registeredTracker(factory-&gt;<a class="code" href="class_i_tracker_factory.html#a77480b078f9074d71079e4c22ffb1ff4">QueryTracker</a>(<a class="code" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a>, kFrameToolBoss));</div><div class="line"><a class="code" href="class_i_d_type.html">ClassID</a> savedClassID = ::GetClassID(registeredTracker);</div><div class="line"><span class="keywordflow">if</span> (registeredTracker) </div><div class="line"> {</div><div class="line"> factory-&gt;<a class="code" href="class_i_tracker_factory.html#a3d7d35151a1c7f918a27d1c24e7662eb">RemoveTracker</a>(<a class="code" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a>, kFrameToolBoss);</div><div class="line"> factory-&gt;<a class="code" href="class_i_tracker_factory.html#a92e31635253a7d1ed93358b59922c69a">InstallTracker</a>(<a class="code" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a>, kFrameToolBoss, kYourTrackerBoss);</div><div class="line"> }</div><div class="line">}</div></div><p>In this case, when the text-tool tracker tries to drag out a new frame, your tracker receives the control. If your <a class="el" href="class_c_tracker.html#a56cb726f3746f8bedcbfcf2d0638d856">CTracker::DoBeginTracking</a> method returns kFalse, you suppress the frame-creation behavior. When your custom toolbox is deactivated, restore the previously registered tracker.<p>There is one drawback to this mechanism. If more than one third-party plug-in tries to replace the same tracker, there is the potential for a collision. If you use the activation or deactivation of your toolbox or tool to replace or restore the registered tracker, such collisions can be avoided.<h2><a class="anchor" id="id_tool-category_information"></a> Tool-category information</h2><table class="doxtable"><tr><th>Tool </th><th>Tool boss </th><th><a class="el" href="class_i_tool.html#a6862f034b24daf048079468897048094">ITool::ToolType</a></th><th>ClassID toolType </th></tr><tr><td>Add Anchor Point </td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td>kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Apply color </td><td><a class="el" href="classk_boss___apply_current_color_tool.html">kBoss_ApplyCurrentColorTool</a></td><td>kNone </td><td><a class="el" href="classk_boss___clear_fill_stroke_tool.html">kBoss_ClearFillStrokeTool</a></td></tr><tr><td>Apply gradient </td><td><a class="el" href="classk_boss___apply_current_gradient_tool.html">kBoss_ApplyCurrentGradientTool</a></td><td>kNone </td><td><a class="el" href="classk_boss___clear_fill_stroke_tool.html">kBoss_ClearFillStrokeTool</a></td></tr><tr><td>Apply none </td><td><a class="el" href="classk_boss___clear_fill_stroke_tool.html">kBoss_ClearFillStrokeTool</a></td><td>kNone </td><td><a class="el" href="classk_boss___clear_fill_stroke_tool.html">kBoss_ClearFillStrokeTool</a></td></tr><tr><td>Bleed mode </td><td><a class="el" href="classk_bleed_mode_tool_boss.html">kBleedModeToolBoss</a></td><td>kNone </td><td><a class="el" href="classk_normal_view_mode_tool_boss.html">kNormalViewModeToolBoss</a></td></tr><tr><td>Convert Direction </td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td>kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Delete Anchor </td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td>kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Direct Selection </td><td><a class="el" href="classk_direct_select_tool_boss.html">kDirectSelectToolBoss</a></td><td>kLayoutSelectionTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Erase </td><td><a class="el" href="classk_erase_tool_boss.html">kEraseToolBoss</a></td><td>kLayoutCreationTool, kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Eyedropper </td><td>private </td><td>kLayoutManipulationTool, kTextManipulationTool, kTableManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Fill stroke </td><td><a class="el" href="classk_stroke_fill_proxy_tool_boss.html">kStrokeFillProxyToolBoss</a></td><td>kNone </td><td>none </td></tr><tr><td>Free transform tool </td><td><a class="el" href="classk_free_transform_tool_boss.html">kFreeTransformToolBoss</a></td><td>kLayoutManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Gradient </td><td><a class="el" href="classk_gradient_tool_boss.html">kGradientToolBoss</a></td><td>kLayoutManipulationTool, kTextManipulationTool, kTableManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Hand </td><td><a class="el" href="classk_grabber_hand_tool_boss.html">kGrabberHandToolBoss</a></td><td>kViewModificationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Horizontal frame grid (Japanese feature set) </td><td>private </td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Horizontal text on a path </td><td><a class="el" href="classk_t_o_p_horz_tool_boss.html">kTOPHorzToolBoss</a></td><td>kTextSelectionTool, kTableSelectionTool, kTextManipulationTool, kTableManipulationTool, kTextCreationTool, kTableCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Line </td><td><a class="el" href="classk_line_tool_boss.html">kLineToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Normal view mode </td><td><a class="el" href="classk_normal_view_mode_tool_boss.html">kNormalViewModeToolBoss</a></td><td>kNone </td><td><a class="el" href="classk_normal_view_mode_tool_boss.html">kNormalViewModeToolBoss</a></td></tr><tr><td>Oval </td><td><a class="el" href="classk_oval_tool_boss.html">kOvalToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Oval Frame </td><td><a class="el" href="classk_oval_frame_tool_boss.html">kOvalFrameToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Pen </td><td><a class="el" href="classk_spline_pen_tool_boss.html">kSplinePenToolBoss</a></td><td>kLayoutCreationTool, kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Pencil </td><td><a class="el" href="classk_pencil_tool_boss.html">kPencilToolBoss</a></td><td>kLayoutCreationTool, kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Place </td><td><a class="el" href="classk_place_tool_boss.html">kPlaceToolBoss</a></td><td>kNone (The place tool creates page items and is in theory a layout -creation tool, but because it does not appear in the toolbox, it has no category as such.) </td><td>not applicable </td></tr><tr><td>Preview mode </td><td><a class="el" href="classk_preview_mode_tool_boss.html">kPreviewModeToolBoss</a></td><td>kNone </td><td><a class="el" href="classk_normal_view_mode_tool_boss.html">kNormalViewModeToolBoss</a></td></tr><tr><td>Rectangle </td><td><a class="el" href="classk_rect_tool_boss.html">kRectToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Rectangle Frame </td><td><a class="el" href="classk_rect_frame_tool_boss.html">kRectFrameToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Regular Polygon </td><td><a class="el" href="classk_reg_poly_tool_boss.html">kRegPolyToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Regular Polygon Frame </td><td><a class="el" href="classk_reg_poly_frame_tool_boss.html">kRegPolyFrameToolBoss</a></td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Rotate </td><td><a class="el" href="classk_rotate_tool_boss.html">kRotateToolBoss</a></td><td>kLayoutSelectionTool, kLayoutManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Scale </td><td><a class="el" href="classk_scale_tool_boss.html">kScaleToolBoss</a></td><td>kLayoutSelectionTool, kLayoutManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Scissors </td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td>kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Selection </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td><td>kLayoutSelectionTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Shear </td><td><a class="el" href="classk_shear_tool_boss.html">kShearToolBoss</a></td><td>kLayoutSelectionTool, kLayoutManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Slug mode </td><td><a class="el" href="classk_slug_mode_tool_boss.html">kSlugModeToolBoss</a></td><td>kNone </td><td><a class="el" href="classk_normal_view_mode_tool_boss.html">kNormalViewModeToolBoss</a></td></tr><tr><td>Smooth </td><td><a class="el" href="classk_smooth_tool_boss.html">kSmoothToolBoss</a></td><td>kLayoutCreationTool, kLayoutManipulationTool, kPathManipulationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Type </td><td><a class="el" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a></td><td>kTextSelectionTool, kTableSelectionTool, kTextManipulationTool, kTableManipulationTool, kTextCreationTool, kTableCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Vertical frame grid (Japanese feature set) </td><td>private </td><td>kLayoutCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Vertical text on a path (Japanese feature set) </td><td><a class="el" href="classk_t_o_p_vert_tool_boss.html">kTOPVertToolBoss</a></td><td>kTextSelectionTool, kTableSelectionTool, kTextManipulationTool, kTableManipulationTool, kTextCreationTool, kTableCreationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr><tr><td>Zoom </td><td><a class="el" href="classk_zoom_tool_boss.html">kZoomToolBoss</a></td><td>kViewModificationTool </td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td></tr></table><h2><a class="anchor" id="id_default_implementations_of_tool-related_interfaces"></a> Default implementations of tool-related interfaces</h2><table class="doxtable"><tr><th>Interface </th><th>ImplementationID </th></tr><tr><td><a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a></td><td>kCToolRegisterProviderImpl </td></tr><tr><td><a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a></td><td>kCTrackerRegisterProviderImpl </td></tr><tr><td><a class="el" href="class_i_event_handler.html">IEventHandler</a></td><td>kCTrackerEventHandlerImpl </td></tr><tr><td><a class="el" href="class_i_cursor_provider.html">ICursorProvider</a></td><td>kCreationCursorProviderImpl, kDirectSelectCursorProviderImpl, kRotateCursorProviderImpl, kGrabberHandCursorProviderImpl, kScaleCursorProviderImpl, kShearCursorProviderImpl, kCreationCursorProviderImpl, kSplineAddCursorProviderImpl, kSplineRemoveCursorProviderImpl, kSplineDirectionCursorProviderImpl, kScissorsCursorProviderImpl, kHorizontalIBeamCrsrProviderImpl, kVerticalIBeamCrsrProviderImpl, kZoomToolCursorProviderImpl, kSelectCursorProviderImpl, kPlaceGunCursorProviderImpl, kSplineCreationCursorProviderImpl, kPencilCursorProviderImpl, kSmoothCursorProviderImpl, kEraseCursorProviderImpl, kTOPHorzToolCursorProviderImpl, kTOPVertToolCursorProviderImpl </td></tr><tr><td><a class="el" href="class_i_sprite.html">ISprite</a></td><td>kNoHandleSpriteImpl, kGradientToolSpritekFreeTransformSpriteImpl, kCSpriteImpl, kNoHandleAndCrossSpriteImpl, kLayoutSpriteImpl, kPencilSpriteImpl, kStandOffSpriteImpl, kTableResizeSpriteImpl, kTextOffscreenSpriteImpl </td></tr><tr><td><a class="el" href="class_i_path_geometry.html">IPathGeometry</a></td><td>kPathGeometryImpl </td></tr></table><h2><a class="anchor" id="id_tracker_listings"></a> Tracker listings</h2><h3><a class="anchor" id="id_tool-related_trackers"></a> Tool-related trackers</h3><table class="doxtable"><tr><th>Widget classID </th><th>Tool classID </th><th>Tracker classID </th></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_d_c_s_item_boss.html">kDCSItemBoss</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_item.html">kEPSItem</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_e_p_s_text_item_boss.html">kEPSTextItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a></td><td>kILGMoveToolImpl </td><td><a class="el" href="classk_i_l_g_move_tracker_boss.html">kILGMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a></td><td>kILGRotateToolImpl </td><td><a class="el" href="classk_i_l_g_rotate_tracker_boss.html">kILGRotateTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_frame_item_boss.html">kFrameItemBoss</a></td><td>kTextFrameILGMoveTrackerImpl </td><td><a class="el" href="classk_text_frame_i_l_g_move_tracker_boss.html">kTextFrameILGMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_generic_tool_boss.html">kGenericToolBoss</a></td><td>kPrePlaceToolBoss </td><td><a class="el" href="classk_pre_place_tracker_boss.html">kPrePlaceTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_text_b_box_resize_tracker_boss.html">kTextBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></td><td>kMoveToolBoss </td><td><a class="el" href="classk_guide_move_tracker_boss.html">kGuideMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a></td><td>kFrameToolBoss </td><td><a class="el" href="classk_frame_tracker_boss.html">kFrameTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a></td><td>kTextSelectionToolBoss </td><td><a class="el" href="classk_text_selection_tracker_boss.html">kTextSelectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a></td><td><a class="el" href="classk_vertical_text_tool_boss.html">kVerticalTextToolBoss</a></td><td><a class="el" href="classk_vertical_frame_tracker_boss.html">kVerticalFrameTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_image_item.html">kImageItem</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_direct_select_tool_boss.html">kDirectSelectToolBoss</a></td><td><a class="el" href="classk_direct_select_tracker_boss.html">kDirectSelectTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_erase_tool_boss.html">kEraseToolBoss</a></td><td><a class="el" href="classk_erase_tracker_boss.html">kEraseTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kFreeTransformMoveToolBoss </td><td><a class="el" href="classk_free_transform_move_tracker_boss.html">kFreeTransformMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kFreeTransformRotateToolBoss </td><td><a class="el" href="classk_free_transform_rotate_tracker_boss.html">kFreeTransformRotateTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kFreeTransformScaleToolBoss </td><td><a class="el" href="classk_free_transform_scale_tracker_boss.html">kFreeTransformScaleTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_free_transform_tool_boss.html">kFreeTransformToolBoss</a></td><td><a class="el" href="classk_free_transform_tracker_boss.html">kFreeTransformTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_grabber_hand_tool_boss.html">kGrabberHandToolBoss</a></td><td><a class="el" href="classk_grabber_hand_tracker_boss.html">kGrabberHandTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_gradient_tool_boss.html">kGradientToolBoss</a></td><td><a class="el" href="classk_gradient_tool_tracker_boss.html">kGradientToolTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kGroupSelectToolImpl </td><td><a class="el" href="classk_group_select_tracker_boss.html">kGroupSelectTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_i_beam_tool_boss.html">kIBeamToolBoss</a></td><td><a class="el" href="classk_i_beam_tracker_boss.html">kIBeamTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kLayoutLockToolImpl </td><td><a class="el" href="classk_lock_tracker_boss.html">kLockTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kLayoutSelectionToolImpl </td><td><a class="el" href="classk_layout_selection_tracker_boss.html">kLayoutSelectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_line_tool_boss.html">kLineToolBoss</a></td><td><a class="el" href="classk_line_tracker_boss.html">kLineTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_oval_frame_tool_boss.html">kOvalFrameToolBoss</a></td><td><a class="el" href="classk_oval_frame_tracker_boss.html">kOvalFrameTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_oval_tool_boss.html">kOvalToolBoss</a></td><td><a class="el" href="classk_oval_tracker_boss.html">kOvalTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_pencil_tool_boss.html">kPencilToolBoss</a></td><td><a class="el" href="classk_pencil_creation_tracker_boss.html">kPencilCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_place_tool_boss.html">kPlaceToolBoss</a></td><td><a class="el" href="classk_place_tracker_boss.html">kPlaceTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_pointer_tool_boss.html">kPointerToolBoss</a></td><td><a class="el" href="classk_pointer_tracker_boss.html">kPointerTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_rect_frame_tool_boss.html">kRectFrameToolBoss</a></td><td><a class="el" href="classk_rectangle_frame_tracker_boss.html">kRectangleFrameTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_rect_tool_boss.html">kRectToolBoss</a></td><td><a class="el" href="classk_rectangle_tracker_boss.html">kRectangleTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td>kReferencePointToolImpl </td><td><a class="el" href="classk_reference_point_tracker_boss.html">kReferencePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_reg_poly_frame_tool_boss.html">kRegPolyFrameToolBoss</a></td><td><a class="el" href="classk_reg_poly_frame_tracker_boss.html">kRegPolyFrameTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_reg_poly_tool_boss.html">kRegPolyToolBoss</a></td><td><a class="el" href="classk_reg_poly_tracker_boss.html">kRegPolyTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_rotate_tool_boss.html">kRotateToolBoss</a></td><td><a class="el" href="classk_rotate_tracker_boss.html">kRotateTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_scale_tool_boss.html">kScaleToolBoss</a></td><td><a class="el" href="classk_scale_tracker_boss.html">kScaleTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_scissors_tracker_boss.html">kScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_shear_tool_boss.html">kShearToolBoss</a></td><td><a class="el" href="classk_shear_tracker_boss.html">kShearTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_smooth_tool_boss.html">kSmoothToolBoss</a></td><td><a class="el" href="classk_smooth_tracker_boss.html">kSmoothTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_add_point_tracker_boss.html">kAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_convert_direction_tracker_boss.html">kConvertDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_spline_pen_tool_boss.html">kSplinePenToolBoss</a></td><td><a class="el" href="classk_spline_creation_tracker_boss.html">kSplineCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_remove_point_tracker_boss.html">kRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_t_o_p_horz_tool_boss.html">kTOPHorzToolBoss</a></td><td><a class="el" href="classk_t_o_p_horz_tool_tracker_boss.html">kTOPHorzToolTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_t_o_p_vert_tool_boss.html">kTOPVertToolBoss</a></td><td><a class="el" href="classk_t_o_p_vert_tool_tracker_boss.html">kTOPVertToolTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_vertical_text_tool_boss.html">kVerticalTextToolBoss</a></td><td><a class="el" href="classk_vertical_text_tracker_boss.html">kVerticalTextTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_layout_widget_boss.html">kLayoutWidgetBoss</a></td><td><a class="el" href="classk_zoom_tool_boss.html">kZoomToolBoss</a></td><td><a class="el" href="classk_zoom_tool_tracker_boss.html">kZoomToolTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a></td><td><a class="el" href="classk_place_tool_boss.html">kPlaceToolBoss</a></td><td><a class="el" href="classk_place_p_i_tracker_boss.html">kPlacePITrackerBoss</a></td></tr><tr><td><a class="el" href="classk_page_boss.html">kPageBoss</a></td><td>kMoveToolBoss </td><td><a class="el" href="classk_column_guide_tracker_boss.html">kColumnGuideTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_page_item_boss.html">kPageItemBoss</a></td><td>kMoveToolBoss </td><td><a class="el" href="classk_move_tracker_boss.html">kMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_page_item_boss.html">kPageItemBoss</a></td><td><a class="el" href="classk_place_tool_boss.html">kPlaceToolBoss</a></td><td><a class="el" href="classk_place_p_i_tracker_boss.html">kPlacePITrackerBoss</a></td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_p_i_c_t_item.html">kPICTItem</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_placed_p_d_f_item_boss.html">kPlacedPDFItemBoss</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_text_b_box_resize_tracker_boss.html">kTextBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a></td><td><a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a></td><td><a class="el" href="classk_splitter_tracker_boss_message.html">kSplitterTrackerBossMessage</a></td></tr><tr><td><a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a></td><td>kMoveToolBoss </td><td><a class="el" href="classk_stand_off_move_tracker_boss.html">kStandOffMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_stand_off_resize_tracker_boss.html">kStandOffResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_stand_off_resize_tracker_boss.html">kStandOffResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_stand_off_add_point_tracker_boss.html">kStandOffAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_stand_off_direction_tracker_boss.html">kStandOffDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_stand_off_page_item_boss.html">kStandOffPageItemBoss</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_stand_off_remove_point_tracker_boss.html">kStandOffRemovePointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_t_o_p_spline_item_boss.html">kTOPSplineItemBoss</a></td><td>kTOPMoveToolBoss </td><td><a class="el" href="classk_t_o_p_move_tracker_boss.html">kTOPMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_t_o_p_spline_item_boss.html">kTOPSplineItemBoss</a></td><td>kTOPResizeToolBoss </td><td><a class="el" href="classk_t_o_p_resize_tracker_boss.html">kTOPResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td>kPathResizeToolBoss </td><td><a class="el" href="classk_spline_path_resize_tracker_boss.html">kSplinePathResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_b_box_resize_tracker_boss.html">kBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td><a class="el" href="classk_scissors_tool_boss.html">kScissorsToolBoss</a></td><td><a class="el" href="classk_spline_scissors_tracker_boss.html">kSplineScissorsTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td><a class="el" href="classk_spline_add_point_tool_boss.html">kSplineAddPointToolBoss</a></td><td><a class="el" href="classk_spline_add_point_tracker_boss.html">kSplineAddPointTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td><a class="el" href="classk_spline_direction_tool_boss.html">kSplineDirectionToolBoss</a></td><td><a class="el" href="classk_spline_direction_tracker_boss.html">kSplineDirectionTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_w_m_f_item.html">kWMFItem</a></td><td><a class="el" href="classk_spline_remove_point_tool_boss.html">kSplineRemovePointToolBoss</a></td><td><a class="el" href="classk_spline_remove_point_tracker_boss.html">kSplineRemovePointTrackerBoss</a></td></tr></table><h3><a class="anchor" id="id_user-interface_widget-related_trackers"></a> User-interface widget-related trackers</h3><table class="doxtable"><tr><th>Widget classID </th><th>Tool classID </th><th>Tracker classID </th></tr><tr><td><a class="el" href="classk_cmyk_color_slider_widget_boss.html">kCmykColorSliderWidgetBoss</a></td><td><a class="el" href="classk_cmyk_color_slider_widget_boss.html">kCmykColorSliderWidgetBoss</a></td><td><a class="el" href="classk_cmyk_color_slider_tracker_boss.html">kCmykColorSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_color_slider_widget_boss.html">kColorSliderWidgetBoss</a></td><td><a class="el" href="classk_color_slider_widget_boss.html">kColorSliderWidgetBoss</a></td><td><a class="el" href="classk_color_slider_tracker_boss.html">kColorSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_gradient_slider_widget_boss.html">kGradientSliderWidgetBoss</a></td><td><a class="el" href="classk_gradient_slider_widget_boss.html">kGradientSliderWidgetBoss</a></td><td><a class="el" href="classk_gradient_slider_tracker_boss.html">kGradientSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_group_item_boss.html">kGroupItemBoss</a></td><td>kResizeToolBoss </td><td><a class="el" href="classk_text_b_box_resize_tracker_boss.html">kTextBBoxResizeTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_guide_item_boss.html">kGuideItemBoss</a></td><td>kMoveToolBoss </td><td><a class="el" href="classk_guide_move_tracker_boss.html">kGuideMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_horz_ruler_widget_boss.html">kHorzRulerWidgetBoss</a></td><td>kGuideToolImpl </td><td><a class="el" href="classk_guide_creation_tracker_boss.html">kGuideCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_horz_tab_ruler_boss.html">kHorzTabRulerBoss</a></td><td>kTabCreationToolImpl </td><td><a class="el" href="classk_tab_creation_tracker_boss.html">kTabCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_horz_tab_ruler_boss.html">kHorzTabRulerBoss</a></td><td>kTabMoveToolImpl </td><td><a class="el" href="classk_tab_move_tracker_boss.html">kTabMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_horz_text_doc_ruler_boss.html">kHorzTextDocRulerBoss</a></td><td>kTabCreationToolImpl </td><td><a class="el" href="classk_doc_ruler_tracker_boss.html">kDocRulerTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_lab_color_slider_widget_boss.html">kLabColorSliderWidgetBoss</a></td><td><a class="el" href="classk_lab_color_slider_widget_boss.html">kLabColorSliderWidgetBoss</a></td><td><a class="el" href="classk_lab_color_slider_tracker_boss.html">kLabColorSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_pencil_fidelity_slider_widget_boss.html">kPencilFidelitySliderWidgetBoss</a></td><td><a class="el" href="classk_pencil_fidelity_slider_widget_boss.html">kPencilFidelitySliderWidgetBoss</a></td><td><a class="el" href="classk_pencil_slider_tracker_boss.html">kPencilSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_pencil_smoothness_slider_widget_boss.html">kPencilSmoothnessSliderWidgetBoss</a></td><td><a class="el" href="classk_pencil_smoothness_slider_widget_boss.html">kPencilSmoothnessSliderWidgetBoss</a></td><td><a class="el" href="classk_pencil_slider_tracker_boss.html">kPencilSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_pencil_within_slider_widget_boss.html">kPencilWithinSliderWidgetBoss</a></td><td><a class="el" href="classk_pencil_within_slider_widget_boss.html">kPencilWithinSliderWidgetBoss</a></td><td><a class="el" href="classk_pencil_slider_tracker_boss.html">kPencilSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_raster_slider_cntrl_view_boss.html">kRasterSliderCntrlViewBoss</a></td><td><a class="el" href="classk_raster_slider_cntrl_view_boss.html">kRasterSliderCntrlViewBoss</a></td><td>kRasterSliderTrackerBoss </td></tr><tr><td><a class="el" href="classk_rgb_color_slider_widget_boss.html">kRgbColorSliderWidgetBoss</a></td><td><a class="el" href="classk_rgb_color_slider_widget_boss.html">kRgbColorSliderWidgetBoss</a></td><td><a class="el" href="classk_color_slider_tracker_boss.html">kColorSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_spectrum_widget_boss.html">kSpectrumWidgetBoss</a></td><td><a class="el" href="classk_spectrum_widget_boss.html">kSpectrumWidgetBoss</a></td><td><a class="el" href="classk_spectrum_tracker_boss.html">kSpectrumTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a></td><td><a class="el" href="classk_splitter_widget_boss.html">kSplitterWidgetBoss</a></td><td><a class="el" href="classk_splitter_tracker_boss_message.html">kSplitterTrackerBossMessage</a></td></tr><tr><td><a class="el" href="classk_structure_splitter_widget_boss.html">kStructureSplitterWidgetBoss</a></td><td><a class="el" href="classk_structure_splitter_widget_boss.html">kStructureSplitterWidgetBoss</a></td><td><a class="el" href="classk_xor_splitter_tracker_boss.html">kXorSplitterTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_threshold_slider_widget_boss.html">kThresholdSliderWidgetBoss</a></td><td><a class="el" href="classk_threshold_slider_widget_boss.html">kThresholdSliderWidgetBoss</a></td><td><a class="el" href="classk_threshold_slider_tracker_boss.html">kThresholdSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_tint_slider_widget_boss.html">kTintSliderWidgetBoss</a></td><td><a class="el" href="classk_tint_slider_widget_boss.html">kTintSliderWidgetBoss</a></td><td><a class="el" href="classk_color_slider_tracker_boss.html">kColorSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_tolerance_slider_widget_boss.html">kToleranceSliderWidgetBoss</a></td><td><a class="el" href="classk_tolerance_slider_widget_boss.html">kToleranceSliderWidgetBoss</a></td><td><a class="el" href="classk_threshold_slider_tracker_boss.html">kThresholdSliderTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_transparency_slider_cntrl_view_boss.html">kTransparencySliderCntrlViewBoss</a></td><td><a class="el" href="classk_transparency_slider_cntrl_view_boss.html">kTransparencySliderCntrlViewBoss</a></td><td>kXPSliderTrackerBoss </td></tr><tr><td><a class="el" href="classk_vector_slider_cntrl_view_boss.html">kVectorSliderCntrlViewBoss</a></td><td><a class="el" href="classk_vector_slider_cntrl_view_boss.html">kVectorSliderCntrlViewBoss</a></td><td>kVectorSliderTrackerBoss </td></tr><tr><td><a class="el" href="classk_vert_ruler_widget_boss.html">kVertRulerWidgetBoss</a></td><td>kGuideToolImpl </td><td><a class="el" href="classk_guide_creation_tracker_boss.html">kGuideCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_vert_tab_ruler_boss.html">kVertTabRulerBoss</a></td><td>kTabCreationToolImpl </td><td><a class="el" href="classk_tab_creation_tracker_boss.html">kTabCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_vert_tab_ruler_boss.html">kVertTabRulerBoss</a></td><td>kTabMoveToolImpl </td><td><a class="el" href="classk_tab_move_tracker_boss.html">kTabMoveTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_vert_text_doc_ruler_boss.html">kVertTextDocRulerBoss</a></td><td>kTabCreationToolImpl </td><td><a class="el" href="classk_doc_ruler_tracker_boss.html">kDocRulerTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_zero_point_widget_boss.html">kZeroPointWidgetBoss</a></td><td>kGuideToolImpl </td><td><a class="el" href="classk_guide_creation_tracker_boss.html">kGuideCreationTrackerBoss</a></td></tr><tr><td><a class="el" href="classk_zero_point_widget_boss.html">kZeroPointWidgetBoss</a></td><td>kZeroPointToolImpl </td><td><a class="el" href="classk_zero_point_tracker_boss.html">kZeroPointTrackerBoss</a></td></tr></table><h1><a class="anchor" id="id_incopy_getting_started"></a> InCopy: Getting Started</h1><p>This chapter introduces InCopy as a programming platform. Because the SDK is unified for InDesign and InCopy, information specific to InCopy is a relatively small portion of this document.<p>This chapter has the following objectives:<ul><li>Acquaint you with elements of the programming environment specific to InCopy.<li>Direct you to documentation that expands on topics mentioned briefly here.</ul><h2><a class="anchor" id="id_about_incopy"></a> About InCopy</h2><p>InCopy is a collaborative, text-editing application developed for integrated use with InDesign. InCopy enables you to track changes, add editorial notes, and fit copy tightly into the space designed for it. InCopy uses the same text-composition engine as InDesign, so InCopy fits copy within a layout with identical composition.<p>InCopy is for the editorial environment; it allows editorial workflow participants to collaborate on magazines, newspapers, and corporate publishing, enabling concurrent text and layout editing. Its users are editors, writers, proofreaders, copy editors, and copy processors.<p>InCopy shares many panels and palettes with InDesign but also provides its own user-interface items.<h3><a class="anchor" id="id_developing_for_incopy"></a> Developing for InCopy</h3><p>Previous releases of InCopy focused on large installations and were available for purchase only through system integrators, so system integrators were the primary group developing for InCopy. Several software developers also wrote plug-ins targeted for magazine and newspaper use.<p>With the current release, smaller developers have additional opportunities to write plug-ins targeted at magazines, newspapers, corporate publishing, and other collaborative users.<h2><a class="anchor" id=""></a></h2><p>This section looks at the SDK from an InCopy perspective. InDesign and InCopy share an SDK.<p>In the great majority of cases, when you write code in the InDesign source base, you also are writing code for InCopy. Statistically speaking, the programs are nearly identical; nevertheless, you will need to keep InCopy in mind when working with files, links, text and page items, as there are behaviors that can be broken easily.<p>InDesign, InDesign Server, and InCopy all run the same code. This means any specific behaviors must be implemented at run time, not at compile time. The only uniquely built portions of the program are the application shells for each version. All other plug-ins can be loaded into any of the applications, although a plug-in also has a resource in its class file that lists which variants should load it.<h3><a class="anchor" id="id_the_incopy_api"></a> The InCopy API</h3><p>Since InCopy does not support the entire InDesign API, it is important to know which APIs are available for use with InCopy. To determine whether a particular API is appropriate for InCopy, refer to the API Reference for boss classes; for each interface exposed by a given boss class, you can see in which application(s) the interface can be found.<h3><a class="anchor" id="id_compiler_settings"></a> Compiler settings</h3><p>Compiler settings do not differ between InDesign and InCopy plug-ins. For details on plug-in development environments, see the &quot;Development Environment&quot; section of Adobe InDesign Porting Guide.<h3><a class="anchor" id="id_resources"></a> Resources</h3><p>InCopy and InDesign plug-ins are compiled from the same code base; therefore, the information on whether a plug-in is intended for InDesign or InCopy is built into the PluginVersion resource found in a plug-in&#39;s.fr file, using the kInDesignProduct and kInCopyProduct identifiers. When both identifiers are used in the resource definition, the plug-in is intended for use in both InDesign and InCopy.<p>Additional feature-set IDs exist that may be applicable to your InCopy plug-in. For information on additional feature-set IDs, see <a class="el" href="_feature_sets_8h_source.html">FeatureSets.h</a>.<h2><a class="anchor" id="id_synchronization_of_design_and_architecture"></a> Synchronization of design and architecture</h2><p>Important areas of integration between InDesign and InCopy are described below:<ul><li>Extended InCopy file format - The InCopy file format supports persistent features from InDesign, like table headers and footers, as well as Japanese-specific features.<li>Assignment files - Users can group related document constituents (like headline, byline, copy, graphics, and captions) into meaningful elements that can be worked on as a group. InDesign and InCopy support the creation of such groupings. For details, see <a class="el" href="id_solutions.html#id_incopy_assignments">InCopy: Assignments</a>.<li>Auto undo/redo - The Auto undo/redo architecture in the core code makes implementing and maintaining commands much easier. This change affects change-tracking, notes and the story editor.<li>Scripting architecture - InCopy plug-ins use the scripting architecture.<li>Document actions - File actions between the two applications are consistent.<li>Symbol glyph-font resolution - The story editor uses a default display font to show text. Where a glyph is used that is not native to the default display font, another font capable of correctly displaying the glyph is searched for and used instead.<li>Unified text navigation - Text-navigation behavior within layout, story, and galley views is identical.</ul><h2><a class="anchor" id="id_file_relationships"></a> File relationships</h2><p>This section describes relationships between InDesign and InCopy files. These relationships are important because of the division of labor in a publication workflow that occurs when much of the same material is opened and modified in both applications.<p>There are two common scenarios for exporting from InCopy:<ul><li>You can export an (IDML-based) ICML file.<li>You can export an (INX-based) INCX file.</ul><p>There are two common scenarios for exporting from InDesign that involve InCopy in some way:<ul><li>Stories exported from InDesign as InCopy files are XML files or streams; the InCopyExport and InCopyWorkflow plug-ins loaded into InDesign provide this function. Some of the practical implications of this approach for InCopy files are that they are much smaller, they are faster over the network, they do not contain any page geometry, and data within the XML file or stream is available outside InDesign/InCopy (for search engines, database tools, etc.).<li>Groupings within an article (like a headline, byline, copy, graphics, and captions) also can be exported. InDesign and Incopy support the creation of groupings with assignment files, which handle file management by adding an additional file that tracks the other files. In essence, an assignment is a set of files whose contents are assigned to one person for some work to be done (for example, copy edit, layout, and/or writing). Any stories in an assignment are exported as InCopy files. Geometry information and the relationship of the files are held in the assignment file. InDesign allows the user to export a given set of stories by exporting into an assignment. InCopy opens all stories that are in an assignment together (as one unit). For details, see <a class="el" href="id_solutions.html#id_incopy_assignments">InCopy: Assignments</a>.</ul><h3><a class="anchor" id="id_stories"></a> Stories</h3><p>Each InCopy file represents one story. An InDesign document containing several stories can be modularized to the same number of InCopy documents, through export. Those exported InDesign stories contain a link, which may be viewed in the Links panel (InDesign) or the Story List palette as assignment files (InCopy).<p>InCopy does not maintain a link to the InDesign document it is associated with (if one exists). InDesign maintains any links with InCopy files as bi-directional links (<a class="el" href="classk_bidirectional_link_boss.html">kBidirectionalLinkBoss</a>).<p>Stories can be structured in XML. This means XML data can be contained within XML data. This feature can be used to design a data structure in which the raw text of a story is contained within an outer structure that contains data specific to InCopy (like styles).<p>Within InCopy, content can be saved in an ICML/INCX format or, if there is structure in the story, the logical structure can be exported in XML.<p>An ICML or INCX file can contain both InCopy data and marked-up text. If the file is exported as XML data, the data specific to InCopy is stripped out, leaving the marked-up content minus the information about how it is to be styled.<h3><a class="anchor" id="id_page_geometry"></a> Page geometry</h3><p>InCopy files do not contain page geometry. When geometry is needed, it must be obtained from the InDesign document. InCopy can open InDesign documents and extract design information and links to the exported stories where needed. When page geometry is desired from within InCopy, assignment files can be supplied with it.<h3><a class="anchor" id="id_metadata"></a> Metadata</h3><p>The Adobe Extensible Metadata Platform (XMP) provides a practical method for creating, interchanging, and managing metadata. InCopy files support XMP.<p>Just as InDesign provides the File &gt; File Info menu command to view XMP data, InCopy provides the File &gt; Story Info menu command. The ability for that data to be retained or stripped out during export is provided to systems integrators.<p>Metadata added to stories by third-party software developers is preserved when incorporated into InDesign documents. Added metadata can be viewed within InDesign from the File Info dialog box, available from the Links panel menu, as well as viewed within InCopy. Further, third-party software developers can add function to InDesign to view that metadata in a custom user interface.<p>An extensibility point exists for service providers to add metadata content to InCopy files. For further information on the metadata API, see <a class="el" href="_meta_data_i_d_8h_source.html">MetaDataID.h</a>. Also, the XMP SDK provides documentation, tools, and sample code to help you build support for XMP metadata.<h3><a class="anchor" id="id_the_document_model"></a> The document model</h3><p>InDesign documents are the basis for all content in InDesign. InCopy also uses InDesign documents, but they are not the default document type. Symbolic constants are used to identify document types: InDesign documents are identified with kInDesignFileTypeInfoID, whereas InCopy documents are identified with kInCopyFileTypeInfoID. There also is a constant that means &quot;this program&#39;s document,&quot; kPublicationFileTypeInfoID. There also is a corresponding template ID, kTemplateFileTypeInfoID.<p>In both InDesign and InCopy, the basic document always is a database based on <a class="el" href="class_i_document.html">IDocument</a>; in InCopy, however, this document may be an incomplete document. In InDesign, the main document typically is an opened InDesign file, but it also can be an opened INX or IDML file, which typically appears to be an unsaved InDesign document.<p>InCopy has a few other permutations. There is the basic InDesign file, as well as a new document with an InCopy story (or plain or RTF text) imported into it; this is known as a standalone document and can be identified by the <a class="el" href="class_i_stand_alone_doc.html">IStandAloneDoc</a> interface on the <a class="el" href="classk_doc_boss.html">kDocBoss</a>. Also, there are IDML- and INX-based assignment files, which has some part of an InDesign file stored in an XML file. The InDesign/InCopy document model corresponds to the base required model plug-in set, versioned against changes over time. It is important that all IDML/INX scripting work in both InDesign and InCopy, so documents can be moved with high fidelity between the applications.<h3><a class="anchor" id="id_user-interface_differences"></a> User-interface differences</h3><p>InDesign and InCopy share most of their panels, but InCopy has a smaller set and several additional toolbars along the top, left, and bottom screen borders. Most InCopy panels also can be docked on these bars, providing a smaller but always-visible view of the panel. Modifications made to these panels in InDesign also may need to modify their alternate view in InCopy. InCopy support for alternate panel layouts (kits) involves KitList resources.<p>InCopy also has a custom window layout with multiple views, in a main window with three tabs: Galley view, Story view, and Layout view. Layout view is the InDesign window view. Galley and story views are simply the story-editor view, with and without accurate line endings, respectively.<h3><a class="anchor" id="id_checking_the_feature_set"></a> Checking the feature set</h3><p>The most popular practice is checking for the proper feature set with the LocaleID utility. The most important thing to remember about this is that there are three products: InDesign, InDesign Server, and InCopy. As a result, you should almost never check for the InDesign feature set. Instead, check for InCopy or InDesignServer as needed: <div class="fragment"><div class="line">bool16 isInCopy = LocaleSetting::GetLocale().IsProductFS(kInCopyProductFS);</div><div class="line">bool16 isServer = LocaleSetting::GetLocale().IsProductFS(kInDesignServerProductFS);</div></div><p>To check a language feature set, for example, Japanese: <div class="fragment"><div class="line">bool16 isJapanese = LocaleSetting::GetLocale().IsLanguageFS(kJapaneseLanguageFS);</div></div><h2><a class="anchor" id="id_workflow"></a> Workflow</h2><p>The InCopy workflow interface is an extensibility layer available to all third-party software developers and system integrators. The major pieces of this workflow are the following:<ul><li>An internal interface (<a class="el" href="class_i_in_copy_workflow.html">IInCopyWorkflow</a>) that provides core functions and guarantees compatibility.<li>A set of three general action categories-Import, Export, and FileActions-that are supplied as plug-ins in source code form. These plug-ins are intended to be modified by software developers and system integrators to meet their own unique workflow needs.<li>InDesign (with InCopyBridge) and InCopy inline, editorial-notes features let you add comments, annotations, or notes directly to the text without affecting the flow of the story. The notes features are designed to be used in a workgroup environment, so the notes can be color-coded and turned on or off based on certain criteria. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_incopy_notes">InCopy: Notes</a>.<li>The InCopy Track Changes features give editors and writers the ability to track edits as a document moves through the writing and editing system. They need to be able to selectively track, show, hide, accept, and reject changes. For more information, see <a class="el" href="id_plug-in_programming_guide_volume_2_advanced_topics.html#id_track_changes">Track Changes</a>.<li>InCopyBridge plug-ins (InCopyBridge and InCopyBridgeUI) are supplied as out-of-the-box workflow solutions.</ul><h3><a class="anchor" id="id_design_and_architecture"></a> Design and architecture</h3><p><b>Story/file relationship</b><p>ICML is an IDML-based representation of an InCopy story. It represents the future direction of InDesign/InCopy and is an especially good choice if you need to edit a file outside of InDesign.<p><b>ICML format</b><p>Each InCopy file or stream is in XML. One of the advantages of this is that InCopy files can be parsed easily and opened by any text editor.<p><b>INCX format</b><p>INCX is an INX-based representation of an InCopy story. This format is not as readable as ICML, but it is still available to support INCX-based workflows.<p><b>Document operations</b><p>InCopy provides default implementations of document operations (file actions) like New, Save, Save As, Save A Copy, Open, Close, Revert, and Update Design. All these InCopy file actions are in one plug-in (InCopyFileActions) in source-code form that software developers or system integrators are expected to replace with their own implementations, to customize the interaction for their workflow system.<p><b>Using service providers for document interchange</b><p>InCopy uses the service-provider architecture for import and export. The InCopy Import and Export provider plug-ins function in both InDesign and InCopy applications. It is expected that system integrators will replace these default service providers with their own, to customize the interaction for their workflow system.<ul><li>From InDesign, InCopy import provider - With the appropriate InCopy plug-ins installed into InDesign, the user can place an InCopy document into the InDesign document. The Place mechanism is the same as for any other kind of text file.<li>From InDesign, InCopy export provider - With the appropriate InCopy plug-ins installed into InDesign, the user can export a story to an InCopy document by choosing the Export menu item and selecting the InCopy file format. Behind the scenes, this export process creates a link pointing to the resulting InCopy file and associates the li<li>nk with the story. The InCopy document does not have any geometry information associated with it.<li>From InCopy, InCopy import provider - The Place mechanism is the same as for any other kind of text file.<li>From InCopy, InCopy export provider - The user can export a story to PDF or one of several text documents, by choosing the Export menu item and selecting the desired file format.</ul><p><b>Using XMP metadata</b><p>The user can enter and edit metadata by choosing File &gt; Story Info. Panels are supplied for General, Keywords, and Summary data. This metadata is saved in the InCopy file. Software developers and system integrators can create and store their own metadata using the XMP SDK.<p><b>Locked page items</b><p>One of the most common problems is making changes to locked page items. All page items have an <a class="el" href="class_i_item_lock_data.html">IItemLockData</a> interface on them, and this interface controls whether the page item is locked. Stories and images that are managed (i.e., exported to InCopy) get locked, so unintended changes cannot be made. All tools in InDesign need to check and respect this interface, as there is no magical bottleneck that can prevent changes from occurring. Always check this interface before making changes to page items.<p>There are two properties of <a class="el" href="class_i_item_lock_data.html">IItemLockData</a>, InsertLock and AttributeLock. Only InsertLock is used, for both content and attribute changes. The rule is simple: if InsertLock is set, you cannot make any changes to the contents of the frame.<p><b>Plug-in availability</b><p>InCopy has all InDesign model plug-ins but a substantially different set of user-interface plug-ins. It is essential that you check for nil on any interfaces that may not be present in one or more products. The most notorious interfaces that go missing in these cases are utility interfaces provided by plug-ins that are not required. It is almost never safe to assume an interface will be available, although plug-in dependencies can be specified that prevent your plug-in from loading if a requisite plug-in is unavailable. Because interfaces can move between plug-ins between versions, however, it is best to always check for nil.<h2><a class="anchor" id="id_incopybridge_plug-in"></a> InCopyBridge plug-in</h2><p>The InCopyBridge plug-in is intended for small publishing workgroups-like corporate publishing, a newspaper, or a magazine-with an editorial and production staff of 2&acirc;&#128;&#147;10 people.<p>The InCopyBridge plug-in enables the user to manage InCopy files through a regular file system. This is done by writing out lock files. When a lock file exists for an InCopy file, the InCopy file is locked, so no other user can check it out. When the user submits changes, the lock file goes away, and the InCopy file is available for someone else to check out. The lock file holds the name of the user currently using the file, as well as the application; this way, when people users try to edit a locked file, they are told who has it checked out. This works for both InDesign and InCopy.<p>The InCopyBridge plug-ins provide a ready-to-use alternative to the InCopyFileActions plug-in, which is supplied as source code in the SDK. These two plug-ins (InCopyBridge and InCopyBridgeUI) are supplied as out-of-the-box workflow solutions. The older InCopyFileActions plug-in continues to be supplied as a foundation for third-party solutions.<p>The InCopyBridge plug-ins provide a file-based system for preventing simultaneous editing of InCopy stories by multiple InCopy and InDesign users that is based on a shared file-system (file-server) workflow. InCopyBridge is designed for explicitly checking in and out InCopy stories. This user model restricts access to InCopy stories that are being edited by other users.<dl class="section note"><dt>Note<dd>This user model is different from the workflow user model, which offers implicit check-out and explicit check-in and in which the user is warned of conflicts during check-out. The user can make changes, and changes are resolved on synchronize or save operations.</dl><h3><a class="anchor" id="id_incopybridge"></a> InCopyBridge</h3><p>This plug-in provides the core function but no user interface. This plug-in can run in an environment without any user interface, such as an InDesign server process. This plug-in also provides code for scripting and testing InCopyBridge core function.<h3><a class="anchor" id="id_incopybridgeui"></a> InCopyBridgeUI</h3><p>This plug-in provides the user interface for InCopyBridge. InCopyBridgeUI implements warning dialog boxes for handling check-in and check-out conflicts. InCopy adds Bridge menu items to its File menu and Story list, whereas InDesign adds them to its Edit menu and the Links panel. While the InCopyBridge plug-in has implications for many menu items, the menu items most involved with the InCopyBridge plug-in are the following:<ul><li>Edit Story In InDesign - Checks out a linked InCopy story, locking it for use by the current InDesign user. If the InCopy story changed since the InDesign version was updated, an alert appears, prompting the user for action.<li>Submit Story - Saves the latest changes in the current story to its storage location on disk and makes them available for others to check out and edit. Releases editing control of the checked-out story.<li>Submit All Stories - Saves the latest changes to all checked-out stories to their respective locations on disk and makes them available for others to check out and edit. Releases editing control of all checked-out stories.<li>Revert Story Changes - Discards changes made since the last time the user used the Save Story or Save command, and restores the content from the storage location on disk.<li>User - Displays the User dialog box for entering a name by which InCopyBridge processes identify who has control of a document at a given time. Invoking an InCopyBridge-related action without having entered a user name brings up a prompt asking for this information.</ul><h1><a class="anchor" id="id_incopy_notes"></a> InCopy: Notes</h1><p>This chapter describes the inline, editorial notes features of InDesign and InCopy for software developers.<p>The chapter has the following objectives:<ul><li>Describe the notes environment.<li>Describe the capabilities of notes.<li>Show the data model for notes.<li>Describe the essential API for notes.<li>Provide use cases in Working with notes.</ul><h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>With the InDesign and InCopy inline, editorial notes features, you can add comments and annotations as notes directly to text without affecting the flow of a story. Notes features are designed to be used in a workgroup environment, so the notes can be color coded or turned on or off based on certain criteria.<h2><a class="anchor" id="id_capabilities"></a> Capabilities</h2><h3><a class="anchor" id="id_adding_a_note"></a> Adding a note</h3><p>You can add notes to a story using the Note tool in the toolbox, the Notes &gt; New Note command, or the New Note icon on the Notes palette. You also can create a note from an existing story, by converting or copying the text into a new note. In galley or story view, type your note between the note bookends. In layout view, type your note in the Notes palette.<h3><a class="anchor" id="id_converting_text_to_a_note"></a> Converting text to a note</h3><p>The Convert To Note command converts the selected text to a note; a new note is created, and selected text is removed and copied into the new note. In galley and story views, the container of the new note is expanded, and the text focus is at the beginning of the new note. The note contents appear in the Notes palette. The note anchor is located where the end of the text selection range was before the Convert To Note operation.<h3><a class="anchor" id="id_converting_a_note_to_text"></a> Converting a note to text</h3><p>The Convert To Text command converts the selected note or selected text in a note container into regular text. Depending on the selection of the note, this command removes the selected text from the note and pastes the text into the document text in the location where the insertion point was before the Convert To Text operation. If the entire note is selected or the insertion point is inside the note container with no text selected, the entire note contents are converted to text. If only part of the content of a note is selected, only the selection is converted, while the remaining content stays in the note-or in two notes, if the selection does not include the beginning or end of the note content. The following figure shows the case in which the selection is in the middle of the note content, resulting in two notes after conversion. <div class="image"><img alt="plugin-programming-guide-vol2-100.gif" src="plugin-programming-guide-vol2-100.gif" /></div><h3><a class="anchor" id="id_navigating_among_notes"></a> Navigating among notes</h3><p>The Next Note and Previous Note commands enable navigation among notes. These commands select the next or previous note anchor in the text flow. If the current note is the final or first note in the text, the first or last note is selected, respectively.<h3><a class="anchor" id="id_splitting_a_note"></a> Splitting a note</h3><p>The Split Note command breaks a note into two notes at the insertion point. After a note is split, the insertion point moves to the story text, between the two notes produced by the split.<h3><a class="anchor" id="id_deleting_a_note"></a> Deleting a note</h3><p>The Delete Note command deletes the selected note. The command is available if a note anchor is selected, the current insertion point is within an inline note, or the current insertion point is within the text editing area of the Notes palette. The Remove Notes From Story command deletes all notes from the current story, whereas the Remove All Notes command deletes all notes from the document.<h3><a class="anchor" id="id_expanding_and_collapsing_notes"></a> Expanding and collapsing notes</h3><p>The Expand Note or Collapse Note command expands or collapses the selected note. Only one of these commands is visible at a time, depending on the state of the selected note. Alternately, in story or galley view, click on a note&#39;s bookend icon to expand or collapse the note. You can expand all collapsed inline notes in the current document with the Expand All Notes command. You can collapse all inline notes in the current document with the Collapse All Notes command.<p>The View &gt; Hide Notes and View &gt; Show Notes commands hide and show notes. Which of these commands is available depends on the current state of the notes.<h3><a class="anchor" id="id_setting_notes_preferences"></a> Setting notes preferences</h3><p>You can customize the appearance and behavior of notes using the Preferences settings, by choosing Edit &gt; Preferences &gt; Notes (Windows) or InCopy &gt; Preferences &gt; Notes (Mac OS).<h2><a class="anchor" id="id_data_model_for_notes"></a> Data model for notes</h2><h3><a class="anchor" id="id_how_notes_are_connected_to_text"></a> How notes are connected to text</h3><p>When a note is added, through either the menu or the Notes palette, <a class="el" href="class_i_note_suite.html#afc62ea4ba0856e06a4a6a376fd787412">INoteSuite::DoAddNote</a> is called. You can add a note only when the text tool is active but no text is selected; that is, when there is a blinking insertion point somewhere in the story. If a range of text is selected, you can convert the text to a note. The DoAddNote method first checks the <a class="el" href="class_i_note_settings.html">INoteSettings</a> on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, to determine the note&#39;s global visibility state. If the note is hidden, the <a class="el" href="classk_set_hide_note_state_cmd_boss.html">kSetHideNoteStateCmdBoss</a> is used to turn on the note&#39;s visibility. Next, <a class="el" href="class_i_note_data_utils.html#ae40e4ba2fd18d881102d7ca3b4de123d">INoteDataUtils::NewNote</a> is used to make the new note by processing a <a class="el" href="classk_create_note_cmd_boss.html">kCreateNoteCmdBoss</a> command.<p>Although the note seems to be embedded in the text, it actually is maintained in the text system as an owned item. A special anchor character (kTextChar_ZeroSpaceNoBreak) is inserted in the primary story thread of the text model, at the position where the note is to be placed. Then, an instance of <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> is instantiated to hold the note data; this object is anchored in the text model by associating the owned-item strand of the text model with the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> object. This is done by the <a class="el" href="classk_create_note_cmd_boss.html">kCreateNoteCmdBoss</a>, which sets the class of the owned-item strand at the offset to <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> with the UID of the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> object. In the primary story thread, the note is represented by the special character kTextChar_ZeroSpaceNoBreak. The real note text is stored in a separate story thread. <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> implements <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a> and <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>, to maintain its story thread. For more information on the story thread dictionaries, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_text_fundamentals">Text Fundamentals</a>. The <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> object&#39;s <a class="el" href="class_i_note_data.html">INoteData</a> holds information like note author and note creation time. It is important to understand that <a class="el" href="class_i_note_data.html">INoteData</a> does not contain the note&#39;s text content; the note content is held by a separate story thread, accessible through the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> object&#39;s <a class="el" href="class_i_text_story_thread_dict.html">ITextStoryThreadDict</a> interface.<p>Relationship between a note and its parent story: <div class="image"><img alt="plugin-programming-guide-vol2-101.gif" src="plugin-programming-guide-vol2-101.gif" /></div><p>Using the SnippetRunner InspectTextModel snippet, we can inspect how the story threads are changed when a note is being added. Assume you have a text story with the text &quot;abc.&quot; There are three characters, plus the carriage return at the end, so the primary story thread&#39;s character count is four, as shown in the following figure.<p>Text story containing only regular text: <div class="image"><img alt="plugin-programming-guide-vol2-102.gif" src="plugin-programming-guide-vol2-102.gif" /></div><p>If you insert an empty note at the beginning, InDesign adds an owned-item strand to the text model, and this strand is represented by kTextChar_ZeroSpaceNoBreak (0xfeff). Also, a story thread is created to represent the note&#39;s content. When there is no initial text in the note, the thread is initialized to kTextChar_CR, which makes the note&#39;s story thread length 1. Thus, the text model&#39;s length is increased to 6 from the original 4, because of the added kTextChar_ZeroSpaceNoBreak for the owned item and kTextChar_CR for the note&#39;s initial data. In the output of InspectTextModel, the carriage return is not reported; but if you read <a class="el" href="class_i_text_story_thread.html">ITextStoryThread</a>[0], its length is reported as 5, which is equal to the PrimaryStoryThreadSpan. TextIndex 4 is for the carriage return. The following figure illustrates the text model when an empty note is inserted into a story. <div class="image"><img alt="plugin-programming-guide-vol2-103.gif" src="plugin-programming-guide-vol2-103.gif" /></div><p>If you type something into the note-for example, type &quot;d&quot; in the note, so you see &quot;&lt;d&gt; abc&quot;-you can see the text model has seven characters, which is one character more than the version with empty note. Note, however, that the primary story thread looks the same as before. The new text is added into the thread that represents the note&#39;s text, which now has a length of 2 (for the &quot;d&quot; character plus the default carriage-return character). See the following figure.<p>Text story with a one-character note: <div class="image"><img alt="plugin-programming-guide-vol2-104.gif" src="plugin-programming-guide-vol2-104.gif" /></div><h3><a class="anchor" id="id_notes_suite_and_utilities"></a> Notes suite and utilities</h3><p>Much of the capability required for client code to work with notes is provided in a high-level suite interface, <a class="el" href="class_i_note_suite.html">INoteSuite</a> (with the ID IID_INOTESUITE interface), which is available through a reference to a selection (<a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>). This interface is described in detail in INoteSuite.<p>This interface encapsulates the details of interacting with the note model and hides details about the selection format that is active, providing a capability-driven API that can be used to do things like add, delete, and convert notes.<p>Most of the note suite methods do not interact directly with model; instead, a few utility classes were added to <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>. These utilities are used in most of the suite implementations. We highly recommend you use the suite functions when possible. If the suite does not meet your needs, look into the utilities before using a command directly.<p>See the following figure for an overview of notes utility classes. <div class="image"><img alt="plugin-programming-guide-vol2-105.gif" src="plugin-programming-guide-vol2-105.gif" /></div><h3><a class="anchor" id="id_notes_preferences"></a> Notes preferences</h3><p>An <a class="el" href="class_i_note_pref.html">INotePref</a> interface (with the ID IID_INOTEPREFERENCE interface) is added to the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. This interface is responsible for maintaining note settings in the Preferences panel, like note color. To access this interface, do the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;INotePref&gt;</a> notePref ((<a class="code" href="class_i_note_pref.html">INotePref</a>*)::QuerySessionPreferences(IID_INOTEPREFERENCES));</div><div class="line"><span class="keywordflow">if</span> (notePref != nil){ <span class="comment">// Do something with the preference.}</span></div></div><p>There also is an <a class="el" href="class_i_note_settings.html">INoteSettings</a> interface (with the ID IID_INOTESETTINGS interface) added to <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. This interface&#39;s sole responsibility is to maintain the visibility state of the note. Users typically show and hide notes with the View &gt; Show Notes and View &gt; Hide Notes menu commands. To access this interface, do the following: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> sessionWorkSpace(GetExecutionContextSession()-&gt;QueryWorkspace());<a class="code" href="class_interface_ptr.html">InterfacePtr&lt;INoteSettings&gt;</a> noteSettings(sessionWorkSpace, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><h3><a class="anchor" id="id_end-user_requirements"></a> End-user requirements</h3><p>Unlike in Acrobat or Photoshop-in which sticky notes float on top of document content- each InDesign/InCopy note is anchored to a specific location in the text. This is necessary because notes are intended to be used as annotations to text, rather than to a layout element or the document as a whole. Notes can be created using the Note tool in the toolbox, the Notes &gt; New Note command, or the New Note icon on the Notes palette.<p>The following figure shows most of the user interface related to notes. The notes features are context-sensitive; an action is available to the end user only when the context is appropriate for that action. Some of the menu items in the figure are disabled, because their function does not apply at the current location of the text-insertion point. <div class="image"><img alt="plugin-programming-guide-vol2-106.gif" src="plugin-programming-guide-vol2-106.gif" /></div><p><b>Note anchors</b><p>Each notes is associated with a specific location in the text, indicated by a note-anchor icon. The preceding figure shows examples of note anchors in different states. Content is visible only within a note container:<ul><li>In layout view, the container for note content is the Notes palette.<li>In story and galley views, the container for note content is an inline note container within the document text, between the two bookend icons that make up the note-anchor icon. In story and galley views, note content also can be seen in the Notes palette.</ul><p>The content of a note is the same, regardless of the note container or view used. Anchors can be placed anywhere within text in layout or galley view, including the beginning or end of a word, within a word, and between a word and a punctuation mark; however, only one note anchor can occupy a single location within text. Users can create notes only in the text flow. If the user moves the Note tool pointer over an area that does not contain an open story, the pointer changes to the No Drop pointer, and clicking does not create a new note.<p>Note anchors perform multiple functions:<ul><li>Note anchors indicate the location of the note. When the text reflows, the anchor moves as part of the text.<li>Note anchors offer a clickable screen element, so the user can open, move, edit, or delete the note or its contents.</ul><p>In galley or story view, each inline note icon has an anchor icon consisting of a start-note bookend icon and an end-note bookend icon. When the note is expanded, the content of the note appears between these bookends. New inline notes have a thin, empty, inline note container, with an insertion point ready for note-text entry. When the user begins typing the note text, the bookend icons move apart to accommodate the added text.<p><b>Editing text containing note anchors</b><p>The note anchor is an access point for opening and editing notes. Selected note anchors can be cut, copied, deleted, and moved by dragging. Selecting text also selects all note anchors within that text. Cutting, copying, or pasting text cuts, copies, or pastes all note anchors in the selected text, with the following exceptions:<ul><li>No note anchors can be created or placed within other notes.<li>If text containing note anchors is pasted into a note, only the selected surrounding text is copied to the note, not the anchors or note contents.</ul><p>When text containing a note anchor is deleted, cut, copied, or pasted, whatever happens to the enclosing text happens to the note whose anchor is contained within. This includes notes that are hidden.<p>Although note content always is drawn in plain text (that is, with no styles, color, size, or other text-formatting attributes shown), any text copied or pasted to a note retains all formatting information it had, even though that formatting is not shown when the text is part of a note. Text with formatting may be copied and pasted to a note, and at a later time that text may be copied and pasted to note text; when the text is placed as regular (nonnote) text, any formatting information it contains is rendered (shown) once again.<h2><a class="anchor" id="id_essential_apis"></a> Essential APIs</h2><h3><a class="anchor" id="id_inotesuite"></a> INoteSuite</h3><p>The <a class="el" href="class_i_note_suite.html">INoteSuite</a> suite interface is a key API for manipulating notes in client code. Most of a note&#39;s user-interface functions are provided through this interface. This interface provides much of the required capability for plug-ins.<p>The <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is aggregated on the integrator-suite boss class (<a class="el" href="classk_integrator_suite_boss.html">kIntegratorSuiteBoss</a>), which makes this interface available through the abstract selection. Implementations of this interface are provided on various concrete-selection boss classes, like <a class="el" href="classk_galley_text_suite_boss.html">kGalleyTextSuiteBoss</a> and <a class="el" href="classk_note_text_suite_boss.html">kNoteTextSuiteBoss</a>, which are hidden from client code through the facade of the abstract selection. To obtain <a class="el" href="class_i_note_suite.html">INoteSuite</a>, client code should query the selection manager (<a class="el" href="class_i_selection_manager.html">ISelectionManager</a>) for the interface, as shown below: <div class="fragment"><div class="line"><span class="comment">// Many functions are passed in an IActiveContext as a parameter.</span></div><div class="line"><span class="comment">// It should be used whenever possible.InterfacePtr&lt;IActiveContext&gt; </span></div><div class="line"> activeContext(GetExecutionContextSession()-&gt;GetActiveContext(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (!activeContext) </div><div class="line"><span class="keywordflow">return</span>;<a class="code" href="class_i_selection_manager.html">ISelectionManager</a> *selectionManager = activeContext-&gt;GetContextSelection();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;INoteSuite&gt;</a> noteSuite(selectionManager, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>Generally speaking, the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is active when the text-insertion point is active in the layout, story, galley, or Notes palette editing area. The suite interfaces typically use this pattern of checking for a service or capability and, if the abstract selection supports this capability, the method can be called. For example, the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface exposes a method that allows you to delete a selected note. To use this method, do the following: <div class="fragment"><div class="line">bool16 canDeleteNote = iNoteSuite-&gt;CanDeleteNote(ac-&gt;GetContextView(), docView);</div><div class="line"><span class="keywordflow">if</span>(canDeleteNote ) {</div><div class="line"> iNoteSuite-&gt;DeleteNote(ac-&gt;GetContextView(), docView);}</div></div><p>The following table lists <a class="el" href="class_i_note_suite.html">INoteSuite</a> methods.<table class="doxtable"><tr><th>CanDoSomething method </th><th>DoSomething method </th></tr><tr><td>CanAddNote </td><td>DoAddNote </td></tr><tr><td>CanConvertToNote </td><td>DoConvertToNote </td></tr><tr><td>CanOpenNote </td><td>DoOpenNote </td></tr><tr><td>CanDeleteNote </td><td>DoDeleteNote </td></tr><tr><td>CanConvertToText </td><td>DoConvertToText </td></tr><tr><td>CanScrollToNote </td><td>DoScrollToNote </td></tr><tr><td>CanNavigateNote </td><td>DoNavigateNote </td></tr><tr><td>CanRemoveAllNotes </td><td>DoRemoveAllNotes </td></tr><tr><td>CanRemoveStoryNotes </td><td>DoRemoveStoryNotes </td></tr><tr><td>CanSplitNote </td><td>DoSplitNote </td></tr><tr><td>CanShowHideNote </td><td>DoShowHideNote </td></tr><tr><td>CanExpandAllNotes </td><td>DoExpandAllNotes </td></tr><tr><td>CanCollapseAllNotes </td><td>DoCollapseAllNotes </td></tr></table><h3><a class="anchor" id="id_knotedataboss"></a> kNoteDataBoss</h3><p><a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> is anchored as an owned item in the text story. The following code snippet shows one way to get the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> from the story: <div class="fragment"><div class="line"><span class="comment">// Find notes in current storyRef.InterfacePtr&lt;ITextModel&gt; textModel(storyRef, UseDefaultIID());</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IItemStrand&gt;</a> itemStrand((<a class="code" href="class_i_item_strand.html">IItemStrand</a>*)textModel -&gt;QueryStrand(<a class="code" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>, IID_IITEMSTRAND));</div><div class="line">int32 mainStoryLength =textModel-&gt;GetPrimaryStoryThreadSpan() - 1;</div><div class="line"><span class="comment">// Collect owned item from the story.</span></div><div class="line">Text::CollectOwnedItems(textModel, 0, mainStoryLength, &amp;ownedItemList);</div><div class="line"><span class="keywordflow">if</span> (ownedItemList.Length() &gt; 0){</div><div class="line"><span class="comment">// Remove non-note items.</span></div><div class="line"><span class="keywordflow">for</span> (i = ownedItemList.Length()-1; i&gt;=0; i--)</div><div class="line"> {</div><div class="line"><span class="keywordflow">if</span> (!<a class="code" href="class_utils.html">Utils&lt;INoteDataUtils&gt;</a>()-&gt;IsNoteOwnedItem(ownedItemList[i].fClassID))</div><div class="line"> ownedItemList.Remove(i);</div><div class="line"> }</div><div class="line">}</div></div><p>See the following figure for the key interfaces of <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>. <div class="image"><img alt="plugin-programming-guide-vol2-107.gif" src="plugin-programming-guide-vol2-107.gif" /></div><h2><a class="anchor" id="id_useful_commands_and_associated_notification_protocols"></a> Useful commands and associated notification protocols</h2><p>This section summarizes some of the most common commands related to notes, the critical data interfaces that users of the commands must supply, and the notification protocols associated with the commands so an observer who wants to observe certain commands can know what protocols to listen to.<h3><a class="anchor" id="id_kcollapsestatecmdboss"></a> kCollapseStateCmdBoss</h3><p><b>Description</b><p>Sets the <a class="el" href="class_i_note_data.html">INoteData</a> collapsed state according to the command&#39;s <a class="el" href="class_i_bool_data.html">IBoolData</a>. Used to expand (open) or collapse (close) a note.<p><b>Item list</b><p>The UID of the text story that contains the note to be expanded or collapsed.<p><b>Data interface</b><ul><li><a class="el" href="class_i_bool_data.html">IBoolData</a> - Whether the note should be collapsed (true for collapsed, false for expanded).<li><a class="el" href="class_i_int_data.html">IIntData</a> - The TextIndex at which the note of interest is anchored in the text story.</ul><p><b>Notification</b><ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the IID_INOTEDATA protocol.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the IID_COLLAPSESTATE_DOCUMENT protocol.</ul><h3><a class="anchor" id="id_kcreatenotecmdboss"></a> kCreateNoteCmdBoss</h3><p><b>Description</b><p>Creates a new note in a text story at the location specified by a text index.<p><b>Item list</b><p>The UID of the text story that contains the note to be created.<p><b>Data interface</b><ul><li><a class="el" href="class_i_int_data.html">IIntData</a> - The TextIndex where the new note is to be created. A note is not allowed in another note, so make sure the index is not in an existing note&#39;s story range.<li><a class="el" href="class_i_create_note_cmd_data.html">ICreateNoteCmdData</a> - This data interface is optional. You can set note class using SetNoteClass to <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>. Set the note content&#39;s range using SetNoteContentRange(createAt, createAt), if the note is to be initialized to an empty note; createAt is the TextIndex where the new note anchor will be. You also shou<li>ld use the Set method to set the author and collapsed state. You do not need to set the marker range, because it is for an unsupported feature.</ul><p><b>Notification</b><ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the IID_INOTEDATA protocol.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the IID_INOTEDATA protocol.</ul><h3><a class="anchor" id="id_kconverttonotecmdboss"></a> kConvertToNoteCmdBoss</h3><p><b>Description</b><p>Converts a range of text into a note.<p><b>Item list</b><p>The UID of the text story that contains the text to be converted.<p><b>Data interface</b><p>Data should be set up as for <a class="el" href="classk_create_note_cmd_boss.html">kCreateNoteCmdBoss</a>:<ul><li><a class="el" href="class_i_int_data.html">IIntData</a> - The start text index of the text range to be converted.<li><a class="el" href="class_i_create_note_cmd_data.html">ICreateNoteCmdData</a> - The note&#39;s content range should be set from the start index to the end index of the text to be converted, using the SetNoteContentRange method.</ul><p><b>Notification</b><ul><li>Notify <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the IID_INOTEDATA protocol. When the notification is broadcast, the command boss&#39;s <a class="el" href="class_i_int_data.html">IIntData</a> is set to the note&#39;s content-range start index.<li>Notify <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the IID_INOTEDATA protocol.</ul><h3><a class="anchor" id="id_kconvertnotetotextcmdboss"></a> kConvertNoteToTextCmdBoss</h3><p><b>Description</b><p>Converts a whole note or part of the note content into regular text. When the note content to be converted is between another note text in the same note, the portion of the note that is not converted is split into two notes, one on each side of the converted text.<p><b>Item list</b><p>The command needs two items: the UID of the story that contains the note to be converted, and the UID of the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> of the note to be converted. When the text focus is in the note-content area, <a class="el" href="class_i_text_model.html#a29b08bfc8e97ee9024bbc6e672d06c45">ITextModel::QueryStoryThread</a> can be used to find out the note&#39;s story thread, from which you can get to the corresponding <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>. When the text focus is on the anchor, use <a class="el" href="class_i_note_utils.html#abf2ed1e5f887d9e9e5891b48917f9522">INoteUtils::QueryNoteData</a> to get to the <a class="el" href="class_i_note_data.html">INoteData</a>, from which you can reach the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>.<p><b>Data interface</b><ul><li><a class="el" href="class_i_int_data.html">IIntData</a> with interface ID IID_ISTARTFOCUSINTDATA - The start-text index of the range of note content to be converted to text. This range should be in the note&#39;s story thread. If the range is in the note&#39;s anchor range, you should find out the text range that covers the note content.<li><a class="el" href="class_i_int_data.html">IIntData</a> with interface ID IID_IENDFOCUSINTDATA - The end-text index of the range of note content to be converted to text. This range should be in the note&#39;s story thread. If the range is in the note&#39;s anchor range, you should find out the text range that covers the real note content.<li><a class="el" href="class_i_bool_data.html">IBoolData</a> - Was used to restore text focus in an undo operation prior to CS4. With automatic undo, this has no effect.<li><a class="el" href="class_i_convert_note_to_text_cmd_data.html">IConvertNoteToTextCmdData</a> - Required to suspend galley drawing while converting to text. Pass in the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the IControlView* returned by <a class="el" href="class_i_note_suite_utils.html#a970b74b1dff1b371b8390771d9c7ffab">INoteSuiteUtils::GetDocControlView</a>.</ul><p><b>Notification</b><p>Generally, the broadcast is based on how the note is converted.<p>If the entire note is converted:<ul><li>Notify the <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the kNoteRemovedMsg message along with the IID_ICONVERTNOTETOTEXTCMD protocol.</ul><p>If the note is spit into two notes after the conversion:<ul><li>Notify the <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the kConvertNoteToTextMsg message along with the IID_ICONVERTNOTETOTEXTCMD protocol.<li>Notify the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the kConvertNoteToTextMsg message along with the IID_ICONVERTNOTETOTEXTCMD protocol.</ul><p>If the converted text is to the left or right of the original note:<ul><li>Notify the <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the kMoveNoteToTextMsg message along with the IID_ICONVERTNOTETOTEXTCMD protocol.<li>Notify the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the kMoveNoteToTextMsg message along with the IID_ICONVERTNOTETOTEXTCMD protocol.</ul><h3><a class="anchor" id="id_ksplitnotecmdboss"></a> kSplitNoteCmdBoss</h3><p><b>Description</b><p>Splits a note into two notes at the text-index location specified by the data interface.<p><b>Item list</b><p>The command needs two items: the UID of the story that contains the note to be split, and the UID of the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> of the note to be split. This is similar to the <a class="el" href="classk_convert_note_to_text_cmd_boss.html">kConvertNoteToTextCmdBoss</a>. For more details on how to get to the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> from a text location, see kNoteDataBoss.<p><b>Data interface</b><ul><li><a class="el" href="class_i_int_data.html">IIntData</a> with interface ID IID_ISTARTFOCUSINTDATA-The text index of the location where you want to split the note. The index should be in the note&#39;s story thread.<li><a class="el" href="class_i_convert_note_to_text_cmd_data.html">IConvertNoteToTextCmdData</a> - Required to suspend galley drawing while converting to text. Pass in the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the IControlView* returned by <a class="el" href="class_i_note_suite_utils.html#a970b74b1dff1b371b8390771d9c7ffab">INoteSuiteUtils::GetDocControlView</a>.</ul><p><b>Notification</b><ul><li>Notify the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> with the kSplitNoteMsg message along with the IID_ISPLITNOTECMD protocol.<li>Notify the <a class="el" href="classk_doc_boss.html">kDocBoss</a> with the kSplitNoteMsg message along with the IID_ISPLITNOTECMD protocol.</ul><h3><a class="anchor" id="id_knoteprefcmdboss"></a> kNotePrefCmdBoss</h3><p><b>Description</b><p>Modifies the notes preference as seen in the application&#39;s Notes Preferences panel.<p><b>Item list</b><p>The item needed is the application&#39;s workspace UID.<p><b>Data interface</b><p>INotePrefCmdData- Use its Set method to set the preference.<p><b>Notification</b><p>Notify the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> with the IID_INOTEPREFERENCES protocol.<h2><a class="anchor" id="id_working_with_notes"></a> Working with notes</h2><h3><a class="anchor" id="id_adding_a_note_at_the_current_insertion-point_position"></a> Adding a note at the current insertion-point position</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#afc62ea4ba0856e06a4a6a376fd787412">INoteSuite::DoAddNote</a> to add a new note. For an example, see the <a class="el" href="class_snp_perform_note_function.html">SnpPerformNoteFunction</a> snippet.<p>When the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, first process a <a class="el" href="classk_set_hide_note_state_cmd_boss.html">kSetHideNoteStateCmdBoss</a> command, to make sure the note&#39;s visibility is on. Next, use <a class="el" href="classk_create_note_cmd_boss.html">kCreateNoteCmdBoss</a> to create the note. A note is not allowed inside another note, but a note is allowed in deleted text (you can use <a class="el" href="class_i_track_change_utils.html#abc67ea72c8fc3c85a11d2615bc825d45">ITrackChangeUtils::DeletedTextToPrimaryIndex</a> to check if it is in deleted text), so you should make sure the text index for the note anchor is in either the primary story thread span or deleted text but not in an existing note&#39;s story thread range.<h3><a class="anchor" id="id_inserting_text_into_a_note"></a> Inserting text into a note</h3><p>Use <a class="el" href="class_i_text_model_cmds.html#a2e037f97b81a2fa59150fed490b38a5e">ITextModelCmds::InsertCmd</a> to insert text into note. This is just like a regular text insertion operation. For an example, see the <a class="el" href="class_snp_perform_note_function.html">SnpPerformNoteFunction</a> snippet.<h3><a class="anchor" id="id_converting_text_to_a_new_note"></a> Converting text to a new note</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#a33d676803e8b301ec87241ddf038f2ac">INoteSuite::DoConvertToNote</a> to convert selected text to a note. For an example, see the <a class="el" href="class_snp_perform_note_function.html">SnpPerformNoteFunction</a> snippet.<p>When the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, check whether the text for conversion contains any XML tags. Normally, if there is a tag in the text range, you should abort the operation. Use <a class="el" href="class_i_note_suite_utils.html#aa13e0f9580ed3df1d04803a4cecb08a9">INoteSuiteUtils::CheckRemoveXML</a> to check for XML tags. If a tag is found in the selected text, this method causes an alert to pop up, asking whether the user wants to remove the XML tag. Proceed with the conversion only when the function returns a true value; then use the <a class="el" href="classk_set_hide_note_state_cmd_boss.html">kSetHideNoteStateCmdBoss</a> command to make sure the note&#39;s visibility is turned on. Use <a class="el" href="classk_convert_to_note_cmd_boss.html">kConvertToNoteCmdBoss</a> to convert the text.<h3><a class="anchor" id="id_converting_note_content_to_text"></a> Converting note content to text</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#a26db902e0656dcfcdefd4fcc78dfe0c1">INoteSuite::DoConvertToText</a> to convert selected note content to text. For an example, see the <a class="el" href="class_snp_perform_note_function.html">SnpPerformNoteFunction</a> snippet.<p>When the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, use <a class="el" href="classk_convert_note_to_text_cmd_boss.html">kConvertNoteToTextCmdBoss</a> to convert note content to regular text. If text focus is in the note content area and no text is selected, or if the note anchor is selected, the whole note is converted. If only part of the note content is selected, only that portion is converted to regular text.<p>Pay special attention to the text range to be converted. Consider the sample story &quot;&lt;Convert Me&gt; Please,&quot; where &quot;&lt;Convert Me&gt;&quot; is a note and &quot;&lt;&quot; and &quot;&gt;&quot; are the bookends. If the whole note is selected, the current selection range is [0, 1], because the selection is on the anchor character. If the selection is in the note content area-for example, the whole &acirc;&#128;&#152;Convert Me&#39;- the selection range is [9, 19], because the selection is in the note&#39;s story thread, not in the primary story thread. The command&#39;s focus-start and focus-end data (<a class="el" href="class_i_int_data.html">IIntData</a> with the interface IDs IID_ISTARTFOCUSINTDATA and IID_IENDFOCUSINTDATA) need to be the indices in the note&#39;s story thread. So, if the selection is the note anchor (where the selection range is [0,1]), find out where that note&#39;s story thread is, and pass in the corresponding text index to the data interface. Use <a class="el" href="class_i_note_u_i_utils.html#a268c70207b024da08c1a05cc5832f8de">INoteUIUtils::TextFocusInNote</a> to check whether the focus is in the note&#39;s content area. Also, the following snippet shows how to find the whole note&#39;s range; after indexStart and indexEnd are found, they can be passed into the command&#39;s data interface: <div class="fragment"><div class="line"><span class="comment">//Note anchor is selected.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;INoteData&gt;</a> noteData(<a class="code" href="class_utils.html">Utils&lt;INoteUtils&gt;</a>()-&gt;QueryNoteData(textModel, indexStart));</div><div class="line"><span class="keywordflow">if</span> (!noteDataOnLeft) <span class="keywordflow">return</span>; </div><div class="line"><span class="comment">// no note</span></div><div class="line">noteDataRef = ::GetUIDRef(noteDataOnLeft);</div><div class="line"><span class="keywordflow">if</span>(textModel-&gt;FindStoryThread(noteDataRef.GetUID(), 0, &amp;threadStart, &amp;threadLength)){</div><div class="line"><span class="comment">// Range is a whole note.</span></div><div class="line"> indexStart = threadStart;</div><div class="line"> indexEnd = threadStart+threadLength-1;</div><div class="line"><span class="comment">//no carriage return</span></div><div class="line">}</div></div><p>The item list in this command needs both the UID of the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> that contains the note and the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> of the note.<h3><a class="anchor" id="id_navigating_among_notes"></a> Navigating among notes</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#a8b8bc2b15edeced6c1a331cc199a2eb9">INoteSuite::DoNavigateNote</a> to go to the next or previous note. For an example, see the <a class="el" href="class_snp_perform_note_function.html">SnpPerformNoteFunction</a> snippet.<p>Navigating the notes without <a class="el" href="class_i_note_suite.html">INoteSuite</a> is very difficult, because there are so many factors to consider. You must collect all the notes by yourself, and you must consider the situation in which the insertion point is in a different context (for example, table or deleted text), and there is no command to do it. The closest thing is the <a class="el" href="class_i_note_suite_utils.html#a13b620595f0cb2c964898f3997774ed2">INoteSuiteUtils::NavigateNote</a>, which also involves the selection subsystem. Therefore, we highly recommend you do the navigation through the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface. In general, if you have a text story in the document, with a visible note anchored somewhere in the story, the <a class="el" href="class_i_note_suite.html#a72c3f9561644ac2541d3a63fc4c55f5f">INoteSuite::CanNavigateNote</a> returns true, and you can navigate the notes with much greater ease.<h3><a class="anchor" id="id_splitting_a_note"></a> Splitting a note</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#a85933deb68b858870f1fe348f94cc59f">INoteSuite::DoSplitNote</a> to split a note. For an example, see the <a class="el" href="class_snp_perform_note_function.html">SnpPerformNoteFunction</a> snippet.<p>When the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, use <a class="el" href="classk_split_note_cmd_boss.html">kSplitNoteCmdBoss</a> to split the note at the position indicated by the text-index argument. As with <a class="el" href="classk_convert_note_to_text_cmd_boss.html">kConvertNoteToTextCmdBoss</a>, you must make sure the text index where you want to split is inside the note&#39;s content area; that is, the text index needs to be in the note&#39;s story-thread range. By default, notes are not splittable in layout view.<h3><a class="anchor" id="id_expanding_and_collapsing_notes"></a> Expanding and collapsing notes</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#a5d6a7766af746be20e780f4eaa876186">INoteSuite::DoOpenNote</a> to expand or collapse one note, use <a class="el" href="class_i_note_suite.html#a7bfa72545afb587644f099a871a4bcaa">INoteSuite::DoExpandAllNotes</a> to expand all notes in the document, and use <a class="el" href="class_i_note_suite.html#ada101b8d02cb07df0776e06822248370">INoteSuite::DoCollapseAllNotes</a> to collapse all notes in the document.<p>If the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, use <a class="el" href="classk_collapse_state_cmd_boss.html">kCollapseStateCmdBoss</a>, supplying a valid TextIndex that points to a note anchor. Given a text-index location, use <a class="el" href="class_i_note_u_i_utils.html#a268c70207b024da08c1a05cc5832f8de">INoteUIUtils::TextFocusInNote</a> to check whether that location is in the note contents area. If it is not, also check whether the location is on the note anchor. Both situations should be allowed to expand/collapse a note. After the command is processed, a text selection may need to be set to have a text focus in a desired location. <a class="el" href="class_i_note_data.html">INoteData</a> in the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> stores the current collapsed state data on the note. Normally, you toggle between the two states when processing the <a class="el" href="classk_collapse_state_cmd_boss.html">kCollapseStateCmdBoss</a>.<p>Normally, if there are notes in the story and they are not already all expanded or all collapsed, <a class="el" href="class_i_note_suite.html#ae3f84be33c946ba56e51f311960451fb">INoteSuite::CanCollapseAllNotes</a> or <a class="el" href="class_i_note_suite.html#ac64f5e26ce020f12c1d42139727ca4f9">INoteSuite::CanExpandAllNotes</a> returns true, so you should be able to use these suite methods when you need to expand or collapse all notes.<p>By default, layout view does not support the expand note and collapse note features.<h3><a class="anchor" id="id_selecting_a_note"></a> Selecting a note</h3><p>Whenever possible, use <a class="el" href="class_i_note_suite.html#a8b8bc2b15edeced6c1a331cc199a2eb9">INoteSuite::DoNavigateNote</a>, as shown in the SDK snippet <a class="el" href="class_snp_perform_note_function.html#a9a63f90b9e12b95ae62bb679d4484edc">SnpPerformNoteFunction::NavigateNote</a>. When you do not have a proper selection context to work with, however, you can use the following low level-method.<p>Assuming you know the UID of the note&#39;s <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a> and the UID of the <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a> that contains the note, do the following to select that note in galley view: <div class="fragment"><div class="line"><span class="comment">// Assume storyRef is the story and noteDataRef is the note.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextModel&gt;</a> textModel(storyRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IItemStrand&gt;</a> itemStrand( (<a class="code" href="class_i_item_strand.html">IItemStrand</a>*)textModel-&gt;QueryStrand(<a class="code" href="classk_owned_item_strand_boss.html">kOwnedItemStrandBoss</a>, IID_IITEMSTRAND));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IOwnedItem&gt;</a> ownedItem(noteDataRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">TextIndex noteDataPos = itemStrand-&gt;GetOwnedItemIndex(ownedItem);</div><div class="line">ASSERT(noteDataPos != kInvalidTextIndex);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISelectionManager&gt;</a> viewSelMgr (docView, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_utils.html">Utils&lt;ISelectUtils&gt;</a>()-&gt;GoToTextWithMarker( storyRef, noteDataPos, 1);</div></div><p>In layout view, instead of using ISelectUtils::GoToTextWithMarker, use the following to select the note anchor: <div class="fragment"><div class="line"><span class="comment">// docView is the document window&#39;s IControlView*</span></div><div class="line"><a class="code" href="class_utils.html">Utils&lt;ISelectUtils&gt;</a>()-&gt;ProcessSelectText( ::GetUIDRef(textModel), <a class="code" href="class_range_data.html">RangeData</a>(noteDataPos, RangeData::kLeanForward), Selection::kScrollIntoView,nil,viewSelMgr, docView);</div></div><h3><a class="anchor" id="id_getting_knotedataboss"></a> ,_given_a_text_index_whose_position_is_anchored_to_note Getting kNoteDataBoss, given a text index whose position is anchored to note</h3><p>Use <a class="el" href="class_i_note_utils.html#abf2ed1e5f887d9e9e5891b48917f9522">INoteUtils::QueryNoteData</a> to get to the <a class="el" href="classk_note_data_boss.html">kNoteDataBoss</a>. For an example, see Converting note content to text.<h3><a class="anchor" id="id_deleting_notes"></a> Deleting notes</h3><p>When proper context is available, use <a class="el" href="class_i_note_suite.html#ad6a9f75cc08a0038a015fe2695ec7977">INoteSuite::DoDeleteNote</a> to delete a note, use <a class="el" href="class_i_note_suite.html#a902b80e13c62073fbd85e2e9b9ae8389">INoteSuite::DoRemoveStoryNotes</a> to delete all notes from a story, and use <a class="el" href="class_i_note_suite.html#abf326a929eafd61c82e71effc293d62c">INoteSuite::DoRemoveAllNotes</a> to delete all notes from a document.<p>When the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, delete the note by simply removing the note-anchor character, which subsequently asks the note owned item to handle the rest of the data removal: <div class="fragment"><div class="line"><span class="comment">// Assume textModelCmds is the ITextModelCmds from the kTextStoryBoss.</span></div><div class="line"><span class="comment">// Assume noteAnchorPos is the note anchor position.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> typeCmd(textModelCmds-&gt;TypeTextCmd(noteAnchorPos, noteAnchorPos + 1, WideString::kNil_shared_ptr));</div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> newName = <span class="stringliteral">&quot;Delete Note&quot;</span>;</div><div class="line">typeCmd-&gt;SetName(newName);</div><div class="line"><a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(typeCmd);</div></div><p>To remove all stories when the <a class="el" href="class_i_note_suite.html">INoteSuite</a> interface is not available, use <a class="el" href="class_i_note_utils.html#a2e35efcdbabf8dde7586d6353e0fec07">INoteUtils::ClearAllNotes</a>.<h3><a class="anchor" id="id_changing_notes-palette_content_to_reflect_particular_note_data"></a> Changing notes-palette content to reflect particular note data</h3><p>Use <a class="el" href="class_i_note_palette_utils.html">INotePaletteUtils</a> &gt;()-&gt;SetNoteToPalette to bring up the note data in the Notes palette.<h3><a class="anchor" id="id_checking_note_spelling"></a> Checking note spelling</h3><p><a class="el" href="class_i_note_pref.html#af4016839984cdff042fee5bdf6c19f31">INotePref::SetSpellCheckContent</a> lets you turn on spell checking in the note content, but you cannot change the behavior of how the note interacts with the text&#39;s spell-checking engine.<h3><a class="anchor" id="id_observing_a_note_that_is_being_modified"></a> Observing a note that is being modified</h3><p>Many note commands notify with the IID_INOTEDATA protocol along with its command ID, so attach an observer and listen to that protocol on an appropriate subject. The following code attaches an observer for IID_INOTEDATA broadcast to a document subject: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocument&gt;</a> document(<a class="code" href="class_utils.html">Utils&lt;ILayoutUIUtils&gt;</a>()-&gt;GetFrontDocument(), IID_IDOCUMENT);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISubject&gt;</a> docSubject(document, IID_ISUBJECT);</div><div class="line"><span class="keywordflow">if</span> (docSubject &amp;&amp; !docSubject-&gt;IsAttached(<span class="keyword">this</span>, IID_INOTEDATA)) </div><div class="line"> docSubject-&gt;AttachObserver(<span class="keyword">this</span>, IID_INOTEDATA);</div></div><h3><a class="anchor" id="id_using_notes_in_indesign"></a> Using notes in InDesign</h3><p>InCopy Workflow plug-ins install the InCopy Notes and Track Changes features in InDesign for use in the InCopyBridge workflow. These features use InCopyBridge user names to identify the author of a note.<p>When you add editorial notes to a managed story in InDesign, these notes become available to others in the workflow.<h1><a class="anchor" id="id_incopy_assignments"></a> InCopy: Assignments</h1><p>This chapter provides information about InCopy assignment files. To understand this chapter, you should have a basic understanding of XML and have a basic knowledge of the InDesign/InCopy workflow.<p>This chapter has the following objectives:<ul><li>Provide key concepts of assignments and assignment files.<li>Give a detailed illustration of the assignment data model and assignment file structure.<li>Describe how to work with the assignment API.</ul><p>For common use cases, see <a class="el" href="id_solutions.html#id_incopy_assignments">InCopy: Assignments</a>.<h2><a class="anchor" id="id_concepts"></a> Concepts</h2><p>Assignment-file features address the following user needs:<ul><li>An InCopy user might want to export a few related stories (headline, byline, copy), and therefore needs convenient export options for many common workflows.<li>An InCopy user might want to open several exported stories as one file. Having to open separate files (for example, heading, story, caption) is counterintuitive for many customers who may see these files as a logical whole.<li>An InCopy user might want to see how stories fit into an InDesign layout without opening the entire InDesign document. (Opening a large InDesign document can be very time-consuming, especially if it is located on another computer across a network.)</ul><p>Users want to be able to group related document constituents-not just stories, but graphics as well-into meaningful elements that can be worked on as a group. For example, users might want to group a headline, byline, copy, graphics, and captions into a group; if a company has dedicated headline writers or editors, they may want to group all headlines in to a meaningful unit.<p>InDesign and InCopy support the creation of such groupings with assignment files. Assignment files solve the file-management issue by adding an additional file that tracks the other files. In essence, an assignment is a set of files, the contents of which are assigned to one person for some work to be done (for example, copy-editing, layout, and writing). Stories in an assignment are exported as InCopy files. Geometry information and the relationships between the files are held in the assignment file. InDesign allows the user to export a given set of stories by exporting into an assignment. InCopy open all the stories in an assignment together, as a single unit.<p>Assignment files have the following attributes:<ul><li>Users can create and name assignments, including any set of elements of one document.<li>When exporting a group of items from InDesign, an additional file-the assignment file-is created. It contains links or pointers to the grouped page elements and any transforms on those elements. This lets the user open one file in InCopy and have editorial access to multiple stories. Assignment files also include page geometry, so InCopy users can see the lay- out of the frame for the content they are editing, without the slowdown of opening the entire InDesign file. Optionally, users can see the context of their editing (other items on the same page) by exporting entire spreads on which one or more assigned frames lie. For details, see Assignment-export options.<li>Users can see the contents of an assignment in two ways: a list of contents (in the Assignments palette) and by special highlighting or color coding of frames in a single assignment (in the document window). Even after the assignment grouping is created, users can add items to and remove items from the group.</ul><p>Assignments are saved in one of two file formats, IDML-based IMCA files or INX-based INCA files. Assignment files group content into chunks smaller than a complete publication that InDesign understands and manages. Assignment files provide the basis for asset control on a scale smaller than an entire publication.<h2><a class="anchor" id="id_assignment_workflow"></a> Assignment workflow</h2><p>Here is a common workflow for users collaborating by means of assignment files:<ul><li>A layout designer designs the framework of a document layout and assigns contents (that is, stories and images) to different users, by creating an assignment file for each user.<li>Content contributors or editors check out the assigned stories and images, do their editing, and check in finished content.<li>The layout designer receives notification by an indicator in the Assignments palette that a document is out of synchronization. The layout designer can then update the document.</ul><p>For more information on the use of assignment files, see InCopy Help or InDesign Help.<h2><a class="anchor" id="id_assignment-export_options"></a> Assignment-export options</h2><p>To give users control over how much geometry information an assignment file contains, InDesign allows users to choose assignment-export options. These options determine what content the user can see in InCopy when opening the assignment file. InDesign provides three such options:<ul><li>Placeholder frames - Lets the InCopy user see the text and frames in the assignment, as well as boxes or other shapes representing all other frames on the InDesign pages that contain frames in the assignment. All frames and placeholders accurately reflect the size, shape, and location of the InDesign originals. Note, however, that placeholders are empty shapes and do not show any of the content in the InDesign file. These shapes, which are visible in InCopy layout view, are gray, so the user can distinguish them from empty frames that may be part of the assignment. This option provides the minimum information<li>to the InCopy user; anything less would remove possible text wraps that affect copy fitting.<li>Assigned spreads - Lets the InCopy user see everything described in the Placeholder Frames option, as well as showing the entire contents of any spreads that happen to intersect with the assignment (that is, spreads that contain at least one frame in the assignment). This noneditable content is visible in InCopy layout view.<li>All spreads - Shows the entire InDesign file of which the assignment is a part. The difference between using this option and opening an actual InDesign file is that a user who opens an assignment file with this option can see the design and layout of every page but can edit (after checking out) only those frames in the current assignment.</ul><h2><a class="anchor" id="id_assignment"></a> Assignment</h2><p>The primary tool for working with assignments is the Assignment palette. Through the palette&#39;s interface, users can create, delete, add, and remove content of any assignment, as well as check out and check in InCopy stories and change assignment options.<p>The content of a document could be any of the following:<ul><li>Assigned content - Content belonging to an assignment.<li>Unassigned InCopy content - Content exported as InCopy stories, but not belonging to any assignment.<li>Unassigned content - Content that was never exported as stories or page items.</ul><p>An assignment may become out of date when there is a change to the InDesign document after the assignment is exported. Saving an InDesign document does not clear the state; the user must choose Update Selected Assignment or Update All Assignments to reexport the assignment.<p>In the screenshot in the following figure, two text frames in the lower-right part of the page are unassigned contents. The remaining content is part of Assignment 1 (magenta border) or Assignment 2 (gold border).<p>In the figure, there are several ways to distinguish an assignment: the assignment name (assignment_1, assignment_2), the user to whom it is assigned (user_1, user_2), and the color of the assignment (magenta, gold). The image on the lower-left part of the page is colored gold because it belongs to assignment_2. The magenta frames belong to assignment_1.<p>Contents of an assignment are listed in the Assignments palette as children of the assignment. The palette shows the assigned story name as well as the status of the story file; for example, whether it is checked out by another InCopy user. <div class="image"><img alt="plugin-programming-guide-vol2-108.gif" src="plugin-programming-guide-vol2-108.gif" /></div><p>In the following figure, an assignment belongs to a publication (document) and is made up of several assigned stories. An assigned story holds text or an image. An assigned story holding an image is an assigned image. <div class="image"><img alt="plugin-programming-guide-vol2-109.gif" src="plugin-programming-guide-vol2-109.gif" /></div><h2><a class="anchor" id="id_assignment_data_model"></a> Assignment data model</h2><h3><a class="anchor" id="id_assignment_hierarchy"></a> Assignment hierarchy</h3><p>In the terms of the document object model (DOM), an assignment is a child of the document. Assignment-related boss class objects form a hierarchical tree.<p>In the following figure, <a class="el" href="class_i_assigned_document.html">IAssignedDocument</a> stores a list of assignments for a document, each described by a <a class="el" href="classk_assignment_boss.html">kAssignmentBoss</a>. An assignment consists of a number of assigned stories, each either a text story (<a class="el" href="classk_assigned_story_boss.html">kAssignedStoryBoss</a>) or an image story (<a class="el" href="classk_assigned_image_boss.html">kAssignedImageBoss</a>). Assigned stories have references back to the assignment. <div class="image"><img alt="plugin-programming-guide-vol2-110.gif" src="plugin-programming-guide-vol2-110.gif" /></div><h3><a class="anchor" id="id_object_structure_of_an_assignment"></a> Object structure of an assignment</h3><p>The object structure of an assignment is constructed dynamically, as a user creates assignments and adds contents to assignments.<p>The sample document in the following figure contains two assignments (<a class="el" href="classk_assignment_boss.html">kAssignmentBoss</a>):<ul><li>Assignment_1 has three assigned stories, two of which are text stories (<a class="el" href="classk_assigned_story_boss.html">kAssignedStoryBoss</a>), and one of which is an image story (<a class="el" href="classk_assigned_image_boss.html">kAssignedImageBoss</a>). The stories are Story_1, Story_2, and Image_1, respectively.<li>Assignment_2 has two assigned stories, one of which is a text story (Story_3) and one of which is an image story (Image_2). <div class="image"><img alt="plugin-programming-guide-vol2-111.gif" src="plugin-programming-guide-vol2-111.gif" /></div></ul><h3><a class="anchor" id="id_moving_assignment_content"></a> Moving assignment content</h3><p>Text frames and images in an InDesign document can never have been assigned, or they can have been assigned or exported and, therefore, can be moved among different assignments and unassigned InCopy content. When adding content to an assignment, the following is true:<ul><li>If the selected text or text frame is within a story with multiple text frames, the story becomes an assigned story, and all text frames of the story are assigned.<li>If the selected content already belongs to another assignment, the content is removed automatically from that assignment.</ul><p>The following figure shows the new screenshot and object diagram of the document shown in the preceding figure, after reassigning the lower-left text frame from Assignment_2 to Assignment_1. Assignment_1 has four assigned stories (three text stories and one image story). Assignment_2 has only one assigned story (an image story). <div class="image"><img alt="plugin-programming-guide-vol2-112.gif" src="plugin-programming-guide-vol2-112.gif" /></div><p>After the reassignment operation, the following is true:<ul><li>In the object model, Story_3 is removed from Assignment_2 and added to Assignment_1.<li>In the document window, the color of the text frame changes from gold (the color of Assignment_2) to magenta (the color of Assignment_1).<li>In the Assignments palette, Story_3.incx becomes part of Assignment_1.</ul><h3><a class="anchor" id="id_assignment_files_and_links"></a> Assignment files and links</h3><p>The assignment feature relies on links to track the status of assignments and stories. Assignment files do not appear in the Links palette, but they work the same way as links:<ul><li>If the assignment file is moved to another location, the application reports a missing file and prompts the user to find the file.<li>The user can find the missing file during document opening or relink the assignment file later from Assignments palette.<li>When the files are changed outside the application, the application prompts for an update.</ul><h2><a class="anchor" id="id_assignment_files"></a> Assignment files</h2><p>Assignment files are stored as separate entities using the designated storage medium (for example, hard disk or network resource). Assignment files use the .icma filename extension.<p>Assignment files store the following information:<ul><li>Reference to the InDesign document (file path, in case the user wants to open the document with the stories).<li>Assignee, the user responsible for the content in the assignment.<li>A list of references or links to the stories and graphics in the assignment.<li>Character and paragraph styles and swatch information used in the document. The assignment file contains the style and swatch information for the entire document, whereas each story contains only the style and swatch information applicable to that story.<li>XML tags maintaining the assignment file structure.<li>Frame geometry; that is, coordinates and dimensions of each frame in the assignment, along with its page location and any transforms users have done to the frames.</ul><h3><a class="anchor" id="id_comparing_assignment_files_to_indesign_and_incopy_files"></a> Comparing assignment files to InDesign and InCopy files</h3><p>The assignment-files feature requires collaborative work with InDesign and InCopy files. Only InDesign writes to assignment files; InCopy cannot create an assignment. InCopy can only open an assignment file and work on its contained stories. The following sections summarize how assignment-related information is stored in the InCopy file and the InDesign file.<p><b>InCopy file (*.icml)</b><p>An InCopy file holds InCopy story contents -frame information and all relevant transform information for graphics; style, swatch, and tag definitions used in the story; user names associated with the story (for example, in notes, tracked changes); and story XMP data.<p><b>InDesign file (*.indd)</b><p>An InDesign file contains a list of references to the assignment files that contain elements from the document. InDesign needs to locate these files when moving the document from one machine to another. InDesign needs to open and potentially update these assignment files when the InDesign document is saved.<h3><a class="anchor" id="id_assignment-file_format"></a> Assignment-file format</h3><p>InDesign and InCopy support an IDML-based format; it uses the .icma file extension. The following is an example of an ICMA (IDML-based) assigment file. <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;?aid style=<span class="stringliteral">&quot;50&quot;</span> type=<span class="stringliteral">&quot;assignment&quot;</span> readerVersion=<span class="stringliteral">&quot;6.0&quot;</span> featureSet=<span class="stringliteral">&quot;257&quot;</span> product=<span class="stringliteral">&quot;9.0(297)&quot;</span> ?&gt;</div><div class="line">&lt;Document DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span> Self=<span class="stringliteral">&quot;d&quot;</span> ZeroPoint=<span class="stringliteral">&quot;0 0&quot;</span> CMYKProfile=<span class="stringliteral">&quot;U.S. Web Coated (SWOP) v2&quot;</span></div><div class="line"> RGBProfile=<span class="stringliteral">&quot;sRGB IEC61966-2.1&quot;</span> SolidColorIntent=<span class="stringliteral">&quot;UseColorSettings&quot;</span></div><div class="line"> AfterBlendingIntent=<span class="stringliteral">&quot;UseColorSettings&quot;</span></div><div class="line"> DefaultImageIntent=<span class="stringliteral">&quot;UseColorSettings&quot;</span></div><div class="line"> RGBPolicy=<span class="stringliteral">&quot;PreserveEmbeddedProfiles&quot;</span></div><div class="line"> CMYKPolicy=<span class="stringliteral">&quot;CombinationOfPreserveAndSafeCmyk&quot;</span></div><div class="line"> AccurateLABSpots=<span class="stringliteral">&quot;false&quot;</span>&gt;</div><div class="line"> &lt;Language Self=<span class="stringliteral">&quot;Language/$ID/English%3a USA&quot;</span> Name=<span class="stringliteral">&quot;$ID/English: USA&quot;</span></div><div class="line"> SingleQuotes=<span class="stringliteral">&quot;&#39;&#39;&quot;</span></div><div class="line"> DoubleQuotes=<span class="stringliteral">&quot;&quot;</span><span class="stringliteral">&quot;&quot;</span> PrimaryLanguageName=<span class="stringliteral">&quot;$ID/English&quot;</span></div><div class="line"> SublanguageName=<span class="stringliteral">&quot;$ID/USA&quot;</span> Id=<span class="stringliteral">&quot;269&quot;</span></div><div class="line"> HyphenationVendor=<span class="stringliteral">&quot;Proximity&quot;</span> SpellingVendor=<span class="stringliteral">&quot;Proximity&quot;</span>/&gt;</div><div class="line"> &lt;Color Self=<span class="stringliteral">&quot;Color/Black&quot;</span> Model=<span class="stringliteral">&quot;Process&quot;</span> Space=<span class="stringliteral">&quot;CMYK&quot;</span></div><div class="line"> ColorValue=<span class="stringliteral">&quot;0 0 0 100&quot;</span></div><div class="line"> ColorOverride=<span class="stringliteral">&quot;Specialblack&quot;</span> AlternateSpace=<span class="stringliteral">&quot;NoAlternateColor&quot;</span></div><div class="line"></div><div class="line"> AlternateColorValue=<span class="stringliteral">&quot;&quot;</span> Name=<span class="stringliteral">&quot;Black&quot;</span> ColorEditable=<span class="stringliteral">&quot;false&quot;</span> ColorRemovable=<span class="stringliteral">&quot;false&quot;</span></div><div class="line"> Visible=<span class="stringliteral">&quot;true&quot;</span> SwatchCreatorID=<span class="stringliteral">&quot;7937&quot;</span>/&gt;</div><div class="line"> &lt;!--... Omitted Content ...!--&gt;</div><div class="line"> &lt;Assignment Self=<span class="stringliteral">&quot;u102&quot;</span> Name=<span class="stringliteral">&quot;Assignment 1&quot;</span> UserName=<span class="stringliteral">&quot;hlynn&quot;</span></div><div class="line"> ExportOptions=<span class="stringliteral">&quot;AssignedSpreads&quot;</span></div><div class="line"> IncludeLinksWhenPackage=<span class="stringliteral">&quot;true&quot;</span></div><div class="line"> FilePath=<span class="stringliteral">&quot;C:\Examples\Assignments\Assignment 1.icma&quot;</span>&gt;</div><div class="line"> &lt;Properties&gt;</div><div class="line"> &lt;FrameColor type=<span class="stringliteral">&quot;enumeration&quot;</span>&gt;LightBlue&lt;/FrameColor&gt;</div><div class="line"> &lt;/Properties&gt;</div><div class="line"> &lt;AssignedStory Self=<span class="stringliteral">&quot;u107&quot;</span> Name=<span class="stringliteral">&quot;myDoc.icml&quot;</span> StoryReference=<span class="stringliteral">&quot;uea&quot;</span></div><div class="line"> FilePath=<span class="stringliteral">&quot;C:\Examples\Assignments\content\myDoc.icml&quot;</span>/&gt;</div><div class="line"> &lt;AssignedStory Self=<span class="stringliteral">&quot;u10d&quot;</span> Name=<span class="stringliteral">&quot;story-1.icml&quot;</span> StoryReference=<span class="stringliteral">&quot;ud3&quot;</span></div><div class="line"> FilePath=<span class="stringliteral">&quot;C:\Examples\Assignments\content\story-1.icml&quot;</span>/&gt;</div><div class="line"> &lt;/Assignment&gt;</div><div class="line">&lt;/Document&gt;</div></div><p>Notes:<ul><li>ICMA- (or IDML-based) assignments also use the &quot;assignment&quot; type in a Processing Instruction on line 2 of the file.<li>&lt;Document&gt; is the outermost element (or document element) of an ICMA assignment file.<li>ICMA uses robust (descriptive) scripting names similar to JavaScript; for example, an assignment is contained in the Assignment element. Assignment-related elements exist in both IDML (if assignments are created) and ICMA files.<li>An assignment file has only one Assignment element referring to itself, whereas an IDML file contains an Assignment element for each assignment in the document.<li>There are some elements and attributes that assignment files do not include.<li>Not all spreads of the document are included in the assignment file, depending on the export option chosen for assignment. For details, see Assignment-export options.<li>An assignment file usually is smaller than an IDML file.<li>Assignment files can be validated with the single file format of the RelaxNG schema. For information on schema validation, see Adobe InDesign Markup Language (IDML) Cookbook.</ul><h2><a class="anchor" id="id_the_assignment_api"></a> The assignment API</h2><h3><a class="anchor" id="id_iassignmentmgr"></a> IAssignmentMgr</h3><p><a class="el" href="class_i_assignment_mgr.html">IAssignmentMgr</a> is aggregated into <a class="el" href="classk_session_boss.html">kSessionBoss</a>. <a class="el" href="class_i_assignment_mgr.html">IAssignmentMgr</a> serves as a manager for assignment file function, so it has the broadest scope, serving all assignments in all documents. <a class="el" href="class_i_assignment_mgr.html">IAssignmentMgr</a> also has the broadest range of methods, including manipulation methods like open, save, export, and import assignment; create, add, and remove content of an assignment; and general management methods like finding out whether a page item is assigned and checking whether an assigned story is a text story.<h3><a class="anchor" id="id_iassigneddocument"></a> IAssignedDocument</h3><p>Aggregated into <a class="el" href="classk_doc_boss.html">kDocBoss</a>, <a class="el" href="class_i_assigned_document.html">IAssignedDocument</a> serves all assignments in one document, so its methods are designed to work for managing assignments in a document. <a class="el" href="class_i_assigned_document.html">IAssignedDocument</a> has methods for adding assignments, removing assignments, and getting the list of all assignments for a document.<h3><a class="anchor" id="id_iassignment"></a> IAssignment</h3><p><a class="el" href="class_i_assignment.html">IAssignment</a> represents an individual assignment; therefore, it is a typical entry point for accessing an assignment. <a class="el" href="class_i_assignment.html">IAssignment</a> has get and set methods to access assignment information, like assignment name, location of the assignment file, and export options for the assignment. <a class="el" href="class_i_assignment.html">IAssignment</a> also has methods to access its assigned content and add, remove, and delete assigned stories.<h3><a class="anchor" id="id_iassignedstory"></a> IAssignedStory</h3><p><a class="el" href="class_i_assigned_story.html">IAssignedStory</a> represents an assigned story. <a class="el" href="class_i_assigned_story.html">IAssignedStory</a> has two different implementations: kAssignedStoryImpl and kAssignedImageImpl, representing text story and image story, respectively. Despite the difference in implementation, text story and image story share the same interface. <a class="el" href="class_i_assigned_story.html">IAssignedStory</a> has access methods to get and set assigned story name, file location of the story, <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the story in the InDesign document to which it refers, and the assignment to which it belongs.<h3><a class="anchor" id="id_iassignmentselectionsuite"></a> IAssignmentSelectionSuite</h3><p><a class="el" href="class_i_assignment_selection_suite.html">IAssignmentSelectionSuite</a> is a typical selection-suite interface that has CanAssign and Assign methods to add the current selection to an assignment.<h3><a class="anchor" id="id_iassignmentutils"></a> IAssignmentUtils</h3><p><a class="el" href="class_i_assignment_utils.html">IAssignmentUtils</a> is aggregated into <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>. <a class="el" href="class_i_assignment_utils.html">IAssignmentUtils</a> has useful methods for assignment scripting.<h3><a class="anchor" id="id_iassignmentuiutils"></a> IAssignmentUIUtils</h3><p><a class="el" href="class_i_assignment_u_i_utils.html">IAssignmentUIUtils</a> is aggregated into <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>. <a class="el" href="class_i_assignment_u_i_utils.html">IAssignmentUIUtils</a> has very useful utility functions for assignment user-interface control. <a class="el" href="class_i_assignment_u_i_utils.html">IAssignmentUIUtils</a> has methods that check front document, current layout selection, and Assignments palette selection, to determine what type of operation might apply and execute it, such as create, delete an assignment, add content to an assignment, remove content from an assignment, update, relink assignment, check out, submit changes, and revert changes to the assignment.<h3><a class="anchor" id="id_iassignmentpreferences"></a> IAssignmentPreferences</h3><p><a class="el" href="class_i_assignment_preferences.html">IAssignmentPreferences</a> controls how assignment contents are drawn in the document window. If Show Assigned Frame is set, InDesign draws a colored frame for the assigned story; otherwise, InDesign draws a normal frame.<h3><a class="anchor" id="id_common_commands"></a> Common commands</h3><p>Commands are the only recommended way to change the model. The following table lists commands used to manipulate assignments and their contents.<table class="doxtable"><tr><th><a class="el" href="class_command.html">Command</a> name </th><th><a class="el" href="class_command.html">Command</a> data </th><th>Description </th></tr><tr><td><a class="el" href="classk_assign_doc_cmd_boss.html">kAssignDocCmdBoss</a></td><td>IID_IASSIGNSETPROPSCMDDATA </td><td>Creates a new assignment. The <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the document is passed as the command&#39;s ItemList. Other information (assignment name, assignment file path, assignee, color, assignment export options, etc.) is passed as command-data interface IID_IASSIGNSETPROPSCMDDATA. After execution, the new assignment is stored in the command&#39;s ItemList. </td></tr><tr><td><a class="el" href="classk_assign_set_props_cmd_boss.html">kAssignSetPropsCmdBoss</a></td><td>IID_IASSIGNSETPROPSCMDDATA </td><td>Sets assignment properties. The ItemList of the command is the assignment <a class="el" href="class_u_i_d_ref.html">UIDRef</a>, and the command shares the same command data as <a class="el" href="classk_assign_doc_cmd_boss.html">kAssignDocCmdBoss</a>. </td></tr><tr><td><a class="el" href="classk_unassign_doc_cmd_boss.html">kUnassignDocCmdBoss</a></td><td>IID_ISTRINGDATA </td><td>Deletes an assignment. The command&#39;s ItemList is the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the assigned document, and the command data IID_ISTRINGDATA passes in the assignment&#39;s file path. </td></tr><tr><td><a class="el" href="classk_add_to_assignment_cmd_boss.html">kAddToAssignmentCmdBoss</a></td><td>None </td><td>Adds content to an existing assignment. The content to be added and the assignment are passed as the first and second items of the command&#39;s ItemList, respectively. </td></tr><tr><td><a class="el" href="classk_assign_story_set_props_cmd_boss.html">kAssignStorySetPropsCmdBoss</a></td><td>IID_IASSIGNSTORYSETPROPSCMDDATA </td><td>Sets assigned story properties. The ItemList of the command is the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the assigned story. Its command data IID_IASSIGNSTORYSETPROPSCMDDATA stores <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the story that the assigned story points to, the filename of the story in the disk, and the assigned story name. </td></tr><tr><td><a class="el" href="classk_assignment_set_color_cmd_boss.html">kAssignmentSetColorCmdBoss</a></td><td>IID_IUIDDATA </td><td>Sets assignment color. The command&#39;s ItemList stores the <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of stories. Its command data IID_IUIDDATA stores the UID of the color the client wants to set. </td></tr><tr><td><a class="el" href="classk_remove_assigned_story_cmd_boss.html">kRemoveAssignedStoryCmdBoss</a></td><td>None </td><td>Removes the assigned story from any assignment. The <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the assigned story to be removed is passed to the command as ItemList. </td></tr><tr><td><a class="el" href="classk_remove_assigned_frame_cmd_boss.html">kRemoveAssignedFrameCmdBoss</a></td><td>None </td><td>Keeps assignment up to date when a frame is deleted in the document. Removes the assigned story from an assignment if the deleted frame is the only frame an assigned story has. <a class="el" href="class_u_i_d_ref.html">UIDRef</a> of the deleted frame is passed to the command as ItemList. </td></tr><tr><td><a class="el" href="classk_move_assigned_story_cmd_boss.html">kMoveAssignedStoryCmdBoss</a></td><td>None </td><td>Moves an assigned story within an assignment. Moves the assigned story referenced by the first item of ItemList before the assigned story referenced by the second item of ItemList. </td></tr><tr><td><a class="el" href="classk_show_assigned_frames_cmd_boss.html">kShowAssignedFramesCmdBoss</a></td><td>IID_IBOOLDATA </td><td>Sets show or hide assigned frame preference of <a class="el" href="class_i_assignment_preferences.html">IAssignmentPreferences</a>. </td></tr></table></div></div></div><div class="navpath" id="nav-path"><ul><li class="footer">Generated on Sat Sep 22 2018 10:52:59 for InDesign SDK by <a href="http://www.doxygen.org/index.html"> <img alt="doxygen" class="footer" src="doxygen.png" /></a> 1.8.3.1 </ul></div></body></html>

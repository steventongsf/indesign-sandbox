<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/xhtml;charset=UTF-8" http-equiv="Content-Type" /><meta content="IE=9" http-equiv="X-UA-Compatible" /><meta content="Doxygen 1.8.3.1" name="generator" /><title>id_getting_started_with_indesign_plugin_development</title><link href="tabs.css" rel="stylesheet" type="text/css" /><script src="jquery.js" type="text/javascript"></script><script src="dynsections.js" type="text/javascript"></script><link href="navtree.css" rel="stylesheet" type="text/css" /><script src="resize.js" type="text/javascript"></script><script src="navtree.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(initResizable);

  $(window).load(resizeHeight);

</script><link href="search/search.css" rel="stylesheet" type="text/css" /><script src="search/search.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(function() { searchBox.OnSelectItem(0); });

</script><link href="doxygen.css" rel="stylesheet" type="text/css" /></head><body><div id="top"><div id="titlearea"><table cellpadding="0" cellspacing="0"><tbody><tr style="height: 56px;"><td id="projectlogo"><img alt="Logo" src="adobe_logo.png" /></td><td style="padding-left: 0.5em;"><div id="projectname">InDesign SDK &nbsp;<span id="projectnumber">14.0.0</span></div></td></tr></tbody></table></div><script type="text/javascript">

var searchBox = new SearchBox("searchBox", "search",false,'Search');

</script><div class="tabs" id="navrow1"><ul class="tablist"><li><a href="index.html"><span>InDesign&nbsp;SDK</span></a><li class="current"><a href="pages.html"><span>Documentation</span></a><li><a href="group__bosses__parent.html"><span>Bosses</span></a><li><a href="group__sdk.html"><span>Sample&nbsp;plug-ins</span></a><li><a href="classes.html"><span>Class&nbsp;Index</span></a><li><div class="MSearchBoxInactive" id="MSearchBox"><span class="left"> <img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="search/mag_sel.png" /> <input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search" /> </span><span class="right"> <a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="search/close.png" /></a> </span></div></ul></div></div><div class="ui-resizable side-nav-resizable" id="side-nav"><div id="nav-tree"><div id="nav-tree-contents"><div class="sync" id="nav-sync"></div></div></div><div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;"></div></div><script type="text/javascript">

$(document).ready(function(){initNavTree('id_getting_started_with_indesign_plugin_development.html','');});

</script><div id="doc-content"><div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()"><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Pages</a></div><div id="MSearchResultsWindow"><iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)"></iframe></div><div class="header"><div class="headertitle"><div class="title">Getting Started with InDesign Development </div></div></div><div class="contents"><div class="textblock"><h1><a class="anchor" id="id_introduction"></a> Introduction</h1><p>This guide gives an introduction to InDesign development. It covers native plug-in development, making plug-ins compatible with InDesign Server, and the use of ExtendScript (Adobe&#39;s implementation of JavaScript).<h2><a class="anchor" id="id_about_indesign_plug-ins"></a> About InDesign plug-ins</h2><p>Because InDesign, InCopy and InDesign Server share the same codebase and have the same underlying architecture, the InDesign SDK can be used to create plug-ins for all three products. The InDesign family of products is heavily based on plug-ins, with each application comprising a small executable that loads and initializes all of the plug-ins which make up the applications. Nearly all features of these applications are contributed by plug-ins. This plug-in architecture is made available to third-party developers in this SDK.<p>On Windows, plug-in are DLLs with a .pln or .apln file extension. On Mac OS, they are Frameworks with an &quot;.InDesignPlugin&quot; file extension.<p>The scope of this SDK is limited to these C++ plug-ins. There is another technology - CEP - that can be used to create extensions for InDesign and InCopy. CEP technology is not discussed here - please refer to following resources for more information on CEP:<ul><li>Creative Cloud Developers Prerelease program accessible from <a href="https://www.adobeprerelease.com/">https://www.adobeprerelease.com/</a><li><a href="https://github.com/Adobe-CEP/CEP-Resources">CEP GitHub site</a></ul><h2><a class="anchor" id="id_about_plugin_compatibility"></a> InDesign plug-ins compatibility across versions</h2><p>InDesign plug-ins need to be recompiled with the matching SDK for every major version. A plug-in that was built with the SDK corresponding to a specific major version of InDesign will not get loaded if dropped into an InDesign build with a different major version. This is because the public APIs offered by InDesign do keep evolving from release to release to support new product features as well as programming language features. Often the underlying compilers used to build the InDesign code base also change from version to version which may introduce incompatibilities. In most cases, you would find that a simple recompilation is all that is necessary. Sometimes at the time of some necessary architecture changes, deprecated OS API removal etc., the changes may be broader in nature.<p>When a minor update to InDesign is released, the API compatibility with the major version is maintained unless stated otherwise. Plug-ins built with the SDK of the major version should continue to work with the minor update without recompilation.<p>If the minor update is a feature bearing update, it&#39;s minor version is also updated. While API compatibility will be maintained with the major version (unless stated otherwise), if a plug-in is compiled with the SDK of this feature bearing update, it would no longer get loaded on any InDesign builds with the same major version but smaller minor version. In other words, plug-ins built with the InDesign 12.0 SDK should still load and work on InDesign 12.1, but plug-ins built with the InDesign 12.1 SDK will no longer load on InDesign 12.0.<h2><a class="anchor" id="id_mac_plugin_special_behavior"></a> Special behavior for InDesign plug-ins on Mac OS (since InDesign CC 2015.4)</h2><p>Since InDesign CC 2015.4, all plug-ins that Adobe ships by default with InDesign on Mac OS are installed inside the application package, which is also signed. You should not be installing any plug-ins inside the application package as that would invalidate the package signature. Instead, your plug-ins should be installed in the Plug-Ins folder that is in the same folder as the application package.<p>If a user runs InDesign from a folder other than the Applications folder on Mac and the Plug-Ins folder contains any plug-ins, InDesign will display an alert asking user&#39;s confirmation regarding whether these plug-ins should be loaded or not, as shown below:<div class="image"><img alt="mac-plugin-warning.gif" src="mac-plugin-warning.gif" /></div><p>This is a deliberate change to ensure that the user gets the opportunity to prevent any potentially malicious plug-ins from loading.<ul><li>If user chooses Yes, InDesign will load these plugins.<li>If user chooses No, InDesign will not load these plugins.</ul><p>The user choice is remembered as user preference for future launches. If any plugin is replaced, deleted or modified in this folder, InDesign will show the warning for subsequent launches only if user had chosen Yes earlier. In case, user had chosen No, he will not be shown a warning for any subsequent launch of InDesign.<p>Kindly note that the process outlined above will kick off only when user installs and launches InDesign from a non-default directory on Mac and the Plug-Ins folder contains plug-ins. If the user launches InDesign from the Mac Application folder, then no warning will be shown and everything from Plug-Ins folder will be loaded.<h3><a class="anchor" id="id_oem_plugins_change"></a> Impact on &quot;OEM&quot; plug-ins</h3><p>In InDesign installer, we used to include some InCopy workflow plug-ins openly within the &quot;OEM&quot; folder. The historical reason was that some of our partners replaced these plug-ins with their own custom plug-ins before deploying at their customer locations. These plug-ins lying openly constitute a security risk. Anyone with access to our installer can replace these plug-ins with malicious plug-ins of their own, and potentially bring down a customer&acirc;&#128;&#153;s machine.<p>To address this, Adobe plugins which are currently present in the &quot;OEM&quot; folder will also move inside the application package on Mac.<p>If you need to suppress loading of these plugins and instead want to use your own plugins, here is the approach that needs to be taken:<ul><li>Place your plugin inside Plug-Ins folder which lies in the same folder as the InDesign application package.<li>Ensure that the name of your plug-in does not conflict with the name of any Adobe plug-ins. If the name of your plugins are same as Adobe Plugins, your plugins won&acirc;&#128;&#153;t load.<li>To suppress loading of any Adobe plug-in, place a &quot;PlugInConfig.txt&quot; file in the same folder where InDesign is installed.<li>Specify the names of the Adobe Plugins which you want to suppress from loading. E.g. if you want to suppress all Adobe shipped OEM Plugins, specify their names. See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_plugin_config">Using PlugInConfig.txt</a> for more information on PlugInConfig.txt file.</ul><h3><a class="anchor" id="id_always_load_external_plugins"></a> Suppressing this warning in pre-release builds</h3><p>InDesign pre-release builds make use of a preprocessor directive named PRERELEASE which remains defined for much of the development cycle and is undefined as the development cycle is winding down towards the final release. In builds where the PRERELEASE directive is defined, developers can suppress this warning by defining a file or folder with the name <b>AllowLoadingExternalPlugins</b> in the root volume of their machines.<p>Once the PRERELEASE directive is undefined close to the end of the development cycle, this warning will get activated once more, irrespective of the presence of the above-mentioned file or folder.<h2><a class="anchor" id="id_plug-in_classification"></a> Plug-in classification</h2><p>An InDesign plug-in can be classified in two ways:<ul><li>By the applications under which they can load. For example, you may create an InCopy only plug-in.<li>As model or user-interface plug-ins.<ul><li>A model plug-in writes data to an InDesign document.<li>A user-interface plug-in provides a user interface.</ul></ul><p>An InDesign plug-in must identify whether it supports model or user-interface operations and which applications it can be loaded by.<h2><a class="anchor" id="id_how_indesign_plug-ins_are_developed"></a> Programming languages</h2><p>InDesign is written in C++ and makes heavy use of a resource compiler called ODFRC (OpenDoc Framework Resource Compiler). ODFRC files end with the &quot;.fr&quot; extension and are used for many things, including user interfaces like panels and dialogs, menus, and localization of strings. <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_introduction_to_odfrc">Introduction to ODFRC</a> gives a high-level overview of most of what you can expect to encounter in an ODFRC (.fr) file.<p>Perhaps most significantly, ODFRC is used to define and extend classes in the InDesign object model. These are not C++ classes, but rather an InDesign type of class called a boss. Working with bosses and instantiated boss objects is at the heart of InDesign plug-in development. Bosses are mentioned in passing in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_introduction_to_odfrc">Introduction to ODFRC,</a> then are covered more thoroughly in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_introduction_to_the_indesign_object_model">Introduction to the InDesign Object Model</a>.<h1><a class="anchor" id="id_getting_started_with_the_indesign_sdk"></a> Getting Started</h1><p>An InDesign plug-in is an extension library that is loaded dynamically by InDesign. It represents a standard interface to InDesign. On Windows &reg;, it is a dynamic link library (a DLL). On Mac OS&reg;, it is a dynamic shared library packaged in a framework (e.g. a package).<h2><a class="anchor" id="id_sdk_overview"></a> SDK Overview</h2><h3><a class="anchor" id="id_libraries"></a> Libraries</h3><p>InDesign plug-in development requires the use of several libraries supplied in this SDK. On Windows, this amounts to only a handful of static lib files. Debug and release versions of these libraries are in the following locations:<div class="fragment"><div class="line">&lt;SDK&gt;/build/win/objd</div><div class="line">&lt;SDK&gt;/build/win/objr</div></div><p>To support 64-bit Windows plug-ins, 64-bit versions are in the following location:<div class="fragment"><div class="line">&lt;SDK&gt;/build/win/objdx64</div><div class="line">&lt;SDK&gt;/build/win/objrx64</div></div><p>Compiling on the Mac requires many dynamic libraries and Framework files. These files are embedded in a directory structure that resembles the actual application package:<div class="fragment"><div class="line">&lt;SDK&gt;/build/mac/debug_cocoa64/packagefolder/contents/macos</div><div class="line">&lt;SDK&gt;/build/mac/release_cocoa64/packagefolder/contents/macos</div></div><dl class="section note"><dt>Note<dd>Several libraries also are available in the &lt;SDK&gt;/external directory. These libraries originated outside the InDesign engineering team. These libraries include things like Boost. Windows typically uses these libraries in place. On Mac, a copy is moved or a symlink is created in the appropriate package folder.</dl><h3><a class="anchor" id="id_source_code"></a> Source Code</h3><p>The InDesign Plugin SDK contains several different types of source-code files.<p><b>The public API</b><p>InDesign-specific public headers are in the following directory:<div class="fragment"><div class="line">&lt;SDK&gt;\source\public</div></div><p><b>External APIs</b><p>Several header files are in the external folder:<div class="fragment"><div class="line">&lt;SDK&gt;\external</div></div><p>These are not InDesign-specific header files, but they may be used in the InDesign code base. One example is the header files for the Boost C++ library, a non-Adobe library that is used in InDesign. Another example is the header files for the Adobe File Library, an Adobe-engineered library that is not specific to InDesign.<p><b>Open folder</b><p>The goal of the &quot;open&quot; folder is to provide production InDesign user-interface code to developers, as examples of complex InDesign user-interface code, and to provide complete plug-ins. At a minimum, an open plug-in must be able to compile with the Release target. An open plug-in might or might not be able to compile with the Debug target.<p>The open folder is not a public API: The code may changed or be removed in the next version.<dl class="section note"><dt>Note<dd>Open plug-ins are not documented in the SDK.</dl><p>The open folder has three subfolders:<ul><li>Components - &lt;SDK&gt;/source/open/components/. The source for the plug-ins.<li>Includes - &lt;SDK&gt;/source/open/includes/. Subfolders that group the include files into functional categories.<li>Interfaces - &lt;SDK&gt;/source/open/interfaces/. Subfolders that group the include interface files into functional categories.</ul><p>Project files for the Open plug-ins are located at:<p>&lt;SDK&gt;/build/mac|win/prj/. The open project files are named with the following extensions:<ul><li>.open.xcodeproj on Mac<li>.open.vcxproj on Windows</ul><p><b>Sample plug-ins</b><p>The SDK contains many sample plug-ins. The project files are in the following directory:<div class="fragment"><div class="line">&lt;SDK&gt;/build/mac|win/prj</div></div><p>The source files for the sample projects are in the following directory:<div class="fragment"><div class="line">&lt;SDK&gt;/source/sdksamples</div></div><dl class="section note"><dt>Note<dd>For Mac there is an Xcode workspace called SDKSamples.xcworkspace which contains all the SDK samples on Mac. For Windows there is a Visual Studio solution file at called SDKSamples.sln. These files enable you to browse all of the SDK samples in one place and also build them all very easily.</dl><p><b>SnippetRunner</b><p>One SDK sample project of note is called SnippetRunner. The SnippetRunner sample plug-in provides a convenient way to demonstrate and test small snippets of code. Many snippets are included with it. A typical use-case for using SnippetRunner is if you want to try some small piece of code out without having to create a completely new plug-in, which involves many files and layers of complexity.<p>All the SDK code snippets included in Snippet Runner are located in the following at:<div class="fragment"><div class="line">&lt;SDK&gt;/source/sdksamples/codesnippets</div></div><dl class="section note"><dt>Note<dd>To help you create a snippet of your own, a snippet template called SnpTemplate.cpp, is included in the SnippetRunner project. Open this file in the project, and the comment block for the <a class="el" href="class_snp_template.html">SnpTemplate</a> class provides instructions for creating your own code snippet.</dl><p><b>Tools</b><p>The &lt;SDK&gt;/devtools folder contains a &#39;bin&#39; directory that contains tools that are essential to InDesign plug-in development. They are used to help compile and merge resources with the plug-in executable during Xcode/Visual Studio project compilation. The projects in different platforms require different sets of tools, but you need not be concerned about how to use them, as long as your project settings are similar to the SDK samples.<p>In the devtools folder you will also find tools for creating new plug-in projects (&#39;dolly&#39;), for converting a plug-in to use EVE for dialog layout (&#39;eveconverter&#39;) and other tools like &#39;DebugWindow&#39; which enables you to view debug output in a window running outside InDesign.<p>There are also IDML tools in the SDK. These are Java-based tools for working with IDML, ICML, and IDMS files. These tools allow you to validate package and nonpackage files, compress and decompress IDML packages, and generate and transform IDML files with XSLT.<p>A &#39;statics_reporter&#39; tool is provided for searching InDesign&#39;s object code for global and static variables, producing a text file for each object file that contains globals or statics.<h2><a class="anchor" id="id_development_environments"></a> Development environments</h2><h3><a class="anchor" id="id_requirements"></a> Requirements</h3><p>The required environment for developing plug-ins for InDesign varies by operating system.<p><b>Windows</b><table class="doxtable"><tr><th>Required component</th><th>Notes </th></tr><tr><td>Windows 7 with Service Pack 1 or later</td><td></td></tr><tr><td>Visual C++ </td><td>A component of Visual Studio 2017 (15.7.4 or higher). </td></tr></table><p>Before building on Windows, you need to alter the environment so Visual Studio knows where to find our custom Adobe build tools, such as ODFRC. If you generated the project and it&#39;s props files using Dolly, this should already be set. If you need to set it manually, this setting is now part of the project&#39;s property pages:<ol type="1"><li>Start Visual Studio 2017.<li>Open your project file.<li>Right-click on the project name in Solution Explorer and choose Properties from the context menu.<li>Change the Configuration drowpdown to &quot;All Configurations&quot; and the Platform dropdown to &quot;All Platforms&quot;.<li>Switch to the &quot;VC++ Directories&quot; property page in the Configuration Properties control.<li>Inspect the &quot;Executable Directories&quot; property on the right side control to check if devtools\bin subdirectory in your local copy of the SDK is already included.<li>If it is not included, insert \devtools\bin\; at the beginning of the value for &quot;Executable Directories&quot;.<li>Click OK to dismiss the property page dialog.</ol><p><b>Mac OS</b><p>Developing plug-ins under Mac OS has the following additional requirements:<table class="doxtable"><tr><th>Required component </th></tr><tr><td>Mac OS 10.12.6 or later </td></tr><tr><td>Xcode 9.2 </td></tr></table><h3><a class="anchor" id="id_compiling_and_executing_sample_code"></a> Compiling and executing sample code</h3><p><b>Building sample plug-ins</b><p>Open SDKSamples.xcworkspace (Mac) or SDKSamples.sln (Win) and build all the samples:<p>Windows: Build &gt; Rebuild Solution Mac OS: Product &gt; Build.<p><b>Launching InDesign with the samples</b><p>For your plug-ins to be used in InDesign, InDesign must know about your plug-ins at launch time. You can do this in one of two ways:<ol type="1"><li>Use a special configuration file called PlugInConfig.txt<li>Copy your plug-in to InDesign&#39;s Plug-ins folder.</ol><p><a class="anchor" id="id_plugin_config"></a><b>Using PlugInConfig.txt</b><ol type="1"><li>If InDesign is running, exit it.<li>Go to the inDesign preference folder in the following directory (where &lt;locale&gt; is a locale-specific subdirectory; for example, en_US for English): <div class="fragment"><div class="line">Windows 7: C:\Users\&lt;user&gt;\AppData\Roaming\Adobe\InDesign\Version &lt;..&gt;\&lt;locale&gt;</div><div class="line">Mac OS: /Users/&lt;user&gt;/Library/Preferences/Adobe InDesign/Version &lt;..&gt;/&lt;locale&gt;</div></div><li>Create a text file with the naming below in that directory: For Mac OS and Windows 64-bit, name the file &quot;PluginConfig.txt&quot; For Windows 32-bit plug-in development, name the file &quot;PluginConfig32.txt&quot;<li>Copy the following text into the text file you&#39;ve created (adjusting the path to the SDK for your system). Windows: <div class="fragment"><div class="line">=Path</div><div class="line"><span class="stringliteral">&quot;&lt;sdk&gt;\build\win\debug\sdk&quot;</span></div></div> Mac OS: <div class="fragment"><div class="line">=Path</div><div class="line"><span class="stringliteral">&quot;Macintosh HD:Users:&lt;user&gt;:&lt;sdk&gt;:build:mac:debug_cocoa64:sdk&quot;</span></div></div><li>Save the PlugInConfig.txt file.<li>Restart InDesign.<li>Verify that the set of plug-ins loaded by selecting the About Plug-ins menu.</ol><dl class="section note"><dt>Note<dd>You also can use an &quot;=Exclude&quot; tag to exclude a certain plug-in from being loaded. This is useful if you do not want to load everything in the &quot;=Path&quot; folder.<dd> This is target specific. You cannot launch the release version of InDesign with debug plug-ins. It is convenient to add both debug and release paths, commenting out the target that is not in use. For single-line comments, start the comment line with a &quot;;&quot; (semicolon).</dl><p><b>Having the project build directly into the Plug-ins folder</b><p>You can change the project setting so the plug-in binary is built directly into the InDesign application&#39;s Plug-ins folder.<p>On Windows, the project&#39;s output setting is specified in the Visual Studio project&#39;s Properties &gt; Configuration Properties &gt; Linker &gt; General &gt; Output File. Enter the following value:<div class="fragment"><div class="line">C:\Program Files (x86)\Adobe\Adobe InDesign &lt;version&gt;\Plug-ins\</div></div><p>On Mac OS, the project&#39;s output setting is specified in the Xcode project&#39;s BUILT_PRODUCTS_DIR variable in each Target. Enter the following value:<div class="fragment"><div class="line">/Applications/Adobe InDesign &lt;version&gt;/Plug-ins/</div></div><h3><a class="anchor" id="id_starting_a_debugging_session_from_your_plugin_project"></a> Starting a debugging session from your plug-in project</h3><p><b>Windows</b><p>If you haven&#39;t set your project to build directly into the Plug-ins folder, make sure that your plug-in is loaded into InDesign. Build your plug-in and copy the binary over to the InDesign Plug-ins folder. The default output location for plug-ins is:<div class="fragment"><div class="line">&lt;SDK&gt;/build/win/prj/debug|release/</div></div><ol type="1"><li>From your project window, go to Project &gt; Properties &gt; Configuration Properties &gt; Debugging &gt; <a class="el" href="class_command.html">Command</a>.<li>Select Browse and go to InDesign.exe in your InDesign folder.<li>Select InDesign.exe and click OK to begin the debugging session.</ol><p><b>Mac OS</b><p>To debug an InDesign plug-in from an Xcode project, make sure your plug-in is loaded into InDesign. If you haven&#39;t set your project to build directly into the Plug-ins folder, build your plug-in and copy the binary into the InDesign Plug-ins folder. The default output location for plug-ins is:<div class="fragment"><div class="line">&lt;SDK&gt;/build/mac/prj/debug_cocoa64|release_cocoa64/</div></div><ol type="1"><li>From your project window, go to the Active Target pop-up menu on the top left corner of the project window and select Edit Scheme &gt; Run &gt; Info.<li>Set the executable to be Adobe InDesign &lt;version&gt; and click Choose.<li>Select Run to begin the debugging session.</ol><h2><a class="anchor" id="id_anatomy_of_a_plugins_project_files"></a> Anatomy of a plug-in&#39;s project files</h2><p>Typically, an InDesign project contains the following C++, ODFRC, and library files.<h3><a class="anchor" id=""></a></h3><ul><li>Declaration of abstract base classes for interfaces.<li>Definition of implementation classes.<li>Identification of the implementation ID and name of the InDesign object model.</ul><h3><a class="anchor" id="id_odfrc_resource_files"></a> ODFRC resource files</h3><ul><li>The PluginVersion resource establishes a plug-in&#39;s name/ID, the plug-in version and InDesign version required, and the plug-in&#39;s data-format number for conversion.<li>Boss resources establish relationships among boss IDs for the InDesign object model, the IDs of interfaces, and the IDs of C++ implementations.<li>Localization mechanism.<li>User-interface widget declaration.<li>Data-conversion schema and plug-in dependency.</ul><h3><a class="anchor" id="id_library_files"></a> Library files</h3><p>Public libraries that contains code that you must link against when building your plug-in.<h2><a class="anchor" id="id_tutorial_creating_a_plug_in_from_scratch"></a> Tutorial: Creating your first plug-in</h2><p>The rest of this chapter guides you through creating a basic InDesign plug-in and illustrates how to add functionality to that basic plug-in.<p>The source code for InDesign plug-ins is largely platform independent. The InDesign plug-in development process is unique, because it has its own user-interface and object-oriented API. This section focuses on these two unique aspects, to help you develop plug-ins for both Windows and Mac OS.<h3><a class="anchor" id="id_introducing_the_sample_plug-in"></a> Introducing the sample plug-in</h3><p>The example describes how to build the WriteFishPrice sample plug-in that is available in the InDesign SDK. This sample allows the user to enter fish names and current prices into a text frame at the text-cursor position. It incorporates several common user-interface components: menus, dialog boxes, pull-down menus, text-edit boxes, static-text fields, and buttons.<p>To see the finished plug-in toward which you are working, start InDesign with WriteFishPrice loaded, and create a document. In the new document, create a text frame and place a text cursor in the frame. From the main menu, choose Plug-In &gt; SDK &gt; WriteFishPrice(US):<div class="image"><img alt="wfp-mainmenu.gif" src="wfp-mainmenu.gif" /></div><p>The WriteFishPrice(US) dialog opens:<div class="image"><img alt="wfp-dialog.gif" src="wfp-dialog.gif" /></div><p>From the drop-down menu, select a fish name. Enter its price in the text box:<div class="image"><img alt="wfp-fishprice.gif" src="wfp-fishprice.gif" /></div><p>When you click OK, the name of the fish selected from the drop-down menu and the price you entered appear in the text frame at the insertion point of the text cursor. As you continue making entries in the text frame, the output appears like that shown here:<div class="image"><img alt="Goal_InsertedAllItems.gif" src="Goal_InsertedAllItems.gif" /></div><p>This simple plug-in serves as a good starting point, because it incorporates fundamental and common components. The following sections describe how to create this plug-in. The main steps are as follows:<ol type="1"><li>Use Dolly to generate a dialog-based plug-in project<li>Add a DropDownListWidget to the dialog 3: Add a TextEditBoxWidget 4: Add a StaticTextWidget 5: Obtain a value from DropDownListWidget 6: Get the text in the TextEditBoxWidget 7: Insert a string into a text frame 8: Disable the menu with no text selection 9: Initialize dialog widgets</ol><h2><a class="anchor" id="id_step_1_use_dollyxs_to_generate_a_dialog-based_plug-in_project"></a> Step 1: Use Dolly to generate a dialog-based plug-in project</h2><p>Dolly is a tool included in the SDK for generating plug-in projects for Visual Studio and Xcode.<p>To create a working plug-in that provides a solid starting point for your plug-in development, you can run DollyXs and fill in the fields in the DollyXs interface. For this example, you will choose a dialog-box user interface as the foundation for your WriteFishPrice plug-in.<h3><a class="anchor" id="id_step_11_start_dollyxs"></a> Step 1.1. Start DollyXs</h3><p>To start Dolly, double click dolly.jar which is at &lt;SDK&gt;/devtools/dolly/dolly.jar. If this fails to launch the app, use the command line to launch it:<div class="fragment"><div class="line">java -jar dolly.jar </div></div><div class="image"><img alt="getting-started-1.gif" src="getting-started-1.gif" /></div><h3><a class="anchor" id="id_step_12_specify_plug-in_names"></a> Step 1.2: Specify plug-in names</h3><p>In the Plugin tab, enter the two plug-in names:<ul><li>Long Name is the name of the plug-in itself. It is used as a string in the Plug-ins menu and in the About This Plug-in dialog.<dl class="section note"><dt>Note<dd>do not enter a long name with whitespace, since this name is also used as the filename for the Visual Studio and Xcode project files.</dl><li>Short Name is a prefix used as part of the source-code file names, class names, and IDs that are generated.</ul><p>For this exercise, enter WriteFishPrice for Long Name and WFP for Short Name.<p>For Author, enter your name. This string is used in the About This Plug-in dialog and comments in source code.<h3><a class="anchor" id="id_step_13_specify_the_prefix_id"></a> Step 1.3: Specify the prefix ID</h3><p>A prefix ID is a unique value assigned by Adobe for your plug-in development. Given a prefix ID, 256 unique IDs can be created for each ID space (e.g. kClassIDSpace). For plug-ins that you will release outside your organization, make sure to use a prefix ID assigned to you by Adobe.<p>To request a new Prefix ID please send the following information to <a href="#" onclick="location.href=&#39;mai&#39;+&#39;lto:&#39;+&#39;wwd&#39;+&#39;s@&#39;+&#39;ado&#39;+&#39;be&#39;+&#39;.co&#39;+&#39;m&#39;; return false;">wwds@<span style="display: none;">.nosp@m.</span>adob<span style="display: none;">.nosp@m.</span>e.com</a>:<ul><li>Your name:<li>Your company:<li>Your Adobe ID:<li>Purpose of the Prefix:</ul><dl class="section note"><dt>Note<dd>This is very important, because the prefix ID is used to define the plug-in&#39;s IDs and resources. There must be no overlap in the prefix IDs used by plug-ins. Plug-ins with the same prefix ID cannot be loaded simultaneously.</dl><p>For this exercise, specify 0xe9400 (the default).<h3><a class="anchor" id="id_step_14_specify_directory_locations"></a> Step 1.4: Specify directory locations</h3><p><b>Windows</b><p>Click the Win tab, and specify the directory paths that you want to use. For Project Dir, specify the complete path to the directory where you want your Visual Studio project file (.vcxproj) to be generated. If you unzipped the SDK in a different directory, edit the default path.<p>The other directories are relative to Project Dir. For this exercise, you will work in the WriteFishPrice directory. For Source Dir and Header Dir, specify WriteFishPrice as your subdirectory in sdksamples.<p>The Shared RSP Files group lets you use existing .rsp file(s). A .rsp file is used in an SDK project to specify common search paths for the C++ and ODFRC compilers.<p><b>Mac OS</b><p>Click the Mac tab, and specify the directory paths that you want to use. For Project Dir, specify the complete path to the directory where you want your Xcode project (.xcodeproj) file to be generated. If you installed the SDK in a different directory, edit the path.<p>The other directories are relative to Project Dir. For this exercise, you will work in the WriteFishPrice directory. For Source Dir and Header Dir, specify WriteFishPrice as your subdirectory in sdksamples.<p>In the Architectures pop-up menu, the choice corresponds to the Architectures variable in the Xcode&#39;s project/target setting. Choose the platform that you want to target.<p>The Shared XCConfig Files group lets you use existing xcconfig files on your computer. The xcconfig file is used in the Xcode project to provide base settings for project/targets. The file specified in the Main xcconfig field is used as the xcconfig file for the project-level build setting in the generated project; the file specified in the Debug xcconfig field is used for the Debug-target build setting; and the file specified in the Release xcconfig field is used for the Release-target build setting. The SDK comes with a set of xcconfig files in the projects folder, which you can reuse if you use settings like those in the SDK project.<h3><a class="anchor" id="id_step_15_specify_template"></a> Step 1.5: Specify template</h3><p>Click the Features tab, and select Generate Dialog.<h3><a class="anchor" id="id_step_16_verify_entered_information_and_generate_plug-in_project"></a> Step 1.6: Verify entered information and generate plug-in project</h3><p>Verify your settings, then click OK.<p>Verify that DollyXs has generated files in the project and code directories you specified. In the project directory, you should see WriteFishPrice.vcxproj or WriteFishPrice.xcodeproj. In the source directory, you should see a group of C++ source files that begin with WFP. For details about each file, see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_files_included_in_the_project_generated_by_dollyxs">Files included in the project generated by DollyXs</a>.<h3><a class="anchor" id="id_step_17_build_the_plug-in"></a> Step 1.7: Build the plug-in</h3><p><b>Windows</b><p>Before building your plug-in, set up your InDesign development environment (IDE) to use the InDesign ODFRC. To do this, choose Tools &gt; Options, and add the &lt;SDK&gt;\devtools\bin directory under the Executable Files directory path.<p>To build your plug-in:<ol type="1"><li>Open WFP.vcxproj using Microsoft Visual C++.<li>When the project is open, make sure Debug is the active configuration: Choose Project &gt; WriteFishPrice Properties. The configuration in the Property Pages dialog box should be Active (Debug).<li>To build the plug-in, choose Build &gt; Build WriteFishPrice.<li>When you are asked to save a Solutions file (.sln), save it to the same directory as the project (.vcxproj) file.</ol><p><b>Mac OS</b><p>The Xcode project generated by DollyXs is already set up to find the ODFRC compiler from its default SDK location. Unless you moved the ODFRC.cmd to somewhere other than its default location, you do not need to do anything to specify the location of the ODFRC compiler.<p>To build your plug-in:<ol type="1"><li>Open the WriteFishPrice.xcodeproj file using Xcode.<li>Choose Debug from the Active Target pop-up menu, on the top left corner of the project window.<li>Choose Product &gt; Build, or click the Run button on the Project Window.</ol><h3><a class="anchor" id="id_step_18_load_the_plug-in"></a> Step 1.8: Load the plug-in</h3><p>The plug-in you just built has the filename WriteFishPrice.pln (Windows) or WriteFishPrice.InDesignPlugin (Mac OS) and is in the following directory in your &lt;SDK&gt; directory:<p>Windows:<ul><li>Debug: &lt;SDK&gt;\build\win\debug\SDK<li>Release: &lt;SDK&gt;\build\win\release\SDK</ul><p>Mac OS:<ul><li>Debug: &lt;SDK&gt;/build/mac/debug/SDK<li>Release: &lt;SDK&gt;/build/mac/release/SDK</ul><p>Copy the WriteFishPrice plug-in file to the Plug-Ins directory in the InDesignstallation directory; then the WriteFishPrice plug-in will be loaded when InDesign is launched.<dl class="section note"><dt>Note<dd>Do not install debug plug-ins to the Plug-Ins directory for the release build of InDesign, or vice versa; if you do, your plug-in will fail to load.</dl><p>When the plug-in is loaded, InDesign displays a Plug-Ins menu containing a WriteFishPrice menu item.<h3><a class="anchor" id="id_step_19_start_indesign_through_your_ide"></a> Step 1.9: Start InDesign through your IDE</h3><p>If you successfully built and loaded your plug-in, you can start InDesign through your IDE by following the steps below.<p>Visual Studio:<ol type="1"><li>With project file open and highlighted in the solution explorer, choose Project &gt; Properties.<li>In the Debugging panel of Configuration Properties, set the <a class="el" href="class_command.html">Command</a> field to the full path to InDesign.exe.<li>Click OK to close the dialog.<li>To start InDesign, and start debugging your plug-in, choose Debug &gt; Start Debugging.</ol><p>Xcode:<ol type="1"><li>With project file open, choose Product &gt; Scheme &gt; Edit Scheme...<li>In the &#39;Info&#39; tab set the executable to be InDesign &lt;version&gt;.app<li>Click OK to close the dialog.</ol><ol type="1"><li>Click the &#39;Run&#39; button in the top menu section of Xcode (or the menu Product &gt; Run).</ol><p>After you start InDesign, open the dialog from the Plug-Ins menu: <div class="image"><img alt="Step1_BlankDialog.gif" src="Step1_BlankDialog.gif" /></div><p>No widgets are placed on your dialog yet, nor is the menu name correct, so you still have some work to do.<h2><a class="anchor" id="id_files_included_in_the_project_generated_by_dollyxs"></a> Files included in the project generated by Dolly</h2><p>This section describes the files that Dolly generates. Go back to the project in your IDE, and follow along with this section to examine each file.<h3><a class="anchor" id="id_source_files"></a> Source files</h3><p>Of the files in the following list, <a class="el" href="_w_f_p_factory_list_8h_source.html">WFPFactoryList.h</a> and TriggerResourceDeps.cpp are not visible in your project. To locate these files, go to your project&#39;s source files.<ul><li><a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a> - This header file is a central repository for plug-in IDs. Some IDs are numeric, and some are string values; some IDs are unique across the application, and some are unique only within the plug-in. This file is critical for plug-ins and is included by all plug-in project files.<li><a class="el" href="_w_f_p_factory_list_8h_source.html">WFPFactoryList.h</a> - This header file contains macros that allow the core InDesign object model to create and destroy instances of the implementations through factory classes.<li>WFPNoStrip.cpp - This file prevents the C++ compiler optimizations from dead stripping (eliminating code that appears to the compiler to be unused). Because most of the code in a plug-in is not used directly from within the plug-in itself, much of this code can appear to the compiler to be dead. WFPNoStrip.cpp contains a function, DontDeadStrip, which includes <a class="el" href="_w_f_p_factory_list_8h_source.html">WFPFactoryList.h</a>.<li>WFPID.cpp - This file allows the IDs defined in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a> to be included as strings in the debug build symbols.<li>SDKPlugInEntrypoint.cpp - This file, in the &lt;SDK&gt;/source/sdksamples/common directory, specifies the plug-in&#39;s entry point. This file is not modified by any DollyXs settings but is simply included in the project.<li>TriggerResourceDeps.cpp - This file ensures that the ODFRC resource is relinked when the .fr file is compiled on Windows.<li>WFPDialogController.cpp - This source file contains a class used for initializing, validating, and responding to dialog widgets. The <a class="el" href="class_w_f_p_dialog_controller.html">WFPDialogController</a> class specifies what happens when the dialog is initialized and when OK is clicked.<li>WFPDialogObserver.cpp - The <a class="el" href="class_w_f_p_dialog_observer.html">WFPDialogObserver</a> class in this file dynamically processes changes to the widgets on the dialog. To observe events pertaining to any other widgets you may place on the dialog, this is where you add your code.<li>WFPActionComponent.cpp - The <a class="el" href="class_w_f_p_action_component.html">WFPActionComponent</a> class in this source file defines what happens when the plug-in&#39;s menu item is selected. In this case, the Plug-Ins menu item and About This Plug-In menu items are handled. The About This Plug-In menu item is displayed in the Help &gt; About Plug-Ins &gt; SDK menu item (Windows) or the Apple Menu menu item (Mac OS). This class also opens the About This Plug-In dialog box in the DoAbout method.</ul><h3><a class="anchor" id="id_resource_files"></a> Resource files</h3><p>Of the files in the following list, only WFP.fr is visible. To locate the other resource files, go to your project &#39;s source files.<ul><li>WFP.fr - This file defines resources unique to InDesign. These cross-platform resource definitions are compatible with Windows and Mac OS. This file contains resources other than strings.<li>WFP_enUS.fr - This file contains string resources in a string-table resource used for the US English locale. These resources are used when the plug-in is used with InDesign in the US English locale. Also, this file can contain user-interface specifications, especially when they differ by locale.<li>WFP_jaJP.fr - This file contains string resources in a string-table resource used for the Japanese locale. These resources are used when the plug-in is used with InDesign in the Japanese locale. Also, this file can contain user-interface specifications, especially when they differ by locale.<li>WFP.rc - This file defines resources specific to Windows; in particular, the plug-in file version.</ul><h3><a class="anchor" id="id_project_files"></a> Project files</h3><ul><li>WFP.vcxproj - This is a Visual C++ project file for Windows. By default, it is in &lt;SDK&gt;\build\win\prj.<li>WFP.xcodeproj - This is an Xcode project file for Mac OS. By default, it is in &lt;SDK&gt;/build/mac/prj.</ul><h3><a class="anchor" id="id_detailed_descriptions_of_code_generated_by_dollyxs"></a> Detailed descriptions of code generated by DollyXs</h3><p>This section provides more detail about the source files that you will modify throughout this exercise. Follow along with this section by using your IDE to open and examine the code of each file.<p><b>WFPActionComponent.cpp</b><ul><li><a class="el" href="class_w_f_p_action_component.html">WFPActionComponent</a> - This class inherits the <a class="el" href="class_c_action_component.html">CActionComponent</a> class, which implements the <a class="el" href="class_i_action_component.html">IActionComponent</a> interface. The <a class="el" href="class_w_f_p_action_component.html">WFPActionComponent</a> class responds to menu selections in the DoAction method and distinguishes the selected menu item by means of the corresponding ActionID.<li><a class="el" href="class_w_f_p_action_component.html#a605ef784ce275e810b16f27f680f2722">WFPActionComponent::DoAction</a> - This method overrides the DoAction method in its parent class, (<a class="el" href="class_c_action_component.html">CActionComponent</a>), receives the selected ActionID as a parameter, and compares it with kWFPAboutActionID and kWFPDialogActionID (defined in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a>). If there is a match, the DoAction method calls the appropriate DoAbout or DoDialog method.<li>WFPActionComponent::DoAbout - This method is called from <a class="el" href="class_w_f_p_action_component.html#a605ef784ce275e810b16f27f680f2722">WFPActionComponent::DoAction</a>. It displays a <a class="el" href="class_c_alert.html#a411ff8eb8f4420f179a6f29abe68ecd5">CAlert::ModalAlert</a> dialog.<li>WFPActionComponent::DoDialog - This method first obtains the <a class="el" href="class_i_application.html">IApplication</a> interface by means of GetExecutionContextSession()-&gt; QueryApplication(). GetExecutionContextSession() returns a pointer to the <a class="el" href="class_i_session.html">ISession</a> interface aggregated in the <a class="el" href="classk_session_boss.html">kSessionBoss</a>, which is a boss-class object that describes the current InDesign application session. <a class="el" href="class_i_application.html">IApplication</a> is an interface aggregated on <a class="el" href="classk_app_boss.html">kAppBoss</a>, which is a boss-class object that describes the InDesign application itself. See the following figure. From the <a class="el" href="class_i_application.html">IApplication</a> interface, DoDialog obtains the <a class="el" href="class_i_dialog_mgr.html">IDialogMgr</a> interface, which enables you to get to the InDesign dialog manager&#39;s boss class. Next, DoDialog loads the dialog resources that correspond to the current user-interface locale during the first instantiation, and DoDialog saves it to the InDesign database, so it can be loaded efficiently during subsequent instantiations. The current user-interface locale is obtained by instantiating a <a class="el" href="class_rsrc_spec.html">RsrcSpec</a> object, dialogSpec, by calling LocaleSetting::GetLocale. There are several kinds of constructors for the <a class="el" href="class_rsrc_spec.html">RsrcSpec</a> object, but this method uses the constructor shown in the code. As shown, once you instantiate a <a class="el" href="class_rsrc_spec.html">RsrcSpec</a> object, DoDialog calls the CreateNewDialog method on the <a class="el" href="class_i_dialog_mgr.html">IDialogMgr</a> interface. The parameter list contains the dialogSpec that was just instantiated and a constant that specifies the modality of the dialog (kMovableModal constant defined in the <a class="el" href="class_i_dialog.html">IDialog</a> interface). CreateNewDialog then creates a movable dialog based on the dialogSpec and returns a pointer to a dialog (<a class="el" href="class_i_dialog.html">IDialog</a> on <a class="el" href="classk_dialog_window_boss.html">kDialogWindowBoss</a>, or a derived boss class). Finally, the Open method on the <a class="el" href="class_i_dialog.html">IDialog</a> interface is called, and the dialog is opened.</ul><div class="image"><img alt="kSession_kAppBossBridge.gif" src="kSession_kAppBossBridge.gif" /></div><p><b>WFPDialogObserver.cpp</b><ul><li><a class="el" href="class_w_f_p_dialog_observer.html">WFPDialogObserver</a> - This class inherits the <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a> class, which implements the <a class="el" href="class_i_observer.html">IObserver</a> interface. Through this class, you can register to observe dynamic changes to the widgets on the dialog. The example simply provides some stub code so your code can observe changes to widget states, such as a custom button. The observer provides a mechanism to listen to changes to specific objects, known as subjects. By attaching to a subject, observers can be notified when a change occurs, rather than having to poll for changes.<li><a class="el" href="class_w_f_p_dialog_observer.html#a07f9c4d9323352cf4d7efe7c73dc3236">WFPDialogObserver::AutoAttach</a> - This method is called by the application and enables observers to attach themselves to a subject. By attaching, an observer can be notified when there is a change to the subject. In the example, there are no widgets handled. If you need to observe other widgets on this dialog, you can add them here. Alternately, you can observe each widget in separate observers. To keep the code simple, however, the example collectively observes all widgets on this dialog. By default, the OK and Cancel buttons (with widget IDs of kOKButtonWidgetID and kCancelButton_WidgetID, respectively) are observed by the parent class, <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>. Consider how this works. First, the <a class="el" href="class_w_f_p_dialog_observer.html#a07f9c4d9323352cf4d7efe7c73dc3236">WFPDialogObserver::AutoAttach</a> method calls the <a class="el" href="class_c_dialog_observer.html#a95aa7441ca5f84fa0f18d3bac9f0d64a">CDialogObserver::AutoAttach</a> method in the parent class. This is so the OK and Cancel buttons can be handled. Afterward, the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface (from the same boss object that hosts the current implementation, <a class="el" href="class_w_f_p_dialog_observer.html">WFPDialogObserver</a>) is obtained and, by using the parent class&#39;s <a class="el" href="class_abstract_dialog_observer.html#a8e5b239768d1febc8fce3431e031ec48">CDialogObserver::AttachToWidget</a> method, it can attach to any other widget on the dialog.<li><a class="el" href="class_w_f_p_dialog_observer.html#a8ff914e5b75b6e2136753d81907a69c2">WFPDialogObserver::AutoDetach</a> - This method, which is called by the InDesign application, allows observers to detach from a subject. Detaching an observer is the reverse of attaching, which means the detached observer is no longer notified of changes. Again, the OK and Cancel buttons are handled by default in the parent class, <a class="el" href="class_c_dialog_observer.html">CDialogObserver</a>. Like the AutoAttach method, the <a class="el" href="class_c_dialog_observer.html#ad91a4bf57cc5f99313554412daeb0824">CDialogObserver::AutoDetach</a> method is called to handle the OK and Cancel buttons. Afterward, the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface (from the same boss class in which the current class resides) is obtained and, by using the parent class&#39;s <a class="el" href="class_abstract_dialog_observer.html#a61bc7848d2a80195e67f422ecb9603e6">CDialogObserver::DetachFromWidget</a> method, an observer can detach from any other widget on the dialog.<li><a class="el" href="class_w_f_p_dialog_observer.html#ac835c2fa092cd94d4c5cdea2c1d83ccd">WFPDialogObserver::Update</a> - This method is called by the host when a change occurs to the observed object. (In the example, there are no widgets other than the OK and Cancel buttons, so there is not much extra code.) When a widget is changed, the <a class="el" href="class_c_dialog_observer.html#ad4f904d1f4fab20476b2dbe3b6537529">CDialogObserver::Update</a> method is called to handle the OK and Cancel buttons up front, then the <a class="el" href="class_i_control_view.html">IControlView</a> interface of the widget that caused the change is obtained from the theSubject parameter. To determine which widget ID caused the change, the GetWidgetID method is called on the <a class="el" href="class_i_control_view.html">IControlView</a> interface. Suppose you want to add another button with a specific widget ID, like kWFPIconSuiteWidgetID, to this dialog. For a button press to be responded to, the widget ID must correspond to the ID for your button, and the message ID from the theSubject parameter must be something like kTrueStateMessage (indicating the button is pressed).</ul><p><b>WFPDialogController.cpp</b><ul><li><a class="el" href="class_w_f_p_dialog_controller.html">WFPDialogController</a> - This class inherits the <a class="el" href="class_c_dialog_controller.html">CDialogController</a> class, which implements the <a class="el" href="class_i_dialog_controller.html">IDialogController</a> interface. This class handles the dialog initialization, as well as data validation and the OK button click.<li><a class="el" href="class_w_f_p_dialog_controller.html#adcecc6e5bd0b711df6c7bff17e5d89ce">WFPDialogController::InitializeDialogFields</a> - This method initializes the widgets on the dialog. This method is called by the parent class when the dialog is opened and when the dialog&#39;s Reset button is clicked, if you did not override the <a class="el" href="class_c_dialog_controller.html#a80fbfae6bb650ba2fbf667278d9b9ec8">CDialogController::ResetDialogFields</a> method. This method first needs to call the <a class="el" href="class_c_dialog_controller.html#acb92dad77585e64d4e7c45f9331c8b13">CDialogController::InitializeDialogFields</a> method in the parent class. (Note: Cancel becomes Reset when you hold the Alt or Option key.)<li><a class="el" href="class_w_f_p_dialog_controller.html#a27eac8a88bff35f0e108bc29568efded">WFPDialogController::ValidateDialogFields</a> - This method validates the fields on the dialog. When the OK button is clicked, this method is called before the ApplyDialogFields method. Again, the <a class="el" href="class_c_dialog_controller.html#a9b639981275b3975a94bdb27c5dd0824">CDialogController::ValidateDialogFields</a> method in the parent class is called first. If there is even one field with an invalid value, you can return the WidgetID to be selected. If all fields have valid values, you can return kDefaultWidgetId, which allows the parent class to call the ApplyDialogFields method.<li><a class="el" href="class_w_f_p_dialog_controller.html#a63bb5f5d04d4d84bbdbbadd3bedab462">WFPDialogController::ApplyDialogFields</a> - This method retrieves the values from the dialog fields and acts on them. The widgetId from the parameter list contains the widget ID that caused this method to be called. By default, this parameter contains kOKButtonWidgetID.</ul><h2><a class="anchor" id="id_step_2_add_a_dropdownlistwidget_to_the_dialog"></a> Step 2: Add a DropDownListWidget to the dialog</h2><p>You have created the rough foundation for your plug-in. Now it is time to start building your plug-in by improving its dialog widget.<h3><a class="anchor" id="id_step_21_add_a_widget_id"></a> Step 2.1: Add a widget ID</h3><p>Open <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a> in your IDE and find the widget definitions for the dialog, as shown here:<div class="fragment"><div class="line"><span class="comment">// WidgetIDs:</span></div><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPDialogWidgetID, kWFPPrefix + 1)</div></div><p>On the next line, add the following:<div class="fragment"><div class="line"><span class="comment">// DropDownList widget </span></div><div class="line">IDDECLARE_PMID(kWidgetIDSpace, kWFPDropDownListWidgetID, kWFPPrefix + 2)</div></div><h3><a class="anchor" id="id_step_22_define_string_keys_for_list_items"></a> Step 2.2: Define string keys for list items</h3><p>Next, define string keys for the items in the DropDownList. InDesign has a base type object, <a class="el" href="class_p_m_string.html">PMString</a>, that is used extensively for user-interface strings; for this type, InDesign has a locale-based, string look-up mechanism for automatic string translation. The translated strings are defined in a string-table resource; if a string is specified by its key, InDesign automatically replaces it with the corresponding localized string. If you look at <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a> in the &quot;Other StringKeys&quot; section, you can see several string keys defined there.<p>To define a string key for the DropDownListWidget items, first find the following in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a>:<div class="fragment"><div class="line"><span class="comment">// Other StringKeys:</span></div><div class="line"><span class="preprocessor">#define kWFPAboutBoxStringKey kWFPStringPrefix &quot;kWFPAboutBoxStringKey&quot;</span></div><div class="line"><span class="preprocessor">#define kWFPTargetMenuPath kWFPPluginsMenuPath</span></div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line"><span class="preprocessor">#define kWFPDropDownItem_1Key kWFPStringPrefix &quot;kWFPDropDownItem_1Key&quot;</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define kWFPDropDownItem_2Key kWFPStringPrefix &quot;kWFPDropDownItem_2Key&quot;</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define kWFPDropDownItem_3Key kWFPStringPrefix &quot;kWFPDropDownItem_3Key&quot; </span></div><div class="line"><span class="preprocessor">#define kWFPDropDownItem_4Key kWFPStringPrefix &quot;kWFPDropDownItem_4Key&quot;</span></div></div><p>If you know what your string key will be -for instance, kWFP_TunaKey-you can define the key using the string, so you can find it more easily later.<h3><a class="anchor" id="id_step_23_define_locale-specific_strings_for_list_items_on_dropdownlistwidget"></a> Step 2.3: Define locale-specific strings for list items on DropDownListWidget</h3><p>Next, define the string-table resource entries that correspond to the string keys you just defined. These string tables are defined in WFP_enUS.fr and WFP_jaJP.fr, for use in the US English and Japanese locales, respectively. These two resource files are included by WFP.fr and are located in your project&#39;s source files.<p>Start by defining the US English string-table entries. Open WFP_enUS.fr to see that the string keys and the English strings are paired up. Add strings for the four string keys you just defined. Look for the following in WFP_enUS.fr:<div class="fragment"><div class="line">resource StringTable (kSDKDefStringsResourceID + index_enUS){</div><div class="line"><span class="comment">// Locale Id</span></div><div class="line"> k_enUS,</div><div class="line"><span class="comment">// Character encoding converter</span></div><div class="line"> kEuropeanMacToWinEncodingConverter,</div><div class="line"> {</div><div class="line"><span class="comment">// ...omitted</span></div><div class="line"><span class="comment">// ----- Panel/dialog strings</span></div><div class="line"> kWFPDialogTitleKey, kWFPPluginName <span class="stringliteral">&quot;[US]&quot;</span>,</div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line"><span class="comment">// Drop-down list item strings</span></div><div class="line">kWFPDropDownItem_1Key, <span class="stringliteral">&quot;Tuna&quot;</span>,</div><div class="line">kWFPDropDownItem_2Key, <span class="stringliteral">&quot;Salmon&quot;</span>,</div><div class="line">kWFPDropDownItem_3Key, <span class="stringliteral">&quot;Bonito&quot;</span>,</div><div class="line">kWFPDropDownItem_4Key, <span class="stringliteral">&quot;Yellowtail&quot;</span>,</div></div><p>Similarly, you can add strings to the Japanese string table. Open WFP_jaJP.fr and look for the following:<div class="fragment"><div class="line">resource StringTable (kSDKDefStringsResourceID + index_jaJP){ </div><div class="line"> k_jaJP,</div><div class="line"><span class="comment">// Locale Id </span></div><div class="line"> 0, <span class="comment">// Character encoding converter </span></div><div class="line"> { </div><div class="line"><span class="comment">//...omitted </span></div><div class="line"><span class="comment">// ----- Panel/dialog strings</span></div><div class="line"> kWFPDialogTitleKey, kWFPPluginName <span class="stringliteral">&quot;[JP]&quot;</span>,</div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line"><span class="comment">// Drop-down list item strings</span></div><div class="line">kWFPDropDownItem_1Key, <span class="stringliteral">&quot;Tuna [JP]&quot;</span>,</div><div class="line">kWFPDropDownItem_2Key, <span class="stringliteral">&quot;Salmon [JP]&quot;</span>,</div><div class="line">kWFPDropDownItem_3Key, <span class="stringliteral">&quot;Bonito [JP]&quot;</span>,</div><div class="line">kWFPDropDownItem_4Key, <span class="stringliteral">&quot;Yellowtail [JP]&quot;</span>,</div></div><p>For this exercise, it is not necessary to enter Japanese characters into the resource string tables. The SDK sample plug-ins often put a locale-specific suffix on these strings, such as &quot;[JP],&quot; so you know the appropriate string table is being used. You can choose to do the same.<p>If you will release your plug-ins commercially, however, there is a chance an InDesign Japanese version will use your plug-in. In that case, it is advisable to define strings for the Japanese string table. Better yet, obtain help in translating the strings into Japanese or other locales supported by InDesign.<h3><a class="anchor" id="id_step_24_add_a_dropdownlistwidget_to_your_dialog_resource"></a> Step 2.4: Add a DropDownListWidget to your dialog resource</h3><p>The dialog resource is defined in WFP.fr, toward the end of the file. This resource already contains two widgets: the default OK button and Cancel button. Look for the following:<div class="fragment"><div class="line">resource WFPDialogWidget (kSDKDefDialogResourceID + index_enUS){</div><div class="line"> FILE__, __LINE__,</div><div class="line"> kWFPDialogWidgetID, <span class="comment">// WidgetID</span></div><div class="line"> kPMRsrcID_None, <span class="comment">// RsrcID </span></div><div class="line"> kBindNone, <span class="comment">// Binding</span></div><div class="line"> 0, 0, 388,112, <span class="comment">// Frame (l,t,r,b)</span></div><div class="line"> kTrue, kTrue, <span class="comment">// Visible, Enabled</span></div><div class="line"> kWFPDialogTitleKey, <span class="comment">// Dialog name </span></div><div class="line"> { </div><div class="line"> ...omitted </div><div class="line"> CancelButtonWidget</div><div class="line"> ( </div><div class="line"> ...omitted </div><div class="line"> ),</div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line"><span class="comment">// Drop-down list widget resourceEVEDropDownListWidget(</span></div><div class="line"> kWFPDropDownListWidgetID, kSysDropDownPMRsrcId, <span class="comment">// WidgetId, RsrcId</span></div><div class="line"> kBindNone, <span class="comment">// Frame binding</span></div><div class="line"> Frame(0,0,130,20), <span class="comment">// Frame (l,t,r,b)</span></div><div class="line"> kTrue, kTrue, <span class="comment">// Visible, Enabled</span></div><div class="line"> {{ <span class="comment">// List Items</span></div><div class="line"> kWFPDropDownItem_1Key,</div><div class="line"> kWFPDropDownItem_2Key,</div><div class="line"> kWFPDropDownItem_3Key,</div><div class="line"> kWFPDropDownItem_4Key,</div><div class="line"> }}</div><div class="line"> kEVEAlignLeft | kEVEJumboSpaceAfter,</div><div class="line">},</div></div><p>This drop-down list widget is now added to your dialog.<h3><a class="anchor" id="id_step_25_correct_the_localized_menu_strings"></a> Step 2.5: Correct the localized menu strings</h3><p>Earlier, when you first looked at your dialog (<a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_step_19_start_indesign_through_your_ide">Step 1.9: Start InDesign through your IDE</a>), the menu string in the Plug-Ins &gt; SDK menu was Show Dialog. You want it to be WriteFishPrice[US] or WriteFishPrice[JP], so you need to change it.<ol type="1"><li>Open WFP_enUS.fr, and look for the following:</ol><div class="fragment"><div class="line">kWFPDialogMenuItemKey, <span class="stringliteral">&quot;Show dialog[US]&quot;</span>,</div></div><ol type="1"><li>Change this line to the following: <div class="fragment"><div class="line">kWFPDialogMenuItemKey, kWFPPluginName <span class="stringliteral">&quot;[US]&quot;</span>,</div></div><li>Also do this in your Japanese string table. Open WFP_jaJP.fr, and look for the following: <div class="fragment"><div class="line">kWFPDialogMenuItemKey, <span class="stringliteral">&quot;Show dialog[JP]&quot;</span>,</div></div><li>Change this line to the following: <div class="fragment"><div class="line">kWFPDialogMenuItemKey, kWFPPluginName <span class="stringliteral">&quot;[JP]&quot;</span>,</div></div></ol><dl class="section note"><dt>Note<dd>kWFPPluginName is defined in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a>.</dl><h3><a class="anchor" id="id_step_26_save_build_and_test"></a> Step 2.6: Save, build, and test</h3><p>Save the source files you edited, build the plug-in, move the plug-in to the Plug-Ins directory, start InDesign, and try using your new drop-down list.<p>When you first open the dialog, notice there is no default value in the drop-down list. You will set up a default value for this drop-down list in a later step.<p>Click the drop-down list widget. The drop-down list widget should show the four strings you just added: <div class="image"><img alt="Step2_DialogUsage.gif" src="Step2_DialogUsage.gif" /></div><h2><a class="anchor" id="id_step_3_add_a_texteditboxwidget"></a> Step 3: Add a TextEditBoxWidget</h2><h3><a class="anchor" id="id_step_31_add_a_widget_id"></a> Step 3.1: Add a widget ID</h3><ol type="1"><li>In preparation for adding a TextEditBoxWidget on your dialog, open <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a> again, so you can define widget IDs.<li>Immediately after the place where you added widget IDs in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_step_21_add_a_widget_id">Step 2.1: Add a widget ID</a>, add a widget ID for your TextEditBox. Look for the following: <div class="fragment"><div class="line"><span class="comment">// WidgetIDs:</span></div><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPDialogWidgetID, kWFPPrefix + 1)</div><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPDropDownListWidgetID, kWFPPrefix + 2) <span class="comment">//DropDownList</span></div></div><li>Immediately after this, add the following line: <div class="fragment"><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPTextEditBoxWidgetID, kWFPPrefix + 3) <span class="comment">//TextEditBox </span></div></div></ol><h3><a class="anchor" id="id_step_32_add_a_texteditboxwidget_resource"></a> Step 3.2: Add a TextEditBoxWidget resource</h3><p>Next, you need to add the TextEditBoxWidget resource into your dialog resource definition. Define this immediately after the place where you added your DropDownListWidget. In WFP.fr, look for the following:<div class="fragment"><div class="line">DropDownListWidget( <span class="comment">// ...omitted),</span></div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line"><span class="comment">// TextEditBox Widget resource</span></div><div class="line">EVETextEditBoxWidget(</div><div class="line"> kWFPTextEditBoxWidgetID, <span class="comment">// WidgetId </span></div><div class="line"> kSysEditBoxPMRsrcId, <span class="comment">// RsrcId </span></div><div class="line"> kBindNone, <span class="comment">// Frame binding </span></div><div class="line"> Frame(0, 0, 50, 20), <span class="comment">// Frame (l,t,r,b) </span></div><div class="line"> kTrue, kTrue <span class="comment">// Visible, Enabled </span></div><div class="line"> 0, <span class="comment">// Widget id of nudge button (0 so we don&#39;t get one)</span></div><div class="line"> 0, 0, <span class="comment">// small, large nudge amount </span></div><div class="line"> 0, <span class="comment">// max num chars(0 = no limit) </span></div><div class="line"> kFalse, <span class="comment">// is read only </span></div><div class="line"> kFalse, <span class="comment">// should notify each key stroke </span></div><div class="line"> kFalse, <span class="comment">// range checking enabled</span></div><div class="line"> kFalse, <span class="comment">// blank entry allowed </span></div><div class="line"> 0, <span class="comment">// Upper bounds </span></div><div class="line"> 0, <span class="comment">// Lower bounds </span></div><div class="line"><span class="stringliteral">&quot;&quot;</span>, <span class="comment">// Initial text </span></div><div class="line"></div><div class="line"> kEVEAlignLeft | kEVEJumboSpaceAfter,</div><div class="line">),</div></div><p>This is all that&#39;s needed to put a text-edit box on a dialog.<h3><a class="anchor" id="id_step_33_save_build_and_test"></a> Step 3.3: Save, build, and test</h3><p>Save the source file you edited, build the plug-in, move the plug-in to the Plug-Ins directory, start InDesign, and try using your new text-edit box:<div class="image"><img alt="Step3_Dialog.gif" src="Step3_Dialog.gif" /></div><p>Try entering some characters or copying text from another application and pasting it into the text-edit box using shortcut keys. InDesign automatically handles the shortcut keys.<h2><a class="anchor" id="id_step_4_add_a_statictextwidget"></a> Step 4: Add a StaticTextWidget</h2><p>So far, you added a drop-down list to select the product and a text-edit box to enter the unit price. In addition, you should have a currency symbol next to your text-edit box. InDesign can be used in various locales; this is a good opportunity to use the power of the application&#39;s international capabilities. In this section, you will modify your dialog to display $ (dollar symbol) or &Acirc;&yen; (yen symbol), based on the locale.<h3><a class="anchor" id="id_step_41_add_a_widget_id"></a> Step 4.1: Add a Widget ID</h3><p>To add an ID for your StaticTextWidget, open <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a>. After the lines you added for the TextEditBoxWidget, define the ID for your StaticTextWidget. Look for the following:<div class="fragment"><div class="line"><span class="comment">// widget IDs </span></div><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPDialogWidgetID, kWFPPrefix + 1)</div><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPDropDownListWidgetID, kWFPPrefix + 2) <span class="comment">//DropDownList</span></div><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPTextEditBoxWidgetID, kWFPPrefix + 3) <span class="comment">//TextEditBox</span></div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line">DECLARE_PMID(kWidgetIDSpace, kWFPStaticTextWidgetID, kWFPPrefix + 4) <span class="comment">//StaticText</span></div></div><h3><a class="anchor" id="id_step_42_define_a_string_key"></a> Step 4.2: Define a string key</h3><p>Next, define a string key for each currency symbol that will be displayed in the static-text widget:<div class="fragment"><div class="line"><span class="comment">// StaticText string key (yen or dollar character)</span></div><div class="line"><span class="preprocessor">#define kWFPStaticTextKey kWFPStringPrefix &quot;kWFPStaticTextKey&quot;</span></div></div><h3><a class="anchor" id="id_step_43_define_locale-specific_strings_for_your_statictextwidget"></a> Step 4.3: Define locale-specific strings for your StaticTextWidget</h3><p>Define the localized strings that correspond to this string key in the string-table resources in WFP_enUS.fr and WFP_jaJP.fr.<ol type="1"><li>In WFP_enUS.fr, look for this comment: <div class="fragment"><div class="line"><span class="comment">// Panel/dialog strings</span></div></div> Immediately after this, add the following lines: <div class="fragment"><div class="line"><span class="comment">// StaticText string key (yen or dollar character)</span></div><div class="line">kWFPStaticTextKey, <span class="stringliteral">&quot;$&quot;</span>,</div></div><li>In WFP_jaJP.fr, look for this comment: <div class="fragment"><div class="line"><span class="comment">// Panel/dialog strings</span></div></div> Immediately after this, add the following lines: <div class="fragment"><div class="line"><span class="comment">// StaticText string key. (yen or dollar character)</span></div><div class="line">kWFPStaticTextKey, <span class="stringliteral">&quot;&Acirc;&yen;&quot;</span>,</div></div></ol><p>The yen symbol is specified here as a double-byte character (specifically, ShiftJIS code 0x8F81). If you cannot enter Japanese characters, specify this string as an uppercase Y.<h3><a class="anchor" id="id_step_44_add_a_statictextwidget_resource_to_your_dialog_resource"></a> Step 4.4: Add a StaticTextWidget resource to your dialog resource</h3><p>Add the StaticTextWidget resource immediately after where you added the TextEditBoxWidget. In WFP.fr, look for the following: <div class="fragment"><div class="line"><span class="comment">// TextEditBox Widget resource</span></div><div class="line">TextEditBoxWidget(</div><div class="line"><span class="comment">// ...omitted</span></div><div class="line">),</div></div><p>Immediately after this, add the following lines:<div class="fragment"><div class="line"><span class="comment">// StaticText widget resource</span></div><div class="line">EVEStaticTextWidget(</div><div class="line"> kWFPStaticTextWidgetID, <span class="comment">// WidgetId </span></div><div class="line"> kSysStaticTextPMRsrcId, <span class="comment">// RsrcId </span></div><div class="line"> kBindNone, <span class="comment">// Frame binding </span></div><div class="line"> Frame(0,0,0,0), <span class="comment">// Frame (l,t,r,b) </span></div><div class="line"> kTrue, kTrue, kAlignRight, <span class="comment">// Visible, Enabled, Alignment </span></div><div class="line"> kDontEllipsize, kTrue, <span class="comment">// don&#39;t add any ellipses </span></div><div class="line"> kWFPStaticTextKey, <span class="comment">// Text</span></div><div class="line"> kWFPTextEditBoxWidgetID <span class="comment">// WidgetId for associated control for shortcut focus</span></div><div class="line"> kEVEAlignLeft <span class="comment">// kEVELargeSpaceAfter,</span></div><div class="line">),</div></div><h3><a class="anchor" id="id_step_45_save_build_and_test"></a> Step 4.5: Save, build, and test</h3><p>Save the source file you edited, build the plug-in, move the plug-in to the Plug-Ins directory, start InDesign, and try using your new static-text widget. The following figure shows what you see in the US English locale:<div class="image"><img alt="Step4_DialogENUS.gif" src="Step4_DialogENUS.gif" /></div><p>The following figure shows what you see in the Japanese locale:<div class="image"><img alt="Step4_DialogJAJP.gif" src="Step4_DialogJAJP.gif" /></div><p>As you can see, different strings can be displayed based on the locale. You can do the same with other user-interface widgets in InDesign.<p>In this case, the meaning of the data you enter in the text-edit box will change, so you may have to do extra processing later.<p>This concludes your design of the dialog. As we demonstrated, you can design your plug-ins starting with the user interface, before implementing what the plug-in does. In other words, you can develop the controller in a manner that is decoupled from the rest of the plug-in.<h2><a class="anchor" id="id_using_resources_in_plug-ins"></a> Using resources in plug-ins</h2><p>This plug-in&#39;s resources are defined in WFP.fr (and the _enUS.fr and _jaJP.fr files that are included). InDesign uses resource definitions for strings, dialogs, panels, menus, and boss classes that are cross platform between the Windows and Mac OS development environments. (There are a few resource types not included in these resource definitions. They are limited to a few types that are not compatible across platforms: file version, icon, and picture resources.) To share resource definitions across platforms, InDesign uses the ODFRC.<p>Follow along with this section by using your IDE to take a closer look at various resources defined in WFP.fr.<h3><a class="anchor" id="id_pluginversion_resource"></a> PluginVersion resource</h3><p>The PluginVersion resource describes the plug-in version. It is defined in &lt;SDK&gt;/source/public/includes/objectmodeltypes.fh.<p>This entry is the build number of InDesign that is the target for the plug-in:<div class="fragment"><div class="line">kTargetVersion,</div></div><p>Normally, you specify this using the kTargetVersion macro, which expands depending on whether the plug-in is being built for the release or debug build.<p>This entry is an ID unique to this plug-in. It is defined in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a>:<div class="fragment"><div class="line">kWFPPluginID,</div></div><p>These entries give the major and minor versions of the plug-in and the major and minor versions of the host application:<div class="fragment"><div class="line">kSDKDefPlugInMajorVersionNumber, kSDKDefPlugInMinorVersionNumber,</div><div class="line">kSDKDefHostMajorVersionNumber, kSDKDefHostMinorVersionNumber,</div></div><p>The version numbers are defined in &lt;SDK&gt;/source/sdksamples/common/SDKDef.h for the SDK you are using.<p>This entry gives the major and minor version of this plug-in, defined in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a>:<div class="fragment"><div class="line">kWFPCurrentMajorFormatNumber, kWFPCurrentMinorFormatNumber,</div></div><p>This entry list specifies which applications (products) you are targeting:<div class="fragment"><div class="line">{ kInDesignProduct, kInCopyProduct },</div></div><p>The InDesign SDK can be used to build plug-ins for InDesign, InCopy, and InDesign Server; however, there may be times when you want to allow your plug-in to be loaded in only one application. In the example used in this document, you want to be able to use your plug-in in InDesign and InCopy but not InDesign Server.<p>This entry is an array that specifies the feature set with which this plug-in works:<div class="fragment"><div class="line">{ kWildFS },</div></div><p>A feature set is an abstraction of a set of application features and is different from a user-interface locale. The feature-set setting allows you to customize not only the user interface but also the behavior of your plug-in. You can choose from product and language settings. For details, see &lt;SDK&gt;/source/public/includes/FeatureSets.h. This document&#39;s sample plug-in is specified to work with any feature set, so it specifies kWildFS.<p>The last entry is a string that the Adobe Update Manager displays in the plug-in&#39;s About box:<div class="fragment"><div class="line">kWFPVersion</div></div><p>It is the plug-in&#39;s version, defined in <a class="el" href="_w_f_p_i_d_8h_source.html">WFPID.h</a> and based on kSDKDefPluginVersionString, which is defined in &lt;SDK&gt;/source/sdksamples/SDKDef.h.<h3><a class="anchor" id="id_boss-class-definition_resource"></a> Boss-class-definition resource</h3><p>Boss-class definitions specify the InDesign object model. They are somewhat analogous to C++ class definitions. Boss classes are discussed in detail later, so this section highlights only the resource part.<p>Each boss-class definition shown in this file begins with the resource keyword Class, which is used to define a new boss class in the InDesign object model.<p>You also can start a boss class with the keyword AddIn. This allows you to add interfaces to existing boss-class definitions. For an example of an AddIn resource, see the SDK sample plug-in FrameLabel.<p>The next component in the resource definitions for your plug-in, <a class="el" href="classk_w_f_p_dialog_boss.html">kWFPDialogBoss</a>, is the ID of this boss class. After that, <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> indicates the ID of the parent boss class. All the functionality provided by <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> (all implementations backing the interfaces aggregated on the boss class) is provided for <a class="el" href="classk_w_f_p_dialog_boss.html">kWFPDialogBoss</a>. <a class="el" href="classk_w_f_p_dialog_boss.html">kWFPDialogBoss</a> can extend this functionality (by adding other interfaces) or adapt it (by overriding existing interfaces and mapping them onto its own implementation). If you do not want to specify a parent boss class, specify kInvalidClass in its place.<p>Next is the interface-to-implementation mapping list for the boss class. In this dialog boss class, you are overriding the IID_IDIALOGCONTROLLER and IID_IOBSERVER interfaces from <a class="el" href="classk_dialog_boss.html">kDialogBoss</a>. The actual C++ implementations are referred to indirectly by their implementation IDs, namely kWFPDialogControllerImpl and kWFPDialogObserverImpl, respectively.<p>InDesign plug-ins use the CREATE_PMINTERFACE macro to bind a specific implementation ID to a specific C++ class. This allows InDesign to call the C++ implementation by its implementation ID.<p>Open the API reference documentation (in &lt;SDK&gt;/docs/references), click the Boss Classes link at the top of the page, and navigate to the &quot;kDialogBoss Class Reference&quot; page. You can see that <a class="el" href="classk_dialog_boss.html">kDialogBoss</a> inherits another boss class, <a class="el" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a>, and overrides five interfaces. The entire InDesign object model is built with a collection of these boss classes, and you can build your plug-ins by overriding and/or extending existing boss classes, just as you did for <a class="el" href="classk_w_f_p_dialog_boss.html">kWFPDialogBoss</a>.<h3><a class="anchor" id="id_factorylist_resource"></a> FactoryList resource</h3><p>This resource allows you to register the implementation IDs for your C++ implementations in the InDesign object model. The <a class="el" href="_w_f_p_factory_list_8h_source.html">WFPFactoryList.h</a> header file registers the implementation IDs with the use of the REGISTER_PMINTERFACE macro, and it also is included in WFPNoStrip.cpp to prevent dead stripping. By sharing this piece of code, you prevent a situation in which you forget to specify the implementation ID in one place or the other.<p>The REGISTER_PMINTERFACE macro in <a class="el" href="_w_f_p_factory_list_8h_source.html">WFPFactoryList.h</a> defines the implementation ID when used in a resource definition and prevents dead stripping when used in a .cpp file.<h3><a class="anchor" id="id_menudef_resource"></a> MenuDef resource</h3><p>The first block defines the menu used to show the About This Plug-In dialog. The second block defines the menu used to show the dialog you just designed for your plug-in.<p>In each block:<ul><li>The first line is the action ID issued when the associated menu item is selected.<li>The second line specifies the menu path that corresponds to the action ID specified directly above it. In the example, kWFPAboutMenuPath is a preprocessor #define statement that expands to Main: &amp; Help:AboutPlugins:SDK on Windows and Main:AppleMenu:AboutPlugins:SDK on Mac OS.<li>The third line specifies the position of the menu item relative to other menu items in the same menu path. kSDKDefAlphabeticPosition is defined in <a class="el" href="_s_d_k_def_8h_source.html">SDKDef.h</a>. If you use this constant (defined as 1.0), InDesign builds the menu after sorting individual menu items in the same path. In most cases, you can use this constant.<li>The fourth line defines the behavior of the menu item. To change the menu each time it is displayed, set this to kSDKDefIsDynamicMenuFlag; otherwise, set it to kSDKDefIsNotDynamicMenuFlag. Normally, you specify kSDKDefIsNotDynamicMenuFlag.</ul><h3><a class="anchor" id="id_actiondef_resource"></a> ActionDef resource</h3><p>This resource defines the action invoked from the menu. An action is an abstraction for what happens when a menu item is selected or a shortcut key is pressed.<p>In the first line, <a class="el" href="classk_w_f_p_action_component_boss.html">kWFPActionComponentBoss</a> is a boss class that handles the action IDs.<p>In the second line, kWFPAboutActionID is an action ID that is to be handled by the boss class specified in the first line.<p>In the third line, kWFPAboutMenuKey is the string key that corresponds to the action ID listed in the second line.<p>In the fourth line, kOtherActionArea specifies the keyboard shortcut editor (KBSCE) area; in the example, you are using &quot;other.&quot; KBSCE areas are defined in &lt;SDK&gt;/source/public/includes/ActionDefs.h.<p>The fifth line specifies the action type. Generally, you specify kNormalAction here.<p>The sixth line specifies how the menu is enabled or disabled. Again, these enabling types are defined in <a class="el" href="_action_defs_8h_source.html">ActionDefs.h</a>.<p>The seventh line specifies the interfaceID for the selection required for the action to be active. If you do not require any selections for your action to be active, specify kInvalidInterfaceID.<p>The eighth line specifies whether the shortcut key entry is visible in the KBSCE.<h3><a class="anchor" id="id_localeindex_resource"></a> LocaleIndex resource</h3><p>This resource cross-references the string tables with the InDesign feature set and locale information.<p>kStringTableRsrcType specifies the type of resource you are cross-referencing. In this case, this resource is used as a locale-index resource to switch the string tables. kWildFS means this entry applies to all feature sets (defined in <a class="el" href="_feature_sets_8h_source.html">FeatureSets.h</a>). k_enUS specifies that the corresponding locale is US English. So, the first line in the curly brackets after kStringTableRsrcType means that, for all feature sets and in the US English locale, use the string table referenced by the resource ID kSDKDefStringsResourceID + index_enUS.<p>The next line specifies that when the feature set is kInDesignJapaneseFS and the locale is Japanese (k_jaJP), use the string table referenced by the resource ID kSDKDefStringsResourceID + index_jaJP. In the example, resource definitions for other locales (like French, German, and UK English) are omitted. It is extra work to define resources for other languages from the beginning of development, so if you change the k_enUS to kWild in the first line, your plug-in uses the US English string resources for locales other than Japanese. This probably is a practical change to make, until you define resources for other locales. For a list of supported locales, see &lt;SDK&gt;/source/public/includes/MLocaleIds.h and &lt;SDK&gt;/source/public/includes/WLocaleIds.h.<p>The next <a class="el" href="class_locale_index.html">LocaleIndex</a> resource defines a no-translation string table, as there may be strings that you do not want to be translated automatically.<h3><a class="anchor" id="id_localeindex_resource_definition_for_dialogs"></a> LocaleIndex resource definition for dialogs</h3><p>This is similar to the <a class="el" href="class_locale_index.html">LocaleIndex</a> resource for the string tables, except dialogs are defined as kViewRsrcType resources instead of kStringTableRsrcType. In the example, all feature sets and locales use the same US English dialog resource. Although the dialog resource comes strictly from the US English locale index, the strings on the dialog are localized, as you defined above with kStringTableRsrcType.<h3><a class="anchor" id="id_custom_type_definitions"></a> Custom type definitions</h3><p>This resource defines a widget type. In the example, WFPDialogWidget belongs to the kViewRsrcType resource type and inherits the DialogBoss widget. This statement defines the boss class that backs the user interface of this type:<div class="fragment"><div class="line">type WFPDialogWidget(kViewRsrcType) : DialogBoss(<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_w_f_p_dialog_boss.html">kWFPDialogBoss</a>){};</div></div><p>The DialogBoss widget type inherits from PrimaryResourcePanelWidget. Both are defined in &lt;SDK&gt;/source/public/widgets/includes/Widgets.fh.<h3><a class="anchor" id="id_dialog_view_resource"></a> Dialog (view) resource</h3><p>This resource defines your plug-in&#39;s dialog box. This dialog is specified for the US English locale; however, as specified in the <a class="el" href="class_locale_index.html">LocaleIndex</a> resource, it is used for all feature sets and locales. Since your plug-in does not require a different dialog definition for each locale (that is, the widget arrangement is the same no matter what locale is used), the definitions are consolidated into one .fr file.<p>This resource is complex, so we present the suggested way to navigate through the resource definitions. First, look at the definition of the parent widget type, DialogBoss. Open &lt;SDK&gt;/source/public/widgets/includes/Widgets.fh to see this:<div class="fragment"><div class="line">type DialogBoss (kViewRsrcType) : PrimaryResourcePanelWidget (<a class="code" href="class_i_d_type.html">ClassID</a> = <a class="code" href="classk_dialog_boss.html">kDialogBoss</a>){};</div></div><p>Notice that the parent of DialogBoss is PrimaryResourcePanelWidget. Now, examine the definition of PrimaryResourcePanelWidget, to see that its parent is the root Widget; this is the top of the hierarchy. Look at PrimaryResourcePanelWidget.<p>Go deeper and examine CControlView, defined in Widgets.fh:<div class="fragment"><div class="line">type CControlView : Interface (IID = IID_ICONTROLVIEW){ </div><div class="line"> longint; <span class="comment">// fWidgetId </span></div><div class="line"><a class="code" href="class_p_m_rsrc_i_d.html">PMRsrcID</a>; <span class="comment">// fRsrcId, fRsrcPlugin </span></div><div class="line"> integer; <span class="comment">// fFrameBinding </span></div><div class="line"> Frame; <span class="comment">// fFrame </span></div><div class="line"> integer; <span class="comment">// fVisible </span></div><div class="line"> integer; <span class="comment">// fEnabled</span></div><div class="line">};</div></div><p>Look at the first line in the type definition. It is a bit different than other widget type definitions you have seen so far, as it specifies an IID instead of ClassID. This is an interface type. It indicates that CControlView is a persistent interface in <a class="el" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a>.<p>Search for <a class="el" href="classk_primary_resource_panel_widget_boss.html">kPrimaryResourcePanelWidgetBoss</a> in the API reference documentation, and see its aggregated interfaces.<h3><a class="anchor" id="id_string-table_resource"></a> String-table resource</h3><p>The string-table resource is next. WFP.fr includes two other .fr files, WFP_enUS.fr and WFP_jaJP.fr. They specify US English and Japanese string table resources, respectively. Because the string-table resources are separated by locale, they are easier to manage.<p>WFP_enUS.fr gives the US English string-table resource definition. The first line specifies the locale ID, k_enUS. The next line specifies the character-encoding converter, which deals with the differences between high-ASCII characters on Windows and Mac OS. The next line is where the string table is defined. The string key and corresponding localized strings are comma-separated pairs.<p>Next, look at the Japanese-locale string table. The first line specifies the locale ID, k_jaJP. Because a character-encoding converter for Japanese is not needed, the next line contains a zero. The string table is defined after that, as in the US English string table, with the string key and localized strings in comma-separated pairs.<h2><a class="anchor" id="id_step_5_obtain_a_value_from_dropdownlistwidget"></a> Step 5: Obtain a value from DropDownListWidget</h2><p>In this section, you obtain the string value from a dialog widget and create a string that you can insert into an InDesign document.<h3><a class="anchor" id="id_step_51_get_string_value_of_selected_item"></a> Step 5.1: Get string value of selected item</h3><p>The first step is to add code to get the fish name from the DropDownListWidget. You want your plug-in to insert text into the InDesign document when the user clicks OK. Recall that the method that gets called when OK is clicked is <a class="el" href="class_w_f_p_dialog_controller.html#a63bb5f5d04d4d84bbdbbadd3bedab462">WFPDialogController::ApplyDialogFields</a>. Because the actual handling of the button click is delegated to <a class="el" href="class_c_dialog_controller.html">CDialogController</a>, the parent class of <a class="el" href="class_w_f_p_dialog_controller.html">WFPDialogController</a>, you already have some basic dialog function in your plug-in.<p>Look at the code for the <a class="el" href="class_w_f_p_dialog_controller.html#a63bb5f5d04d4d84bbdbbadd3bedab462">WFPDialogController::ApplyDialogFields</a> method using your IDE. This code was generated by DollyXs from the Dialog template. To obtain the text on the widget, call <a class="el" href="class_c_dialog_controller.html#a622a514fb13c9fbb41e2815af992914e">CDialogController::GetTextControlData</a>. This method requires a widget ID as a parameter and returns a <a class="el" href="class_p_m_string.html">PMString</a> object. You will use this method (from the <a class="el" href="class_i_text_control_data.html">ITextControlData</a> interface in the dialog boss class) to obtain the text data on the widget. The string returned is not the string you see on your dialog, but the string key you defined in the string-table resource.<p>On the next line, the lookup feature of the <a class="el" href="class_p_m_string.html">PMString</a> object is used to translate the <a class="el" href="class_p_m_string.html">PMString</a> to a string in the current locale. Add the following code:<div class="fragment"><div class="line"><span class="comment">//Get selected text of DropDownList.</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> resultString;</div><div class="line">resultString = this-&gt;GetTextControlData(kWFPDropDownListWidgetID);</div><div class="line"></div><div class="line"><span class="comment">// Look up string and replace.</span></div><div class="line">resultString.<a class="code" href="class_p_m_string.html#aa9fb7fb8d90885950ac4ada00e12e1c2">Translate</a>();</div></div><h3><a class="anchor" id="id_step_52_save_build_and_test"></a> Step 5.2: Save, build, and test</h3><p>Save the source file you edited, build the plug-in, move the plug-in to the Plug-Ins directory, start InDesign, create a text frame, and put the cursor in it.<p>Select your plug-in from the Plug-Ins menu, select Bonito from the drop-down list, and click OK.<h2><a class="anchor" id="id_step_6_get_the_text_in_the_texteditboxwidget"></a> Step 6: Get the text in the TextEditBoxWidget</h2><h3><a class="anchor" id="id_step_61_get_the_string_value"></a> Step 6.1: Get the string value</h3><p>As you did in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_step_51_get_string_value_of_selected_item">Step 5.1: Get string value of selected item</a>, modify the <a class="el" href="class_w_f_p_dialog_controller.html#a63bb5f5d04d4d84bbdbbadd3bedab462">WFPDialogController::ApplyDialogFields</a> method. Immediately after the line with resultString, add this code:<div class="fragment"><div class="line"><span class="comment">// Get the editbox list widget string.</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> editBoxString = this-&gt;GetTextControlData(kWFPTextEditBoxWidgetID);</div></div><h3><a class="anchor" id="id_step_62_form_a_string_to_insert_into_the_text_frame"></a> Step 6.2: Form a string to insert into the text frame</h3><p>Concatenate a string to insert into the InDesign document. Append strings in the following order: product name, tab character, currency symbol, price, and new line.<p>The following code creates a <a class="el" href="class_p_m_string.html">PMString</a> object, moneySign, that holds the string key for the currency symbol. The code translates the string based on the current locale. Then, the code concatenates the tab character, currency symbol, TextEditBoxWidget string that represents the price the user enters, and a newline character, using the <a class="el" href="class_p_m_string.html#a7264c4911eea8b17c93c572c808e708f">PMString::Append</a> method. <div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> moneySign(kWFPStaticTextKey);</div><div class="line">moneySign.Translate(); <span class="comment">// Look up string and replace.</span></div><div class="line">resultString.<a class="code" href="class_p_m_string.html#a7264c4911eea8b17c93c572c808e708f">Append</a>(<span class="charliteral">&#39;\t&#39;</span>); <span class="comment">// Append tab code.</span></div><div class="line">resultString.<a class="code" href="class_p_m_string.html#a7264c4911eea8b17c93c572c808e708f">Append</a>(moneySign);</div><div class="line">resultString.<a class="code" href="class_p_m_string.html#a7264c4911eea8b17c93c572c808e708f">Append</a>(editBoxString);</div><div class="line">resultString.<a class="code" href="class_p_m_string.html#a7264c4911eea8b17c93c572c808e708f">Append</a>(<span class="charliteral">&#39;\r&#39;</span>); <span class="comment">// Append return code.</span></div></div><p>The <a class="el" href="class_p_m_string.html">PMString</a> class has a wide variety of methods and is quite useful.<h2><a class="anchor" id="id_using_boss_classes_in_plug-ins"></a> Using boss classes in plug-ins</h2><p>A boss class is a class of objects in the InDesign object model. A boss class is like a C++ class; however, boss classes are declared differently. InDesign consists of boss classes that represent document objects (like images, text, and layers), as well as widgets (like dialog buttons and input fields). For example, InDesign pages are represented by this object hierarchy: document, spread, layer, page. This hierarchy is represented by a boss-class architecture.<p>Plug-in developers can access these boss-class objects when developing InDesign plug-ins. To use the appropriate boss class for the desired task at hand, you must understand the InDesign object model and its architecture. Also, you need to be aware of which boss class provides what kind of functionality. Like C++ objects, boss-class objects can be invoked by calling methods (or member functions), but the way you call boss-class objects differs from how you call methods in C++. For details, see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_using_interfaces_in_plug_ins">Using interfaces in plug-ins</a>.<p>As with C++ classes, boss classes can inherit other boss classes. For example, <a class="el" href="classk_spline_item_boss.html">kSplineItemBoss</a> inherits from <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>, and <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a> inherits from <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a>. Child boss classes can call methods in parent boss classes, making for a truly abstract, object-oriented programming model.<p>Boss classes developed by third-party plug-in developers are recognized by InDesign and used just like boss classes that are part of the core InDesign application. For example, you can make a new boss class (in this case, a custom page item) that inherits from <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>, instantiate this boss class, and put it on an InDesign document.<h2><a class="anchor" id="id_using_interfaces_in_plug_ins"></a> Using interfaces in plug-ins</h2><p>When you call methods in a boss class, you do so in a style that differs from how you normally call a method on a C++ class. First, you obtain an interface from a boss class, and then you call a method on that interface. This concept of an interface refers to something unique to the InDesign object model. InDesign interfaces are analogous to Microsoft Component Object Model (COM) interfaces.<p>Normally, you group related methods into a set. Interfaces in the InDesign object model comprise sets of such grouped methods and are denoted as pure abstract C++ classes. By denoting them as pure abstract C++ classes, you can call all methods within a particular interface in a boss class, even from outside the interface itself.<p>For example, <a class="el" href="classk_page_item_boss.html">kPageItemBoss</a> represents the base class for all page items that can be placed on a document. This boss class aggregates (contains) the <a class="el" href="class_i_hierarchy.html">IHierarchy</a> interface. By obtaining this interface and calling its methods, you can obtain information about the object hierarchy of image and text-frame items in an InDesign document.<p>InDesign&#39;s naming convention is that all interface names begin with a capital &quot;I,&quot; so you can distinguish interfaces at a glance.<h3><a class="anchor" id="id_ipmunknown_class"></a> IPMUnknown class</h3><p>The base class of almost all InDesign interfaces is <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. For the InDesign object model to function correctly, interfaces must inherit from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> and support the QueryInterface, AddRef, and Release methods. You can query a boss for an interface pointer of type <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> and get back a valid interface pointer.<h3><a class="anchor" id="id_querying_for_interfaces_and_reference_counts"></a> Querying for interfaces and reference counts</h3><p>QueryInterface is used to query for an interface on a boss. This function returns a pointer to an interface; it returns nil if an instance of the interface is not available. QueryInterface automatically calls AddRef, which increments the reference count on the interface. The object model keeps track of the reference count for interfaces on bosses. If all interfaces on a boss have a reference count of zero, the boss can be marked for deletion. If you used QueryInterface to obtain an interface pointer, you must call the Release method when you are through with the interface, so the reference count for the interface is decremented correctly. Forgetting to call Release results in an interface with a positive reference count; this condition (boss leak) is a memory leak in the InDesign object model.<h3><a class="anchor" id="id_what_is_interfaceptr"></a> What is InterfacePtr?</h3><p><a class="el" href="class_interface_ptr.html">InterfacePtr</a> (&lt;SDK&gt;/source/public/includes/InterfacePtr.h) is a wrapper class that wraps <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. In addition to the AddRef method that is called automatically by QueryInterface, this template-based wrapper class also calls Release when the interface pointer goes out of scope. This ensures that Release is called on an interface, preventing boss leaks.<p>Here is a sample of how you would instantiate an interface pointer to <a class="el" href="class_i_spread_list.html">ISpreadList</a> from <a class="el" href="class_i_document.html">IDocument</a>, using <a class="el" href="class_interface_ptr.html">InterfacePtr</a>:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadList&gt;</a> iSpreadList(iDocument, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><h3><a class="anchor" id="id_which_variety_of_interfaceptr_constructor_should_i_use"></a> Which variety of InterfacePtr constructor should I use?</h3><p>There are many <a class="el" href="class_interface_ptr.html">InterfacePtr</a> constructors, which may seem overwhelming; however, three major types of constructors are used commonly.<p><b>Type 1a: To get an interface in the same boss class (using default PMIID)</b><div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(<span class="keyword">const</span> <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>* p, <span class="keyword">const</span> <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>&amp;)</div></div><p>This assumes that you already have an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> of some kind or a pointer to an object derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. You use this to obtain an interface aggregated on the same boss class. If the interface declaration defines an enum kDefaultIID, the <a class="el" href="class_use_default_i_i_d.html">UseDefaultIID</a> construct automatically uses the default PMIID (interface ID). In this case, the new <a class="el" href="class_interface_ptr.html">InterfacePtr</a> has its reference count incremented by the <a class="el" href="class_i_p_m_unknown.html#aa90872f1896d2f2623cbb6f0bff98443">IPMUnknown::AddRef</a> method:<div class="fragment"><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* doc = <a class="code" href="class_utils.html">Utils&lt;ILayoutUIUtils&gt;</a>()-&gt;GetFrontDocument();</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadList&gt;</a> iSpreadList(doc, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p><b>Type 1b: To get an interface in the same boss class (specifying a PMIID)</b><div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(<span class="keyword">const</span> <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>* p, <a class="code" href="class_i_d_type.html">PMIID</a> iid);</div></div><p>This assumes that you already have an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> of some kind or a pointer to an object derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. You use this to obtain an interface aggregated on the same boss class, but the interface declaration does not define an enum kDefaultIID. You also use this when there are multiple implementations of the same interface aggregated on the same boss class. In this case, the new <a class="el" href="class_interface_ptr.html">InterfacePtr</a> has its reference count incremented by the <a class="el" href="class_i_p_m_unknown.html#aa90872f1896d2f2623cbb6f0bff98443">IPMUnknown::AddRef</a> method. There are situations when you must specify a PMIID, like when you want to obtain an <a class="el" href="class_i_style_name_table.html">IStyleNameTable</a> on <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> or <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>. You also can regard this as a trick to aggregate multiple implementations of the same interface into your boss class.<div class="fragment"><div class="line"><span class="comment">// docWorkspace is an IWorkspace aggregated on kDocBoss.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IStyleNameTable&gt;</a> iParaStyleTable(docWorkspace, IID_IPARASTYLENAMETABLE);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IStyleNameTable&gt;</a> iCharStyleTable(docWorkspace, IID_ICHARSTYLENAMETABLE);</div></div><p><b>Type 2: To Get a specific interface, not IPMUnknown*, from a Bridge Method</b><div class="fragment"><div class="line"><span class="keyword">explicit</span> <a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(IFace* p);</div></div><p>Generally, Query... methods (commonly known as bridge methods, see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_using_databases_and_objects_in_plug_ins">Using databases and objects in plug-ins</a>) return a pointer to an interface derived from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> and increment the reference count; however, you still want to take advantage of the automated cleanup provided by <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. To prevent reference counts from incrementing, as in Type 1a and 1b, use this constructor, which does not call <a class="el" href="class_i_p_m_unknown.html#aa90872f1896d2f2623cbb6f0bff98443">IPMUnknown::AddRef</a>:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGeometry&gt;</a> iPageGeometry(iSpread-&gt;QueryNthPage(0));</div></div><p>The following line of code looks innocent, but if you execute this and quit InDesign, you will get a boss leak:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IGeometry&gt;</a> iPageGeometry(iSpread-&gt;QueryNthPage(0), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>Look carefully: ISpread- &gt; QueryNthPage(0) increments the reference count and, by means of <a class="el" href="class_interface_ptr.html">InterfacePtr</a> constructor Type 1a, the reference count increments again.<p>The easiest remedy is to remove <a class="el" href="class_use_default_i_i_d.html">UseDefaultIID</a>. If you leave it as is and fail to notice that a call to iPageGeometry-&gt; Release is necessary, you will get a boss leak.<p><b>Type 3a: To get a persistent object on a database using a <a class="el" href="class_u_i_d_ref.html">UIDRef</a></b><div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(<span class="keyword">const</span> <a class="code" href="class_u_i_d_ref.html">UIDRef</a>&amp; ref, <a class="code" href="class_i_d_type.html">PMIID</a> iid);</div><div class="line"><span class="comment">// Usable when kDefaultIID is defined</span></div><div class="line"><a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(<span class="keyword">const</span> <a class="code" href="class_u_i_d_ref.html">UIDRef</a>&amp; ref, <span class="keyword">const</span> <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>&amp;); </div></div><p>In this case, you use a preexisting <a class="el" href="class_u_i_d_ref.html">UIDRef</a> on a boss class. A <a class="el" href="class_u_i_d_ref.html">UIDRef</a> is a combination of the database that is the target of persistence and a unique ID (UID) of a boss class object. This constructor is useful after obtaining a <a class="el" href="class_u_i_d_list.html">UIDList</a> from a command or a selection target.<p>The following code processes NewFrameCmd, and then obtains the frame&#39;s <a class="el" href="class_i_hierarchy.html">IHierarchy</a>:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> newPageItemHierarchy((newFrameCmd-&gt; GetItemListReference()).GetRef(0), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>The following code obtains the first layer that contains page items:<div class="fragment"><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* iDocument = <a class="code" href="class_utils.html">Utils&lt;ILayoutUIUtils&gt;</a>()-&gt;GetFrontDocument();</div><div class="line"><a class="code" href="class_u_i_d_ref.html">UIDRef</a> layerRef(::GetDataBase(iDocument), iSpreadHier-&gt;GetChildUID(2));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadLayer&gt;</a> spreadLayer(layerRef, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p><b>Type 3b: To get a persistent object on a database using a UID</b><div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(<a class="code" href="class_i_data_base.html">IDataBase</a>* db, <a class="code" href="class_i_d_type.html">UID</a> uid, <a class="code" href="class_i_d_type.html">PMIID</a> iid);</div><div class="line"><span class="comment">// Usable when kDefaultIID is defined</span></div><div class="line"><a class="code" href="class_interface_ptr.html#ac29605b98dadcaaa08ce64d1860743e6">InterfacePtr::InterfacePtr</a>(<a class="code" href="class_i_data_base.html">IDataBase</a> *db, <a class="code" href="class_i_d_type.html">UID</a> uid, <span class="keyword">const</span> <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>&amp;); </div></div><p>This is like Type 3a, but it is useful when you do not need to create another <a class="el" href="class_u_i_d_ref.html">UIDRef</a>; specifically, when you are getting interfaces on the same database. This is commonly used when you navigate the page item parent/child relationship.<p>The following code obtains the first layer (spread-layer index 2) that contains page items:<div class="fragment"><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* iDocument = <a class="code" href="class_utils.html">Utils&lt;ILayoutUIUtils&gt;</a>()-&gt;GetFrontDocument();</div><div class="line"><a class="code" href="class_i_data_base.html">IDataBase</a>* iDataBase = ::GetDataBase(iDocument);</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadLayer&gt;</a> spreadLayer(iDataBase, iSpreadHier-&gt;GetChildUID(2), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>The following code navigates up from kFrameItemBoss(ITextFrameColumn), <a class="el" href="classk_multi_column_item_boss.html">kMultiColumnItemBoss</a>, and to kSplineItem (see <a class="el" href="class_i_data_base.html">IDataBase</a>, <a class="el" href="class_i_hierarchy.html">IHierarchy</a>):<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> frameItemHierarchy(iTextFrameColumn, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> mcitemHierarchy (iDataBase, frameItemHierarchy-&gt;GetParentUID(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> splineItemHierarchy (iDataBase, mcitemHierarchy-&gt;GetParentUID(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><h2><a class="anchor" id="id_using_databases_and_objects_in_plug_ins"></a> Using databases and objects in plug-ins</h2><p>In InDesign, document files are represented internally as databases. You can make boss-class objects persistent by storing them in databases. In a C++ programming model, C++ classes generally are declared with a class keyword and instantiated in memory (for example, a heap). By serializing the data in the instantiated object, the data can be stored in a complex class structure in a file and retrieved from the file.<p>To store boss-class objects in a database, a unique identifier (UID) is assigned to each boss-class object. In the InDesign object model, UIDs (which are stored internally as 32-bit unsigned integers) are handles that are treated somewhat like pointers. For example, a document boss (<a class="el" href="classk_doc_boss.html">kDocBoss</a>) aggregates <a class="el" href="class_i_spread_list.html">ISpreadList</a>, an interface that owns the UIDs of all spreads within a document; within each spread, you can obtain page-item objects and pages by means of the UIDs obtained from <a class="el" href="class_i_hierarchy.html">IHierarchy</a> (a bridge interface for the object tree in a document). Furthermore, these UIDs are persistent across InDesign application sessions, so even after quitting and restarting InDesign, the UIDs stored in your documents continue to be valid.<p>To call methods on interfaces aggregated on these boss-class objects in a C++ program, the actual objects must be instantiated in memory as C++ objects. You can obtain pointers to these interfaces using the various Get... and Query... methods (bridge methods). The general rule of thumb with bridge methods is that Get... methods do not increment reference count, but Query... methods do.<h2><a class="anchor" id="id_step_7_insert_a_string_into_a_text_frame"></a> Step 7: Insert a string into a text frame</h2><h3><a class="anchor" id="id_step_71_insert_text_into_the_current_text_selection"></a> Step 7.1: Insert text into the current text selection</h3><p>The selection architecture is used to make changes to currently selected items. This architecture is built on a group of selection-suite interfaces, which usually contain &quot;Suite&quot; in the interface name and have methods like I&lt;Xxx&gt;Suite::CanDoSomething and I&lt;Xxx&gt;Suite::DoSomething. One good thing about this approach is that you do not have to worry about what the selected items are, because the branching is done behind the scenes; you do not have to handle everything in your plug-in code. To learn more about the selection architecture, see the <a class="el" href="id_solutions.html#id_selection">Selection</a> chapter of Adobe InDesign Plug-In Programming Guide.<p>In this case, you want to edit the text at the current selection. Look in the &lt;SDK&gt;/source/public/interfaces/text directory, and you will find a few interfaces ending in *Suite.h. One of them is <a class="el" href="_i_text_edit_suite_8h_source.html">ITextEditSuite.h</a>. Examine this interface; it contains the methods you need:<div class="fragment"><div class="line"><span class="keyword">virtual</span> bool16 CanEditText() = 0;</div><div class="line"><span class="keyword">virtual</span> ErrorCode InsertText(<span class="keyword">const</span> <a class="code" href="class_wide_string.html">WideString</a>&amp; theText) = 0;</div></div><p>The basic idea is to first test to determine whether text on the current selection can be edited (true or false) and, if so, insert text.<p>To query for an instance of this interface, use IActiveContext::GetContextSelection to get to an <a class="el" href="class_i_selection_manager.html">ISelectionManager</a>. From <a class="el" href="class_i_selection_manager.html">ISelectionManager</a>, you can query a suite interface to see whether the queried suite is available on the current selection. When <a class="el" href="class_i_active_context.html">IActiveContext</a> is not available, you can also use the <a class="el" href="class_i_selection_utils.html">ISelectionUtils</a> interface. Because it is aggregated on the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>, you can use the <a class="el" href="class_utils.html">Utils</a> template-based helper class.<p>To add code to insert a string into a text frame, open WFPDialogController.cpp and add these #include statements at the top of the file:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;ISelectionManager.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;ITextEditSuite.h&quot;</span></div></div><p>Next, add the following code in the <a class="el" href="class_w_f_p_dialog_controller.html#a63bb5f5d04d4d84bbdbbadd3bedab462">WFPDialogController::ApplyDialogFields</a> method, immediately after where you left off in &quot;Step 6.2: Form a string to insert into the text frame&quot;. Find the following line:<div class="fragment"><div class="line">resultString.<a class="code" href="class_p_m_string.html#a7264c4911eea8b17c93c572c808e708f">Append</a>(<span class="charliteral">&#39;\r&#39;</span>);</div></div><p>After that line, add the following code, which uses <a class="el" href="class_i_active_context.html">IActiveContext</a> to obtain the current selection and uses <a class="el" href="class_i_text_edit_suite.html">ITextEditSuite</a> to insert text into the current text selection:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ITextEditSuite&gt;</a> textEditSuite(myContext-&gt;GetContextSelection(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> (textEditSuite &amp;&amp; textEditSuite-&gt;CanEditText()) {</div><div class="line"> ErrorCode status = textEditSuite-&gt;InsertText(<a class="code" href="class_wide_string.html">WideString</a>(resultString));</div><div class="line"> ASSERT_MSG(status == kSuccess, <span class="stringliteral">&quot;WFPDialogController::ApplyFields: can&#39;t insert text&quot;</span>);</div><div class="line"> }</div></div><p>Inside the implementation for <a class="el" href="class_i_text_edit_suite.html">ITextEditSuite</a>, text is inserted by processing a command (<a class="el" href="class_i_text_model_cmds.html#af9ffc2077723a27ae1bfff0c342e0224">ITextModelCmds::TypeTextCmd</a>) on the text model. Commands are used throughout the InDesign API to change the model.<h3><a class="anchor" id="id_step_72_save_build_and_test"></a> Step 7.2: Save, build, and test</h3><p>After making the changes, save all your edited source files, build the plug-in, move the plug-in to the Plug-Ins directory, and start InDesign. Then, create a text frame on a new document, make sure the cursor is blinking, select the Plug-in menu so your dialog shows up, select a fish type, and enter its price. Click OK. The following figure shows the result: <div class="image"><img alt="Goal_InsertedOneItem.gif" src="Goal_InsertedOneItem.gif" /></div><h2><a class="anchor" id="id_using_commands_in_plug-ins"></a> Using commands in plug-ins</h2><p>InDesign uses commands to modify internal data. This offers the following benefits:<ul><li>You do not have to modify the internal data (model) directly. The internal data can stay encapsulated.<li>Commands facilitate actions such as Undo and Redo.<li>Commands allow your plug-in to be notified about details of changes to the model, through the use of observers.</ul><p>You also can create custom commands. If you create custom commands, you can separate the user interface and core-feature implementation components, making for a more extensible design.<p>To find out more about processing commands, see the <a class="el" href="id_solutions.html#id_commands">Commands</a> chapter of Adobe InDesign Plug-In Programming Guide.<h2><a class="anchor" id="id_step_8_disable_the_menu_with_no_text_selection"></a> Step 8: Disable the menu with no text selection</h2><p>Because you do not want this dialog to be opened when there is no text selection, you will make some changes so that the menu is disabled when there is no text selection.<h3><a class="anchor" id="id_step_81_modify_actiondef"></a> Step 8.1: Modify ActionDef</h3><p>Open the WFP.fr resource file and add the following line toward the top of the file, with all the other include statements:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;TextID.h&quot;</span></div></div><p>Go down to the ActionDef resource, to the second block, which begins with <a class="el" href="classk_w_f_p_action_component_boss.html">kWFPActionComponentBoss</a>. Change kDisableIfLowMem to kDisableIfSelectionDoesNotSupportIID. On the next line, change kInvalidInterfaceID to IID_ITEXTEDIT_ISUITE. These constants are defined in <a class="el" href="_action_defs_8h_source.html">ActionDefs.h</a> and <a class="el" href="_text_i_d_8h_source.html">TextID.h</a>.<div class="fragment"><div class="line">resource ActionDef (kSDKDefActionResourceID){</div><div class="line"> {</div><div class="line"> ... omitted</div><div class="line"></div><div class="line"><a class="code" href="classk_w_f_p_action_component_boss.html">kWFPActionComponentBoss</a>,</div><div class="line"> kWFPDialogActionID,</div><div class="line"> kWFPDialogMenuItemKey,</div><div class="line"> kOtherActionArea,</div><div class="line"> kNormalAction,</div><div class="line"> kDisableIfSelectionDoesNotSupportIID, <span class="comment">// Change this!</span></div><div class="line"> IID_ITEXTEDIT_ISUITE, <span class="comment">// Change this!</span></div><div class="line"> kSDKDefVisibleInKBSCEditorFlag,</div><div class="line"> }</div><div class="line">};</div></div><h3><a class="anchor" id="id_step_82_save_build_and_test"></a> Step 8.2: Save, build, and test</h3><p>After making the changes, save all your edited source files, build the plug-in, move the plug-in to the Plug-Ins directory, and start InDesign. Now create a new document, put a new text frame on it, and see whether the menu item for your plug-in is available.<h2><a class="anchor" id="id_step_9_initialize_dialog_widgets"></a> Step 9: Initialize dialog widgets</h2><p>As shown in the dialog in the following figure, the drop-down list shows nothing, and the text-edit box is blank when you open the dialog box.<div class="image"><img alt="Step3_Dialog.gif" src="Step3_Dialog.gif" /></div><dl class="section note"><dt>Note<dd>There is a hidden feature in this dialog. While the dialog box is active, hold down the Alt key (Windows) or Option key (Mac OS), to change the Cancel button to the Reset button. See the following figure. Dialogs in InDesign have the capability to reset fields to an initial state.</dl><div class="image"><img alt="Step9_DialogReset.gif" src="Step9_DialogReset.gif" /></div><p>By adding functionality to the <a class="el" href="class_w_f_p_dialog_controller.html#adcecc6e5bd0b711df6c7bff17e5d89ce">WFPDialogController::InitializeDialogFields</a> method, you can handle the initialization and resetting of dialog-box fields. In the following sections, you will add functionality to the InitializeDialogFields method.<h3><a class="anchor" id="id_step_91_add_code_to_initialize_the_dropdownlistwidget"></a> Step 9.1: Add code to initialize the DropDownListWidget</h3><p>Open WFPDialogController.cpp. You will add code to the <a class="el" href="class_w_f_p_dialog_controller.html#adcecc6e5bd0b711df6c7bff17e5d89ce">WFPDialogController::InitializeDialogFields</a> method. This method first delegates to the same method in the parent class, <a class="el" href="class_c_dialog_controller.html#acb92dad77585e64d4e7c45f9331c8b13">CDialogController::InitializeDialogFields</a>. The parent-class method sets a flag that keeps track of whether this InitializeDialogFields method was called, so make sure you call <a class="el" href="class_c_dialog_controller.html#acb92dad77585e64d4e7c45f9331c8b13">CDialogController::InitializeDialogFields</a>:<div class="fragment"><div class="line"><span class="comment">// InitializeDialogFields</span></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="class_w_f_p_dialog_controller.html#adcecc6e5bd0b711df6c7bff17e5d89ce">WFPDialogController::InitializeDialogFields</a>(<a class="code" href="class_i_active_context.html">IActiveContext</a>* dlgContext) {</div><div class="line"><a class="code" href="class_c_dialog_controller.html#acb92dad77585e64d4e7c45f9331c8b13">CDialogController::InitializeDialogFields</a>(dlgContext);</div><div class="line"></div><div class="line"><span class="comment">// Put code to initialize widget values here.</span></div><div class="line">}</div></div><p>Next, you will add some code to initialize the DropDownListWidget.<p>By calling the <a class="el" href="class_c_dialog_controller.html#ac60fdcd48e50bdab9d7603b9e6265079">CDialogController::QueryIfNilElseAddRef</a> method, you obtain a pointer to the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface. This method takes an <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface pointer as a parameter. If that pointer, the method returns the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface of the same boss class. If the pointer is not nil, the method increments the reference count to that pointer and returns the pointer. Add the following line at the top of WFPDialogController.cpp:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;IPanelControlData.h&quot;</span></div></div><p>Next, insert the following code immediately after where <a class="el" href="class_c_dialog_controller.html#acb92dad77585e64d4e7c45f9331c8b13">CDialogController::InitializeDialogFields</a> is called:<div class="fragment"><div class="line"><span class="keywordflow">do</span> {</div><div class="line"><span class="comment">// Get current panel control data.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IPanelControlData&gt;</a> pPanelData(QueryIfNilElseAddRef(nil));</div><div class="line"><span class="keywordflow">if</span> (pPanelData == nil)</div><div class="line"> { </div><div class="line"> ASSERT_FAIL(<span class="stringliteral">&quot;WFPDialogController::InitializeDialogFields: PanelControlData !&quot;</span>);</div><div class="line"><span class="keywordflow">break</span>; </div><div class="line"> }</div></div><p>If the pPanelData interface pointer is valid, call <a class="el" href="class_i_panel_control_data.html#aa9dde6f0ce56f041ddcd08b4dbc86287">IPanelControlData::FindWidget</a> in the <a class="el" href="class_i_panel_control_data.html">IPanelControlData</a> interface, to obtain an <a class="el" href="class_i_control_view.html">IControlView</a> interface pointer. This method takes a widget ID as a parameter and returns the corresponding <a class="el" href="class_i_control_view.html">IControlView</a> interface pointer.<dl class="section note"><dt>Note<dd><a class="el" href="class_i_control_view.html">IControlView</a> is the interface for CControlView, which was seen while ascending the hierarchy of widget type definitions.</dl><p>Insert the following code:<div class="fragment"><div class="line"><span class="keywordflow">else</span> { </div><div class="line"><span class="comment">// Find drop-down list menu control view from panel data. </span></div><div class="line"><a class="code" href="class_i_control_view.html">IControlView</a>* pDropDownListControlView = pPanelData-&gt;FindWidget(kWFPDropDownListWidgetID);</div><div class="line"><span class="keywordflow">if</span>( pDropDownListControlView == nil )</div><div class="line"> { </div><div class="line"><span class="comment">// Is the widget on the dialog box? </span></div><div class="line"> ASSERT_FAIL(<span class="stringliteral">&quot;WFPDialogController::InitializeDialogFields: &quot;</span></div><div class="line"><span class="stringliteral">&quot;DDListControlView &quot;</span>); </div><div class="line"><span class="keywordflow">break</span>; </div><div class="line"> }</div></div><p>Using the obtained <a class="el" href="class_i_control_view.html">IControlView</a> interface pointer, obtain the <a class="el" href="class_i_drop_down_list_controller.html">IDropDownListController</a> interface pointer, which exists in the same boss class, <a class="el" href="classk_drop_down_list_widget_boss.html">kDropDownListWidgetBoss</a>. The <a class="el" href="classk_drop_down_list_widget_boss.html">kDropDownListWidgetBoss</a> is responsible for controlling the DropDownListWidget (as defined in the resource definitions). To use the <a class="el" href="class_i_drop_down_list_controller.html">IDropDownListController</a> interface, you must add the following include statement at the top of WFPDialogController.cpp:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;IDropDownListController.h&quot;</span></div></div><p>Then, add the following code immediately after the call to pPanelData-&gt;FindWidget:<div class="fragment"><div class="line"><span class="comment">// Get IDropDownListController interface pointer.</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDropDownListController&gt;</a> pDropDownListController(pDropDownListControlView, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span>(pDropDownListController == nil)</div><div class="line">{</div><div class="line"><span class="comment">// Is the controller available?</span></div><div class="line"> ASSERT_FAIL(<span class="stringliteral">&quot;WFPDialogController::InitializeDialogFields: DDListControlView !&quot;</span>);</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line">}</div></div><p>If the pDropDownListController interface pointer is valid, call the <a class="el" href="class_i_drop_down_list_controller.html#aac5a57ed0ae495300aa6f62fc55764ce">IDropDownListController::Select</a> method to set the initial state of the DropDownListWidget to show the first element. If nothing is selected in the DropDownListWidget, the <a class="el" href="class_i_drop_down_list_controller.html#a7d3786106a62ffa4208e32eed3597812">IDropDownListController::GetSelected</a> method returns -1, which is an invalid index. The top of the list has index 0. Add the following code where you left off:<div class="fragment"><div class="line"><span class="comment">// Select the element at the given position in the list.</span></div><div class="line">pDropDownListController-&gt;Select(0);</div></div><h3><a class="anchor" id="id_step_92_add_code_to_initialize_the_texteditboxwidget"></a> Step 9.2: Add code to initialize the TextEditBoxWidget</h3><p>Initialize the text-edit box. Create an initial string using a <a class="el" href="class_p_m_string.html">PMString</a> initialized with an empty (null) string. Then, set the value of the TextEditBoxWidget to the initial string by calling the SetTextControlData method. Add the following code:<div class="fragment"><div class="line"><span class="comment">// Initialize TextEditBox.</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> InitialString(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"> SetTextControlData(kWFPTextEditBoxWidgetID, InitialString);</div><div class="line"> }</div><div class="line">} <span class="keywordflow">while</span> (kFalse);</div></div><h3><a class="anchor" id="id_step_93_save_build_and_test"></a> Step 9.3: Save, build, and test</h3><p>Save your files, build the plug-in, move it to the Plug-Ins directory, and start InDesign to try your plug-in. When you open the dialog, you should see the first list element automatically shown in the drop-down list. Select another entry from the drop-down list, hold down the Alt (Windows) or Option (Mac OS) key, and click Reset on the dialog. The drop-down list should reset to its initial state.<h2><a class="anchor" id="id_conclusion"></a> Conclusion</h2><p>The goal of this document was to help you become familiar with developing plug-in-based solutions for InDesign. While this document covers many important, fundamental aspects of InDesign development, it is only the first step. If you study the code and header files used in our completed plug-in line by line, you may find more functionality.<p>The Adobe InDesign and InCopy SDK contains an enormous amount of information to help you develop plug-in-based solutions for InDesign. At first, you may be overwhelmed, and if you try too much too soon, you may get discouraged. We recommend that you start by building some of the sample plug-in projects that are provided and using them with the debug build of InDesign. We hope that you find the sample plug-ins useful.<h1><a class="anchor" id="id_introduction_to_odfrc"></a> Introduction to ODFRC</h1><p>This chapter introduces some of the most common resources types you will encounter in ODFRC (OpenDoc Framework Resource Compiler) files. This is not an ODFRC reference, it is just enough to get you comfortable with what you will see in a typical FR file. (By convention, ODFRC files have a &quot;.fr&quot; file extension and are referred to as FR files).<h2><a class="anchor" id="id_fr_file_compilation"></a> FR file compilation</h2><p>Each plug-in project must define certain resources in an FR file. There are resources that describe required data for a plug-in, and there are many optional resources. One FR file can contain all the resources necessary for the plug-in, or it can #include other FR files. Regardless of whether everything is in a single file or resources are spread across multiple files, the main FR file is configured to compile with the ODFRC. You will see in most of the SDK samples a main FR file including other FR files.<p>The Windows and Mac OS ODFRC executables are located in the &lt;SDK&gt;/devtools/bin directory. The Windows version is Odfrc.exe, and the Mac OS version is odfrc-cmd. Adding a search path to this directory is a necessary step in setting up Visual Studio for InDesign development. This is covered <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_getting_started_with_the_indesign_sdk">Getting Started</a>. Unlike with Windows, Xcode projects must contain a path to odfrc-cmd.<p>Visual Studio projects are configured to compile FR files using a custom build tool that calls Odfrc.exe. Visual Studio custom build tools are not very smart about dependencies on changes to the input file. To trigger recompiles when the FR file changes and skip them when the file has not changed, the custom build tool is associated with an object file. This special object file is generated from a C++ file that #includes the FR file; each plug-in has one such file, usually called TriggerResourceDeps.cpp. When configured properly, ODFRC is called only when changes occur to the FR file.<p>The situation is more straightforward on Mac OS, where dependency checking works still works. InDesign plug-in projects must contain a build rule for *.fr files. Then, this rule is configured to compile FR files with odfrc-cmd. For examples of how your plug-in should be configured, see the samples included in the SDK.<h2><a class="anchor" id="id_fr_file_contents"></a> FR file contents</h2><p>FR files contain three types of content:<ul><li>Include statements - Two types of files are included, those that provide IDs (e.g. C++ h files) that are used in resources, and those that contain additional resource definitions or declarations (other FR files).<li>Resource definitions - Some FR files define new types of resources. For example, Widgets.fh, where various types of user-interface-based resources are defined.<li>Resource declarations - An FR file contains some actual resource declarations that can be read by the InDesign architecture.</ul><h2><a class="anchor" id="id_pluginversion"></a> PluginVersion</h2><p>Each plug-in must declare a PluginVersion resource. This resource is used to provide plug-in-specific information to the InDesign object model. The name may be a bit misleading, because the resource includes more than version information: It also includes the target (debug or release) for which the plug-in was compiled, the plug-in&#39;s ID, whether it supports model or user-interface operations, and supported applications and feature sets.<p>The following is a typical PluginVersion resource declaration, followed by comments about the fields in the resource.<div class="fragment"><div class="line">resource PluginVersion (kSDKDefPluginVersionResourceID) {</div><div class="line"> kTargetVersion, <span class="comment">// 1</span></div><div class="line"> kFrmLblPluginID, <span class="comment">// 2</span></div><div class="line"> kSDKDefPlugInMajorVersionNumber, kSDKDefPlugInMinorVersionNumber, <span class="comment">// 3</span></div><div class="line"> kSDKDefHostMajorVersionNumber, kSDKDefHostMinorVersionNumber, <span class="comment">// 4</span></div><div class="line"> kFrmLblLastMajorFormatChange, kFrmLblLastMinorFormatChange, <span class="comment">// 5</span></div><div class="line"> { kInDesignProduct, kInCopyProduct, kInDesignServerProduct }, <span class="comment">// 6</span></div><div class="line"> { kWildFS }, <span class="comment">// 7</span></div><div class="line"> kModelPlugIn, <span class="comment">// 8</span></div><div class="line"> kFrmLblVersion <span class="comment">// 9</span></div><div class="line">};</div></div><ol type="1"><li>The target for which this plug-in was built. This is done using kTargetVersion, which is defined differently for each target (debug or release). This is important because a plug-in&#39;s target must match the application with which it is trying to launch. For example, a debug plug-in is not compatible with the release version of the application. The application checks this resource during launch and refuses to load the plug-in if there is a mismatch.<li>The plug-in&#39;s unique ID. This sometimes is called a prefix ID, because it makes a range of IDs available to the plug-in. These IDs are used for various constructs in the InDesign architecture. This value is assigned by Adobe. For more information on acquiring a unique plug-in ID, see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_step_13_specify_the_prefix_id">Step 1.3: Specify the prefix ID</a>.<li>The major and minor version numbers for this plug-in. Typically, these are the same as the application version numbers in the next two fields.<li>The major and minor version of the application that this plug-in supports. Plug-ins must be compiled for a particular major format number. These fields should be set to &quot;kMajorVersionNumber, kMinorVersionNumber.&quot; The samples use &quot;kSDKDefPlugInMajorVersionNumber, kSDKDefPlugInMinorVersionNumber,&quot; which are simply #defines of kMajorVersionNumber and kMinorVersionNumber.<li>A plug-in can be versioned for conversion purposes. These two fields contain the major and minor format number for the plug-in. The major version should be set to match the major version of the application when the plug-in was introduced or its data format changed. The minor version number is used to mark plug-in data-format changes that occur during a product cycle.<li>A plug-in can target one or all InDesign products (InDesign, InCopy, and/or InDesign Server). This tells the architecture which product the plug-in supports. There are additional rules for plug-ins that support InDesign Server: they must not link against WidgetBin or InDesignModelAndUI.framework, and they must be model-only plug-ins.<li>The InDesign products include several different feature sets. This is related to, but different than, locales. Some localized InDesign products, like InDesign J, contain additional features; these are called feature sets. You can target any combination of feature sets in the PluginVersion resource. To target all feature sets, specify kWileFS.<li>This field declares whether the plug-in supports model (kModelPlugIn) or user-interface (kUIPlugIn) operations, making model/user-interface separation mandatory. These values come from the <a class="el" href="_plug_in_model___u_i_attributes_8h_source.html">PlugInModel_UIAttributes.h</a> header. This is important in InDesign&#39;s multithreaded environment. Only model plug-ins are available for operations that occur on background threads.<li>This final field is the plug-in&#39;s four-part version string (e.g. 1.0.0.0).</ol><h2><a class="anchor" id="id_plugindependency"></a> PluginDependency</h2><p>One plug-in can depend on another plug-in. Consider user-interface and model plug-ins. A user-interface plug-in is meaningless without a model plug-in present.<div class="fragment"><div class="line">resource PluginDependency(1)</div><div class="line">{</div><div class="line"> kWildFS,</div><div class="line"> {</div><div class="line"> kWatermarkPluginID, kWatermarkPluginName,</div><div class="line"> kMajorVersionNumber, kMinorVersionNumber,</div><div class="line"> }</div><div class="line">};</div></div><h2><a class="anchor" id="id_extraplugininfo"></a> ExtraPluginInfo</h2><p>InDesign plug-ins can contribute data to a document. A document can still be opened by a user if the plug-in is missing, but the document may not behave as expected. The ExtraPluginInfo allows a plug-in developer to control the error message that is presented when the plug-in is determined to be missing.<div class="fragment"><div class="line">resource ExtraPluginInfo(1)</div><div class="line">{</div><div class="line"> kFrmLblCompanyValue, <span class="comment">// Company name</span></div><div class="line"> kFrmLblMissingPluginURLValue, <span class="comment">// URL </span></div><div class="line"> kFrmLblMissingPluginAlertValue, <span class="comment">// Missing plug-in alert text</span></div><div class="line">};</div></div><h2><a class="anchor" id="id_criticaltags_and_ignoretags"></a> CriticalTags and IgnoreTags</h2><p>InDesign offers some control over what happens when your plug-in is missing. By default, it warns you about the missing plug-in. You can suppress these warnings using an IgnoreTags resource, or you can trigger a more stern warning using CriticalTags. Both resources allow you to specify implementation or class IDs.<div class="fragment"><div class="line">resource CriticalTags(1) {</div><div class="line"> kImplementationIDSpace,</div><div class="line"> {</div><div class="line"> kPstLstDataPersistImpl,</div><div class="line"> kPstLstUIDListImpl,</div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource CriticalTags(2) {</div><div class="line"> kClassIDSpace,</div><div class="line"> {</div><div class="line"><a class="code" href="classk_pst_lst_data_boss.html">kPstLstDataBoss</a>,</div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource IgnoreTags(1) {</div><div class="line"> kImplementationIDSpace,</div><div class="line"> {</div><div class="line"> kPersistBoolDataImpl,</div><div class="line"> }</div><div class="line">};</div></div><h2><a class="anchor" id="id_schemalist"></a> SchemaList</h2><p>InDesign plug-ins can write (or retain) implementation data in document databases. Such plug-ins must be able to read and write this data when directed by the system. Sometimes, however, an implementation needs to change what data it writes, while being aware of data from prior versions of the plug-in. Schema conversion is a convenient way to handle data conversion at the resource level. Typically, you will encounter or implement something like the following:<div class="fragment"><div class="line">resource SchemaList(1){</div><div class="line">{</div><div class="line"> Schema</div><div class="line"> {</div><div class="line"> kMyDataImpl,</div><div class="line"> {kRocketMajorFormat, kMyDataChangeChg},</div><div class="line"> {</div><div class="line"> {Int32 {1, kMyDataDefaultIndex}},</div><div class="line"> {Int32 {2, kMyDataDefaultSize}},</div><div class="line"> }</div><div class="line">};</div></div><p>This resource captures a data-format change. It records what data kMyDataImpl writes at a particular revision number; in this case, it is a pair of int32 values along with default values (kMyDataDefaultIndex, and kMydataDefaultSize) to be used during conversion (if, for example, you opened an older document without that data present).<p>This also is important if the implementation needs to be changed. For example, if an extra bool16 is added to the stream, it could be described using another schema.<div class="fragment"><div class="line">resource SchemaList(2){{</div><div class="line"> Schema</div><div class="line"> {</div><div class="line"> kMyDataImpl,</div><div class="line"> {kRocketMajorFormat, kMyDataChangeChg2},</div><div class="line"> {</div><div class="line"> {Int32 {1, kMyDataDefaultIndex}},</div><div class="line"> {Int32 {2, kMyDataDefaultSize}},</div><div class="line"> {Bool16 {3, kMyDataDefaultActive}},</div><div class="line"> }</div><div class="line">};</div></div><p>This is a very basic introduction to schemas. For details about schema conversion, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_persistent_data_and_data_conversion">Persistent Data and Data Conversion</a>.<h2><a class="anchor" id="id_implementationalias"></a> ImplementationAlias</h2><p>The InDesign object model references C++ implementations by ID. You may find it desirable to add an implementation to a boss class more than once, however, the InDesign object model does not support adding duplicate implementation IDs. The ImplementationAlias resource allows you to create a new implementation ID for an existing implementation.<div class="fragment"><div class="line">resource ImplementationAlias(1){</div><div class="line"> {</div><div class="line"> kSnippetNameDataImpl, kStringDataImpl,</div><div class="line"> kSnippetCategoriesDataImpl, kStringListDataImpl,</div><div class="line"> kSnippetDescriptionDataImpl, kStringDataImpl,</div><div class="line"> kSnippetPreconditionsDataImpl, kStringDataImpl,</div><div class="line"> }</div><div class="line">};</div></div><h2><a class="anchor" id="id_classdescriptiontable"></a> ClassDescriptionTable</h2><p>Boss classes are at the heart of the InDesign object model. The ClassDescriptionTable resource allows you to declare new bosses or to modify existing bosses. You can add an interface/implementation pair into an existing boss using an AddIn directive. To declare a new boss, you can use Class directives. Examples of both follow.<div class="fragment"><div class="line">resource ClassDescriptionTable(1){{{</div><div class="line"> AddIn</div><div class="line"> {</div><div class="line"><a class="code" href="classk_workspace_boss.html">kWorkspaceBoss</a>,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IMYDATA, kMyDataImpl,</div><div class="line"> }</div><div class="line"> },</div><div class="line"> Class</div><div class="line"> {</div><div class="line"> kMyDataBoss,</div><div class="line"> kSomeBaseClassDataBoss, <span class="comment">// Base Class</span></div><div class="line"> {</div><div class="line"> IID_IMYDATA, kMyDataImpl,</div><div class="line"> }</div><div class="line"> },</div><div class="line">}}};</div></div><p>Boss classes support inheritance. This allows a child boss class to inherit all the interface/implementation pairs from another boss. This is done by specifying a valid ClassID in the second field of the Class directive. The preceding example inherits the implementations in kSomeBaseClassDataBoss.<h2><a class="anchor" id="id_factorylist"></a> FactoryList</h2><p>InDesign plug-ins must register each implementation. This prevents the linker from looking at them as dead code. The FactoryList resource typically includes the implementation registrations from another header file.<div class="fragment"><div class="line">resource FactoryList (1){</div><div class="line"> kImplementationIDSpace,</div><div class="line"> {</div><div class="line"><span class="preprocessor"> #include &quot;FrmLblUIFactoryList.h&quot;</span></div><div class="line"> }</div><div class="line">};</div></div><p>In effect, this amounts to something like the following:<div class="fragment"><div class="line">resource FactoryList (1) {</div><div class="line"> kImplementationIDSpace, {</div><div class="line"> REGISTER_PMINTERFACE(<a class="code" href="class_frm_lbl_u_i_action_component.html">FrmLblUIActionComponent</a>, kFrmLblUIActionComponentImpl)</div><div class="line"> REGISTER_PMINTERFACE(<a class="code" href="class_frm_lbl_u_i_dialog_controller.html">FrmLblUIDialogController</a>, kFrmLblUIDialogControllerImpl)</div><div class="line"> }</div><div class="line">};</div></div><h2><a class="anchor" id="id_localeindex"></a> LocaleIndex</h2><p>InDesign plug-ins are fully localizable, including the ability to provide both localized strings and user-interface layouts.<dl class="section note"><dt>Note<dd>Using EVE in dialogs and panels saves you from having to create duplicate UI definitions for different languages since EVE automatically lays out the interface, rather than using specific widgets sizes and co-ordinates. You are strongly encouraged to use EVE for laying out dialogs and panels. See <a class="el" href="id_using_eve_for_dialogs.html">Using EVE for dialogs</a> for more details on EVE.</dl><p>The following declares that the plug-in will provide localization strings for the Japanese feature set, running in the Japanese locale, but use English for everything else.<div class="fragment"><div class="line">resource <a class="code" href="class_locale_index.html">LocaleIndex</a> ( kSDKDefStringsResourceID) {</div><div class="line"> kStringTableRsrcType,</div><div class="line"> {</div><div class="line"> kWildFS, k_enUS, kSDKDefStringsResourceID + index_enUS</div><div class="line"> kInDesignJapaneseFS, k_jaJP, kSDKDefStringsResourceID + index_jaJP</div><div class="line"> kWildFS, k_Wild, kSDKDefStringsResourceID + index_enUS</div><div class="line"> }</div><div class="line">};</div></div><p>In this example, kStringTableRsrcType tells InDesign that these resources are for strings. A <a class="el" href="class_locale_index.html">LocaleIndex</a> that specifies kViewRsrcType is used to localize ODFRC-based user-interface components like dialogs and panels.<h2><a class="anchor" id="id_stringtable"></a> StringTable</h2><p>The StringTable resource is used to provide a set of string translations for a given locale. It typically looks something like the following, but with many more strings.<div class="fragment"><div class="line">resource StringTable (kSDKDefStringsResourceID + index_enUS) {</div><div class="line"> k_enUS, <span class="comment">// Locale Id</span></div><div class="line"> kEuropeanWinToMacEncodingConverter, <span class="comment">// Character encoding converter (irp)</span></div><div class="line"> {</div><div class="line"><span class="comment">// Strings..</span></div><div class="line"><span class="stringliteral">&quot;MyDataOnMenuItem&quot;</span>, <span class="stringliteral">&quot;My Data On&quot;</span>,</div><div class="line"> ...</div><div class="line"> }</div><div class="line">};</div></div><p>When kMyDataOnMenuItem is used in a <a class="el" href="class_p_m_string.html">PMString</a>, it is translated to &#39;My Data On&#39;. This is not very interesting when dealing with English strings, but it is extremely useful when localizing your plug-in. For details see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_localization">Localization</a>.<h2><a class="anchor" id="id_usererrortable"></a> UserErrorTable</h2><p>Some InDesign APIs return an ErrorCode on failure. An ErrorCode is a value that InDesign or a plug-in defines within in the kErrorIDSpace using a plug-in prefix, as follows:<div class="fragment"><div class="line">DECLARE_PMID(kErrorIDSpace, kMySetDataFailureErrorCode, kMyPluginPrefix + 0)</div></div><p>An ErrorCode can be mapped to a more descriptive string using the UserErrorTable.<div class="fragment"><div class="line">resource UserErrorTable(kSDKDefErrorStringResourceID) {</div><div class="line"> {</div><div class="line"> kMySetDataFailureErrorCode, <span class="stringliteral">&quot;Failed to Set Data&quot;</span>,</div><div class="line"> }</div><div class="line">};</div></div><h2><a class="anchor" id="id_other_resources"></a> Other resources</h2><p>You will encounter several other significant and sometimes complex resource types that, in conjunction with C++ code, are used to implement user interfaces and scripting. MenuDef and ActionDef resources are used to define InDesign menus and actions. There are many widget resource types used to describe dialogs and panels. The VersionedScriptElementInfo resources describe the objects and properties that a plug-in contributes to InDesign&#39;s scripting model. Scripting-related resources are covered in more detail in <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a>.<h3><a class="anchor" id="id_resource_folder"></a> Resource folder</h3><p>InDesign supports multithreaded resource access. When a plug-in is compiled, ODFRC generates several new folders containing resource files. On Windows, these folders are in the &quot;(&lt;PluginName&gt; Resources)&quot; directory, parallel to the plug-in file. Note that the parentheses are part of the directory name. On Mac, the folders are in the Resources directory of the plug-in bundle. On Windows and Mac OS, if the folder name is inconsistent with the plug-in name or a resource file is missing, the plug-in cannot be loaded.<h1><a class="anchor" id="id_introduction_to_the_indesign_object_model"></a> Introduction to the InDesign Object Model</h1><p>This chapter discusses boss classes, interfaces, persistence, commands, facades, and the lifecycle of a plug-in.<h2><a class="anchor" id="id_boss_classes"></a> Boss classes</h2><p>A boss class defines an aggregate object type comprising one or more C++ classes. Like C++ classes, a boss class can be instantiated into an instance, and bosses support inheritance. Unlike a C++ class, however, a boss does not comprise methods and variables. The member type of a boss is a C++ class, accessible via an interface; this also is known as an interface/implementation pair. And unlike C++ classes, you can change the definition of existing boss classes by adding additional interface/implementation pairs. This is demonstrated below.<h3><a class="anchor" id="id_interfaces_and_implementations"></a> Interfaces and implementations</h3><p>Interfaces are purely abstract classes, commonly used in object-oriented systems to provide a common contract between callers and different underlying types. In C++, they are classes consisting entirely of pure virtual functions. Interfaces are not instantiated but instead can be implemented, meaning a subclass inherits the interface and provides definitions for all the pure virtual functions. The subclass is then instantiated. For example, InDesign includes several implementations of the <a class="el" href="class_i_shape.html">IShape</a> interface. Each implementation is unique, but all are accessible via the <a class="el" href="class_i_shape.html">IShape</a> interface.<p>The following figure gives you an idea what a boss looks like in memory.<div class="image"><img alt="getting-started-2.gif" src="getting-started-2.gif" /></div><h3><a class="anchor" id="id_defining_and_adding_to_bosses_in_odfrc"></a> Defining and adding to bosses in ODFRC</h3><p>Boss definitions and add-ins are defined in a ClassDescriptionTable in your plug-in&#39;s ODFRC resource file. For example, the following is a ClassDescriptionTable containing one boss definition and one boss add-in:<div class="fragment"><div class="line">resource ClassDescriptionTable(kMyClassDescriptionTableResourceID) {{{</div><div class="line">Class {</div><div class="line"> kMyNewBoss,</div><div class="line"> kInvalidClass, {</div><div class="line"> IID_IMYNEW, kMyNewImpl,</div><div class="line"> IID_IMYNEWDATA, kMyNewDataImpl,</div><div class="line"> }}</div><div class="line">AddIn {</div><div class="line"><a class="code" href="classk_utils_boss.html">kUtilsBoss</a>,</div><div class="line"> kInvalidClass, {</div><div class="line"> IID_ICJKGRIDUTILS, kCJKGridUtilsImpl,</div><div class="line"> IID_ICJKGRIDFACADE, kCJKGridFacadeImpl,</div><div class="line"> }</div><div class="line"> }</div><div class="line">}}};</div></div><p>Usually, a plug-in has one ClassDescriptionTable resource, but it can have more. If it has more, each resource must be assigned a unique resource ID. This particular resource ID is a simple integer ID, unique within the plug-in. Since these IDs are not used outside the plug-in, typically they are simple integers (1, 2, 3, ...).<p>A ClassDescriptionTable contains Class definitions and AddIn directives; the preceding example contains one of each. Aside from those keywords and the braces, commas, and semicolon, everything is a 32-bit ID.<p>In the Class block, the first field is an ID for the new boss (kMyNewBoss). The second field is used to specify a parent boss. Bosses inherit all the interface/implementation pairs of their parent. The example specifies a parent of kInvalidClass, meaning there is no parent. Finally, a boss definition contains a block of interface/implementation pairs.<p>An AddIn adds an interface/implementation pair to an existing boss class. This is useful when you need to add functionality to existing InDesign objects; for example, the <a class="el" href="classk_doc_boss.html">kDocBoss</a> represents an InDesign document. You may find it useful to create an AddIn for the <a class="el" href="classk_doc_boss.html">kDocBoss</a>. The syntax for an AddIn is similar to a boss definition, but it specifies an existing boss in the first field. The second field, which specifies a parent in the Class definition, must be set to kInvalidClass. Then the AddIn contains a block of interface/implementation pairs to add into the existing boss.<h3><a class="anchor" id="id_unique_prefix-based_ids"></a> Unique prefix-based IDs</h3><p>Each boss, interface, and implementation has a unique ID that identifies it within the space of all InDesign bosses, interfaces, or implementations. The boss, interface, and implementation ID spaces are separate spaces, so your plug-in can safely use the same number for an interface and a boss, but there should be no overlap within a space; for example, no overlap of bosses with other bosses.<p>The IDs are 32-bit unsigned integers. To ensure that unique IDs are used in each plug-in, you must request a 24-bit prefix from InDesign Developer Support. See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_step_13_specify_the_prefix_id">Step 1.3: Specify the prefix ID</a> for the process to get a new prefix ID. The 24-bit prefix you receive is reserved for use in your plug-in, giving you a maximum value of 256 values for bosses, interfaces, or any other prefix-based IDs. Typically, this is more than enough for any plug-in; in fact, sometimes this is enough for a set of plug-ins.<p>The following table lists the InDesign naming conventions for boss, interface, and implementation constants.<table class="doxtable"><tr><th>Constant type </th><th>Prefix </th><th>Suffix </th></tr><tr><td>Boss </td><td>k </td><td>Boss </td></tr><tr><td>Interface ID </td><td>IID_ </td><td>(none) </td></tr><tr><td>Implementation ID </td><td>k </td><td>Impl </td></tr></table><p>You can use the same naming conventions for the bosses and interfaces that make up your plug-in. This will help you quickly differentiate between bosses and interfaces and keep them separate from other groups of unique IDs. Each plug-in (yours included) has an XXXID.h file (where XXX is the short name of the plug-in) that defines the prefix ID used and various IDs used by the plug-in. For an example of such a file, see any of the sample plug-ins.; in particular, see the FrameLabel samples at:<div class="fragment"><div class="line">&lt;SDK&gt;/source/sdksamples/framelabel/FrmLblID.h.</div></div><h3><a class="anchor" id="id_ipmunknown"></a> IPMUnknown</h3><p>Interface classes that are used as a component of a boss are either provided by the SDK, such as <a class="el" href="class_i_command.html">ICommand</a>, or written by the plug-in developer to provide some plug-in-specific function. They can contain any types of methods, but to work as a component of a boss, they must inherit from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>. For example, see the definition of the <a class="el" href="class_i_command.html">ICommand</a> interface: <div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="class_i_command.html">ICommand</a> : <span class="keyword">public</span> <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a></div><div class="line">{</div><div class="line"> ... </div><div class="line">};</div></div><p>Any interface you write needs to publicly inherit <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a>, which contains three important methods: AddRef(), Release(), and QueryInterface(). AddRef() and Release() deal with reference counting. QueryInterface() provides access to the other interfaces on the boss.<h3><a class="anchor" id="id_querying_for_other_interfaces_on_the_boss"></a> Querying for other interfaces on the boss</h3><p>The QueryInterface (PMIID interface ID) on <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> allows you to acquire a pointer to other interfaces on the boss or determine that a boss does not support a particular interface. If the boss contains an interface for the passed-in ID, it calls AddRef() and returns a pointer to the interface; otherwise, it returns nil.<div class="fragment"><div class="line">IFoo * foo = bar-&gt;QueryInterface( IID_IFOO );</div></div><h3><a class="anchor" id="id_reference_counting"></a> Reference counting</h3><p>Bosses are reference-counted objects. A reference count is maintained for the boss, not for the individual interfaces. When you call AddRef() or Release() on an interface, the reference count for the entire boss object is adjusted. Sometime after the reference count reaches zero (this is not guaranteed to happen right away), the object model deletes the boss from memory.<p>When your code needs to manage a reference to a boss object, you must call AddRef(). If this is not done, you run the risk of the boss being deleted while still in use. Likewise, when the reference is no longer needed, the reference count must be deleted by calling Release(). If this is not done, you will create a boss leak (which, in turn, creates memory leaks). In essence, you are allocating system resources and never freeing them.<p><b>Reference-counting example</b><p>Consider the MyClass::AddBarRef example below. The caller passes an IBar* to AddBarRef(), and MyClass stores the pointer for later use. Unless AddRef() is called, the code cannot assume that fBar will point to a valid object when it is used later. In this case, MyClass holds a reference to the boss and needs to call AddRef().<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyClass::AddBarRef( IBar* bar)</div><div class="line">{</div><div class="line"><span class="keywordflow">if</span>( bar )</div><div class="line"> {</div><div class="line"> fBar = bar;</div><div class="line"> fBar-&gt;AddRef();</div><div class="line"> }</div><div class="line">}</div></div><p>If a MyClass instance holds a valid fBar reference, Release() needs to be called at some point. This could happen in the destructor:<div class="fragment"><div class="line">MyClass::~MyClass()</div><div class="line">{</div><div class="line"><span class="keywordflow">if</span>( fBar )</div><div class="line"> {</div><div class="line"> fBar-&gt;Release();</div><div class="line"> fBar = nil;</div><div class="line"> }</div><div class="line">}</div></div><dl class="section note"><dt>Note<dd>If the preceding MyClass instance and fBar were part of the same boss class, this code would create a boss leak. Destructors are not called until after the boss&#39;s reference count reaches zero. In this case, the reference count would never reach zero, so the destructor would never be called. Do not make this mistake!</dl><p>In other cases, it is entirely appropriate to pass an interface pointer to a function without calling AddRef(). For example, consider the following CallBar example. This method does not need to hold a reference to the boss. It simply performs some operation on the passed-in pointer; it does not save it for later use.<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyClass2::CallBar( IBar * bar ){</div><div class="line"><span class="keywordflow">if</span>( bar )</div><div class="line"> {</div><div class="line"> bar-&gt;DoSomething();</div><div class="line"> }</div><div class="line">}</div></div><h3><a class="anchor" id="id_interfaceptr"></a> InterfacePtr</h3><p>Typically, you will not need to store a reference to a boss. Most often, your code will acquire a reference to a boss, use it within a local scope, and eventually need to call Release(). In this case, you should not call QueryInterface(), AddRef(), and Release() yourself. The SDK includes a templated class called <a class="el" href="class_interface_ptr.html">InterfacePtr</a> that acts much like a smart pointer. The object is created on the stack and initialized with a reference-counted interface pointer. When the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> goes out of scope, it calls Release() in its destructor.<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyClass2::CallBar( IPMunknown * obj ){</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IBar&gt;</a> bar(obj, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">if</span> ( bar )</div><div class="line"> {</div><div class="line"> ...</div><div class="line"><span class="keywordflow">if</span>( GetErrorState() )</div><div class="line"><span class="keywordflow">return</span>;</div><div class="line"> bar-&gt;DoSomething();</div><div class="line"> }</div><div class="line"> }</div><div class="line">]</div></div><p>You will find code similar to the preceding throughout the InDesign code base. It is important to understand what is really happening and the true benefits of using <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. In this case, the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> constructor calls QueryInterface on obj (if it is non-nil). It uses a PM_IID (this is the type for an interface ID that is defined in a plug-in&#39;s ID.h file) that it extracts from an enumeration item called kDefaultIID within the IBar interface. While we recommend including such an enumeration, it is not required. If IBar did not include such an enumeration, this code would fail to compile. An alternative is to construct the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> with the ID:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IBar&gt;</a> bar(obj, IID_IBAR);</div></div><p>The preceding two <a class="el" href="class_interface_ptr.html">InterfacePtr</a> constructions are roughly equivalent to calling QueryInterface directly:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IBar&gt;</a> bar(obj-&gt;QueryInterface(IID_IBAR));</div></div><p>The one way in which the two constructors differ is that the constructor in the first two examples checks whether the passed-in pointer is nil. If it is, an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> is constructed, but its data member is nil. If the data member is non-nil, the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> destructor calls Release() when the object goes out of scope. The constructor does nothing if the <a class="el" href="class_interface_ptr.html">InterfacePtr</a>&#39;s data member is nil. A similar thing happens with the indirection operator &#39;-&gt;&#39;. It is overloaded, to behave as if you are dealing with a real pointer; however, in the debug build, it asserts that the actual pointer is non-nil. This provides an opportunity to find crashes right before they occur.<p>The final thing to understand about the MyClass2::CallBar is one of the real advantages to using an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. In this example, the function might need to return abruptly due to an error condition. Because it uses an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>, the code can just return. The <a class="el" href="class_interface_ptr.html">InterfacePtr</a>, which is constructed on the stack, is destructed on return, so Release() is called automatically. Often, InDesign plug-in code queries for several interfaces. If they are not stored in an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>, the code must make sure each code path results in appropriate calls to Release().<h3><a class="anchor" id="id_interfaceptr_tips_and_tricks"></a> InterfacePtr tips and tricks</h3><p>Sometimes, you might want to set an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> after it is constructed. This is common if the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> can be initialized to different objects. In this case, you can use the reset() method:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IBar&gt;</a> bar; </div><div class="line"><span class="keywordflow">if</span>( someCondition )</div><div class="line"> bar-&gt;<a class="code" href="class_interface_ptr.html#ab73edd4918e8b3a105ec3aadedae5220">reset</a>(document-&gt;QueryInterface(IID_IBAR); </div><div class="line"><span class="keywordflow">else</span></div><div class="line"> bar-&gt;<a class="code" href="class_interface_ptr.html#ab73edd4918e8b3a105ec3aadedae5220">reset</a>(obj-&gt;QueryInterface(IID_IBAR);</div></div><p>The reset() method also calls Release(), if its data points to a non-nil object. There may be circumstances where you need to remove the data from an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> without calling Release(). For this case, <a class="el" href="class_interface_ptr.html">InterfacePtr</a> also supplies a forget() method. The forget() method sets the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> data to nil and returns the original data to the caller; therefore, it can be used to transfer ownership from an <a class="el" href="class_interface_ptr.html">InterfacePtr</a> to a caller. The following code is perfectly safe:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IBar&gt;</a> bar(obj-&gt;QueryInterface(IID_IBAR));</div><div class="line">IBar * bar2 = bar-&gt;<a class="code" href="class_interface_ptr.html#a4147735684d9c9512d0d1fc8c61feb96">forget</a>();</div><div class="line">bar-&gt;<a class="code" href="class_interface_ptr.html#ab73edd4918e8b3a105ec3aadedae5220">reset</a>( bar2 );</div><div class="line">bar2 = nil;</div></div><h2><a class="anchor" id="id_writing_your_own_interface_"></a> Writing your own interface</h2><p>When writing InDesign plug-ins, you often will need to add interface/implementation pairs to a boss. There are many examples of interfaces in the SDK; see the files in &lt;SDK&gt;/source/public/interfaces. Often, you can reuse an existing interface. For example, if you need to add integer data to a boss, you can reuse the SDK&#39;s <a class="el" href="class_i_int_data.html">IIntData</a> interface. Sometimes, however, you will need to write a new interface.<p>Before writing an implementation, you must add an interface ID (PMIID) to your plug-in&#39;s ID.h file. For example, the following adds an interface ID (IID_IMYINTDATA) for IMyIntData:<div class="fragment"><div class="line">DECLARE_PMID(kInterfaceIDSpace, IID_IMYINTDATA, kLearnIDDevPrefix + 2)</div></div><p>Once you have an interface ID, you are ready to code your interface. Most interfaces will look something like the following:<div class="fragment"><div class="line"><span class="preprocessor">#ifndef __IMYDATA</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#define __IMYDATA</span></div><div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;IPMUnknown.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;LearnIDDevID.h&quot;</span></div><div class="line"><span class="keyword">class </span>IMyIntData : <span class="keyword">public</span> <a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a></div><div class="line">{</div><div class="line"><span class="keyword">enum</span> { kDefaultIID = IID_IMYINTDATA };</div><div class="line"><span class="keyword">virtual</span> in32 GetIntData() <span class="keyword">const</span> = 0;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> SetIntData(int32 i) = 0;</div><div class="line">};</div><div class="line"><span class="preprocessor">#endif</span></div></div><p>In the preceding example, note the following:<ul><li>By convention, this class definition should be stored in a file called IMyIntData.h.<li>All code in the file is wrapped in an ifndef block, so it can be included many times within the same compilation.<li>To be part of a boss, the new class must inherit from <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> directly or through a subclass of IPMUknown. Thus, we include IPMUknown.h.<li>Each interface is identified in the object model by ID. In this case, a new interface ID (IID_IMYINTDATA) is created in LearnIDDevID.h.<li>By convention, the interface contains a kDefaultIID enumeration identifying the new interface ID. This is used by UseDefaultIID() in an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>.<li>The new class includes some pure virtual functions that will be implemented to perform some operation; in this case, get and set some integer data.</ul><p>Each interface you write will be similar, but you will provide your own name, ID, and set of pure virtual functions.<h2><a class="anchor" id="id_writing_your_own_implementation"></a> Writing your own implementation</h2><p>Interfaces and implementations go together. Conceptually, the interface comes first, but it is not unusual to develop an interface and its implementation together. It also is not unusual to develop an implementation for an existing, Adobe-supplied interface.<p>For example, to add a new implementation of the previously defined IMyIntData, called MyIntData, you must add a new implementation ID to your plug-in&#39;s ID.h file. The following adds an implementation ID (kMyIntDataImpl) for the MyIntData class:<div class="fragment"><div class="line">DECLARE_PMID(kImplementationIDSpace, kMyIntDataImpl, kLearnIDDevPrefix + 6)</div></div><p>Dead-stripping is a compiler optimization that removes code that is not used in a binary. Because of how InDesign code is referenced, the compiler can be fooled into optimizing it away. To prevent dead stripping, your plug-in should have a file that references the new C++ class, so it is not dead-stripped. This prevents the compilers from optimizing your code away because it appears not to be referenced. If you generated your plug-in project and source code with DollyXs, you will have a file that ends in &quot;FactoryList.h&quot;. Adding the following line prevents dead-stripping of the MyIntData class:<div class="fragment"><div class="line">REGISTER_PMINTERFACE(MyIntData, kMyIntDataImpl)</div></div><p>The following implementation of IMyIntData illustrates the normal steps for implementing an interface:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;VCPlugInHeaders.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;IMyIntData.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;LearnIDDevID.h&quot;</span></div><div class="line"><span class="keyword">class </span>MyIntData : <span class="keyword">public</span> <a class="code" href="class_c_p_m_unknown.html">CPMUnknown</a>&lt;IMyIntData&gt;</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line"> MyIntData(<a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>* boss) : <a class="code" href="class_c_p_m_unknown.html">CPMUnknown</a>&lt;IMyIntData&gt;(boss), fMyInt(0) {};</div><div class="line"><span class="keyword">virtual</span> int32 GetIntData() <span class="keyword">const</span>;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> SetIntData(int32 i);</div><div class="line"><span class="keyword">private</span>:</div><div class="line"> int32 fMyInt;</div><div class="line">};</div><div class="line"></div><div class="line">CREATE_PMINTERFACE(MyIntData, kMyIntDataImpl)</div><div class="line"></div><div class="line">int32 MyIntData::GetIntData()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line"><span class="keywordflow">return</span> fMyInt;</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> MyIntData::SetIntData(int32 i)</div><div class="line">{</div><div class="line"> fMyInt = i;</div><div class="line">}</div></div><p>In the preceding example, note the following:<ul><li>Implementation files that are built into a plug-in always include <a class="el" href="_v_c_plugin_headers_8h_source.html">VCPlugInHeaders.h</a>.<li>IMyIntData.h is included, because this class implements the IMyIntData interface.<li>Rather than inheriting directly from IMyIntData, MyIntData inherits from the templated class <a class="el" href="class_c_p_m_unknown.html">CPMUnknown</a>. This is a convenient way to implement the <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> methods AddRef(), Release(), and QueryInterface(). It also adds a helper method, PreDirty(), which is used only for persistent interfaces. You may run into implementations that instead inherit directly from an interface and then add a macro called HELPER_METHODS_INIT below their method declarations; this is an older way of achieving the same results. The <a class="el" href="class_c_p_m_unknown.html">CPMUnknown</a> mechanism is preferred, for its simplicity.<li>The constructor initializes the base class, <a class="el" href="class_c_p_m_unknown.html">CPMUnknown</a> &lt;IMyIntData&gt;. This is required to initialize data in <a class="el" href="class_c_p_m_unknown.html">CPMUnknown</a>.<li>The CREATE_PMINTERFACE macro binds the implementation to the ID and makes this implementation usable in the InDesign object model.<li>The code contains an int32 instance variable called fMyIntData. This variable follows a naming convention that you see in most InDesign source files. Instance variables always begin with the letter &quot;f.&quot;<li>The class contains implementations of the two virtual methods.</ul><p>Each implementation you write will be somewhat similar. The name, ID, and virtual methods will vary, but the use of <a class="el" href="class_c_p_m_unknown.html">CPMUnknown</a> and CREATE_PMINTERFACE will be the same.<h2><a class="anchor" id="id_constructing_a_boss_instance"></a> Constructing a boss instance</h2><p>There are several global functions for constructing (or instantiating) boss objects in the SDK header file <a class="el" href="_create_object_8h_source.html">CreateObject.h</a>. There are different functions for creating persistent and nonpersistent boss instances. To create a nonpersistent instance of a boss, you can call CreateObject as follows:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IMyIntData&gt;</a> myIntData((IMyIntData*)::CreateObject(kMyIntBoss,IID_IMYINTDATA));</div></div><p>In this example, CreateObject returns an <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> *, which must be cast to the type of the <a class="el" href="class_interface_ptr.html">InterfacePtr</a> data. There is a slightly better way to do this, if the interface supports the kDefaultIID enumeration. You can avoid both the casting and specification of a PM_IID by using the CreateObject2 template function:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IMyIntData&gt;</a> myIntData(::CreateObject2&lt;IMyIntData&gt;(kMyIntBoss));</div></div><p>Regardless of how you create a boss, on success a pointer to the requested interface is returned, and the reference count is one. A nil pointer is returned if the designated boss cannot be created. This may seem unlikely, but it is possible for several reasons, most notably a missing plug-in.<h2><a class="anchor" id="id_persistence"></a> Persistence</h2><p>A persistent boss object can be removed from main memory and later reconstructed, unchanged. InDesign stores such objects in database files. An InDesign document really is just a database of persistent boss objects. Each persistent boss instance can be identified by an integer key called a UID (unique identifier).<p>The application maintains several different databases for various purposes. The application defaults, clipboard, and user-interface settings are saved in different databases. Also, as mentioned previously, each InDesign document is a database file.<h2><a class="anchor" id="id_making_a_boss_persistent"></a> Making a boss persistent</h2><p>To make a boss persistent, add the IID_IPMPERSIST, kPMPersistImpl interface pair: <div class="fragment"><div class="line">Class{</div><div class="line"> kMyFirstPersistentBoss,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IPMPERSIST, kPMPersistImpl,</div><div class="line"> IID_IMYINTDATA, kMyIntDataImpl,</div><div class="line"> }</div><div class="line">}</div></div><p>This alone does not cause the boss to be written to the database. To do that, the boss must have at least one persistent implementation.<h2><a class="anchor" id="id_writing_your_own_persistent_implementation"></a> Writing your own persistent implementation</h2><p>Persistent and nonpersistent implementations are very similar. The following implementation, MyPersistIntData, also implements IMyIntData:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;VCPlugInHeaders.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;IMyIntData.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;IPMStream.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;LearnIDDevID.h&quot;</span></div><div class="line"><span class="keyword">class </span>MyPersistIntData : <span class="keyword">public</span> <a class="code" href="class_c_p_m_unknown.html">CPMUnknown</a>&lt;IMyIntData&gt;</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line"> MyIntData(<a class="code" href="class_i_p_m_unknown.html">IPMUnknown</a>* boss) : <a class="code" href="class_c_p_m_unknown.html">CPMUnknown</a>&lt;IMyIntData&gt;(boss), fMyInt(0) {};</div><div class="line"><span class="keywordtype">void</span> ReadWrite(<a class="code" href="class_i_p_m_stream.html">IPMStream</a>* s, <a class="code" href="class_i_d_type.html">ImplementationID</a> prop);</div><div class="line"><span class="keyword">virtual</span> int32 GetIntData() <span class="keyword">const</span>;</div><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> SetIntData(int32 i);</div><div class="line"><span class="keyword">private</span>:</div><div class="line"> int32 fMyInt;};CREATE_PERSIST_PMINTERFACE(MyPersistIntData, kMyPersistIntDataImpl)</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> MyPersistIntData::ReadWrite(<a class="code" href="class_i_p_m_stream.html">IPMStream</a>* s, <a class="code" href="class_i_d_type.html">ImplementationID</a> prop)</div><div class="line">{</div><div class="line"> s-&gt;<a class="code" href="class_i_p_m_stream.html#add11be8a793b60535ccc132378375244">XferInt32</a>(fMyInt);</div><div class="line">}</div><div class="line"></div><div class="line">int32 MyPersistIntData::GetIntData()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line"><span class="keywordflow">return</span> fMyInt;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> MyPersistIntData::SetIntData(int32 i)</div><div class="line">{</div><div class="line"><span class="keywordflow">if</span>( fMyInt != i )</div><div class="line"> {</div><div class="line"> PreDirty();</div><div class="line"> fMyInt = i;</div><div class="line"> }</div><div class="line">}</div></div><p>MyPersistIntData differs from its nonpersistent counterpart, MyIntData, in the following ways:<ul><li>MyPersistIntData includes <a class="el" href="_i_p_m_stream_8h_source.html">IPMStream.h</a>, which is used to read and write a stream of data.<li>MyPersistIntData uses the CREATE_PERSIST_PMINTERFACE macro in place of CREATE_PMINTERFACE.<li>MyPersistIntData::SetIntData() checks to see whether the passed-in value is different from fMyIntData. If the values differ, it calls PreDirty() before changing fMyInt. In short, the object model must know before you change a persistent object. This allows the undo architecture to take snapshots, so changes can be rolled back if needed.<li>MyPersistIntData contains a ReadWrite method. This method is responsible for reading and writing the object&#39;s persistent data using the passed-in <a class="el" href="class_i_p_m_stream.html">IPMStream</a>.</ul><h2><a class="anchor" id="id_examples_of_persistent_implementations"></a> Examples of Persistent Implementations</h2><p>There are many examples of persistent implementations in the SDK sample projects. For a fairly straightforward example, consider the Frame Label project. See the FrmLblData.cpp file in the Frame Label sample at: &lt;SDK&gt;/source/sdksamples/framelabel/FrmLblData.cpp<p>The Frame Label plug-in adds this implementation to the application and document workspaces and to each page item. The sample does this by adding the IID_IFRMLBLDATA/kFrmLbldataImpl interface/implementation pair to the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, <a class="el" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a> in its ClassDescriptionTable as follows:<div class="fragment"><div class="line">AddIn {</div><div class="line"><a class="code" href="classk_workspace_boss.html">kWorkspaceBoss</a>, </div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IFRMLBLDATA, kFrmLblDataImpl,</div><div class="line"> }</div><div class="line">},</div><div class="line"></div><div class="line">AddIn {</div><div class="line"><a class="code" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, </div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IFRMLBLDATA, kFrmLblDataImpl,</div><div class="line"> }</div><div class="line">},</div><div class="line"></div><div class="line">AddIn {</div><div class="line"><a class="code" href="classk_drawable_page_item_boss.html">kDrawablePageItemBoss</a>, </div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IFRMLBLDATA, kFrmLblDataImpl,</div><div class="line"> }</div><div class="line">}</div></div><p>These bosses already are persistent, so there is no need to add an <a class="el" href="class_i_p_m_persist.html">IPMPersist</a> implementation. There also is no need to create an instance, because the application already manages these bosses.<p>This and other persistent implementations always are very similar to the example listed in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_writing_your_own_persistent_implementation">Writing your own persistent implementation</a>. Most examples differ from the preceding only in inconsequential ways. For example, a mutator (SetXXX) method may not check to see that a data member has really changed before calling PreDirty(); this check is an optimization.<p>What differs across examples is the data that the implementation manages. Each ReadWrite method is crafted to match the data to be retained. It is a good idea to look at a handful of examples. You can find these examples by searching for ReadWrite() in the sample files. Notice that a ReadWrite() method commonly calls methods on <a class="el" href="class_i_p_m_stream.html">IPMStream</a> to stream simple data types. More complex data types have their own ReadWrite() methods. For example, the first item handled in <a class="el" href="class_frm_lbl_data.html#a5ad77eb937da0aab8e71e4ca6d60f635">FrmLblData::ReadWrite()</a> is a <a class="el" href="class_wide_string.html">WideString</a>. The FrmLbldata::ReadWrite method calls ReadWrite on the <a class="el" href="class_wide_string.html">WideString</a> instance, passing along the current stream and implementation information.<h2><a class="anchor" id="id_changing_persistent_data_with_commands"></a> Changing persistent data with commands</h2><p>Changing a persistent data member requires more than simply calling the member&#39;s mutator (SetXXX) method. The InDesign object model performs changes in transactions. This allows InDesign to manage the integrity of a document and supports InDesign&#39;s undo capability. Data changes also require notification, so dependent user interfaces can be updated.<p>These requirements are facilitated by InDesign&#39;s use of the <a class="el" href="class_command.html">Command</a> design pattern. To change existing persistent data members in InDesign, you must process the appropriate command. Processing amounts to calling or executing; often, it may be referred to as firing.<p>If you have written your own persistent implementations, you must write your own new command. Then this command must be used to change your persistent data.<p>A command is simply a boss that consists of an <a class="el" href="class_i_command.html">ICommand</a> implementation. It almost always contains one or more data members that are used to specify data for the operation. For example, consider the command used to alter the Frame Label&#39;s various <a class="el" href="class_i_frm_lbl_data.html">IFrmLblData</a> implementations:<div class="fragment"><div class="line">Class {</div><div class="line"><a class="code" href="classk_frm_lbl_cmd_boss.html">kFrmLblCmdBoss</a>, </div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_ICOMMAND, kFrmLblCmdImpl,</div><div class="line"> IID_IFRMLBLDATA, kFrmLblDataImpl</div><div class="line"> }</div><div class="line">}</div></div><p>To process a command, the caller first creates an instance of the command:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ICommand&gt;</a> labelCommand(<a class="code" href="class_cmd_utils.html#ae400a6b61bf65b6233c7fcd6b592de04">CmdUtils::CreateCommand</a>(<a class="code" href="classk_frm_lbl_cmd_boss.html">kFrmLblCmdBoss</a>));</div></div><p>The caller must then specify which boss instances are being operated on. This is done through the <a class="el" href="class_i_command.html#a6f9f6afa9a67a910288ae792b8bcfe41">ICommand::SetItemList()</a> method:<div class="fragment"><div class="line">labelCommand-&gt;SetItemList(items);</div></div><p>Typically, the next step is to query the command for any data instances and set them appropriately:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFrmLblData&gt;</a> labelData(labelCommand, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">labelData-&gt;Set(frmLblInfo);</div></div><dl class="section note"><dt>Note<dd>Code that queries for another interface on a boss commonly includes checks to make sure the data interface is not nil. This is left out for brevity.</dl><p>The final step is to process the command and check for errors:<div class="fragment"><div class="line">error = <a class="code" href="class_cmd_utils.html#a01f89f41af8329047f5cd3d8ff776920">CmdUtils::ProcessCommand</a>(labelCommand);</div><div class="line"><span class="comment">// Check for errors, issue warning if so:</span></div><div class="line"><span class="keywordflow">if</span> (error != kSuccess)</div><div class="line">{</div><div class="line"> ...</div><div class="line">}</div></div><h2><a class="anchor" id="id_writing_your_own_command"></a> Writing your own command</h2><p>If you introduce a new persistent implementation, you will need to add your own command boss. This will include a custom implementation of <a class="el" href="class_i_command.html">ICommand</a> and some type of data interface. This interface may very well be the exact interface that is being changed. You can see this in the <a class="el" href="classk_frm_lbl_cmd_boss.html">kFrmLblCmdBoss</a> example. The <a class="el" href="class_i_frm_lbl_data.html">IFrmLblData</a> interface that was added into the workspace and page-item bosses exists on the command. You also can write a custom data interface/implementation pair for your command or reuse existing interfaces/implementations like <a class="el" href="class_i_int_data.html">IIntData</a> and <a class="el" href="class_i_bool_data.html">IBoolData</a>. The last option works fine and is done in the InDesign code base, but it is not a best practice, because often this option makes it harder to understand what the data member represents.<p>Most <a class="el" href="class_i_command.html">ICommand</a> implementations extend the <a class="el" href="class_command.html">Command</a> class. This provides most of the plumbing for your command and leaves you with a few important methods to implement. These methods are described below, starting with the most significant.<h3><a class="anchor" id="id_do"></a> Do()</h3><p>A typical command has one more data interface. When writing a Do() method, a typical first step is to query for the command &#39;s data interfaces. This will look something like the following:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IMyCmdData&gt;</a> commandData(<span class="keyword">this</span>, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>Commands operate on one or more boss objects. Typically, these objects are specified as a <a class="el" href="class_u_i_d_list.html">UIDList</a> saved within the command. This <a class="el" href="class_u_i_d_list.html">UIDList</a> is initialized by the caller via SetItemList(). It is available as an instance variable or by calling <a class="el" href="class_i_command.html#af77616b39cea19b0de97c3fc4844fe04">ICommand::GetItemList()</a>. Some commands operate only on one item; more commonly, though, a command operates on a list of items. In that case, the command iterates through the items in the list. For each item, it queries the targeted boss for the interface or interfaces being changed and copies from the command data to these interfaces. Typically, that will look like this:<div class="fragment"><div class="line"><span class="keywordflow">for</span>(int32 i = 0; i &lt; fItemList.Length(); i++)</div><div class="line">{</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IMyData&gt;</a> myData(fItemList.GetRef(i),<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"> myData.copyFrom(commandData);</div><div class="line">}</div></div><p>The preceding copyFrom() method would have to exist on the IMyData interface. Some interfaces have such a method; alternately, the command data could have such a method. Other commands may copy items from their data method by method. In any event, this step amounts to copying data from the command to the targeted item.<p>You may see more advanced commands that do some type of filtering. This is to support what is known as mixed mode. Mixed mode allows you to operate on the common settings in a multiple selection, while leaving the settings that are not common unchanged. For example, consider the Frame Label sample. If you create several frames and apply frame-label settings, with some of the settings the same across frames and others unique for each frame, you can select all the frames and make change to those settings that are the same without altering those that are unique. This type of support ultimately should be provided by the underlying command. The Frame Label sample provides such an example in <a class="el" href="class_frm_lbl_cmd.html">FrmLblCmd</a>.<h3><a class="anchor" id="id_donotify"></a> DoNotify()</h3><p>There are dependencies on persistent data. For example, changing persistent data may make a panel out of date. Because there may be unknown dependencies on persistent data, InDesign does not hard-code updates; instead, it uses the Subject/Observer design pattern to support the ability to dynamically subscribe to notifications. A command&#39;s DoNotify method broadcasts on some subject (<a class="el" href="class_i_subject.html">ISubject</a>) that it has changed persistent data. Some commands are written to change one instance at a time. For example, a command that changes some data on the application workspace does not process a list of items. Such commands typically broadcast on the <a class="el" href="class_i_subject.html">ISubject</a> interface of the item they have changed. For example, this code broadcasts on the application workspace: <div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> theWorkSpace(GetExecutionContextSession()-&gt;QueryWorkspace());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISubject&gt;</a> subject(theWorkSpace, IID_ISUBJECT);</div><div class="line"><span class="keywordflow">if</span> (subject)</div><div class="line">{</div><div class="line"> subject-&gt;ModelChange(kSetMydataCmdBoss,IID_IMYDATA, <span class="keyword">this</span>);</div><div class="line">}</div></div><p>Because notification is dynamic, each plug-in has the opportunity to attach an <a class="el" href="class_i_observer.html">IObserver</a> instance to an <a class="el" href="class_i_subject.html">ISubject</a>. An observer is attached by calling <a class="el" href="class_i_subject.html#a4ef07306ece5c3f2f0f28b56b78ada57">ISubject::AttachObserver()</a>. In addition to taking a pointer to the <a class="el" href="class_i_observer.html">IObserver</a> instance, this method takes two PMIIDs. The first PMIID is a ClassID that describes the change. Usually, this is the ClassID for the command that performed the change. The second PMIID is an interface ID that narrow the scope. An attached observer is called when a notification with matching parameters occurs.<p>Most commands are writen to operate on a list of items. An example of this is any command that operates on a list of page items. Such commands are necessary to support making changes on a multiple selection (that is, multiple page items selected). It is not efficient to broadcast on each individual object that is changed. Such commands broadcast on the document. For example, consider the <a class="el" href="class_frm_lbl_cmd.html#a58edb1b834255d47bca8d612004e8f7f">FrmLblCmd::DoNotify()</a>: <div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;IPageItemUtils&gt;</a>()-&gt;NotifyDocumentObservers(fItemList.GetDataBase(),</div><div class="line"> kLocationChangedMessage,</div><div class="line"> IID_ITRANSFORM_DOCUMENT, </div><div class="line"><span class="keyword">this</span>,</div><div class="line"> nil <span class="comment">// nil cookie);</span></div></div><p>This command uses a utility that broadcasts on the <a class="el" href="classk_doc_boss.html">kDocBoss</a>. This works because the broadcast passes enough information for the observers to follow. In this case, the command itself (passed as a pointer) gives access to the item list of what has changed.<p>It is not always desirable for observers to be updated immediately; for example, the many panels that watch selection attributes would be updated more than necessary during normal operations. To get around this, InDesign supports two notification types: regular and lazy notification. Regular notification happens right away. Lazy notifications are queued for later use. This is thoroughly described in the <a class="el" href="id_solutions.html#id_notification">Notification</a> chapter of Adobe InDesign Plug-In Programming Guide. There are a handful of SDK sample plug-ins that use lazy notification. Observers often are in user-interface code. For an example of a regular observer, see &lt;SDK&gt;/source/sdksamples/watermarkui/WatermarkUIDialogObserver.cpp. For an example of a lazy observer see &lt;SDK&gt;/source/sdksamples/customdatalink/CusDtLnkDocObserver.cpp.<h3><a class="anchor" id="id_createname"></a> CreateName()</h3><p>Each command is given a name. This may appear on the undo stack, depending on how your command is called. For example, the <a class="el" href="class_frm_lbl_cmd.html">FrmLblCmd</a> specifies its name as follows:<div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a>* <a class="code" href="class_frm_lbl_cmd.html#a186a243d5fe6271b31d333727d59474b">FrmLblCmd::CreateName</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="comment">// Core resource for string:</span></div><div class="line"><a class="code" href="class_p_m_string.html">PMString</a>* <span class="keywordtype">string</span> = <span class="keyword">new</span> <a class="code" href="class_p_m_string.html">PMString</a>(kFrmLblCmdStringKey);</div><div class="line"><span class="keywordflow">return</span> string;</div><div class="line">}</div></div><p>The kFrmLblCmdStringKey is simply a macro for a constant string that is defined in <a class="el" href="_frm_lbl_i_d_8h_source.html">FrmLblID.h</a> Because the command name may appear in the user interface, it must be localized. For information on how to localize strings, see the &quot;Localization&quot; chapter.<h3><a class="anchor" id="id_lowmemisok"></a> LowMemIsOK()</h3><p>This method tells the application whether your command can operate in low-memory situations. Most commands override the default implementation and return kFalse. This means the application checks for low memory before it runs your command. If it finds itself in a low-memory situation, it purges some of the undo stack. If your command returns kTrue, this check and possible purging is skipped. Returning kTrue is rare.<h2><a class="anchor" id="id_facades"></a> Facades</h2><p>Processing commands is somewhat tedious. Because a command is the norm for changing persistent data, the InDesign code base is somewhat of an API of commands. Adobe and plug-in developers often have duplicated the effort of creating, initializing, and processing commands. For example, a plug-in usually must call the same command to implement a user interface and scripting.<p>To get around this, some InDesign engineers recognized that it was advantageous to create utility methods to create, initialize, and execute commands. There were various attempts at this. Some attempts simply automated the creation and initialization of the command. Others went as far as to actually process the command. After some time, we standardized on an approach called facades. A facade essentially is a procedural wrapper on a command or set of commands. It may provide methods for retrieving data, but its primary purpose is to provide an API for processing underlying commands. This makes changing persistent data a matter of locating the facade and calling the appropriate method with the appropriate data.<p>Writing facades is a best practice that has developed over time. We wrote facades for some legacy areas but have not reworked all legacy features. All recent features are written with facades. You should strongly consider facades when coding your plug-ins.<p>The facades that are built into the product follow specific guidelines:<ul><li><a class="el" href="namespace_facade.html">Facade</a> interfaces are named IXXXFacade, where XXX is a unique name of the subsystem being covered; for example, ITransformFacade.<li>Facades are declared to be part of the <a class="el" href="namespace_facade.html">Facade</a> namespace.<li>Facades provide a kDefaultIID enumeration.<li>Facades must not consider global or static state. You should pass to them everything they need.<li>The first parameter to a facade method is the object or objects that are being acted on. Usually, this is passed by a <a class="el" href="class_u_i_d_list.html">UIDList</a>.<li><a class="el" href="namespace_facade.html">Facade</a> methods that set data must return ErrorCode.<li>Facades are added into the <a class="el" href="classk_utils_boss.html">kUtilsBoss</a></ul><p>To execute a facade method, you typically write code like the following.<div class="fragment"><div class="line"><a class="code" href="class_utils.html">Utils&lt;Facade::IMyFacade&gt;</a>()-&gt;SetMyData(items, someData);</div></div><p>The <a class="el" href="class_utils.html">Utils</a> &lt;&gt; template class is like <a class="el" href="class_interface_ptr.html">InterfacePtr</a>. It queries for the specified facade using its kDefaultIID enum. <a class="el" href="class_utils.html">Utils</a> contains an operator that allows you to call methods on a pointer data member that it manages. Like an <a class="el" href="class_interface_ptr.html">InterfacePtr</a>, <a class="el" href="class_utils.html">Utils</a> calls Release() on the pointer when the object is destructed.<p>To enhance your understanding of facades, study the following examples of facade interfaces:<ul><li>&lt;SDK&gt;/source/public/interfaces/text/IConditionalTextFacade.h<li>&lt;SDK&gt;/source/public/interfaces/layout/ITransformFacade.h<li>&lt;SDK&gt;/source/public/interfaces/layout/IGeometryFacade.h</ul><p>The SDK also provides examples of facade implementations in the sample projects. These facades can be studied for further understanding:<ul><li>&lt;SDK&gt;/source/sdksamples/watermark/IWatermarkDataFacade.h<li>&lt;SDK&gt;/source/sdksamples/framelabel/IFrmLblDataFacade.h</ul><h2><a class="anchor" id="id_pluginversion"></a> PluginVersion</h2><p>InDesign requires a plug-in to provide a PluginVersion resource that describes whether the plug-in supports model operations or user interfaces. Model plug-ins are available on InDesign Server and background threads. This declaration occurs in the PluginVersion resource. The following example is for a model plug-in: it uses the kModelPlugIn constant. If it were a user-interface plug-in, it would have used kUIPlugIn.<div class="fragment"><div class="line"><span class="comment">//---------------------------------------------------------------</span></div><div class="line"><span class="comment">// Plugin Version</span></div><div class="line"><span class="comment">//---------------------------------------------------------------</span></div><div class="line">resource PluginVersion (1) {</div><div class="line"> kTargetVersion,</div><div class="line"> kMyPluginID,</div><div class="line"> kMajorVersionNumber, kMinorVersionNumber,</div><div class="line"> kMajorVersionNumber, kMinorVersionNumber,</div><div class="line"> kMyMajorFormatNumber, kMyInitialMinorFormatNumber,</div><div class="line"> { kInDesignProduct, kInCopyProduct, kInDesignServerProduct },</div><div class="line"> { kAllProductsJapaneseFS, kInDesignServerRomanFS },</div><div class="line"> kModelPlugIn,</div><div class="line"> kMyVersionStr</div><div class="line">};</div></div><h2><a class="anchor" id="id_the_lifecycle_of_a_plug-in"></a> The lifecycle of a plug-in</h2><p>This section describes the stages that InDesign goes through while starting up. It also discusses what happens when a boss inside a plug-in is instantiated.<h3><a class="anchor" id="id_indesign_start-up_sequence"></a> InDesign start-up sequence</h3><p>The stages a user sees on the application &#39;s start-up screen depend primarily on whether plug-ins were added, removed, or modified since the last session. The following table shows the start-up stages and factors that affect each stage.<table class="doxtable"><tr><th>Stage </th><th>Description of activity </th></tr><tr><td>Initializing... </td><td>Nonapplication core services and components are initialized. </td></tr><tr><td>Scanning for plug-ins... </td><td>Compares the SavedData file to the plug-ins in the application&#39;s directories. If plug-ins were added or removed, or they have changed modification dates, a more complete start-up procedure must take place to reinitialize the application. </td></tr><tr><td>Registering &lt;n&gt; plug-ins </td><td>Registers every plug-in when it starts for the first time and again when you add, remove, or modify plug-ins. If no plug-ins changed between sessions, start-up skips this registration step, and the application is initialized from the saved state. </td></tr><tr><td>Completing object model... </td><td>Processes inheritance in the object model. Checks for invalid cases, like two plug-ins that claim to implement the same boss interface. Some plug-ins may load, if necessary to complete the object model. </td></tr><tr><td>Saving object model... </td><td>Creates a new, blank, SavedData file and writes newly revised data to it. </td></tr><tr><td>Load plug-ins... </td><td>Loads plug-ins that must be loaded at start-up. Most plug-ins are loaded only as needed. </td></tr><tr><td>Calling early initializers... </td><td>Calls Initializer Services for strings and selection extensions. </td></tr><tr><td>Starting up service registry... </td><td>Sets up the mechanism for services. </td></tr><tr><td>Executing start-up services... </td><td>Performs operations requested by plug-ins that registered as a kStartupShutdownService. </td></tr><tr><td>Lazy start-up service initialization... </td><td>Installs lazy start-up service registered as a kAppLazyStartupShutdownService. These services are called via an idle task after application start-up. </td></tr><tr><td>Loading tools... </td><td>Loads tools. </td></tr><tr><td>Completing initialization... </td><td>Initializes the Clipboard, DragandDrop, and Paths. Sets up, but does not run, IdleTask. </td></tr><tr><td>Calling late initializers... </td><td>Calls Initializer Services for menus, actions, kits, panels, tools, tips, and scripting resources (such as ScriptInfo). </td></tr><tr><td>Loading shortcuts... </td><td>Reads shortcuts file and loads shortcuts. </td></tr></table><h1><a class="anchor" id="id_localization"></a> Localization</h1><p>The InDesign plug-in architecture supports localization. This chapter covers the basic mechanisms for localizing strings and other resources used by your plug-in.<h2><a class="anchor" id="id_indesign_locales"></a> InDesign locales</h2><p>An InDesign locale is represented by the <a class="el" href="class_p_m_locale_id.html">PMLocaleId</a> class. You will find this class in the following location:<div class="fragment"><div class="line">&lt;SDK&gt;/source/<span class="keyword">public</span>/includes/<a class="code" href="class_p_m_locale_id.html">PMLocaleId</a>.h</div></div><p>This class represents the following three pieces of an InDesign locale:<ul><li>Product-feature set - InDesign, InCopy, and InDesign Server are built from the same code base. By design, it is possible to write a plug-in that will run under all three products. The product-feature set describes the product or products to which a locale is specific. It is possible to specify a single product or a combination of products.<li>Language-feature set - InDesign and InCopy contain some language-specific features; for example, the Japanese version includes some layout and frame-grid features specific to Japanese users. The language-feature set describes the language-feature set or sets to which a locale is specific. This setting does not have to do with the strings on the screen but rather the features that are present.<li>User-interface language (or language locale) - This describes the language in which the user interface will be displayed.</ul><p>The types of feature sets are represented together as a bit field, and the user-interface language is represented alone. You will find constants representing different feature sets and user-interface locales in the following files:<div class="fragment"><div class="line">&lt;SDK&gt;/source/<span class="keyword">public</span>/includes/FeatureSets.h</div><div class="line">&lt;SDK&gt;/source/<span class="keyword">public</span>/includes/PMLocaleIds.h</div></div><h2><a class="anchor" id="id_checking_the_locale_in_cpp"></a> Checking the locale in C++</h2><p>Your plug-ins may need to know which feature set or language locale they are running under. You can access an instance of <a class="el" href="class_p_m_locale_id.html">PMLocaleId</a> that describes the current locale by using the LocaleSettings header. The following demonstrates making a decision based on the three components of a <a class="el" href="class_p_m_locale_id.html">PMLocaleId</a>:<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;LocaleSetting.h&quot;</span>...</div><div class="line">if (LocaleSetting::GetLocale().GetProductFS() != kInCopyProductFS)</div><div class="line">{</div><div class="line"><span class="comment">// Something specific to InCopy</span></div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (LocaleSetting::GetLocale().GetLanguageFS() != kJapaneseLanguageFS){</div><div class="line"></div><div class="line"><span class="comment">// Something specific to the Japanese feature set</span></div><div class="line">}</div><div class="line"><span class="keywordflow">if</span>( LocaleSetting::GetLocale().GetUserInterfaceId() == k_enUS)</div><div class="line">{</div><div class="line"><span class="comment">// Something specific to the English UI</span></div><div class="line">}</div></div><p>For an example of this, see the following SDK sample file.<div class="fragment"><div class="line">&lt;SDK&gt;/source/sdksamples/printmemorystream/<a class="code" href="class_prt_mem_action_component.html">PrtMemActionComponent</a>.cpp</div></div><h2><a class="anchor" id="id_controlling_plug-in_loading"></a> Controlling plug-in loading</h2><p>InDesign gives you the ability to control the feature sets under which your plug-ins will load. This is done in ODFRC using the PluginVersion resource:<div class="fragment"><div class="line">resource PluginVersion (kSDKDefPluginVersionResourceID){</div><div class="line"> kTargetVersion, kFrmLblUIPluginID,</div><div class="line"> kSDKDefPlugInMajorVersionNumber, kSDKDefPlugInMinorVersionNumber,</div><div class="line"> kSDKDefHostMajorVersionNumber, kSDKDefHostMinorVersionNumber,</div><div class="line"> kFrmLblUICurrentMajorFormatNumber, kFrmLblUICurrentMinorFormatNumber,</div><div class="line"> { kInDesignProduct},</div><div class="line"> { kWildFS },</div><div class="line"> kUIPlugIn,</div><div class="line"> kFrmLblUIVersion</div><div class="line">};</div></div><p>In the preceding example, the third- and fourth-to-last lines represent the product- and language-feature sets under which this plug-in will load. In this case, it will load under any language feature set (kWildFS) of InDesign (kInDesignProduct). Because this resource is set to load only under InDesign, it will not load under InCopy, even if the plug-in is copied to the plug-ins directory for InCopy.<h2><a class="anchor" id="id_pmstring"></a> PMString</h2><p>InDesign provides the <a class="el" href="class_p_m_string.html">PMString</a> class for those strings that are designed to show up in the user interface. We already encountered one such string in this document: a command name may show up on the undo menu. Therefore, a translation should be provided.<p><a class="el" href="class_p_m_string.html">PMString</a> is not a general-purpose string class; <a class="el" href="class_wide_string.html">WideString</a> is far better for this purpose. What <a class="el" href="class_p_m_string.html">PMString</a> does well is manage translatable strings that will appear in the user interface. PMStrings interact with translation tables defined in ODFRC. Each string has a key value, which can be translated into many languages.<p>A <a class="el" href="class_p_m_string.html">PMString</a> instance eventually is translated; however, you can work with it before it is translated. You can determine whether it has been translated by calling HasTranslated(). You can force a string to be translated by calling Translate(). Translate() is called on all PMStrings before they are added to the user interface.<h2><a class="anchor" id="id_string-translation_tables"></a> String-translation tables</h2><p>Providing translations for PMStrings is a fairly straightforward process handled in ODFRC. If you use DollyXs to generate your plug-in, most of the plumbing is provided. Below, we explain the various resources that are used.<p>Each plug-in should provide two <a class="el" href="class_locale_index.html">LocaleIndex</a> resources that contain a kStringTableRsrcType. One <a class="el" href="class_locale_index.html">LocaleIndex</a> is used for translated strings; the other, for strings that will have no translations. These resources will look something like the following example from Frame Label:<div class="fragment"><div class="line">resource <a class="code" href="class_locale_index.html">LocaleIndex</a> ( </div><div class="line">kSDKDefStringsResourceID){</div><div class="line"> kStringTableRsrcType,</div><div class="line"> {</div><div class="line"> kWildFS, k_enUS, kSDKDefStringsResourceID + index_enUS</div><div class="line"> kInDesignJapaneseFS, k_jaJP, kSDKDefStringsResourceID + index_jaJP</div><div class="line"> kWildFS, k_Wild, kSDKDefStringsResourceID + index_enUS</div><div class="line"> }</div><div class="line">};</div><div class="line"></div><div class="line">resource <a class="code" href="class_locale_index.html">LocaleIndex</a> (kSDKDefStringsNoTransResourceID){</div><div class="line"> kStringTableRsrcType,</div><div class="line"> {</div><div class="line"> kWildFS, k_Wild, kSDKDefStringsNoTransResourceID + index_enUS</div><div class="line"> }</div><div class="line">};</div></div><p>Each <a class="el" href="class_locale_index.html">LocaleIndex</a> resource must have a resource ID that is unique to this plug-in. Because it has to be unique only within the plug-in, most samples reuse the same resource IDs for translated and nontranslated <a class="el" href="class_locale_index.html">LocaleIndex</a> resources (kSDKDefStringsResourceID and kSDKDefStringsNoTransResourceID, respectively).<p>Each <a class="el" href="class_locale_index.html">LocaleIndex</a> also contain a kStringTableRsrcType. This provides one or more references to a StringTable. Such a reference consists of the feature set (product and language) and language locale that the StringTable is for and the resource ID of the StringTable. The first <a class="el" href="class_locale_index.html">LocaleIndex</a> above provides translations for all versions of all applications. The first entry targets any feature set (kWildFS) and the English (k_enUS) language. The second entry targets the Japanese feature set and the Japanese (k_jaJP) language. The third entry specifies that any other feature set and language combination should use English strings.<p>Each StringTable resource provides the same set of translations. For example, here is a portion of the Frame Label sample&#39;s English StringTable:<div class="fragment"><div class="line">resource StringTable (kSDKDefStringsResourceID + index_enUS){</div><div class="line"> k_enUS,</div><div class="line"><span class="comment">// Locale Id</span></div><div class="line"> kEuropeanWinToMacEncodingConverter,</div><div class="line"><span class="comment">// Character encoding converter (irp)</span></div><div class="line"> {</div><div class="line"><span class="comment">// Menu strings</span></div><div class="line"> &Acirc;&nbsp;&Acirc;&nbsp;&Acirc;&nbsp;kFrmLblCompanyKey, FrmLblCompanyValue,</div><div class="line"> ...</div><div class="line"> }</div><div class="line">};</div></div><p>In this example, kFrmLblCompanyKey and kFrmLblCompanyValue are simply macros that represent strings. This could just as easily have been something like the following.<div class="fragment"><div class="line"><span class="stringliteral">&quot;CompanyName&quot;</span>, <span class="stringliteral">&quot;Adobe Systems&quot;</span>,</div></div><p>The first string is a key; the second, the English translation. The key is significant in that it must be unique (across all plug-ins). In this case, &quot;CompanyName&quot; is the key and &quot;Adobe Systems&quot; is the English translation.<p>The nontranslated <a class="el" href="class_locale_index.html">LocaleIndex</a> will contain one item that specifies a separate StringTable resource for all applications and user-interface languages. This additional StringTable holds a set of Strings that have no translations:<div class="fragment"><div class="line">resource StringTable (kSDKDefStringsNoTransResourceID + index_enUS){</div><div class="line"> k_enUS, <span class="comment">// Locale Id</span></div><div class="line"> kEuropeanMacToWinEncodingConverter, <span class="comment">// Character encoding converter</span></div><div class="line"> {</div><div class="line"><span class="comment">// No-Translate strings go here:</span></div><div class="line"> }</div><div class="line">};</div></div><p>The SDK samples usually provide only Japanese and English translations. To extend this, you must add more specific translation scenarios to the translated <a class="el" href="class_locale_index.html">LocaleIndex</a> and provide the new StringTable resources.<h2><a class="anchor" id="id_localizing_other_resources"></a> Localizing other resources</h2><p>Other resources are localized in a similar way. Like strings, an alternate user interface can be given using a <a class="el" href="class_locale_index.html">LocaleIndex</a>. The following example uses a different version of kMyDialogRsrcID for Japanese. This is how ODFRC-based user interfaces handle different user-interface layouts caused by string size.<div class="fragment"><div class="line">resource <a class="code" href="class_locale_index.html">LocaleIndex</a> (kMyDialogRsrcID){</div><div class="line"> kViewRsrcType,</div><div class="line"> {</div><div class="line"> kInDesignJapaneseFS, k_Wild, kMyDialogRsrcID + index_jaJP</div><div class="line"> kWildFS, k_Wild, kMyDialogRsrcID + index_enUS</div><div class="line"> }</div><div class="line">}</div></div><p>Menus, actions, and the other resource types work the same way. For an inventory of resource types, see source/public/includes/CoreResTypes.h.<p>Similarly, you can control which feature sets and locales a scripting resource is available on, using the VersionedScriptElementInfo resource. Here, the last two items in each entry contain feature-set and language-locale IDs. The following example makes a scripting resource that is available on InDesign and InDesign Server locales:<div class="fragment"><div class="line">resource VersionedScriptElementInfo(1){</div><div class="line"><span class="comment">//Contexts</span></div><div class="line"> {</div><div class="line"> kBasilScriptVersion, <a class="code" href="classk_core_script_manager_boss.html">kCoreScriptManagerBoss</a>, </div><div class="line"> kInDesignAllLanguagesFS, k_Wild,</div><div class="line"> kBasilScriptVersion, kCoreScriptManagerBoss,</div><div class="line"> kInDesignServerAllLanguagesFS, k_Wild,</div><div class="line"> } </div></div><h1><a class="anchor" id="id_building_blocks"></a> Building blocks</h1><p>InDesign plug-in development requires you to become familiar with a set of concepts and patterns that are used in many different scenarios. These concepts are the building blocks on which you will make things happen with your plug-in. This chapter introduces you to some common building blocks. This is not an exhaustive list, but this survey of building blocks will help familiarize you with how things are done in the InDesign architecture.<h2><a class="anchor" id="id_boss-object_web"></a> Boss-object web</h2><p>It is important to begin by understanding how to navigate the web of InDesign boss objects that exist in the application. This includes how to access documents and their content. In a running InDesign instance, each execution context (thread) has one session object represented by the <a class="el" href="classk_session_boss.html">kSessionBoss</a>. You can use a global function (GetExecutionContextSession) to gain access to the current session. The following demonstrates how to use the session to query for the <a class="el" href="class_i_workspace.html">IWorkspace</a> interface on the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>, and the <a class="el" href="class_i_application.html">IApplication</a> interface on <a class="el" href="classk_app_boss.html">kAppBoss</a>:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IWorkspace&gt;</a> sessionWorkspace(GetExecutionContextSession()-&gt;QueryWorkspace());</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IApplication&gt;</a> application(GetExecutionContextSession()-&gt;QueryApplication());</div></div><p>The <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a> contains interfaces that control the application&#39;s copy of preferences, defaults, styles, swatches, and so on. The <a class="el" href="class_i_application.html">IApplication</a> interface provides access to several interfaces that manage portions of the application, including IToolMgr, IActionMgr, and <a class="el" href="class_i_panel_mgr.html">IPanelMgr</a>. As their names suggest, these interfaces allow you to manage tools (like the Text or Direct Select tools), actions, and panels. The <a class="el" href="class_i_application.html">IApplication</a> interface also provides access to the list of documents the application has open. This comes in the form of an <a class="el" href="class_i_document_list.html">IDocumentList</a> interface on the session&#39;s instance of <a class="el" href="classk_document_list_boss.html">kDocumentListBoss</a>. The following demonstrates acquiring the document list:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDocumentList&gt;</a> docList(app-&gt;QueryDocumentList());</div></div><p>The <a class="el" href="class_i_document_list.html">IDocumentList</a> provides access to a <a class="el" href="classk_doc_boss.html">kDocBoss</a> instance for each document that is open:<div class="fragment"><div class="line"><span class="keywordflow">for</span> (int32 i = 0; i &lt; docList-&gt;GetDocCount(); i++)</div><div class="line">{</div><div class="line"><a class="code" href="class_i_document.html">IDocument</a>* theDoc = docList-&gt;GetNthDoc(i);</div><div class="line"> ...</div><div class="line">}</div></div><p>The preceding <a class="el" href="class_i_document.html">IDocument</a> interface is saved in a different database from the <a class="el" href="classk_app_boss.html">kAppBoss</a> and <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. Also, note that documents maintain defaults for many of the objects that appear in the <a class="el" href="classk_workspace_boss.html">kWorkspaceBoss</a>. Documents store these defaults in <a class="el" href="classk_doc_workspace_boss.html">kDocWorkspaceBoss</a>, which is available via the GetDocWorkSpace() method on <a class="el" href="class_i_document.html">IDocument</a>.<p>A <a class="el" href="classk_doc_boss.html">kDocBoss</a> has many interfaces; some of the more significant interfaces are <a class="el" href="class_i_story_list.html">IStoryList</a>, <a class="el" href="class_i_layer_list.html">ILayerList</a>, <a class="el" href="class_i_master_spread_list.html">IMasterSpreadList</a>, and <a class="el" href="class_i_spread_list.html">ISpreadList</a>. As their names indicate, these interfaces manage the stories, layers, master spreads, and spreads within an InDesign document.<dl class="section note"><dt>Note<dd></dl><p>Pages have second-class status in the InDesign model. They are merely geometrical in that they designate where the page is. They really do not hold any content. All content belongs to the spread.<p>The <a class="el" href="class_i_spread_list.html">ISpreadList</a> give you access to an <a class="el" href="class_i_spread.html">ISpread</a> interface on an instance of <a class="el" href="classk_spread_boss.html">kSpreadBoss</a> for each spread in the document. The page items are not children of the spread; instead, between the page items and the spread is an object called a spread layer (<a class="el" href="classk_spread_layer_boss.html">kSpreadLayerBoss</a>). There are spread layers for each layer in the document and two extra layers for pages and guides. The fact that page items live on spread layers is a significant detail in the implementation of layers. For our purposes, it is a fact we need to understand when navigating the document. A navigation from spread to page item demonstrates how the hierarchy works:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;ISpreadLayer&gt;</a> spreadLayer(spread-&gt;QueryLayer(docLayer));</div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> spreadLayerHier(spreadLayer, <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line"><span class="keywordflow">for</span> (int32 i = (spreadLayerHier-&gt;GetChildCount() - 1); i &gt;= 0; i--)</div><div class="line">{</div><div class="line"><span class="comment">// Get the nth page item</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IHierarchy&gt;</a> childHier(spreadLayerHier-&gt;QueryChild(i));</div><div class="line"> ...</div><div class="line">}</div></div><p>Each <a class="el" href="class_i_hierarchy.html">IHierarchy</a> instance can provide access to zero to many children, and also can provide access back to its parent. Every object in the hierarchy has a parent except the root, which usually is the <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>.<h2><a class="anchor" id="id_iterating_the_draw_order"></a> Iterating the draw order</h2><p>You may need to write code that navigates through all or a subset of the page items in a document. Trying to write that code by hand using <a class="el" href="class_i_hierarchy.html">IHierarchy</a> can be tedious and error prone. InDesign provides a way to iterate through page items in the order in which they draw. Instead of handling the navigation, our code provides a callback. Your callback is given the opportunity to decide what to do with the particular object.<p>To iterate the draw order, write an implementation of the <a class="el" href="class_i_callback.html">ICallback</a> interface. This interface is available at &lt;SDK&gt;/source/public/interfaces/layout/ICallback.h. Notice that it is not an <a class="el" href="class_i_p_m_unknown.html">IPMUnknown</a> but a standard C++ interface.<p>To begin iteration, you need to create an instance of the <a class="el" href="classk_draw_mgr_boss.html">kDrawMgrBoss</a> and your callback. The following code has &quot;...&quot; in the MyCallBack constructor, because you will provide some context and/or data structures for the callback to work on. You also choose which point in the hiearchy to begin with. This code starts with a spread object. You also can set draw flags according to your preferences; these draw flags exist on the <a class="el" href="class_i_shape.html">IShape</a> interface.<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IDrawMgr&gt;</a> drawMgr ((<a class="code" href="class_i_draw_mgr.html">IDrawMgr</a> *)::CreateObject (<a class="code" href="classk_draw_mgr_boss.html">kDrawMgrBoss</a>,IID_IDRAWMGR));</div><div class="line">MyCallBack callback (...);</div><div class="line"><span class="keyword">const</span> int32 drwMgrFlags = <a class="code" href="class_i_shape.html#a6a11299dcbeb8aba75b41a24121663f9a09833698233b932fb8de00cb71f2ee24">IShape::kSkipHiddenLayers</a>+<a class="code" href="class_i_shape.html#a6a11299dcbeb8aba75b41a24121663f9a537a34220e3f0432aadd086a70e3d38d">IShape::kSkipGuideLayers</a>;</div><div class="line">drawMgr-&gt;IterateDrawOrder( &amp;matrix, ::GetUIDRef(spread), &amp;callback, drwMgrFlags);</div></div><p>For an example of iterating the draw order, see &lt;SDK&gt;/source/sdksamples/printselection/PrnSelSuiteCSB.cpp.<h2><a class="anchor" id="id_service_providers"></a> Service providers</h2><p>Service providers are basic building block that are very straightforward and that are used as a component of many extension points. A service provider is a mechanism by which a plug-in can publish its ability to provide a particular type of service (or function). Such a plug-in can introduce new types of services or implement a service of an existing type.<h3><a class="anchor" id="id_service-provider_boss"></a> Service-provider boss</h3><p>A service provider is simply a boss that provides an implementation of the <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface:<div class="fragment"><div class="line">Class {</div><div class="line"> kMyServiceProviderBoss,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IK2SERVICEPROVIDER, kMyServiceProviderImpl,</div><div class="line"> IID_IMYSERVICE, kMyServiceImpl,</div><div class="line"> }</div><div class="line">}</div></div><p>The <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface includes methods that describe details common to all services. Most notably, the service reports its name and which ServiceID (or IDs) it supports. A ServiceID has the same form as all other application ID-space values, like ClassID and IID values. It is not unique to the service but instead identifies the type of service that is provided. All services providers of a particular type return the same ServiceID.<p>A service provider contains one or more additional interface/implementation pairs; for example, &quot;IID_IMYSERVICE, kMyServiceImpl&quot; in the preceding boss. Such additional interfaces provide what is unique to the service. Each type of service has its own requirements concerning additional interfaces.<h3><a class="anchor" id="id_service_registry"></a> Service registry</h3><p>The application provides an implementation of <a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a> that manages all available service providers. This interface is available on the session and can be queried for as follows:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IK2ServiceRegistry&gt;</a> serviceRegistry(GetExecutionContextSession(),<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>During application start-up, the service registry finds all service providers, by iterating through the object model and registering every boss that has an <a class="el" href="class_i_k2_service_provider.html">IK2ServiceProvider</a> interface. A plug-in can query for services using the session &#39;s <a class="el" href="class_i_k2_service_registry.html">IK2ServiceRegistry</a> interface. There are methods for iterating through all the services of a particular type (ServiceID) and methods that allow you to query for the default service or a service with a particular ClassID.<h2><a class="anchor" id="id_startup_and_shutdown_services"></a> Startup and shutdown services</h2><p>Your plug-in may need to handle some tasks on application startup and shutdown. This can be achieved by implementing an application startup/shutdown service. InDesign provides two startup and shutdown service types; their ServiceIDs are kAppStartupShutdownService and kAppLazyStartupShutdownService, respectively. All service providers that support the kAppStartupShutdownService services are called during startup. Those that support kAppLazyStartupShutdownService are called on an idle task after startup is complete. Each startup/shutdown service also needs to provide an implementation of <a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a> (IID_IAPPSTARTUPSHUTDOWN).<p>The application includes reusable implementations that describe the two types of shutdown services. The implementation IDs for these implementations are kCStartupShutdownProviderImpl and kLazyStartupShutdownProviderImpl. The following demonstrates examples of the two types of startup/shutdown services:<div class="fragment"><div class="line">Class {</div><div class="line"> kMyStartupShutdownBoss, </div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IAPPSTARTUPSHUTDOWN, kMyStartupShutdownImpl,</div><div class="line"> IID_IK2SERVICEPROVIDER, kCStartupShutdownProviderImpl,</div><div class="line"> }</div><div class="line">}</div><div class="line">...</div><div class="line">Class {</div><div class="line"> kMyLazyStartupShutdownBoss, </div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IAPPSTARTUPSHUTDOWN, kMyLazyStartupShutdownImpl,</div><div class="line"> IID_IK2SERVICEPROVIDER, kLazyStartupShutdownProviderImpl,</div><div class="line">}</div></div><p>The <a class="el" href="class_i_startup_shutdown_service.html">IStartupShutdownService</a> interface contains simple Startup() and Shutdown() methods.<h2><a class="anchor" id="id_responders"></a> Responders</h2><p>In addition to command notification, some changes are broadcast through the signal/responder protocol. The signal/responder protocol is used for broadcasting certain types of model changes. Signals provide coarser information than command notifications. Signals signal the responder that a change of a certain class has occurred. There are signals for various document events, such as new, open, and close; these are designated by unique ServiceIDs. There are numerous reusable implementations that return the existing ServiceIDs. For example, the Watermark sample implements a responder. Because it uses the kAfterNewDocSignalRespServiceImpl, it receives signals after a new document is created:<div class="fragment"><div class="line">Class{</div><div class="line"><a class="code" href="classk_watermark_new_doc_responder_boss.html">kWatermarkNewDocResponderBoss</a>,</div><div class="line"> kInvalidClass,</div><div class="line"> {</div><div class="line"> IID_IRESPONDER, kWatermarkDefaultResponderImpl,</div><div class="line"> IID_IK2SERVICEPROVIDER, kAfterNewDocSignalRespServiceImpl,</div><div class="line"> }</div><div class="line">}</div></div><p>The <a class="el" href="id_solutions.html#id_notification">Notification</a> chapters of Adobe InDesign Plug-In Programming Guide and Adobe InDesign SDK Solutions contain more information on implementing responders and the various types of signals that are available.<h2><a class="anchor" id="id_draw_event_handlers"></a> Draw event handlers</h2><p>A Draw event handler allows a plug-in to draw within a document at various points (or events). It is a service provider that supports the kDrawEventService and also implements the <a class="el" href="class_i_drw_evt_handler.html">IDrwEvtHandler</a> interface. The IDrwEvthandler interface contains methods to register and unregister draw events. For a list of available draw events, see the following header:<p>&lt;SDK&gt;/source/public/interfaces/graphics/DocumentContextID.h<p>When it comes time to actually draw, the HandleEvent method is called on the IDrwEvthandler instance. The passed-in eventData contains the context and graphics port necessary for drawing.<p>The Watermark and BasicDrwEvtHandler samples are good examples of Draw event handlers. The BasicDrwEvtHandler demonstrates registering to handle many events, and the Watermark sample demonstrates actually drawing something of interest to a document.<h2><a class="anchor" id="id_page-item_adornments"></a> Page-item adornments</h2><p>Page-item adornments allow plug-ins to do custom drawing on a page items. An adornment is a nonpersistent boss that provides an implementation of <a class="el" href="class_i_adornment_shape.html">IAdornmentShape</a>. Adornments are referenced by ClassID. You can add or remove adornments using the AddAdornment and RemoveAdornment methods on <a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a>. This interface is available on all page-item boss classes. As the page item draws, it checks the <a class="el" href="class_i_page_item_adornment_list.html">IPageItemAdornmentList</a> and instantiates and calls any adornments that are registered to draw at particular points in the draw order.<p>Your implementation of <a class="el" href="class_i_adornment_shape.html#ac2842f657dde1d467227c08ae27a9d4c">IAdornmentShape::GetDrawOrderBits()</a> provides the points in the draw order that your adornment will be called on to draw. There are various points defined in the IAdornmentShape::AdornmentDrawOrder enumeration. Some of the items are relevant only to certain types of page items. An adornment can specify multiple points by adding different draw order values together.<p>When it is time for the adornment to draw, the application calls IAdornmentShape::Draw() on the adornment: <div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> Draw (<a class="code" href="class_i_shape.html">IShape</a>* iShape, <span class="comment">// owning page item</span></div><div class="line"> AdornmentDrawOrder drawOrder,</div><div class="line"><a class="code" href="class_graphics_data.html">GraphicsData</a>* gd,</div><div class="line"> int32 flags) = 0;</div></div><p>While an adornment cannot be persistent, it is passed a pointer to the shape it is drawing on (iShape). This allows adornments to access data that is specific to the page item. This can include data that your plug-in adds to the page item. The Draw method also is passed the AdornmentDrawOrder value describing the current point in the draw order; this provides a way for one Draw method to handle different points in the draw order. The next parameter passed is a <a class="el" href="class_graphics_data.html">GraphicsData</a> object, which provides the means to actually draw into the document. The final parameter is a set of flags that describe some attributes of the current situation; for example, these flags can be used to determine whether the application is printing.<p>If the adornment draws outside the bounds of the page item, it effectively extends the painted bounds of the page item. The adornment needs to report this to the application, so the correct screen area can be invalidated when the item is moved. This is done using the GetPaintedBBox() method.<p>The Frame Label sample is an excellent example of how to implement a page-item adornment. For more detail about page-item adornments, see the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_graphics_fundamentals">Graphics Fundamentals</a> chapter of the Adobe InDesign Plug-In Programming Guide.<dl class="section note"><dt>Note<dd>There also are handle shape adornments that allow you to adorn page-item handles and participate in hit testing.</dl><h2><a class="anchor" id="id_selection_suites"></a> Selection suites</h2><p>This guide does not cover implementing user-interface components like panels, menus, and dialogs. For that, see Adobe InDesign Plug-In Programming Guide, Adobe InDesign SDK Solutions Guide, or the numerous samples that demonstrate creating user interfaces.<p>If you were to write a user interface, it would need to operate on a selection. This section introduces you to how InDesign handles selection.<p>Rather than querying the application for a list of selected objects, iterating through the list, and calling commands (or facades), an InDesign user interface queries for a particular selection suite and calls methods on that suite. The user interface is not allowed to be concerned with what is selected. It strictly calls through the suite. This design facilitates adding selection types without changing large amounts of client code.<p>A selection suite is specific to a particular domain. For example, the <a class="el" href="class_i_geometry_suite.html">IGeometrySuite</a> can be used to change the geometry of the current selection (ResizeSelection) or to find out if that is even possible (CanChangeSelectionHeight) with the current selection.<p>To get to a selection suite, you must first access the selection manager. Each user-interface component is passed or initialized with an <a class="el" href="class_i_active_context.html">IActiveContext</a> pointer. This pointer is the proper way to gain access to the selection manager:<div class="fragment"><div class="line"><a class="code" href="class_i_selection_manager.html">ISelectionManager</a>* selectionMgr = ac-&gt;GetContextSelection();</div></div><p>Some global utilities exist that return an <a class="el" href="class_i_selection_manager.html">ISelectionManager</a>. These bypass the ActiveContext and make their decision based on the front document in the user interface. These work as long as the front document and the <a class="el" href="class_i_active_context.html">IActiveContext</a> are in sync. While there is code in the application that does it that way, the application is suspicious when dealing with multiple views. Furthermore, this approach is not well positioned for upcoming InDesign changes. We recommend that you acquire <a class="el" href="class_i_selection_manager.html">ISelectionManager</a> through the <a class="el" href="class_i_active_context.html">IActiveContext</a> interface. Once you have an <a class="el" href="class_i_selection_manager.html">ISelectionManager</a>, you can query for a suite:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IFrmLblDataSuite&gt;</a> frmLblDataSuite(dlgContext, GetContextSelection(),<a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div></div><p>The preceding is important for code that consumes (or calls) selection suites. If you implement commands that change data, you will need to implement your own selection suite. Adobe InDesign Plug-In Programming Guide has an entire chapter dedicated to this. It demonstrates all the types of selections that can be supported. There also are many samples that implement selection suites. Also, DollyXs can generate a plug-in with a selection suite.<p>The following is a high-level view of the process of writing a selection suite, to provide you with some familiarity with the process:<ol type="1"><li>Write commands that change your data.<li>Write a facade that provides a procedural means to call your data.<li>Write an interface for your selection suite. This will be very similar to your facade&#39;s interface, except it will not have any information about what to target. It also may have some other operations that check to see whether an operation in the user interface is possible with the current selection.<li>Write one implementation of this interface for each type of selection that your suite will handle. Examples of types your suite might handle include text, layout (page items), defaults, and table selections. By convention, these implementations contain &quot;CSB&quot; and the type of selection (&quot;LayoutCSB) in their class and filenames. CSB stands for &quot;Concrete Selection Boss&quot; and is where the selection suite actually is located.<li>Also provide another implementation of the suite, which will live on the active selection boss. By convention, ASB is in the filename of this type of implementation. It provides the template magic that allows the selection manager to call through to the right CSB or CSBs to handle a request.<li>Add your selection suite into the correct CSB bosses.</ol><h2><a class="anchor" id="id_scripting"></a> Scripting</h2><p>InDesign supports three higher-level programming languages: JavaScript, VBScript, and AppleScript. These scripting languages can be used to automate repetitive tasks. JavaScript has even been used to implement a product feature, Export for Dreamweaver; the source code is available in the InDesign SDK.<p>Adobe is investing in enhancing the scripting model, so more solutions can be built with scripting. Other important technologies, such as IDML , are based on scripting. A good plug-in should provide scripting support for any persistent data that it introduces to a document. This allows the data to be represented in IDML (InDesign Markup Language).<p>For example, consider the following script that exercises the Frame Label feature using scripting:<div class="fragment"><div class="line">var doc = app.documents[0]</div><div class="line">doc.viewPreferences.verticalMeasurementUnits = MeasurementUnits.points;</div><div class="line">doc.viewPreferences.horizontalMeasurementUnits = MeasurementUnits.points;</div><div class="line">var rect = doc.pages[0].rectangles.add();</div><div class="line">rect.geometricBounds = [36,36, 136, 136];</div><div class="line">rect.framelabelString = <span class="stringliteral">&quot;Hello World&quot;</span>;</div><div class="line">rect.framelabelPosition = FramelabelPositionEnum.framelabelRight;</div><div class="line">rect.framelabelSize = 15;</div><div class="line">rect.framelabelFontColor = UIColors.green;</div><div class="line">rect.framelabelVisibility = <span class="keyword">true</span>;</div></div><p>The FrameLabel plug-in adds &quot;framelabel&quot; properties to InDesign page-item types. Here, a rectangle is decorated with a green &quot;Hello World&quot; frame label. This same frame label is represented in IDML. This can be seen in the following blurb:<div class="fragment"><div class="line">&lt;Spread Self=<span class="stringliteral">&quot;ubd&quot;</span>&gt;</div><div class="line">&lt;Rectangle Self=<span class="stringliteral">&quot;uda&quot;</span> ...</div><div class="line"> FramelabelString=<span class="stringliteral">&quot;Hello World&quot;</span></div><div class="line"> FramelabelSize=<span class="stringliteral">&quot;15&quot;</span></div><div class="line"> FramelabelVisibility=<span class="stringliteral">&quot;true&quot;</span></div><div class="line"> FramelabelPosition=<span class="stringliteral">&quot;FramelabelRight&quot;</span>&gt;</div></div><p>To make this possible, a plug-in must provide scripting support. In addition to the Frame Label sample, there are many other examples in the SDK. Similar to the situation with selection suites, DollyXs can generate a plug-in with stubbed-out scripting support, and Adobe InDesign Plug-In Programming Guide dedicates an entire chapter (<a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a>) to the subject. You will need to seek out those resources when making your plug-in scriptable.<p>The following is a high-level overview:<ol type="1"><li>Decide how your data will be represented in scripting. This includes identifying which objects, properties, enums, and events you will introduce.<li>Each of the items requires a unique name that is mapped to a unique four-character ID. These name/ID pairs must be registered with Adobe. Typically, these values are made part of an enum and are saved in a header file for later use.<li>Generate GUIDs for each new scripting object you introduce. This can be done using the Microsoft GUID Generator (GUIDGEN.exe). This is only for objects and is not required for properties, enums, and events. These GUIDs are #defined in a header for later use.<li>The scripting objects, events, properties, and enums are described in a VersionedScriptElementInfo resource in your plug-ins ODFRC file. This requires you to add several new IDs in the kScriptInfoIDSpace. This also identifies at least one ScriptProvider.<li>A ScriptProvider is a boss that provides an implementation of <a class="el" href="class_i_script_provider.html">IScriptProvider</a>. Your implementation handles any properties or events specified in the VersionedScriptElementInfo.</ol><p>See <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a> for more details. Adding scripting support primarily amounts to knowing how to deal with various ID types, crafting a VersionedScriptElementInfo, and writing some C++ code that maps IDs and scripting constructs to the InDesign object model.<h1><a class="anchor" id="id_installing_plug_ins"></a> Installing plug-ins</h1><p>For your plug-ins to be used in InDesign, InDesign must know about your plug-ins at launch time so that it can load them. &quot;Launching InDesign with the samples&quot; (in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_compiling_and_executing_sample_code">Compiling and executing sample code</a>) explains how to do this.<p>You have a few options for distributing your plug-ins:<ol type="1"><li>Use Adobe Exchange for sale and distribution.<li>You can build and distribute an installer, which extracts the plug-in and puts it in the correct system location for InDesign to load it from.<li>You can provide your users with the built InDesign plug-in and tell them where it needs to go on their machine.</ol><p>Options 2 and 3 are outside the scope of this document. For option 1, please refer to the following resources:<ul><li>Creative Cloud Developers Prerelease program accessible from <a href="https://www.adobeprerelease.com/">https://www.adobeprerelease.com/</a><li><a href="https://www.adobeexchange.com/producer">https://www.adobeexchange.com/producer</a><li><a href="http://wwwimages.adobe.com/content/dam/Adobe/en/devnet/creativesuite/pdfs/SigningTechNote_CC.pdf">Packaging and signing extensions</a><li><a href="https://github.com/Adobe-CEP/CEP-Resources/tree/master/ZXPSignCMD">ZXPSignCMD</a><li><a href="https://exchange.adobe.com/addons">Adobe Add-ons</a><li><a href="https://www.adobeexchange.com/resources/28">ExMan Command Line Tool</a><li><a href="https://www.adobeexchange.com/resources/19">Troubleshooting Adobe Add-ons</a></ul><h1><a class="anchor" id="id_indesign_server_techniques"></a> InDesign Server</h1><p>InDesign Server plug-ins use the same architecture as plug-ins for InDesign desktop. However, because InDesign Server does not have a user interface like its desktop counterpart, there are special considerations to take when making a plug-in compatible with InDesign Server.<h2><a class="anchor" id="id_key_concepts"></a> Key concepts</h2><h3><a class="anchor" id=""></a></h3><p>InDesign uses the model-view-controller (MVC) architecture from SmallTalk to factor its user interface. The model manages the behavior and data of the application domain, delivers information about its state to the view, and makes changes to its state as directed by the controller. The view manages the user interface, including the onscreen representation of the model. The controller interprets the mouse gestures and keyboard input from the user, commanding the model and or view to change as appropriate. The following are mapped onto InDesign:<ul><li>The model is a document containing publishing assets such as text or images, organized into pages, spreads, and layers.<li>The view is a window opened on the document, displaying the contents of the document to the user.<li>A controller is an object that facilitates communication between the model and the view (for example, a dialog controller or event handler).</ul><p>One way of thinking about MVC is that it formalizes the relationships among input, output, and data processing. If you constructed a view of your model (which could be a window displaying a document), you could easily have multiple views of the same model. Conversely, if you design your plug-ins according to this paradigm, you can easily interchange the view of your model or eliminate it altogether.<h3><a class="anchor" id="id_active_context"></a> Active context</h3><p>In desktop InDesign, the active context refers to an object with which a user is interacting. Object types include documents, selected items, control views, and workspaces. At any time, there could be one object of each kind in the active context. The active context is identified by the <a class="el" href="class_i_active_context.html">IActiveContext</a> interface. Developers can get the active context object by calling one of the Get*** methods in <a class="el" href="class_i_active_context.html">IActiveContext</a>.<p>In InDesign Server, however, not all types of active context may be available. For instance, there is no view for InDesign Server.<h2><a class="anchor" id="id_how_desktop_indesign_and_indesign_server_differ"></a> How desktop InDesign and InDesign Server differ</h2><p>Although both desktop InDesign and InDesign Server were developed from the same code base, there are many configuration differences. For instance, desktop InDesign requires a full-featured user interface, but InDesign Server does not. Also, InDesign Server provides features enabling control by sending SOAP packets over the network. Most configuration differences are in the set of plug-ins installed and/or loaded by each application. These configuration differences present a different object model landscape; therefore, plug-in developers must exercise caution when porting plug-ins for use with InDesign Server. For instance, user-interface elements in desktop InDesign are not available in InDesign Server. Assumptions about the existence of certain interfaces, especially ones related to user-interface components (dialogs/panels, observers attached to such components, and menus/actions), must be fortified with code that handles such cases properly.<p>The lists in the following sections present a complete set of configuration differences between desktop InDesign and InDesign Server, primarily at the plug-in and binary component level (frameworks and dynamic link libraries).<p>Windows&reg; plug-ins are DLLs with the extension .apln (application) or .rpln (required). Plug-ins can also use the .pln extension. Mac&Acirc;&nbsp;OS&reg; plug-ins are created as framework bundles. The folder that stores a bundle has the extension &quot;.framework&quot;. For brevity, these extensions are omitted in the following lists.<h3><a class="anchor" id="id_what_indesign_server_has_that_desktop_indesign_does_not_have"></a> What InDesign Server has that desktop InDesign does not have</h3><p>The following plug-ins are unique to InDesign Server (that is, their Product resource contains only kInDesignServerProduct):<ul><li>&lt;InDesign Server&gt;/Plug-Ins/Server/Corba Generator<li>&lt;InDesign Server&gt;/Plug-Ins/Server/Corba <a class="el" href="class_utils.html">Utils</a><li>&lt;InDesign Server&gt;/Plug-Ins/Server/ServerStatistics<li>&lt;InDesign Server&gt;/Plug-Ins/Server/SOAPServer</ul><p>InDesign Server includes the following plug-in, which is installed only with the Japanese version of InDesign:<ul><li>&lt;InDesign&gt;/Contents/MacOS/Required/CJKLayout</ul><p>The following boss classes are published from the Corba Generator, Corba <a class="el" href="class_utils.html">Utils</a>, ServerStatistics, and SOAPServer plug-ins:<ul><li>Corba Generator:<ul><li><a class="el" href="classk_corba_generator_boss.html">kCorbaGeneratorBoss</a><li><a class="el" href="classk_corba_generator_script_provider_boss.html">kCorbaGeneratorScriptProviderBoss</a><li><a class="el" href="classk_corba_header_file_generator_boss.html">kCorbaHeaderFileGeneratorBoss</a><li><a class="el" href="classk_corba_impl_file_generator_boss.html">kCorbaImplFileGeneratorBoss</a><li><a class="el" href="classk_corba_interface_file_generator_boss.html">kCorbaInterfaceFileGeneratorBoss</a><li>kPackagesInitializerBoss<li><a class="el" href="classk_template_initializer_boss.html">kTemplateInitializerBoss</a></ul><li>Corba <a class="el" href="class_utils.html">Utils</a>:<ul><li><a class="el" href="classk_corba_a_p_i_script_mgr_boss.html">kCorbaAPIScriptMgrBoss</a></ul><li>ServerStatistics:<ul><li>kServerStatisticsScriptProviderBoss<li>kServerStatisticsStartupShutdownBoss</ul><li>SOAPServer:<ul><li><a class="el" href="classk_error_list_script_object_boss.html">kErrorListScriptObjectBoss</a><li><a class="el" href="classk_error_list_script_provider_boss.html">kErrorListScriptProviderBoss</a><li>kModelUIScriptProviderBoss (debug only)<li><a class="el" href="classk_server_doc_file_handler_boss.html">kServerDocFileHandlerBoss</a> (NOTE: A different DocFileHandler boss is available in desktop InDesign)<li><a class="el" href="classk_server_settings_script_provider_boss.html">kServerSettingsScriptProviderBoss</a><li><a class="el" href="classk_server_test_script_provider_boss.html">kServerTestScriptProviderBoss</a><li><a class="el" href="classk_shutdown_request_idle_task_boss.html">kShutdownRequestIdleTaskBoss</a><li><a class="el" href="classk_soap_server_idle_task_boss.html">kSoapServerIdleTaskBoss</a><li>kSoapServerScriptProviderBoss<li><a class="el" href="classk_soap_server_startup_shutdown_boss.html">kSoapServerStartupShutdownBoss</a><li>kXSLEnablerServiceBoss</ul></ul><p>The following public add-ins are published from the plug-ins:<ul><li>IID_IDOCUMENTUIACTIONS (boss: <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>; interface: <a class="el" href="class_i_document_u_i_actions.html">IDocumentUIActions</a>. Desktop InDesign also has an implementation of this interface.)<li>IID_IERRORLIST (boss: <a class="el" href="classk_session_boss.html">kSessionBoss</a>; interface: <a class="el" href="class_i_error_list.html">IErrorList</a>)<li>IID_IEVENTDISPATCHER (boss: <a class="el" href="classk_app_boss.html">kAppBoss</a>; interface: <a class="el" href="class_i_event_dispatcher.html">IEventDispatcher</a>. Desktop InDesign also has an implementation of this interface.)<li>IID_ISERVERSETTINGS (boss: <a class="el" href="classk_session_boss.html">kSessionBoss</a>; interface: <a class="el" href="class_i_server_settings.html">IServerSettings</a>)<li>IID_IPERFORMANCECOUNTERS (boss: <a class="el" href="classk_utils_boss.html">kUtilsBoss</a>; interface: IPerformanceCounters))</ul><h3><a class="anchor" id="id_what_desktop_indesign_has_that_indesign_server_does_not_have"></a> What desktop InDesign has that InDesign Server does not have</h3><p>Most of the plug-ins and related components distributed and loaded only in desktop InDesign are related to the application&#39;s user interface or &quot;view&quot; components. These elements are not necessary for InDesign Server, because InDesign Server has no user interface.<h2><a class="anchor" id="id_minimum_requirements_for_an_indesign_server_plug-in"></a> Minimum requirements for an InDesign Server plug-in</h2><p>A plug-in for InDesign Server should meet at least the following requirements:<ul><li>The plug-in should be developed InDesignnDesign plug-in SDK.<li>The ProductIds field in the PluginVersion resource should contain at least kInDesignServerProduct. (See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_making_a_plug_in_load_or_not_load_in_indesign_server">Making a plug-in load (or not load) in InDesign Server</a>.)<li>The threading policy field in PluginVersion should be set to kModelPlugin. Background threads behave much like InDesign Server, in that user-interface components are not available.<li>The plug-in must truly be model only. There should be no dependencies on user-interface-related components available only in desktop InDesign, like the WidgetBin.dll (Windows) or InDesignModelAndUI.framework (Mac OS). For more information, see the<li><a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_model_and_ui_separation">Model and UI Separation</a> chapter in the Adobe InDesign Plug-In Programming Guide.</ul><h3><a class="anchor" id="id_making_a_plug_in_load_or_not_load_in_indesign_server"></a> Making a plug-in load (or not load) in InDesign Server</h3><p>You can specify whether a plug-in should be loaded, by specifying the ProductIds flags in the PluginVersion resource. The following example shows a PluginVersion resource for a plug-in that will be loaded only in InDesign Server:<div class="fragment"><div class="line">resource PluginVersion (1) { </div><div class="line"> kTargetVersion, </div><div class="line"> kMyPluginID, </div><div class="line"> kMajorVersionNumber, </div><div class="line"> kMinorVersionNumber, </div><div class="line"> kMajorVersionNumber, </div><div class="line"> kMinorVersionNumber, </div><div class="line"> kMyPluginLastMajorFormat, </div><div class="line"> kMyPluginLastMinorFormat, </div><div class="line"> { kInDesignServerProduct }, <span class="comment">// ProductIds field </span></div><div class="line"> { kWildFS }, </div><div class="line"> kModelPlugIn, </div><div class="line"> kAUMComponentVersionStr</div><div class="line">};</div></div><p>If you omit kInDesignServerProduct from the ProductIds field, the plug-in is not loaded in InDesign Server.<p>If you specify { kInDesignProduct, kInCopyProduct, kInDesignServerProduct } in the ProductIds field, the plug-in is loaded in all three products in the InDesign product family: InDesign, InCopy, and InDesign Server.<p>A plug-in must specify whether it supports model or user-interface (view) operations. This is called the plug-in&#39;s threading policy, because it was introduced to support InDesign&#39;s multithreading model, which makes model operations threadable. As mentioned above, InDesign Server plug-ins must specify kModelPlugIn in this field.<p>The SDK contains a set of plug-ins that will load under InDesign Server:<ul><li>BasicPersistInterface<li>CandleChart<li>CHLinguistic<li>CHMLFilter<li>CustomConditionalText<li>ExtendedLink<li>FrameLabel<li>HiddenText<li>Hyphenator<li>InCopyExport<li>InCopyImport<li>INXErrorLogging<li>PersistentList<li>PreflightRule<li>SingleLineComposer<li>TextImportFilter<li>TransparencyEffect<li>Watermark<li>XDocBookWorkflow<li>XMLCatalogHandler<li>XMLDataUpdater</ul><p>These plug-ins provide services used by application features; therefore, no special script provider implementations are necessary for them to be driven by a script. For details on how to use a plug-in&#39;s features though scripting, see the documentation for each sample.<h3><a class="anchor" id="id_detecting_whether_your_plug-in_is_running_under_indesign_server"></a> Detecting whether your plug-in is running under InDesign Server</h3><p>You can distinguish between desktop InDesign and InDesign Server at runtime by getting the product ID via the LocaleSetting singleton class. The call LocaleSetting::GetLocale().GetProductFS() returns one of the following values (defined in &lt;SDK&gt;/source/public/includes/FeatureSets.h):<ul><li>kInCopyProductFS: Plug-in is running under InCopy.<li>kInDesignProductFS: Plug-in is running under desktop InDesign.<li>kInDesignServerProductFS: Plug-in is running under InDesign Server.</ul><p>You also can use the LocaleSetting::GetLocale().IsProductFS(&lt;productId&gt;) method to test for one of the preceding values. For more information on these methods, see &lt;SDK&gt;/source/public/includes/PMLocaleTypes.h.<h3><a class="anchor" id="id_verifying_whether_your_plug-in_is_loaded_in_indesign_server"></a> Verifying whether your plug-in is loaded in InDesign Server</h3><p>There are two ways to verify whether your plug-in is loaded in InDesign Server:<ol type="1"><li>Load your plug-in in InDesign Server, start the application, shut it down, and then examine the QA/Logs/configuration_NNNNN/PluginLoadLog.txt file (where NNNNN is the InDesign Server TCP/IP port number).<li>Use the QATest script event with a plug-in information related parameter. For information on scripting features related to testing, see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_testing_techniques">Testing techniques</a>.</ol><h2><a class="anchor" id="id_removing_calls_to_apis_that_depend_on_active_context"></a> Removing calls to APIs that depend on active context</h2><p>Several methods in the InDesign C++ API rely on an object that is &quot;front&quot;; for example, a document or layout that is in front of others. These APIs are not available in InDesign Server, which does not have a user interface and, consequently, has no concept of an object being in front. For example, instead of using <a class="el" href="class_i_layout_u_i_utils.html#a349e53c22983fc80067e2770056ce16d">ILayoutUIUtils::GetFrontDocument</a>, you need to access <a class="el" href="class_i_document_list.html">IDocumentList</a> or store the instance of the document in a variable when you create it.<h2><a class="anchor" id="id_using_messagelog_or_ierrorlist_for_custom_error_warning_dialogs"></a> Using MessageLog or IErrorList for custom error/warning dialogs</h2><p>In desktop InDesign, plug-ins may invoke custom modal dialogs (other than <a class="el" href="class_c_alert.html">CAlert</a>) to inform users of an error or warning. An example of such a dialog is the missing plug-ins dialog, which displays the message, &quot;The document (name) uses one or more plug-ins which are not currently available&acirc;&#128;&brvbar;&quot; A user must click on a button on this dialog for the application to proceed.<p>In an application without a user interface, such as InDesign Server, showing a modal dialog is equivalent to the server application hanging. As a result, plug-ins running under InDesign Server must use a different mechanism to report messages to the user. Instead of displaying a dialog, messages must be written to a message log.<p>Third-party plug-ins can use the message log by using one of the following APIs:<ul><li><a class="el" href="class_message_log.html">MessageLog</a> - To write to the message log. See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_writing_messages_to_the_log_with_messagelog">Writing messages to the log with MessageLog</a>.<li><a class="el" href="class_i_error_list.html">IErrorList</a> - To read from the message log. See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_inspecting_the_list_of_logged_messages_with_ierrorlist">Inspecting the list of logged messages with IErrorList</a>.</ul><h3><a class="anchor" id="id_writing_messages_to_the_log_with_messagelog"></a> Writing messages to the log with MessageLog</h3><p>The API <a class="el" href="class_message_log.html">MessageLog</a> utility (&lt;SDK&gt;/source/public/includes/MessageLog.h) allows plug-in code to add messages to the message log. If your desktop InDesign plug-in code invokes modal dialogs to inform users of an error or warning, you must augment your code to instead send the message to the message log when running under InDesign Server. Ideally, you also would move your desktop InDesign dialog code to a user-interface-only plug-in so that it will not load under InDesign Server.<dl class="section note"><dt>Note<dd>You do not need to replace calls to <a class="el" href="class_c_alert.html">CAlert</a> methods with <a class="el" href="class_message_log.html">MessageLog</a>, because the InDesign Server implementation of <a class="el" href="class_c_alert.html">CAlert</a> internally logs messages using <a class="el" href="class_message_log.html">MessageLog</a>.</dl><p>There are three runtime global instances of type <a class="el" href="class_message_log.html">MessageLog</a> that can be used to log messages at one of three different levels. For example, to log an information message, use the following:<div class="fragment"><div class="line">gInfoLog.Write(<span class="stringliteral">&quot;Executing Script&quot;</span>); <span class="comment">// errorlevel = CAlert::eInformationIcon</span></div></div><p>To log a warning, use the following:<div class="fragment"><div class="line">gWarnLog.Write(<span class="stringliteral">&quot;Missing Font&quot;</span>); <span class="comment">// errorlevel = CAlert::eWarningIcon</span></div></div><p>And to log an error, use the following:<div class="fragment"><div class="line">gErrorLog.Write(<span class="stringliteral">&quot;Invalid Path&quot;</span>); <span class="comment">// errorlevel = CAlert::eErrorIcon</span></div></div><p>All these examples use constant value strings. The Write method takes a <a class="el" href="class_p_m_string.html">PMString</a>, so the messages can be localized and constructed using standard InDesign string mechanisms, such as locale-specific string.fr files and ReplaceStringParameters.<p>When you write to the message log in this way, the messages are added to the in-memory error list using <a class="el" href="class_i_error_list.html">IErrorList</a> (see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_inspecting_the_list_of_logged_messages_with_ierrorlist">Inspecting the list of logged messages with IErrorList</a>) and are written to stdout or stderr, depending on the level of the message. Information and warning messages go to stdout; error messages, to stderr.<p>Outside of the context of a plug-in (for example, from an application that invokes InDesign Server), you can redirect the stdout and stderr pipes to capture the log. You can use the standard mechanisms on Unix and Windows for redirecting stdout and stderr.<h3><a class="anchor" id="id_inspecting_the_list_of_logged_messages_with_ierrorlist"></a> Inspecting the list of logged messages with IErrorList</h3><p>The <a class="el" href="class_i_error_list.html">IErrorList</a> interface, which should be used by third-party plug-ins only to inspect the list of logged messages, is aggregated on the <a class="el" href="classk_session_boss.html">kSessionBoss</a> only under InDesign Server. (This interface is not available at runtime when running under desktop InDesign.)<p>To get the number of logged messages, do the following:<div class="fragment"><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IErrorList&gt;</a> errorList(GetExecutionContextSession(), <a class="code" href="class_use_default_i_i_d.html">UseDefaultIID</a>());</div><div class="line">int16 numMessages = errorList-&gt;GetNumErrors();</div></div><p>Then, to inspect the nth logged message (where 0 &lt;= n &lt; numMessages), do the following:<div class="fragment"><div class="line"><a class="code" href="class_p_m_string.html">PMString</a> message = errorList-&gt;GetErrorMessage(n);</div></div><p>Finally, to inspect the nth logged message&#39;s error level, do the following:<div class="fragment"><div class="line">int32 errorLevel = errorList-&gt;GetErrorLevel(n);</div></div><p>where the error level value is one of the enums defined in typedef CAlert::eAlertIcon.<p>For details on the <a class="el" href="class_i_error_list.html">IErrorList</a> interface, see the HTML-based reference documentation.<p>Scripting clients of InDesign Server can retrieve these messages in a similar way. You can get details about logged messages, such as the error code, error level as defined in the typedef CAlert::eAlertIcon, message string, and timestamp, by accessing the ListErrorCode property, ListErrorLevel property, ListErrorMessage property, and ListErrorTime property, respectively, on a specific ErrorListError collection item.<dl class="section note"><dt>Note<dd>With the exception of the <a class="el" href="class_message_log.html">MessageLog</a> implementation and error list script provider implementation, do not use the <a class="el" href="class_i_error_list.html">IErrorList</a> interface to write a message to the log. To write a message to the log from plug-in code, use the <a class="el" href="class_message_log.html">MessageLog</a> mechanism (see <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_writing_messages_to_the_log_with_messagelog">Writing messages to the log with MessageLog</a>).</dl><h3><a class="anchor" id="id_writing_messages_directly_to_standard_error_and_standard_output_without_writing_them_to_the_message_log"></a> Writing messages directly to standard error and standard output without writing them to the message log</h3><p>Even if you do not want your messages written to the log, you can still write messages to the console (from which you invoked InDesign Server) from within your plug-in code, using cerr or cout:<div class="fragment"><div class="line"><span class="keywordflow">if</span> (LocaleSetting::GetLocale().GetProductFS() == kInDesignServerProductFS)</div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;(This is some message)&quot;</span> &lt;&lt; std::endl;</div></div><p>The key point is that the call to cout is executed only if the runtime check for the InDesign Server feature set passes. These extra user interface updates may slow down the application; therefore, we recommend that you use this technique only when needed, for example, when debugging.<p>The Application script object for InDesign Server also has events that allow a script to write text to the standard error and standard output streams. They are Consoleerr and Consoleout, respectively. Both events take a string parameter containing the message to be written.<dl class="section note"><dt>Note<dd>If you write messages directly to standard error and standard output, you cannot retrieve them later using <a class="el" href="class_i_error_list.html">IErrorList</a>.</dl><h2><a class="anchor" id="id_adding_custom_features_to_indesign_server"></a> Adding custom features to InDesign Server</h2><p>With desktop InDesign, you can add user interface components to let users use the custom features provided by your plug-in. With InDesign Server, however, there is no user interface. The recommended way to expose your plug-in&#39;s custom features to clients of InDesign Server is to implement script providers for your custom features, so clients can drive them by scripts. The <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a> chapter of Adobe InDesign Plug-In Programming Guide provides more details on how to add script providers to your plug-ins.<p>Before you make your plug-in scriptable, you may need to perform a set of preparatory refactoring tasks to make the process go smoothly; for example, making sure that the model and user-interface components are separated. For instance, if you are performing key tasks, such as processing commands, directly from within an action component or dialog controller, consider moving that code to a utility or facade class that can be called from multiple components.<h2><a class="anchor" id="id_performance_considerations"></a> Performance considerations</h2><p>One reason for using InDesign Server is to take advantage of the high-performance publication generation engine made possible due to the lack of a user interface; however, removing the user-interface components from your plug-ins goes only so far. There are other plug-in programming techniques that you can incorporate to improve the performance of your plug-in:<ul><li>Make sure no unneeded observers are attached (especially those that watch for model changes to update a user interface).<li>Make sure there are no unnecessary idle tasks.<li>Remove unnecessary global recompositions of text stories.</ul><h3><a class="anchor" id="id_make_sure_no_unneeded_observers_are_attached"></a> Make sure no unneeded observers are attached</h3><p>The InDesign change manager calls observers one by one whenever there is a change of interest. Therefore, processing gets slower as more observers are attached to a subject. If you have any observers that were attached to model subjects to update a user interface (such as a widget on a panel, dock bar, or kit), eliminate them (or put them in plug-ins that load only under kInDesignProduct or kInCopyProduct), because your InDesign Server plug-in will not need them.<dl class="section note"><dt>Note<dd>There are precautions to take when moving persistent implementations to a plug-in with a different plug-in ID. For more information, refer to the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_model_and_ui_separation">Model and UI Separation</a> chapter of the Adobe InDesign Plug-In Programming Guide.</dl><h3><a class="anchor" id="id_make_sure_there_are_no_unnecessary_idle_tasks"></a> Make sure there are no unnecessary idle tasks</h3><p>As with observers, processing time increases as more idle tasks are installed in the application. If you have idle tasks monitoring specific operating system events or messages, and they are not part of your InDesign Server workflow, eliminate them (or put them in plug-ins that load only under kInDesignProduct or kInCopyProduct).<dl class="section note"><dt>Note<dd>There are precautions to take when moving persistent implementations to a plug-in with a different plug-in ID. Refer to the <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_model_and_ui_separation">Model and UI Separation</a> chapter of the Adobe InDesign Plug-In Programming Guide.</dl><h3><a class="anchor" id="id_remove_unnecessary_global_recompositions_of_text_stories"></a> Remove unnecessary global recompositions of text stories</h3><p>Many existing scripting providers force text composition when they need to return data that relies on composition. (It might be useful for script authors to know that the operations they are performing are forcing composition. They might then be able to combine these operations at the end of the script or even remove them.) If there is a bottleneck for text composition in your script provider, this can be set as a simple preference, for instance, where a message is displayed to the console (stdout) every time text composition is forced, so the script author is notified when this happens. The script author can then refactor the script to reduce such bottlenecks.<h2><a class="anchor" id="id_testing_techniques"></a> Testing techniques</h2><p>After you have ported your plug-in code for use with InDesign Server, removed all view components, and refactored for performance improvements, you are ready to test your plug-in in the debug build of InDesign Server.<p>If you added script providers to your plug-in, you can test your plug-ins through your own scripts. It is essential that you become comfortable writing automation scripts with the InDesign Server scripting library. For further references on scripting with InDesign, refer to the Adobe InDesign Scripting Guide.<p>In addition to testing your own plug-in&#39;s features with scripts, you can use some of the testing features exposed through the script provider for InDesign Server&#39;s debug build. Some of these features also are available in the &quot;QA&quot; and &quot;Test&quot; menus in desktop InDesign. You can write scripts to exercise these features and supplement the tests for your own plug-ins.<p>These debug-only scripting features are provided for internal use by Adobe Engineering, and the documentation for these features is provided only as a reference and convenience for developers. Some components necessary to fully execute these features may not be available in the debug distribution.<h3><a class="anchor" id="id_scripting_objects_you_can_use_for_testing"></a> Scripting objects you can use for testing</h3><p>The following table lists script events and properties provided only in the InDesign Server debug build for testing purposes. The events and properties listed in the table are written using VisualBasic syntax. See the language-specific examples for Apple Script and JavaScript.<p>Events and properties on debug-only script objects:<table class="doxtable"><tr><th>Event or property </th><th>Description </th></tr><tr><td>InDesignServer.Application.pluginswithui property </td><td>Returns a list of strings containing UI-related IIDs </td></tr><tr><td>InDesignServer.Application.modelpluginswithui property </td><td>Returns a list of strings containing UI-related IIDs implemented in a hard-coded list of model plug-ins known to the product. </td></tr><tr><td>InDesignServer.Application.uipluginswithmodel property </td><td>Returns a list of strings containing model IIDs (e.g., IID_ICOMMAND) implemented by a hard-coded list of user interface plug-ins. </td></tr><tr><td>InDesignServer.Application.QAScriptingObject property (Type: QAScript) </td><td>Provides access to the QAScript object, which provides the QATest event, TestFlags property, and TestIsRunning property. The QAScript.QATest event also is available as the InDesignServer.Application.QATest event (see below), and the QAScript.TestIsRunning property also is available as the InDesignServer.Application.TestIsRunning property (see below). </td></tr><tr><td>InDesignServer.Application.QATest event </td><td>Takes two parameters: &quot;named&quot;, a required string parameter that specifies the name of the test or operation to perform, and &quot;with parameter,&quot; an optional string parameter that specifies any parameters for the test or operation. This event also returns a string, which usually contains the response to the test or operation specified in &quot;named.&quot; For details, see &quot;Test names for the QATest Event&quot;. </td></tr><tr><td>InDesignServer.Application.ServerTest event </td><td>Takes one string parameter (&quot;test name&quot;), indicating which server test operation to perform. No value is returned. The string should be one of the following (case sensitive): &quot;purge everything&quot; (equivalent to the Test &gt; Memory &gt; Purge Everything menu item in desktop InDesign), &quot;purge frequently&quot; (Test &gt; Memory &gt; Purge Frequently), or &quot;purge normal&quot; (Test &gt; Memory &gt; Purge Normally). </td></tr></table><p><b>Test names for the QATest Event</b><p><b>Basics</b><p>Specify the following test names for basic testing features:<ul><li>&quot;BuildNumber&quot; - Returns the build number as a string.<li>&quot;CancelTest&quot; - Cancels the suite that is running, if any.<li>&quot;GenerateScripts&quot; - Generates scripts in the same way as the menu item QA &gt; Generate Scripts &gt; Generate Scripts. You must specify the category of scripts to be generated: &quot;AppleScript,&quot; &quot;Javascript,&quot; &quot;VisualBasic,&quot; &quot;HLA,&quot; &quot;AppleScript objects,&quot; &quot;Javascript objects,&quot; &quot;VisualBasic objects,&quot; or &quot;HLA objects.&quot;<li>&quot;GetTestResults&quot; - Returns the results of the suite most recently completed. The results are formatted as follows, where &quot;CR&quot; represents a carriage return and line feed (Windows) or a line feed (Mac OS): errorsCRwarningsCRfatalerrorsCRskippedCRqabugsCRelapsedtime.<li>&quot;ListEveryTestPath&quot; - Returns a string containing the paths of all nodes in the TestSuiteTreeView (that is, the view displayed in the Test panel). The paths are separated by platform-specific line endings.<li>&quot;RunSimplePath&quot; - Runs the tests specified in the accompanying string, as they would be listed in the RunTest panel suite[:provider[:test]].<li>&quot;RunTest&quot; - Runs the test specified in the accompanying string: test. If there are two tests with the same name, the first one ITestMgr finds is run.<li>&quot;RunTestPath&quot; - Runs the tests specified in the accompanying string, as they would be listed in the tree-view Test panel category:suite:provider[:group1[:group2[:group3]]]:test:.<li>&quot;QuitApplication&quot; - Quits the application.<li>&quot;RedrawLayout&quot; - Forces the front-most window, if any, to redraw.<li>&quot;&lt;nameofsuite&gt;&quot; - Runs the named suite (replace &lt;nameofsuite&gt; with the suite&#39;s name). If there is an accompanying string, it restricts the suite to the provider or test named in that string.<li>&quot;TestMinimal&quot; - Runs the Minimal suite.<li>&quot;TestBenchmark&quot; - Runs the Benchmark suite (kBenchmarkSuiteBoss), using the number of repetitions specified in the accompanying string.<li>&quot;TestBuildAcceptance&quot; - Runs the NewBuildAcceptance suite.<li>&quot;TestIsRunning&quot; - Returns &quot;1&quot; if a test is running and &quot;0&quot; if no test is running.<li>&quot;TestTeamTests&quot; - Runs the Team Tests suite.<li>&quot;WhichTestIsRunning&quot; - Returns the name of the test that is running, if any.</ul><p><b>Settings</b><p>Specifying any set of tests and then running them is referred to as running a suite.<p>The Boolean settings have only two possible values, equivalent to on and off. If you set a Boolean and do not specify a second parameter, the setting is turned on. To explicitly turn on such a setting, specify &quot;True,&quot; &quot;Yes,&quot; &quot;On,&quot; or &quot;&quot;, where the interpretation of the parameter is case-insensitive; other values are equivalent to off. Returned values always are &quot;True&quot; or &quot;False.&quot;<ul><li>&quot;SetShowSuiteAlert&quot; and &quot;GetShowSuiteAlert&quot; - Boolean; controls whether a dialog summarizing test results appears after running a suite.<li>&quot;SetLogAsserts&quot; and &quot;GetLogAsserts&quot; - Boolean; controls whether failed assertions are logged during tests instead of producing dialogs.<li>&quot;SetLogAlerts&quot; and &quot;GetLogAlerts&quot; - Boolean; controls whether alerts are logged during tests instead of producing dialogs.<li>&quot;SetAutoUI&quot; and &quot;GetAutoUI&quot; - You can treat this as Boolean, to turn on or off user interface emulation during tests. To turn on this setting and specify the delay after each user interface event, specify only the number of seconds to use for the delay.<li>&quot;SetInstanceCache&quot; - Debug-only Boolean; controls whether the instance cache is on or off during testing.<li>&quot;SetLogXML&quot; and &quot;GetLogXML&quot; - Boolean; controls whether an XML log is generated during testing, in addition to the standard QASessionLog.txt.<li>&quot;SetCrashRecovery&quot; and &quot;GetCrashRecovery&quot; - Boolean; controls whether testing tries to resume after a crash and restart.<li>&quot;SetOpenAllPanels&quot; and &quot;GetOpenAllPanels&quot; - Boolean; controls whether panels are opened automatically at the start of a run of any suite.<li>&quot;SetCloseAllPanels&quot; and &quot;GetCloseAllPanels&quot; - Boolean; controls whether panels are closed automatically at the start of a run of any suite.<li>&quot;SetForceHighDisplayPerformance&quot; and &quot;GetForceHighDisplayPerformance&quot; - Boolean; controls whether display performance is automatically set to high during tests.<li>&quot;SetPurgeMemoryBetweenTests&quot; and &quot;GetPurgeMemoryBetweenTests&quot; - Boolean; controls whether memory is purged between tests. This is used by the benchmarking system.<li>&quot;SetSnapshotOnUndoRedo&quot; and &quot;GetSnapshotOnUndoRedo&quot; - Boolean; controls whether snapshotting is used in conjunction with automatic undo/redo testing.<li>&quot;SetValidateUndoRedoUsingExportToInCStory&quot; and &quot;GetValidateUndoRedoUsingExportToInCStory&quot; - Boolean; controls whether validation via an exported InCopy story is used in conjunction with automatic undo/redo testing.<li>&quot;SetBenchmarkIterations&quot; and &quot;GetBenchmarkIterations&quot; - Sets the number of iterations used during benchmark testing.<li>&quot;SetRestartBetweenGroups&quot; and &quot;GetRestartBetweenGroups&quot; - Boolean; controls whether the application is restarted between groups of benchmark tests.<li>&quot;SetRestartBetweenIterations&quot; and &quot;GetRestartBetweenIterations&quot; - Boolean; controls whether the application is restarted between iterations of benchmark tests.<li>&quot;GetQAFolder&quot; - Returns the location of the QA folder. If you specify a string argument, that string is appended to the path.<li>&quot;GetQALogFolder&quot; - Returns the location of the QA:Logs folder. If you specify a string argument, that string is appended to the path.<li>&quot;GetQAStatusFolder&quot; - Returns the location of the QA:Status folder. If you specify a string argument, that string is appended to the path.<li>&quot;GetQATestFileFolder&quot;: - Returns the location of the QA:Testfile folder. If you specify a string argument, that string is appended to the path.<li>&quot;GetQATrashFolder&quot; - Returns the location of the QA:QATrash folder. If you specify a string argument, that string is appended to the path.<li>&quot;SetVersionCue&quot; and &quot;GetVersionCue&quot; - Boolean; controls whether Adobe Version Cue&reg; is enabled during tests.<li>&quot;SetLogState&quot; and &quot;GetLogState&quot; - String; controls which information is logged during tests: &quot;LogBAComments,&quot; &quot;LogErrors,&quot; &quot;LogEverything,&quot; or &quot;NoLogging.&quot;<li>&quot;SetRunOnlyHeadlessTests&quot; and &quot;GetRunOnlyHeadlessTests&quot; - Boolean; when &quot;True,&quot; tests that cannot be run in headless mode are skipped, regardless of whether the application is currently running in headless mode.<li>&quot;SetHonorStatusFile&quot; and &quot;GetHonorStatusFile&quot; - Boolean; when &quot;True,&quot; entries in Status.txt files are honored.<li>&quot;SetPurgeAfterTest&quot; and &quot;GetPurgeAfterTest&quot; - String; controls the level of memory purging after each test: &quot;NoPurging,&quot; &quot;SwitchingDocuments,&quot; &quot;SwitchingApplications,&quot; &quot;LowMemory1,&quot; &quot;LowMemory2,&quot; &quot;LowMemory3,&quot; or &quot;ReleaseEverything.&quot;<li>&quot;SetUseManagedLocations&quot; and &quot;GetUseManagedLocations&quot; - Boolean; when &quot;True&quot; and when VersionCue is on, QAFile supports the use of managed locations.<li>&quot;SetReportUnexpectedAlertsAsErrors&quot; and &quot;GetReportUnexpectedAlertsAsErrors&quot; - Boolean; when &quot;True,&quot; alerts signaled during automated tests are not displayed as dialogs, but their messages are logged as errors in QASessionLog.txt.</ul><p><b>Plug-in information</b><p>To get information about plug-ins loaded into InDesign Server, specify the following test names:<ul><li>&quot;CountPlugins&quot; - Returns the number of plug-ins in the application&#39;s list.<li>&quot;IsLoadedNamedPlugin&quot; - Takes the name of a plug-in (for example, &quot;ACTIONS.RPLN&quot;) and returns &quot;True&quot; or &quot;False,&quot; depending on whether the plug-in is loaded.<li>&quot;Is Loaded Nth Plug in&quot; - Takes the index of a plug-in in the application&#39;s list, and returns &quot;True&quot; or &quot;False,&quot; depending on whether the plug-in is loaded.<li>&quot;LocateNthPlugin&quot; - Takes the index of a plug-in in the application&#39;s list and returns the path to the plug-in as a file.<li>&quot;NameNthPlugin&quot; - Takes the index of a plug-in in the application&#39;s list and returns the name of the plug-in.</ul><p><b>Examples in AppleScript</b><p>The following examples show how to use some of these debug-only scripting features in AppleScript:<p>Running Minimal: This script runs the &quot;minimal&quot; test:<div class="fragment"><div class="line">tell application <span class="stringliteral">&quot;InDesignServer&quot;</span>&Acirc;&nbsp;</div><div class="line"> QATest named <span class="stringliteral">&quot;Minimal&quot;</span></div><div class="line">end tell</div></div><p>Running One Test: This script runs a single test:<div class="fragment"><div class="line">tell application <span class="stringliteral">&quot;InDesignServer&quot;</span>&Acirc;&nbsp;</div><div class="line"> QATest named <span class="stringliteral">&quot;RunSimplePath&quot;</span> with parameter <span class="stringliteral">&quot;BuildAcceptance:Conversion:InDesign 1.0 Mac&quot;</span></div><div class="line">end tell</div></div><p>Is a Test Running: This script asks whether any test is running:<div class="fragment"><div class="line">tell application <span class="stringliteral">&quot;InDesignServer&quot;</span>&Acirc;&nbsp;</div><div class="line"> QATest named <span class="stringliteral">&quot;TestIsRunning&quot;</span>&Acirc;&nbsp;</div><div class="line"><span class="keywordflow">if</span> result = <span class="stringliteral">&quot;1&quot;</span> then</div><div class="line"> display dialog <span class="stringliteral">&quot;A test is running.&quot;</span>&Acirc;&nbsp;</div><div class="line"><span class="keywordflow">else</span></div><div class="line"> display dialog <span class="stringliteral">&quot;No test is running.&quot;</span>&Acirc;&nbsp;</div><div class="line"> end <span class="keywordflow">if</span></div><div class="line">end tell</div></div><p><b>Examples in VBScript</b><p>The following examples show how to use some of these debug-only scripting features in VBScript. To run a script that targets a particular version of InDesign, you may need to run that version once before using the script, so the application can be entered properly in the Windows registry. The name of the application, as it appears in the CreateObject() call, should be listed in the Registry under HKEY_CLASSES_ROOT.<p>Running Minimal: This script runs the &quot;minimal&quot; test:<div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesignServer.Application&quot;</span>)</div><div class="line">myApp.QATest &quot;TestMinimal&quot;</div></div><p>Running One Test: This script runs a single test:<div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesignServer.Application&quot;</span>)</div><div class="line">myApp.QATest &quot;RunSimplePath&quot;, &quot;BuildAcceptance:Conversion:InDesign 1.0 Mac&quot;</div></div><p>Is a Test Running: This script asks whether any test is running:<div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesignServer.Application&quot;</span>) </div><div class="line">running = myApp.QATest(&quot;TestIsRunning&quot;)</div><div class="line">if (running) then</div><div class="line"> MsgBox(&quot;Running&quot;)</div><div class="line">else </div><div class="line"> MsgBox(&quot;Not running&quot;) </div><div class="line">end if</div></div><p>Turning off the Suite Alert: This script suppresses the display of a dialog that reports a summary of test results at the end of running a test suite:<div class="fragment"><div class="line">Set myApp = CreateObject(<span class="stringliteral">&quot;InDesignServer.Application&quot;</span>)</div><div class="line">myApp.QATest &quot;SetShowSuiteAlert&quot;, &quot;False&quot;</div></div><p><b>Examples in JavaScript</b><p>The following examples show how to use some of these debug-only scripting features in JavaScript.<p>Using the JavaScript File object to output information obtained in a script to a Windows path:<div class="fragment"><div class="line">var sink;sink = <span class="keyword">new</span> File(<span class="stringliteral">&quot;c:\\miscell\\dummy.txt&quot;</span>);</div><div class="line">sink.open(<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"></div><div class="line">var count;</div><div class="line">count = app.qatest(<span class="stringliteral">&quot;CountPlugins&quot;</span>);</div><div class="line"></div><div class="line">var name;</div><div class="line">var sIndex;</div><div class="line">var n;</div><div class="line"><span class="keywordflow">for</span> (n = 0; n &lt; count; n++) {</div><div class="line"> sIndex = String(n);</div><div class="line"><span class="keywordflow">if</span> (app.qatest(<span class="stringliteral">&quot;IsLoadedNthPlugin&quot;</span>, sIndex) == <span class="stringliteral">&quot;True&quot;</span>) {</div><div class="line"> name = app.qatest(<span class="stringliteral">&quot;NameNthPlugin&quot;</span>, sIndex);</div><div class="line"> sink.writeln(name);</div><div class="line"> }</div><div class="line">}</div><div class="line">sink.close();</div></div><p>Accessing the pluginswithui, modelpluginswithui, and uipluginswithmodel properties:<div class="fragment"><div class="line"><span class="comment">// NOTE: these are available in the debug build of InDesign Server only!</span></div><div class="line">ids_pluginswithui = app.pluginswithui;</div><div class="line">ids_modelpluginswithui = app.modelpluginswithui;</div><div class="line">ids_uiplugingswithmodel = app.uipluginswithmodel;</div><div class="line"></div><div class="line"><span class="comment">// report properties to a dump file </span></div><div class="line"><span class="comment">// NOTE: This puts a file in the same folder as the InDesignServer program.</span></div><div class="line">dumpfile = <span class="keyword">new</span> File(<span class="stringliteral">&quot;dumpfile.txt&quot;</span>);</div><div class="line">dumpfile.open(<span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// report plugins with ui</span></div><div class="line"><span class="keywordflow">if</span> (ids_pluginswithui.length == 0) {</div><div class="line"> dumpfile.writeln(<span class="stringliteral">&quot;there are no plugins with ui.&quot;</span>);</div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line"><span class="keywordflow">for</span> (i = 0 ; i &lt; ids_pluginswithui.length ; i++) {</div><div class="line"> dumpfile.writeln(<span class="stringliteral">&quot;pluginswithui: &quot;</span> + ids_pluginswithui[i]);</div><div class="line"> }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// report model plugins with ui</span></div><div class="line"><span class="keywordflow">if</span> (ids_modelpluginswithui.length == 0) {</div><div class="line"> dumpfile.writeln(<span class="stringliteral">&quot;there are no model plugins with ui.&quot;</span>);</div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line"><span class="keywordflow">for</span> (i = 0 ; i &lt; ids_modelpluginswithui.length ; i++) {</div><div class="line"> dumpfile.writeln(<span class="stringliteral">&quot;modelpluginswithui: &quot;</span> + ids_modelpluginswithui[i]);</div><div class="line"> }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// report ui plugins with model</span></div><div class="line"><span class="keywordflow">if</span> (ids_uiplugingswithmodel.length == 0) { </div><div class="line"> dumpfile.writeln(<span class="stringliteral">&quot;there are no ui plugins with model.&quot;</span>);</div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line"><span class="keywordflow">for</span> (i = 0 ; i &lt; ids_uiplugingswithmodel.length ; i++) {</div><div class="line"> dumpfile.writeln(<span class="stringliteral">&quot;uipluginswithmodel: &quot;</span> + ids_uiplugingswithmodel[i]);</div><div class="line"> }</div><div class="line">}</div><div class="line">dumpfile.close();</div></div><h1><a class="anchor" id="id_feature_development_with_scripting"></a> ExtendScript</h1><p>InDesign supports JavaScript for cross-platform development. Adobe&#39;s implementation of JavaScript is called ExtendScript. JavaScript&#39;s cross-platform nature makes it more useful for feature development than the platform-specific scripting languages AppleScript and VBScript. You can use these languages when developing a feature, but you&#39;d then have to write platform-specific versions of your scripts.<p>Scripting can be used to automate InDesign features and there is an active community of InDesign scripters.<h2><a class="anchor" id="id_scripting_"></a> Scripting</h2><p>A feature developed with ExtendScript can take advantage of the following capabilities and related technologies:<ul><li>Menu/action scripting - The InDesign scripting DOM provides access to the menu and action system. These are used to add menus and associated actions to InDesign.<li>ScriptUI - ScriptUI provides a mechanism to create user interfaces using ExtendScript.<li>Script events - Script events provide a way for script code to watch for changes in the application. For example, you can observe changes in selection and in attributes of selected objects. This makes it possible to create scripts that respond in real-time to changes.<li>Custom script events - InDesign provides a fixed set of events, but it is possible that you might want to observe some change that is not covered by the standard set of events. InDesign makes it possible to add custom events with a relatively simple C++ plug-in. This allows you to provide the majority of your solution in scripting, even if the necessary events are not provided.<li>Idle tasks - It is sometimes desirable to postpone certain operations until the application is idle. In the plug-in world, this is known as an idle task. InDesign provides the ability to implement idle tasks using scripting and attachable events.</ul><h2><a class="anchor" id="id_scripting_versus_cpp"></a> Scripting versus C++</h2><p>The capabilities provided by some of the SDK samples can be implemented with a script instead of a plug-in. For example, WriteFishPrice inserts tab-delimited text inside a text frame, but this can be achieved more easily with a script that targets the current text selection. The TableBasics plug-in inserts a table in a text frame, which can also be done easily via scripting. BasicTextAdornment, however, adds a new character-text attribute (<a class="el" href="classk_bsc_t_a_attr_boss.html">kBscTAAttrBoss</a>) to the InDesign object model and it is not possible to implement such a feature using scripting.<p>Scripting is commonly used for controlling existing features. The C++ SDK, on the other hand, is most commonly used for introducing features that can add to the InDesign data model, such as a new text attribute or a page-item adornment.<p>Scripting is far easier to understand and use than the C++ SDK. By using scripting, you can leverage well-designed APIs that are thoroughly tested in several InDesign code paths. Also, the scripting DOM is versioned, so a script written in one version usually is forward compatible in future releases and can be used without a major porting effort.<p>The advantages of developing features with scripting are as follows:<ul><li>Reduced development effort.<li>Easier to debug and test.<li>Cross-platform solution (one run-time environment targeting different platforms).<li>Lower deployment cost.<li>Higher reliability, as the scripting DOM is well tested.</ul><p>The disadvantages of scripting-based solutions are as follows:<ul><li>It requires all features that it uses to be exposed to the scripting.<li>Executing a script typically is slower than executing C++ code.<li>Options for adding data to a document are limited to adding data to the script labels feature.<li>Selection Suites are a C++-based solution. Script-based UI code will have to discover the selection.</ul><h2><a class="anchor" id="id_extendscript_building_blocks_for_implementing_a_feature"></a> ExtendScript Building blocks for implementing a feature</h2><h3><a class="anchor" id="id_scripts_folder"></a> Scripts folder</h3><p>There are two scripts folders where the user can install scripts, so InDesign recognizes them as the scripts that you want to run with InDesign:<ul><li>The user&#39;s preferences folder. On Windows&reg;, this is C:\Users\&lt;user&gt;\AppData\Roaming\Adobe\InDesign\Version ..\&lt;locale&gt;\Scripts On Mac OS &reg;, this is /Users/&lt;username&gt;/Library/Preferences/Adobe InDesign/Version ../&lt;locale&gt;/Scripts<li>The application&#39;s scripts folder. On Windows or Mac OS, this is &lt;InDesignInstallFolder&gt;/Scripts/</ul><p>Having these two folders allows an administrator to install system-wide scripts and allows individual users, who might not have write access to the application folder, to install user-specific scripts.<p>Inside the default Scripts folder in the application folder, there are folders called Scripts Panel, XML Rules, and so on. Scripts inside the Scripts Panel folder are displayed in InDesign&#39;s Scripts Panel, so users can run them from the InDesign user interface. If you ever see .jsxbin files, they are compiled JavaScript/ExtendScript. They are in binary format so the source code is not exposed, which serves several purposes:<ul><li>Source code can be protected.<li>Scripts will not be modified accidentally, which could cause features to behave incorrectly.</ul><p>Any script located inside a folder named startup scripts that is under the application-specific or user-specific Scripts folder is executed when InDesign launches.<dl class="section note"><dt>Note<dd>If a script inside the startup scripts folder is in binary format, it cannot use the #targetengine directive as discussed in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_extendscript_engines">ExtendScript engines</a>.</dl><p>If you are developing features using scripting, we encourage you to create a folder inside the Scripts folder and/or use the startup scripts folder to store files that you need to use at startup. Because a script in binary format cannot use the #targetengine directive, if you want to target a specific engine during startup, you need to make that script an uncompiled one.<h3><a class="anchor" id="id_extendscript_engines"></a> ExtendScript engines</h3><p>InDesign has two types of ExtendScript engines. Each type of engine supports the same scripting DOM and other capabilities:<ul><li>The default engine, named &quot;main,&quot; is created automatically and is reset after each time it executes a script.<li>Persistent session engines, which exist until the application quits and are not reset, may be created at any time by running a script with a #targetengine directive. The engine will have whatever name is specified in the #targetengine directive. It retains objects and properties between scripts. This is important for scripts attached as function call-backs, such as event handlers, which must remain active after they are attached. It also is a requirement for scripts that display floating script user-interface panels, which may float around indefinitely during an entire user session. The engine is visible to the debugger.</ul><p>To target a specific engine, use the #targetengine directive at the beginning of your script. For example, the following code executes the script in an engine named &quot;mySession&quot;:<div class="fragment"><div class="line">\#targetengine <span class="stringliteral">&quot;mySession&quot;</span></div></div><dl class="section note"><dt>Note<dd>You may use &quot;\#targetengine main&quot; to target the main engine; however, typically you do not need to do so, because scripts are run in the main engine by default.</dl><p>If a targetengine directive specifies an engine name that InDesign does not recognize, InDesign automatically creates a persistent engine with that name. This feature prevents conflicts caused by other scripts changing objects/values your script uses. To specify your own script engine, simply put &quot;\#targetengine &lt;your engine name&gt;&quot; at the top of your script.<p>You also can create an ExtendScript engine via the C++ API (see the <a class="el" href="class_i_extend_script_utils.html">IExtendScriptUtils</a> interface). There are three customizable options: engine name, whether the engine is reset after every script, and whether the engine is visible to the debugger.<h3><a class="anchor" id="id_loading_external_scripts"></a> Loading external scripts</h3><p>As discussed in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_scripts_folder">Scripts folder</a>, Export As XHTML creates its own script folder under InDesign&#39;s main Scripts folder, to organize its scripting files. There are two major reasons why breaking your scripts up like this is a good idea:<ul><li>Model/user-interface separation - See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_model_user_interface_separation">Model/user-interface separation</a>.<li>Loading of localization scripts - See <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_localization">Localization</a>.</ul><p>ExtendScript has an #include feature that you can use to include an external JavaScript file, so the functions in the include file are available for the current script to use; however, you cannot use it to load a compiled binary script. If you want to distribute your JavaScript feature in binary format, you cannot use #include to load an external JavaScript file.<p>The recommended approach to loading (and executing) an external script is calling app.doScript().<h3><a class="anchor" id="id_using_a_startup_script_to_install_a_menu_when_indesign_launches"></a> Using a startup script to install a menu when InDesign launches</h3><p>InDesign provides the ability to create new menu items and manipulate application-defined menu items via scripting. A menu in InDesign has a two-layer architecture, separating the underlying action and the displayed menu item. When a menu is invoked, the underlying action is executed. An action is an internal object that invokes a command or event. An action is not necessarily associated with a menu item. The scripting DOM mirrors the internal design; through scripting, you can access menus, menu items, and the underlying actions. You also can add or delete menus and menu items. A new menu item can be associated with an existing, application-defined action or a new, script-defined action. The behavior of a script-defined action is implemented via an attached script. Scripts also can be attached to execute before or after an action is invoked and before a menu or menu item is displayed.<dl class="section note"><dt>Note<dd>A script registered before an action can cancel the action&#39;s default behavior.</dl><p>Although you can dynamically install a menu at run time, in most cases, menus/actions are created at startup.<p>Just like the C++ plug-in&#39;s typical action-component implementation, scripting allows you to listen to menu-action events in various stages when an action is invoked. An action object&#39;s addEventListener method is used to install the event and handler for the action.<h3><a class="anchor" id="id_localization"></a> Localization</h3><p>To support scripting features in different InDesign locales, you must localize your user interface and even your feature. Specializing your feature to meet different locales&#39; needs is beyond the scope of this article. In this section, we discuss how you can handle string localization through the InDesign scripting DOM and ExtendScript&#39;s localization objects.<p><b>Access to InDesign internal string tables</b><p>InDesign provides access to internal string-translation tables via the scripting DOM.<p><b>Format of key strings</b><p>To access internal string tables from the scripting DOM, key strings must be modified to include the prefix &quot;$ID/.&quot; For example, if the key string appears as &quot;my internal key string&quot; in the internal string-translation tables, for scripting you would use &quot;$ID/my internal key string.&quot;<p><b>Accessing key strings</b><p>If you have a translated string that is included in the internal InDesign string-translation tables for the current locale, you can access the associated key string(s) via the &quot;find key strings&quot; method on the application object. The return value is an array of strings, since there may be zero, one, or more keys that translate to the desired string. The following shows sample uses.<div class="fragment"><div class="line">var keys = app.findKeyStrings( <span class="stringliteral">&quot;Black&quot;</span> ) ; <span class="comment">//Returns: $ID/Black</span></div><div class="line">var keys = app.findKeyStrings( <span class="stringliteral">&quot;Scripts&quot;</span> ) ; <span class="comment">//Returns: $ID/Script_Tree,$ID/Script_PanelName,$ID/KBSCE Scripts menu,$ID/Scripts,$ID/ScriptsFolder</span></div><div class="line">var keys = app.findKeyStrings( <span class="stringliteral">&quot;None existing string&quot;</span> ) ; <span class="comment">//Returns: empty array</span></div></div><p><b>Accessing translations</b><p>After you have a key string that is included in the internal InDesign string-translation tables, you can access the associated translation for the current locale by passing the key string in place of any other string, as you normally would do in the scripting DOM. Note, however, that for the translation to happen, the string must pass through the scripting-language client code inside InDesign. The following example shows how to access translated strings. The last alert in the example will not show the translated string, because the alert string is not passed through InDesign.<div class="fragment"><div class="line">alert( app.colors.add({name:<span class="stringliteral">&quot;$ID/OutOfRangeError&quot;</span>}).name ) ; <span class="comment">//Alert &quot;Data is out of range.&quot; since a color is created with the translated string</span></div><div class="line">alert( app.colors.add({name:<span class="stringliteral">&quot;OutOfRangeError&quot;</span>}).name ) ; <span class="comment">//Alert &quot;OutOfRangeError&quot; since a color is created with the un-prefixed ($ID) string</span></div><div class="line">alert( app.paragraphStyles.add({name:<span class="stringliteral">&quot;$ID/None existing string&quot;</span>}).name ) ; <span class="comment">//Assert &quot;No translation of key &#39;None existing string&#39; to English string&quot;, then alert &quot;None existing string&quot; since a paragraph style is created with the un-translated, un-prefixed string</span></div><div class="line">alert( <span class="stringliteral">&quot;$ID/OutOfRangeError&quot;</span> ) ; <span class="comment">//Alert &quot;$ID/OutOfRangeError&quot; since the alert() method is handled by the ExtendScript engine, not InDesign&#39;s scripting architecture</span></div></div><p>The scripting API translateKeyString() of the application object also allows you to access an existing user-interface string by name in a locale-independent manner. For example:<div class="fragment"><div class="line">alert( app.translateKeyString( <span class="stringliteral">&quot;$ID/OutOfRangeError&quot;</span> ) ) ; <span class="comment">//Alert &quot;Date is out of range.&quot;</span></div></div><p><b>ExtendScript localization objects</b><p>In addition to providing access to InDesign&#39;s internal string-translation table, ExtendScript supports localization objects. Localization objects essentially are an array of strings mapped to different locales. In the following example, all localized strings are stored in the array variable CANCEL. When it is time to use the variable, localize() is used to make sure the proper localized string is put into the variables, based on the current locale of the host environment.<div class="fragment"><div class="line">var CANCEL = { en: <span class="stringliteral">&#39;Cancel&#39;</span>, de: <span class="stringliteral">&#39;Abbrechen&#39;</span> };</div><div class="line">var s = localize(CANCEL);</div></div><p>ExtendScript stores the current locale in the $.locale variable. This variable is updated whenever the locale of the hosting application changes. The example checks whether the current locale is English; if not, it tries to load the localized strings list in the Resources folder. It uses the technique discussed in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_loading_external_scripts">Loading external scripts</a> to load the script and make all strings in the localized resource file available to the current function.<h3><a class="anchor" id="id_setting_up_scripting_preferences"></a> Setting up scripting preferences</h3><p>For many things in InDesign, you must temporarily change some preferences to achieve what you want. For example, to read the coordinates of a page item in a specific measurement unit, you must switch the view preferences. You may want to restore the preferences after you are done with your task.<h3><a class="anchor" id="id_storing_persistent_data"></a> Storing persistent data</h3><p>JavaScript has built-in features for storing and retrieving data; that is, the tosource() and eval() functions. tosource() is a method for all built-in objects that returns a string representing the source of the object. eval() evaluates a string of JavaScript code. The following example shows how tosource()/eval() is used typically:<div class="fragment"><div class="line">var obj = { prop: <span class="stringliteral">&quot;value&quot;</span> };</div><div class="line">var storedObj = obj.toSource();</div><div class="line"><span class="comment">// storedObj -&gt; &quot;({prop:&quot;value&quot;})&quot;</span></div><div class="line">var clone = eval(storedObj);</div><div class="line"><span class="comment">// clone.prop -&gt; &quot;value&quot;</span></div></div><p>There is one major security concern with using the technique in this example: you end up saving a script in your document that you later load and execute. It would be possible to create a virus script that would procreate whenever you export as XHTML. To address this potential security risk, Export As XHTML uses E4X to save its data in XML format, then a string representation of the XML data is stored as a label (XHTMLExportOptions) in the document.<p>InDesign supports adding script labels to objects within a document. Each label essentially is a key-value pair.<p>According to Wikipedia, &quot;ECMAScript for XML (E4X) is a programming language extension that adds native XML support to ECMAScript (ActionScript&amp;#8482;, DMDScript, E4X, JavaScript, JScript)&quot;. For more information about E4X, see <a href="http://www.ecma-international.org/publications/standards/Ecma-357.htm">http://www.ecma-international.org/publications/standards/Ecma-357.htm </a> . ExtendScript supports a subset of E4X.<p>To use E4X to store your object:<ol type="1"><li>Create an XML class object that represents your DOM. For Export As XHTML, data is represented by the XHTMLExportOptions object. SOS.serialize() in SimpleObjectStore.jsx instantiates a new XML object, then it iterates through all properties in XHTMLExportOptions and stores the properties as elements and attributes in the XML object.<li>Serialize the XML object; that is, create a string representation of the XML. After you have an XML object, you can call the toXMLString() method of the XML object to serialize the XML object.<li>Save the serialized string as a label in the document. Use app.activeDocument.insertLabel() to insert a label that contains the serialized XML data in the current active document.</ol><p>To use E4X to retrieve an object saved in a document:<ol type="1"><li>Extract the serialized XML data from the saved label in the current document, using app.activeDocument.extractLabel().<li>Deserialize the saved label. Use the label extracted from the previous step to construct a new XML object.<li>Restore the properties of the object that represents your saved data from the XML object created in the previous step. For example, SOS.serialize() in SimpleObjectStore.jsx uses XHTMLExportOptions&#39;s property name as the corresponding XML attribute&#39;s name, so in SOS.deserialize(), it simply uses the same name to search the XML object for an attribute tag that matches the property name, then it restores the property value with the found attribute value.</ol><p>For implementation details, see the Export as XHTML source code.<h3><a class="anchor" id="id_user_interface"></a> User interface</h3><p>InDesign integrates the ExtendScript user-interface library, called ScriptUI, which also is supported in other Adobe applications. ScriptUI enables the creation of dialogs and floating panels that are children of InDesign application windows. It supports most standard, platform-widget types. Windows created with ScriptUI are not native InDesign user interface, because they do not contain native InDesign user-interface widgets; they use platform user-interface widgets. However, they interact with other InDesign windows as if they were owned by the application. Widgets interact with each other and with the InDesign scripting DOM via scripts attached as event handlers. Dialog widgets can be laid out using a string-based resource and/or dynamically created at run-time via scripting.<dl class="section note"><dt>Note<dd>The Dialog object in the scripting DOM uses the native InDesign user interface.</dl><p>There are other user-interface elements that you might want to implement; for example, a progress bar for long operations. The Scripting Guide has a progress-bar sample using ScriptUI technology.<h3><a class="anchor" id="id_responding_to_events"></a> Responding to events</h3><p>It is possible to automatically trigger scripts or script functions when certain changes are made to the application or to a document. This mechanism is similar to the responder pattern used in the InDesign C++ SDK. The scripting DOM for InDesign event handling is based on the W3C DOM for Level 2 Events Specification. A script can be attached as an external file or in JavaScript as a function callback. A script attached to a document event like open is triggered by user actions or a script.<p>Scripts can add and remove event listeners by calling the addEventListener and removeEventListener scripting methods. These methods are supported on a number of objects, but most commonly will be called on the application or document objects. Because events are not persistent, events need to be registered each time the feature is added or enabled. This commonly is done with a startup script or in response to a menu item or action.<p>One very relevant use of event listeners comes in implementing panels. A panel needs to respond to changes in the model (document and application persistent data) and selection. For example, the stroke weight panel displays a different value based on what&#39;s selected. It also updates any time the stroke weight of the selected item is changed. This can happen via a UI operation, script, or plug-in code.<p>To listen for events, a panel implementation should use event listeners. The following example demonstrates the code that would be used to add and remove event listener functions. It would be desirable for an implementation to call addMyEventListeners when the panel is activated, and removeMyEventListeners when the panel is closed. This results in the onSelChg and OnSelAttrChg implementations being called when the selection changes or a property of the selection changes. These two methods would then need to contain panel-specific code to deal with changes in the selection.<div class="fragment"><div class="line"><span class="preprocessor">#targetengine &quot;session&quot;</span></div><div class="line"><span class="preprocessor"></span><span class="comment">// Add Selection Events</span></div><div class="line"><span class="keyword">function</span> addMyEventListners(){</div><div class="line"> app.addEventListener(<span class="stringliteral">&quot;afterSelectionChanged&quot;</span>, onSelChg, <span class="keyword">false</span> );</div><div class="line"> app.addEventListener(<span class="stringliteral">&quot;afterSelectionAttributeChanged&quot;</span>, onSelAttrChg, <span class="keyword">false</span> );</div><div class="line">}</div><div class="line"><span class="keyword">function</span> removeMyEventListerns(){</div><div class="line"> app.removeEventListener(<span class="stringliteral">&quot;afterSelectionChanged&quot;</span>, onSelChg, <span class="keyword">false</span>);</div><div class="line"> app.removeEventListener(<span class="stringliteral">&quot;afterSelectionAttributeChanged&quot;</span>, onSelAttrChg,<span class="keyword">false</span>);</div><div class="line">}</div><div class="line"><span class="comment">// The Selection Changed</span></div><div class="line"><span class="keyword">function</span> onSelChg (myEvent){</div><div class="line"><span class="comment">//... Respond to the change in the seleciton</span></div><div class="line">}</div><div class="line"><span class="comment">// Some attribute (or property) of the selected object or objects changed.</span></div><div class="line"><span class="keyword">function</span> onSelAttrChg(myEvent){</div><div class="line"><span class="comment">//... Respond to a possible change in the selected object</span></div><div class="line">}</div></div><dl class="section note"><dt>Note<dd>Scripts that use handler functions (script files) must use #targetengine &quot;session&quot;. If the script is run using #targetengine &quot;main&quot; (the default), the function will not be available when the event occurs, and the script will generate an error.</dl><p>Events are covered in more detail in the &quot;Events&quot; chapter in Adobe InDesign Scripting Guide.<h3><a class="anchor" id="id_model_user_interface_separation"></a> Model/user-interface separation</h3><p>Separating the user interface and the model can make your scripting plug-in functionality available on InDesign Server, just like a C++ plug-in. ExtendScript supports an #include statement that can be used to split a function among multiple JavaScript source files. The #include statement is very useful for structuring source code (for example, model/view separation and having all strings in one file for easy localization). The #include statement also provides an easy way to reuse code.<h3><a class="anchor" id="id_script_optimization"></a> Script optimization</h3><p>The ExtendScript Toolkit has a built-in profiling capability through the IDE&#39;s Profile menu. It is useful for tightening loops and spotting CPU-intensive code lines. Once source code is profiled, the ExtendScript Toolkit shows the result in a color-coded bar, which makes it easy to spot bottlenecks in your program. For more information about using the profiling feature of the ExtendScript Toolkit, see JavaScript Tools Guide, which is included with the ExtendScript toolkit.<h3><a class="anchor" id="id_compile_a_script_into_binary_format"></a> Compile a script into binary format</h3><p>To compile a script into binary format, simply open the script in the ExtendScript ToolKit and choose File &gt; Export As Binary.... to save the .jsx script to a file with a .jsxbin extension.<h2><a class="anchor" id="id_tips_and_hints"></a> Tips and hints</h2><p>This section provides script-development tips and tricks that were learned during the development of Export As XHTML.<h3><a class="anchor" id="id_development_techniques"></a> Development techniques</h3><p><b>Use global variables/namespaces</b><p>In the current design, all scripts that install menus need to share the same scripting engine. This means they also share their global variables. Best practice for JavaScript development is to use namespaces to encapsulate global variables and functions.<p><b>Use undefined instead of nil or &quot;&quot;</b><p>When checking missing function parameters, arrays elements, or variables, use undefined, as shown in the following snippet:<div class="fragment"><div class="line">ProgressBar.prototype.newSection = <span class="keyword">function</span>(numSteps, title, fractionOfParentStep){</div><div class="line"><span class="keywordflow">if</span> (fractionOfParentStep == undefined)</div></div><p><b>InDesign errors out when asking for an nonexisting property</b><p>You cannot do the following:<div class="fragment"><div class="line">var footnotes = story.footnotes;</div><div class="line"><span class="keywordflow">if</span> (footnotes != undefined) {</div></div><p>Instead, you need to do this:<div class="fragment"><div class="line"><span class="keywordflow">if</span>( <span class="stringliteral">&#39;footnotes&#39;</span> in story) {</div><div class="line"> footnotes = story.footnotes</div></div><p><b>InDesign&#39;s collection objects are not completely compatible with JavaScript arrays</b><p>InDesign collection objects offer features that JavaScript arrays do not have, such as itemByRange() and nextItem(). If you want to read the items from a collection into an array, use everyItem() or iterate; however, you will lose the capabilities of the collection objects.<p><b>Error handling</b><p>JavaScript&#39;s built-in exception handling, such as try...catch blocks, works very well. For examples of try...catch blocks, see the Export As XHTML source code. For more information on error handling, see Adobe InDesign Scripting Guide.<p><b>Differentiating between InDesign&#39;s feature sets</b><p>Check for app.featureSet. It returns a FeatureSetOptions enum that contains either FeatureSetOptions.roman for the Roman feature set or FeatureSetOptions.japanese for the Japanese feature set.<p><b>DOM versioning</b><p>As discussed in <a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_setting_up_scripting_preferences">Setting up scripting preferences</a>, the DOM version is available from the script-preferences property, app.scriptPreferences.version.<p><b>Persistent data versioning</b><p>You can version your own saved data, but be careful not to confuse your persistent-data version with the DOM version. Versioning your own persistent data makes it easier to maintain compatibility for your feature among different releases. For example, in different versions of your software, you might have saved different sets of data. If you versioned the saved data in your code, you can provide conversion code to deal with compatibility issues.<p><b>Edit-compile-run</b><p><a class="el" href="id_getting_started_with_indesign_plugin_development.html#id_loading_external_scripts">Loading external scripts</a> discusses the benefits of modularizing your scripts and loading the script module as needed dynamically. One benefit of this approach is quick development time. At startup, InDesign loads only the script that installs the menu, and this part of the script probably is easy enough that you do not have to debug it much. For the rest of the scripts, you can always edit and compile, then return to InDesign and execute the already loaded menu, which dynamically loads the newly modified modules so you can check the correctness of the new implementation.<p><b>Debugging modular scripts</b><p>ExtendScript ToolKit&#39;s debugging feature does not work with binary scripts or dynamically loaded scripts. There is no easy way to deal with this limitation. Usually, it is necessary to write test code within a module boundary. Also, the &quot;divide and conquer&quot; technique always is an effective way of debugging; that is, comment out different blocks of code to narrow your investigation until you isolate the problematic code.<p>**Mixing and matching JavaScript and C++ **<p>Sometimes, you may want to use C++. For example, for performance considerations if you are adding a feature that a script cannot achieve, or you simply want to reuse existing features that you implemented in C++. To achieve this, expose your C++ features in the scripting DOM and then call those features from within your script. For information on how to make your C++ plug-in scriptable, see <a class="el" href="id_plug-in_programming_guide_volume_1_fundamentals.html#id_scriptable_plug_in_fundamentals">Scriptable Plug-in Fundamentals</a>.<p>To run a script from C++, use <a class="el" href="class_i_script_utils.html#a350d34e09e1bd21b36135ad99a70f07d">IScriptUtils::DispatchScriptRunner</a>. Alternately, you can use the lower-level APIs as shown in the following snippet to access the <a class="el" href="class_i_script_runner.html#a2be8c5dd8841ac9b5e5b473b70bad394">IScriptRunner::RunFile</a>. (<a class="el" href="class_i_script_runner.html">IScriptRunner</a> is aggregated on <a class="el" href="classk_java_script_mgr_boss.html">kJavaScriptMgrBoss</a>.)<div class="fragment"><div class="line"><span class="comment">// assume scriptFile is an IDFile representing the script file to run</span></div><div class="line"><a class="code" href="class_interface_ptr.html">InterfacePtr&lt;IScriptRunner&gt;</a> scriptRunner(<a class="code" href="class_utils.html">Utils&lt;IScriptUtils&gt;</a>()-&gt;QueryScriptRunner(scriptFile));</div><div class="line"><span class="keywordflow">if</span> (scriptRunner)</div><div class="line">{ </div><div class="line"> ScriptRecordData arguments;</div><div class="line"><a class="code" href="class_script_data.html">ScriptData</a> resultData; <a class="code" href="class_p_m_string.html">PMString</a> errorString;</div><div class="line"><span class="keyword">const</span> bool16 showErrorAlert = kTrue; </div><div class="line"><span class="keyword">const</span> bool16 invokeDebugger = kFalse;</div><div class="line"> scriptRunner-&gt;RunFile(scriptFile, arguments, resultData, errorString,showErrorAlert, invokeDebugger);</div><div class="line">}</div></div><h3><a class="anchor" id="id_performance_techniques"></a> Performance techniques</h3><p><b>Minimize access to InDesign&#39;s DOM</b><p>Querying the InDesign DOM may be the main performance bottleneck for your script. A considerable amount of time typically is spent resolving object references, because InDesign does not hand out pointers to objects but rather uses references that need to be resolved every time they are used. Here are some techniques to alleviate this problem:<ul><li>Reduce the number of calls to the scripting DOM.<li>Store and reuse resolved references in variables wherever possible.<li>Use everyItem() to fetch and cache data of a collection object all at once, instead of querying the properties with separate calls.</ul><p><b>Fast array look-ups with object properties</b><p>JavaScript objects essentially are associative arrays; there is a built-in hashing function for properties on an object. Any JavaScript array can use other objects as keys to look for value. That is, the property:<div class="fragment"><div class="line">myArray.one</div></div><p>is the same as:<div class="fragment"><div class="line">myArray[<span class="stringliteral">&#39;one&#39;</span>]</div></div><p>Combining this capability with the &quot;for (var i in object)&quot; statement, which goes through each element of an associative array, you can write efficient code for fast array look-ups.<p><b>Concatenating large strings is slow</b><p>JavaScript&#39;s String class-concatenation methods, such as += operator, can be very slow, especially with large strings. Try to minimize the number of concatenations and the size of the strings that are be concatenated. One common method to reduce String class overhead is to write your own string-buffer class to gain a performance boost; this uses the Array object&#39;s join method to &quot;concatenate&quot; all the elements of an array into one string.<p><b>Using regular expressions</b><p>JavaScript supports Perl-style regular expressions, which can be very useful for string manipulation such as complex string replacements. </div></div></div><div class="navpath" id="nav-path"><ul><li class="footer">Generated on Sat Sep 22 2018 10:52:52 for InDesign SDK by <a href="http://www.doxygen.org/index.html"> <img alt="doxygen" class="footer" src="doxygen.png" /></a> 1.8.3.1 </ul></div></body></html>

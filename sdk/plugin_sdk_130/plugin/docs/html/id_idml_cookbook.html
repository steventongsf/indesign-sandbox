<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/xhtml;charset=UTF-8" http-equiv="Content-Type" /><meta content="IE=9" http-equiv="X-UA-Compatible" /><meta content="Doxygen 1.8.3.1" name="generator" /><title>id_idml_cookbook</title><link href="tabs.css" rel="stylesheet" type="text/css" /><script src="jquery.js" type="text/javascript"></script><script src="dynsections.js" type="text/javascript"></script><link href="navtree.css" rel="stylesheet" type="text/css" /><script src="resize.js" type="text/javascript"></script><script src="navtree.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(initResizable);

  $(window).load(resizeHeight);

</script><link href="search/search.css" rel="stylesheet" type="text/css" /><script src="search/search.js" type="text/javascript"></script><script type="text/javascript">

  $(document).ready(function() { searchBox.OnSelectItem(0); });

</script><link href="doxygen.css" rel="stylesheet" type="text/css" /></head><body><div id="top"><div id="titlearea"><table cellpadding="0" cellspacing="0"><tbody><tr style="height: 56px;"><td id="projectlogo"><img alt="Logo" src="adobe_logo.png" /></td><td style="padding-left: 0.5em;"><div id="projectname">InDesign SDK &nbsp;<span id="projectnumber">14.0.0</span></div></td></tr></tbody></table></div><script type="text/javascript">

var searchBox = new SearchBox("searchBox", "search",false,'Search');

</script><div class="tabs" id="navrow1"><ul class="tablist"><li><a href="index.html"><span>InDesign&nbsp;SDK</span></a><li class="current"><a href="pages.html"><span>Documentation</span></a><li><a href="group__bosses__parent.html"><span>Bosses</span></a><li><a href="group__sdk.html"><span>Sample&nbsp;plug-ins</span></a><li><a href="classes.html"><span>Class&nbsp;Index</span></a><li><div class="MSearchBoxInactive" id="MSearchBox"><span class="left"> <img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="search/mag_sel.png" /> <input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search" /> </span><span class="right"> <a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="search/close.png" /></a> </span></div></ul></div></div><div class="ui-resizable side-nav-resizable" id="side-nav"><div id="nav-tree"><div id="nav-tree-contents"><div class="sync" id="nav-sync"></div></div></div><div class="ui-resizable-handle" id="splitbar" style="-moz-user-select:none;"></div></div><script type="text/javascript">

$(document).ready(function(){initNavTree('id_idml_cookbook.html','');});

</script><div id="doc-content"><div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()"><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Pages</a></div><div id="MSearchResultsWindow"><iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)"></iframe></div><div class="header"><div class="headertitle"><div class="title">InDesign Markup Language (IDML) Cookbook </div></div></div><div class="contents"><div class="textblock"><h1><a class="anchor" id="id_adobe_indesign_markup_language_idml_cookbook"></a> Adobe InDesign Markup Language (IDML) Cookbook</h1><h2><a class="anchor" id="id_introduction"></a> Introduction</h2><p>IDML is an XML-based format for representing InDesign content. Essentially, it is a major revision of INX, InDesign&#39;s previous XML-based file format. IDML addresses INX shortcomings, in an effort to represent InDesign content in a human-readable format-something that can be reasonably assembled and disassembled by a competent XML programmer.<h3><a class="anchor" id="id_where_is_idml_used_in_the_application"></a> Where is IDML used in the application?</h3><p>IDML syntax is used in several application features: IDML export (*.IDML), asset libraries (*.INDL), snippets (*.INDS), InCopy stories (*.ICML), and Adobe InCopy&reg; assignment files (*.ICMA).<p>IDML files represent complete InDesign documents. Because they are ZIP (or, more accurately, UCF) archives, they commonly are called packages. These packages contain a hierarchy of XML files representing various parts of the InDesign document. An equivalent XML representation is used in single-text-file (non-archive-based) InCopy story files, snippets, and assignments. These are not ZIP files but rather single XML files that contain all elements necessary to reconstruct a particular piece of content.<h3><a class="anchor" id="id_how_can_idml_be_used_outside_of_indesign"></a> How can IDML be used outside of InDesign?</h3><p>IDML was designed to facilitate the inspection and construction of InDesign content outside of InDesign. The SDK provides many examples, written in both Java and ActionScript 3.0/Air, that demonstrate how IDML can be used outside of InDesign. Most of the samples in this SDK focus on Java, but both languages have the capabilities needed to work with IDML files. These languages often achieve the same result using different approaches. The samples provided highlight those differences.<h3><a class="anchor" id="id_what_is_idmltools"></a> What is IDMLTools?</h3><p>IDMLTools is a collection of sample code, tools, and reusable classes written in Java. It contains standalone tools for schema validation, as well as package inspection, compression, and decompression. The IDMLTools sample code demonstrates several operations, including building IDML files from scratch, extracting data, altering content, and adding to existing documents. Most of these samples use XSLT and are built on a more generic set of Java classes.<h3><a class="anchor" id="id_where_is_the_idmltools_sample_code"></a> Where is the IDMLTools sample code?</h3><p>The IDMLTools sample code is part of the InDesign Products SDK. It can be found in the SDK in the following location: &lt;SDK&gt;/devtools/idmltools (or &lt;IDMLTOOLS&gt; for short)<h3><a class="anchor" id="id_what_setup_is_required_for_idmltools"></a> What setup is required for IDMLTools</h3><p>There are two set-up steps for IDMLTools:<ol type="1"><li>Create an environment variable called IDMLTOOLS_HOME that contains the location of your IDMLTools directory.<li>Add &lt;IDMLTOOLS&gt;/bin to your system&#39;s PATH environment variable. This allows you to run IDMLTools programs from any directory.</ol><p>On Windows, environment variables are set in the Systems Properties panel. You can get to System Properties via the Control Panel or by right-clicking &quot;My Computer&quot; and selecting Properties. While in System Properties, select the Advanced tab and click &quot;Environment Variables.&quot;<p>There are several ways to add environment variables on Mac OS. If you are using Bash (the default terminal shell), consider adding them to your shell startup file. Look for a file called ~/.bashrc. (If you do not have such a file, create one.) Then define a variable as follows:<div class="fragment"><div class="line">export IDMLTOOLS_HOME=<span class="stringliteral">&quot;/sdk/devtools/idmltools&quot;</span></div><div class="line">export PATH=<span class="stringliteral">&quot;$PATH:$IDMLTOOLS_HOME/bin&quot;</span></div></div><p>Change the contents above to match the absolute path to your idmltools folder. You also will need to start a new shell before these changes take effect.<h3><a class="anchor" id="id_what_is_in_an_idml_file"></a> What is in an IDML file?</h3><p>Following the time-tested practice of &quot;Hello World&quot; sample programs, it is useful to consider a &quot;Hello World&quot; package. The SDK includes two such packages in the &lt;IDMLTOOLS&gt;/samples/helloworld directory.<ul><li>helloworld-1.idml was created by InDesign.<li>helloworld-2.idml is a very minimal IDML file that was created with a text editor.</ul><p>To view the content of these files, you need to unzip them. If you have set up IDMLTools, you can use the package tool to decompress these files, as follows:<p>Windows:<div class="fragment"><div class="line">package.bat -d helloworld-1.idml helloworld-1</div><div class="line">package.bat -d helloworld-2.idml helloworld-2</div></div><p>Mac OS:<div class="fragment"><div class="line">package.sh -d helloworld-1.idml helloworld-1</div><div class="line">package.sh -d helloworld-2.idml helloworld-2</div></div><p>By design, InDesign&#39;s IDML export (helloworld-1.idml) contains all types of IDML package files, including a file for each story, spread, and master spread. For Helloworld-1, that amounts to the following files, which are explained in IDML File Format Specification.<ul><li>designmap.xml<li>mimetype<li>MasterSpreads\MasterSpread_uc4.xml<li>META-INF\container.xml<li>META-INF\metadata.xml<li>Resources\Fonts.xml<li>Resources\Graphics.xml<li>Resources\Preferences.xml<li>Resources\Styles.xml<li>Spreads\Spread_ubd.xml<li>Stories\Story_ud5.xml<li>XML\BackingStory.xml<li>XML\Tags.xml</ul><p>Within these files, each property is set. The designmap.xml file is over 300 lines long. Each preference, style, and swatch is represented in the files in the Resources folder. This is roughly equivalent to writing a script that sets every property in a blank document, and then creates content, setting every possible property on the new content. This is by design, because it is desirable for documents to be equivalent when opened on machines with different defaults.<p>While IDML export in InDesign is verbose, import is designed to be very flexible. It does not require each attribute to be set; it works on default values for those items that are left out of the file. The helloworld-2.idml file contains only part of the XML files normally found in the package, and a smaller set of elements and attributes. This is roughly equivalent to writing a script that depends on defaults. For example, it takes only a few lines of code to create a document with one page, containing one text frame. Such a script need not be concerned with preferences, styles, and swatches; it can safely assume that application default values are set. This is much more like writing a small script that creates InDesign content.<p>Helloworld-2 is very simple in comparison to Helloworld-1. The designmap.xml file is only a few lines long, consisting of a Document element that includes spread and story files using idPkg:Spread and idPkg:Story elements.<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;utf-8&quot;</span>?&gt;</div><div class="line">&lt;?aid style=<span class="stringliteral">&quot;50&quot;</span> type=<span class="stringliteral">&quot;document&quot;</span> readerVersion=<span class="stringliteral">&quot;6.0&quot;</span> featureSet=<span class="stringliteral">&quot;257&quot;</span>?&gt;</div><div class="line">&lt;Document xmlns:idPkg=<span class="stringliteral">&quot;http://ns.adobe.com/AdobeInDesign/idml/1.0/packaging&quot;</span> DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span> Self=<span class="stringliteral">&quot;d&quot;</span>&gt;</div><div class="line"> &lt;idPkg:Spread src=<span class="stringliteral">&quot;Spreads/Spread_spread1.xml&quot;</span>/&gt;&lt;idPkg:Story src=<span class="stringliteral">&quot;Stories/Story_story1.xml&quot;</span>/&gt;</div><div class="line">&lt;/Document&gt;</div></div><p>The only other meaningful content is in the spread and story files. The story file is almost as simple. Within an idPkg:Story element, there is a Story element; this element provides an ID for the story in the Self attribute. This makes it possible for a text frame to reference this story elsewhere in the package. We will see that in the spread file. The Story element contains the text &quot;Hello World.&quot; This text is formatted with default text attributes.<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;utf-8&quot;</span>?&gt;</div><div class="line">&lt;idPkg:Story xmlns:idPkg=<span class="stringliteral">&quot;http://ns.adobe.com/AdobeInDesign/idml/1.0/packaging&quot;</span> DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span>&gt;</div><div class="line"> &lt;Story Self=<span class="stringliteral">&quot;story1&quot;</span>&gt;</div><div class="line"> &lt;Content&gt;Hello World!&lt;/Content&gt;</div><div class="line"> &lt;/Story&gt;</div><div class="line">&lt;/idPkg:Story&gt;</div></div><p>The spread file also is simple, but it requires a little more explanation. First, examine the code:<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;utf-8&quot;</span>?&gt;</div><div class="line">&lt;idPkg:Spread xmlns:idPkg=<span class="stringliteral">&quot;http://ns.adobe.com/AdobeInDesign/idml/1.0/packaging&quot;</span> DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span>&gt;</div><div class="line"> &lt;Spread Self=<span class="stringliteral">&quot;spread_1&quot;</span> PageCount=<span class="stringliteral">&quot;1&quot;</span>&gt;</div><div class="line"> &lt;TextFrame Self=<span class="stringliteral">&quot;textframe1&quot;</span> ParentStory=<span class="stringliteral">&quot;story1&quot;</span> ContentType=<span class="stringliteral">&quot;TextType&quot;</span> ItemTransform=<span class="stringliteral">&quot;1 0 0 1 -612 -396&quot;</span>&gt;</div><div class="line"> &lt;Properties&gt;</div><div class="line"> &lt;PathGeometry&gt;</div><div class="line"> &lt;GeometryPath PathOpen=<span class="stringliteral">&quot;false&quot;</span>&gt;</div><div class="line"> &lt;PathPointArray&gt;</div><div class="line"> &lt;PathPoint Anchor=<span class="stringliteral">&quot;36 36&quot;</span> LeftDirection=<span class="stringliteral">&quot;36 36&quot;</span> RightDirection=<span class="stringliteral">&quot;36 36&quot;</span>/&gt;</div><div class="line"> &lt;PathPoint Anchor=<span class="stringliteral">&quot;36 186&quot;</span> LeftDirection=<span class="stringliteral">&quot;36 186&quot;</span> RightDirection=<span class="stringliteral">&quot;36 186&quot;</span>/&gt;</div><div class="line"> &lt;PathPoint Anchor=<span class="stringliteral">&quot;172 186&quot;</span> LeftDirection=<span class="stringliteral">&quot;172 186&quot;</span> RightDirection=<span class="stringliteral">&quot;172 186&quot;</span>/&gt;</div><div class="line"> &lt;PathPoint Anchor=<span class="stringliteral">&quot;172 36&quot;</span> LeftDirection=<span class="stringliteral">&quot;172 36&quot;</span> RightDirection=<span class="stringliteral">&quot;172 36&quot;</span>/&gt;</div><div class="line"> &lt;/PathPointArray&gt;</div><div class="line"> &lt;/GeometryPath&gt;</div><div class="line"> &lt;/PathGeometry&gt;</div><div class="line"> &lt;/Properties&gt;</div><div class="line"> &lt;/TextFrame&gt;</div><div class="line"> &lt;/Spread&gt;</div><div class="line">&lt;/idPkg:Spread&gt;</div></div><p>Like the story file, the spread file&#39;s document element is in the idPkg namespace. The actual Spread element is given a unique ID in the Self attribute. The PageCount attribute controls how many pages appear in this spread. Without this attribute, the default number of pages would be used. The ItemTransform for the spread is significant. As you deal with files containing multiple spreads, you will see that each spread is translated vertically down the pasteboard; for example, the spreads in any IDML document. The pagebuilder sample also generates such a document from a template.<p>Within the spread, there is one text-frame element. This frame identifies itself with the story whose Self ID is &quot;story1,&quot; using the ParentStory attribute. If you look back at the story file, notice that this is the ID of the story defined above. The TextFrame also has its own ItemTransform. If this were set to a special matrix called the identity matrix (&quot;1 0 0 1 0 0&quot;), the origin would be placed at t he center of the spread binding. The ItemTransform in this TextFrame translates the origin back to the upper left-hand corner of the page. Because the page is 612 points wide by 792 points tall, the origin is moved back from the binding (which by default is on the right of the page) by 612 points, and up half the height of the page (396 points). The page-builder sample demonstrates how to do this with multipage spreads, with the binding in various locations.<p>The PathPoint array specifies the location of the TextFrame. IDML File Format Specification provides information on these elements.<h3><a class="anchor" id="id_where_are_the_idml_defaults_and_how_do_they_work"></a> Where are the IDML defaults, and how do they work?</h3><p>It would not be desirable for IDML files to truly work like small scripts that depend on application default values, as that would mean documents would be rendered differently on machines with different application defaults. To prevent that from happening, IDML maintains a set of static defaults in the following file:<div class="fragment"><div class="line">&lt;InDesign&gt;/Presets/Default/Predef.iddx</div></div><p>This file always is imported just before any IDML file, guaranteeing consistent defaults. The values are similar to what you would get if you created an empty InDesign document just after installing the application.<p>By design, the Predef.iddx file is not extensible, and it should not be changed. It is a static file, meaning it is not recreated based on your plug-in configuration. Furthermore, you cannot reference items in Predef.iddx in your IDML by InDesign.<h3><a class="anchor" id="id_what_is_in_an_idms_file"></a> What is in an IDMS file?</h3><p>IDMS is the new extension for IDML-based snippets. A snippet is a single XML file describing a subset of the content within an InDesign document. IDML-based snippets are single files (not packages) that describe content using IDML. For detailed information about snippets, read the &quot;Snippet Fundamentals&quot; chapter of the Adobe InDesign Programming Guide.<p>The best way to understand what&#39;s in a snippet is to generate several page items and export them as InDesign Snippets. In short, a snippet contains all objects and properties necessary to reconstruct a given set of objects in a new document. The application determines these dependencies and adds to the export. You&#39;ll notice that a snippet is very verbose, and resembles something closer to a full IDML export. Like the package import, it is possible for you to provide simplified files; however, make sure all dependencies are provided within the snippet.<h3><a class="anchor" id="id_what_is_in_an_icml_file"></a> What is in an ICML file?</h3><p>ICML is the new extension for IDML-based InCopy snippets. These special snippets contain the properties and objects necessary to reconstruct an InCopy story.<h3><a class="anchor" id="id_what_is_in_an_icma_file"></a> What is in an ICMA file?</h3><p>ICMA is the new extension for IDML-based InCopy assignment files.<h3><a class="anchor" id="id_is_idml_a_closed_file_format"></a> Is IDML a closed file format?</h3><p>No, IDML is an open file format. As described in the IDML Language Specification, it is based on scripting. Any plug-in can extend the scripting model and, in doing so, extend IDML. Roughly speaking, scripting objects become elements, and scripting properties become either attributes or child elements. There are exceptions, and this is discussed in more detail in the Language Specification.<p>Element and attribute names are equivalent to the JavaScript representation. For example, the Frame Label SDK sample adds properties to page items. This amounts to adding the following attributes to all page item elements. These particular values were added to a TextFrame element and correspond to what was set in the UI:<div class="fragment"><div class="line">FramelabelString=<span class="stringliteral">&quot;My Frame Label&quot;</span> FramelabelSize=<span class="stringliteral">&quot;12&quot;</span> FramelabelVisibility=<span class="stringliteral">&quot;true&quot;</span> FramelabelPosition=<span class="stringliteral">&quot;FrameLabelBottom&quot;</span></div></div><h3><a class="anchor" id="id_is_inx_still_supported"></a> Is INX still supported?</h3><p>INX export has been removed from the product. You can, however, still import INX files.<h2><a class="anchor" id="id_idml_schema_validation"></a> IDML Schema Validation</h2><p>IDML features were designed to support schema validation. The compact form of RELAX NG was selected for its expressiveness, simplicity, and readability. For background on RELAX NG, read RELAX NG by Eric van der Vlist (O&#39;Reilly Media, Inc., 2003).<p>InDesign&#39;s IDML support is built on the scripting model and can be extended by third-party plug-ins. This means that IDML cannot be described with a single, static schema. Instead, schemas must be generated to match a particular plug-in configuration. To support this, InDesign provides a means to generate schemas at runtime.<h3><a class="anchor" id="id_how_do_i_generate_a_schema"></a> How do I generate a schema?</h3><p>Solution: Use the GeneratePackageSchema.jsx and GenerateSchema.jsx scripts in the &lt;IDMLTOOLS&gt;/scripts directory.<p>There are two types of schemas: one used for IDML packages; the other, for the consolidated nonpackage files. The app.generateIDMLSchema (JavaScript) event writes either of these schema types to disk. It has two parameters:<ul><li>The destination directory for the schema.<li>A Boolean value that controls whether a package or nonpackage schema is generated.</ul><p>For example, the following JavaScript generates the package schema:<div class="fragment"><div class="line">app.generateIDMLSchema(Folder(<span class="stringliteral">&quot;/idml-schema/package&quot;</span>), <span class="keyword">true</span>);</div></div><p>And the following generates the nonpackage schema:<div class="fragment"><div class="line">app.generateIDMLSchema(Folder(<span class="stringliteral">&quot;/idml-schema/single&quot;</span>), <span class="keyword">false</span>);</div></div><p>Both schema types contain a common file, called datatype.rnc. This file is equivalent in both schemas and specifies common data types.<p>A nonpackage schema comprises two files: the datatype.rnc XML file and the IDMarkupLanguage.rnc schema file. The datatype.rnc file is included by IDMarkupLanguage.rnc.<p>The package schema comprises a collection of the following schemas. There are corresponding schema files for each XML file within an IDML package:<ul><li>datatype.rnc<li>designmap.rnc<li>MasterSpreads\MasterSpread.rnc<li>Resources\Fonts.rnc<li>Resources\Graphic.rnc<li>Resources\Preferences.rnc<li>Resources\Styles.rnc<li>Spreads\Spread.rnc<li>Stories\Story.rnc<li>XML\BackingStory.rnc<li>XML\Mapping.rnc<li>XML\Tags.rnc</ul><p>In most cases, there is a one-to-one correspondence between schema and package XML files. For example, designmap.rnc describes what is legal or valid in a designmap.xml file. A package can contain many story, spread, and masterspread XML files of various names. The Story.rnc, Spread.rnc, and MasterSpread.rnc files describe what is valid in those files.<h3><a class="anchor" id="id_how_do_i_validate_an_idml_file"></a> How do I validate an IDML file?</h3><dl class="section note"><dt>Note<dd>The SDK does not provide a sample of validating an IDML file using Actionscript/Air.</dl><p>Solution: Use the validation tool provided in IDMLTools:<ol type="1"><li>Set up IDMLTools, as described in the IDMLTools ReadMe file.<li>Create both versions of the schema, as discussed in &quot;How do I generate a schema?&quot;.<li>Call the appropriate platform validation script in &lt;IDMLTOOLS&gt;/bin.</ol><p>IDMLTools contains a Jing-based validation tool. Jing is a Java-based, open-source, schema-validation package that supports the compact form of RELAX NG. The IDMLTools validation tool is implemented in the com.adobe.idml.Validator class. It can be used from Java or executed from the command line.<p>Validating a nonpackage IDML file is technically very simple: it amounts to running the validation on a single XML file. That is simple to do with Jing alone. The real benefit of using the Validator class comes when dealing with packages. The validation tool automatically decompresses the files to a temporary directory and calls validation on each package file. It also contains additional validations that cannot be expressed in Relax NG; for example, it checks that all referenced package files exist.<p>Platform shell scripts (validate.bat for Windows and validate.sh for Mac OS) set the class path and execute the Validator class. These scripts are in the following location:<div class="fragment"><div class="line">&lt;IDMLTOOLS&gt;/bin</div></div><p>Tip: To facilitate validation, add this to your PATH environment variable and run validation from any directory. This is why all scripts are structured to use the IDMLTOOLS_HOME environment variable.<p>To validate a package or nonpackage file, run the validate script with two arguments. The first argument is the location of the schema; the second, the location of the file to validate. The class determines whether it is dealing with a package or nonpackage file and calls Jing to do the actual validation.<p>Windows:<div class="fragment"><div class="line">validate.bat c:\idml-schema\package-schema MyFile.idml</div><div class="line">validate.sh c:\idml-schema\non-package-schema MyStory.icml</div></div><p>Mac OS:<div class="fragment"><div class="line">validate.sh /idml-schema/package-schema/ MyFile.idml</div><div class="line">validate.sh /idml-schema/non-package-schema/ MyStory.icml</div></div><p>For an up-to-date usage message, run the script with the -h option.<h2><a class="anchor" id="id_tools"></a> Tools</h2><h3><a class="anchor" id="id_what_external_tools_does_adobe_recommend_for_working_with_idml"></a> What external tools does Adobe recommend for working with IDML?</h3><p>You will need some type of ZIP software for working with IDML. Commercial ZIP applications like WinZip should work fine. The InDesign Products SDK provides a free Java-based library and application that can be used to compress and decompress IDML packages.<p>When working with IDML, it&#39;s important to have a good XML editor. We found the Oxygen XML Editor to be a particularly effective tool for dealing with IDML. It contains support for the Compact RELAX NG schema and, after associating IDML with the ZIP file type, it allows you to browse IDML packages directly. This ZIP-file support makes it much easier to experiment with IDML. You can browse and change files in the IDML package directly. The archive is updated when the file is saved.<p>There is an open-source plug-in for Eclipse, called the &quot;Eclipse Zip Editor.&quot; This plug-in provides a ZIP-editing experience similar to what is available commercially in Oxygen.<dl class="section note"><dt>Note<dd>The ZIP archive support was added in Oxygen version 9.3. If you purchase Oxygen, it&#39;s a good idea to buy the maintenance pack, as they regularly add new features.</dl><h3><a class="anchor" id="id_what_tools_are_included_in_the_sdk"></a> What tools are included in the SDK?</h3><p>The InDesign Products SDK contains Java-based tools, source code, and samples that will help you work with IDML. This collection of code, known as IDMLTools, is in the following location:<div class="fragment"><div class="line">&lt;SDK&gt;/devtools/idmltools</div></div><p>Before using IDMLTools, complete the following setup steps:<ul><li>Copy IDMLTools to somewhere on your hard drive.<li>Add &lt;IDMLTOOLS&gt;/bin to your PATH environment variable.<li>Add an environment variable called IDMLTOOLS_HOME that contains the path to your installation of IDMLTools.</ul><p>These setup steps are described more thoroughly in the IDMLTools Readme file:<div class="fragment"><div class="line">&lt;IDMLTOOLS&gt;/Readme.txt</div></div><p>Code constructs are described in the JavaDocs. To get the JavaDocs, unzip the following file:<div class="fragment"><div class="line">&lt;IDMLTOOLS&gt;/docs.zip</div></div><p>Finally, several sample projects are in the following directory:<div class="fragment"><div class="line">&lt;IDMLTOOLS&gt;/samples</div></div><p>The InDesign Products SDK also contains ActionScript-based samples for working with IDML, in the following location:<div class="fragment"><div class="line">&lt;SDK&gt;/idml flex samples</div></div><h3><a class="anchor" id="id_what_if_my_idml_file_passes_schema_validation_but_does_not_work_as_expected"></a> What if my IDML file passes schema validation but does not work as expected?</h3><p>Solution: Use the INXErrorLogging sample to see whether any scripting errors are reported.<p>Like INX, IDML is designed to quietly ignore unexpected data and scripting errors. This makes it possible to open a file in a previous release or with missing plug-ins; however, this relaxed behavior makes it difficult to debug IDML files. Through a plug-in, you can capture such errors. This is done by providing an implementation of the <a class="el" href="class_i_i_n_x_error_handler.html">IINXErrorHandler</a> interface. The INXErrorLogging sample demonstrates how to implement this interface and logs errors to a file. You probably will find it to be an adequate debugging tool.<p>The INXErrorLogging plug-in is a model-only plug-in that is compatible with InDesign, InCopy, and InDesign Server. It can be controlled via scripting as follows. The following JavaScript enables and specifies the location of the log file using a cross-platform path:<div class="fragment"><div class="line">app.inxerrlogOn = <span class="keyword">true</span>;</div><div class="line">app.inxerrlogPath = File(<span class="stringliteral">&quot;/c/temp.txt&quot;</span>);</div></div><p>To disable:<div class="fragment"><div class="line">app.inxerrlogOn = <span class="keyword">false</span>;</div></div><p>There also is an accompanying user-interface plug-in, INXErrorLoggingUI. It provides a simple user interface that enables and disables the INXErrorLogging sample via a menu item (Plug-Ins &gt; SDK &gt; INXErrorLoggingUI &gt; Install INX Error Handler[US]). When the logger is enabled via the menu, a dialog is displayed enabling the user to select the log file. Having access to these errors is extremely useful when debugging IDML files. Along with schema validation, this is useful when debugging problems in your externally created IDML files. The INXErrorLogging sample is in the InDesign Products SDK. Copy the built plug-in to the application plug-ins folder.<h3><a class="anchor" id="id_how_can_i_use_indesign_to_produce_a_package_from_a_directory"></a> How can I use InDesign to produce a package from a directory?</h3><p>Solution: Use scripting with the packageUCF and unpackageUCF events.<p>To unpackage an IDML file to a directory:<div class="fragment"><div class="line">var fromIDMLFile = <span class="keyword">new</span> File( <span class="stringliteral">&quot;~/Desktop/blankDoc.idml&quot;</span> );</div><div class="line">var toFolder = <span class="keyword">new</span> Folder( <span class="stringliteral">&quot;~/Desktop/blankDocUnpackaged&quot;</span> );</div><div class="line">app.unpackageUCF( fromIDMLFile, toFolder );</div></div><p>To produce a package from the contents of a directory:<div class="fragment"><div class="line">var fromFolder = <span class="keyword">new</span> Folder( <span class="stringliteral">&quot;~/Desktop/blankDocUnpackaged&quot;</span> );</div><div class="line">var toIDMLFile = <span class="keyword">new</span> File( <span class="stringliteral">&quot;~/Desktop/blankDocUnpackagedRepackaged.idml&quot;</span> );</div><div class="line">app.packageUCF( fromFolder, toIDMLFile );</div></div><h3><a class="anchor" id="id_how_do_i_produce_an_idml_package_outside_of_indesign"></a> How do I produce an IDML package outside of InDesign?</h3><p>Solution: Use the com.adobe.idml.Package class (found in IDML Tools) or another compression utility.<p>IDML packages are thoroughly described in the IDML Language Specification. These archives are Adobe UCF (Universal Container Format) files. UCF is built on top of the ZIP format. In addition to being a ZIP file, a UCF file follows several rules, described here.<p>The rules for building the archive are as follows:<ol type="1"><li>A file called mimetype must be the first file in the archive, and it must be stored uncompressed. It must contain the following line: <div class="fragment"><div class="line">application/vnd.adobe.indesign-idml-package</div></div><li>The META-INF directory can contain several files expected by UCF. IDML uses two such files: container.xml describes the file type and points to the root file (desinmap.xml), and metadata.xml contains XMP metadata.<li>The hierarchy of files as described in the IDML Language Specification must exist at the top level of the archive. (A common mistake is to compress the files into a subdirectory.) For example: <div class="fragment"><div class="line">mimetype</div><div class="line">META-INF/container.xml</div><div class="line">META-INF/metadata.xml </div><div class="line">designmap.xml</div><div class="line">MasterSpreads/MasterSpread_A.xml </div><div class="line">Resources/Fonts.xml </div><div class="line">Resources/Graphic.xml </div><div class="line">Resources/Preferences.xml </div><div class="line">Resources/Styles.xml </div><div class="line">Spreads/Spread_spread1.xml </div><div class="line">Spreads/Spread_spread2.xml </div><div class="line">Stories/Story_story0.xml</div><div class="line">Stories/Story_story1.xml</div><div class="line">XML/BackingStory.xml</div><div class="line">XML/Mapping.xml </div><div class="line">XML/Tags.xml</div></div><li>Build the ZIP file with UNIX path component separators (/), even on Windows. With Java, it is possible to build ZIP files with \ separators on Windows; however, InDesign cannot use such files. The fact that these files exist in a package presents an initial implementation hurdle. The first steps in working with IDML involve examining a package and deciding how to deal with the archive files.</ol><p>Several options are available for building packages:<ul><li>IDMLTools contains Java code that demonstrates compressing and decompressing packages using Java&#39;s built-in ZIP support. See the com.adobe.idml.Package class for an example of how packages are handled in the Java samples. For your convenience, a command-line version of the class can be driven using the package-wrapper scripts. Setup and use of these tools is described in the IDML ReadMe file.<li>InDesign provides scripting support for creating a package from the files on the file system.<li>ActionScript 3.0/Air can compress and decompress packages. For an example, see the CompressionUtils.as class in any ActionScript sample.<li>You can use off-the-shelf, ZIP-compliant software like WinZip. WinZip has been shown to be compatible with InDesign; however, it is more difficult to control the order and compression of individual files in the archive. To work around this, you first create a ZIP file containing only the uncompressed mimetype file, then you append the remaining files.</ul><p>You may find all this unnecessary if you are simply feeding the files into InDesign. You must follow these rules, however, if you expect the file to correctly expose its XMP metadata and act as a first-class citizen in Adobe Bridge.<h2><a class="anchor" id="id_recipes_and_pointers"></a> Recipes and Pointers</h2><h3><a class="anchor" id="id_spreads_and_pages"></a> Spreads and pages</h3><p><b>Adding a spread to an existing IDML document</b><ol type="1"><li>Add an XML file to the &quot;Spreads&quot; directory. For example, add Spreads/MySpread.xml.<li>Add content to the new spread XML file. For an example of a simple spread file, see the simplified &quot;Hello World&quot; example in &quot;What is in an IDML file?&quot;.<li>Be sure to leave off the Spread element&#39;s ItemTransform attribute. This will be computed for you based on the order of spreads.<li>Add an idPkg:Spread element for the new spread to designmap.xml. The actual spread order is determined by the order in which spreads are referenced in the designmap.xml file; for example: <div class="fragment"><div class="line">&lt;idPkg:Spread src=<span class="stringliteral">&quot;Spreads/Spread_spread1.xml&quot;</span>/&gt;</div></div></ol><p><b>Adding a page to a spread</b><ol type="1"><li>Set the Spread element&#39;s PageCount attribute to the new number of pages on the spread.<li>Add a page element in the position of the new page. This can be empty, or you can specify page properties.</ol><p><b>Controlling the page binding location</b><p>The page-binding location is controlled by the BindingLocation attribute on the Spread element. All pages with an index less than the BindingLocation are left pages; all pages with an index greater, right pages. Both the BindingLocation and page index are zero-based.<p>The Page Builder sample demonstrates the creation of spreads with various number of pages and binding locations.<h3><a class="anchor" id="id_page_items"></a> Page Items</h3><p><b>Adding page items in page coordinates</b><p>By default, Page items are in spread coordinates. The origin lies at the center point of the page binding. Often, it is easier to work in page coordinates. This can be achieved in IDML by adjusting the page item&#39;s ItemTransform matrix. Conceptually, this is a matter of moving the origin from the spread center point to the top-left corner of the page, as follows:<ol type="1"><li>Determine the zero-based page binding location, as described above.<li>Determine the zero-based page index.<li>Determine the page width.<li>Determine the page height.<li>Calculate the x (or horizontal) translation as follows: xTranslation = (pageIndex - pageBinding) * pageWidth<li>Calculate the y (or vertical) translation as follows: yTranslation = pageHeight / 2<li>Add yTranslation.</ol><p>For example, the following TextFrame is on a page just to the left of the binding; therefore, it is transformed horizontally -612 points and vertically -396 points. This moves the origin from the center of the binding to the left 612 points and up 396 points.<div class="fragment"><div class="line">&lt;TextFrame ... ItemTransform=<span class="stringliteral">&quot;1 0 0 1 -612 -396&quot;</span>&gt;</div><div class="line"> ...</div><div class="line"> &lt;PathPointArray&gt;</div><div class="line"> &lt;PathPointType Anchor=<span class="stringliteral">&quot;36 36&quot;</span> LeftDirection=<span class="stringliteral">&quot;36 36&quot;</span> RightDirection=<span class="stringliteral">&quot;36 36&quot;</span>/&gt;</div><div class="line">...</div></div><p>This pattern is used in numerous samples. For an example, see the Page Builder&#39;s spread XSL file at pagebuilder/xsl/Spreads/spread.xsl.<p><b>Adding lines, paths, and shapes</b><p>There are many elements that represent paths and shapes. The GraphicLine element represents a straight line; the Oval element, ovals; and the Rectangle element, rectangles. Irregular paths and shapes are represented by the Polygon element. Each of these types contains an array of path points and can be open or closed.<p><b>Adding an image</b><p>An image is either a child element of one of the shape elements or a Polygon element. The Type attribute of the shape or polygon is set to &quot;GraphicType,&quot; and an Image element is added as the last child element of the shape or polygon. This element contains many attributes and child elements, but most importantly, it contains a child element called Link, which describes how to access the actual image data.<p>Several samples demonstrate working with images. The Page Builder sample demonstrates adding a JPEG image to a document it is building from scratch. The Add Catalog pages sample demonstrates adding several images to a spread. The Java Replace Images sample, ActionScript/Air Replace Images sample, and Flex Air IDML Content Editor demonstrate extracting and changing the image Link element.<p><b>Fitting images to frames</b><p>IDML does not automatically fit images to frames. There is a frame-fitting feature that is controlled by the FrameFittingOption element that can appear on a page item. This does not automatically fit on IDML import; instead, it controls the behavior the next time an image is placed in the user interface.<p>The samples do demonstrate a technique for fitting an image to a frame. They fit images using the following steps:<ol type="1"><li>The rectangle bounds are set to match the proportions of the image. The rectangle can be any size, but it should be the same proportions as the image.<li>The Image element&#39;s ItemTransform attribute is set to &quot;1 0 0 1 0 0&quot; (the identity matrix).<li>The image bounds are set to match the frame.</ol><p><b>Adding text frames</b><p>Text frames, whether irregularly shaped or rectangular, always are represented as TextFrame elements. Their ParentStory attribute identifies which story the text belongs to and the PreviousTextFrame and NextTextFrame provide information on linked text frames.<div class="fragment"><div class="line">&lt;TextFrame Self=<span class="stringliteral">&quot;ue1&quot;</span> ParentStory=<span class="stringliteral">&quot;ue3&quot;</span> PreviousTextFrame=<span class="stringliteral">&quot;ua1&quot;</span> NextTextFrame=<span class="stringliteral">&quot;uf1&quot;</span> ... /&gt;</div></div><p>To add a text frame:<ol type="1"><li>Add a story XML file to the Stories directory. For an example of a minimal story, see the &quot;Hello World&quot; sample in &quot;What is in an IDML file?&quot; . This story must have a unique ID specified in its Self attribute.<li>Add an idPkg:Story element for the new story to designmap.xml; for example: <div class="fragment"><div class="line">&lt;idPkg:Story src=<span class="stringliteral">&quot;Stories/MyStory.xml&quot;</span>/&gt;</div></div><li>Add a TextFrame element to the desired spread file. This element should reference the Self attribute of the new story in its ParentStory attribute. The most difficult thing here is setting the geometry; see the simplified &quot;Hello World&quot; example.<li>Use the PreviousTextFrame and NextTextFrame attributes to link to or from existing frames. You must change the relevant attributes in frames you are linking to or from.</ol><p>The text for a text frame is saved in an associated story XML file.<p><b>Applying object styles</b><p>Object styles are applied by setting the AppliedObjectStyle attribute on the page-item element to the Self ID of the desired Object Style:<div class="fragment"><div class="line">&lt;TextFrame ... AppliedObjectStyle=<span class="stringliteral">&quot;ObjectStyle/Object Style 1&quot;</span> ... /&gt;</div></div><h3><a class="anchor" id="id_text"></a> Text</h3><p><b>Adding text</b><p>Text content and formatting is handled in the Story element of a story XML file or snippet. Text content always appears within a Content element. The Replace Story sample demonstrates how to replace an entire story.<p><b>Formatting text</b><p>Text is formatted using the ParagraphStyleRange and CharacterStyleRange elements. Names notwithstanding, these elements control both the text styles and overrides applied.<p>The Add Catalog Pages sample is a good example of formatting text.<p><b>Updating styles</b><p>Styles are saved in Resources/Styles.xml. You can update the styles in a document by updating the elements in this file. The Copy Styles sample demonstrates how to copy styles from one document to another.<p><b>Snippets and styles</b><p>Snippets contain enough information to reconstruct part of an InDesign document; however, if you place a snippet into a document that has styles with the same name applied, it will not replace those styles. Instead, it will use the styles in the document.<p><b>Adding a carriage return</b><p>Carriage returns can be added using the Br element; however, this must occur outside a Content element.<p><b>Special characters</b><p>Some special characters are not supported in XML; therefore, they are encoded using a processing instruction. For example, the page-number character is represented as &lt;?ACE 18?&gt;. There is no reference for these characters, so you will have to experiment with the application if you need to add such a character.<p><b>Turning conditional text on and off</b><p>Controlling conditional text in IDML is more complicated than doing so in the user interface. You must set the Conditional Text preference and add or remove HiddenText elements in the story content.<p>To turn a text condition off:<ol type="1"><li>Locate the condition in the designmap.xml file, and set its Visible attribute to &quot;false.&quot;<li>Wrap all occurrences in a HiddenText element. This amounts to wrapping the content inside each CharacterStyleRange that has an AppliedCondition attribute set to the condition that is being turned off.</ol><p>To turn a text condition on:<ol type="1"><li>Locate the condition in the designmap.xml file and set its Visible attribute to &quot;true&quot;.<li>Locate and remove any HiddenText elements that are part of a CharacterStyle range that contains an AppliedCondition set to the condition being turned on.</ol><p>The ConditionalText sample demonstrates turning conditions on and off with XSLT.<h3><a class="anchor" id="id_tables"></a> Tables</h3><p>InDesign has its own table model, which is reflected in IDML. The table&#39;s row (BodyRowCount), column (BodyColumnCount), header row (HeaderRowCount), and footer row (FooterRowCount) counts are specified as attributes in the Table element. The model supports cells that span multiple rows and columns. A cell&#39;s position and size is determined by the Name, RowSpan, and ColumnSpan attributes on the Cell element. The Name will be something like 1:1. This determines the starting point of the cell. The RowSpan and ColumnSpan attributes determine how many rows and columns the cell spans. Finally, the InDesign model allows you to specify table and cell styles.<p>The ICMLBuilder sample demonstrates converting a simple XHTML table to IDML (ICML).<h3><a class="anchor" id="id_xml"></a> XML</h3><p><b>Adding tags</b><p>Tags are defined in the Tags.xml file. To add a tag to a document:<ol type="1"><li>Add an XML/Tags.xml file if it does not already exist. The document element is idPkg:Tags. For an example, see below.<li>Add an XMLTag element to the XML/Tags.xml file. The new tag must have a unique Self attribute and name, and it should have a unique color specified.</ol><p>The following is an example of a Tags.xml file with one tag defined:<div class="fragment"><div class="line">&lt;idPkg:Tags xmlns:idPkg=<span class="stringliteral">&quot;http://ns.adobe.com/AdobeInDesign/idml/1.0/packaging&quot;</span> DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span>&gt;</div><div class="line"> &lt;XMLTag Self=<span class="stringliteral">&quot;XMLTag/ItemHeading&quot;</span> Name=<span class="stringliteral">&quot;ItemHeading&quot;</span>&gt;</div><div class="line"> &lt;Properties&gt;</div><div class="line"> &lt;TagColor type=<span class="stringliteral">&quot;enumeration&quot;</span>&gt;Green&lt;/TagColor&gt;</div><div class="line"> &lt;/Properties&gt;</div><div class="line"> &lt;/XMLTag&gt;</div><div class="line">&lt;/idPkg:Tags&gt;</div></div><p><b>Mapping tags and styles</b><p>To map tags to styles:<ol type="1"><li>Add an XML/Mapping.xml file if it does not already exist. The document element should be idPkg:Mapping. For an example, see below.<li>Define each mapping by adding an XMLImportMap element containing a unique Self attribute.<li>Add a MarkupTag attribute set to the Self attribute of the desired style.<li>Add a MappedStyle attribute set to the Self attribute of the desired style.</ol><p>To map styles to tags:<ol type="1"><li>Define each mapping by adding an XMLExportMap element containing a unique Self attribute.<li>Add a MarkupTag attribute set to the Self attribute of the desired style.<li>Add a MappedStyle attribute set to the Self attribute of the desired style.</ol><p>The following is an example of a simple Mapping.xml file: <div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> standalone=<span class="stringliteral">&quot;yes&quot;</span>?&gt;</div><div class="line">&lt;idPkg:Mapping xmlns:idPkg=<span class="stringliteral">&quot;http://ns.adobe.com/AdobeInDesign/idml/1.0/packaging&quot;</span> DOMVersion=<span class="stringliteral">&quot;9.0&quot;</span>&gt;</div><div class="line"> &lt;XMLExportMap Self=<span class="stringliteral">&quot;did5&quot;</span> MarkupTag=<span class="stringliteral">&quot;XMLTag/Tag2&quot;</span> MappedStyle=<span class="stringliteral">&quot;CharacterStyle/Character Style 1&quot;</span> IncludeMasterPageStories=<span class="stringliteral">&quot;false&quot;</span> IncludePasteboardStories=<span class="stringliteral">&quot;false&quot;</span> IncludeEmptyStories=<span class="stringliteral">&quot;false&quot;</span>/&gt;</div><div class="line"> &lt;XMLImportMap Self=<span class="stringliteral">&quot;did2&quot;</span> MarkupTag=<span class="stringliteral">&quot;XMLTag/Tag1&quot;</span> MappedStyle=<span class="stringliteral">&quot;CharacterStyle/Character Style 1&quot;</span>/&gt;</div><div class="line">&lt;/idPkg:Mapping&gt;</div></div><p><b>Adjusting a document&#39;s structure</b><p>A document&#39;s structure is stored in the XML/BackingStory.xml file and within the story XML files that are marked up. The BackingStory contains top-level associations between content and structure. Text that is marked up within a story is in the individual story files. Detailing this relationship is beyond the scope of this document. The Import XML Template sample demonstrates performing the equivalent of an XML import completely outside InDesign.<h3><a class="anchor" id="id_programming_with_java_and_xslt"></a> Programming with Java and XSLT</h3><p><b>XSLT patterns</b><p>Most changes that needs to be done to the XML files in an IDML package can be handled with XSLT. (When writing the samples, we originally used some manual DOM manipulations, but we found that XSLT was much more efficient and maintainable.)<p>Several patterns come into play when generating and manipulating IDML content with XSLT:<ul><li>Template - An XSLT stylesheet contains a combination of static and dynamic content. The style sheet is used as a template and is expanded into some new IDML content. The Page Builder and ICML Builder samples follow this pattern.<li>Transform - An XSLT stylesheet contains instructions for manipulating an existing IDML file. In this case, the input is an IDML file. The style sheet does not contain significant static content; instead, it contains instructions for altering the IDML file. Most of the time, this amounts to an identity transformation, with one or more transformations. Most of the other samples use this pattern; the Conditional Text sample is a good example to consider.<li>Hybrid - Some solutions require both the Templates and Transform patterns. The Add Catalog Pages sample does both. The transform pattern is used to update the designmap.xml file; this is necessary to add new spreads and stories. The Template pattern is then followed to generate new spread and story files.<li>Parameters - Flexible solutions based on XSLT must be written to handle variable input. XSLT provides a facility in the &lt;xsl:param&gt; element for passing data to the style sheet. Most or all of the samples pass parameters to the IDML. This is especially important because information like IDs can change from export to export. A typical pattern is to use Java to discover information about an IDML file, and pass it to stylesheets using parameters. The PackageInspector and XmlUtils classes contain code for discovering information in the IDML file, and the FileTransformer class contains support for specifying parameters and performing transformations.<li>Multiple outputs - Because an IDML file contains many files, it is beneficial to break it down into many different templates. The &lt;xsl:document&gt; element can be used to create multiple output files. This is done by the Page Builder.<li>Multiple inputs - Sometimes it is necessary to use one IDML file as an input for the transformation of another. XSLT facilitates this with the document() function. The Copy Styles sample uses this to copy a source document&#39;s styles into the document that is being transformed.</ul><p><b>The role of Java</b><p>The samples use Java to accomplish those tasks that are not easily achieved in XSLT. Another programming language could be substituted easily. In the IDMLTools samples, Java is used as follows:<ul><li>Accept command line and user interface input.<li>Compress and decompress ZIP files (see the Package class).<li>Manage temporary files and folders (see the <a class="el" href="class_file_utils.html">FileUtils</a> class).<li>Capture details of the package, like where to find particular package files (see PackageXmlLocator).<li>Match XSL and XML files in a package (see PackageXslLocator).<li>Start XSLT transformations (see the FileTransformer and PackageTransformer classes).<li>Call the Jing Java Validation Library (see the Validator class).<li>Discover data in an existing IDML file (see the PackageInspector and XmlUtils classes. For more information, see the next subsection.)</ul><p><b>Using Java to discover data</b><p>IDMLTools contains two classes for discovering data in an IDML package. The high-level PackageInspector class contains many methods for extracting information from an IDML package. For example, if you need to know the page height, width, or count, you can simply construct a PackageInspector from a path to an IDML file or directory containing an extracted IDML file, and call the GetPageHeight(), GetPageWidth(), or GetPageCount() methods.<div class="fragment"><div class="line">PackageInspector inspector = <span class="keyword">new</span> PackageInspector(tempDir);</div><div class="line"><span class="keywordtype">double</span> pageHeight = inspector.GetPageHeight();</div></div><p>The PackageInspector is really just a convenience wrapper to the more powerful XmlUtils class that combines Java and XPATH to extract information from a package. The following are examples of how you can discover data using XmlUtils.<p><b>How to get a layer ID from its name</b><p>XmlUtils provides a way for you to easily extract attributes from an IDML file. In this case, we know (from the schema) that this data is saved in the designmap.xml file. To get the data from a known XML file, we call the version of XmlUtils.getAttribute that takes one file path and an XPATH statement. The XPATH statement identifies the location of the data; in this case, it is in the Self attribute of a Layer item that is in the Document element. The path qualifies that we are looking for such a Layer whose Name attribute is &quot;text.&quot;<p>To extract the ID for a layer called text, we do the following:<div class="fragment"><div class="line">XmlUtils.getAttribute(xmlLoc.getDesignMapFilePath(), <span class="stringliteral">&quot;/Document/Layer[@Name = &#39;text&#39;]/@Self &quot;</span>);</div></div><p>The xmlLoc (which is an instance of PackageXmlLocator) is used to identify the path to the designmap.xml file in a string.<p><b>How to get a master spread ID from its name</b><p>XmlUtils also provides a way to find one attribute from a set of XML files. In this case, there is a collection of master-spread XML files. The following call finds the master-spread Self attribute that has a Name attribute equal to &quot;D-catalog.&quot;<div class="fragment"><div class="line">String masterSpreadID = XmlUtils.getAttribute(xmlLoc.getMasterSpreadXmlFiles(), <span class="stringliteral">&quot;/idPkg:MasterSpread/MasterSpread[@Name = &#39;D-catalog&#39;]/@Self&quot;</span>);</div></div><p>A PackageException is thrown if the XPATH statement returns anything other than a single attribute.<p><b>How to get multiple attributes</b><p>XmlUtils also contain methods that return an ArrayList of attributes. These methods are similar to the above, but instead of returning a single string, they return an ArrayList of strings. There are versions that operate on both a single file and an ArrayList of files.<p><b>How to get a HashTable that maps names or IDs to values</b><p>XmlUtils contains a method called getAttributePairsForElement() that creates a HashTable that maps a unique attribute like Self to another attribute. An example of this can be seen in the implementation of PackageInspector.GetObjectStyleIDNamePairs().<h3><a class="anchor" id=""></a></h3><p>With ActionScript/Air, it is possible to build self-contained applications that open, modify, and save IDML files, without depending on other technologies. For a scripting or programming language to work with IDML, it needs to provide the capabilities to interact with the file system, compress and decompress files, and modify XML files. All this can be done with ActionScript/Air.<p><b>Compressing and decompressing IDML files</b><p>ActionScript does not support compression operations natively. To compress and decompress files, we use the third-party library nochump by David Chang, included in the SDK samples. (See the Zip.swc file in the lib folder of any ActionScript/Air sample projects.) The CompressionUtils class found in all ActionScript/Air samples contains functions for interacting with this library.<p><b>Using E4X to read and modify XML files</b><p>ActionScript 3.0 does not support XSLT. To modify the individual XML files inside an IDML package, we used E4X, a feature in ActionScript 3.0 that allows XML files to be easily read and modified with few lines of code. There are many resources in print and on the Web that thoroughly explore E4X in ActionScript 3.0. The following examples demonstrate how to perform some useful IDML-related tasks with E4X.<p><b>Get the Story ID associated with a script label</b><p>The following code demonstrates how to look up the storyID of a text frame object containing a script label with the text &quot;Sample Script Label&quot; in an XML file in the Spreads directory. This script assumes that script labels are unique. If not, the first script label with a matching name is returned. Since there can be multiple-spread XML files in the Spreads folder, this code iterates through each file until a matc hing script label is found.<div class="fragment"><div class="line"><span class="comment">//The relative directory path from the extracted IDML files</span></div><div class="line"><span class="comment">//to the Spreads XML files.</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">const</span> SPREADS_DIR:String = <span class="stringliteral">&quot;Spreads&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">//Iterate through the spread XML files in the Spreads directory.</span></div><div class="line"><span class="keywordflow">for each</span> (var xmlFile:File inidmlDir.resolvePath(SPREADS_DIR).getDirectoryListing())</div><div class="line">{</div><div class="line"><span class="comment">//Read the XML file into an XML object.</span></div><div class="line"> var xml:XML = readXmlFromFile(xmlFile);</div><div class="line"></div><div class="line"><span class="comment">//Use E4X to find the Story ID associated with the script label</span></div><div class="line"><span class="comment">//&quot;Sample Script Label.&quot;</span></div><div class="line"> storyID = xml..TextFrame.(Properties.Label.KeyValuePair.@Value == &Acirc;&nbsp;&Acirc;&nbsp;&Acirc;&nbsp;&Acirc;&nbsp; <span class="stringliteral">&quot;Sample Script Label&quot;</span>).@ParentStory;</div><div class="line"></div><div class="line"><span class="comment">//Break the for loop if a matching storyID was found.</span></div><div class="line"><span class="keywordflow">if</span> (storyID != <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"> {</div><div class="line"><span class="keywordflow">break</span>;</div><div class="line"> }</div><div class="line">}</div></div><p><b>Update an image</b><p>The following line of code demonstrates using E4X to update the LinkResourceURI attribute of a link element, where the descendant Image element has a Self attribute value of Sample Self ID. Updating this attribute with a new path updates the image link in the InDesign document.<div class="fragment"><div class="line">xml..Image.(@Self == <span class="stringliteral">&quot;Sample Self ID&quot;</span>).Link.@LinkResourceURI = <span class="stringliteral">&quot;New Image Path&quot;</span>;</div></div><p><b>Get a master spread ID when given a spread name</b><p>E4X provides a way to find one attribute from a set of XML files. In this case, there is a collection of master-spread XML files. The following call finds the master-spread Self attribute that has a Name attribute equal to Sample Master ID.<div class="fragment"><div class="line">xml..MasterSpread.(@Name == <span class="stringliteral">&quot;Sample Master ID&quot;</span>).@Self</div></div><p><b>Read an XML file into an XML object</b><p>To process an XML document with E4X, the file needs to read into an XML object. This function demonstrates how to do that.<div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">function</span> readXmlFromFile(xmlFile:File):XML{</div><div class="line"> var fs:FileStream = <span class="keyword">new</span> FileStream();</div><div class="line"> fs.open(xmlFile, FileMode.READ);</div><div class="line"> var xml:XML = XML(fs.readUTFBytes(fs.bytesAvailable));</div><div class="line"> fs.close();</div><div class="line"><span class="keywordflow">return</span> xml;</div><div class="line"> }</div></div><h3><a class="anchor" id="id_workflow_customizations"></a> Workflow customizations</h3><p><b>Round-trip custom data through IDML import and export</b><p>Solution: Use the Script Labels feature, which in scripting goes beyond what you can do in the user interface.<p>You may want to round-trip your own data through IDML import and export. By design, it is impossible to add arbitrary elements and attributes; unrecognized content is consumed and discarded on IDML import. There are, however, two ways to achieve this in Adobe Creative Suite &reg; 5. First, you can write a plug-in that adds your data to the scripting system. Because this requires significant effort, we recommend the second option, using the Script Label feature.<p>Script Labels allow you to attach an arbitrary block of text to a scriptable object. They are more powerful than what is exposed in the user interface, where you can add one block of text to a scriptable object. Scripting and IDML allow you to add a set of key-value pairs. Only the value corresponding to the Label key is accessible in the user interface.<div class="fragment"><div class="line">&lt;Label&gt;</div><div class="line"> &lt;<a class="code" href="struct_key_value_pair.html">KeyValuePair</a> Key=<span class="stringliteral">&quot;FirstLabel&quot;</span> Value=<span class="stringliteral">&quot;First label.&quot;</span>/&gt;</div><div class="line"> &lt;<a class="code" href="struct_key_value_pair.html">KeyValuePair</a> Key=<span class="stringliteral">&quot;SecondLabel&quot;</span> Value=<span class="stringliteral">&quot;Second label.&quot;</span>/&gt;</div><div class="line"> &lt;<a class="code" href="struct_key_value_pair.html">KeyValuePair</a> Key=<span class="stringliteral">&quot;ThirdLabel&quot;</span> Value=<span class="stringliteral">&quot;Third label.&quot;</span>/&gt;</div><div class="line"> &lt;<a class="code" href="struct_key_value_pair.html">KeyValuePair</a> Key=<span class="stringliteral">&quot;Label&quot;</span> Value=<span class="stringliteral">&quot;This shows up in the UI.&quot;</span>/&gt;</div><div class="line">&lt;/Label&gt;</div></div><p>Script Labels are accessible via scripting. For example, the following JavaScripts show how to get the value for the FirstLabel key:<div class="fragment"><div class="line">app.documents[0].textFrames[0].extractLabel(<span class="stringliteral">&quot;FirstLabel&quot;</span>);</div></div><p>This script shows inserting a key-value pair: <div class="fragment"><div class="line">app.documents[0].textFrames[0].insertLabel(<span class="stringliteral">&quot;TestLabel&quot;</span>, <span class="stringliteral">&quot;Second label. Will this make the round trip?&quot;</span>);</div></div><p>To see an example of how script labels can be used to mark content, look at the Action Script/Air IDML Content Editor sample.<p><b>Controlling story, spread, and master-spread filenames on IDML export</b><p>Solution: Use scripting and the idmlComponentName property to specify the filename you want to export. Setting this property controls the part of the name before the .xml file extension.<p>For example, the following code produces a story file called MyStory.xml:<div class="fragment"><div class="line">myStory.idmlComponentName = <span class="stringliteral">&quot;MyStory&quot;</span>;</div></div><p>Discussion: IDML Export creates filenames for stories and spreads using its own naming convention, which ultimately is based on the object type and UID (Unique ID) in the InDesign database. These names can change on import and re-export, because it is not guaranteed that the objects will have the same UIDs.<p>If you are working in C++, you can access this data through the <a class="el" href="class_i_i_d_m_l_component_name.html">IIDMLComponentName</a> interface on the following boss classes: <a class="el" href="classk_text_story_boss.html">kTextStoryBoss</a>, <a class="el" href="classk_spread_boss.html">kSpreadBoss</a>, and kMasterPageBoss. To change the data, use the kSetIDMLComponentNameCmdBoss.<dl class="section note"><dt>Note<dd>If an imported story file is set to a nonstandard name, IDML Import sets the idmlComponentName property. </dl></div></div></div><div class="navpath" id="nav-path"><ul><li class="footer">Generated on Sat Sep 22 2018 10:53:03 for InDesign SDK by <a href="http://www.doxygen.org/index.html"> <img alt="doxygen" class="footer" src="doxygen.png" /></a> 1.8.3.1 </ul></div></body></html>
